GEODE-6777: Create gateway senders command should only return when DistributedSystemMXBean reflects creation status (#3643)


+import java.util.concurrent.TimeUnit;
+import org.apache.geode.annotations.VisibleForTesting;
+import org.apache.geode.management.DistributedSystemMXBean;
+  private static final int MBEAN_DELETION_WAIT_TIME = 10000;
+
+    if (!waitForGatewaySenderMBeanDeletion(id, members)) {
+      resultModel.addInfo()
+          .addLine("Did not complete waiting for GatewaySenderMBean proxy deletion");
+    }
+
+  /*
+   * Wait for up tp 3 seconds for the proxy MBeans to be deleted.
+   */
+  @VisibleForTesting
+  boolean waitForGatewaySenderMBeanDeletion(String id, Set<DistributedMember> members) {
+    DistributedSystemMXBean dsMXBean = getManagementService().getDistributedSystemMXBean();
+
+    return poll(MBEAN_DELETION_WAIT_TIME, TimeUnit.MILLISECONDS, () -> members.stream()
+        .noneMatch(m -> CreateGatewaySenderCommand.gatewaySenderBeanExists(dsMXBean,
+            m.getName(), id)));
+  }
+
