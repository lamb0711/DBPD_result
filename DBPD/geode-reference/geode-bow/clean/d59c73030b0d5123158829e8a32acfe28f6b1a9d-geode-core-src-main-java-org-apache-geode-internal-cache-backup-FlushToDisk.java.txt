Merge pull request #1053 from apache/feature/GEODE-3940

Feature/geode 3940
-package org.apache.geode.internal.cache.persistence;
+package org.apache.geode.internal.cache.backup;
-import org.apache.geode.cache.Region;
-import org.apache.geode.cache.RegionShortcut;
+import org.apache.geode.cache.DiskStore;
+import org.apache.geode.internal.cache.InternalCache;
-public class ReplicateBackupPrepareAndFinishMsgDUnitTest
-    extends BackupPrepareAndFinishMsgDUnitTest {
-  private static final RegionShortcut REGION_TYPE = RegionShortcut.REPLICATE_PERSISTENT;
+class FlushToDisk {
-  @Override
-  public Region<Integer, Integer> createRegion() {
-    return createRegion(REGION_TYPE);
+  private final InternalCache cache;
+
+  FlushToDisk(InternalCache cache) {
+    this.cache = cache;
+  }
+
+  void run() {
+    if (cache != null) {
+      cache.listDiskStoresIncludingRegionOwned().forEach(DiskStore::flush);
+    }
