GEODE-7842: Improve concurrent region creation (#4767)



+import org.apache.geode.annotations.VisibleForTesting;
-import org.apache.geode.cache.Region;
-    if (regionCreateArgs.isIfNotExists()) {
-      Region<Object, Object> region = cache.getRegion(regionCreateArgs.getRegionPath());
-      if (region != null) {
-        resultSender
-            .lastResult(new CliFunctionResult(memberNameOrId, CliFunctionResult.StatusState.OK,
-                CliStrings.format(
-                    CliStrings.CREATE_REGION__MSG__SKIPPING_0_REGION_PATH_1_ALREADY_EXISTS,
-                    memberNameOrId, regionCreateArgs.getRegionPath())));
-        return;
-      }
-    }
-
-      realizer.create(regionCreateArgs.getConfig(), regionCreateArgs.getRegionPath(),
+      getRealizer().create(regionCreateArgs.getConfig(), regionCreateArgs.getRegionPath(),
-      String exceptionMsg =
-          CliStrings.format(CliStrings.CREATE_REGION__MSG__REGION_PATH_0_ALREADY_EXISTS_ON_1,
-              regionCreateArgs.getRegionPath(), memberNameOrId);
-      resultSender.lastResult(handleException(memberNameOrId, exceptionMsg, e));
+      if (regionCreateArgs.isIfNotExists()) {
+        resultSender
+            .lastResult(new CliFunctionResult(memberNameOrId, CliFunctionResult.StatusState.OK,
+                CliStrings.format(
+                    CliStrings.CREATE_REGION__MSG__SKIPPING_0_REGION_PATH_1_ALREADY_EXISTS,
+                    memberNameOrId, regionCreateArgs.getRegionPath())));
+      } else {
+        String exceptionMsg =
+            CliStrings.format(CliStrings.CREATE_REGION__MSG__REGION_PATH_0_ALREADY_EXISTS_ON_1,
+                regionCreateArgs.getRegionPath(), memberNameOrId);
+        resultSender.lastResult(handleException(memberNameOrId, exceptionMsg, e));
+      }
+
+  @VisibleForTesting
+  protected RegionConfigRealizer getRealizer() {
+    return realizer;
+  }
