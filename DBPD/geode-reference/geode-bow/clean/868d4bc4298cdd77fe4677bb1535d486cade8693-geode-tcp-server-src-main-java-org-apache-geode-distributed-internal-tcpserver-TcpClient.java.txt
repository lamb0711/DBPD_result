GEODE-8330: Structural Improvements to Versioning

Follow-on to GEODE-8240, this commit eliminates redundancy in 
versioning code and provides a single way to convert a short
to a version and a single way to acquire a known version from
a (possibly unknown) version.
-import org.apache.geode.internal.serialization.UnsupportedSerializationVersionException;
+import org.apache.geode.internal.serialization.Versioning;
-    short serverVersion = getServerVersion(addr, timeout);
-
-    if (serverVersion > Version.CURRENT_ORDINAL) {
-      serverVersion = Version.CURRENT_ORDINAL;
+    final short serverVersionShort = getServerVersion(addr, timeout);
+    Version serverVersion =
+        Versioning.getKnownVersionOrDefault(
+            Versioning.getVersionOrdinal(serverVersionShort),
+            null);
+    final String debugVersionMessage;
+    if (serverVersion == null) {
+      serverVersion = Version.CURRENT;
+      debugVersionMessage =
+          "Remote TcpServer version: " + serverVersionShort + " is higher than local version: "
+              + Version.CURRENT_ORDINAL + ". This is never expected as remoteVersion";
+    } else {
+      debugVersionMessage = null;
-    if (Version.GFE_71.compareTo(serverVersion) > 0) {
+    if (serverVersion.isNotNewerThan(Version.GFE_71)) {
-      if (serverVersion < Version.CURRENT_ORDINAL) {
-        out = new VersionedDataOutputStream(out, Version.fromOrdinalNoThrow(serverVersion, false));
+      if (serverVersion.isOlderThan(Version.CURRENT)) {
+        out = new VersionedDataOutputStream(out, serverVersion);
-        out.writeShort(serverVersion);
+        out.writeShort(serverVersionShort);
-        in = new VersionedDataInputStream(in, Version.fromOrdinal(serverVersion));
+        if (debugVersionMessage != null && logger.isDebugEnabled()) {
+          logger.debug(debugVersionMessage);
+        }
+        in = new VersionedDataInputStream(in, serverVersion);
-    } catch (UnsupportedSerializationVersionException ex) {
-      if (logger.isDebugEnabled()) {
-        logger
-            .debug("Remote TcpServer version: " + serverVersion + " is higher than local version: "
-                + Version.CURRENT_ORDINAL + ". This is never expected as remoteVersion");
-      }
-      return null;
