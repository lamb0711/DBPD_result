GEODE-5255: check all colocated partitioned regions are ready before â€¦ (#1998)

* GEODE-5255: check all colocated partitioned regions are ready before creating any buckets.


+  public boolean isPartitionedRegionReady(PartitionedRegion partitionedRegion, final int bucketId) {
+    List<PartitionedRegion> colocatedWithList = getColocatedChildRegions(partitionedRegion);
+    if (colocatedWithList.size() == 0) {
+      return partitionedRegion.isInitialized();
+    }
+    return areAllColocatedPartitionedRegionsReady(bucketId, colocatedWithList);
+  }
+
+  private boolean areAllColocatedPartitionedRegionsReady(int bucketId,
+      List<PartitionedRegion> colocatedWithList) {
+    return colocatedWithList.stream().allMatch(
+        partitionedRegion -> isColocatedPartitionedRegionInitialized(partitionedRegion, bucketId));
+  }
+
+  private boolean isColocatedPartitionedRegionInitialized(PartitionedRegion partitionedRegion,
+      final int bucketId) {
+    if (!partitionedRegion.isInitialized()) {
+      return false;
+    }
+    if (!partitionedRegion.getDataStore().isColocationComplete(bucketId)) {
+      return false;
+    }
+    List<PartitionedRegion> colocatedWithList = getColocatedChildRegions(partitionedRegion);
+    return areAllColocatedPartitionedRegionsReady(bucketId, colocatedWithList);
+  }
+
+  List<PartitionedRegion> getColocatedChildRegions(PartitionedRegion partitionedRegion) {
+    return ColocationHelper.getColocatedChildRegions(partitionedRegion);
+  }
+
-  private boolean isColocationComplete(int bucketId) {
+  boolean isColocationComplete(int bucketId) {
