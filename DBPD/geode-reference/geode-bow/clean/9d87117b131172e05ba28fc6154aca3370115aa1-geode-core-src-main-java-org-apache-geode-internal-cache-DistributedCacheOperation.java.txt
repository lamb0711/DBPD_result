GEODE-5393: StateFlushOperation hangs waiting for non-existant operation to complete

I've added additional debugging to DistributionAdvisor so that it knows
which threads are performing operations and can log them at debug level.
This let me determine that a putAll operation was the source of the hang
due to an exception being thrown during message distribution in
DistributedCacheOperation.startOperation().  The exception resulted in
DistributionAdvisor.endOperation() not being invoked correctly.

-    if (this.containsRegionContentChange()) {
-      viewVersion = region.getDistributionAdvisor().startOperation();
-    }
-    if (logger.isTraceEnabled(LogMarker.STATE_FLUSH_OP_VERBOSE)) {
-      logger.trace(LogMarker.STATE_FLUSH_OP_VERBOSE, "dispatching operation in view version {}",
-          viewVersion);
-    }
-      _distribute();
-    } catch (InvalidVersionException e) {
-      if (logger.isTraceEnabled(LogMarker.DM_VERBOSE)) {
-        logger.trace(LogMarker.DM_VERBOSE,
-            "PutAll failed since versions were missing; retrying again", e);
+      if (this.containsRegionContentChange()) {
+        viewVersion = region.getDistributionAdvisor().startOperation();
+      if (logger.isTraceEnabled(LogMarker.STATE_FLUSH_OP_VERBOSE)) {
+        logger.trace(LogMarker.STATE_FLUSH_OP_VERBOSE, "dispatching operation in view version {}",
+            viewVersion);
+      }
+      try {
+        _distribute();
+      } catch (InvalidVersionException e) {
+        if (logger.isTraceEnabled(LogMarker.DM_VERBOSE)) {
+          logger.trace(LogMarker.DM_VERBOSE,
+              "PutAll failed since versions were missing; retrying", e);
+        }
-      if (test_InvalidVersionAction != null) {
-        test_InvalidVersionAction.run();
+        if (test_InvalidVersionAction != null) {
+          test_InvalidVersionAction.run();
+        }
+        _distribute();
-      _distribute();
+    } catch (RuntimeException | Error e) {
+      endOperation(viewVersion);
+      throw e;
-  private void _distribute() {
+  protected void _distribute() {
