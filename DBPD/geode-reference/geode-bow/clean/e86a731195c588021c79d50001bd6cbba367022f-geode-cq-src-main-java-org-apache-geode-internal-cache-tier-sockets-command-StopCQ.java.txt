Merge branch 'release/1.3.0'

-import org.apache.geode.cache.query.internal.cq.CqQueryImpl;
+import org.apache.geode.internal.security.SecurityService;
+import org.apache.geode.security.ResourcePermission.Operation;
+import org.apache.geode.security.ResourcePermission.Resource;
+import org.apache.geode.security.ResourcePermission.Target;
-  private final static StopCQ singleton = new StopCQ();
+  private static final StopCQ singleton = new StopCQ();
-  private StopCQ() {}
+  private StopCQ() {
+    // nothing
+  }
-  public void cmdExecute(Message clientMessage, ServerConnection serverConnection, long start)
-      throws IOException {
+  public void cmdExecute(final Message clientMessage, final ServerConnection serverConnection,
+      final SecurityService securityService, long start) throws IOException {
-    // Based on MessageType.QUERY
-    // Added by Rao 2/1/2007
-      this.securityService.authorizeDataManage();
+      securityService.authorize(Resource.CLUSTER, Operation.MANAGE, Target.QUERY);
-          cqRegionNames.add(((CqQueryImpl) cqQuery).getRegionName());
+          cqRegionNames.add(cqQuery.getRegionName());
-    {
-      long oldStart = start;
-      start = DistributionStats.getStatTime();
-      stats.incProcessStopCqTime(start - oldStart);
-    }
-
+    long oldStart = start;
+    start = DistributionStats.getStatTime();
+    stats.incProcessStopCqTime(start - oldStart);
