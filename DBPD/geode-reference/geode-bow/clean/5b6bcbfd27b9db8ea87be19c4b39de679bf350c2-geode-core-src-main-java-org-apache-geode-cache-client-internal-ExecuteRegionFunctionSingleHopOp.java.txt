GEODE-6677: Eliminate Infinite Function Retry (#3690)

* Fix for retry with onRegion
* Fix retry with onRegion singlehop
* Fix for onServer
* DUnitTest for onRegion (singleHop, multihop), onServer
* Unit test for onRegion (singleHop, multihop), onServer

-      ServerRegionFunctionExecutor serverRegionExecutor, ResultCollector resultCollector,
-      byte hasResult, Map<ServerLocation, ? extends HashSet> serverToFilterMap, int mRetryAttempts,
+      ServerRegionFunctionExecutor serverRegionExecutor,
+      ResultCollector resultCollector,
+      byte hasResult,
+      Map<ServerLocation, ? extends HashSet> serverToFilterMap,
+      int mRetryAttempts,
-    boolean reexecute = false;
-    int maxRetryAttempts = 0;
-    if (function.isHA()) {
-      maxRetryAttempts = mRetryAttempts;
-    }
+
-    reexecute = SingleHopClientExecutor.submitAllHA(callableTasks, (LocalRegion) region,
-        function.isHA(), resultCollector, failedNodes);
+    final int retryAttempts =
+        SingleHopClientExecutor.submitAllHA(callableTasks, (LocalRegion) region,
+            function.isHA(), resultCollector, failedNodes, mRetryAttempts, ((PoolImpl) pool));
-    if (reexecute) {
-      resultCollector.clearResults();
-      if (function.isHA()) {
-        ExecuteRegionFunctionOp.reexecute(pool, region.getFullPath(), function,
-            serverRegionExecutor, resultCollector, hasResult, failedNodes, maxRetryAttempts - 1);
-      }
+    if (retryAttempts > 0) {
+      ExecuteRegionFunctionOp.reexecute(pool, region.getFullPath(), function,
+          serverRegionExecutor, resultCollector, hasResult, failedNodes, retryAttempts - 1);
-      ServerRegionFunctionExecutor serverRegionExecutor, ResultCollector resultCollector,
-      byte hasResult, Map<ServerLocation, ? extends HashSet> serverToFilterMap, int mRetryAttempts,
+      ServerRegionFunctionExecutor serverRegionExecutor,
+      ResultCollector resultCollector,
+      byte hasResult,
+      Map<ServerLocation, ? extends HashSet> serverToFilterMap,
+      int mRetryAttempts,
-    boolean reexecute = false;
-    int maxRetryAttempts = 0;
-    if (isHA) {
-      maxRetryAttempts = mRetryAttempts;
-    }
+
-    reexecute = SingleHopClientExecutor.submitAllHA(callableTasks, (LocalRegion) region, isHA,
-        resultCollector, failedNodes);
+    final int retryAttempts =
+        SingleHopClientExecutor.submitAllHA(callableTasks, (LocalRegion) region, isHA,
+            resultCollector, failedNodes, mRetryAttempts, ((PoolImpl) pool));
-          callableTasks.size(), reexecute);
+          callableTasks.size(), retryAttempts);
-    if (reexecute) {
+    if (retryAttempts > 0) {
-      if (isHA) {
-        ExecuteRegionFunctionOp.reexecute(pool, region.getFullPath(), functionId,
-            serverRegionExecutor, resultCollector, hasResult, failedNodes, maxRetryAttempts - 1,
-            isHA, optimizeForWrite);
-      }
+      ExecuteRegionFunctionOp.reexecute(pool, region.getFullPath(), functionId,
+          serverRegionExecutor, resultCollector, hasResult, failedNodes, retryAttempts - 1,
+          isHA, optimizeForWrite);
