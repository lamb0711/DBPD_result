Merge remote-tracking branch 'origin/develop' into feature/GEODE-3239

- *
-
-package org.apache.geode.test.dunit.rules;
+package org.apache.geode.test.junit.rules;
-import org.junit.rules.ExternalResource;
+import org.apache.geode.internal.net.SocketCreatorFactory;
+import org.apache.geode.test.junit.rules.serializable.SerializableExternalResource;
-public abstract class MemberStarterRule<T> extends ExternalResource implements Member {
+public abstract class MemberStarterRule<T> extends SerializableExternalResource implements Member {
+
+  @Override
+  public void after() {
+    // invoke stopMember() first and then ds.disconnect
+    stopMember();
+
+    // this will clean up the SocketCreators created in this VM so that it won't contaminate
+    // future tests
+    SocketCreatorFactory.close();
+    disconnectDSIfAny();
+
+    if (temporaryFolder != null) {
+      temporaryFolder.delete();
+    }
+
+    if (oldUserDir == null) {
+      System.clearProperty("user.dir");
+    } else {
+      System.setProperty("user.dir", oldUserDir);
+    }
+  }
+
-  @Override
-  public void after() {
-    // invoke stopMember() first and then ds.disconnect
-    stopMember();
-
+  public static void disconnectDSIfAny() {
-
-    if (temporaryFolder != null) {
-      temporaryFolder.delete();
-    }
-
-    if (oldUserDir == null) {
-      System.clearProperty("user.dir");
-    } else {
-      System.setProperty("user.dir", oldUserDir);
-    }
