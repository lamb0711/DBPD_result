GEODE-7828: Convert backing store for Redis Hashes and Sets to single regions (#4781)

* Revert "Revert "GEODE-7828: Convert backing store for Redis Hashes and Sets to single regions (#4745)" (#4780)"

This reverts commit f0982cdedf1b122f734919d0647434cca33ec254.

* Fix sporadic test failures for concurrent HSetNX
+import java.util.Map;
-import org.apache.geode.cache.Region;
-import org.apache.geode.redis.internal.RedisDataType;
+/**
+ * Implementation of the HScan command used to incrementally iterate over a collection of elements.
+ */
-    @SuppressWarnings("unchecked")
-    Region<ByteArrayWrapper, ByteArrayWrapper> keyRegion =
-        (Region<ByteArrayWrapper, ByteArrayWrapper>) context.getRegionProvider().getRegion(key);
-    checkDataType(key, RedisDataType.REDIS_HASH, context);
-    if (keyRegion == null) {
-      command.setResponse(
-          Coder.getScanResponse(context.getByteBufAllocator(), new ArrayList<String>()));
+
+    Map<ByteArrayWrapper, ByteArrayWrapper> map =
+        context.getRegionProvider().getHashRegion().get(key);
+
+    if (map == null || map.isEmpty()) {
+      command.setResponse(Coder.getErrorResponse(context.getByteBufAllocator(), ERROR_CURSOR));
-        getIteration(new HashSet(keyRegion.entrySet()), matchPattern, count, cursor);
+        getIteration(new HashSet<Object>(map.entrySet()), matchPattern, count, cursor);
-      } else
+      } else {
+      }
-    if (i == size - 1)
+    if (i == size - 1) {
-    else
+    } else {
+    }
