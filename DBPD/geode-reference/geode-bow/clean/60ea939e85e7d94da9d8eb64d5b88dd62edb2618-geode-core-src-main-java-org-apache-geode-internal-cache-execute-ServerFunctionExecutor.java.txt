GEODE-5618: Auth Attributes in FunctionService (#2360)

   * When a client executes a function using the id instead of the actual instance, an internal invocation to the `GetFunctionAttributeOp` function is executed to get the metadata about the original function itself. This invocation doesn't set the user attributes requried by the authentication mechanism, so the entire invocation fails.
   * Added distributed tests.
   * Classes `ServerFunctionExecutor` and `ServerRegionFunctionExecutor` now set the `userAttributes` in the local thread before getting the metadata when the function is executed by id.
-  public boolean getAllServers() {
-    return this.allServers;
-  }
-
+  @Override
+  @Override
+  @Override
+  @Override
-  /*
-   * (non-Javadoc)
-   *
-   * @see
-   * org.apache.geode.internal.cache.execute.AbstractExecution#validateExecution(org.apache.geode.
-   * cache.execute.Function, java.util.Set)
-   */
+  @Override
+
-        Object obj = GetFunctionAttributeOp.execute(this.pool, functionName);
-        functionAttributes = (byte[]) obj;
-        addFunctionAttributes(functionName, functionAttributes);
+        // GEODE-5618: Set authentication properties before executing the internal function.
+        try {
+          if (proxyCache != null) {
+            if (this.proxyCache.isClosed()) {
+              throw proxyCache.getCacheClosedException("Cache is closed for this user.");
+            }
+            UserAttributes.userAttributes.set(this.proxyCache.getUserAttributes());
+          }
+
+          Object obj = GetFunctionAttributeOp.execute(this.pool, functionName);
+          functionAttributes = (byte[]) obj;
+          addFunctionAttributes(functionName, functionAttributes);
+        } finally {
+          UserAttributes.userAttributes.set(null);
+        }
-      boolean hasResult = ((functionAttributes[0] == 1) ? true : false);
-      boolean isHA = ((functionAttributes[1] == 1) ? true : false);
-      boolean optimizeForWrite = ((functionAttributes[2] == 1) ? true : false);
+
+      boolean isHA = functionAttributes[1] == 1;
+      boolean hasResult = functionAttributes[0] == 1;
+      boolean optimizeForWrite = functionAttributes[2] == 1;
-
