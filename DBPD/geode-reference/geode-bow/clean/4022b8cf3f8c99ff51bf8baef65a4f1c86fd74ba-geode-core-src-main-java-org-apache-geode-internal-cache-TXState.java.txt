Revert "GEODE-7087: Reset flag after unlock bucket primary lock. (#3926)"

This reverts commit b5c0395218822eb6fc2881634f7d9cd80560a4d7.

-  boolean gotBucketLocks = false;
+  protected boolean gotBucketLocks = false;
-      cleanupTXRegionState();
-    } finally {
-      synchronized (this.completionGuard) {
-        this.completionGuard.notifyAll();
-      }
-      if (exception != null && !this.proxy.getCache().isClosed()) {
-        throw exception;
-      }
-    }
-  }
-
-  void cleanupTXRegionState() {
-    Iterator<Map.Entry<InternalRegion, TXRegionState>> it = this.regions.entrySet().iterator();
-    try {
+      Iterator<Map.Entry<InternalRegion, TXRegionState>> it = this.regions.entrySet().iterator();
-        if (isBucketLocks()) {
-          unlockPrimaryMoveReadLock(r);
+        if (gotBucketLocks) {
+          if (r instanceof BucketRegion && (((BucketRegion) r).getBucketAdvisor().isPrimary())) {
+            try {
+              ((BucketRegion) r).doUnlockForPrimary();
+            } catch (RegionDestroyedException rde) {
+              // ignore
+              if (logger.isDebugEnabled()) {
+                logger.debug("RegionDestroyedException while unlocking bucket region {}",
+                    r.getFullPath(), rde);
+              }
+            } catch (Exception rde) {
+              // ignore
+              if (logger.isDebugEnabled()) {
+                logger.debug(
+                    "Exception while unlocking bucket region {} this is probably because the bucket was destroyed and never locked initially.",
+                    r.getFullPath(), rde);
+              }
+            }
+          }
-      if (isBucketLocks()) {
-        gotBucketLocks = false;
+      synchronized (this.completionGuard) {
+        this.completionGuard.notifyAll();
+      }
+
+      if (exception != null && !this.proxy.getCache().isClosed()) {
+        throw exception;
-  void unlockPrimaryMoveReadLock(InternalRegion internalRegion) {
-    if (internalRegion.isUsedForPartitionedRegionBucket()
-        && (((BucketRegion) internalRegion).getBucketAdvisor().isPrimary())) {
-      try {
-        ((BucketRegion) internalRegion).doUnlockForPrimary();
-      } catch (RegionDestroyedException rde) {
-        // ignore
-        if (logger.isDebugEnabled()) {
-          logger.debug("RegionDestroyedException while unlocking bucket region {}",
-              internalRegion.getFullPath(), rde);
-        }
-      } catch (Exception rde) {
-        // ignore
-        if (logger.isDebugEnabled()) {
-          logger.debug(
-              "Exception while unlocking bucket region {} this is probably because the bucket was destroyed and never locked initially.",
-              internalRegion.getFullPath(), rde);
-        }
-      }
-    }
-  }
-
-  boolean isBucketLocks() {
-    return gotBucketLocks;
-  }
-
