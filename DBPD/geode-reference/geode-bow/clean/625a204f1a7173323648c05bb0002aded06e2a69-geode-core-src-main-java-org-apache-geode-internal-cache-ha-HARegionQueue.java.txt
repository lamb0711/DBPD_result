GEODE-8323: Process QueueRemovalMessage after queue initialized. (#5333)


-
-      initialized.set(true);
+      synchronized (initialized) {
+        initialized.set(true);
+        initialized.notifyAll();
+      }
-      initialized.set(true);
+      synchronized (initialized) {
+        initialized.set(true);
+        initialized.notifyAll();
+      }
+  public boolean isQueueInitializedWithWait(long waitTime) {
+    try {
+      synchronized (initialized) {
+        if (!isQueueInitialized()) {
+          waitForInitialized(waitTime);
+        }
+      }
+    } catch (InterruptedException interruptedException) {
+      Thread.currentThread().interrupt();
+      return false;
+    }
+    return isQueueInitialized();
+  }
+
+  void waitForInitialized(long waitTime) throws InterruptedException {
+    initialized.wait(waitTime);
+  }
+
-        initialized.set(true);
+        synchronized (initialized) {
+          initialized.set(true);
+          initialized.notifyAll();
+        }
+      threadIdToSeqId.keepPrevAcks = true;
+      durableIDsList = new LinkedHashSet();
+      ackedEvents = new HashMap();
-      this.threadIdToSeqId.keepPrevAcks = true;
-      this.durableIDsList = new LinkedHashSet();
-      this.ackedEvents = new HashMap();
-      this.initialized.set(true);
-
+      synchronized (initialized) {
+        initialized.set(true);
+        initialized.notifyAll();
+      }
