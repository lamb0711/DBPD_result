Merge remote-tracking branch 'origin/develop' into feature/GEODE-917

-import com.gemstone.gemfire.internal.i18n.LocalizedStrings;
+import java.util.List;
+
-import com.gemstone.gemfire.cache.query.internal.*;
+import com.gemstone.gemfire.cache.query.internal.CompiledIteratorDef;
+import com.gemstone.gemfire.cache.query.internal.CompiledValue;
+import com.gemstone.gemfire.cache.query.internal.ExecutionContext;
+import com.gemstone.gemfire.cache.query.internal.RuntimeIterator;
-import java.util.List;
+import com.gemstone.gemfire.internal.cache.PartitionedRegion;
+import com.gemstone.gemfire.internal.i18n.LocalizedStrings;
-      //    Asif: Bind the Index_Internal_ID to the RuntimeIterator
-      String name = imgr.putCanonicalizedIteratorNameIfAbsent(definition);
+      //    Asif: Bind the Index_Internal_ID to the RuntimeIterator      
+      PartitionedRegion pr = this.context.getPartitionedRegion();
+      this.canonicalizedIteratorNames = new String[1];
+      String name = null;
+      if (pr != null) {
+        name = pr.getIndexManager().putCanonicalizedIteratorNameIfAbsent(definition);
+      } else {
+        name = imgr.putCanonicalizedIteratorNameIfAbsent(definition);
+      }
-      this.fromClause = new StringBuffer(definition).append(' ').append(name)
-          .toString();
+      this.fromClause = new StringBuffer(definition).append(' ').append(name).toString();
