Merge branch 'release/1.0.0-incubating.M3'

+
+import java.io.IOException;
+import java.util.Map;
+import com.gemstone.gemfire.management.internal.cli.shell.Gfsh;
+import com.gemstone.gemfire.security.AuthenticationFailedException;
+import com.gemstone.gemfire.security.NotAuthorizedException;
+
+import org.springframework.http.HttpEntity;
+import org.springframework.http.HttpStatus;
+import org.springframework.http.ResponseEntity;
+import org.springframework.http.client.ClientHttpResponse;
+import org.springframework.web.client.ResponseErrorHandler;
+
- * @since 8.0
+ * @since GemFire 8.0
+  private String user;
+
+  private String pwd;
+
+  private Map<String, String> securityProperties;
+
-  public SimpleHttpRequester() {
-    this(DEFAULT_CONNECT_TIMEOUT);
+  public SimpleHttpRequester(Gfsh gfsh, Map<String, String> securityProperties) {
+    this(gfsh, DEFAULT_CONNECT_TIMEOUT, securityProperties);
-  public SimpleHttpRequester(final int connectTimeout) {
+  public SimpleHttpRequester(final Gfsh gfsh, final int connectTimeout, Map<String, String> securityProperties) {
+    this.securityProperties = securityProperties;
+
+    this.restTemplate.setErrorHandler(new ResponseErrorHandler() {
+      @Override
+      public boolean hasError(final ClientHttpResponse response) throws IOException {
+        final HttpStatus status = response.getStatusCode();
+
+        switch (status) {
+          case BAD_REQUEST: // 400 *
+          case UNAUTHORIZED: // 401
+          case FORBIDDEN: // 403
+          case NOT_FOUND: // 404 *
+          case METHOD_NOT_ALLOWED: // 405 *
+          case NOT_ACCEPTABLE: // 406 *
+          case REQUEST_TIMEOUT: // 408
+          case CONFLICT: // 409
+          case REQUEST_ENTITY_TOO_LARGE: // 413
+          case REQUEST_URI_TOO_LONG: // 414
+          case UNSUPPORTED_MEDIA_TYPE: // 415 *
+          case TOO_MANY_REQUESTS: // 429
+          case INTERNAL_SERVER_ERROR: // 500 *
+          case NOT_IMPLEMENTED: // 501
+          case BAD_GATEWAY: // 502 ?
+          case SERVICE_UNAVAILABLE: // 503
+            return true;
+          default:
+            return false;
+        }
+      }
+
+      @Override
+      public void handleError(final ClientHttpResponse response) throws IOException {
+        final String message = String.format("The HTTP request failed with: %1$d - %2$s", response.getRawStatusCode(),
+          response.getStatusText());
+
+        if (response.getRawStatusCode() == 401) {
+          throw new AuthenticationFailedException(message);
+        }
+        else if (response.getRawStatusCode() == 403) {
+          throw new NotAuthorizedException(message);
+        }
+        else {
+          throw new RuntimeException(message);
+        }
+
+      }
+
+
+    });
+
-   * Performs an HTTP PUT operation on the requested resource identified/located by the specified URL.
+   * Performs an HTTP PUT operation on the requested resource identifiedR/located by the specified URL.
+  /**
+   * Performs an HTTP GET operation on the requested resource identified/located
+   * by the specified URL.
+   * <p/>
+   * @param url a String value identifying or locating the resource intended for
+   * the HTTP operation.
+   * @param urlVariables an array of variables to substitute in the URI/URL template.
+   * @see org.springframework.web.client.RestTemplate#getForObject(String,
+   * Class, Object...)
+   */
+  public <T> T exchange(final String url, final Class<T> responseType, final Object... urlVariables) {
+    ResponseEntity<T> response = getRestTemplate().exchange(url, HttpMethod.GET, getRequestEntity(), responseType);
+    return response.getBody();
+  }
+
+  protected HttpEntity<?> getRequestEntity() {
+    HttpHeaders requestHeaders = new HttpHeaders();
+    if (this.securityProperties != null) {
+      requestHeaders.setAll(securityProperties);
+    }
+
+    HttpEntity<?> requestEntity = new HttpEntity(requestHeaders);
+
+    return requestEntity;
+
+  }
+
