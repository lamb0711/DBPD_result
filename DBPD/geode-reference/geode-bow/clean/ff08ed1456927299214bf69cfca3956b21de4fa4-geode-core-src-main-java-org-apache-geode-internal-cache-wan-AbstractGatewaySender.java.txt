GEODE-7473: before adding to tmpDroppedEvents, should check GatewaySeâ€¦ (#4342)

* GEODE-7473: before adding to tmpDroppedEvents, should check GatewaySenderEventCallbackArgument first

+import org.apache.geode.annotations.VisibleForTesting;
-      // If this gateway is not running, return
-      if (!isRunning()) {
-        if (this.isPrimary()) {
-          tmpDroppedEvents.add(clonedEvent);
-          if (isDebugEnabled) {
-            logger.debug("add to tmpDroppedEvents for evnet {}", clonedEvent);
-          }
-        }
-        if (isDebugEnabled) {
-          logger.debug("Returning back without putting into the gateway sender queue:" + event);
-        }
-        return;
-      }
-
-          if (ep != null && !(ep.getDispatcher() instanceof GatewaySenderEventCallbackDispatcher)) {
+          // if manual-start is true, ep is null
+          if (ep == null || !(ep.getDispatcher() instanceof GatewaySenderEventCallbackDispatcher)) {
+      // If this gateway is not running, return
+      if (!isRunning()) {
+        if (this.isPrimary()) {
+          tmpDroppedEvents.add(clonedEvent);
+          if (isDebugEnabled) {
+            logger.debug("add to tmpDroppedEvents for evnet {}", clonedEvent);
+          }
+        }
+        if (isDebugEnabled) {
+          logger.debug("Returning back without putting into the gateway sender queue:" + event);
+        }
+        return;
+      }
+
+  @VisibleForTesting
+  int getTmpDroppedEventSize() {
+    return tmpDroppedEvents.size();
+  }
+
