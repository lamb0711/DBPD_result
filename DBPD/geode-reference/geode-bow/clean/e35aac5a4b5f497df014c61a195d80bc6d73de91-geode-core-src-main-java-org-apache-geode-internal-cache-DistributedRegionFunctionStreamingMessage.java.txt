Merge branch 'release/1.5.0'

-import org.apache.geode.distributed.internal.DM;
+import org.apache.geode.distributed.internal.ClusterDistributionManager;
-  private TXStateProxy prepForTransaction(DistributionManager dm) throws InterruptedException {
+  private TXStateProxy prepForTransaction(ClusterDistributionManager dm)
+      throws InterruptedException {
-  protected void process(final DistributionManager dm) {
+  protected void process(final ClusterDistributionManager dm) {
-        thr = new CacheClosedException(LocalizedStrings.PartitionMessage_REMOTE_CACHE_IS_CLOSED_0
-            .toLocalizedString(dm.getId()));
+        InternalCache cache = dm.getCache();
+        if (cache != null) {
+          thr = cache
+              .getCacheClosedException(LocalizedStrings.PartitionMessage_REMOTE_CACHE_IS_CLOSED_0
+                  .toLocalizedString(dm.getId()));
+        } else {
+          thr = new CacheClosedException(LocalizedStrings.PartitionMessage_REMOTE_CACHE_IS_CLOSED_0
+              .toLocalizedString(dm.getId()));
+        }
-  protected boolean operateOnDistributedRegion(final DistributionManager dm, DistributedRegion r)
-      throws ForceReattemptException {
+  protected boolean operateOnDistributedRegion(final ClusterDistributionManager dm,
+      DistributedRegion r) throws ForceReattemptException {
-  private boolean checkCacheClosing(DistributionManager dm) {
+  private boolean checkCacheClosing(ClusterDistributionManager dm) {
-  private boolean checkDSClosing(DistributionManager dm) {
+  private boolean checkDSClosing(ClusterDistributionManager dm) {
-  public synchronized boolean sendReplyForOneResult(DM dm, Object oneResult, boolean lastResult,
-      boolean sendResultsInOrder)
+  public synchronized boolean sendReplyForOneResult(DistributionManager dm, Object oneResult,
+      boolean lastResult, boolean sendResultsInOrder)
-  protected void sendReply(InternalDistributedMember member, int procId, DM dm, ReplyException ex,
-      Object result, int msgNum, boolean lastResult, boolean sendResultsInOrder) {
+  protected void sendReply(InternalDistributedMember member, int procId, DistributionManager dm,
+      ReplyException ex, Object result, int msgNum, boolean lastResult,
+      boolean sendResultsInOrder) {
-    return DistributionManager.REGION_FUNCTION_EXECUTION_EXECUTOR;
+    return ClusterDistributionManager.REGION_FUNCTION_EXECUTION_EXECUTOR;
