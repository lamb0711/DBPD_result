Merge branch 'feature/GEODE-8' into develop

+  // reuse the NOTIFICATION_ONLY flag since it is not used for SizeMessage 
+  /** flag to indicate that only an estimated size is required */
+  public static final short ESTIMATE = NOTIFICATION_ONLY;
+
+  private transient boolean estimate;
+
-      ArrayList<Integer> bucketIds) {
+      ArrayList<Integer> bucketIds, boolean estimate) {
+    this.estimate = estimate;
-      ArrayList<Integer> bucketIds) {
+      ArrayList<Integer> bucketIds, boolean estimate) {
-        p, bucketIds);
+        p, bucketIds, estimate);
+  protected void setBooleans(short s, DataInput in) throws ClassNotFoundException, IOException {
+    super.setBooleans(s, in);
+    this.estimate = ((s & ESTIMATE) != 0);
+  }
+
+  @Override
+  protected short computeCompressedShort(short s) {
+    s = super.computeCompressedShort(s);
+    if (this.estimate) s |= ESTIMATE;
+    return s;
+  }
+
+  @Override
-          sizes = ds.getSizeLocallyForBuckets(this.bucketIds);
+          if (estimate) {
+            sizes = ds.getSizeEstimateLocallyForBuckets(this.bucketIds);
+          } else {
+            sizes = ds.getSizeLocallyForBuckets(this.bucketIds);
+          }
-          sizes = ds.getSizeForLocalBuckets();
+          if (estimate) {
+            sizes = ds.getSizeEstimateForLocalPrimaryBuckets();
+          } else {
+            sizes = ds.getSizeForLocalBuckets();
+          }
