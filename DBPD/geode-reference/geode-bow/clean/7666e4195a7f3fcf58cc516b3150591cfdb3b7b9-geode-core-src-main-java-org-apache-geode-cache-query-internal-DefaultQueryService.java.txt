GEODE-7279: Warning log for deprecated system value should be shown once (#4132)


Authored-by: Donal Evans <doevans@pivotal.io>


-  public static final boolean ALLOW_UNTRUSTED_METHOD_INVOCATION = Boolean.getBoolean(
-      GEMFIRE_PREFIX + "QueryService.allowUntrustedMethodInvocation");
+  public static final boolean ALLOW_UNTRUSTED_METHOD_INVOCATION;
-  private boolean deprecatedWarningHasBeenShown = false;
+  public static final String DEPRECATION_WARNING = "The property " + GEMFIRE_PREFIX +
+      "QueryService.allowUntrustedMethodInvocation is deprecated. " +
+      "Please use the UnrestrictedMethodAuthorizer implementation of MethodInvocationAuthorizer " +
+      "instead";
+
+  static {
+    String deprecatedValue =
+        System.getProperty(GEMFIRE_PREFIX + "QueryService.allowUntrustedMethodInvocation");
+    if (deprecatedValue != null) {
+      logger.warn(DEPRECATION_WARNING);
+    }
+    ALLOW_UNTRUSTED_METHOD_INVOCATION = Boolean.valueOf(deprecatedValue);
+  }
-    if (ALLOW_UNTRUSTED_METHOD_INVOCATION && !deprecatedWarningHasBeenShown) {
-      logger
-          .warn("The property " + GEMFIRE_PREFIX + "QueryService.allowUntrustedMethodInvocation " +
-              "is deprecated. To provide the same functionality, please use the " +
-              "UnrestrictedMethodAuthorizer implementation of MethodInvocationAuthorizer");
-      deprecatedWarningHasBeenShown = true;
-    }
