GEODE-7229: add autoSerializer to pdx and remove the persistent attribute (#4294)


Co-authored-by: Dale Emery <demery@pivotal.io>
Co-authored-by: Darrel Schneider <dschneider@pivotal.io>

+import static org.apache.geode.cache.DiskStoreFactory.DEFAULT_DISK_STORE_NAME;
+
+import org.apache.commons.lang3.StringUtils;
+
+import org.apache.geode.cache.configuration.DeclarableType;
+import org.apache.geode.management.configuration.AutoSerializer;
+import org.apache.geode.management.configuration.ClassName;
+  private final AutoSerializerConverter autoSerializerConverter = new AutoSerializerConverter();
-    pdx.setDiskStoreName(xmlObject.getDiskStoreName());
+    if (xmlObject.isPersistent()) {
+      String diskStoreName = xmlObject.getDiskStoreName();
+      if (StringUtils.isBlank(diskStoreName)) {
+        diskStoreName = DEFAULT_DISK_STORE_NAME;
+      }
+      pdx.setDiskStoreName(diskStoreName);
+    }
-    pdx.setPersistent(xmlObject.isPersistent());
-    pdx.setPdxSerializer(converter.fromXmlObject(xmlObject.getPdxSerializer()));
+    AutoSerializer autoSerializer =
+        autoSerializerConverter.fromXmlObject(xmlObject.getPdxSerializer());
+    if (autoSerializer == null) {
+      ClassName className = converter.fromXmlObject(xmlObject.getPdxSerializer());
+      pdx.setPdxSerializer(className);
+    } else {
+      pdx.setAutoSerializer(autoSerializer);
+    }
-    xmlType.setPersistent(configObject.isPersistent());
-    xmlType.setPdxSerializer(converter.fromConfigObject(configObject.getPdxSerializer()));
+    xmlType.setPersistent(configObject.getDiskStoreName() != null);
+    DeclarableType pdxSerializer =
+        autoSerializerConverter.fromConfigObject(configObject.getAutoSerializer());
+    if (pdxSerializer == null) {
+      pdxSerializer = converter.fromConfigObject(configObject.getPdxSerializer());
+    }
+    xmlType.setPdxSerializer(pdxSerializer);
