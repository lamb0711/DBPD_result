GEODE-7178: Check operation if instance of Byte and Destroy for olderâ€¦ (#4041)

* GEODE-7178: Check operation if instance of Byte and Destroy for older native clients

- Move getOperation to Put65 and Destroy65

Co-authored-by: Michael Oleske <moleske@pivotal.io>
Co-authored-by: Vince Ford <vford@pivotal.io>
Co-authored-by: Jacob Barrett <jbarrett@pivotal.io>
+import org.apache.geode.internal.cache.OpType;
-      operation = getOperation(clientMessage.getPart(3), Operation.DESTROY);
+      final Part operationPart = clientMessage.getPart(3);
+
+      if (operationPart.isBytes()) {
+        final byte[] bytes = operationPart.getSerializedForm();
+        if (null == bytes || 0 == bytes.length) {
+          // older clients can send empty bytes for default operation.
+          operation = Operation.DESTROY;
+        } else {
+          operation = Operation.fromOrdinal(bytes[0]);
+        }
+      } else {
+        // Fallback for older clients.
+        final Object operationObject = operationPart.getObject();
+        if (operationObject == null) {
+          // native clients may send a null since the op is java-serialized.
+          operation = Operation.DESTROY;
+        } else if (operationObject instanceof Byte
+            && (Byte) operationObject == OpType.DESTROY) {
+          // older native clients may send Byte object OpType.DESTROY value treated as
+          // Operation.REMOVE.
+          operation = Operation.REMOVE;
+        } else {
+          operation = (Operation) operationObject;
+        }
+      }
