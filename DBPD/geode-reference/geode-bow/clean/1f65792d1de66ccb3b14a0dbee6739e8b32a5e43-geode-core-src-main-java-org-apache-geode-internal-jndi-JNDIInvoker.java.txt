GEODE-6669: Register drivers automatically when creating datasources for JDBC connector (#3584)

GEODE-6669: optionally register driver class when data source is created.

Co-authored-by: Benjamin Ross <bross@pivotal.io>
Co-authored-by: Donal Evans <doevans@pivotal.io>
Co-authored-by: Jianxia Chen <jchen@pivotal.io>
Co-authored-by: Xiaojian Zhou <gzhou@pivotal.io>
Co-authored-by: Scott Jewell <sjewell@pivotal.io>
+import org.apache.geode.internal.util.DriverJarUtil;
-          dataSourceFactory.getPooledDataSource(map, props));
+          dataSourceFactory.getPooledDataSource(map, props), props);
-          dataSourceFactory.getTranxDataSource(map, props));
+          dataSourceFactory.getTranxDataSource(map, props), props);
-      validateAndBindDataSource(context, jndiName, dataSourceFactory.getSimpleDataSource(map));
+      validateAndBindDataSource(context, jndiName, dataSourceFactory.getSimpleDataSource(map),
+          props);
-      DataSource dataSource) throws NamingException, DataSourceCreateException {
-    try (Connection connection = dataSource.getConnection()) {
-    } catch (SQLException sqlEx) {
+      DataSource dataSource, List<ConfigProperty> props)
+      throws NamingException, DataSourceCreateException {
+    try (Connection connection = getConnection(dataSource, props)) {
+    } catch (SQLException | ClassNotFoundException | InstantiationException
+        | IllegalAccessException sqlEx) {
+  private static Connection getConnection(DataSource dataSource, List<ConfigProperty> props)
+      throws SQLException, ClassNotFoundException, InstantiationException,
+      IllegalAccessException {
+    String driverClassName = null;
+    if (props != null) {
+      for (ConfigProperty property : props) {
+        if (property.getName().equals("jdbc-driver-class")) {
+          driverClassName = property.getName();
+        }
+      }
+    }
+    DriverJarUtil util = new DriverJarUtil();
+
+    if (driverClassName != null) {
+      util.registerDriver(driverClassName);
+    }
+    return dataSource.getConnection();
+  }
+
