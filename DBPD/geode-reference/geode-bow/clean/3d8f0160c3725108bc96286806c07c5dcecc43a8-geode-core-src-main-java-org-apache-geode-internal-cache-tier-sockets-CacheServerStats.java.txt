GEODE-3083: New protocol should record statistics

Statistics implemented: connections, connection starts, connection termination,
bytes/second received bytes/second sent, authorization violations

-   * @param f
+   * @param statisticsFactory
-  public CacheServerStats(StatisticsFactory f, String ownerName, String typeName,
-      StatisticDescriptor[] descriptiors) {
-    if (f == null) {
+  public CacheServerStats(StatisticsFactory statisticsFactory, String ownerName, String typeName,
+      StatisticDescriptor[] descriptors) {
+    if (statisticsFactory == null) {
-        f.createIntCounter("getRequests", "Number of cache client get requests.", "operations"),
-        f.createLongCounter("readGetRequestTime", "Total time spent in reading get requests.",
-            "nanoseconds"),
-        f.createLongCounter("processGetTime",
+        statisticsFactory.createIntCounter("getRequests", "Number of cache client get requests.",
+            "operations"),
+        statisticsFactory.createLongCounter("readGetRequestTime",
+            "Total time spent in reading get requests.", "nanoseconds"),
+        statisticsFactory.createLongCounter("processGetTime",
-        f.createIntCounter("getResponses", "Number of get responses written to the cache client.",
-            "operations"),
-        f.createLongCounter("writeGetResponseTime", "Total time spent in writing get responses.",
-            "nanoseconds"),
+        statisticsFactory.createIntCounter("getResponses",
+            "Number of get responses written to the cache client.", "operations"),
+        statisticsFactory.createLongCounter("writeGetResponseTime",
+            "Total time spent in writing get responses.", "nanoseconds"),
-        f.createIntCounter("putRequests", "Number of cache client put requests.", "operations"),
-        f.createLongCounter("readPutRequestTime", "Total time spent in reading put requests.",
-            "nanoseconds"),
-        f.createLongCounter("processPutTime",
+        statisticsFactory.createIntCounter("putRequests", "Number of cache client put requests.",
+            "operations"),
+        statisticsFactory.createLongCounter("readPutRequestTime",
+            "Total time spent in reading put requests.", "nanoseconds"),
+        statisticsFactory.createLongCounter("processPutTime",
-        f.createIntCounter("putResponses", "Number of put responses written to the cache client.",
-            "operations"),
-        f.createLongCounter("writePutResponseTime", "Total time spent in writing put responses.",
-            "nanoseconds"),
+        statisticsFactory.createIntCounter("putResponses",
+            "Number of put responses written to the cache client.", "operations"),
+        statisticsFactory.createLongCounter("writePutResponseTime",
+            "Total time spent in writing put responses.", "nanoseconds"),
-        f.createIntCounter("putAllRequests", "Number of cache client putAll requests.",
-            "operations"),
-        f.createLongCounter("readPutAllRequestTime", "Total time spent in reading putAll requests.",
-            "nanoseconds"),
-        f.createLongCounter("processPutAllTime",
+        statisticsFactory.createIntCounter("putAllRequests",
+            "Number of cache client putAll requests.", "operations"),
+        statisticsFactory.createLongCounter("readPutAllRequestTime",
+            "Total time spent in reading putAll requests.", "nanoseconds"),
+        statisticsFactory.createLongCounter("processPutAllTime",
-        f.createIntCounter("putAllResponses",
+        statisticsFactory.createIntCounter("putAllResponses",
-        f.createLongCounter("writePutAllResponseTime",
+        statisticsFactory.createLongCounter("writePutAllResponseTime",
-        f.createIntCounter("removeAllRequests", "Number of cache client removeAll requests.",
-            "operations"),
-        f.createLongCounter("readRemoveAllRequestTime",
+        statisticsFactory.createIntCounter("removeAllRequests",
+            "Number of cache client removeAll requests.", "operations"),
+        statisticsFactory.createLongCounter("readRemoveAllRequestTime",
-        f.createLongCounter("processRemoveAllTime",
+        statisticsFactory.createLongCounter("processRemoveAllTime",
-        f.createIntCounter("removeAllResponses",
+        statisticsFactory.createIntCounter("removeAllResponses",
-        f.createLongCounter("writeRemoveAllResponseTime",
+        statisticsFactory.createLongCounter("writeRemoveAllResponseTime",
-        f.createIntCounter("getAllRequests", "Number of cache client getAll requests.",
-            "operations"),
-        f.createLongCounter("readGetAllRequestTime", "Total time spent in reading getAll requests.",
-            "nanoseconds"),
-        f.createLongCounter("processGetAllTime",
+        statisticsFactory.createIntCounter("getAllRequests",
+            "Number of cache client getAll requests.", "operations"),
+        statisticsFactory.createLongCounter("readGetAllRequestTime",
+            "Total time spent in reading getAll requests.", "nanoseconds"),
+        statisticsFactory.createLongCounter("processGetAllTime",
-        f.createIntCounter("getAllResponses",
+        statisticsFactory.createIntCounter("getAllResponses",
-        f.createLongCounter("writeGetAllResponseTime",
+        statisticsFactory.createLongCounter("writeGetAllResponseTime",
-        f.createIntCounter("destroyRequests", "Number of cache client destroy requests.",
-            "operations"),
-        f.createLongCounter("readDestroyRequestTime",
+        statisticsFactory.createIntCounter("destroyRequests",
+            "Number of cache client destroy requests.", "operations"),
+        statisticsFactory.createLongCounter("readDestroyRequestTime",
-        f.createLongCounter("processDestroyTime",
+        statisticsFactory.createLongCounter("processDestroyTime",
-        f.createIntCounter("destroyResponses",
+        statisticsFactory.createIntCounter("destroyResponses",
-        f.createLongCounter("writeDestroyResponseTime",
+        statisticsFactory.createLongCounter("writeDestroyResponseTime",
-        f.createIntCounter("invalidateRequests", "Number of cache client invalidate requests.",
-            "operations"),
-        f.createLongCounter("readInvalidateRequestTime",
+        statisticsFactory.createIntCounter("invalidateRequests",
+            "Number of cache client invalidate requests.", "operations"),
+        statisticsFactory.createLongCounter("readInvalidateRequestTime",
-        f.createLongCounter("processInvalidateTime",
+        statisticsFactory.createLongCounter("processInvalidateTime",
-        f.createIntCounter("invalidateResponses",
+        statisticsFactory.createIntCounter("invalidateResponses",
-        f.createLongCounter("writeInvalidateResponseTime",
+        statisticsFactory.createLongCounter("writeInvalidateResponseTime",
-        f.createIntCounter("sizeRequests", "Number of cache client size requests.", "operations"),
-        f.createLongCounter("readSizeRequestTime", "Total time spent in reading size requests.",
-            "nanoseconds"),
-        f.createLongCounter("processSizeTime",
+        statisticsFactory.createIntCounter("sizeRequests", "Number of cache client size requests.",
+            "operations"),
+        statisticsFactory.createLongCounter("readSizeRequestTime",
+            "Total time spent in reading size requests.", "nanoseconds"),
+        statisticsFactory.createLongCounter("processSizeTime",
-        f.createIntCounter("sizeResponses", "Number of size responses written to the cache client.",
-            "operations"),
-        f.createLongCounter("writeSizeResponseTime", "Total time spent in writing size responses.",
-            "nanoseconds"),
+        statisticsFactory.createIntCounter("sizeResponses",
+            "Number of size responses written to the cache client.", "operations"),
+        statisticsFactory.createLongCounter("writeSizeResponseTime",
+            "Total time spent in writing size responses.", "nanoseconds"),
-        f.createIntCounter("queryRequests", "Number of cache client query requests.", "operations"),
-        f.createLongCounter("readQueryRequestTime", "Total time spent in reading query requests.",
-            "nanoseconds"),
-        f.createLongCounter("processQueryTime",
+        statisticsFactory.createIntCounter("queryRequests",
+            "Number of cache client query requests.", "operations"),
+        statisticsFactory.createLongCounter("readQueryRequestTime",
+            "Total time spent in reading query requests.", "nanoseconds"),
+        statisticsFactory.createLongCounter("processQueryTime",
-        f.createIntCounter("queryResponses",
+        statisticsFactory.createIntCounter("queryResponses",
-        f.createLongCounter("writeQueryResponseTime",
+        statisticsFactory.createLongCounter("writeQueryResponseTime",
-        f.createIntCounter("destroyRegionRequests",
+        statisticsFactory.createIntCounter("destroyRegionRequests",
-        f.createLongCounter("readDestroyRegionRequestTime",
+        statisticsFactory.createLongCounter("readDestroyRegionRequestTime",
-        f.createLongCounter("processDestroyRegionTime",
+        statisticsFactory.createLongCounter("processDestroyRegionTime",
-        f.createIntCounter("destroyRegionResponses",
+        statisticsFactory.createIntCounter("destroyRegionResponses",
-        f.createLongCounter("writeDestroyRegionResponseTime",
+        statisticsFactory.createLongCounter("writeDestroyRegionResponseTime",
-        f.createIntCounter("containsKeyRequests", "Number of cache client containsKey requests.",
-            "operations"),
-        f.createLongCounter("readContainsKeyRequestTime",
+        statisticsFactory.createIntCounter("containsKeyRequests",
+            "Number of cache client containsKey requests.", "operations"),
+        statisticsFactory.createLongCounter("readContainsKeyRequestTime",
-        f.createLongCounter("processContainsKeyTime",
+        statisticsFactory.createLongCounter("processContainsKeyTime",
-        f.createIntCounter("containsKeyResponses",
+        statisticsFactory.createIntCounter("containsKeyResponses",
-        f.createLongCounter("writeContainsKeyResponseTime",
+        statisticsFactory.createLongCounter("writeContainsKeyResponseTime",
-        f.createIntCounter("processBatchRequests", "Number of cache client processBatch requests.",
-            "operations"),
-        f.createLongCounter("readProcessBatchRequestTime",
+        statisticsFactory.createIntCounter("processBatchRequests",
+            "Number of cache client processBatch requests.", "operations"),
+        statisticsFactory.createLongCounter("readProcessBatchRequestTime",
-        f.createLongCounter("processBatchTime",
+        statisticsFactory.createLongCounter("processBatchTime",
-        f.createIntCounter("processBatchResponses",
+        statisticsFactory.createIntCounter("processBatchResponses",
-        f.createLongCounter("writeProcessBatchResponseTime",
+        statisticsFactory.createLongCounter("writeProcessBatchResponseTime",
-        f.createLongCounter("batchSize", "The size of the batches received.", "bytes"),
-        f.createIntCounter("clearRegionRequests", "Number of cache client clearRegion requests.",
-            "operations"),
-        f.createLongCounter("readClearRegionRequestTime",
+        statisticsFactory.createLongCounter("batchSize", "The size of the batches received.",
+            "bytes"),
+        statisticsFactory.createIntCounter("clearRegionRequests",
+            "Number of cache client clearRegion requests.", "operations"),
+        statisticsFactory.createLongCounter("readClearRegionRequestTime",
-        f.createLongCounter("processClearRegionTime",
+        statisticsFactory.createLongCounter("processClearRegionTime",
-        f.createIntCounter("clearRegionResponses",
+        statisticsFactory.createIntCounter("clearRegionResponses",
-        f.createLongCounter("writeClearRegionResponseTime",
+        statisticsFactory.createLongCounter("writeClearRegionResponseTime",
-        f.createIntCounter("clientNotificationRequests",
+        statisticsFactory.createIntCounter("clientNotificationRequests",
-        f.createLongCounter("readClientNotificationRequestTime",
+        statisticsFactory.createLongCounter("readClientNotificationRequestTime",
-        f.createLongCounter("processClientNotificationTime",
+        statisticsFactory.createLongCounter("processClientNotificationTime",
-        f.createIntCounter("updateClientNotificationRequests",
+        statisticsFactory.createIntCounter("updateClientNotificationRequests",
-        f.createLongCounter("readUpdateClientNotificationRequestTime",
+        statisticsFactory.createLongCounter("readUpdateClientNotificationRequestTime",
-        f.createLongCounter("processUpdateClientNotificationTime",
+        statisticsFactory.createLongCounter("processUpdateClientNotificationTime",
-        f.createIntCounter("clientReadyRequests", "Number of cache client ready requests.",
-            "operations"),
-        f.createLongCounter("readClientReadyRequestTime",
+        statisticsFactory.createIntCounter("clientReadyRequests",
+            "Number of cache client ready requests.", "operations"),
+        statisticsFactory.createLongCounter("readClientReadyRequestTime",
-        f.createLongCounter("processClientReadyTime",
+        statisticsFactory.createLongCounter("processClientReadyTime",
-        f.createIntCounter("clientReadyResponses",
+        statisticsFactory.createIntCounter("clientReadyResponses",
-        f.createLongCounter("writeClientReadyResponseTime",
+        statisticsFactory.createLongCounter("writeClientReadyResponseTime",
-        f.createIntCounter("closeConnectionRequests",
+        statisticsFactory.createIntCounter("closeConnectionRequests",
-        f.createLongCounter("readCloseConnectionRequestTime",
+        statisticsFactory.createLongCounter("readCloseConnectionRequestTime",
-        f.createLongCounter("processCloseConnectionTime",
+        statisticsFactory.createLongCounter("processCloseConnectionTime",
-        f.createIntCounter("failedConnectionAttempts", "Number of failed connection attempts.",
-            "attempts"),
-        f.createIntGauge("currentClientConnections",
+        statisticsFactory.createIntCounter("failedConnectionAttempts",
+            "Number of failed connection attempts.", "attempts"),
+        statisticsFactory.createIntGauge("currentClientConnections",
-        f.createIntGauge("currentQueueConnections",
+        statisticsFactory.createIntGauge("currentQueueConnections",
-        f.createIntGauge("currentClients", "Number of client virtual machines connected.",
-            "clients"),
-        f.createIntCounter("outOfOrderGatewayBatchIds", "Number of Out of order batch IDs.",
-            "batches"),
-        f.createIntCounter("abandonedWriteRequests",
+        statisticsFactory.createIntGauge("currentClients",
+            "Number of client virtual machines connected.", "clients"),
+        statisticsFactory.createIntCounter("outOfOrderGatewayBatchIds",
+            "Number of Out of order batch IDs.", "batches"),
+        statisticsFactory.createIntCounter("abandonedWriteRequests",
-        f.createIntCounter("abandonedReadRequests",
+        statisticsFactory.createIntCounter("abandonedReadRequests",
-        f.createLongCounter("receivedBytes", "Total number of bytes received from clients.",
+        statisticsFactory.createLongCounter("receivedBytes",
+            "Total number of bytes received from clients.", "bytes"),
+        statisticsFactory.createLongCounter("sentBytes", "Total number of bytes sent to clients.",
-        f.createLongCounter("sentBytes", "Total number of bytes sent to clients.", "bytes"),
-        f.createIntGauge("messagesBeingReceived",
+        statisticsFactory.createIntGauge("messagesBeingReceived",
-        f.createLongGauge("messageBytesBeingReceived",
+        statisticsFactory.createLongGauge("messageBytesBeingReceived",
-        f.createIntCounter("connectionsTimedOut",
+        statisticsFactory.createIntCounter("connectionsTimedOut",
-        f.createIntGauge("threadQueueSize",
+        statisticsFactory.createIntGauge("threadQueueSize",
-        f.createIntGauge("acceptsInProgress",
+        statisticsFactory.createIntGauge("acceptsInProgress",
-        f.createIntCounter("acceptThreadStarts",
+        statisticsFactory.createIntCounter("acceptThreadStarts",
-        f.createIntCounter("connectionThreadStarts",
+        statisticsFactory.createIntCounter("connectionThreadStarts",
-        f.createIntGauge("connectionThreads",
+        statisticsFactory.createIntGauge("connectionThreads",
-        f.createDoubleGauge("connectionLoad",
+        statisticsFactory.createDoubleGauge("connectionLoad",
-        f.createDoubleGauge("loadPerConnection",
+        statisticsFactory.createDoubleGauge("loadPerConnection",
-        f.createDoubleGauge("queueLoad",
+        statisticsFactory.createDoubleGauge("queueLoad",
-        f.createDoubleGauge("loadPerQueue",
+        statisticsFactory.createDoubleGauge("loadPerQueue",
-    if (descriptiors != null) {
-      alldescriptors = new StatisticDescriptor[descriptiors.length + serverStatDescriptors.length];
-      System.arraycopy(descriptiors, 0, alldescriptors, 0, descriptiors.length);
-      System.arraycopy(serverStatDescriptors, 0, alldescriptors, descriptiors.length,
+    if (descriptors != null) {
+      alldescriptors = new StatisticDescriptor[descriptors.length + serverStatDescriptors.length];
+      System.arraycopy(descriptors, 0, alldescriptors, 0, descriptors.length);
+      System.arraycopy(serverStatDescriptors, 0, alldescriptors, descriptors.length,
-    statType = f.createType(typeName, typeName, alldescriptors);
-    try {
-      ownerName = SocketCreator.getLocalHost().getCanonicalHostName() + "-" + ownerName;
-    } catch (Exception e) {
-    }
-    this.stats = f.createAtomicStatistics(statType, ownerName);
+    statType = statisticsFactory.createType(typeName, typeName, alldescriptors);
+    this.stats = statisticsFactory.createAtomicStatistics(statType, ownerName);
