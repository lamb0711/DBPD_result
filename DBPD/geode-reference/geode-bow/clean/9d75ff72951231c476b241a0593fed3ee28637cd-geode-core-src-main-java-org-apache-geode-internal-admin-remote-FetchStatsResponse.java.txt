GEODE-6269: Extract StatisticsRegistry from IDS (#3068)

Extract StatisticsRegistry from InternalDistributedSystem.

Exclude StatisticsRegistry from entry sizing in ReflectionBasedAutoSerializer.

-import org.apache.geode.distributed.internal.InternalDistributedSystem.StatisticsVisitor;
-    FetchStatsResponse m = new FetchStatsResponse();
-    m.setRecipient(recipient);
-    List<RemoteStatResource> statList = new ArrayList<RemoteStatResource>();
-    // get vm-local stats
-    // call visitStatistics to fix for bug 40358
+    FetchStatsResponse response = new FetchStatsResponse();
+    response.setRecipient(recipient);
+
+    List<Statistics> statsList = dm.getSystem().getStatisticsManager().getStatsList();
-      dm.getSystem().visitStatistics(new StatisticsVisitor() {
-        @Override
-        public void visit(Statistics s) {
-          statList.add(new RemoteStatResource(s));
-        }
-      });
+      response.stats = statsList.stream()
+          .map(RemoteStatResource::new)
+          .toArray(RemoteStatResource[]::new);
-      dm.getSystem().visitStatistics(new StatisticsVisitor() {
-        @Override
-        public void visit(Statistics s) {
-          if (s.getType().getName().equals(statisticsTypeName)) {
-            statList.add(new RemoteStatResource(s));
-          }
-        }
-      });
+      response.stats = statsList.stream()
+          .filter(s -> s.getType().getName().equals(statisticsTypeName))
+          .map(RemoteStatResource::new)
+          .toArray(RemoteStatResource[]::new);
-    m.stats = new RemoteStatResource[statList.size()];
-    m.stats = (RemoteStatResource[]) statList.toArray(m.stats);
-    return m;
+    return response;
