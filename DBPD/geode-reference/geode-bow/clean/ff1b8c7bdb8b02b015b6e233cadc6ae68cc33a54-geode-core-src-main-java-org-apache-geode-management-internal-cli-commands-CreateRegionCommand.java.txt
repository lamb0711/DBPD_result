GEODE-4389: Ensure that region template creation does not require callback classes on the locator (#1390)


+import org.apache.geode.management.internal.cli.functions.RegionAttributesWrapper;
-    functionArgs.setKeyConstraint(keyConstraint);
-    functionArgs.setValueConstraint(valueConstraint);
-    } else if (templateRegion != null) {
+    } else { // templateRegion != null
-      regionAttributes = getRegionAttributes(cache, templateRegion);
+      RegionAttributesWrapper<?, ?> wrappedAttributes = getRegionAttributes(cache, templateRegion);
-      if (regionAttributes == null) {
+      if (wrappedAttributes == null) {
-      if (regionAttributes.getPartitionAttributes() == null
+      if (wrappedAttributes.getRegionAttributes().getPartitionAttributes() == null
-      functionArgs.setRegionAttributes(regionAttributes);
+
+      // These attributes will have the actual callback fields (if previously present) nulled out.
+      functionArgs.setRegionAttributes(wrappedAttributes.getRegionAttributes());
+
+      functionArgs
+          .setCacheListeners(wrappedAttributes.getCacheListenerClasses().toArray(new ClassName[0]));
+      functionArgs.setCacheWriter(wrappedAttributes.getCacheWriterClass());
+      functionArgs.setCacheLoader(wrappedAttributes.getCacheLoaderClass());
+      functionArgs.setCompressor(wrappedAttributes.getCompressorClass());
+      functionArgs.setKeyConstraint(wrappedAttributes.getKeyConstraintClass());
+      functionArgs.setValueConstraint(wrappedAttributes.getValueConstraintClass());
-    functionArgs.setCacheListeners(cacheListener);
-    functionArgs.setCacheLoader(cacheLoader);
-    functionArgs.setCacheWriter(cacheWriter);
-    functionArgs.setCompressor(compressor);
+    if (cacheListener != null) {
+      functionArgs.setCacheListeners(cacheListener);
+    }
+
+    if (cacheLoader != null) {
+      functionArgs.setCacheLoader(cacheLoader);
+    }
+
+    if (cacheWriter != null) {
+      functionArgs.setCacheWriter(cacheWriter);
+    }
+
+    if (compressor != null) {
+      functionArgs.setCompressor(compressor);
+    }
+
+    if (keyConstraint != null) {
+      functionArgs.setKeyConstraint(keyConstraint);
+    }
+
+    if (valueConstraint != null) {
+      functionArgs.setValueConstraint(valueConstraint);
+    }
-  RegionAttributes getRegionAttributes(InternalCache cache, String regionPath) {
+  RegionAttributesWrapper getRegionAttributes(InternalCache cache, String regionPath) {
-    RegionAttributes attributes = null;
+    RegionAttributesWrapper attributes = null;
-              RegionAttributes regAttr = ((RegionAttributes) object);
+              RegionAttributesWrapper regAttr = ((RegionAttributesWrapper) object);
