GEODE-4858: Convert DestroyIndexCommand to ResultModel and new cluster persistence API (#1966)


+import org.apache.geode.cache.configuration.RegionConfig;
-import org.apache.geode.internal.cache.execute.InternalFunction;
-import org.apache.geode.internal.cache.xmlcache.CacheXml;
-import org.apache.geode.management.internal.cli.domain.IndexInfo;
+import org.apache.geode.management.cli.CliFunction;
-import org.apache.geode.management.internal.configuration.domain.XmlEntity;
-public class DestroyIndexFunction implements InternalFunction {
+public class DestroyIndexFunction extends CliFunction {
-  public void execute(FunctionContext context) {
-    IndexInfo indexInfo = (IndexInfo) context.getArguments();
+  public CliFunctionResult executeFunction(FunctionContext context) {
+    RegionConfig.Index indexInfo = (RegionConfig.Index) context.getArguments();
-      String indexName = indexInfo.getIndexName();
-      String regionPath = indexInfo.getRegionPath();
-
-      XmlEntity xmlEntity =
-          new XmlEntity(CacheXml.REGION, "name", regionPath, CacheXml.INDEX, "name", indexName);
+      String indexName = indexInfo.getName();
+      String regionPath = indexInfo.getFromClause();
-            result = new CliFunctionResult(memberId, xmlEntity,
+            result = new CliFunctionResult(memberId, CliFunctionResult.StatusState.OK,
-              result = new CliFunctionResult(memberId, xmlEntity,
+              result = new CliFunctionResult(memberId, CliFunctionResult.StatusState.OK,
-            } else if (indexInfo.isIfExists()) {
-              result = new CliFunctionResult(memberId, true,
-                  "Index " + indexName + " not found - skipped");
-              result = new CliFunctionResult(memberId, false,
+              result = new CliFunctionResult(memberId, CliFunctionResult.StatusState.IGNORED,
-          result = new CliFunctionResult(memberId, false,
+          result = new CliFunctionResult(memberId, CliFunctionResult.StatusState.ERROR,
-          result = new CliFunctionResult(memberId, xmlEntity, "Destroyed all indexes");
+          result = new CliFunctionResult(memberId, CliFunctionResult.StatusState.OK,
+              "Destroyed all indexes");
-            result = new CliFunctionResult(memberId, xmlEntity, "Destroyed index " + indexName);
-          } else if (indexInfo.isIfExists()) {
-            result = new CliFunctionResult(memberId, true,
-                "Index " + indexName + " not found - skipped");
+            result = new CliFunctionResult(memberId, CliFunctionResult.StatusState.OK,
+                "Destroyed index " + indexName);
-            result = new CliFunctionResult(memberId, false,
+            result = new CliFunctionResult(memberId, CliFunctionResult.StatusState.IGNORED,
-    context.getResultSender().lastResult(result);
+    return result;
