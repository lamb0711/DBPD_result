Merge branch 'release/1.5.0'

-import org.apache.geode.distributed.DistributedSystem;
-import org.apache.geode.distributed.internal.DM;
-import org.apache.geode.distributed.internal.InternalDistributedSystem;
+import org.apache.geode.distributed.internal.DistributionManager;
-        root.getDistributionAdvisor().addMembershipListener(new MemberFailureListener());
+        root.getDistributionAdvisor().addMembershipListener(new MemberFailureListener(cache));
-  public static void cleanUpMetaDataOnNodeFailure(DistributedMember failedMemId) {
+  public static void cleanUpMetaDataOnNodeFailure(InternalCache cache,
+      DistributedMember failedMemId) {
-      final InternalCache cache = GemFireCacheImpl.getInstance();
-      DM dm = cache.getInternalDistributedSystem().getDistributionManager();
-
-    DistributedSystem ids = InternalDistributedSystem.getAnyInstance();
-    if (ids != null) {
-      if (logger.isDebugEnabled()) {
-        logger.debug("getBucketString no match fullPath={}", bucketFullPath);
-      }
+    if (logger.isDebugEnabled()) {
+      logger.debug("getBucketString no match fullPath={}", bucketFullPath);
-    public void memberJoined(InternalDistributedMember id) {
+    InternalCache cache = null;
+
+    MemberFailureListener(InternalCache cache) {
+      this.cache = cache;
+    }
+
+    public void memberJoined(DistributionManager distributionManager,
+        InternalDistributedMember id) {
-    public void memberDeparted(final InternalDistributedMember id, boolean crashed) {
-      PartitionedRegionHelper.cleanUpMetaDataOnNodeFailure(id);
+    public void memberDeparted(DistributionManager distributionManager,
+        final InternalDistributedMember id, boolean crashed) {
+      PartitionedRegionHelper.cleanUpMetaDataOnNodeFailure(cache, id);
-    public void memberSuspect(InternalDistributedMember id, InternalDistributedMember whoSuspected,
-        String reason) {}
+    public void memberSuspect(DistributionManager distributionManager, InternalDistributedMember id,
+        InternalDistributedMember whoSuspected, String reason) {}
-    public void quorumLost(Set<InternalDistributedMember> failures,
-        List<InternalDistributedMember> remaining) {}
+    public void quorumLost(DistributionManager distributionManager,
+        Set<InternalDistributedMember> failures, List<InternalDistributedMember> remaining) {}
