Merge pull request #1146 from dschneider-pivotal/feature/GEODE-3976

GEODE-3976: improve exception message

The message in the exception thrown when the disk monitor
detects we have gone critical (i.e. run out of space) will
now also tell why it went critical.
It will either say something like this:
the file system is 2 percent full, which exceeds the critical threshold of 1.9 percent.
or something like this:
the file system only has 98 bytes free which is below the minimum of 1048576.

Also added unit test for DiskUsage class.
-      long min = getMinimumSpace();
+      long minMegabytes = getMinimumSpace();
+      final long minBytes = minMegabytes * 1024 * 1024;
-            min);
+            minMegabytes);
-      boolean belowMin = remaining < 1024 * 1024 * min;
+      boolean belowMin = remaining < minBytes;
-      handleStateChange(next, pct);
+      String criticalMessage = null;
+      if (next == DiskState.CRITICAL) {
+        if (belowMin) {
+          criticalMessage = "the file system only has " + remaining
+              + " bytes free which is below the minimum of " + minBytes + ".";
+        } else {
+          criticalMessage = "the file system is " + pct
+              + " full, which exceeds the critical threshold of " + critical + "%.";
+        }
+      }
+      handleStateChange(next, pct, criticalMessage);
-    protected abstract void handleStateChange(DiskState next, String pct);
+    protected abstract void handleStateChange(DiskState next, String pct, String criticalMessage);
-    protected void handleStateChange(DiskState next, String pct) {
+    protected void handleStateChange(DiskState next, String pct, String critcalMessage) {
-    protected void handleStateChange(DiskState next, String pct) {
+    protected void handleStateChange(DiskState next, String pct, String criticalMessage) {
-      String msg = "Critical disk usage threshold exceeded for volume "
-          + dir.getDir().getAbsolutePath() + ": " + pct + " full";
-
-          // TODO: this is weird...
+          String msg = "Critical disk usage threshold exceeded for volume "
+              + dir.getDir().getAbsolutePath() + ": " + criticalMessage;
