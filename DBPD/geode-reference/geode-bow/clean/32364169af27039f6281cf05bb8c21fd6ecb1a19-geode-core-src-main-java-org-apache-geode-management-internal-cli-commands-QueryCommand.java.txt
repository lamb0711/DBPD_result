GEODE-3256: Refactoring DataCommands

+import java.util.List;
+import java.util.Map;
+import org.apache.geode.cache.execute.FunctionService;
+import org.apache.geode.cache.execute.ResultCollector;
-    Object array[] = DataCommands.replaceGfshEnvVar(query, CommandExecutionContext.getShellEnv());
+    Object array[] = replaceGfshEnvVar(query, CommandExecutionContext.getShellEnv());
-            DataCommands.getQueryRegionsAssociatedMembers(regionsInQuery, cache, false);
+            DataCommandsUtils.getQueryRegionsAssociatedMembers(regionsInQuery, cache, false);
-          dataResult = DataCommands.callFunctionForRegion(request, function, members);
+          dataResult = callFunctionForRegion(request, function, members);
+
+  public static DataCommandResult callFunctionForRegion(DataCommandRequest request,
+      DataCommandFunction putfn, Set<DistributedMember> members) {
+
+    if (members.size() == 1) {
+      DistributedMember member = members.iterator().next();
+      ResultCollector collector =
+          FunctionService.onMember(member).setArguments(request).execute(putfn);
+      List list = (List) collector.getResult();
+      Object object = list.get(0);
+      if (object instanceof Throwable) {
+        Throwable error = (Throwable) object;
+        DataCommandResult result = new DataCommandResult();
+        result.setErorr(error);
+        result.setErrorString(error.getMessage());
+        return result;
+      }
+      DataCommandResult result = (DataCommandResult) list.get(0);
+      result.aggregate(null);
+      return result;
+    } else {
+      ResultCollector collector =
+          FunctionService.onMembers(members).setArguments(request).execute(putfn);
+      List list = (List) collector.getResult();
+      DataCommandResult result = null;
+      for (Object object : list) {
+        if (object instanceof Throwable) {
+          Throwable error = (Throwable) object;
+          result = new DataCommandResult();
+          result.setErorr(error);
+          result.setErrorString(error.getMessage());
+          return result;
+        }
+
+        if (result == null) {
+          result = (DataCommandResult) object;
+          result.aggregate(null);
+        } else {
+          result.aggregate((DataCommandResult) object);
+        }
+      }
+      return result;
+    }
+  }
+
+  private static Object[] replaceGfshEnvVar(String query, Map<String, String> gfshEnvVarMap) {
+    boolean done = false;
+    int startIndex = 0;
+    int replacedVars = 0;
+    while (!done) {
+      int index1 = query.indexOf("${", startIndex);
+      if (index1 == -1) {
+        break;
+      }
+      int index2 = query.indexOf("}", index1);
+      if (index2 == -1) {
+        break;
+      }
+      String var = query.substring(index1 + 2, index2);
+      String value = gfshEnvVarMap.get(var);
+      if (value != null) {
+        query = query.replaceAll("\\$\\{" + var + "\\}", value);
+        replacedVars++;
+      }
+      startIndex = index2 + 1;
+      if (startIndex >= query.length()) {
+        done = true;
+      }
+    }
+    return new Object[] {replacedVars, query};
+  }
