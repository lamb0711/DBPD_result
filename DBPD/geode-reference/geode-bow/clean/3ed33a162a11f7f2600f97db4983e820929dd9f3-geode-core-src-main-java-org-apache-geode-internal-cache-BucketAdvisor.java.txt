GEODE-5307 Hang with servers all in waitForPrimaryMember and one server in NO_PRIMARY_HOSTING state

Ignore the primaryElector if it is no longer known to the RegionAdvisor.
This means that the elector has somehow gone away - either it crashed,
shut down or destroyed its region.

-    if (this.primaryElector != null && this.primaryElector.equals(profile.getDistributedMember())) {
+    ProfileId elector = this.primaryElector;
+    if (elector != null && elector.equals(profile.getDistributedMember())) {
-    if (primaryElector != null) {
+    InternalDistributedMember elector = primaryElector;
+    if (elector != null && regionAdvisor.hasPartitionedRegion(elector)) {
+      // another server will determine the primary node
+
+    primaryElector = null;
+
+
-        this.volunteeringDelegate = new VolunteeringDelegate();
+        setVolunteeringDelegate(new VolunteeringDelegate());
+
+  protected void setVolunteeringDelegate(VolunteeringDelegate delegate) {
+    this.volunteeringDelegate = delegate;
+  }
+
-  public void clearPrimaryElector() {
-    synchronized (this) {
-      primaryElector = null;
-    }
+  public synchronized void clearPrimaryElector() {
+    primaryElector = null;
-  public void setPrimaryElector(InternalDistributedMember newPrimaryElector) {
-    synchronized (this) {
-      // Only set the new primary elector if we have not yet seen
-      // a primary for this bucket.
-      if (primaryElector != null) {
+  public synchronized void setPrimaryElector(InternalDistributedMember newPrimaryElector) {
+    // Only set the new primary elector if we have not yet seen
+    // a primary for this bucket.
+    if (this.primaryElector != null) {
+      if (newPrimaryElector != null && !regionAdvisor.hasPartitionedRegion(newPrimaryElector)) {
+        // no longer a participant - don't use it
+        this.primaryElector = null;
+      } else {
-  public synchronized void initializePrimaryElector(InternalDistributedMember primaryElector) {
+  public synchronized void initializePrimaryElector(InternalDistributedMember newPrimaryElector) {
-      this.primaryElector = primaryElector;
+      if (newPrimaryElector != null && !regionAdvisor.hasPartitionedRegion(newPrimaryElector)) {
+        // no longer a participant - don't use it
+        this.primaryElector = null;
+      } else {
+        this.primaryElector = newPrimaryElector;
+      }
-      if (this.primaryElector == null) {
-        volunteerForPrimary();
-      }
+      volunteerForPrimary();
