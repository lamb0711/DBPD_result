GEODE-5281: replicate failure and fix bug (#2096)

* GEODE-5281: replicate failure and fix bug

- replicate the bad timing using a DUnit test
- fix the bug by only doing one lookup of MBeans
- add more tests
- fix potential NPE in waiting for regions to be ready on servers

Co-authored-by: Kenneth Howe <khowe@pivotal.io>

* add TestingOnly annotation to setter

add a TestingOnly annotation to setter for ProxyFactory in the
FederatingManager for injecting test spies.

+import java.util.Map;
-      String name = objectName.toString();
-      FederationComponent federationComponent = (FederationComponent) monitoringRegion.get(name);
+      FederationComponent federationComponent = (FederationComponent) newVal;
-          objectName, interfaceClass);
+          objectName, federationComponent, interfaceClass);
-    Set<String> mbeanNames = monitoringRegion.keySet();
+    Set<Map.Entry<String, Object>> mbeans = monitoringRegion.entrySet();
-    for (String mbeanName : mbeanNames) {
+    for (Map.Entry<String, Object> mbean : mbeans) {
-        objectName = ObjectName.getInstance(mbeanName);
+        objectName = ObjectName.getInstance(mbean.getKey());
-        createProxy(member, objectName, monitoringRegion,
-            monitoringRegion.get(objectName.toString()));
+        createProxy(member, objectName, monitoringRegion, mbean.getValue());
