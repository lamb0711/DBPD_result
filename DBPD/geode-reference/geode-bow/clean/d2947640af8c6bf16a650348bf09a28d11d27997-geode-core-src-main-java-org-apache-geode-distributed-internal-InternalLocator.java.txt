GEODE-7652: MembershipBuilder lets you set the local locator (#4614)


+import org.apache.geode.metrics.internal.InternalDistributedSystemMetricsService;
-      InternalDistributedSystem ids = (InternalDistributedSystem) ds;
-      Distribution distribution = ids.getDM().getDistribution();
-      membershipLocator.setMembership(distribution.getMembership());
+      final InternalDistributedSystem ids = (InternalDistributedSystem) ds;
+      // let old locator know about new membership object
+      membershipLocator.setMembership(ids.getDM().getDistribution().getMembership());
-  public MembershipLocator getMembershipLocator() {
+  public MembershipLocator<InternalDistributedMember> getMembershipLocator() {
-          (InternalDistributedSystem) DistributedSystem.connect(distributedSystemProperties);
+          InternalDistributedSystem
+              .connectInternal(distributedSystemProperties, null,
+                  new InternalDistributedSystemMetricsService.Builder(),
+                  membershipLocator);
-            .setMembership(internalDistributedSystem.getDM().getDistribution().getMembership());
+            .setMembership(internalDistributedSystem.getDM()
+                .getDistribution().getMembership());
