GEODE-8151: Convert remaining commands to use RedisResponse (#5228)


+  public static ByteBuf getFlattenedArrayResponse(ByteBufAllocator alloc,
+      Collection<Collection<?>> items)
+      throws CoderException {
+    ByteBuf response = alloc.buffer();
+
+    for (Object next : items) {
+      writeCollectionOrString(alloc, response, next);
+    }
+
+    return response;
+  }
+
-      ByteBuf tmp = null;
-      try {
-        if (next instanceof Collection) {
-          Collection<?> nextItems = (Collection<?>) next;
-          tmp = getArrayResponse(alloc, nextItems);
-          response.writeBytes(tmp);
-        } else {
-          tmp = getBulkStringResponse(alloc, next);
-          response.writeBytes(tmp);
-        }
-      } finally {
-        if (tmp != null) {
-          tmp.release();
-        }
-      }
+      writeCollectionOrString(alloc, response, next);
+  private static void writeCollectionOrString(ByteBufAllocator alloc, ByteBuf response, Object next)
+      throws CoderException {
+    ByteBuf tmp = null;
+    try {
+      if (next instanceof Collection) {
+        Collection<?> nextItems = (Collection<?>) next;
+        tmp = getArrayResponse(alloc, nextItems);
+        response.writeBytes(tmp);
+      } else {
+        tmp = getBulkStringResponse(alloc, next);
+        response.writeBytes(tmp);
+      }
+    } finally {
+      if (tmp != null) {
+        tmp.release();
+      }
+    }
+  }
+
