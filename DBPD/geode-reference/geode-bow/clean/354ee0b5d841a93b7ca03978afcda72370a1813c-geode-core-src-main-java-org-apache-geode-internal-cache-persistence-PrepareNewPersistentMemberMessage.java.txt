GEODE-6975: Do not send reply back if hit CancelException. (#3806)

 * Do not send reply back if hit CancelException when processing
   PrepareNewPersistentMemberMessage. Depends on membership to
   determine which member has the last copy of the region, as the
   sender has to either wait for the replies back or membership
   listener detects the receiver of the message has been departed.
   In the later case, the sender should becomes the host of the
   last copy and should recover first to avoid the
   ConflictingPersistentDataException.
 * Use cache's CancelCriterion instead of DistributionManager's
   CancelCriterion in sender's reply processor. This to avoid an
   issue seen when shutdown occurs during bucket region creation.
   Shutdown will wait for all buckets are ready while sender of the
   PrepareNewPersistentMemberMessage still waiting for a reply but
   won't get it if the receiver is also being shut down. And the
   DistributionManager is yet to be shutdown at the time. Using
   cache's CancelCriterion will make the sender reply processor to
   throw CancelException instead of continue waiting for reply.

+import org.apache.geode.internal.cache.InternalCache;
-    ReplyProcessor21 processor = new ReplyProcessor21(dm, members);
+    InternalCache cache = dm.getExistingCache();
+    ReplyProcessor21 processor = new ReplyProcessor21(dm, members, cache.getCancelCriterion());
+    boolean sendReply = true;
-      Region region = cache.getRegion(this.regionPath);
+      Region region = cache.getRegion(getRegionPath());
-      logger.debug("<RegionDestroyed> {}", this);
+      if (logger.isDebugEnabled()) {
+        logger.debug("<RegionDestroyed> {}", this);
+      }
-      logger.debug("<CancelException> {}", this);
+      if (logger.isDebugEnabled()) {
+        logger.debug("<CancelException> {}", this);
+      }
+      sendReply = false;
-      ReplyMessage replyMsg = new ReplyMessage();
+      ReplyMessage replyMsg = createReplyMessage();
-      dm.putOutgoing(replyMsg);
+      if (sendReply) {
+        dm.putOutgoing(replyMsg);
+      }
+  ReplyMessage createReplyMessage() {
+    return new ReplyMessage();
+  }
+
+  String getRegionPath() {
+    return regionPath;
+  }
+
