GEODE-4406: Improve authorization granularity for protobuf (#1514)


+import org.apache.geode.internal.protocol.protobuf.v1.ProtobufSerializationService;
+import org.apache.geode.internal.protocol.protobuf.v1.serialization.exception.DecodingException;
-  public void validateOperation(MessageExecutionContext messageContext,
-      ProtobufOperationContext operationContext) throws ConnectionStateException {
+  public void validateOperation(Object message, ProtobufSerializationService serializer,
+      MessageExecutionContext messageContext, ProtobufOperationContext operationContext)
+      throws ConnectionStateException, DecodingException {
-      securityService.authorize(operationContext.getAccessPermissionRequired());
+      securityService.authorize(operationContext.getAccessPermissionRequired(
+          operationContext.getFromRequest().apply(message), serializer));
+
+  public ThreadState prepareThreadForAuthorization() {
+    return securityService.bindSubject(subject);
+  }
+
+  public void restoreThreadState(ThreadState state) {
+    state.restore();
+  }
