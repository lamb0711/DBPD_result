Merge branch 'feature/GEODE-8' into develop

+import com.gemstone.gemfire.cache.query.QueryException;
+import com.gemstone.gemfire.cache.query.QueryInvalidException;
-  public DefaultQuery(String queryString, Cache cache) {
+  public DefaultQuery(String queryString, Cache cache, boolean isForRemote) {
+    CompiledSelect cs = this.getSimpleSelect();
+    if(cs != null && !isForRemote && (cs.isGroupBy() || cs.isOrderBy())) {
+      QueryExecutionContext ctx = new QueryExecutionContext(null, cache);
+      try {
+        cs.computeDependencies(ctx);       
+      }catch(QueryException qe) {
+        throw new QueryInvalidException("",qe);
+      }
+    }
-        if(!isRemoteQuery() && !this.cache.getPdxReadSerialized() && result instanceof SelectResults) {
+        if(needsPDXDeserializationWrapper(true /* is query on PR*/) 
+            && result instanceof SelectResults ) {
-      if(!isRemoteQuery() && !this.cache.getPdxReadSerialized() && result instanceof SelectResults) {
+      if(needsPDXDeserializationWrapper(false /* is query on PR*/) && result instanceof SelectResults) {
+  //For Order by queries ,since they are already ordered by the comparator 
+  //&& it takes care of conversion, we do not have to wrap it in a wrapper
+  public boolean needsPDXDeserializationWrapper(boolean isQueryOnPR) {
+      if( !isRemoteQuery() && !this.cache.getPdxReadSerialized() ) {
+        return true;
+        /*if(isQueryOnPR) {
+          // if the query is on PR we need a top level pdx deserialization wrapper only in case of 
+          //order by query or non distinct query
+          CompiledSelect cs = this.getSimpleSelect();
+          if(cs != null) {
+            return cs.getOrderByAttrs() != null ;
+          }else {
+           return true; 
+          }
+        }else {
+          return true;
+        }*/
+      }else {
+        return false;
+      }
+  }
+ 
-          && cs.getProjectionAttributes() == null && !cs.isDistinct()) {
+          && cs.getProjectionAttributes() == null && !cs.isDistinct()
+          && cs.getOrderByAttrs() == null
+          ) {
-  public void setKeepSerialized(boolean keepSerialized) {
+  private void setKeepSerialized(boolean keepSerialized) {
