GEODE-4401: Add disconnect client message to server and driver. (#1525)

* GEODE-4401: Add disconnect client message to server and driver.

* GEODE-4401: Address review comments.

* GEODE-4401: Update the driver to use the channel instead of a socket.

-import java.io.InputStream;
-import java.io.OutputStream;
-import java.net.Socket;
+import java.util.Objects;
-import org.apache.geode.internal.protocol.protobuf.ProtocolVersion;
-import org.apache.geode.internal.protocol.protobuf.v1.BasicTypes;
-import org.apache.geode.internal.protocol.protobuf.v1.LocatorAPI;
+import org.apache.geode.internal.protocol.protobuf.v1.ConnectionAPI;
-      this.channel.close();
-    } catch (IOException e) {
-      // ignore
+      final Message disconnectClientRequest = ClientProtocol.Message.newBuilder()
+          .setDisconnectClientRequest(
+              ConnectionAPI.DisconnectClientRequest.newBuilder().setReason("Driver closed"))
+          .build();
+      final ConnectionAPI.DisconnectClientResponse disconnectClientResponse =
+          channel.sendRequest(disconnectClientRequest, MessageTypeCase.DISCONNECTCLIENTRESPONSE)
+              .getDisconnectClientResponse();
+      if (Objects.isNull(disconnectClientResponse)) {
+        // The server did not acknowledge the disconnect request; ignore for now.
+      }
+    } catch (IOException ioe) {
+      // NOP
+    } finally {
+      try {
+        this.channel.close();
+      } catch (IOException e) {
+        // ignore
+      }
