GEODE-5828: fixes replicates miss transaction commit. (#2571)

* GEODE-5828: fixes replicates miss transaction commit.

 * Always send CommitProcessQueryMessage to other replicates to see if anyone received second message
   as transaction originator for client transaction will be different from transation host.
 * Do not wait for transaction originator to depart when transaction host is crashed. Originator may
   not be the same as the crashed transaction host and never departs from distributed system.

* fix review comments.

-  public boolean commitProcessReceived(Object key, DistributionManager dm) {
-    // Assume that after the member has departed that we have all its pending
-    // transaction messages
-    if (key instanceof TXLockId) {
-      TXLockId lk = (TXLockId) key;
-      waitForMemberToDepart(lk.getMemberId(), dm);
-    } else if (key instanceof TXId) {
-      TXId id = (TXId) key;
-      waitForMemberToDepart(id.getMemberId(), dm);
-    } else {
-      Assert.assertTrue(false, "TXTracker received an unknown key class: " + key.getClass());
-    }
-
-    final TXCommitMessage mess;
-    synchronized (this.txInProgress) {
-      mess = (TXCommitMessage) this.txInProgress.get(key);
-      if (null != mess && mess.isProcessing()) {
+  public boolean commitProcessReceived(Object key) {
+    final TXCommitMessage message;
+    synchronized (txInProgress) {
+      message = (TXCommitMessage) getTxInProgress().get(key);
+      if (foundTxInProgress(message)) {
-      for (int i = this.txHistory.length - 1; i >= 0; --i) {
-        if (key.equals(this.txHistory[i])) {
-          return true;
-        }
+
+      if (foundFromHistory(key)) {
+        return true;
-    if (mess != null) {
-      synchronized (mess) {
-        if (!mess.isProcessing()) {
+    if (message != null) {
+      synchronized (message) {
+        if (!message.isProcessing()) {
-          mess.setDontProcess();
+          message.setDontProcess();
+  Map getTxInProgress() {
+    return txInProgress;
+  }
+
+  boolean foundTxInProgress(TXCommitMessage message) {
+    return null != message && message.isProcessing();
+  }
+
+  boolean foundFromHistory(Object key) {
+    for (int i = this.txHistory.length - 1; i >= 0; --i) {
+      if (key.equals(this.txHistory[i])) {
+        return true;
+      }
+    }
+    return false;
+  }
+
