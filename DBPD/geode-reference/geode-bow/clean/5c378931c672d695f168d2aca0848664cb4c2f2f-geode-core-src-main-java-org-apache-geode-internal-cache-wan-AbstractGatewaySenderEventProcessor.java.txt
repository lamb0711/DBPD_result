GEODE-5087: send a BatchDestroyOperation for each dropped event at serial primary sender (#1924)


-import org.apache.geode.cache.EntryOperation;
-import org.apache.geode.internal.cache.PartitionedRegionHelper;
-  public void registerEventDroppedInPrimaryQueue(EntryEventImpl event) {
-    if (queue == null) {
-      return;
-    }
-    if (this.queue instanceof ConcurrentParallelGatewaySenderQueue) {
-      ConcurrentParallelGatewaySenderQueue cpgsq = (ConcurrentParallelGatewaySenderQueue) queue;
-      PartitionedRegion prQ = cpgsq.getRegion(event.getRegion().getFullPath());
-      if (prQ == null) {
-        if (logger.isDebugEnabled()) {
-          logger.debug("shadow partitioned region " + event.getRegion().getFullPath()
-              + " is not created yet.");
-        }
-        return;
-      }
-      int bucketId = PartitionedRegionHelper.getHashKey((EntryOperation) event);
-      long shadowKey = event.getTailKey();
-
-      ParallelGatewaySenderQueue pgsq =
-          (ParallelGatewaySenderQueue) cpgsq.getQueueByBucket(bucketId);
-      boolean isPrimary = prQ.getRegionAdvisor().getBucketAdvisor(bucketId).isPrimary();
-      if (isPrimary) {
-        pgsq.sendQueueRemovalMesssageForDroppedEvent(prQ, bucketId, shadowKey);
-        this.sender.getStatistics().incEventsDroppedDueToPrimarySenderNotRunning();
-        if (logger.isDebugEnabled()) {
-          logger.debug("register dropped event for primary queue. BucketId is " + bucketId
-              + ", shadowKey is " + shadowKey + ", prQ is " + prQ.getFullPath());
-        }
-      }
-    }
-  }
+  protected abstract void registerEventDroppedInPrimaryQueue(EntryEventImpl droppedEvent);
