Merge branch 'release/1.4.0'

-import java.io.Serializable;
-
-import org.apache.geode.cache.CacheFactory;
-import org.apache.geode.cache.CacheListener;
-import org.apache.geode.cache.CacheLoader;
-import org.apache.geode.cache.CacheWriter;
- * 
+ *
+      Cache cache = context.getCache();
-      FetchRegionAttributesFunctionResult<?, ?> result = getRegionAttributes(regionPath);
+      RegionAttributes<?, ?> result = getRegionAttributes(cache, regionPath);
-  public static <K, V> FetchRegionAttributesFunctionResult<K, V> getRegionAttributes(
-      String regionPath) {
-    Cache cache = CacheFactory.getAnyInstance();
+  public static <K, V> RegionAttributes<K, V> getRegionAttributes(Cache cache, String regionPath) {
-    FetchRegionAttributesFunctionResult<K, V> result =
-        new FetchRegionAttributesFunctionResult<K, V>(afactory);
-    return result;
+    return afactory.create();
-
-  public static class FetchRegionAttributesFunctionResult<K, V> implements Serializable {
-    private static final long serialVersionUID = -3970828263897978845L;
-
-    private RegionAttributes<K, V> regionAttributes;
-    private String[] cacheListenerClasses;
-    private String cacheLoaderClass;
-    private String cacheWriterClass;
-
-    @SuppressWarnings("deprecation")
-    public FetchRegionAttributesFunctionResult(AttributesFactory<K, V> afactory) {
-      this.regionAttributes = afactory.create();
-
-      CacheListener<K, V>[] cacheListeners = this.regionAttributes.getCacheListeners();
-      if (cacheListeners != null && cacheListeners.length != 0) {
-        cacheListenerClasses = new String[cacheListeners.length];
-        for (int i = 0; i < cacheListeners.length; i++) {
-          cacheListenerClasses[i] = cacheListeners[i].getClass().getName();
-        }
-        afactory.initCacheListeners(null);
-      }
-      CacheLoader<K, V> cacheLoader = this.regionAttributes.getCacheLoader();
-      if (cacheLoader != null) {
-        cacheLoaderClass = cacheLoader.getClass().getName();
-        afactory.setCacheLoader(null);
-      }
-      CacheWriter<K, V> cacheWriter = this.regionAttributes.getCacheWriter();
-      if (cacheWriter != null) {
-        cacheWriterClass = cacheWriter.getClass().getName();
-        afactory.setCacheWriter(null);
-      }
-
-      // recreate attributes
-      this.regionAttributes = afactory.create();
-    }
-
-    public RegionAttributes<K, V> getRegionAttributes() {
-      return regionAttributes;
-    }
-
-    public String[] getCacheListenerClasses() {
-      return cacheListenerClasses;
-    }
-
-    public String getCacheLoaderClass() {
-      return cacheLoaderClass;
-    }
-
-    public String getCacheWriterClass() {
-      return cacheWriterClass;
-    }
-  }
