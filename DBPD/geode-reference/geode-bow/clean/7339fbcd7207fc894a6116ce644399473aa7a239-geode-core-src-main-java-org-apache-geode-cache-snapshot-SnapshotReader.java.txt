Feature/geode 3583 storage (#1285)

* This resolves the following tickets: GEODE-4196, GEODE-4197, GEODE-4198, GEODE-4199
   GEODE-4200, GEODE-4201, GEODE-4203, GEODE-4204, GEODE-4205, GEODE-4206
   GEODE-4208, GEODE-4209, GEODE-4210, GEODE-4212, and GEODE-4213
+import org.apache.geode.CancelException;
+import org.apache.geode.cache.Cache;
+import org.apache.geode.cache.CacheFactory;
+import org.apache.geode.internal.cache.InternalCache;
+import org.apache.geode.pdx.internal.TypeRegistry;
-    return GFSnapshot.read(snapshot);
+    TypeRegistry typeRegistry = null;
+    try {
+      Cache cache = CacheFactory.getAnyInstance();
+      if (cache != null) {
+        typeRegistry = ((InternalCache) cache).getPdxRegistry();
+      }
+    } catch (CancelException ignore) {
+      // proceed with no type registry
+    }
+    return GFSnapshot.read(snapshot, typeRegistry);
