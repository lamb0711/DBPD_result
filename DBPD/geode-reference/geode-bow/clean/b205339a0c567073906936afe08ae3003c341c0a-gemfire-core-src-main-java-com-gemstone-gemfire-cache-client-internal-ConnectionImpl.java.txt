Merge branch 'feature/GEODE-8' into develop

+import java.net.SocketException;
-    commBuffer = ServerConnection.allocateCommBuffer(socketBufferSize);
+    commBuffer = ServerConnection.allocateCommBuffer(socketBufferSize, theSocket);
-          .allocateCommBuffer(socketBufferSize);
+          .allocateCommBuffer(socketBufferSize, theSocket);
+    releaseCommBuffers();
+  }
+  
+  private void releaseCommBuffers() {
+    ByteBuffer bb = this.commBuffer;
+    if (bb != null) {
+      this.commBuffer = null;
+      ServerConnection.releaseCommBuffer(bb);
+    }
+    bb = this.commBufferForAsyncRead;
+    if (bb != null) {
+      this.commBufferForAsyncRead = null;
+      ServerConnection.releaseCommBuffer(bb);
+    }
-  public ByteBuffer getCommBuffer() {
+  public ByteBuffer getCommBuffer() throws SocketException {
+    if (isDestroyed()) {
+      // see bug 52193. Since the code used to see this
+      // as an attempt to use a close socket just throw
+      // a SocketException.
+      throw new SocketException("socket was closed");
+    }
-  public ByteBuffer getCommBufferForAsyncRead() {
+  public ByteBuffer getCommBufferForAsyncRead() throws SocketException {
+    if (isDestroyed()) {
+      // see bug 52193. Since the code used to see this
+      // as an attempt to use a close socket just throw
+      // a SocketException.
+      throw new SocketException("socket was closed");
+    }
