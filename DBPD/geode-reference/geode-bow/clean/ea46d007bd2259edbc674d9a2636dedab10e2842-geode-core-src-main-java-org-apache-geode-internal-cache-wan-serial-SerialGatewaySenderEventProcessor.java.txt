Merge pull request #3044 from gesterzhou/feature/GEODE-3967

GEODE-3967: fix the offheap memory leak in serial gateway sender's unâ€¦
+          if (logger.isDebugEnabled()) {
+            logger.debug("releaseUnprocessedEvents:" + gatewayEvent);
+          }
-          // put it into the map of unprocessed events.
-          senderEvent = new GatewaySenderEventImpl(operation, event, substituteValue, false); // OFFHEAP
-                                                                                              // ok
-          handleSecondaryEvent(senderEvent);
+          // put it into the map of unprocessed events, except 2 Special cases:
+          // 1) UPDATE_VERSION_STAMP: only enqueue to primary
+          // 2) CME && !originRemote: only enqueue to primary
+          boolean isUpdateVersionStamp =
+              event.getOperation().equals(Operation.UPDATE_VERSION_STAMP);
+          boolean isCME_And_NotOriginRemote =
+              ((EntryEventImpl) event).isConcurrencyConflict() && !event.isOriginRemote();
+          if (!(isUpdateVersionStamp || isCME_And_NotOriginRemote)) {
+            senderEvent =
+                new GatewaySenderEventImpl(operation, event, substituteValue, false);
+            handleSecondaryEvent(senderEvent);
+          }
