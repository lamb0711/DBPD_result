GEODE-8312: Improve Redis pub/sub capabilities (#5316)

* Improve pub/sub implementation
* Keep regular subscribed channel names as byte[]'s

Co-authored-by: Darrel Schneider <dschneider@pivotal.io>
+import java.util.Collection;
+import java.util.stream.Collectors;
-import org.apache.logging.log4j.Logger;
-
-import org.apache.geode.logging.internal.log4j.api.LogService;
+import org.apache.geode.redis.internal.data.ByteArrayWrapper;
-  private static final Logger logger = LogService.getLogger();
-    List<byte[]> commandElems = command.getProcessedCommand();
-    byte[] channelName = commandElems.get(1);
-    long subscriptionCount =
-        context.getPubSub().unsubscribe(new String(channelName), context.getClient());
+    List<byte[]> channelNames = extractChannelNames(command);
+    if (channelNames.isEmpty()) {
+      channelNames = context.getPubSub().findSubscribedChannels(context.getClient());
+    }
-    ArrayList<Object> items = new ArrayList<>();
-    items.add("unsubscribe");
-    items.add(channelName);
-    items.add(subscriptionCount);
+    Collection<Collection<?>> response = unsubscribe(context, channelNames);
-    return RedisResponse.array(items);
+    return RedisResponse.flattenedArray(response);
+  }
+
+  private List<byte[]> extractChannelNames(Command command) {
+    return command.getProcessedCommandWrappers().stream()
+        .skip(1)
+        .map(ByteArrayWrapper::toBytes)
+        .collect(Collectors.toList());
+  }
+
+  private Collection<Collection<?>> unsubscribe(ExecutionHandlerContext context,
+      List<byte[]> channelNames) {
+    Collection<Collection<?>> response = new ArrayList<>();
+
+    if (channelNames.isEmpty()) {
+      response.add(createItem(null, 0));
+    } else {
+      for (byte[] channel : channelNames) {
+        long subscriptionCount =
+            context.getPubSub().unsubscribe(channel, context.getClient());
+
+        response.add(createItem(channel, subscriptionCount));
+      }
+    }
+
+    return response;
+  }
+
+  private ArrayList<Object> createItem(byte[] channelName, long subscriptionCount) {
+    ArrayList<Object> oneItem = new ArrayList<>();
+    oneItem.add("unsubscribe");
+    oneItem.add(channelName);
+    oneItem.add(subscriptionCount);
+    return oneItem;
