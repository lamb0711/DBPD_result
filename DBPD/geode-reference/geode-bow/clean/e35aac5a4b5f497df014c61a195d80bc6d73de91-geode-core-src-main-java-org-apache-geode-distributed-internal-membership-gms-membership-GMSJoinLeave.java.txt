Merge branch 'release/1.5.0'

+import java.util.Objects;
+import org.apache.geode.distributed.internal.ClusterDistributionManager;
-import org.apache.geode.distributed.internal.DistributionManager;
-      // services.getMessenger().send(req, state.view);
-    // Remove JoinResponseMessage to fix GEODE-870
-    // if (!this.localAddress.getNetMember().preferredForCoordinator() &&
-    // incomingRequest.getMemberID().getNetMember().preferredForCoordinator()) {
-    // JoinResponseMessage joinResponseMessage = new
-    // JoinResponseMessage(incomingRequest.getMemberID(), currentView, true);
-    // services.getMessenger().send(joinResponseMessage);
-    // return;
-    // }
-
-      NetView newView = addMemberToNetView(oldCoordinator);
+      NetView newView = copyCurrentViewAndAddMyAddress(oldCoordinator);
-  private NetView addMemberToNetView(InternalDistributedMember oldCoordinator) {
+  private NetView copyCurrentViewAndAddMyAddress(InternalDistributedMember oldCoordinator) {
+      newView.setPublicKeys(currentView);
-    services.getMessenger().send(msg);
+    services.getMessenger().send(msg, view);
-      List<InternalDistributedMember> mbrs = view.getMembers();
-      Iterator<InternalDistributedMember> itr = mbrs.iterator();
-
-      while (itr.hasNext()) {
-        InternalDistributedMember mbr = itr.next();
-        byte[] pk = services.getMessenger().getPublicKey(mbr);
-        view.setPublicKey(mbr, pk);
+      for (InternalDistributedMember mbr : view.getMembers()) {
+        if (Objects.isNull(view.getPublicKey(mbr))) {
+          byte[] pk = services.getMessenger().getPublicKey(mbr);
+          view.setPublicKey(mbr, pk);
+        }
-          || localAddress.getVmKind() == DistributionManager.LOCATOR_DM_TYPE) {
+          || localAddress.getVmKind() == ClusterDistributionManager.LOCATOR_DM_TYPE) {
-            if (localAddress.getVmKind() != DistributionManager.LOCATOR_DM_TYPE && conflictingView
-                .getCreator().getVmKind() == DistributionManager.LOCATOR_DM_TYPE) {
+            if (localAddress.getVmKind() != ClusterDistributionManager.LOCATOR_DM_TYPE
+                && conflictingView.getCreator()
+                    .getVmKind() == ClusterDistributionManager.LOCATOR_DM_TYPE) {
