GEODE-5971: Refactor export/import commands to extend GfshCommand andâ€¦ (#2894)


-import org.apache.geode.internal.cache.execute.InternalFunction;
+import org.apache.geode.management.cli.CliFunction;
-public class ExportDataFunction implements InternalFunction {
+public class ExportDataFunction extends CliFunction {
-  public void execute(FunctionContext context) {
+  public CliFunctionResult executeFunction(FunctionContext context) throws Exception {
+    CliFunctionResult result;
-    try {
-      Cache cache = ((InternalCache) context.getCache()).getCacheForProcessingClientRequests();
-      Region<?, ?> region = cache.getRegion(regionName);
-      String hostName = cache.getDistributedSystem().getDistributedMember().getHost();
-      if (region != null) {
-        RegionSnapshotService<?, ?> snapshotService = region.getSnapshotService();
-        final File exportFile = new File(fileName);
-        if (parallel) {
-          SnapshotOptions options = new SnapshotOptionsImpl<>().setParallelMode(true);
-          snapshotService.save(exportFile, SnapshotFormat.GEMFIRE, options);
-        } else {
-          snapshotService.save(exportFile, SnapshotFormat.GEMFIRE);
-        }
-        String successMessage = CliStrings.format(CliStrings.EXPORT_DATA__SUCCESS__MESSAGE,
-            regionName, exportFile.getCanonicalPath(), hostName);
-        context.getResultSender().lastResult(successMessage);
+    Cache cache = ((InternalCache) context.getCache()).getCacheForProcessingClientRequests();
+    Region<?, ?> region = cache.getRegion(regionName);
+    String hostName = cache.getDistributedSystem().getDistributedMember().getHost();
+    if (region != null) {
+      RegionSnapshotService<?, ?> snapshotService = region.getSnapshotService();
+      final File exportFile = new File(fileName);
+      if (parallel) {
+        SnapshotOptions options = new SnapshotOptionsImpl<>().setParallelMode(true);
+        snapshotService.save(exportFile, SnapshotFormat.GEMFIRE, options);
-        throw new IllegalArgumentException(
-            CliStrings.format(CliStrings.REGION_NOT_FOUND, regionName));
+        snapshotService.save(exportFile, SnapshotFormat.GEMFIRE);
-    } catch (Exception e) {
-      context.getResultSender().sendException(e);
+      String successMessage = CliStrings.format(CliStrings.EXPORT_DATA__SUCCESS__MESSAGE,
+          regionName, exportFile.getCanonicalPath(), hostName);
+      result = new CliFunctionResult(context.getMemberName(), CliFunctionResult.StatusState.OK,
+          successMessage);
+    } else {
+      result = new CliFunctionResult(context.getMemberName(), CliFunctionResult.StatusState.ERROR,
+          CliStrings.format(CliStrings.REGION_NOT_FOUND, regionName));
+
+    return result;
