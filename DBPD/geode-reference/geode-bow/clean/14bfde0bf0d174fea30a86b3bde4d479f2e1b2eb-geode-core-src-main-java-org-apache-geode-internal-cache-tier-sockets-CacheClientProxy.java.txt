Merge branch 'release/1.8.0'

-import org.apache.geode.i18n.StringId;
-import org.apache.geode.internal.i18n.LocalizedStrings;
-import org.apache.geode.internal.logging.LoggingThreadGroup;
-import org.apache.geode.internal.logging.log4j.LocalizedMessage;
+import org.apache.geode.internal.logging.LoggingThread;
-            LocalizedStrings.CacheClientProxy_COULD_NOT_DRAIN_CQ_DUE_TO_RESTARTING_DURABLE_CLIENT
-                .toLocalizedString(clientCQName, proxyID.getDurableId());
+            String.format(
+                "CacheClientProxy: Could not drain cq %s due to client proxy id %s reconnecting.",
+                clientCQName, proxyID.getDurableId());
-            String msg = LocalizedStrings.CqService_CQ_NOT_FOUND_FAILED_TO_CLOSE_THE_SPECIFIED_CQ_0
-                .toLocalizedString(clientCQName);
+            String msg = String.format("CQ Not found, Failed to close the specified CQ %s",
+                clientCQName);
-            LocalizedStrings.CacheClientProxy_COULD_NOT_DRAIN_CQ_DUE_TO_ACTIVE_DURABLE_CLIENT
-                .toLocalizedString(clientCQName, proxyID.getDurableId());
+            String.format(
+                "CacheClientProxy: Could not drain cq %s because client proxy id %s is connected.",
+                clientCQName, proxyID.getDurableId());
-      if (this._cache.getSecurityLoggerI18n().warningEnabled()) {
-        this._cache.getSecurityLoggerI18n().warning(LocalizedStrings.TWO_ARG_COLON,
-            new Object[] {this, ex});
+      if (this._cache.getSecurityLogger().warningEnabled()) {
+        this._cache.getSecurityLogger().warning(String.format("%s : %s",
+            new Object[] {this, ex}));
-              logger.warn(LocalizedMessage.create(
-                  LocalizedStrings.CacheClientProxy_0_COULD_NOT_STOP_MESSAGE_DISPATCHER_THREAD,
-                  this));
+              logger.warn("{}: Could not stop message dispatcher thread.",
+                  this);
-        logger.warn(LocalizedMessage.create(
-            LocalizedStrings.CacheClientProxy_CQEXCEPTION_WHILE_CLOSING_NON_DURABLE_CQS_0,
-            ex.getLocalizedMessage()));
+        logger.warn("CqException while closing non durable Cqs. {}",
+            ex.getLocalizedMessage());
-      logger.warn(LocalizedMessage.create(
-          LocalizedStrings.CacheClientProxy_0_EXCEPTION_IN_CLOSING_THE_UNDERLYING_HAREGION_OF_THE_HAREGIONQUEUE,
-          this), warning);
+      logger.warn(
+          String.format("%s: Exception in closing the underlying HARegion of the HARegionQueue",
+              this),
+          warning);
-          LocalizedStrings.CacheClientProxy_NOT_PRIMARY.toLocalizedString());
+          "This process is not the primary server for the given client");
-            LocalizedStrings.CacheClientProxy_NOT_PRIMARY.toLocalizedString());
+            "This process is not the primary server for the given client");
-            LocalizedStrings.CacheClientProxy_NOT_PRIMARY.toLocalizedString());
+            "This process is not the primary server for the given client");
-          logger.warn(LocalizedMessage.create(
-              LocalizedStrings.CacheClientProxy_THE_FOLLOWING_EXCEPTION_OCCURRED_0, entry.value),
+          logger.warn(
+              String.format("The following exception occurred while attempting to serialize %s",
+                  entry.value),
-          LocalizedStrings.CacheClientProxy_NOT_PRIMARY.toLocalizedString());
+          "This process is not the primary server for the given client");
-            LocalizedStrings.CacheClientProxy_NOT_PRIMARY.toLocalizedString());
+            "This process is not the primary server for the given client");
-          logger.warn(LocalizedMessage.create(
-              LocalizedStrings.CacheClientProxy__0_NOT_ADDING_MESSAGE_TO_QUEUE_1_BECAUSE_THE_OPERATION_CONTEXT_OBJECT_COULD_NOT_BE_OBTAINED_FOR_THIS_CLIENT_MESSAGE,
-              new Object[] {this, clientMessage}));
+          logger.warn(
+              "{}: Not Adding message to queue: {} because the operation context object could not be obtained for this client message.",
+              new Object[] {this, clientMessage});
-              logger.warn(LocalizedMessage.create(
-                  LocalizedStrings.CacheClientProxy__0_NOT_ADDING_CQ_MESSAGE_TO_QUEUE_1_BECAUSE_AUTHORIZATION_FAILED,
-                  new Object[] {this, clientMessage}));
+              logger.warn("{}: Not Adding CQ message to queue {} because authorization failed.",
+                  new Object[] {this, clientMessage});
-        logger.warn(LocalizedMessage.create(
-            LocalizedStrings.CacheClientProxy__0_NOT_ADDING_MESSAGE_TO_QUEUE_1_BECAUSE_THE_OPERATION_CONTEXT_OBJECT_COULD_NOT_BE_OBTAINED_FOR_THIS_CLIENT_MESSAGE,
-            new Object[] {this, clientMessage}));
+        logger.warn(
+            "{}: Not Adding message to queue: {} because the operation context object could not be obtained for this client message.",
+            new Object[] {this, clientMessage});
-        logger.warn(LocalizedMessage.create(
-            LocalizedStrings.CacheClientProxy__0_NOT_ADDING_MESSAGE_TO_QUEUE_1_BECAUSE_AUTHORIZATION_FAILED,
-            new Object[] {this, clientMessage}));
+        logger.warn("{}: Not Adding message to queue {} because authorization failed.",
+            new Object[] {this, clientMessage});
-        // .append("client proxy id=")
-        // .append("; client host name=")
-        // .append(this._socket.getInetAddress().getCanonicalHostName())
-        // .append("; client host address=")
-        // .append(this._remoteHostAddress)
-        // .append("client proxy id=")
-        // .append("; client host name=")
-        // .append(this._socket.getInetAddress().getCanonicalHostName())
-        // .append("; client host address=")
-        // .append(this._remoteHostAddress)
-    // boolean primary = this._messageDispatcher.isAlive()
-    // || this._messageDispatcher._messageQueue.isPrimary();
-    // System.out.println(this + ": DISPATCHER IS ALIVE: " + this._messageDispatcher.isAlive());
-    // System.out.println(this + ": DISPATCHER QUEUE IS PRIMARY: " +
-    // this._messageDispatcher._messageQueue.isPrimary());
-    // System.out.println(this + ": IS PRIMARY: " + primary);
-    // return this.isPrimary ;
-  // private static int nextId = 0;
-  // protected static int getNextId() {
-  // synchronized (CacheClientProxy.class) {
-  // return ++nextId;
-  // }
-  // }
-        logger.warn(LocalizedMessage.create(
-            LocalizedStrings.CacheClientProxy_0__THE_EXPIRATION_TASK_HAS_FIRED_SO_THIS_PROXY_IS_BEING_TERMINATED,
-            CacheClientProxy.this));
+        logger.warn("{} : The expiration task has fired, so this proxy is being terminated.",
+            CacheClientProxy.this);
-        logger.info(LocalizedMessage.create(
-            LocalizedStrings.CacheClientProxy_0_CANCELLING_EXPIRATION_TASK_SINCE_THE_CLIENT_HAS_RECONNECTED,
-            this));
+        logger.info("{}: Cancelling expiration task since the client has reconnected.",
+            this);
-          logger.warn(LocalizedStrings.CacheClientProxy_REGION_NOTIFICATION_OF_INTEREST_FAILED, e);
+          logger.warn("Region notification of interest failed", e);
-  static class MessageDispatcher extends Thread {
+  static class MessageDispatcher extends LoggingThread {
-      super(LoggingThreadGroup.createThreadGroup(name, logger), name);
-
-      setDaemon(true);
+      super(name);
-          logger.debug("Creating a durable HA queue");
+          logger.debug("Creating a {} subscription queue for {}",
+              createDurableQueue ? "durable" : "non-durable",
+              proxy.getProxyID());
-            LocalizedStrings.CacheClientProxy_EXCEPTION_OCCURRED_WHILE_TRYING_TO_CREATE_A_MESSAGE_QUEUE
-                .toLocalizedString(),
+            "Exception occurred while trying to create a message queue.",
-                logger.warn(LocalizedMessage
-                    .create(LocalizedStrings.CacheClientProxy_0_SLEEP_INTERRUPTED, this));
+                logger.warn("{}: sleep interrupted.", this);
-                logger.warn(LocalizedMessage.create(
-                    LocalizedStrings.CacheClientProxy_0_PROXY_CLOSING_DUE_TO_UNEXPECTED_BROKEN_PIPE_ON_SOCKET_CONNECTION,
-                    this));
+                logger.warn("{}: Proxy closing due to unexpected broken pipe on socket connection.",
+                    this);
-                logger.warn(LocalizedMessage.create(
-                    LocalizedStrings.CacheClientProxy_0_PROXY_CLOSING_DUE_TO_UNEXPECTED_RESET_ON_SOCKET_CONNECTION,
-                    this));
+                logger.warn("{}: Proxy closing due to unexpected reset on socket connection.",
+                    this);
-                logger.warn(LocalizedMessage.create(
-                    LocalizedStrings.CacheClientProxy_0_PROXY_CLOSING_DUE_TO_UNEXPECTED_RESET_BY_PEER_ON_SOCKET_CONNECTION,
-                    this));
+                logger.warn(
+                    "{}: Proxy closing due to unexpected reset by peer on socket connection.",
+                    this);
-                logger.info(LocalizedMessage.create(
-                    LocalizedStrings.CacheClientProxy_0_PROXY_CLOSING_DUE_TO_SOCKET_BEING_CLOSED_LOCALLY,
-                    this));
+                logger.info("{}: Proxy closing due to socket being closed locally.",
+                    this);
-                logger.warn(LocalizedMessage.create(
-                    LocalizedStrings.CacheClientProxy_0_AN_UNEXPECTED_IOEXCEPTION_OCCURRED_SO_THE_PROXY_WILL_BE_CLOSED,
-                    this), e);
+                logger.warn(String.format(
+                    "%s: An unexpected IOException occurred so the proxy will be closed.",
+                    this),
+                    e);
-            logger.fatal(
-                LocalizedMessage.create(
-                    LocalizedStrings.CacheClientProxy_0__AN_UNEXPECTED_EXCEPTION_OCCURRED, this),
+            logger.fatal(String.format("%s : An unexpected Exception occurred", this),
-          StringId extraMsg = null;
+          String extraMsg = null;
-            extraMsg = LocalizedStrings.CacheClientProxy_PROBLEM_CAUSED_BY_BROKEN_PIPE_ON_SOCKET;
+            extraMsg = "Problem caused by broken pipe on socket.";
-                LocalizedStrings.CacheClientProxy_PROBLEM_CAUSED_BY_MESSAGE_QUEUE_BEING_CLOSED;
+                "Problem caused by message queue being closed.";
-            logger.info(LocalizedMessage.create(
-                LocalizedStrings.CacheClientProxy_0_POSSIBILITY_OF_NOT_BEING_ABLE_TO_SEND_SOME_OR_ALL_THE_MESSAGES_TO_CLIENTS_TOTAL_MESSAGES_CURRENTLY_PRESENT_IN_THE_LIST_1,
-                msgArgs));
+            logger.info(
+                String.format(
+                    "%s Possibility of not being able to send some or all of the messages to clients. Total messages currently present in the list %s.",
+                    msgArgs));
-            logger.info(LocalizedMessage.create(
-                LocalizedStrings.CacheClientProxy_0_POSSIBILITY_OF_NOT_BEING_ABLE_TO_SEND_SOME_OR_ALL_THE_MESSAGES_TO_CLIENTS_TOTAL_MESSAGES_CURRENTLY_PRESENT_IN_THE_LIST_1,
-                msgArgs), ignore);
+            logger.info(String.format(
+                "%s Possibility of not being able to send some or all of the messages to clients. Total messages currently present in the list %s.",
+                msgArgs),
+                ignore);
-          logger.fatal(LocalizedMessage.create(
-              LocalizedStrings.CacheClientProxy_0_EXCEPTION_OCCURRED_WHILE_ATTEMPTING_TO_ADD_MESSAGE_TO_QUEUE,
-              this), e);
+          logger.fatal(
+              String.format("%s: Exception occurred while attempting to add message to queue",
+                  this),
+              e);
-          logger.fatal(LocalizedMessage.create(
-              LocalizedStrings.CacheClientProxy_0__EXCEPTION_OCCURRED_WHILE_ATTEMPTING_TO_ADD_MESSAGE_TO_QUEUE,
-              this), e);
+          logger.fatal(
+              String.format("%s : Exception occurred while attempting to add message to queue",
+                  this),
+              e);
-            logger.fatal(
-                LocalizedMessage.create(
-                    LocalizedStrings.CacheClientProxy_0__AN_UNEXPECTED_EXCEPTION_OCCURRED, this),
+            logger.fatal(String.format("%s : An unexpected Exception occurred", this),
-          logger.fatal(LocalizedMessage.create(
-              LocalizedStrings.CacheClientProxy_0__AN_UNEXPECTED_EXCEPTION_OCCURRED, this), e);
+          logger.fatal(String.format("%s : An unexpected Exception occurred", this), e);
-        logger.info(
-            LocalizedMessage.create(LocalizedStrings.CacheClientProxy_0__PAUSING_PROCESSING, this));
+        logger.info("{} : Pausing processing", this);
-      logger.info(
-          LocalizedMessage.create(LocalizedStrings.CacheClientProxy_0__RESUMING_PROCESSING, this));
+      logger.info("{} : Resuming processing", this);
