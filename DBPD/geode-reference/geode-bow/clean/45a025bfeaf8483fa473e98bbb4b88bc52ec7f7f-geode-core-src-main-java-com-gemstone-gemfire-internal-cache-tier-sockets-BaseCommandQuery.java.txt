Merge branch 'develop' into feature/GEODE-420

# Conflicts:
#	geode-assembly/src/test/java/com/gemstone/gemfire/rest/internal/web/controllers/RestAPIsWithSSLDUnitTest.java
#	geode-core/src/main/java/com/gemstone/gemfire/distributed/internal/DistributionConfig.java
#	geode-core/src/main/java/com/gemstone/gemfire/distributed/internal/membership/gms/GMSUtil.java
#	geode-core/src/main/java/com/gemstone/gemfire/internal/cache/tier/sockets/AcceptorImpl.java
#	geode-core/src/main/java/com/gemstone/gemfire/management/internal/ManagementAgent.java
#	geode-core/src/main/java/org/apache/geode/redis/GeodeRedisServer.java
#	geode-core/src/test/java/com/gemstone/gemfire/distributed/LocatorDUnitTest.java

-import com.gemstone.gemfire.internal.security.GeodeSecurityUtil;
-  protected static boolean processQuery(Message msg, Query query,
+  protected boolean processQuery(Message msg, Query query,
-  protected static boolean processQueryUsingParams(Message msg, Query query,
+  protected boolean processQueryUsingParams(Message msg, Query query,
-        GeodeSecurityUtil.authorizeRegionRead(regionName.toString());
+        this.securityService.authorizeRegionRead(regionName.toString());
-        // post process, iterate through the result for post processing
-        if(GeodeSecurityUtil.needPostProcess()) {
-          List list = selectResults.asList();
-          for (Iterator<Object> valItr = list.iterator(); valItr.hasNext(); ) {
-            Object value = valItr.next();
-            if (value == null)
-              continue;
-
-            if (value instanceof CqEntry) {
-              CqEntry cqEntry = (CqEntry) value;
-              Object cqNewValue = GeodeSecurityUtil.postProcess(null, cqEntry.getKey(), cqEntry.getValue());
-              if (!cqEntry.getValue().equals(cqNewValue)) {
-                selectResults.remove(value);
-                selectResults.add(new CqEntry(cqEntry.getKey(), cqNewValue));
-              }
-            } else {
-              Object newValue = GeodeSecurityUtil.postProcess(null, null, value);
-              if (!value.equals(newValue)) {
-                selectResults.remove(value);
-                selectResults.add(newValue);
-              }
-            }
-          }
-        }
-
-        
+
-     
+
-        
+
-          
+
-            collectionType = new CollectionTypeImpl(Collection.class, 
+            collectionType = new CollectionTypeImpl(Collection.class,
-            isStructs = collectionType.getElementType().isStructType();              
+            isStructs = collectionType.getElementType().isStructType();
- 
+
-        
+
-        
+
-        
+
-      // resetting the flag may cause inconsistency. 
+      // resetting the flag may cause inconsistency.
-  
-  private static boolean sendCqResultsWithKey(ServerConnection servConn) {
+
+  private boolean sendCqResultsWithKey(ServerConnection servConn) {
-  protected static void sendCqResponse(int msgType, String msgStr, int txId,
+  protected void sendCqResponse(int msgType, String msgStr, int txId,
-  
-  private static void sendResultsAsObjectArray(SelectResults selectResults,
+
+  private void sendResultsAsObjectArray(SelectResults selectResults,
-          }    
+          }
-  
+
-          }      
+          }
-        
+
-  private static void sendResultsAsObjectPartList(int numberOfChunks,
+  private void sendResultsAsObjectPartList(int numberOfChunks,
-          }    
+          }
+
-  
+
-          }      
+          }
-      
+
-  
-  private static void addToObjectPartList(ObjectPartList serializedObjs,
+
+  private void addToObjectPartList(ObjectPartList serializedObjs,
-
-        if (value instanceof CachedDeserializable) {
-          serializedValueObjs.addPart(null,
-              ((CachedDeserializable) value).getSerializedValue(),
-              ObjectPartList.OBJECT, null);
-        } else {
-          addDeSerializedObjectToObjectPartList(serializedValueObjs, value);
-        }
+        addObjectToPartList(serializedValueObjs, null, value);
-      for (Object value : values) {
-        if (value instanceof CachedDeserializable) {
-          serializedValueObjs.addPart(null,
-              ((CachedDeserializable) value).getSerializedValue(),
-              ObjectPartList.OBJECT, null);
-        } else {
-          addDeSerializedObjectToObjectPartList(serializedValueObjs, value);
-        }
+      for(int i=0; i<values.length; i+=2) {
+        Object key = values[i];
+        Object value = values[i+1];
+        addObjectToPartList(serializedValueObjs, key, value);
-    } else if (res instanceof CachedDeserializable) {
-      serializedObjs.addPart(null,
-          ((CachedDeserializable) res).getSerializedValue(),
-          ObjectPartList.OBJECT, null);
-    } else { // for deserialized objects
-      addDeSerializedObjectToObjectPartList(serializedObjs, res);
+    } else { //for deserialized objects
+      addObjectToPartList(serializedObjs, null, res);
-  
-  private static void addDeSerializedObjectToObjectPartList(
-      ObjectPartList objPartList, Object obj) {
-    if (obj instanceof byte[]) {
-      objPartList.addPart(null, obj, ObjectPartList.BYTES, null);
-    } else {
-      objPartList.addPart(null, obj, ObjectPartList.OBJECT, null);
+
+  private void addObjectToPartList(ObjectPartList objPartList, Object key, Object value) {
+    Object object = value;
+    boolean isObject = true;
+    if (value instanceof CachedDeserializable) {
+      object = ((CachedDeserializable)value).getSerializedValue();
+    else if(value instanceof byte[]){
+      isObject = false;
+    }
+
+    object = this.securityService.postProcess(null, key, object, isObject);
+    if(key!=null){
+      objPartList.addPart(null, key, ObjectPartList.OBJECT, null);
+    }
+    objPartList.addPart(null, object, isObject?ObjectPartList.OBJECT:ObjectPartList.BYTES, null);
