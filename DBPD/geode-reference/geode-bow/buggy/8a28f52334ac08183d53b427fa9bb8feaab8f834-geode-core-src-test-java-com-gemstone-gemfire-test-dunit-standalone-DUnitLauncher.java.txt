GEODE-1600: startLocatorAndDS takes 0 as port number parameter

        * Use of getAvailableTCP port led to race conditions which led to locators being assigned ports in use.
        * Use of 0 now assignes a port number to the locator after the server is started.
        * Code modification to accept 0 as a valid port number until a real port number is assigned after the server is started.
	This closes #202

-    locatorPort = AvailablePortHelper.getRandomAvailableTCPPort();
-     
-    
+
+
-    
+
+    //wait for the VM to start up
+    if(!processManager.waitForVMs(STARTUP_TIMEOUT)) {
+      throw new RuntimeException("VMs did not start up with 30 seconds");
+    }
+
+    locatorPort = startLocator(registry);
+
+    init(master);
+
+
-    
+
-    
+
-    init(master);
-    
-    startLocator(registry);
-  private static void startLocator(Registry registry) throws IOException, NotBoundException {
+  private static int startLocator(Registry registry) throws IOException, NotBoundException {
-          Locator.startLocatorAndDS(locatorPort, locatorLogFile, p);
+          Locator.startLocatorAndDS(0, locatorLogFile, p);
+          InternalLocator internalLocator = (InternalLocator) Locator.getLocator();
+          locatorPort = internalLocator.getPort();
+          internalLocator.resetInternalLocatorFileNamesWithCorrectPortNumber(locatorPort);
-        
-        return null;
+
+        return locatorPort;
+    return (Integer) result.getResult();
