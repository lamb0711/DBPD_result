GEODE-6108: Handle client putIfAbsent returns value due to retry (#2925)

* GEODE-6108: Handle client putIfAbsent returns value due to retry

 * Check putIfAbsent return value from server if it could caused by retry.
 * Make sure client putIfAbsent operation message.isRetry is set if it retries after failed when using singleHop


-            if (result != null) {
-              // customers don't see this exception
-              throw new EntryNotFoundException("entry existed for putIfAbsent");
-            }
+            checkPutIfAbsentResult(event, value, result);
+  void checkPutIfAbsentResult(EntryEventImpl event, Object value, Object result) {
+    if (result != null) {
+      // we may see a non null result possibly due to retry
+      if (event.hasRetried() && putIfAbsentResultHasSameValue(value, result)) {
+        if (logger.isDebugEnabled()) {
+          logger.debug("retried putIfAbsent and result is the value to be put,"
+              + " treat as a successful putIfAbsent");
+        }
+      } else {
+        // customers don't see this exception
+        throw new EntryNotFoundException("entry existed for putIfAbsent");
+      }
+    }
+  }
+
+  boolean putIfAbsentResultHasSameValue(Object value, Object result) {
+    if (Token.isInvalid(result)) {
+      return value == null;
+    }
+    return result.equals(value);
+  }
+
