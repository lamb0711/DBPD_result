GEODE-2267: enable gfsh to download file from http connection (GEODE-2418)

-import static org.apache.geode.management.internal.cli.multistep.CLIMultiStepHelper.*;
-
-import java.lang.reflect.Method;
-import java.util.Map;
+import static org.apache.geode.management.internal.cli.multistep.CLIMultiStepHelper.execCLISteps;
-
+import java.lang.reflect.Method;
+import java.nio.file.Path;
+import java.util.Map;
+
+
+    } catch (Exception e) {
+      shell.logSevere(e.getMessage(), e);
-    if (logWrapper.fineEnabled()) {
-      logWrapper.fine("Received response :: " + response);
-    }
-    CommandResponse commandResponse =
-        CommandResponseBuilder.prepareCommandResponseFromJson((String) response);
+    // the response could be a string which is a json respresentation of the CommandResult object
+    // it can also be a Path to a temp file downloaded from the rest http request
+    if (response instanceof String) {
+      CommandResponse commandResponse =
+          CommandResponseBuilder.prepareCommandResponseFromJson((String) response);
-    if (commandResponse.isFailedToPersist()) {
-      shell.printAsSevere(CliStrings.SHARED_CONFIGURATION_FAILED_TO_PERSIST_COMMAND_CHANGES);
-      logWrapper.severe(CliStrings.SHARED_CONFIGURATION_FAILED_TO_PERSIST_COMMAND_CHANGES);
+      if (commandResponse.isFailedToPersist()) {
+        shell.printAsSevere(CliStrings.SHARED_CONFIGURATION_FAILED_TO_PERSIST_COMMAND_CHANGES);
+        logWrapper.severe(CliStrings.SHARED_CONFIGURATION_FAILED_TO_PERSIST_COMMAND_CHANGES);
+      }
+
+      String debugInfo = commandResponse.getDebugInfo();
+      if (debugInfo != null && !debugInfo.trim().isEmpty()) {
+        // TODO - Abhishek When debug is ON, log response in gfsh logs
+        // TODO - Abhishek handle \n better. Is it coming from GemFire formatter
+        debugInfo = debugInfo.replaceAll("\n\n\n", "\n");
+        debugInfo = debugInfo.replaceAll("\n\n", "\n");
+        debugInfo =
+            debugInfo.replaceAll("\n", "\n[From Manager : " + commandResponse.getSender() + "]");
+        debugInfo = "[From Manager : " + commandResponse.getSender() + "]" + debugInfo;
+        LogWrapper.getInstance().info(debugInfo);
+      }
+      commandResult = ResultBuilder.fromJson((String) response);
-    String debugInfo = commandResponse.getDebugInfo();
-    if (debugInfo != null && !debugInfo.trim().isEmpty()) {
-      // TODO - Abhishek When debug is ON, log response in gfsh logs
-      // TODO - Abhishek handle \n better. Is it coming from GemFire formatter
-      debugInfo = debugInfo.replaceAll("\n\n\n", "\n");
-      debugInfo = debugInfo.replaceAll("\n\n", "\n");
-      debugInfo =
-          debugInfo.replaceAll("\n", "\n[From Manager : " + commandResponse.getSender() + "]");
-      debugInfo = "[From Manager : " + commandResponse.getSender() + "]" + debugInfo;
-      LogWrapper.getInstance().info(debugInfo);
+    Path tempFile = null;
+    if (response instanceof Path) {
+      tempFile = (Path) response;
-    commandResult = ResultBuilder.fromJson((String) response);
-      Result postExecResult = interceptor.postExecution(parseResult, commandResult);
+      Result postExecResult = interceptor.postExecution(parseResult, commandResult, tempFile);
