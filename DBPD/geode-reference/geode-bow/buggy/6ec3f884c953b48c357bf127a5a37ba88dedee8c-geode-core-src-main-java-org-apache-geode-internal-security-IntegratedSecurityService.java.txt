GEODE-2030: security support for SDG

+import org.apache.shiro.UnavailableSecurityManagerException;
-  private boolean isIntegratedSecurity;
+  private Boolean isIntegratedSecurity;
-    if (!isIntegratedSecurity) {
+    if (!isIntegratedSecurity()) {
-    if (!isIntegratedSecurity) {
+    if (!isIntegratedSecurity()) {
-    String securityConfig = securityProps.getProperty(SECURITY_MANAGER);
+    String securityManagerConfig = securityProps.getProperty(SECURITY_MANAGER);
+      isClientAuthenticator = false;
+      isPeerAuthenticator = false;
-    else if (!StringUtils.isBlank(securityConfig)) {
-      securityManager =
-          SecurityService.getObjectOfTypeFromClassName(securityConfig, SecurityManager.class);
+    else if (!StringUtils.isBlank(securityManagerConfig)) {
+      SecurityManager securityManager = SecurityService
+          .getObjectOfTypeFromClassName(securityManagerConfig, SecurityManager.class);
-      Realm realm = new CustomAuthRealm(securityManager);
-      org.apache.shiro.mgt.SecurityManager shiroManager = new DefaultSecurityManager(realm);
-      SecurityUtils.setSecurityManager(shiroManager);
-      isIntegratedSecurity = true;
+      this.setSecurityManager(securityManager);
-      isIntegratedSecurity = false;
+      isIntegratedSecurity = null;
-    isIntegratedSecurity = false;
+    SecurityUtils.setSecurityManager(null);
+    isIntegratedSecurity = null;
-    return (isIntegratedSecurity && postProcessor != null);
+    return (isIntegratedSecurity() && postProcessor != null);
+  public void setSecurityManager(SecurityManager securityManager) {
+    if (securityManager == null) {
+      return;
+    }
+
+    this.securityManager = securityManager;
+    Realm realm = new CustomAuthRealm(securityManager);
+    org.apache.shiro.mgt.SecurityManager shiroManager = new DefaultSecurityManager(realm);
+    SecurityUtils.setSecurityManager(shiroManager);
+    isIntegratedSecurity = true;
+    isClientAuthenticator = false;
+    isPeerAuthenticator = false;
+  }
+
+  public void setPostProcessor(PostProcessor postProcessor) {
+    if (postProcessor == null) {
+      return;
+    }
+
+    this.postProcessor = postProcessor;
+  }
+
+  /**
+   * If Shiro's security manager is configured, then return true, otherwise, return false;
+   * 
+   * @return
+   */
+    if (isIntegratedSecurity != null) {
+      return isIntegratedSecurity;
+    }
+
+    try {
+      isIntegratedSecurity = (SecurityUtils.getSecurityManager() != null);
+    } catch (UnavailableSecurityManagerException e) {
+      isIntegratedSecurity = false;
+    }
-    return isClientAuthenticator || isIntegratedSecurity;
+    return isClientAuthenticator || isIntegratedSecurity();
-    return isPeerAuthenticator || isIntegratedSecurity;
+    return isPeerAuthenticator || isIntegratedSecurity();
