GEODE-17: Shiro Integration

GEODE-17: associate async request with correct shiro user

GEODE-17

GEODE-17: fix shiro dependency

-import java.util.Properties;
+import java.util.concurrent.Callable;
-import com.gemstone.gemfire.management.internal.security.MBeanServerWrapper;
+import com.gemstone.gemfire.security.ShiroUtil;
-      MBeanServerWrapper wrapper = service.getManagementAgent().getMBeanServerWrapper();
-      MBeanServer wrappedMbs = mbs;
-      if(wrapper!=null) {
-        wrapper.setMBeanServer(mbs);
-        wrappedMbs = wrapper;
-      }
-      final DistributedSystemMXBean distributedSystemMXBean = JMX.newMXBeanProxy(wrappedMbs,
+      final DistributedSystemMXBean distributedSystemMXBean = JMX.newMXBeanProxy(mbs,
-      managingMemberMXBeanProxy = createMemberMXBeanForManagerUsingProxy(wrappedMbs,
+      managingMemberMXBeanProxy = createMemberMXBeanForManagerUsingProxy(mbs,
-
-  protected String processCommandWithCredentials(final String command, Properties credentials) {
-    if (credentials != null) {
-      EnvironmentVariablesHandlerInterceptor.CREDENTIALS.set(credentials);
-    }
-    return processCommand(command, getEnvironment(), null);
+  protected Callable<ResponseEntity<String>> getProcessCommandCallable(final String command){
+    return getProcessCommandCallable(command, null);
+  protected Callable<ResponseEntity<String>> getProcessCommandCallable(final String command, final byte[][] fileData){
+    Callable callable = new Callable<ResponseEntity<String>>() {
+      @Override public ResponseEntity<String> call() throws Exception {
+        return new ResponseEntity<String>(processCommand(command, fileData), HttpStatus.OK);
+      }
+    };
+    return ShiroUtil.associateWith(callable);
+  }
+
+
-  protected String processCommandWithCredentials(final String command, final byte[][] fileData, Properties credentials) {
-    if (credentials != null) {
-      EnvironmentVariablesHandlerInterceptor.CREDENTIALS.set(credentials);
-    }
-    return processCommand(command, getEnvironment(), fileData);
-  }
-
