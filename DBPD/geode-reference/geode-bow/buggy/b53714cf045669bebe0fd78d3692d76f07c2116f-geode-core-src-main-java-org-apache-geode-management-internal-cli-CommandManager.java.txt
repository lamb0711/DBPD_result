GEODE-4735: get rid of Cache.getInstance call from CliUtils and GfshCâ€¦ (#1551)

* GEODE-4735: get rid of Cache.getInstance call from CliUtils and GfshCommand

* all functions in CliUtils take cache as a parameter if needs one.
* InternalCache is injected to the command when the command is initialized.
-import java.util.Iterator;
-import java.util.ServiceConfigurationError;
-import org.apache.geode.cache.Cache;
+import org.apache.geode.internal.cache.InternalCache;
+  private InternalCache cache;
-  public CommandManager(final Properties cacheProperties, Cache cache) {
+  public CommandManager(final Properties cacheProperties, InternalCache cache) {
+    this.cache = cache;
-    final Iterator<CommandMarker> iterator = ServiceLoader
-        .load(CommandMarker.class, ClassPathLoader.getLatest().asClassLoader()).iterator();
-    while (iterator.hasNext()) {
-      try {
-        final CommandMarker commandMarker = iterator.next();
+    ServiceLoader<CommandMarker> loader =
+        ServiceLoader.load(CommandMarker.class, ClassPathLoader.getLatest().asClassLoader());
+    try {
+      loader.forEach(commandMarker -> {
-      } catch (ServiceConfigurationError e) {
-        logWrapper.severe("Could not load Command: " + e.getLocalizedMessage(), e); // continue
-      }
+      });
+    } catch (Throwable th) {
+      logWrapper.severe("Could not load plugin commands in the latest classLoader.", th);
+    // inject the cache into the commands
+    if (GfshCommand.class.isAssignableFrom(commandMarker.getClass())) {
+      ((GfshCommand) commandMarker).setCache(cache);
+    }
+
+    // inject the commandManager into the commands
