GEODE-17: Shiro Integration

GEODE-17: associate async request with correct shiro user

GEODE-17

GEODE-17: fix shiro dependency

+import com.gemstone.gemfire.management.internal.cli.result.ErrorResultData;
+import com.gemstone.gemfire.management.internal.cli.result.ResultBuilder;
-    final CommandStringBuilder command = new CommandStringBuilder(CliStrings.CONNECT);
-    command.addOption(CliStrings.CONNECT__USERNAME, config.user());
-    command.addOption(CliStrings.CONNECT__PASSWORD, config.password());
+    final CommandStringBuilder connectCommand = new CommandStringBuilder(CliStrings.CONNECT);
+    connectCommand.addOption(CliStrings.CONNECT__USERNAME, config.user());
+    connectCommand.addOption(CliStrings.CONNECT__PASSWORD, config.password());
-      command.addOption(CliStrings.CONNECT__USE_HTTP, Boolean.TRUE.toString());
-      command.addOption(CliStrings.CONNECT__URL, endpoint);
+      connectCommand.addOption(CliStrings.CONNECT__USE_HTTP, Boolean.TRUE.toString());
+      connectCommand.addOption(CliStrings.CONNECT__URL, endpoint);
-      command.addOption(CliStrings.CONNECT__JMX_MANAGER, endpoint);
+      connectCommand.addOption(CliStrings.CONNECT__JMX_MANAGER, endpoint);
-    gfsh.executeCommand(command.toString());
+    gfsh.executeCommand(connectCommand.toString());
-
-    String message = result.getContent().toString();
-    if(message.contains("Authentication Failed Wrong username/password") ||
-        message.contains("The HTTP request failed with: 403 - Access Denied")){
-      this.authenticated = false;
+    if(result.getResultData() instanceof ErrorResultData) {
+      ErrorResultData errorResultData = (ErrorResultData) result.getResultData();
+      this.authenticated = !(errorResultData.getErrorCode() == ResultBuilder.ERRORCODE_CONNECTION_ERROR);
+      gfsh.executeCommand("disconnect");
