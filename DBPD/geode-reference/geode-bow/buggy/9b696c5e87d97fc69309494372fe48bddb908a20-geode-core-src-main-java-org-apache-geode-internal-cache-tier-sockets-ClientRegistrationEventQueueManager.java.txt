GEODE-6741: Copy off-heap to heap for client registration queue (#3553)



+import org.apache.geode.internal.cache.EntryEventImpl;
+          // If the event value is off-heap, copy it to heap so we are guaranteed the value
+          // is available when we drain the registration queue
+          copyOffHeapToHeapForRegistrationQueue(event);
+
+  /**
+   * For simplicity, we will copy off-heap registration queue values to heap to avoid
+   * complicated off-heap reference counting. Since the registration queue is only a
+   * temporary construct during client registration, the overhead should not be significant.
+   *
+   * @param event The InternalCacheEvent whose value will be copied to the heap if need be
+   */
+  private void copyOffHeapToHeapForRegistrationQueue(final InternalCacheEvent event) {
+    if (event.getOperation().isEntry()) {
+      EntryEventImpl entryEvent = ((EntryEventImpl) event);
+      entryEvent.copyOffHeapToHeap();
+    }
+  }
+
