GEODE-2632: use immutable SecurityService impls to improve performance

* misc code clean up in classes touched by changes
* new unit tests for SecurityService

- *
- *
+import org.apache.geode.internal.security.SecurityService;
+import org.apache.geode.internal.security.SecurityServiceFactory;
+import org.apache.geode.internal.security.shiro.CustomAuthRealm;
+import org.apache.geode.internal.security.shiro.JMXShiroAuthenticator;
+import org.apache.geode.management.internal.security.AccessControlMBean;
+import org.apache.geode.management.internal.security.MBeanServerWrapper;
+import org.apache.geode.management.internal.security.ResourceConstants;
+import org.apache.geode.security.TestSecurityManager;
+import org.apache.geode.tools.pulse.internal.data.PulseConstants;
+import org.apache.shiro.SecurityUtils;
+import org.apache.shiro.mgt.DefaultSecurityManager;
+import org.apache.shiro.mgt.SecurityManager;
+import org.apache.shiro.realm.Realm;
+
+import java.rmi.registry.LocateRegistry;
-
-import org.apache.geode.tools.pulse.internal.data.PulseConstants;
-import org.apache.geode.security.TestSecurityManager;
-import org.apache.shiro.SecurityUtils;
-import org.apache.shiro.mgt.DefaultSecurityManager;
-import org.apache.shiro.mgt.SecurityManager;
-import org.apache.shiro.realm.Realm;
-
-import org.apache.geode.internal.security.shiro.CustomAuthRealm;
-import org.apache.geode.internal.security.shiro.JMXShiroAuthenticator;
-import org.apache.geode.management.internal.security.AccessControlMBean;
-import org.apache.geode.management.internal.security.MBeanServerWrapper;
-import org.apache.geode.management.internal.security.ResourceConstants;
-
-      AccessControlMBean acc = new AccessControlMBean();
+      AccessControlMBean acc = new AccessControlMBean(SecurityServiceFactory.create());
+      SecurityService securityService =
+          SecurityServiceFactory.create(securityProperties, new TestSecurityManager(), null);
+      securityService.initSecurity(securityProperties);
+
-      JMXShiroAuthenticator interceptor = new JMXShiroAuthenticator();
+      JMXShiroAuthenticator interceptor = new JMXShiroAuthenticator(securityService);
-      cs.setMBeanServerForwarder(new MBeanServerWrapper());
+      cs.setMBeanServerForwarder(new MBeanServerWrapper(securityService));
-      java.rmi.registry.LocateRegistry.createRegistry(jmxPort);
+      LocateRegistry.createRegistry(jmxPort);
