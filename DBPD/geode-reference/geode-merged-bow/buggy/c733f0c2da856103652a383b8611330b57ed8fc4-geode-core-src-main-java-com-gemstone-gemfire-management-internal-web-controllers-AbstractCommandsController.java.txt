GEODE-17: Shiro Integration

GEODE-17: associate async request with correct shiro user

GEODE-17

GEODE-17: fix shiro dependency

-import java.util.Properties;
+import java.util.concurrent.Callable;
-import com.gemstone.gemfire.management.internal.security.MBeanServerWrapper;
+import com.gemstone.gemfire.security.ShiroUtil;
-      MBeanServerWrapper wrapper = service.getManagementAgent().getMBeanServerWrapper();
-      MBeanServer wrappedMbs = mbs;
-      if(wrapper!=null) {
-        wrapper.setMBeanServer(mbs);
-        wrappedMbs = wrapper;
-      }
-      final DistributedSystemMXBean distributedSystemMXBean = JMX.newMXBeanProxy(wrappedMbs,
+      final DistributedSystemMXBean distributedSystemMXBean = JMX.newMXBeanProxy(mbs,
-      managingMemberMXBeanProxy = createMemberMXBeanForManagerUsingProxy(wrappedMbs,
+      managingMemberMXBeanProxy = createMemberMXBeanForManagerUsingProxy(mbs,
-
-  protected String processCommandWithCredentials(final String command, Properties credentials) {
-    if (credentials != null) {
-      EnvironmentVariablesHandlerInterceptor.CREDENTIALS.set(credentials);
-    }
-    return processCommand(command, getEnvironment(), null);
+  protected Callable<ResponseEntity<String>> getProcessCommandCallable(final String command){
+    return getProcessCommandCallable(command, null);
+  protected Callable<ResponseEntity<String>> getProcessCommandCallable(final String command, final byte[][] fileData){
+    Callable callable = new Callable<ResponseEntity<String>>() {
+      @Override public ResponseEntity<String> call() throws Exception {
+        return new ResponseEntity<String>(processCommand(command, fileData), HttpStatus.OK);
+      }
+    };
+    return ShiroUtil.associateWith(callable);
+  }
+
+
-  protected String processCommandWithCredentials(final String command, final byte[][] fileData, Properties credentials) {
-    if (credentials != null) {
-      EnvironmentVariablesHandlerInterceptor.CREDENTIALS.set(credentials);
-    }
-    return processCommand(command, getEnvironment(), fileData);
-  }
-

MOV26 MOV26 MOV31 UPD40 UPD40 INS74 INS42 INS8 INS74 INS42 INS43 INS74 MOV41 INS43 INS74 INS60 INS41 UPD42 MOV42 INS43 INS43 INS42 INS43 MOV43 INS43 INS59 INS32 INS42 INS42 UPD42 UPD42 MOV42 INS42 INS42 INS14 INS42 INS42 INS42 INS74 INS1 INS43 INS74 INS31 UPD42 UPD42 INS42 INS43 INS43 INS78 INS83 INS74 INS42 INS43 INS8 INS42 INS42 INS42 INS43 INS43 INS42 MOV41 INS42 INS42 INS14 INS74 INS32 INS40 INS43 MOV43 MOV42 MOV42 MOV42 INS42 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL42 DEL32 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL59 DEL60 DEL42 DEL33 DEL27 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL7 DEL21 DEL8 DEL25 DEL42 DEL42 DEL32 DEL43 DEL42 DEL44 DEL42 DEL33 DEL27 DEL40 DEL42 DEL42 DEL32 DEL21 DEL8 DEL25 DEL8 DEL42 DEL43 DEL42 DEL44 DEL42 DEL32 DEL32 DEL42 DEL33 DEL27 DEL40 DEL42 DEL42 DEL32 DEL21 DEL8 DEL25