GEODE-4735: get rid of Cache.getInstance call from CliUtils and GfshCâ€¦ (#1551)

* GEODE-4735: get rid of Cache.getInstance call from CliUtils and GfshCommand

* all functions in CliUtils take cache as a parameter if needs one.
* InternalCache is injected to the command when the command is initialized.
-import java.util.Iterator;
-import java.util.ServiceConfigurationError;
-import org.apache.geode.cache.Cache;
+import org.apache.geode.internal.cache.InternalCache;
+  private InternalCache cache;
-  public CommandManager(final Properties cacheProperties, Cache cache) {
+  public CommandManager(final Properties cacheProperties, InternalCache cache) {
+    this.cache = cache;
-    final Iterator<CommandMarker> iterator = ServiceLoader
-        .load(CommandMarker.class, ClassPathLoader.getLatest().asClassLoader()).iterator();
-    while (iterator.hasNext()) {
-      try {
-        final CommandMarker commandMarker = iterator.next();
+    ServiceLoader<CommandMarker> loader =
+        ServiceLoader.load(CommandMarker.class, ClassPathLoader.getLatest().asClassLoader());
+    try {
+      loader.forEach(commandMarker -> {
-      } catch (ServiceConfigurationError e) {
-        logWrapper.severe("Could not load Command: " + e.getLocalizedMessage(), e); // continue
-      }
+      });
+    } catch (Throwable th) {
+      logWrapper.severe("Could not load plugin commands in the latest classLoader.", th);
+    // inject the cache into the commands
+    if (GfshCommand.class.isAssignableFrom(commandMarker.getClass())) {
+      ((GfshCommand) commandMarker).setCache(cache);
+    }
+
+    // inject the commandManager into the commands

MOV26 UPD40 INS23 INS83 INS43 INS59 MOV8 INS42 INS42 UPD43 INS21 MOV60 INS25 UPD42 INS7 UPD74 INS8 INS32 INS8 INS22 INS42 UPD43 UPD42 MOV32 INS21 INS57 INS42 INS32 INS21 INS52 INS42 UPD42 INS32 UPD43 UPD42 INS43 INS42 INS42 INS32 INS42 INS42 INS86 UPD42 INS42 INS36 INS42 INS42 INS59 MOV8 INS45 UPD42 MOV42 INS11 INS42 INS43 INS42 INS42 DEL40 DEL26 DEL40 DEL26 DEL83 DEL42 DEL32 DEL83 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL45 DEL42 DEL32 DEL27 DEL42 DEL42 DEL42 DEL32 DEL61 DEL8