GEODE-2282 Added ability to sort JSON fields while creating pdxtype.

One can enable this feature by setting java system property(
gemfire.pdx.mapper.sort-json-field-names=true. In this way geode will
not create multiple pdx type ids for JSON document, if different JSON
document has same fields in different order.

Added unit test for it.

updated

+import java.util.Properties;
+
+
+import org.apache.geode.distributed.internal.DistributionConfig;
+import org.apache.geode.pdx.internal.json.JSONToPdxMapper;
+import org.apache.geode.pdx.internal.json.PdxInstanceSortedHelper;
+  /***
+   * By setting "gemfire.sort-json-field-names" to true, enables serialization of JSON field in JSON
+   * document to be sorted. That can help to reduce the number of pdx typeId generation if different
+   * JSON documents have same fields in the different order.
+   */
+  public static final String SORT_JSON_FIELD_NAMES_PROPERTY =
+      DistributionConfig.GEMFIRE_PREFIX + "pdx.mapper.sort-json-field-names";
+
-  private PdxInstanceHelper getPdxInstance(JsonParser jp, states currentState,
-      PdxInstanceHelper currentPdxInstance) throws JsonParseException, IOException {
+  private static JSONToPdxMapper createJSONToPdxMapper(String className, JSONToPdxMapper parent) {
+    if (Boolean.getBoolean(SORT_JSON_FIELD_NAMES_PROPERTY)) {
+      return new PdxInstanceSortedHelper(className, parent);
+    } else {
+      return new PdxInstanceHelper(className, parent);
+    }
+  }
+
+  private JSONToPdxMapper getPdxInstance(JsonParser jp, states currentState,
+      JSONToPdxMapper currentPdxInstance) throws JsonParseException, IOException {
-      currentPdxInstance = new PdxInstanceHelper(null, null);// from getlist
+      currentPdxInstance = createJSONToPdxMapper(null, null);// from getlist
-          PdxInstanceHelper tmp = new PdxInstanceHelper(currentFieldName, currentPdxInstance);
+          JSONToPdxMapper tmp = createJSONToPdxMapper(currentFieldName, currentPdxInstance);
-          PdxInstanceHelper tmp = currentPdxInstance;
+          JSONToPdxMapper tmp = currentPdxInstance;
-  private void setNumberField(JsonParser jp, PdxInstanceHelper pih, String fieldName)
+  private void setNumberField(JsonParser jp, JSONToPdxMapper pih, String fieldName)
-          PdxInstanceHelper tmp = getPdxInstance(jp, currentState, null);
+          JSONToPdxMapper tmp = getPdxInstance(jp, currentState, null);

INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS23 INS31 INS29 INS83 INS83 INS83 INS43 INS59 INS83 INS83 INS43 INS42 INS44 INS44 INS8 UPD43 INS65 INS42 INS42 INS27 INS42 INS43 INS42 INS43 INS42 INS25 UPD42 UPD43 UPD43 INS66 INS66 INS66 INS40 INS45 INS42 INS42 INS32 INS8 INS8 UPD42 UPD42 INS42 INS42 INS42 INS41 INS41 INS14 MOV14 INS32 INS43 INS42 INS42 INS42 INS42 INS42 INS33 INS33 INS42 UPD43 UPD43 UPD43 UPD42 INS32 UPD42 UPD42 INS42 INS42 INS42 DEL33 DEL33 DEL42 DEL43 DEL42 DEL42 DEL14