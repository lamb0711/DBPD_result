GEODE-4650: Refactor Elder selection (#2393)

GEODE-4650: Resolve race condition in selection of the elder

* no longer cache the elder, re-compute the elder when needed
* extract elder logic to a new class to make unit testing possible
* adds tests for elder selection
* adds tests of DLock Grantor failover
* removes isAdam() - isAdam used to mean that the member was alone (that there were no non-surprise, non-admin members in the cluster) when it joined. This was only used in two places. The first, in the DLockService, protected against recovering dlocks when there isn't a cluster. This usage is replaced with a check for isLoner(). The other use of isAdam was in ElderInitProcessor and was redundant with an inner check if there were other members in the distributed system.
* fix testFairness so that it can be run repeatedly in the same JVM 

Signed-off-by: Dan Smith <dsmith@pivotal.io>
Signed-off-by: Galen O'Sullivan <gosullivan@pivotal.io>
Signed-off-by: Ken Howe <khowe@pivotal.io>

-   * our vm. TODO: collaboration lock was removed
+   * our vm.
-  private static ElderState startElderCall(InternalDistributedSystem sys, DLockService dls,
-      boolean usesElderCollaborationLock) {
+  private static ElderState startElderCall(InternalDistributedSystem sys, DLockService dls) {
-        if (usesElderCollaborationLock) {
-          try {
-            es = dm.getElderState(false, true);
-          } catch (IllegalStateException e) {
-            // loop back around to reacquire Collaboration and try elder lock again
-            continue;
-          }
-        } else {
-          es = dm.getElderState(false, false);
+        try {
+          es = dm.getElderState(false);
+        } catch (IllegalStateException e) {
+          // loop back around to reacquire Collaboration and try elder lock again
+          continue;
-        final boolean usesElderCollaborationLock = opCode == GET_OP || opCode == BECOME_OP;
-        if (usesElderCollaborationLock) {
-          Assert.assertTrue(service != null,
-              "Attempting GrantorRequest without instance of DistributedLockService");
-        }
-        final ElderState es = startElderCall(system, service, usesElderCollaborationLock);
+        final ElderState es = startElderCall(system, service);
-      ElderState es = dm.getElderState(true, false);
+      ElderState es = dm.getElderState(true);

UPD66 MOV8 DEL39 DEL42 DEL44 DEL9 DEL42 DEL42 DEL42 DEL42 DEL9 DEL9 DEL32 DEL7 DEL21 DEL8 DEL25 DEL8 DEL83 DEL39 DEL42 DEL42 DEL42 DEL27 DEL42 DEL42 DEL27 DEL27 DEL59 DEL60 DEL42 DEL42 DEL42 DEL42 DEL33 DEL27 DEL45 DEL32 DEL21 DEL8 DEL25 DEL42 DEL9