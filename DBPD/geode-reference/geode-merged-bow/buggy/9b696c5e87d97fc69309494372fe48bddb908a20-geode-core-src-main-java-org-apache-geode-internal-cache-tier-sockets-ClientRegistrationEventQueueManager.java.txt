GEODE-6741: Copy off-heap to heap for client registration queue (#3553)



+import org.apache.geode.internal.cache.EntryEventImpl;
+          // If the event value is off-heap, copy it to heap so we are guaranteed the value
+          // is available when we drain the registration queue
+          copyOffHeapToHeapForRegistrationQueue(event);
+
+  /**
+   * For simplicity, we will copy off-heap registration queue values to heap to avoid
+   * complicated off-heap reference counting. Since the registration queue is only a
+   * temporary construct during client registration, the overhead should not be significant.
+   *
+   * @param event The InternalCacheEvent whose value will be copied to the heap if need be
+   */
+  private void copyOffHeapToHeapForRegistrationQueue(final InternalCacheEvent event) {
+    if (event.getOperation().isEntry()) {
+      EntryEventImpl entryEvent = ((EntryEventImpl) event);
+      entryEvent.copyOffHeapToHeap();
+    }
+  }
+

INS26 INS40 INS31 INS29 INS83 INS39 INS42 INS44 INS8 INS65 INS65 INS83 INS43 INS42 INS25 INS66 INS66 INS66 INS42 INS66 INS42 INS32 INS8 INS32 INS42 INS60 INS21 INS42 INS42 INS43 INS59 INS32 INS42 INS42 INS36 INS42 INS42 INS11 INS21 INS43 INS42 INS32 INS42 INS42 INS42