Revert "GEODE-6973: Use cachelistener to synchronize typeToId with IdToType râ€¦ (#3853)"

This reverts commit 181e3a4a

-import org.apache.geode.annotations.VisibleForTesting;
-          updateLocalMaps((PdxType) value);
+          updateClassToTypeMap((PdxType) value);
-
-      if (typeToId.isEmpty()) {
-        buildTypeToIdFromIdToType();
-      }
-      // double check if my type is in region in case the typeToId map has been updated while
-      // waiting to obtain a lock
-      existingId = typeToId.get(newType);
-      if (existingId != null) {
-        return existingId;
+      int id = getExistingIdForType(newType);
+      if (id != -1) {
+        return id;
-      int id = allocateTypeId(newType);
+      id = allocateTypeId(newType);
+
+
+      typeToId.put(newType, id);
+
-  private void buildTypeToIdFromIdToType() {
+  /** Should be called holding the dlock */
+  private int getExistingIdForType(PdxType newType) {
+      int result = -1;
-            if (totalPdxTypeIdInDS >= this.maxTypeId) {
-              throw new InternalGemFireError(
-                  "Used up all of the PDX type ids for this distributed system. The maximum number of PDX types is "
-                      + this.maxTypeId);
-            }
+          if (foundType.equals(newType)) {
+            result = foundType.getTypeId();
+          }
+      if (totalPdxTypeIdInDS == this.maxTypeId) {
+        throw new InternalGemFireError(
+            "Used up all of the PDX type ids for this distributed system. The maximum number of PDX types is "
+                + this.maxTypeId);
+      }
+      return result;
-  private void updateLocalMaps(PdxType type) {
+  private void updateClassToTypeMap(PdxType type) {
-      typeToId.put(type, type.getTypeId());
-
-  @VisibleForTesting
-  public int getTypeToIdSize() {
-    return typeToId.size();
-  }

INS29 UPD39 INS42 INS44 UPD42 INS65 INS43 INS42 INS66 INS42 INS60 INS21 INS21 INS60 MOV25 INS41 INS39 INS59 INS7 INS32 INS39 INS59 UPD27 INS42 INS42 INS32 UPD42 INS38 INS42 MOV32 INS42 INS42 INS42 INS42 INS42 INS38 UPD42 MOV42 MOV42 INS34 UPD42 INS34 INS25 INS32 INS8 INS42 INS42 INS42 INS21 INS7 UPD42 INS42 INS32 INS42 INS42 DEL40 DEL26 DEL42 DEL42 DEL32 DEL42 DEL32 DEL21 DEL8 DEL25 DEL42 DEL42 DEL32 DEL7 DEL21 DEL33 DEL39 DEL42 DEL59 DEL60 DEL42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21 DEL42 DEL78 DEL83 DEL39 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31