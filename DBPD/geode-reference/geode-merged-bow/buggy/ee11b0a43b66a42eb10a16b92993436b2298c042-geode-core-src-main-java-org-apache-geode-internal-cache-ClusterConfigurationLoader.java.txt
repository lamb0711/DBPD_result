GEODE-2705: Jars undeployed from cluster configuration will not be loaded from disk on member restart

+import static java.util.stream.Collectors.joining;
+import static java.util.stream.Collectors.toList;
+
+import java.util.stream.Stream;
+import org.apache.commons.lang.ArrayUtils;
+    logger.info("Requesting cluster configuration");
+    logger.info("Got response with jars: {}", Stream.of(jarFileNames).collect(joining(",")));
-      List<DeployedJar> deployedJars =
-          ClassPathLoader.getLatest().getJarDeployer().deploy(jarFileNames, jarBytes);
+      JarDeployer jarDeployer = ClassPathLoader.getLatest().getJarDeployer();
+      jarDeployer.suspendAll();
+      try {
+        List<String> extraJarsOnServer =
+            jarDeployer.findDeployedJars().stream().map(DeployedJar::getJarName)
+                .filter(jarName -> !ArrayUtils.contains(jarFileNames, jarName)).collect(toList());
-      deployedJars.stream().filter(Objects::nonNull)
-          .forEach((jar) -> logger.info("Deployed " + (jar.getFile().getAbsolutePath())));
+        for (String extraJar : extraJarsOnServer) {
+          logger.info("Removing jar not present in cluster configuration: {}", extraJar);
+          jarDeployer.deleteAllVersionsOfJar(extraJar);
+        }
+
+        List<DeployedJar> deployedJars = jarDeployer.deploy(jarFileNames, jarBytes);
+
+        deployedJars.stream().filter(Objects::nonNull)
+            .forEach((jar) -> logger.info("Deployed: {}", jar.getFile().getAbsolutePath()));
+      } finally {
+        jarDeployer.resumeAll();
+      }
-    // TODO: Jared - Does this need to actually undeploy extra jars like the javadoc says?

INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS21 INS21 INS32 INS32 INS42 INS42 INS45 INS42 INS42 INS45 INS32 INS21 INS54 INS32 INS42 INS32 INS43 INS32 INS8 INS8 INS42 INS42 INS42 INS42 INS45 INS42 UPD42 MOV32 INS42 INS42 INS60 INS70 INS60 MOV21 INS21 INS74 INS59 INS44 INS42 INS8 MOV74 INS59 INS32 INS43 INS43 INS42 INS32 INS43 INS42 INS21 INS21 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS32 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS86 INS42 INS42 INS42 INS45 INS42 INS42 INS42 INS42 INS45 MOV32 INS32 INS42 INS90 INS59 INS38 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL42 DEL32 DEL45 DEL36 DEL27