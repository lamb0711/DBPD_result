GEODE-1600: startLocatorAndDS takes 0 as port number parameter

        * Use of getAvailableTCP port led to race conditions which led to locators being assigned ports in use.
        * Use of 0 now assignes a port number to the locator after the server is started.
        * Code modification to accept 0 as a valid port number until a real port number is assigned after the server is started.
	This closes #202

-    locatorPort = AvailablePortHelper.getRandomAvailableTCPPort();
-     
-    
+
+
-    
+
+    //wait for the VM to start up
+    if(!processManager.waitForVMs(STARTUP_TIMEOUT)) {
+      throw new RuntimeException("VMs did not start up with 30 seconds");
+    }
+
+    locatorPort = startLocator(registry);
+
+    init(master);
+
+
-    
+
-    
+
-    init(master);
-    
-    startLocator(registry);
-  private static void startLocator(Registry registry) throws IOException, NotBoundException {
+  private static int startLocator(Registry registry) throws IOException, NotBoundException {
-          Locator.startLocatorAndDS(locatorPort, locatorLogFile, p);
+          Locator.startLocatorAndDS(0, locatorLogFile, p);
+          InternalLocator internalLocator = (InternalLocator) Locator.getLocator();
+          locatorPort = internalLocator.getPort();
+          internalLocator.resetInternalLocatorFileNamesWithCorrectPortNumber(locatorPort);
-        
-        return null;
+
+        return locatorPort;
+    return (Integer) result.getResult();

MOV21 MOV21 UPD39 INS25 INS41 INS38 INS8 INS7 INS11 INS32 INS53 INS42 MOV32 INS43 INS32 UPD42 MOV42 UPD42 MOV42 INS42 INS14 INS42 INS42 INS42 INS43 INS45 INS42 INS42 INS60 INS21 INS21 INS43 INS59 INS7 INS32 INS34 INS42 INS42 INS11 INS42 INS32 INS42 INS42 INS42 INS43 INS32 INS42 INS42 INS42 INS42 INS42 DEL42 DEL32 DEL7 DEL21 DEL42 DEL33