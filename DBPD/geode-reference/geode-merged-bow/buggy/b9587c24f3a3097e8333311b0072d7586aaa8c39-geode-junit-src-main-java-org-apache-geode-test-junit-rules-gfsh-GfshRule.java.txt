GEODE-5716: add debug capability to the processes started using GfshRule (#2446)



+ *
+ * if you want to debug into the gfsh or the locator/servers started using this rule, you can do:
+ *
+ * GfshScript.of(new DebuggableCommand("start locator", 30001)).execute(gfshRule, 30000);
+ *
+ * this will set the gfsh to be debuggable at port 30000, and the locator started to be debuggable
+ * at port 30001
+    return execute(gfshScript, -1);
+  }
+
+  public GfshExecution execute(GfshScript gfshScript, int gfshDebugPort) {
-      Process process = toProcessBuilder(gfshScript, gfsh, workingDir).start();
+      Process process = toProcessBuilder(gfshScript, gfsh, workingDir, gfshDebugPort).start();
-  protected ProcessBuilder toProcessBuilder(GfshScript gfshScript, Path gfshPath, File workingDir) {
+  protected ProcessBuilder toProcessBuilder(GfshScript gfshScript, Path gfshPath, File workingDir,
+      int gfshDebugPort) {
-    for (String command : gfshScript.getCommands()) {
-      commandsToExecute.add("-e " + command);
+    for (DebuggableCommand command : gfshScript.getCommands()) {
+      if (command.debugPort > 0) {
+        commandsToExecute.add("-e " + command.command
+            + " --J='-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address="
+            + command.debugPort + "'");
+      } else {
+        commandsToExecute.add("-e " + command.command);
+      }
+    Map<String, String> environmentMap = processBuilder.environment();
-      Map<String, String> environmentMap = processBuilder.environment();
+    if (gfshDebugPort > 0) {
+      environmentMap.put("JAVA_ARGS",
+          "-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=" + gfshDebugPort);
+    }
-        new GfshScript(stopServerCommand).withName("teardown-stop-server").awaitQuietly();
+        GfshScript.of(stopServerCommand).withName("teardown-stop-server").awaitQuietly();
-        new GfshScript(stopLocatorCommand).withName("teardown-stop-locator").awaitQuietly();
+        GfshScript.of(stopLocatorCommand).withName("teardown-stop-locator").awaitQuietly();

INS31 INS83 INS43 INS42 INS44 INS8 INS44 INS44 INS66 INS66 INS66 INS66 INS42 INS43 INS42 INS41 INS39 INS42 INS39 INS42 MOV60 INS25 INS42 INS32 INS8 INS27 INS8 MOV43 INS42 INS42 INS38 UPD43 INS25 INS42 INS34 INS21 INS34 UPD42 INS27 INS8 INS8 INS32 INS40 INS34 MOV21 INS21 INS42 INS42 INS45 INS27 INS32 INS32 INS32 INS45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS27 INS40 INS45 INS40 INS45 INS45 INS40 DEL42 DEL8 DEL42 DEL43 DEL42 DEL14 DEL42 DEL14