Merge branch 'develop' into feature/GEODE-3109

+import org.apache.geode.internal.security.SecurityServiceFactory;
+  private volatile ConfigurationResponse configurationResponse;
+
-      this.securityService = this.system.getSecurityService();
+      this.configurationResponse = requestSharedConfiguration();
+
+      // apply the cluster's properties configuration and initialize security using that
+      // configuration
+      ClusterConfigurationLoader.applyClusterPropertiesConfiguration(this.configurationResponse,
+          this.system.getConfig());
+
+      this.securityService =
+          SecurityServiceFactory.create(this.system.getConfig().getSecurityProps(), cacheConfig);
+      this.system.setSecurityService(this.securityService);
-  private void deployJarsReceivedFromClusterConfiguration(ConfigurationResponse response) {
-    try {
-      ClusterConfigurationLoader.deployJarsReceivedFromClusterConfiguration(this, response);
-    } catch (IOException | ClassNotFoundException e) {
-      throw new GemFireConfigException(
-          LocalizedStrings.GemFireCache_EXCEPTION_OCCURRED_WHILE_DEPLOYING_JARS_FROM_SHARED_CONDFIGURATION
-              .toLocalizedString(),
-          e);
-    }
-  }
-
+    // set ClassPathLoader and then deploy cluster config jars
-    // request and check cluster configuration
-    ConfigurationResponse configurationResponse = requestSharedConfiguration();
-    deployJarsReceivedFromClusterConfiguration(configurationResponse);
-
-    // apply the cluster's properties configuration and initialize security using that configuration
-    ClusterConfigurationLoader.applyClusterPropertiesConfiguration(this, configurationResponse,
-        this.system.getConfig());
+    try {
+      ClusterConfigurationLoader.deployJarsReceivedFromClusterConfiguration(this,
+          this.configurationResponse);
+    } catch (IOException | ClassNotFoundException e) {
+      throw new GemFireConfigException(
+          LocalizedStrings.GemFireCache_EXCEPTION_OCCURRED_WHILE_DEPLOYING_JARS_FROM_SHARED_CONDFIGURATION
+              .toLocalizedString(),
+          e);
+    }
-      if (configurationResponse == null) {
+      if (this.configurationResponse == null) {
-      ClusterConfigurationLoader.applyClusterXmlConfiguration(this, configurationResponse,
+      ClusterConfigurationLoader.applyClusterXmlConfiguration(this, this.configurationResponse,
+        this.configurationResponse = null;

INS26 INS40 INS23 INS83 INS83 MOV43 INS59 INS42 MOV54 INS21 INS21 INS21 INS7 INS32 INS7 MOV32 INS22 MOV32 INS42 INS42 INS22 MOV32 INS22 INS32 UPD42 MOV22 INS22 INS22 INS22 INS21 INS52 INS42 INS52 INS42 INS52 INS42 INS42 INS42 INS32 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS7 INS32 INS42 INS22 INS33 INS22 INS42 INS52 INS42 INS52 INS42 DEL7 DEL83 DEL39 DEL42 DEL42 DEL44 DEL8 DEL31 DEL42 DEL42 DEL43 DEL42 DEL59 DEL60 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL52 DEL42 DEL32 DEL21 DEL42 DEL42