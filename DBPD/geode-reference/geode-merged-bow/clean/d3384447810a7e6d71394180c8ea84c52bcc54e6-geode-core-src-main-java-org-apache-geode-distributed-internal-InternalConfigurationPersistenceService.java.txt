GEODE-6712: locator should not start if cluster configuration service failed to start (#3815)


-import javax.xml.transform.TransformerFactoryConfigurationError;
-import org.apache.geode.CancelException;
-import org.apache.geode.cache.CacheLoaderException;
-import org.apache.geode.cache.TimeoutException;
-  void initSharedConfiguration(boolean loadSharedConfigFromDir)
-      throws CacheLoaderException, TimeoutException, IllegalStateException, IOException,
-      TransformerException, SAXException, ParserConfigurationException {
+  void initSharedConfiguration(boolean loadSharedConfigFromDir) throws IOException {
-    removeInvalidXmlConfigurations(configRegion);
+      removeInvalidXmlConfigurations(configRegion);
-      throws IOException, SAXException, ParserConfigurationException, TransformerException {
+      throws IOException {
-        Document document = XmlUtils.createDocumentFromXml(configurationXml);
-        boolean removedInvalidReceivers = removeInvalidGatewayReceivers(document);
-        boolean removedDuplicateReceivers = removeDuplicateGatewayReceivers(document);
-        if (removedInvalidReceivers || removedDuplicateReceivers) {
-          configuration.setCacheXmlContent(XmlUtils.prettyXml(document));
-          configRegion.put(group, configuration);
+        try {
+          Document document = XmlUtils.createDocumentFromXml(configurationXml);
+          boolean removedInvalidReceivers = removeInvalidGatewayReceivers(document);
+          boolean removedDuplicateReceivers = removeDuplicateGatewayReceivers(document);
+          if (removedInvalidReceivers || removedDuplicateReceivers) {
+            configuration.setCacheXmlContent(XmlUtils.prettyXml(document));
+            configRegion.put(group, configuration);
+          }
+        } catch (SAXException | TransformerException | ParserConfigurationException e) {
+          throw new IOException("Unable to parse existing cluster configuration from disk. ", e);
-  public void loadSharedConfigurationFromDir(File configDir)
-      throws SAXException, ParserConfigurationException, TransformerException, IOException {
+  public void loadSharedConfigurationFromDir(File configDir) throws IOException {
-
-
-    } catch (CancelException e) {
+    } catch (RuntimeException e) {
-      // CONFIG: don't rethrow as Exception, keep it a subclass of CancelException
+      // throw RuntimeException as is
-
+      // turn all other exceptions into runtime exceptions
-  private Configuration readConfiguration(File groupConfigDir)
-      throws SAXException, ParserConfigurationException, TransformerFactoryConfigurationError,
-      TransformerException, IOException {
+  private Configuration readConfiguration(File groupConfigDir) throws IOException {

MOV21 INS8 UPD43 INS54 UPD42 MOV8 INS12 INS44 INS8 INS84 INS42 INS53 MOV43 MOV43 MOV43 INS14 INS43 INS45 INS42 INS42 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43