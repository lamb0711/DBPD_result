GEODE-4746: Handle exceptions and return failures to protobuf clients

Catching exceptions that happen before sending a response to the
protobuf client and sending an error message to the client instead of
closing the connection.

Cleaning up extraneous catch blocks.

+import org.apache.geode.internal.protocol.protobuf.v1.state.exception.ExceptionWithErrorCode;
+import org.apache.geode.internal.protocol.protobuf.v1.state.exception.OperationNotAuthorizedException;
-  public static <T> Failure<T> of(ConnectionStateException exception) {
-    return of(exception.getErrorCode(), exception.getMessage());
+  public static <T> Failure<T> of(Throwable exception) {
+    BasicTypes.ErrorCode errorCode = getErrorCode(exception);
+
+    return of(errorCode, getErrorMessage(exception));
-  public static <T> Failure<T> of(Exception exception) {
-    if (exception instanceof ConnectionStateException) {
-      return of((ConnectionStateException) exception);
+  private static BasicTypes.ErrorCode getErrorCode(Throwable exception) {
+    BasicTypes.ErrorCode errorCode = BasicTypes.ErrorCode.SERVER_ERROR;
+    if (exception instanceof ExceptionWithErrorCode) {
+      errorCode = ((ExceptionWithErrorCode) exception).getErrorCode();
-    return of(BasicTypes.ErrorCode.SERVER_ERROR, exception.toString());
+    return errorCode;
+  }
+
+  private static String getErrorMessage(Throwable exception) {
+
+    StringBuilder message = new StringBuilder(exception.toString());
+    while (exception.getCause() != null) {
+      message.append(" Caused by: " + exception.getCause());
+      exception = exception.getCause();
+    }
+
+    return message.toString();

INS26 INS26 INS40 INS40 INS31 UPD83 INS43 INS42 INS83 INS83 INS43 INS42 INS44 INS8 UPD43 INS60 INS40 UPD43 INS60 INS42 INS43 INS42 INS60 INS61 INS41 UPD42 INS43 INS59 UPD42 INS43 INS59 INS42 INS42 INS43 INS59 INS27 INS8 INS32 INS40 INS42 INS32 UPD42 MOV42 INS32 INS40 INS42 INS40 UPD43 INS21 INS42 INS42 INS14 INS32 INS33 INS21 INS21 INS42 INS42 INS42 INS42 UPD42 MOV42 MOV42 UPD42 INS7 INS43 MOV32 INS42 INS42 INS32 INS7 INS42 INS32 INS42 INS42 INS42 INS27 INS42 INS32 INS36 INS42 INS45 INS32 INS42 INS42 INS11 INS42 INS42 UPD43 MOV43 MOV42 UPD42 DEL32 DEL42 DEL32 DEL42 DEL73 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL42 DEL11 DEL32 DEL41 DEL42 DEL40 DEL32