GEODE-5502: Removed duplicate / member-specific receivers from cluster configuration


-  private static final String CONFIG_REGION_NAME = "_ConfigurationRegion";
+  public static final String CONFIG_REGION_NAME = "_ConfigurationRegion";
+    removeInvalidXmlConfigurations(configRegion);
+  void removeInvalidXmlConfigurations(Region<String, Configuration> configRegion)
+      throws IOException, SAXException, ParserConfigurationException, TransformerException {
+    for (Map.Entry<String, Configuration> entry : configRegion.entrySet()) {
+      String group = entry.getKey();
+      Configuration configuration = entry.getValue();
+      String configurationXml = configuration.getCacheXmlContent();
+      if (configurationXml != null && !configurationXml.isEmpty()) {
+        Document document = XmlUtils.createDocumentFromXml(configurationXml);
+        boolean removedInvalidReceivers = removeInvalidGatewayReceivers(document);
+        boolean removedDuplicateReceivers = removeDuplicateGatewayReceivers(document);
+        if (removedInvalidReceivers || removedDuplicateReceivers) {
+          configuration.setCacheXmlContent(XmlUtils.prettyXml(document));
+          configRegion.put(group, configuration);
+        }
+      }
+    }
+  }
+
+  boolean removeInvalidGatewayReceivers(Document document) throws TransformerException {
+    boolean modified = false;
+    NodeList receiverNodes = document.getElementsByTagName("gateway-receiver");
+    for (int i = receiverNodes.getLength() - 1; i >= 0; i--) {
+      Element receiverElement = (Element) receiverNodes.item(i);
+
+      // Check hostname-for-senders
+      String hostNameForSenders = receiverElement.getAttribute("hostname-for-senders");
+      if (StringUtils.isNotBlank(hostNameForSenders)) {
+        receiverElement.getParentNode().removeChild(receiverElement);
+        logger.info("Removed invalid cluster configuration gateway-receiver element="
+            + XmlUtils.prettyXml(receiverElement));
+        modified = true;
+      }
+
+      // Check bind-address
+      String bindAddress = receiverElement.getAttribute("bind-address");
+      if (StringUtils.isNotBlank(bindAddress) && !bindAddress.equals("0.0.0.0")) {
+        receiverElement.getParentNode().removeChild(receiverElement);
+        logger.info("Removed invalid cluster configuration gateway-receiver element="
+            + XmlUtils.prettyXml(receiverElement));
+        modified = true;
+      }
+    }
+    return modified;
+  }
+
+  boolean removeDuplicateGatewayReceivers(Document document) throws TransformerException {
+    boolean modified = false;
+    NodeList receiverNodes = document.getElementsByTagName("gateway-receiver");
+    while (receiverNodes.getLength() > 1) {
+      Element receiverElement = (Element) receiverNodes.item(0);
+      receiverElement.getParentNode().removeChild(receiverElement);
+      logger.info("Removed duplicate cluster configuration gateway-receiver element="
+          + XmlUtils.prettyXml(receiverElement));
+      modified = true;
+      receiverNodes = document.getElementsByTagName("gateway-receiver");
+    }
+    return modified;
+  }
+

INS31 INS31 INS31 UPD83 INS39 INS42 INS44 INS43 INS43 INS43 INS43 INS8 INS39 INS42 INS44 INS43 INS8 INS39 INS42 INS44 INS43 INS8 INS21 INS74 INS42 INS42 INS42 INS42 INS42 INS70 INS43 INS42 INS42 INS60 INS60 INS24 INS41 INS43 INS42 INS42 INS60 INS60 INS61 INS41 INS32 INS43 INS43 INS43 INS44 INS32 INS8 INS42 INS39 INS59 INS43 INS59 INS58 INS27 INS37 INS8 INS42 INS42 INS39 INS59 INS43 INS59 INS27 INS8 INS42 INS42 INS42 INS42 INS42 INS42 INS74 INS42 INS42 INS42 INS60 INS60 INS60 INS25 INS42 INS9 INS42 INS42 INS32 INS39 INS59 INS42 INS34 INS42 INS60 INS60 INS25 INS60 INS25 INS42 INS9 INS42 INS42 INS32 INS32 INS34 INS60 INS21 INS21 INS21 INS21 INS43 INS43 INS43 INS43 INS59 INS43 INS59 INS43 INS59 INS27 INS8 INS42 INS42 INS45 INS42 INS27 INS43 INS59 INS43 INS59 INS32 INS8 INS43 INS59 INS27 INS8 INS42 INS42 INS45 INS42 INS42 INS43 INS59 INS32 INS32 INS7 INS7 INS40 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS27 INS38 INS60 INS60 INS60 INS25 INS32 INS34 INS42 INS42 INS11 INS42 INS42 INS32 INS42 INS42 INS42 INS21 INS21 INS21 INS42 INS42 INS32 INS32 INS38 INS21 INS21 INS21 INS42 INS42 INS11 INS32 INS42 INS42 INS42 INS42 INS27 INS42 INS9 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS33 INS32 INS43 INS59 INS39 INS59 INS39 INS59 INS27 INS8 INS42 INS42 INS43 INS32 INS42 INS42 INS45 INS32 INS32 INS7 INS42 INS42 INS45 INS42 INS42 INS42 INS32 INS32 INS32 INS7 INS43 INS32 INS42 INS42 INS45 INS32 INS42 INS42 INS45 INS42 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS42 INS21 INS21 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS27 INS42 INS9 INS42 INS42 INS45 INS32 INS42 INS42 INS42 INS42 INS27 INS42 INS9 INS42 INS42 INS42 INS34 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS32 INS42 INS42 INS45 INS32 INS42 INS42 INS45 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42