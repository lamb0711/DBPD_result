GEODE-5010: have post interceptor uses ResultModel as an input if comâ€¦ (#1974)



-    CommandResult commandResult = null;
-    Object response = null;
+    boolean useResultModel = false;
+        useResultModel = true;
+    Object response = null;
-    // the response could be a string which is a json representation of the CommandResult object
+    // the response could be a string which is a json representation of the
+    // CommandResult/ResultModel object
+    Object commandResult = null;
-        // TODO: stuff when failedToPersist...
-        // TODO: stuff for debug info...
-        commandResult = ResultBuilder.createModelBasedCommandResult((String) response);
+        // if it's ResultModel
+        commandResult = ResultModel.fromJson((String) response);
+        useResultModel = true;
+        // if it's a CommandResult
-      CommandResult postExecResult =
-          interceptor.postExecution(parseResult, commandResult, tempFile);
-      if (postExecResult != null) {
-        if (Status.ERROR.equals(postExecResult.getStatus())) {
-          if (logWrapper.infoEnabled()) {
-            logWrapper.info("Post execution Result :: " + postExecResult);
-          }
-        } else if (logWrapper.fineEnabled()) {
-          logWrapper.fine("Post execution Result :: " + postExecResult);
+      try {
+        if (useResultModel) {
+          commandResult =
+              interceptor.postExecution(parseResult, (ResultModel) commandResult, tempFile);
+        } else {
+          commandResult =
+              interceptor.postExecution(parseResult, (CommandResult) commandResult, tempFile);
-        commandResult = postExecResult;
+      } catch (Exception e) {
+        logWrapper.severe("error running post interceptor", e);
+        commandResult = ResultBuilder.createGemFireErrorResult(e.getMessage());
-    return commandResult;
+    CommandResult gfshResult;
+    if (commandResult instanceof ResultModel) {
+      gfshResult = new ModelCommandResult((ResultModel) commandResult);
+    } else {
+      gfshResult = (CommandResult) commandResult;
+    }
+
+    return gfshResult;

MOV60 MOV60 INS60 INS25 INS60 INS25 INS39 INS59 INS43 MOV27 INS8 MOV43 INS59 INS62 MOV8 INS8 UPD42 INS42 INS9 INS42 INS54 INS42 INS42 INS43 MOV21 INS8 INS12 INS42 INS7 INS21 INS21 INS25 INS44 INS8 INS42 INS14 INS42 INS11 INS7 INS7 INS42 INS8 INS8 INS43 INS42 MOV21 INS21 INS43 INS11 INS43 INS42 INS42 INS9 INS42 INS9 INS21 INS21 INS42 INS7 INS42 INS43 INS42 INS42 UPD42 UPD42 INS7 INS7 UPD42 INS45 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS32 UPD42 MOV42 UPD42 MOV42 INS32 MOV42 MOV42 MOV42 INS11 MOV42 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 INS11 INS42 INS42 INS42 INS43 INS42 MOV43 INS42 INS42 DEL45 DEL42 DEL27 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL40 DEL32 DEL32 DEL42 DEL42 DEL32 DEL8 DEL25 DEL8 DEL32 DEL25 DEL25 DEL8 DEL25 DEL8 DEL25 DEL42 DEL42 DEL45 DEL42 DEL27 DEL32 DEL42 DEL42