Merge branch 'release/1.4.0'

-import org.apache.geode.cache.CacheFactory;
-import org.apache.geode.cache.execute.FunctionAdapter;
+import org.apache.geode.cache.execute.Function;
-import org.apache.geode.cache.lucene.LuceneIndexFactory;
+import org.apache.geode.cache.lucene.LuceneSerializer;
+import org.apache.geode.cache.lucene.internal.LuceneIndexFactoryImpl;
+import org.apache.geode.cache.lucene.internal.LuceneServiceImpl;
- * 
+ *
- * @see FunctionAdapter
+ * @see Function
-public class LuceneCreateIndexFunction extends FunctionAdapter implements InternalEntity {
+public class LuceneCreateIndexFunction implements InternalEntity, Function {
+
+  private static final long serialVersionUID = 3061443846664615818L;
+      String serializerName = indexInfo.getSerializer();
-      final LuceneIndexFactory indexFactory = service.createIndexFactory();
+      final LuceneIndexFactoryImpl indexFactory =
+          (LuceneIndexFactoryImpl) service.createIndexFactory();
-      REGION_PATH.validateName(indexInfo.getRegionPath());
+      if (serializerName != null && !serializerName.equals("")) {
+        indexFactory.setLuceneSerializer(toSerializer(serializerName));
+      }
-      indexFactory.create(indexInfo.getIndexName(), indexInfo.getRegionPath());
+      REGION_PATH.validateName(indexInfo.getRegionPath());
+      if (LuceneServiceImpl.LUCENE_REINDEX) {
+        indexFactory.create(indexInfo.getIndexName(), indexInfo.getRegionPath(), true);
+      } else {
+        indexFactory.create(indexInfo.getIndexName(), indexInfo.getRegionPath(), false);
+      }
+  private LuceneSerializer toSerializer(String serializerName)
+      throws InstantiationException, IllegalAccessException, ClassNotFoundException {
+    String trimmedName = StringUtils.trim(serializerName);
+    if (trimmedName == "") {
+      return null;
+    }
+    Class<? extends LuceneSerializer> clazz =
+        CliUtil.forName(serializerName, LuceneCliStrings.LUCENE_CREATE_INDEX__SERIALIZER);
+    return CliUtil.newInstance(clazz, LuceneCliStrings.LUCENE_CREATE_INDEX__SERIALIZER);
+  }
+

MOV26 MOV26 INS26 MOV43 UPD40 UPD40 UPD40 INS40 UPD43 INS23 INS31 UPD42 INS83 INS83 INS83 INS39 INS59 INS83 INS43 INS42 INS44 INS43 INS43 INS43 INS8 UPD42 INS42 INS34 INS42 INS43 INS42 INS42 INS42 INS42 INS60 INS25 INS60 INS41 INS42 INS43 INS59 INS27 INS8 INS74 INS59 INS32 INS60 INS25 INS25 INS42 INS42 INS32 INS42 INS45 INS41 INS43 INS76 INS42 INS32 INS42 INS42 INS42 INS40 INS43 INS59 UPD43 INS27 INS8 INS40 INS8 INS8 INS42 INS42 INS42 INS33 INS42 INS43 INS42 INS42 INS42 INS40 INS42 INS42 INS32 UPD42 INS11 INS27 INS38 INS21 MOV21 INS21 INS42 INS42 INS42 INS43 MOV32 INS42 INS33 INS32 INS32 INS32 INS42 INS42 INS42 INS45 INS42 INS42 INS32 INS9 INS42 INS42 INS32 INS32 INS9 INS42 INS42 INS42 INS42 INS42 INS42