Implementing LuceneQueryImpl.search

Implementing search by invoking the LuceneFunction from within
LuceneQueryImpl.search and building a result set. Adding unit tests for
the same.

-import org.apache.lucene.analysis.Analyzer;
-import org.apache.lucene.analysis.standard.StandardAnalyzer;
-import org.apache.lucene.queryparser.classic.QueryParser;
-import org.apache.lucene.search.Query;
-import com.gemstone.gemfire.cache.lucene.LuceneIndex;
+import com.gemstone.gemfire.cache.Cache;
+import com.gemstone.gemfire.cache.Region;
-  private Set<String> projectionFields = new HashSet<String>();
+  private String[] projectionFields = null;
+  private Cache cache;
-  /* reference to the index. One index could have multiple Queries, but one Query must belong
-   * to one index
-   */
-  private LuceneIndex relatedIndex;
-
+  LuceneQueryFactoryImpl(Cache cache) {
+    this.cache = cache;
+  }
+  
-  public LuceneQuery create(String indexName, String regionName,
-      String queryString) throws ParseException {
+  public <K, V> LuceneQuery<K, V> create(String indexName, String regionName,
+      String queryString) {
-  public LuceneQuery create(String indexName, String regionName, LuceneQueryProvider provider) {
-    LuceneQueryImpl luceneQuery = new LuceneQueryImpl(indexName, regionName, provider, projectionFields, limit, pageSize);
+  public <K, V> LuceneQuery<K, V> create(String indexName, String regionName, LuceneQueryProvider provider) {
+    Region region = cache.getRegion(regionName);
+    LuceneQueryImpl<K, V> luceneQuery = new LuceneQueryImpl<K, V>(indexName, region, provider, projectionFields, limit, pageSize);
-
-  public LuceneIndex getRelatedIndex() {
-    return this.relatedIndex;
-  }
-
-    if (fieldNames != null) {
-      for (String fieldName:fieldNames) {
-        this.projectionFields.add(fieldName);
-      }
-    }
+    projectionFields = fieldNames.clone();

UPD40 UPD40 INS31 INS5 UPD43 INS42 INS44 INS8 INS73 INS73 INS74 INS42 INS73 INS73 INS74 INS8 MOV43 INS85 INS33 UPD42 UPD42 INS43 INS42 INS21 INS42 INS42 MOV43 INS43 INS43 INS42 INS42 MOV43 INS43 INS43 INS60 MOV21 MOV41 INS42 INS7 UPD42 MOV42 INS42 INS42 INS42 INS43 INS59 INS74 INS7 INS22 INS42 INS42 INS42 INS32 MOV43 INS43 INS43 INS42 INS32 INS52 INS42 INS42 INS42 INS42 INS42 INS42 INS74 UPD42 UPD42 MOV42 UPD42 MOV42 MOV43 INS43 INS43 INS42 INS42 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL43 DEL42 DEL43 DEL74 DEL14 DEL42 DEL43 DEL83 DEL42 DEL43 DEL42 DEL52 DEL42 DEL22 DEL41 DEL8 DEL31 DEL52 DEL42 DEL22 DEL32 DEL42 DEL33 DEL27 DEL42 DEL44 DEL42 DEL8 DEL70 DEL8 DEL25 DEL8