GEODE-500: fix race in OffHeapMemoryUsageListener

A race in the run loop existed that caused the usage
listener to quit delivering off-heap events.
This should fix a number of intermittent off-heap
resource manager bugs.

-          if (lastOffHeapMemoryUsed == this.offHeapMemoryUsed && !this.stopRequested) {
-            try {
+          long newOffHeapMemoryUsed = this.offHeapMemoryUsed;
+          if (this.stopRequested) {
+            // no need to wait since we are stopping
+          } else if (lastOffHeapMemoryUsed != newOffHeapMemoryUsed) {
+            // no need to wait since memory used has changed
+            // This fixes a race like bug GEODE-500
+            lastOffHeapMemoryUsed = newOffHeapMemoryUsed;
+          } else {
+            // wait for memory used to change
+            try {  
-                if (this.offHeapMemoryUsed == lastOffHeapMemoryUsed) {
+                newOffHeapMemoryUsed = this.offHeapMemoryUsed;
+                if (newOffHeapMemoryUsed == lastOffHeapMemoryUsed) {
-                  lastOffHeapMemoryUsed = this.offHeapMemoryUsed;
+                  lastOffHeapMemoryUsed = newOffHeapMemoryUsed;

INS60 INS25 INS39 INS59 INS22 INS8 MOV25 INS42 MOV22 INS52 INS42 INS27 INS8 MOV42 INS42 INS21 INS7 INS42 INS42 MOV21 UPD42 INS42 INS21 INS7 INS42 INS42 DEL27 DEL52 DEL42 DEL22 DEL38 DEL27 DEL52 DEL42 DEL22