GEODE-2404: Modified to support destroying an index while puts are occurring

-      Set<String> otherAsynEventQueueIds = ((LocalRegion) rgn).getAsyncEventQueueIds();
+      Set<String> otherAsynEventQueueIds = ((LocalRegion) rgn).getVisibleAsyncEventQueueIds();
-      // TODO Compares set sizes and equivalent entries.
-      if (profile.cacheServiceProfiles != null) {
-        for (CacheServiceProfile remoteProfile : profile.cacheServiceProfiles) {
-          CacheServiceProfile localProfile =
-              ((LocalRegion) rgn).getCacheServiceProfile(remoteProfile.getId());
+      Map<String, CacheServiceProfile> myProfiles = ((LocalRegion) rgn).getCacheServiceProfiles();
+      // Iterate and compare the remote CacheServiceProfiles to the local ones
+      for (CacheServiceProfile remoteProfile : profile.cacheServiceProfiles) {
+        CacheServiceProfile localProfile = myProfiles.get(remoteProfile.getId());
+        if (localProfile == null) {
+          cspResult = remoteProfile.getMissingProfileMessage(true);
+        } else {
-          if (cspResult != null) {
-            break;
-          }
-        // Don't overwrite result with null in case it has already been set in a previous
-        // compatibility check.
-          result = cspResult;
+          break;
+
+      // If the comparison result is null, compare the local profiles to the remote ones. If there
+      // are more local profiles than remote ones (meaning there are ones defined locally that are
+      // not defined remotely), then compare those. This should produce an informative error message
+      // (as opposed to returning something like 'the profiles don't match').
+      if (cspResult == null) {
+        if (myProfiles.size() > profile.cacheServiceProfiles.size()) {
+          for (CacheServiceProfile localProfile : myProfiles.values()) {
+            if (!profile.cacheServiceProfiles.stream()
+                .anyMatch(remoteProfile -> remoteProfile.getId().equals(localProfile.getId()))) {
+              cspResult = localProfile.getMissingProfileMessage(false);
+              break;
+            }
+          }
+        }
+      }
+
+      // If the comparison result is not null, set the final result.
+      // Note: Be careful not to overwrite the final result with null in case it has already been
+      // set in a previous compatibility check.
+      if (cspResult != null) {
+        result = cspResult;
+      }
+

MOV60 MOV70 INS25 MOV25 INS74 INS27 INS8 INS43 INS43 INS43 UPD42 INS60 INS25 INS42 INS33 MOV25 UPD42 INS42 INS42 INS42 UPD42 MOV43 INS59 INS27 INS8 INS8 UPD27 INS8 INS42 INS32 INS42 INS33 INS21 MOV21 INS32 INS32 INS70 INS42 INS42 MOV32 INS7 INS42 INS42 INS40 INS42 INS44 INS32 INS8 INS42 INS32 INS43 INS42 INS42 INS42 INS25 INS42 INS42 INS9 INS42 INS38 MOV8 INS32 INS21 INS10 INS32 INS42 INS86 INS7 INS40 INS42 INS59 INS32 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS42 INS9 INS42 INS42 INS42 INS42 DEL40 DEL33