GEODE-6068: change destroy jdbc-mapping to undo create (#2905)

All the changes made by create jdbc-mapping are now undone
by destroy jdbc-mapping. This includes the cluster config changes
and the changes to the live regions and caches on servers.

+import java.util.Set;
+
+import org.apache.geode.cache.Cache;
+import org.apache.geode.cache.CacheLoader;
+import org.apache.geode.cache.CacheWriter;
+import org.apache.geode.cache.Region;
+import org.apache.geode.cache.asyncqueue.internal.InternalAsyncEventQueue;
+import org.apache.geode.connectors.jdbc.JdbcLoader;
+import org.apache.geode.connectors.jdbc.JdbcWriter;
+import org.apache.geode.management.internal.cli.functions.CliFunctionResult.StatusState;
+    Cache cache = context.getCache();
+      cleanupRegionAndQueue(cache, regionName);
-      return new CliFunctionResult(member, true, message);
+      return new CliFunctionResult(member, StatusState.OK, message);
-      return new CliFunctionResult(member, false, message);
+      return new CliFunctionResult(member, StatusState.ERROR, message);
+    }
+  }
+
+  private void cleanupRegionAndQueue(Cache cache, String regionName) {
+    String queueName = CreateMappingCommand.createAsyncEventQueueName(regionName);
+
+    Region<?, ?> region = cache.getRegion(regionName);
+    if (region != null) {
+      CacheLoader<?, ?> loader = region.getAttributes().getCacheLoader();
+      if (loader instanceof JdbcLoader) {
+        region.getAttributesMutator().setCacheLoader(null);
+      }
+      CacheWriter<?, ?> writer = region.getAttributes().getCacheWriter();
+      if (writer instanceof JdbcWriter) {
+        region.getAttributesMutator().setCacheWriter(null);
+      }
+      Set<String> queueIds = region.getAttributes().getAsyncEventQueueIds();
+      if (queueIds.contains(queueName)) {
+        region.getAttributesMutator().removeAsyncEventQueueId(queueName);
+      }
+    }
+
+    InternalAsyncEventQueue queue = (InternalAsyncEventQueue) cache.getAsyncEventQueue(queueName);
+    if (queue != null) {
+      queue.stop();
+      queue.destroy();

INS26 INS26 INS26 INS26 INS26 INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS40 INS40 INS40 INS40 INS40 INS31 INS83 INS39 INS42 INS44 INS44 INS8 INS60 INS43 INS42 INS43 INS42 INS60 INS60 INS25 INS60 INS25 INS43 INS59 INS42 INS42 INS43 INS59 INS74 INS59 INS27 INS8 INS43 INS59 INS27 INS8 INS42 INS42 INS32 INS21 INS42 INS42 INS32 INS43 INS76 INS76 INS42 INS32 INS42 INS33 INS60 INS25 INS60 INS25 INS60 INS25 INS42 INS42 INS11 INS42 INS33 INS21 INS21 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS74 INS59 INS62 INS8 INS74 INS59 INS62 INS8 INS74 INS59 INS32 INS8 INS43 INS32 INS32 INS32 INS42 INS42 INS42 MOV43 INS40 MOV43 INS40 INS43 INS76 INS76 INS42 INS32 INS42 INS43 INS21 INS43 INS76 INS76 INS42 INS32 INS42 INS43 INS21 INS43 INS43 INS42 INS32 INS42 INS42 INS42 INS21 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS32 INS42 INS33 INS42 INS42 INS32 INS42 INS33 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL9 DEL9