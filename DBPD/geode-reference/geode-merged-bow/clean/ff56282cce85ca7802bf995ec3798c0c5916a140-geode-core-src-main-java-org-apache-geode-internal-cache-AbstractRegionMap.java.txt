GEODE-5645 Client cache misses invalidate

Notify clients/gateways on an invalidation that is overwriting an
existing invalidated entry.  This allows them to update their version
information in case there is an operation that conflicts with this
invalidation and should be thrown away.

-                        if (isDebugEnabled) {
-                          logger.debug("mapInvalidate: Entry already invalid: '{}'",
-                              event.getKey());
-                        }
-                        processVersionTag(oldRe, event);
+                        handleAlreadyInvalidEntry(event, owner, oldRe);
-                      if (isDebugEnabled) {
-                        logger.debug("Invalidate: Entry already invalid: '{}'", event.getKey());
-                      }
-                      if (event.getVersionTag() != null && owner.getVersionVector() != null) {
-                        owner.getVersionVector().recordVersion(
-                            (InternalDistributedMember) event.getDistributedMember(),
-                            event.getVersionTag());
-                      }
+                      handleAlreadyInvalidEntry(event, owner, re);
+  /**
+   * If an entry is already invalid we still want to perform a conflict check, update
+   * the entry's version stamp and invoke listeners.
+   */
+  private void handleAlreadyInvalidEntry(EntryEventImpl event, LocalRegion owner, RegionEntry re) {
+    if (logger.isDebugEnabled()) {
+      logger.debug("Invalidate: Entry already invalid: '{}'", event.getKey());
+    }
+    processVersionTag(re, event);
+    if (owner.getConcurrencyChecksEnabled() && event.hasValidVersionTag()) {
+      // notify clients so they can update their version stamps
+      event.invokeCallbacks(owner, true, true);
+    }
+  }
+

INS31 INS29 INS83 INS39 INS42 INS44 INS44 INS44 INS8 INS65 INS43 INS42 INS43 INS42 INS43 INS42 MOV25 INS21 INS25 INS66 INS66 INS42 INS42 INS42 INS32 INS32 INS27 INS8 INS42 INS42 INS42 INS42 INS42 INS32 INS32 INS21 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS9 INS9 MOV8 UPD42 MOV42 MOV42 UPD42 MOV42 UPD42 MOV42 MOV21 UPD42 MOV42 UPD42 MOV42 INS42 DEL42 DEL45 DEL32 DEL42 DEL8 DEL25 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL32 DEL42 DEL42 DEL43 DEL32 DEL11 DEL42 DEL32 DEL42 DEL42 DEL32 DEL33 DEL27 DEL42 DEL42 DEL32 DEL33 DEL27 DEL27 DEL25 DEL8 DEL42