GEODE-6904: Fix hang on locator when restarting due to lock (#3777)

Only hold the locatorLock while reading the locator variable in
restartWithDS. Holding this lock while recovering cluster configuration
was causing other messages to the locator, including the StartupMessage,
to block waiting for this lock.

In addition, wait forever for StartupMessage responses.
StartupOperation had a 15 second timeout, after which it would stop
waiting. That resulted in not having correct metadata about other
members in the system. We were also not waking up the thread in
waitForReplies when a StartupResponseMessage came in with a
rejectionMessage.

Co-Authored-By: Dan Smith <dsmith@pivotal.io>

-      internalDistributedSystem = newSystem;
-      internalCache = newCache;
-      internalDistributedSystem.setDependentLocator(this);
-      logger.info("Locator restart: initializing TcpServer");
-
-      try {
-        server.restarting(newSystem, newCache, configurationPersistenceService);
-      } catch (CancelException e) {
-        internalDistributedSystem = null;
-        internalCache = null;
-        logger.info("Locator restart: attempt to restart location services failed", e);
-        throw e;
-      }
-
-      if (productUseLog.isClosed()) {
-        productUseLog.reopen();
-      }
-
-      productUseLog.monitorUse(newSystem);
-
-      if (isSharedConfigurationEnabled()) {
-        configurationPersistenceService =
-            new InternalConfigurationPersistenceService(newCache, workingDirectory,
-                JAXBService.create());
-        startClusterManagementService();
-      }
-
-      if (!server.isAlive()) {
-        logger.info("Locator restart: starting TcpServer");
-        startTcpServer();
-      }
-
-      logger.info("Locator restart: initializing JMX manager");
-      startJmxManagerLocationService(newCache);
-      endStartLocator(internalDistributedSystem);
-      logger.info("Locator restart completed");
+    internalDistributedSystem = newSystem;
+    internalCache = newCache;
+    internalDistributedSystem.setDependentLocator(this);
+    logger.info("Locator restart: initializing TcpServer");
+
+    try {
+      server.restarting(newSystem, newCache, configurationPersistenceService);
+    } catch (CancelException e) {
+      internalDistributedSystem = null;
+      internalCache = null;
+      logger.info("Locator restart: attempt to restart location services failed", e);
+      throw e;
+    }
+
+    if (productUseLog.isClosed()) {
+      productUseLog.reopen();
+    }
+    productUseLog.monitorUse(newSystem);
+
+    if (isSharedConfigurationEnabled()) {
+      configurationPersistenceService =
+          new InternalConfigurationPersistenceService(newCache, workingDirectory,
+              JAXBService.create());
+      startClusterManagementService();
+    }
+
+    if (!server.isAlive()) {
+      logger.info("Locator restart: starting TcpServer");
+      startTcpServer();
+    }
+
+    logger.info("Locator restart: initializing JMX manager");
+    startJmxManagerLocationService(newCache);
+    endStartLocator(internalDistributedSystem);
+    logger.info("Locator restart completed");
+

MOV8 INS51 MOV21 INS42 INS8 MOV25 DEL42 DEL51 DEL8