GEODE-8359 (#5371)

GEODE-8359: Code needed protection against the possibility of the null being returned.

There was also a fair amount of inconsistency between files that are very tightly related.

-import org.apache.geode.internal.cache.tier.CachedRegionHelper;
+import org.apache.geode.internal.cache.tier.sockets.CacheClientProxy;
-  public void cmdExecute(final Message clientMessage, final ServerConnection serverConnection,
-      final SecurityService securityService, long start) throws IOException, InterruptedException {
-    Part regionNamePart = null, keyPart = null;
-    String regionName = null;
+  public void cmdExecute(Message clientMessage, ServerConnection serverConnection,
+      SecurityService securityService, long start) throws IOException, InterruptedException {
+    Part regionNamePart;
+    String regionName;
-    List keys = null;
-    CachedRegionHelper crHelper = serverConnection.getCachedRegionHelper();
-    int numberOfKeys = 0, partNumber = 0;
+    List<Object> keys;
+    int numberOfKeys, partNumber;
-    // Retrieve the data from the message parts
-    boolean isDurable = false;
+    boolean isDurable;
-      keys = (List) list.getObject();
+      keys = (List<Object>) list.getObject();
-    boolean sendUpdatesAsInvalidates = false;
+    boolean sendUpdatesAsInvalidates;
+      return;
-    // key not null
-      AuthorizeRequest authzRequest = serverConnection.getAuthzRequest();
-      if (authzRequest != null) {
+      AuthorizeRequest authorizeRequest = serverConnection.getAuthzRequest();
+      if (authorizeRequest != null) {
-              authzRequest.registerInterestListAuthorize(regionName, keys, policy);
-          keys = (List) registerContext.getKey();
+              authorizeRequest.registerInterestListAuthorize(regionName, keys, policy);
+          keys = (List<Object>) registerContext.getKey();
-    boolean isPrimary = serverConnection.getAcceptor().getCacheClientNotifier()
-        .getClientProxy(serverConnection.getProxyID()).isPrimary();
+    CacheClientProxy ccp = serverConnection.getAcceptor().getCacheClientNotifier()
+        .getClientProxy(serverConnection.getProxyID());
+
+    if (ccp == null) {
+      IOException ioException = new IOException(
+          "CacheClientProxy for this client is no longer on the server");
+      writeChunkedException(clientMessage, ioException, serverConnection);
+      serverConnection.setAsTrue(RESPONDED);
+      return;
+    }
+
+    boolean isPrimary = ccp.isPrimary();
+
-        // If an interrupted exception is thrown , rethrow it
-
-        // otherwise send the exception back to client

MOV26 UPD40 INS25 INS60 INS74 INS43 INS27 INS8 INS39 INS59 MOV43 INS43 UPD42 INS41 INS42 UPD42 MOV32 INS42 INS33 INS60 INS21 INS21 INS41 INS42 INS32 UPD42 MOV42 INS43 INS59 INS32 INS32 INS42 INS42 UPD42 UPD42 INS42 INS42 INS14 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS74 INS43 INS45 MOV43 INS43 INS42 INS42 UPD42 INS74 MOV43 INS43 INS42 DEL83 DEL83 DEL83 DEL33 DEL42 DEL33 DEL59 DEL33 DEL42 DEL33 DEL59 DEL60 DEL43 DEL42 DEL42 DEL32 DEL34 DEL34 DEL9 DEL9 DEL39 DEL42 DEL32