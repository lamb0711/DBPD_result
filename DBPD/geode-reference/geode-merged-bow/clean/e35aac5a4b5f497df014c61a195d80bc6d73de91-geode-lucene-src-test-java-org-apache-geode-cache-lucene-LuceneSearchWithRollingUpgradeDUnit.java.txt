Merge branch 'release/1.5.0'

+import static org.junit.Assert.assertTrue;
+import org.apache.geode.distributed.internal.InternalLocator;
-  @Parameterized.Parameters
+  @Parameterized.Parameters(name = "from_v{0}")
+      // Locators before 1.4 handled configuration asynchronously.
+      // We must wait for configuration configuration to be ready, or confirm that it is disabled.
+      locator1.invoke(
+          () -> Awaitility.await().atMost(65, TimeUnit.SECONDS).pollInterval(1, TimeUnit.SECONDS)
+              .until(() -> assertTrue(
+                  !InternalLocator.getLocator().getConfig().getEnableClusterConfiguration()
+                      || InternalLocator.getLocator().isSharedConfigurationRunning())));
+      locator2.invoke(
+          () -> Awaitility.await().atMost(65, TimeUnit.SECONDS).pollInterval(1, TimeUnit.SECONDS)
+              .until(() -> assertTrue(
+                  !InternalLocator.getLocator().getConfig().getEnableClusterConfiguration()
+                      || InternalLocator.getLocator().isSharedConfigurationRunning())));
+
+
+      // Locators before 1.4 handled configuration asynchronously.
+      // We must wait for configuration configuration to be ready, or confirm that it is disabled.
+      locator.invoke(
+          () -> Awaitility.await().atMost(65, TimeUnit.SECONDS).pollInterval(1, TimeUnit.SECONDS)
+              .until(() -> assertTrue(
+                  !InternalLocator.getLocator().getConfig().getEnableClusterConfiguration()
+                      || InternalLocator.getLocator().isSharedConfigurationRunning())));
+
+
+      // Locators before 1.4 handled configuration asynchronously.
+      // We must wait for configuration configuration to be ready, or confirm that it is disabled.
+      locator.invoke(
+          () -> Awaitility.await().atMost(65, TimeUnit.SECONDS).pollInterval(1, TimeUnit.SECONDS)
+              .until(() -> assertTrue(
+                  !InternalLocator.getLocator().getConfig().getEnableClusterConfiguration()
+                      || InternalLocator.getLocator().isSharedConfigurationRunning())));
+
-
-
-    VM rollServer = Host.getHost(0).getVM(VersionManager.CURRENT_VERSION, oldServer.getId()); // gets
-                                                                                              // a
-                                                                                              // vm
-                                                                                              // with
-                                                                                              // the
-                                                                                              // current
-                                                                                              // version
+    VM rollServer = Host.getHost(0).getVM(VersionManager.CURRENT_VERSION, oldServer.getId());
-    VM rollLocator = Host.getHost(0).getVM(VersionManager.CURRENT_VERSION, oldLocator.getId()); // gets
-                                                                                                // a
-                                                                                                // VM
-                                                                                                // with
-                                                                                                // current
-                                                                                                // version
+    VM rollLocator = Host.getHost(0).getVM(VersionManager.CURRENT_VERSION, oldLocator.getId());

INS26 INS26 INS40 INS40 INS77 INS40 INS80 INS42 INS45 MOV21 MOV21 MOV21 MOV21 MOV21 MOV21 MOV21 MOV21 MOV21 MOV21 MOV21 MOV21 INS21 INS21 INS21 INS21 INS32 INS32 INS32 INS32 INS42 INS42 INS86 INS42 INS42 INS86 INS42 INS42 INS86 INS42 INS42 INS86 INS32 INS32 INS32 INS32 INS32 INS42 INS86 INS32 INS42 INS86 INS32 INS42 INS86 INS32 INS42 INS86 INS32 INS42 INS34 INS40 INS32 INS32 INS42 INS34 INS40 INS32 INS32 INS42 INS34 INS40 INS32 INS32 INS42 INS34 INS40 INS32 INS32 INS42 INS34 INS40 INS42 INS27 INS32 INS42 INS34 INS40 INS42 INS27 INS32 INS42 INS34 INS40 INS42 INS27 INS32 INS42 INS34 INS40 INS42 INS27 INS42 INS42 INS38 INS32 INS42 INS42 INS38 INS32 INS42 INS42 INS38 INS32 INS42 INS42 INS38 INS32 INS32 INS32 INS42 INS32 INS32 INS42 INS32 INS32 INS42 INS32 INS32 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL40 DEL78