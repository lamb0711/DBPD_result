Geode-5793: LocatorDUnitTest. testNonSSLLocatorDiesWhenConnectingToSSLLocator (#2654)

* Refactoring
* Rethrow `LocatorCancelException` during `startLocator` rather than swallowing.
* address some timing issues
+import java.io.BufferedOutputStream;
+import java.io.OutputStream;
-  private static Map<InetSocketAddress, Short> serverVersions =
-      new HashMap<InetSocketAddress, Short>();
+  private static final Map<InetSocketAddress, Short> serverVersions =
+      new HashMap<>();
-   * <code>String</code>s are returned: the first string is the working directory of the locator and
-   * the second string is the product directory of the locator.
+   * <code>String</code>s are returned: the first string is the working directory of the locator
+   * and the second string is the product directory of the locator.
-   *
-   *
-   *
-   *
-   *
-   *
-    /*
-     * InetSocketAddress ipAddr; if (addr == null) { ipAddr = new InetSocketAddress(port); } else {
-     * ipAddr = new InetSocketAddress(addr, port); // fix for bug 30810 }
-     */
-
-    short serverVersion = getServerVersion(ipAddr, timeout).shortValue();
+    short serverVersion = getServerVersion(ipAddr, timeout);
-      out = new DataOutputStream(sock.getOutputStream());
+
+      out = new DataOutputStream(new BufferedOutputStream(sock.getOutputStream()));
-    int gossipVersion = TcpServer.getCurrentGossipVersion();
-    Short serverVersion = null;
+    int gossipVersion;
+    Short serverVersion;
+    Socket sock;
+
+    final String locatorCancelExceptionString =
+        "This could be the result of trying to connect a non-SSL-enabled client to an SSL-enabled locator.";
+
-    Socket sock = null;
-      DataOutputStream out = new DataOutputStream(sock.getOutputStream());
-      out = new VersionedDataOutputStream(out, Version.GFE_57);
+      OutputStream outputStream = new BufferedOutputStream(sock.getOutputStream());
+      DataOutputStream out =
+          new VersionedDataOutputStream(new DataOutputStream(outputStream), Version.GFE_57);
-              "Unrecognisable response received: This could be the result of trying to connect a non-SSL-enabled client to an SSL-enabled locator.");
+              "Server version response invalid: " + locatorCancelExceptionString);
+
-        serverVersion = Short.valueOf(response.getVersionOrdinal());
+        serverVersion = response.getVersionOrdinal();
+
+
-    }
-    if (logger.isDebugEnabled()) {
-      logger.debug("Locator " + ipAddr
-          + " did not respond to a request for its version.  I will assume it is using v5.7 for safety.");
+
+
-

INS26 INS26 INS40 INS40 INS83 MOV60 INS60 UPD74 UPD66 UPD66 INS83 INS43 INS59 MOV32 INS42 INS42 INS45 INS60 INS43 MOV43 INS59 INS42 UPD42 INS42 INS14 INS14 INS43 MOV43 INS14 MOV40 INS43 MOV32 INS42 MOV43 UPD42 MOV42 MOV32 INS42 INS27 INS45 INS42 DEL42 DEL43 DEL42 DEL43 DEL42 DEL32 DEL42 DEL42 DEL32 DEL33 DEL33 DEL42 DEL14 DEL7 DEL21 DEL45 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL45 DEL42 DEL45 DEL27 DEL32 DEL21 DEL8 DEL25