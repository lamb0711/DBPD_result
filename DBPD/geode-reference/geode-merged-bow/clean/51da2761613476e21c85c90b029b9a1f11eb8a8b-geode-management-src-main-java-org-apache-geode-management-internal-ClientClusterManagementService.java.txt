GEODE-6811: fix the rest endpoint URI (#3718)


-  private static final String VERSION = "/v2";
-
+  // the restTemplate needs to have the context as the baseUrl, and request URI is the part after
+  // the context (including /v2), it needs to be set up this way so that spring test runner's
+  // injected RequestFactory can work
-        .postForEntity(VERSION + endPoint, config, ClusterManagementResult.class)
+        .postForEntity(endPoint, config, ClusterManagementResult.class)
-    String uri = getUri(config);
+    String uri = getIdentityEndPoint(config);
-        .exchange(VERSION + uri + "?group={group}",
+        .exchange(uri + "?group={group}",
-        .getForEntity(VERSION + endPoint + "/?id={id}&group={group}",
+        .getForEntity(endPoint + "/?id={id}&group={group}",
-        .getForEntity(VERSION + getUri(config), ClusterManagementResult.class)
+        .getForEntity(getIdentityEndPoint(config), ClusterManagementResult.class)
-    return endpoint;
+    return RestfulEndpoint.URI_VERSION + endpoint;
-  private String getUri(CacheElement config) {
+  private String getIdentityEndPoint(CacheElement config) {
-    String uri = ((RestfulEndpoint) config).getUri();
+    String uri = ((RestfulEndpoint) config).getIdentityEndPoint();
-    return uri;
+    return RestfulEndpoint.URI_VERSION + uri;
-    return restTemplate.getForEntity(VERSION + "/ping", String.class)
+    return restTemplate.getForEntity(RestfulEndpoint.URI_VERSION + "/ping", String.class)

UPD42 INS27 INS27 INS40 INS42 INS40 INS42 INS42 UPD42 INS32 UPD42 UPD42 MOV42 MOV42 INS40 DEL83 DEL83 DEL83 DEL42 DEL43 DEL42 DEL45 DEL59 DEL23 DEL42 DEL42 DEL27 DEL42 DEL42 DEL42 DEL32 DEL27 DEL42 DEL42 DEL42