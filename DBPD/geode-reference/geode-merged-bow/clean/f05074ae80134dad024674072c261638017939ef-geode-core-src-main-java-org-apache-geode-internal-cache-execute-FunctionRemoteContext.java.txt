GEODE-7134: Replace bucket Set with bucket int[] (#4002)


+import java.util.Arrays;
+import org.apache.geode.internal.InternalDataSerializer;
+import org.apache.geode.internal.cache.BucketSetHelper;
+import org.apache.geode.internal.serialization.Version;
-  private Set<Integer> bucketSet;
+  private int[] bucketArray;
-      Set<Integer> bucketSet, boolean isReExecute, boolean isFnSerializationReqd) {
+      int[] bucketArray, boolean isReExecute, boolean isFnSerializationReqd) {
-    this.bucketSet = bucketSet;
+    this.bucketArray = bucketArray;
-    this.bucketSet = (HashSet) DataSerializer.readHashSet(in);
+    if (InternalDataSerializer.getVersionForDataStream(in).compareTo(Version.GEODE_1_11_0) >= 0) {
+      this.bucketArray = DataSerializer.readIntArray(in);
+    } else {
+      HashSet<Integer> bucketSet = DataSerializer.readHashSet(in);
+      this.bucketArray = BucketSetHelper.fromSet(bucketSet);
+    }
-    DataSerializer.writeHashSet((HashSet) this.bucketSet, out);
+    if (InternalDataSerializer.getVersionForDataStream(out).compareTo(Version.GEODE_1_11_0) >= 0) {
+      DataSerializer.writeIntArray(this.bucketArray, out);
+    } else {
+      Set<Integer> bucketSet = BucketSetHelper.toSet(this.bucketArray);
+      DataSerializer.writeHashSet((HashSet) bucketSet, out);
+    }
-  public Set<Integer> getBucketSet() {
-    return bucketSet;
+  public int[] getBucketArray() {
+    return bucketArray;
-    buff.append(" bucketSet=" + bucketSet + "}");
+    buff.append(" bucketArray=" + Arrays.toString(bucketArray) + "}");

INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS5 INS5 UPD42 INS39 INS85 UPD42 INS5 UPD42 INS25 INS25 INS39 INS85 INS39 INS85 INS27 INS8 INS8 INS27 INS8 INS8 UPD42 UPD42 INS32 INS34 MOV21 INS60 INS21 INS32 INS34 INS21 INS60 MOV21 UPD42 INS32 INS42 INS40 INS74 INS59 INS7 INS32 INS42 INS40 INS32 MOV74 INS59 UPD45 INS32 INS42 INS42 INS42 INS32 MOV43 INS43 INS42 MOV32 INS22 INS32 INS42 INS42 INS42 INS42 INS42 INS22 INS42 INS42 INS32 INS42 INS42 INS42 UPD42 INS42 INS42 INS42 INS42 INS52 INS42 INS42 INS42 INS42 INS52 INS42 INS42 INS42 INS22 INS42 INS52 INS42 DEL42 DEL43 DEL42 DEL43 DEL74 DEL11 DEL52 DEL42 DEL22 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42