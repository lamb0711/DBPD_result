GEODE-1927: more protection from seeing com.gemstone.gemfire packaged objects

DeadlockDetector can read an archive of dependencies across the distributed
system.  This adds a small ObjectInputStream modification to its method that
reads these archives to let it handle those created before the package rename.

+import java.io.IOException;
+import java.io.InputStream;
+import java.io.ObjectStreamClass;
-    ObjectInputStream ois = new ObjectInputStream(new BufferedInputStream(new FileInputStream(file)));
+    ObjectInputStream ois = new DDObjectInputStream(new BufferedInputStream(new FileInputStream(file)));
-  
-  
+
+  private static class DDObjectInputStream extends ObjectInputStream {
+
+    /**
+     * Creates a new <code>DDObjectInputStream</code> that delegates
+     * its behavior to a given <code>InputStream</code>.
+     */
+    public DDObjectInputStream(InputStream stream) throws IOException {
+      super(stream);
+    }
+
+    @Override
+    protected Class resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {
+
+      String className = desc.getName();
+      if (className.startsWith("com.gemstone.gemfire")) {
+        className = "org.apache.geode" + className.substring("com.gemstone.gemfire".length());
+      } try {
+        Class clazz = Class.forName(className);
+        return clazz;
+      } catch (ClassNotFoundException ex) {
+        return super.resolveClass(desc);
+      }
+    }
+  }
+

INS26 INS26 INS26 INS40 INS40 INS40 INS55 INS83 INS83 INS42 MOV43 INS31 INS31 INS29 INS83 INS42 INS44 INS43 INS8 INS78 INS83 INS43 INS42 INS44 INS43 INS43 INS8 MOV43 INS65 INS43 INS42 INS42 INS46 INS42 INS42 INS43 INS42 INS42 INS42 INS60 INS25 INS54 INS66 INS66 INS42 INS42 INS42 INS43 INS59 INS32 INS8 INS8 INS12 INS43 INS42 INS42 INS32 INS42 INS42 INS45 INS21 INS60 INS41 INS44 INS8 INS42 INS42 INS42 INS7 INS43 INS59 INS42 INS43 INS42 INS41 INS42 INS27 INS42 INS42 INS32 INS42 INS48 INS45 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS45 INS42