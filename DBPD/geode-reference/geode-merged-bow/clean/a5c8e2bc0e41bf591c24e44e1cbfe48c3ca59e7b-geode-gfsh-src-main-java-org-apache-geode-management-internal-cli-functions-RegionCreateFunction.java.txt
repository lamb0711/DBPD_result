GEODE-7842: Improve concurrent region creation (#4767)



+import org.apache.geode.annotations.VisibleForTesting;
-import org.apache.geode.cache.Region;
-    if (regionCreateArgs.isIfNotExists()) {
-      Region<Object, Object> region = cache.getRegion(regionCreateArgs.getRegionPath());
-      if (region != null) {
-        resultSender
-            .lastResult(new CliFunctionResult(memberNameOrId, CliFunctionResult.StatusState.OK,
-                CliStrings.format(
-                    CliStrings.CREATE_REGION__MSG__SKIPPING_0_REGION_PATH_1_ALREADY_EXISTS,
-                    memberNameOrId, regionCreateArgs.getRegionPath())));
-        return;
-      }
-    }
-
-      realizer.create(regionCreateArgs.getConfig(), regionCreateArgs.getRegionPath(),
+      getRealizer().create(regionCreateArgs.getConfig(), regionCreateArgs.getRegionPath(),
-      String exceptionMsg =
-          CliStrings.format(CliStrings.CREATE_REGION__MSG__REGION_PATH_0_ALREADY_EXISTS_ON_1,
-              regionCreateArgs.getRegionPath(), memberNameOrId);
-      resultSender.lastResult(handleException(memberNameOrId, exceptionMsg, e));
+      if (regionCreateArgs.isIfNotExists()) {
+        resultSender
+            .lastResult(new CliFunctionResult(memberNameOrId, CliFunctionResult.StatusState.OK,
+                CliStrings.format(
+                    CliStrings.CREATE_REGION__MSG__SKIPPING_0_REGION_PATH_1_ALREADY_EXISTS,
+                    memberNameOrId, regionCreateArgs.getRegionPath())));
+      } else {
+        String exceptionMsg =
+            CliStrings.format(CliStrings.CREATE_REGION__MSG__REGION_PATH_0_ALREADY_EXISTS_ON_1,
+                regionCreateArgs.getRegionPath(), memberNameOrId);
+        resultSender.lastResult(handleException(memberNameOrId, exceptionMsg, e));
+      }
+
+  @VisibleForTesting
+  protected RegionConfigRealizer getRealizer() {
+    return realizer;
+  }

MOV26 UPD40 INS31 INS78 INS83 INS43 INS42 INS8 INS42 INS42 INS41 INS42 MOV25 INS32 MOV32 INS8 UPD42 MOV42 MOV60 MOV21 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL59 DEL60 DEL8 DEL25 DEL42 DEL33 DEL27 DEL41