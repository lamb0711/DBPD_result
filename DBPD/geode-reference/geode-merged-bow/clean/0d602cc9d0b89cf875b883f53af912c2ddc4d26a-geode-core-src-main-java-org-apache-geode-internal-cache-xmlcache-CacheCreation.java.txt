GEODE-8035: Parallel Disk Store Recovery when Cluster Restarts (#5014)

* Add parallel stream for disk store recovery

* Replace synchronized block with CountDownLatch

* Add the new system property parallelDiskStoreRecovery

* Add documentation of the new system property

Authored-by: Jianxia Chen <jchen21@apache.org>
+import java.util.stream.Stream;
+import org.apache.geode.internal.lang.SystemPropertyHelper;
+  @Immutable
+  private static final Optional<Boolean> parallelDiskStoreRecovery = SystemPropertyHelper
+      .getProductBooleanProperty(SystemPropertyHelper.PARALLEL_DISK_STORE_RECOVERY);
+
-    for (DiskStore diskStore : diskStores.values()) {
-      DiskStoreAttributesCreation creation = (DiskStoreAttributesCreation) diskStore;
-      if (creation != pdxRegDSC) {
-        createDiskStore(creation, cache);
-      }
-    }
+    createDiskStores(cache, pdxRegDSC);
+  private void createDiskStores(InternalCache cache, DiskStoreAttributesCreation pdxRegDSC) {
+    Stream<DiskStore> diskStoreStream;
+    if (parallelDiskStoreRecovery.orElse(true)) {
+      diskStoreStream = diskStores.values().parallelStream();
+    } else {
+      diskStoreStream = diskStores.values().stream();
+    }
+    diskStoreStream.forEach(diskStore -> {
+      DiskStoreAttributesCreation creation = (DiskStoreAttributesCreation) diskStore;
+      if (creation != pdxRegDSC) {
+        createDiskStore(creation, cache);
+      }
+    });
+  }
+
+  @Override
+  public void lockDiskStore(String diskStoreName) {
+
+  }
+
+  @Override
+  public void unlockDiskStore(String diskStoreName) {
+
+  }
+

INS26 INS26 INS40 INS40 INS23 INS31 INS31 INS31 INS78 INS83 INS83 INS83 INS74 INS59 INS83 INS39 INS42 INS44 INS44 INS8 INS78 INS83 INS39 INS42 INS44 INS8 INS78 INS83 INS39 INS42 INS44 INS8 INS42 INS43 INS43 INS42 INS32 INS21 INS43 INS42 INS43 INS42 INS60 INS25 INS21 INS42 INS43 INS42 INS42 INS43 INS42 INS42 INS42 INS42 INS42 INS40 INS32 INS42 INS42 INS74 INS59 INS32 INS8 INS8 INS32 INS42 INS42 INS42 INS42 INS42 INS43 MOV43 INS42 INS42 INS42 INS9 INS21 INS21 INS42 INS42 INS86 INS42 INS7 INS7 INS59 MOV8 INS42 INS32 INS42 INS32 INS42 MOV32 INS42 INS32 INS42 INS42 INS42 DEL42 DEL44 DEL70