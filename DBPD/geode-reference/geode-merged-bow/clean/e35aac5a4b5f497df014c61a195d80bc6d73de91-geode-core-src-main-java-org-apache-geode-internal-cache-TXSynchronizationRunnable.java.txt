Merge branch 'release/1.5.0'

+import org.apache.geode.CancelCriterion;
+  private final CancelCriterion cancelCriterion;
+  private final CommBufferPool commBufferPool;
+
-  private final CommBufferPool commBufferPool;
-  public TXSynchronizationRunnable(Runnable beforeCompletion, final CommBufferPool commBufferPool) {
-    this.firstRunnable = beforeCompletion;
+  public TXSynchronizationRunnable(final CancelCriterion cancelCriterion,
+      final CommBufferPool commBufferPool, final Runnable beforeCompletion) {
+    this.cancelCriterion = cancelCriterion;
+    this.firstRunnable = beforeCompletion;
+  @Override
-      // from sitting around forever in the event the client goes away
+      // from sitting around forever if the client goes away
-        if (this.secondRunnable == null) {
-          InternalCache cache = GemFireCacheImpl.getInstance();
-          if (cache == null || cache.getCancelCriterion().isCancelInProgress()) {
-            return;
-          }
-        }
-        // we really need the Cache Server's cancel criterion here, not the cache's
-        // but who knows how to get it?
-        InternalCache cache = GemFireCacheImpl.getInstance();
-        if (cache == null) {
-          return;
-        }
-        cache.getCancelCriterion().checkCancelInProgress(null);
+        cancelCriterion.checkCancelInProgress(null);
-        // we really need the Cache Server's cancel criterion here, not the cache's
-        // but who knows how to get it?
-        InternalCache cache = GemFireCacheImpl.getInstance();
-        if (cache == null) {
-          return;
-        }
-        cache.getCancelCriterion().checkCancelInProgress(null);
+        cancelCriterion.checkCancelInProgress(null);

INS26 MOV23 INS40 INS23 MOV44 INS83 INS83 INS43 INS59 INS44 MOV21 INS78 INS42 INS42 INS83 INS43 INS42 INS83 INS21 INS42 INS42 INS7 INS22 INS42 INS52 INS42 UPD42 MOV42 UPD42 MOV42 DEL52 DEL42 DEL22 DEL33 DEL27 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL42 DEL42 DEL32 DEL42 DEL32 DEL27 DEL41 DEL8 DEL25 DEL8 DEL25 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL41 DEL8 DEL25 DEL42 DEL32 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL41 DEL8 DEL25 DEL42 DEL32