GEODE-6863: Ignoring IllegalStateException (#3719)

        * Ignoring IllegalStateException if the server is no more running.
	* If the server is not running then getting external address will result in IllegalStateException.
	* The server may shut down in between isRunning and getExternalAddress calls.
	* If this happens then the server is not added to the location list of the servers hosting bucket.


+import static org.apache.geode.internal.cache.CacheServerImpl.CACHE_SERVER_BIND_ADDRESS_NOT_AVAILABLE_EXCEPTION_MESSAGE;
+
-      InternalCache cache = getProxyBucketRegion().getCache();
-      List<CacheServer> servers = cache.getCacheServers();
-
-      HashSet<BucketServerLocation66> serverLocations = new HashSet<>();
-      for (CacheServer cacheServer : servers) {
-        CacheServerImpl server = (CacheServerImpl) cacheServer;
-        if (server.isRunning() && (server.getExternalAddress() != null)) {
-          BucketServerLocation66 location = new BucketServerLocation66(getBucket().getId(),
-              server.getPort(), server.getExternalAddress(), getBucket().isPrimary(),
-              Integer.valueOf(version).byteValue(), server.getCombinedGroups());
-          serverLocations.add(location);
-        }
-      }
-      if (serverLocations.size() > 0) {
-        return new ServerBucketProfile(memberId, version, getBucket(), serverLocations);
+      Set<BucketServerLocation66> serverLocations = getBucketServerLocations(version);
+      if (!serverLocations.isEmpty()) {
+        return new ServerBucketProfile(memberId, version, getBucket(), (HashSet) serverLocations);
+  protected Set<BucketServerLocation66> getBucketServerLocations(int version) {
+    InternalCache cache = getProxyBucketRegion().getCache();
+    List<CacheServer> servers = cache.getCacheServers();
+    if (servers.isEmpty()) {
+      return Collections.emptySet();
+    }
+    HashSet<BucketServerLocation66> serverLocations = new HashSet<>();
+    for (CacheServer cacheServer : servers) {
+      CacheServerImpl server = (CacheServerImpl) cacheServer;
+      try {
+        String serverExternalAddress;
+        if (server.isRunning() && ((serverExternalAddress = server.getExternalAddress()) != null)) {
+          BucketServerLocation66 location = new BucketServerLocation66(getBucket().getId(),
+              server.getPort(), serverExternalAddress, getBucket().isPrimary(),
+              Integer.valueOf(version).byteValue(), server.getCombinedGroups());
+          serverLocations.add(location);
+        }
+      } catch (IllegalStateException e) {
+        if (!(e.getMessage() != null
+            && e.getMessage().equals(CACHE_SERVER_BIND_ADDRESS_NOT_AVAILABLE_EXCEPTION_MESSAGE))) {
+          throw e;
+        }
+      }
+    }
+    return serverLocations;
+  }
+

INS26 INS40 INS31 MOV78 INS83 MOV43 INS42 MOV44 INS44 INS8 INS74 INS42 MOV8 INS39 INS42 INS25 MOV41 INS43 INS43 INS25 INS41 MOV38 INS8 INS42 INS42 INS32 INS8 INS8 INS42 INS60 MOV25 INS42 INS42 INS41 MOV60 INS54 INS74 INS59 INS38 INS32 MOV8 INS12 INS43 INS43 INS42 INS32 INS32 INS42 INS42 INS60 INS44 INS8 INS42 INS42 INS42 INS42 MOV42 UPD42 MOV42 INS43 INS59 INS43 INS42 INS25 INS11 INS42 INS42 INS42 INS38 INS8 INS43 INS42 INS36 INS53 INS42 INS36 INS27 INS42 INS7 INS42 INS27 INS32 INS42 MOV32 INS32 INS33 INS32 INS42 INS42 INS42 INS42 INS42 INS42 DEL32 DEL34 DEL27 DEL42 DEL42 DEL42 DEL42 DEL32 DEL25 DEL8