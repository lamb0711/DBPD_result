Merge branch 'release/1.5.0'

-    GFSnapshotImporter imp = new GFSnapshotImporter(new File(args[0]));
+    GFSnapshotImporter imp = new GFSnapshotImporter(new File(args[0]), null);
+   * @param cache
-  public static SnapshotWriter create(File snapshot, String region) throws IOException {
-    final GFSnapshotExporter out = new GFSnapshotExporter(snapshot, region);
+  public static SnapshotWriter create(File snapshot, String region, InternalCache cache)
+      throws IOException {
+    final GFSnapshotExporter out = new GFSnapshotExporter(snapshot, region, cache);
-  public static <K, V> SnapshotIterator<K, V> read(final File snapshot)
+  public static <K, V> SnapshotIterator<K, V> read(final File snapshot, TypeRegistry typeRegistry)
-      GFSnapshotImporter in = new GFSnapshotImporter(snapshot);
+      GFSnapshotImporter in = new GFSnapshotImporter(snapshot, typeRegistry);
+    private final InternalCache cache;
-    public GFSnapshotExporter(File out, String region) throws IOException {
+    public GFSnapshotExporter(File out, String region, InternalCache cache) throws IOException {
+      this.cache = cache;
-        InternalCache cache = GemFireCacheImpl
-            .getForPdx("PDX registry is unavailable because the Cache has been closed.");
-    public GFSnapshotImporter(File in) throws IOException, ClassNotFoundException {
+    public GFSnapshotImporter(File in, TypeRegistry typeRegistry)
+        throws IOException, ClassNotFoundException {
-      checkPdxTypeCompatibility();
-      checkPdxEnumCompatibility();
+      checkPdxTypeCompatibility(typeRegistry);
+      checkPdxEnumCompatibility(typeRegistry);
-    private TypeRegistry getRegistry() {
-      InternalCache gfc = GemFireCacheImpl.getInstance();
-      if (gfc != null) {
-        return gfc.getPdxRegistry();
-      }
-      return null;
-    }
-
-    private void checkPdxTypeCompatibility() {
-      TypeRegistry tr = getRegistry();
+    private void checkPdxTypeCompatibility(TypeRegistry tr) {
-    private void checkPdxEnumCompatibility() {
-      TypeRegistry tr = getRegistry();
+    private void checkPdxEnumCompatibility(TypeRegistry tr) {

INS44 INS44 INS23 INS65 MOV43 INS42 INS43 INS42 INS83 INS83 INS43 INS59 INS44 INS44 INS44 INS44 INS42 INS42 INS42 INS42 MOV43 INS42 INS21 MOV43 INS42 MOV43 INS42 MOV43 INS42 INS7 INS33 INS42 INS22 INS42 INS42 INS42 MOV43 INS52 INS42 MOV43 INS42 DEL42 DEL42 DEL42 DEL45 DEL32 DEL59 DEL60 DEL83 DEL42 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL42 DEL42 DEL32 DEL41 DEL8 DEL25 DEL33 DEL41 DEL8 DEL31 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL42 DEL32 DEL59 DEL60