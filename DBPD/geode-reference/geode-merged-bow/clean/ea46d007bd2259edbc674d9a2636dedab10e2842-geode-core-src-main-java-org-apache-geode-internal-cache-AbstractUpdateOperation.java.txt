Merge pull request #3044 from gesterzhou/feature/GEODE-3967

GEODE-3967: fix the offheap memory leak in serial gateway sender's unâ€¦
+  private static boolean checkIfToUpdateAfterCreateFailed(LocalRegion rgn, EntryEventImpl ev) {
+    // Try to create is failed due to found the entry exist, double check if should update
+    boolean doUpdate = true;
+    if (ev.oldValueIsDestroyedToken()) {
+      if (rgn.getVersionVector() != null && ev.getVersionTag() != null) {
+        rgn.getVersionVector().recordVersion(
+            (InternalDistributedMember) ev.getDistributedMember(), ev.getVersionTag());
+      }
+      doUpdate = false;
+    }
+    if (ev.isConcurrencyConflict()) {
+      if (logger.isDebugEnabled()) {
+        logger.debug("basicUpdate failed with CME, not to retry:" + ev);
+      }
+      doUpdate = false;
+    }
+    return doUpdate;
+  }
+
-            if (ev.oldValueIsDestroyedToken()) {
-              if (rgn.getVersionVector() != null && ev.getVersionTag() != null) {
-                rgn.getVersionVector().recordVersion(
-                    (InternalDistributedMember) ev.getDistributedMember(), ev.getVersionTag());
-              }
-              doUpdate = false;
-            }
+            doUpdate = checkIfToUpdateAfterCreateFailed(rgn, ev);
-                rgn.basicUpdate(ev, true /* ifNew */, false/* ifOld */, lastMod,
+                rgn.basicUpdate(ev, false /* ifNew */, false/* ifOld */, lastMod,

INS31 INS83 INS83 INS39 INS42 INS44 INS44 MOV8 INS43 INS42 INS43 INS42 INS60 INS25 INS41 INS42 INS42 INS39 INS59 INS32 INS8 INS42 INS42 INS9 INS42 INS42 INS25 INS21 INS32 INS8 INS7 INS42 INS42 INS21 INS42 INS9 INS32 INS42 INS42 INS27 INS45 INS42 INS8 INS21 INS7 INS42 INS32 INS42 INS42 INS42 UPD9