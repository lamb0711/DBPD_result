GEODE-8078: log and report error at the correct place. (#5111)

* For get operation, if cache is not ready, just don't report any runtime information
* do not log the CacheClosedException
+import org.apache.geode.annotations.VisibleForTesting;
+import org.apache.geode.cache.CacheClosedException;
-    RemoteInputStream jarStream = (RemoteInputStream) context.getArguments().get(2);
-    InternalCache cache = (InternalCache) context.getCache();
-    try {
-      if (operation == CacheElementOperation.GET) {
+    // for get operation, caller is expecting RuntimeInfo
+    if (operation == CacheElementOperation.GET) {
+      try {
+        InternalCache cache = (InternalCache) context.getCache();
-      } else {
+      } catch (CacheClosedException e) {
+        // cache not ready or closed already, no need to log and do not return any runtime info
+        context.getResultSender().lastResult(null);
+      } catch (Exception e) {
+        logError("Unable to gather runtime information on this member. ", e);
+        context.getResultSender().lastResult(null);
+      }
+    }
+    // for other operations, caller is expecting RealizationResult
+    else {
+      try {
+        RemoteInputStream jarStream = (RemoteInputStream) context.getArguments().get(2);
+        InternalCache cache = (InternalCache) context.getCache();
+      } catch (CacheClosedException e) {
+        // cache not ready or closed already, no need to log it
+        context.getResultSender().lastResult(new RealizationResult()
+            .setSuccess(false)
+            .setMessage(e.getMessage()));
+      } catch (Exception e) {
+        logError("unable to update cache with the configuration.", e);
+        context.getResultSender().lastResult(new RealizationResult()
+            .setSuccess(false)
+            .setMemberName(context.getMemberName())
+            .setMessage(e.getMessage()));
-    } catch (Exception e) {
-      logger.error(e.getMessage(), e);
-      context.getResultSender().lastResult(new RealizationResult()
-          .setSuccess(false)
-          .setMemberName(context.getMemberName())
-          .setMessage(e.getMessage()));
+  }
+  @VisibleForTesting
+  void logError(String s, Exception e) {
+    logger.error(s, e);
-    // set the membername if this is not a global runtime
+    // set the member name if this is not a global runtime

INS26 INS26 INS40 INS40 INS31 INS78 INS39 INS42 INS44 INS44 INS8 INS25 INS42 INS43 INS42 INS43 INS42 INS21 MOV27 INS8 INS8 INS42 INS42 INS32 INS54 MOV54 INS42 INS42 INS42 INS42 MOV8 INS12 INS12 MOV8 INS12 INS60 INS44 INS8 INS44 INS8 MOV60 MOV60 INS44 INS8 INS43 INS59 INS43 INS42 INS21 INS43 INS42 INS21 INS21 INS43 INS42 INS21 INS42 INS42 INS11 INS42 INS32 INS42 INS32 INS32 INS42 INS32 INS43 INS32 INS32 INS42 INS33 INS42 INS45 INS42 INS32 INS42 INS33 INS32 INS42 INS32 UPD42 INS45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 MOV32 INS14 INS42 INS9 INS43 INS42 DEL25 DEL8 DEL42