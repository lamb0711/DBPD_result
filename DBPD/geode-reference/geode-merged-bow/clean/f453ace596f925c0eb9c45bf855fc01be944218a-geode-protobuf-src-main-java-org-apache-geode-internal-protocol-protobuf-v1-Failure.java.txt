GEODE-4705: Refactor Failure.of to handle protobuf builder code. (#1472)


+import org.apache.geode.internal.protocol.protobuf.v1.state.exception.ConnectionStateException;
-public class Failure<SuccessType, FailureType> implements Result<SuccessType, FailureType> {
-  private final FailureType failureType;
+public class Failure<SuccessType> implements Result<SuccessType> {
+  private final ClientProtocol.ErrorResponse failureType;
-  private Failure(FailureType failureType) {
+  private Failure(ClientProtocol.ErrorResponse failureType) {
-  public static <T, V> Failure<T, V> of(V errorResponse) {
-    return new Failure<>(errorResponse);
+  public static <T> Failure<T> of(BasicTypes.ErrorCode errorCode, String errorMessage) {
+    return new Failure<>(ClientProtocol.ErrorResponse.newBuilder()
+        .setError(BasicTypes.Error.newBuilder().setErrorCode(errorCode).setMessage(errorMessage))
+        .build());
+  }
+
+  public static <T> Failure<T> of(ConnectionStateException exception) {
+    return of(exception.getErrorCode(), exception.getMessage());
+  }
+
+  public static <T> Failure<T> of(Exception exception) {
+    if (exception instanceof ConnectionStateException) {
+      return of((ConnectionStateException) exception);
+    }
+    return of(BasicTypes.ErrorCode.SERVER_ERROR, exception.toString());
-      Function<FailureType, T> errorFunction) {
+      Function<ClientProtocol.ErrorResponse, T> errorFunction) {
-  public FailureType getErrorMessage() {
+  public ClientProtocol.ErrorResponse getErrorMessage() {

INS26 INS40 UPD74 INS23 INS31 INS31 MOV83 MOV83 INS43 MOV59 INS83 INS83 MOV73 UPD74 MOV74 INS42 INS44 INS44 INS8 INS83 INS83 INS73 INS74 INS42 INS44 INS8 INS74 INS8 UPD43 INS40 UPD43 INS43 INS42 INS43 INS42 INS41 INS42 INS43 INS43 INS43 INS42 INS41 UPD42 INS43 INS43 UPD43 UPD42 INS25 INS41 UPD74 INS40 INS40 INS40 INS42 INS14 UPD42 MOV42 INS42 INS42 INS32 INS42 INS42 UPD42 INS62 INS8 INS32 UPD43 MOV74 INS32 INS42 INS32 INS32 INS42 INS43 MOV41 INS42 INS40 INS32 INS40 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS32 INS42 INS11 INS40 INS42 INS32 INS42 INS42 INS43 INS42 INS32 INS42 INS42 INS42 INS40 INS42 DEL42 DEL73 DEL42 DEL43 DEL43 DEL23 DEL42 DEL42 DEL43 DEL42 DEL14 DEL8 DEL42 DEL42