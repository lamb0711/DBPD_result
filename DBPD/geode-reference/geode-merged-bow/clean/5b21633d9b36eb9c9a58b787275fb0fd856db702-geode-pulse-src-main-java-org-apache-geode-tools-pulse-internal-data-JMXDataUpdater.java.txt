GEODE-3456: Fix display of 'null' hosts in Pulse UI (#1717)


-import java.lang.reflect.Array;
-      // Cluster Members
+      List<ObjectName> serviceMBeans = new ArrayList<>();
+      List<ObjectName> nonServiceMBeans = new ArrayList<>();
+
-      for (ObjectName memMBean : memberMBeans) {
-        String service = memMBean.getKeyProperty(PulseConstants.MBEAN_KEY_PROPERTY_SERVICE);
+      for (ObjectName mBean : memberMBeans) {
+        String service = mBean.getKeyProperty(PulseConstants.MBEAN_KEY_PROPERTY_SERVICE);
-          // Cluster Member
-          updateClusterMember(memMBean);
+          nonServiceMBeans.add(mBean);
-          switch (service) {
-            case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_REGION:
-              updateMemberRegion(memMBean);
-              break;
-            case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_CACHESERVER:
-              updateMemberClient(memMBean);
-              break;
-            case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_GATEWAYRECEIVER:
-              updateGatewayReceiver(memMBean);
-              break;
-            case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_GATEWAYSENDER:
-              updateGatewaySender(memMBean);
-              break;
-            case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_ASYNCEVENTQUEUE:
-              updateAsyncEventQueue(memMBean);
-              break;
-            case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_LOCATOR:
-              updateClusterMember(memMBean);
-              break;
-          }
+          serviceMBeans.add(mBean);
+        }
+      }
+
+      // Make sure that we process 'pure' members first. This ensures that various structures in
+      // Cluster are set up correctly since they are keyed on the 'host' attribute which does not
+      // necessarily appear in other MBeans. This avoids the possibility of having a 'null' host
+      // icon appear in the Pulse UI.
+      for (ObjectName mBean : nonServiceMBeans) {
+        updateClusterMember(mBean);
+      }
+
+      for (ObjectName serviceMBean : serviceMBeans) {
+        String service = serviceMBean.getKeyProperty(PulseConstants.MBEAN_KEY_PROPERTY_SERVICE);
+        switch (service) {
+          case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_REGION:
+            updateMemberRegion(serviceMBean);
+            break;
+          case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_CACHESERVER:
+            updateMemberClient(serviceMBean);
+            break;
+          case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_GATEWAYRECEIVER:
+            updateGatewayReceiver(serviceMBean);
+            break;
+          case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_GATEWAYSENDER:
+            updateGatewaySender(serviceMBean);
+            break;
+          case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_ASYNCEVENTQUEUE:
+            updateAsyncEventQueue(serviceMBean);
+            break;
+          case PulseConstants.MBEAN_KEY_PROPERTY_SERVICE_VALUE_LOCATOR:
+            updateClusterMember(serviceMBean);
+            break;

INS60 INS60 INS70 INS70 INS70 INS74 INS59 INS74 INS59 MOV44 MOV42 INS8 INS44 INS42 INS8 INS44 INS42 INS8 INS43 INS43 INS42 INS14 INS43 INS43 INS42 INS14 UPD42 MOV60 INS25 INS43 INS42 MOV21 INS43 INS42 INS60 MOV50 INS42 INS42 INS74 INS42 INS42 INS74 MOV27 INS8 INS8 INS42 INS42 INS43 INS59 INS43 INS43 INS21 INS21 UPD42 INS42 INS42 INS32 INS42 INS42 UPD42 INS32 INS32 INS42 INS42 INS40 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 INS42 INS42 INS42 INS42 INS42 INS42 DEL40 DEL26 DEL8 DEL8 DEL25 DEL8 DEL70