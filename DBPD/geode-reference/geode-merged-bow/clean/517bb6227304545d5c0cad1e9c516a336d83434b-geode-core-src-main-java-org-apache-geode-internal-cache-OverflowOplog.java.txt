GEODE-2472 changes are made to ensure byte array is completely flushed to oplog channel.

The Oplog and OverflowOplog flush(OplogFile olf, ByteBuffer b1, ByteBuffer b2) method doesn't check the results of the channel.write() call.

It could so happen partial byte array is written to the channel. The check is added to make sure the bytes are completely written to the file channel.

-
-    this.bbArray[0] = this.crf.writeBuf;
-      this.bbArray[0] = null;
+  /**
+   * Method to be used only for testing
+   * 
+   * @param ch Object to replace the channel in the Oplog.crf
+   * @return original channel object
+   */
+  FileChannel testSetCrfChannel(FileChannel ch) {
+    FileChannel chPrev = this.crf.channel;
+    this.crf.channel = ch;
+    return chPrev;
+  }
+
-        assert b1 == olf.writeBuf;
-        b1.flip();
+        this.bbArray[0] = b1;
-        long flushed = olf.channel.write(this.bbArray);
+        b1.flip();
+        long flushed = 0;
+        do {
+          flushed += olf.channel.write(this.bbArray);
+        } while (b2.hasRemaining());
+        this.bbArray[0] = null;

INS31 INS29 INS43 INS42 INS44 INS8 INS65 INS65 INS65 INS42 INS43 INS42 INS60 INS21 INS41 INS66 INS42 INS66 INS66 INS42 INS43 INS59 INS7 INS42 INS42 INS42 MOV22 INS22 INS42 UPD42 INS22 INS42 MOV21 INS52 INS42 MOV21 INS19 MOV21 INS8 INS32 INS42 INS34 INS21 INS42 INS42 INS7 INS42 MOV32 DEL42 DEL40 DEL27 DEL6