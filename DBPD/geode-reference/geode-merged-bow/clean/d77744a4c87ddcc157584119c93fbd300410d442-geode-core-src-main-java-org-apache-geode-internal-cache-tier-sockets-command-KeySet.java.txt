GEODE-5186: set operation in a client transaction could cause the transaction to hang (#1967)

GEODE-5186: Do not retry set operation on partitioned region if in a transaction.
FetchKeyMessage will be sent to peer members as non transactional if it is sent from the transaction host member.

+import org.apache.geode.cache.TransactionException;
+import org.apache.geode.internal.cache.TXManagerImpl;
+    if (isInTransaction() && region.getPartitionAttributes() != null) {
+      // GEODE-5186: fail the the transaction if it is a retry after failover for keySet on
+      // partitioned region
+      if (clientMessage.isRetry()) {
+        keySetWriteChunkedException(clientMessage,
+            new TransactionException(
+                "Failover on a set operation of a partitioned region is not allowed in a transaction."),
+            serverConnection);
+        serverConnection.setAsTrue(RESPONDED);
+        return;
+      }
+    }
+
-      writeChunkedException(clientMessage, ex, serverConnection);
+      keySetWriteChunkedException(clientMessage, ex, serverConnection);
+  protected void keySetWriteChunkedException(Message clientMessage, Throwable ex,
+      ServerConnection serverConnection) throws IOException {
+    writeChunkedException(clientMessage, ex, serverConnection);
+  }
+
+  boolean isInTransaction() {
+    return TXManagerImpl.getCurrentTXState() != null;
+  }

INS26 INS26 INS40 INS40 INS31 INS31 INS83 INS39 INS42 INS44 INS44 INS44 INS43 MOV8 INS39 INS42 INS8 INS25 INS43 INS42 INS43 INS42 INS43 INS42 INS42 INS41 INS27 INS8 INS42 INS42 INS42 INS27 INS32 INS27 INS25 INS8 INS32 INS33 INS42 INS32 INS33 INS32 INS8 INS21 INS21 INS41 INS42 INS42 INS42 INS42 INS42 INS42 INS21 MOV21 INS41 INS32 INS32 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS14 INS42 INS43 INS45 INS42 DEL41