merge of develop to feature/GEODE-77

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

Conflicts:
	gemfire-core/build.gradle
	gemfire-core/src/main/java/com/gemstone/gemfire/internal/cache/LocalRegion.java
	gemfire-jgroups/build.gradle

+import java.util.ServiceLoader;
-import com.gemstone.gemfire.cache.lucene.LuceneService;
-import com.gemstone.gemfire.cache.lucene.LuceneServiceProvider;
+import com.gemstone.gemfire.internal.concurrent.ConcurrentHashSet;
-public class GemFireCacheImpl implements InternalCache, ClientCache, HasCachePerfStats, DistributionAdvisee, Extensible<Cache> {
+public class GemFireCacheImpl implements InternalCache, ClientCache, HasCachePerfStats, DistributionAdvisee {
+  
+  /**
+   * The list of all async event queues added to the cache. 
+   * CopyOnWriteArrayList is used to allow concurrent add, remove and retrieval operations.
+   */
+  private volatile Set<AsyncEventQueue> allVisibleAsyncEventQueues = new CopyOnWriteArraySet<AsyncEventQueue>();
-  private final LuceneService luceneService;
-
+  private final Set<RegionListener> regionListeners = new ConcurrentHashSet<RegionListener>();
+  
+  private final Map<Class<? extends CacheService>, CacheService> services = new HashMap<Class<? extends CacheService>, CacheService>();
+  
-      this.luceneService = LuceneServiceProvider.create(this);
-
+    initializeServices();
+    
+
+  /**
+   * Initialize any services that provided as extensions to the cache using the
+   * service loader mechanism.
+   */
+  private void initializeServices() {
+    ServiceLoader<CacheService> loader = ServiceLoader.load(CacheService.class);
+    for(CacheService service : loader) {
+      service.init(this);
+      this.services.put(service.getInterface(), service);
+    }
+  }
+    attrs = invokeRegionBefore(null, name, attrs, internalRegionArgs);
+    invokeRegionAfter(rgn);
+  public RegionAttributes invokeRegionBefore(LocalRegion parent,
+      String name, RegionAttributes attrs, InternalRegionArguments internalRegionArgs) {
+    for(RegionListener listener : regionListeners) {
+      attrs = listener.beforeCreate(parent, name, attrs, internalRegionArgs);
+    }
+    return attrs;
+  }
+  
+  public void invokeRegionAfter(LocalRegion region) {
+    for(RegionListener listener : regionListeners) {
+      listener.afterCreate(region);
+    }
+  }
+
+  
+  public void addRegionListener(RegionListener l ) {
+    this.regionListeners.add(l);
+  }
+  
+  public void removeRegionListener(RegionListener l ) {
+    this.regionListeners.remove(l);
+  }
+  
+  @SuppressWarnings("unchecked")
+  public <T extends CacheService> T getService(Class<T> clazz) {
+    return (T) services.get(clazz);
+  }
-  public void addAsyncEventQueue(AsyncEventQueue asyncQueue) {
+  public void addAsyncEventQueue(AsyncEventQueueImpl asyncQueue) {
+    if(!asyncQueue.isMetaQueue()) {
+      this.allVisibleAsyncEventQueues.add(asyncQueue);
+    }
-    return this.allAsyncEventQueues;
+    return this.allVisibleAsyncEventQueues;
+      this.allVisibleAsyncEventQueues.remove(asyncQueue);
-  
-  /**
-   * get reference to LuceneService singleton
-   * @return LuceneService
-   */
-  public LuceneService getLuceneService() {
-    return this.luceneService;
-  }

MOV26 MOV26 MOV31 UPD40 UPD40 INS23 INS23 INS31 INS31 INS31 INS31 INS31 INS31 INS29 INS83 INS83 INS74 INS59 INS83 INS83 INS74 INS59 INS74 INS29 INS83 INS39 INS42 INS8 INS83 INS43 INS42 INS44 INS44 INS44 INS44 INS8 INS83 INS39 INS42 INS44 INS8 INS39 UPD42 INS44 MOV83 INS39 INS42 INS44 INS8 INS79 INS83 INS73 INS43 UPD42 MOV42 INS44 INS8 INS83 MOV74 INS42 MOV8 INS65 UPD43 MOV43 UPD43 MOV43 INS42 INS14 INS43 INS43 INS42 INS14 INS43 INS74 INS43 INS42 INS14 INS21 INS65 INS60 INS70 INS21 INS21 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS70 INS41 INS43 INS42 INS70 INS43 INS42 INS21 INS43 INS42 INS21 INS42 INS45 INS42 INS43 INS42 INS74 INS42 INS41 UPD43 INS25 INS66 INS66 UPD42 UPD42 INS74 INS42 INS42 INS74 INS42 INS43 INS76 INS42 INS74 INS32 INS66 INS66 INS74 INS59 INS44 INS42 INS8 INS7 INS32 INS42 INS42 INS42 INS42 INS44 INS42 INS8 INS42 INS42 INS44 INS42 INS8 INS42 INS32 INS42 INS32 UPD42 MOV42 INS43 INS43 INS11 UPD42 INS38 INS8 INS43 INS43 INS43 INS43 INS42 INS43 INS43 INS74 INS43 INS42 INS43 INS43 INS42 INS32 INS43 INS42 INS21 INS21 INS42 INS32 INS42 INS42 INS43 INS42 INS21 INS43 INS42 INS21 INS22 INS42 INS42 INS22 INS42 INS42 INS42 INS42 INS43 INS32 INS32 INS21 UPD42 INS21 INS42 INS42 INS42 INS42 UPD42 MOV42 INS42 INS43 INS76 INS42 INS42 INS42 INS42 INS42 INS57 INS42 INS32 INS32 INS42 INS33 INS42 INS42 INS42 INS42 INS7 INS42 INS32 MOV52 UPD42 MOV42 INS52 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS32 INS42 INS43 INS43 INS42 INS42 INS52 INS22 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS22 INS42 INS42 INS22 INS42 INS42 INS42 INS42 INS52 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS52 INS42 INS52 INS42 DEL74 DEL43 DEL42 DEL52 DEL42 DEL22 DEL42 DEL42 DEL52 DEL32 DEL7 DEL21 DEL22 DEL41 DEL66 DEL65 DEL66 DEL65 DEL29 DEL43 DEL31