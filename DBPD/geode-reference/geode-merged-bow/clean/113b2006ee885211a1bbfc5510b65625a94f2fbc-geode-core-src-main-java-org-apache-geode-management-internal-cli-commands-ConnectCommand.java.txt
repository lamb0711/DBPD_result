GEODE-5194: allow gfsh to connect if serialization version matches (#4202)

* GEODE-5194: allow gfsh to connect if serialization version matches

This builds on the previous work that relaxed the version check to
ignore patch version changes.  Now even differing minor versions may be
compatible (i.e. no changes to gfsh commands or options).  Serialization
version is not a perfect proxy for when gfsh commands have changed, but
this is at least an improvement over the previous check...

Co-authored-by: Jinmei Liao <jiliao@pivotal.io>

* empty

* rename geodeVersion to geodeSerializationVersion to more accurately reflect what it represents

-      remoteVersion = invoker.getRemoteVersion();
-      if (versionComponent(remoteVersion, VERSION_MAJOR)
-          .equalsIgnoreCase(versionComponent(gfshVersion, VERSION_MAJOR))
-          && versionComponent(remoteVersion, VERSION_MINOR)
-              .equalsIgnoreCase(versionComponent(gfshVersion, VERSION_MINOR))) {
+      String gfshGeodeSerializationVersion = gfsh.getGeodeSerializationVersion();
+      String remoteGeodeSerializationVersion = invoker.getRemoteGeodeSerializationVersion();
+      if (hasSameMajorMinor(gfshGeodeSerializationVersion, remoteGeodeSerializationVersion)) {
-      gfsh.logInfo("failed to get the the remote version.", e);
+      // we failed to get the remote geode serialization version; get remote product version for
+      // error message
+      try {
+        remoteVersion = invoker.getRemoteVersion();
+      } catch (Exception ex) {
+        gfsh.logInfo("failed to get the the remote version.", ex);
+      }
-  private String versionComponent(String version, int component) {
+  private static boolean hasSameMajorMinor(String gfshVersion, String remoteVersion) {
+    return versionComponent(remoteVersion, VERSION_MAJOR)
+        .equalsIgnoreCase(versionComponent(gfshVersion, VERSION_MAJOR))
+        && versionComponent(remoteVersion, VERSION_MINOR)
+            .equalsIgnoreCase(versionComponent(gfshVersion, VERSION_MINOR));
+  }
+
+  private static String versionComponent(String version, int component) {

INS31 INS83 INS83 INS39 INS42 INS44 INS44 MOV8 INS83 INS54 INS43 INS42 INS43 INS42 INS41 INS8 INS12 INS42 INS42 MOV27 INS60 INS60 INS25 MOV44 INS8 INS43 INS59 INS43 INS59 INS32 MOV8 MOV54 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS8 INS42 INS42 INS42 INS42 MOV21 INS44 INS43 INS42 INS42 UPD42 DEL25