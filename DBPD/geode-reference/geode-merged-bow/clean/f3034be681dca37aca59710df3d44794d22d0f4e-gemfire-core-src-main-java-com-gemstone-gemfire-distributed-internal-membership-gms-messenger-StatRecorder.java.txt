GEODE-77: bug fixes

GMSHealthMonitorJUnitTest was incorrectly using Mockito's any() when it should
have used isA().  Fixing this exposed a lot of problems in the health monitor
that this checkin addresses.  I've also renamed a number of entities so that we
now have more uniform use of the term "heartbeat" instead of "check".

GMSHealthMonitor now has a positive heartbeat sender thread that determines
who might be watching it and sends unsolicited heartbeats to those members.

GMSHealthMonitor now sends the viewID of its membership ID in TCP/IP
health checks.  This enables the receiver to differentiate between the
received UUID/viewID and its own information when it is a reconnected
member (using auto-reconnect).  The response threads are now also moved
to a cached thread-pool to decrease the cost of these checks.  Responses
now have soLinger set on them (experimental) because I was seeing a lot
of checks fail with EOF even though the member wrote an OK status.

The health monitor now uses suspectMembersInView to avoid suspecting the
same member over and over again.  This means that it can't be used to
avoid duplicate final-checks.  I've also disabled the collection thread for
suspect events because it was adding unnecessary delay in initiating
final-checks on crashed members and I have yet to see it collect more than
one event.

SuspectMembersMessage processing now checks to see if the receiver is the
target of the suspicion and, if so, send a heartbeat to the sender.  This
seems to happen a lot when the membership coordinator is a locator because
the locator doesn't push operations out to other members very often.  The
positive heartbeat sender will also help with this.

This change-set also turns off the JGroups thread pools because they were found
to be causing our performance problem.  This exposed a bug in JGroups that they
are fixing, but for now there is a workaround in StatRecorder.  Along with the
removal of thread pools we now need to pass messages through
handleOrDeferMessage() in GMSMembershipManager since processMessage() can be
blocked during initialization, causing a new process to time out trying to join
the distributed system.

GMSJoinLeave was not setting the failure detection ports on a new view if it
abandoned a view that it could not prepare.

The Connection class had some incorrect checks for shutdown conditions when
the shared/ordered connection to another member is shut down.  This should
improve our detection time for crashed members.

+import org.jgroups.Header;
+import com.gemstone.gemfire.distributed.internal.membership.gms.GMSUtil;
-    FragHeader hdr = (FragHeader)msg.getHeader(frag2HeaderId);
-    if (hdr != null) {
-      String str = direction == OUTGOING? "sending" : "receiving";
-      logger.debug("{} fragment {} msg offset {} msg size {}", str, hdr, msg.getOffset(), msg.getLength());
+    if (direction == INCOMING) {
+      Header h = msg.getHeader(frag2HeaderId);
+      boolean copyBuffer = false;
+      if (h != null && h instanceof FragHeader) {
+        copyBuffer = true;
+//      String str = direction == OUTGOING? "sending" : "receiving";
+//      logger.debug("{} fragment {} msg buffer hash {}  offset {} msg size {} first bytes=\n{}", str, hdr, 
+//          msg.getRawBuffer().hashCode(), msg.getOffset(), msg.getLength(),
+//          GMSUtil.formatBytes(msg.getRawBuffer(), msg.getOffset(),
+//              Math.min(200, msg.getLength())));
+      } else {
+        h = msg.getHeader(unicastHeaderId);
+        if (h instanceof UNICAST3.Header) {
+          copyBuffer = true;
+        } else {
+          h = msg.getHeader(nakackHeaderId);
+          if (h instanceof NakAckHeader2) {
+            copyBuffer = true;
+          }
+        }
+      }
+      if (copyBuffer) {
+        // JGroups doesn't copy its message buffer when thread pools are
+        // disabled.  This causes Frag2 fragments to become corrupted
+        msg.setBuffer(msg.getBuffer(), 0, msg.getLength());
+      }

INS26 INS26 INS40 INS40 INS27 INS8 INS42 INS42 MOV60 INS60 INS25 INS25 UPD43 INS39 INS59 INS27 INS8 INS8 INS42 INS8 UPD42 UPD42 MOV32 INS42 INS9 INS27 INS62 INS21 INS21 INS25 INS21 UPD42 MOV42 MOV33 INS42 MOV43 INS7 INS7 INS62 INS8 INS8 INS32 INS42 INS9 INS42 INS32 INS42 INS43 INS21 INS21 INS25 INS42 INS42 MOV32 INS34 MOV32 INS42 INS42 INS42 INS40 INS7 INS7 INS62 INS8 UPD42 INS42 INS9 INS42 INS32 INS42 INS43 INS21 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS7 INS42 INS9 DEL11 DEL27 DEL42 DEL43 DEL42 DEL42 DEL42 DEL27 DEL45 DEL45 DEL16 DEL59 DEL60 DEL42 DEL45 DEL42 DEL32 DEL21 DEL8