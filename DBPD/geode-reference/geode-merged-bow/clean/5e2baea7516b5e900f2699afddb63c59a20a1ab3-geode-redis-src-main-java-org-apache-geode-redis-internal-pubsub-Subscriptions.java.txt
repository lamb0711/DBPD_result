Feature/expand pubsub support (#5284)

Co-authored-by: Jens Deppe <jdeppe@pivotal.io>
Co-authored-by: Sarah <sabbey@pivotal.io>
Co-authored-by: Darrel Schneider <dschneider@pivotal.io>
+import org.apache.geode.annotations.VisibleForTesting;
+import org.apache.geode.redis.internal.executor.GlobPattern;
+import org.apache.geode.redis.internal.netty.ExecutionHandlerContext;
-  public boolean exists(Object channelOrPattern, Client client) {
+  @VisibleForTesting
+  boolean exists(Object channelOrPattern, Client client) {
-  public void add(Subscription subscription) {
+  @VisibleForTesting
+  void add(Subscription subscription) {
-  public void remove(Object channel, Client client) {
-    subscriptions.removeIf(subscription -> subscription.isEqualTo(channel, client));
+  @VisibleForTesting
+  boolean remove(Object channel, Client client) {
+    return subscriptions.removeIf(subscription -> subscription.isEqualTo(channel, client));
-  public int size() {
+  @VisibleForTesting
+  int size() {
+
+  public synchronized long subscribe(String channel, ExecutionHandlerContext context,
+      Client client) {
+    if (!exists(channel, client)) {
+      add(new ChannelSubscription(client, channel, context));
+    }
+    return findSubscriptions(client).size();
+  }
+
+  public synchronized long psubscribe(GlobPattern pattern, ExecutionHandlerContext context,
+      Client client) {
+    if (!exists(pattern, client)) {
+      add(new PatternSubscription(client, pattern, context));
+    }
+    return findSubscriptions(client).size();
+  }
+
+  public synchronized long unsubscribe(Object channelOrPattern, Client client) {
+    remove(channelOrPattern, client);
+    return findSubscriptions(client).size();
+  }
+

INS26 INS26 INS26 INS40 INS40 INS40 INS31 INS31 INS31 INS78 INS78 INS78 UPD39 INS78 INS83 INS83 INS39 INS42 INS44 INS44 INS44 INS8 INS83 INS83 INS39 INS42 INS44 INS44 INS44 INS8 INS83 INS83 INS39 INS42 INS44 INS44 INS8 INS42 INS42 INS42 INS41 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS25 INS41 INS43 INS42 INS43 INS42 INS43 INS42 INS25 INS41 INS43 INS42 INS43 INS42 INS21 INS41 MOV32 INS42 INS42 INS42 INS38 INS8 INS32 INS42 INS42 INS42 INS38 INS8 INS32 INS42 INS42 INS32 INS32 INS32 INS21 INS32 INS42 INS32 INS21 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS14 INS42 INS14 INS43 INS42 INS42 INS42 INS43 INS42 INS42 INS42 INS42 INS42 DEL83 DEL83 DEL83 DEL21 DEL83