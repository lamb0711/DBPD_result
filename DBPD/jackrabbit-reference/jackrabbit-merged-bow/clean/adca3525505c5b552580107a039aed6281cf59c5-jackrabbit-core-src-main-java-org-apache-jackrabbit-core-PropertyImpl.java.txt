JCR-1104 - JSR 283 support

- improved Node#setPrimaryType implementation

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@652800 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.state.NodeState;
+import org.apache.jackrabbit.core.nodetype.PropDefId;
+import org.apache.jackrabbit.core.nodetype.PropertyDefinitionImpl;
-     * @param id         id of this <code>Property</code>
-     * @param state      state associated with this <code>Property</code>
-     * @param definition definition of <i>this</i> <code>Property</code>
-     * @param listeners  listeners on life cylce changes of this <code>PropertyImpl</code>
+     * @param data       the property data
+    protected void onRedefine(PropDefId defId) throws RepositoryException {
+        PropertyDefinitionImpl newDef =
+                session.getNodeTypeManager().getPropertyDefinition(defId);
+        // modify the state of 'this', i.e. the target property
+        PropertyState thisState = (PropertyState) getOrCreateTransientItemState();
+        // set id of new definition
+        thisState.setDefinitionId(defId);
+        data.setDefinition(newDef);
+    }
+

INS26 INS26 INS26 INS40 INS40 INS40 INS31 INS83 INS39 INS42 INS44 INS43 INS8 INS43 INS42 INS42 INS60 INS60 INS21 INS21 UPD42 UPD66 INS42 INS43 INS59 INS43 INS59 INS32 INS32 INS42 INS42 INS32 INS42 INS42 INS11 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS43 INS32 INS42 INS42 INS42 INS42 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65