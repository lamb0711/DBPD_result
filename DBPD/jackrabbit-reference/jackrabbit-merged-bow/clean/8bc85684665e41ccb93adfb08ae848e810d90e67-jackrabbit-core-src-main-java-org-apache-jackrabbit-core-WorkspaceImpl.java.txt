JCR-1608: JSR 283: Workspace Management

fixed bug in Workspace#createWorkspace(String, String) implementation




git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@798890 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.Node;
+import javax.jcr.NodeIterator;
-            newWsp.clone(srcWorkspace, "/", "/", false);
+            // Workspace#clone(String, String, String, booelan) doesn't
+            // allow to clone to "/"...
+            //newWsp.clone(srcWorkspace, "/", "/", false);
+           Node root = session.getRootNode();
+           for (NodeIterator it = root.getNodes(); it.hasNext(); ) {
+               Node child = it.nextNode();
+               // skip nodes that already exist in newly created workspace
+               if (!tmpSession.nodeExists(child.getPath())) {
+                   newWsp.clone(srcWorkspace, child.getPath(), child.getPath(), false);
+               }
+           }

INS26 INS26 INS40 INS40 INS8 MOV21 MOV60 INS60 INS24 INS43 INS59 INS58 INS32 INS8 INS42 INS42 INS32 INS43 INS59 INS42 INS42 INS60 INS25 INS42 INS42 INS42 INS42 INS32 INS43 INS59 INS38 INS8 INS42 INS42 INS42 INS42 INS32 INS32 MOV21 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS32 INS42 INS42 INS42 INS42 DEL45 DEL45 DEL8