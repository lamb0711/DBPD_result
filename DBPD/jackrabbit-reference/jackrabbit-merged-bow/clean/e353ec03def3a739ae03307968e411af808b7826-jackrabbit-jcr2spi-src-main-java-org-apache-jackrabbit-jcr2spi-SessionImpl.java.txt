JCR-1564: JSR 283 namespace handling
    - Use AbstractSession for namespace handling in jcr2spi
    - LocalNamespaceMappings is no longer needed

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@655569 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.commons.AbstractSession;
-import org.apache.jackrabbit.jcr2spi.name.LocalNamespaceMappings;
-public class SessionImpl implements Session, ManagerProvider {
+public class SessionImpl extends AbstractSession
+        implements NamespaceResolver, ManagerProvider {
-    private final LocalNamespaceMappings nsMappings;
-    private final NamePathResolver npResolver;
+    private NamePathResolver npResolver;
-        nsMappings = new LocalNamespaceMappings(workspace.getNamespaceRegistryImpl());
-        npResolver = new DefaultNamePathResolver(nsMappings, true);
+        npResolver = new DefaultNamePathResolver(this, true);
-     * @see LocalNamespaceMappings#setNamespacePrefix(String, String)
-    public void setNamespacePrefix(String prefix, String uri) throws NamespaceException, RepositoryException {
-        nsMappings.setNamespacePrefix(prefix, uri);
-    }
-
-    /**
-     * @see javax.jcr.Session#getNamespacePrefixes()
-     * @see LocalNamespaceMappings#getPrefixes()
-     */
-    public String[] getNamespacePrefixes() throws RepositoryException {
-        return nsMappings.getPrefixes();
-    }
-
-    /**
-     * @see javax.jcr.Session#getNamespaceURI(String)
-     * @see NamespaceResolver#getURI(String)
-     */
-    public String getNamespaceURI(String prefix) throws NamespaceException, RepositoryException {
-        return nsMappings.getURI(prefix);
-    }
-
-    /**
-     * @see javax.jcr.Session#getNamespacePrefix(String)
-     * @see NamespaceResolver#getPrefix(String)
-     */
-    public String getNamespacePrefix(String uri) throws NamespaceException, RepositoryException {
-        return nsMappings.getPrefix(uri);
+    public void setNamespacePrefix(String prefix, String uri)
+            throws RepositoryException {
+        super.setNamespacePrefix(prefix, uri);
+        // Reset name and path caches
+        npResolver = new DefaultNamePathResolver(this, true);
-        // dispose name nsResolver
-        nsMappings.dispose();
+    //-------------------------------------------------< NamespaceResolver >--
+
+    public String getPrefix(String uri) throws NamespaceException {
+        try {
+            return getNamespacePrefix(uri);
+        } catch (NamespaceException e) {
+            throw e;
+        } catch (RepositoryException e) {
+            throw new NamespaceException("Namespace not found: " + uri, e);
+        }
+    }
+
+    public String getURI(String prefix) throws NamespaceException {
+        try {
+            return getNamespaceURI(prefix);
+        } catch (NamespaceException e) {
+            throw e;
+        } catch (RepositoryException e) {
+            throw new NamespaceException("Namespace not found: " + prefix, e);
+        }
+    }
+
-        return nsMappings;
+        return this;
-    LocalNamespaceMappings getLocalNamespaceMappings() {
-        return nsMappings;
-    }
-

MOV26 UPD40 UPD43 INS43 INS31 INS31 UPD42 UPD42 MOV42 MOV83 MOV43 UPD42 MOV42 MOV44 MOV43 INS8 MOV83 MOV43 UPD42 MOV42 MOV44 MOV43 INS8 INS21 INS54 INS54 INS48 INS7 INS8 INS12 INS12 INS8 INS12 INS12 INS52 INS42 INS42 INS42 INS42 INS14 MOV41 INS44 INS8 INS44 INS8 MOV41 INS44 INS8 INS44 INS8 INS52 INS43 INS52 INS9 MOV43 INS42 INS53 MOV43 INS42 INS53 INS43 INS42 INS53 MOV43 INS42 INS53 INS42 UPD42 UPD42 INS42 INS14 UPD42 UPD42 MOV42 INS42 INS14 INS43 INS27 INS42 INS43 INS27 INS42 INS42 INS45 INS42 UPD42 MOV42 INS45 INS42 DEL83 DEL83 DEL43 DEL42 DEL59 DEL23 DEL83 DEL42 DEL42 DEL43 DEL42 DEL42 DEL32 DEL14 DEL7 DEL21 DEL42 DEL42 DEL42 DEL42 DEL43 DEL69 DEL42 DEL43 DEL69 DEL68 DEL65 DEL42 DEL42 DEL42 DEL42 DEL32 DEL40 DEL42 DEL68 DEL65 DEL42 DEL42 DEL68 DEL65 DEL29 DEL42 DEL43 DEL85 DEL5 DEL8 DEL31 DEL40 DEL42 DEL42 DEL43 DEL69 DEL68 DEL65 DEL42 DEL42 DEL42 DEL43 DEL69 DEL68 DEL65 DEL29 DEL42 DEL43 DEL8 DEL31 DEL40 DEL42 DEL43 DEL69 DEL68 DEL65 DEL42 DEL42 DEL42 DEL43 DEL69 DEL68 DEL65 DEL29 DEL83 DEL42 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL43 DEL42 DEL42 DEL41 DEL8 DEL31