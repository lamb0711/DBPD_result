work in progress

- add invalidate(), refresh() to NodeState (missing impl)
- rename ItemState.refresh(ChangeLog) to persisted(ChangeLog)
- Item.refresh(boolean) must not call checkStatus. a stale, invalidated
  item may be refreshed unless its state has a terminal status (removed, stale_destroyed). ItemState.refresh() is therefore called after reverting transient modifications only.
- javadoc and some comments

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@474319 13f79535-47bb-0310-9956-ffa450edef68

+    /**
+     * Returns true, if the status of an item state can be changed from
+     * <code>oldStatus</code> to <code>newStatus</code>, and false if the
+     * change is illegal or if any of the given status flags is illegal.
+     *
+     * @param oldStatus
+     * @param newStatus
+     * @param isWorkspaceState
+     * @return
+     */
-                    switch (oldStatus) {
-                        case EXISTING: // refresh of existing item state
-                        case INVALIDATED: // invalidated item state is refreshed
-                            isValid = true;
-                            break;
-                    }
+                    isValid = (oldStatus == EXISTING || oldStatus == INVALIDATED);
-                    switch (oldStatus) {
-                        case EXISTING: // existing workspace state is externally removed
-                        case INVALIDATED: // invalidated item state is refreshed
-                            isValid = true;
-                            break;
-                    }
+                    // existing or invalidated workspace state is externally removed
+                    isValid = (oldStatus == EXISTING || oldStatus == INVALIDATED);
+            // valid status changes for session-states
-                    isValid = (oldStatus == NEW || oldStatus == EXISTING || oldStatus == EXISTING_REMOVED || oldStatus == INVALIDATED);
+                    isValid = (oldStatus == NEW || oldStatus == INVALIDATED ||
+                               oldStatus == EXISTING || oldStatus == EXISTING_REMOVED );

INS29 INS65 INS65 INS65 INS65 INS65 INS66 INS66 INS66 INS42 INS42 INS42 INS21 INS10 INS21 MOV10 INS7 INS7 INS42 INS36 MOV42 INS36 INS27 INS27 MOV27 INS27 INS27 INS27 INS27 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS27 MOV27 MOV27 DEL42 DEL42 DEL49 DEL42 DEL49 DEL9 DEL7 DEL21 DEL10 DEL50 DEL10 DEL42 DEL42 DEL49 DEL42 DEL49 DEL42 DEL9 DEL7 DEL21 DEL50 DEL10 DEL27