JCR-1590: JSR 283: Locking

Create and use a LockInfo.throwLockException utility method for setting the failure node path in LockExceptions.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@803566 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.RepositoryException;
+import javax.jcr.lock.LockException;
+     * Utility method that throws a {@link LockException} with the
+     * "failure node path" set to the path of the node that holds this lock.
+     * The given session is used to resolve the path of the lock holder node.
+     *
+     * @param message exception message
+     * @param session session that the user was using for the failing operation
+     * @throws LockException always thrown, unless another error occurs
+     * @throws RepositoryException if the path of this lock can not be resolved
+     */
+    public void throwLockException(String message, SessionImpl session)
+            throws LockException, RepositoryException {
+        String path;
+        try {
+            path = session.getJCRPath(
+                    session.getHierarchyManager().getPath(id));
+        } catch (RepositoryException ignored) {
+            path = null;
+        }
+        if (path != null) {
+            throw new LockException(
+                    message + " (lock held by node " + path + ")", null, path);
+        } else {
+            throw new LockException(message);
+        }
+    }
+
+    /**

INS26 INS26 INS40 INS40 INS31 INS29 INS83 INS39 INS42 INS44 INS44 INS43 INS43 INS8 INS65 INS65 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS42 INS42 INS60 INS54 INS25 INS66 INS65 INS66 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS43 INS59 INS8 INS12 INS27 INS8 INS8 INS42 INS42 INS42 INS21 INS44 INS8 INS42 INS33 INS53 INS53 INS7 INS43 INS42 INS21 INS14 INS14 INS42 INS32 INS42 INS7 INS43 INS27 INS33 INS42 INS43 INS42 INS42 INS42 INS32 INS42 INS33 INS42 INS42 INS45 INS42 INS45 INS42 INS32 INS42 INS42 INS42 INS42