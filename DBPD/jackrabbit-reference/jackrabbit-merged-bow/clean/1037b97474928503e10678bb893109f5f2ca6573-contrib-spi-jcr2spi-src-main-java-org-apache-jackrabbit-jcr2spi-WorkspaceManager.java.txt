work in progress

- resolve TODO in NamespaceRegistry. add flag indicating, if repository
  supports level2 (registration of new namespaces).

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@452081 13f79535-47bb-0310-9956-ffa450edef68

-        nsRegistry = createNamespaceRegistry();
-        ntRegistry = createNodeTypeRegistry(nsRegistry);
-        externalChangeListener = createChangeListener();
+        Properties repositoryDescriptors = service.getRepositoryDescriptors();
+
+        nsRegistry = createNamespaceRegistry(repositoryDescriptors);
+        ntRegistry = createNodeTypeRegistry(nsRegistry, repositoryDescriptors);
+        externalChangeListener = createChangeListener(repositoryDescriptors);
-    private NamespaceRegistryImpl createNamespaceRegistry() throws RepositoryException {
-        return new NamespaceRegistryImpl(this, service.getRegisteredNamespaces(sessionInfo));
+    /**
+     *
+     * @param descriptors
+     * @return
+     * @throws RepositoryException
+     */
+    private NamespaceRegistryImpl createNamespaceRegistry(Properties descriptors) throws RepositoryException {
+        boolean level2 = Boolean.valueOf(descriptors.getProperty(Repository.LEVEL_2_SUPPORTED)).booleanValue();
+        return new NamespaceRegistryImpl(this, service.getRegisteredNamespaces(sessionInfo), level2);
-    private NodeTypeRegistry createNodeTypeRegistry(NamespaceRegistry nsRegistry) throws RepositoryException {
+    /**
+     *
+     * @param nsRegistry
+     * @param descriptors
+     * @return
+     * @throws RepositoryException
+     */
+    private NodeTypeRegistry createNodeTypeRegistry(NamespaceRegistry nsRegistry, Properties descriptors) throws RepositoryException {
+     * @param descriptors the repository descriptors
-    private EventListener createChangeListener() throws RepositoryException {
-        Properties descriptors = service.getRepositoryDescriptors();
+    private EventListener createChangeListener(Properties descriptors) throws RepositoryException {
-                log.warn("exception while disposing workspace manager: " + e);
+                log.warn("Exception while disposing workspace manager: " + e);

INS29 INS44 INS29 INS44 INS44 INS60 INS65 INS65 INS65 INS43 INS42 INS60 INS65 INS65 INS65 INS65 INS43 INS42 INS65 INS43 INS42 MOV43 INS59 INS42 INS42 INS42 INS39 INS59 INS42 INS42 INS42 INS42 INS42 INS66 INS42 INS42 MOV32 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS42 INS40 UPD45 DEL42 DEL59 DEL60