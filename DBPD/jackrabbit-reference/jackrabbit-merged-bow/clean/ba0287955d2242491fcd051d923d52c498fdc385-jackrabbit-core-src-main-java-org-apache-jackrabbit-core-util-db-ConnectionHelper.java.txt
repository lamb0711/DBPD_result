JCR-2026 DbDataStore: garbage collection deadlock (simplify using the ConnectionHelper)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1102269 13f79535-47bb-0310-9956-ffa450edef68

-                stmt = con.prepareStatement(sql);
-                execute((PreparedStatement) stmt, params);
+                PreparedStatement p = con.prepareStatement(sql);
+                stmt = p;
+                execute(p, params);
-    public final int update(final String sql, final Object[] params) throws SQLException {
+    public final int update(final String sql, final Object... params) throws SQLException {
-    int reallyUpdate(String sql, Object[] params) throws SQLException {
+    int reallyUpdate(String sql, Object... params) throws SQLException {
+     * Executes a SQL query and returns the {@link ResultSet}. The
+     * returned {@link ResultSet} should be closed by clients.
+     *
+     * @param sql an SQL statement string
+     * @param params the parameters for the SQL statement
+     * @param returnGeneratedKeys whether generated keys should be returned
+     * @return a {@link ResultSet}
+     */
+    public final ResultSet query(String sql, Object... params) throws SQLException {
+        return exec(sql, params, false, 0);
+    }
+
+    /**

INS31 INS29 INS83 INS83 INS43 INS42 INS44 INS44 INS43 INS8 MOV43 INS43 INS65 INS65 INS65 INS65 INS65 INS42 INS43 INS42 INS43 INS42 INS42 INS41 MOV42 INS66 INS65 INS66 INS66 INS65 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS66 INS65 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS9 INS34 INS60 MOV43 INS59 INS42 MOV32 INS42 INS42 DEL42 DEL11 DEL85 DEL5 DEL43 DEL85 DEL5