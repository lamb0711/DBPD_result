minor changes needed for spi2dav (see spi contrib)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@506936 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.webdav.DavServletResponse;
+import org.apache.jackrabbit.webdav.header.IfHeader;
+import java.util.Iterator;
+
-            if ((lockToken != null || txId != null) && subscriptionId != null) {
-                throw new DavException(DavServletResponse.SC_PRECONDITION_FAILED, "Ambiguous headers: either TransactionId/Lock-Token or SubscriptionId can be present, not both.");
-            }
-
+
+            if (session == null) {
+                // try tokens present in the if-header
+                IfHeader ifHeader = new IfHeader(request);
+                for (Iterator it = ifHeader.getAllTokens(); it.hasNext();) {
+                    String token = it.next().toString();
+                    if (containsReference(token)) {
+                        session = getSessionByReference(token);
+                        break;
+                    }
+                }
+            }
+

MOV26 INS26 UPD40 INS40 MOV25 INS27 INS8 UPD42 MOV42 MOV33 INS60 INS24 INS43 INS59 INS58 INS32 INS8 INS42 INS42 INS14 INS43 INS59 INS42 INS42 INS60 INS25 UPD43 MOV43 INS42 INS42 INS42 INS32 INS43 INS59 INS32 INS8 UPD42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS21 INS10 INS32 INS42 INS7 INS42 INS42 INS42 INS32 INS42 INS42 DEL27 DEL42 DEL33 DEL27 DEL27 DEL36 DEL42 DEL33 DEL27 DEL27 DEL40 DEL45 DEL14 DEL53 DEL8