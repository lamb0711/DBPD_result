JCR-1042: Disable norms for untokenized fields to reduce memory consumption

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@565283 13f79535-47bb-0310-9956-ffa450edef68

-        doc.add(new Field(FieldNames.UUID, node.getNodeId().getUUID().toString(), Field.Store.YES, Field.Index.UN_TOKENIZED, Field.TermVector.NO));
+        doc.add(new Field(FieldNames.UUID, node.getNodeId().getUUID().toString(), Field.Store.YES, Field.Index.NO_NORMS, Field.TermVector.NO));
-                doc.add(new Field(FieldNames.PARENT, "", Field.Store.YES, Field.Index.UN_TOKENIZED, Field.TermVector.NO));
-                doc.add(new Field(FieldNames.LABEL, "", Field.Store.NO, Field.Index.UN_TOKENIZED, Field.TermVector.NO));
+                doc.add(new Field(FieldNames.PARENT, "", Field.Store.YES, Field.Index.NO_NORMS, Field.TermVector.NO));
+                doc.add(new Field(FieldNames.LABEL, "", Field.Store.NO, Field.Index.NO_NORMS, Field.TermVector.NO));
-                doc.add(new Field(FieldNames.PARENT, node.getParentId().toString(), Field.Store.YES, Field.Index.UN_TOKENIZED, Field.TermVector.NO));
+                doc.add(new Field(FieldNames.PARENT, node.getParentId().toString(), Field.Store.YES, Field.Index.NO_NORMS, Field.TermVector.NO));
-                doc.add(new Field(FieldNames.LABEL, name, Field.Store.NO, Field.Index.UN_TOKENIZED, Field.TermVector.NO));
+                doc.add(new Field(FieldNames.LABEL, name, Field.Store.NO, Field.Index.NO_NORMS, Field.TermVector.NO));
-        doc.add(new Field(FieldNames.PROPERTIES,
-                FieldNames.createNamedValue(fieldName, internalValue.toString()),
-                Field.Store.NO,
-                Field.Index.UN_TOKENIZED,
-                Field.TermVector.NO));
+        doc.add(createFieldWithoutNorms(fieldName, internalValue.toString(), false));
+    }
+
+    /**
+     * Creates a field of name <code>fieldName</code> with the value of <code>
+     * internalValue</code>. The created field is indexed without norms.
+     * 
+     * @param fieldName     The name of the field to add
+     * @param internalValue The value for the field to add to the document.
+     * @param store         <code>true</code> if the value should be stored, 
+     *                      <code>false</code> otherwise
+     */
+    protected Field createFieldWithoutNorms(String fieldName,
+            String internalValue, boolean store) {
+        Field field = new Field(FieldNames.PROPERTIES,
+                FieldNames.createNamedValue(fieldName, internalValue),
+                store ? Field.Store.YES : Field.Store.NO, Field.Index.NO_NORMS,
+                Field.TermVector.NO);
+        return field;
-     * value is converted to an indexable string value using the {@link DateField}
-     * class.
-     *
-     * @param doc           The document to which to add the field
-     * @param fieldName     The name of the field to add
-     * @param internalValue The value for the field to add to the document.
+     * value is converted to an indexable string value using the
+     * {@link DateField} class.
+     * 
+     * @param doc
+     *            The document to which to add the field
+     * @param fieldName
+     *            The name of the field to add
+     * @param internalValue
+     *            The value for the field to add to the document.
-        doc.add(new Field(FieldNames.PROPERTIES,
-                FieldNames.createNamedValue(fieldName, DateField.timeToString(millis)),
-                Field.Store.NO,
-                Field.Index.UN_TOKENIZED,
-                Field.TermVector.NO));
+        doc.add(createFieldWithoutNorms(fieldName, DateField.timeToString(millis), false));
-        doc.add(new Field(FieldNames.PROPERTIES,
-                FieldNames.createNamedValue(fieldName, DoubleField.doubleToString(doubleVal)),
-                Field.Store.NO,
-                Field.Index.UN_TOKENIZED,
-                Field.TermVector.NO));
+        doc.add(createFieldWithoutNorms(fieldName, DoubleField.doubleToString(doubleVal), false));
-        doc.add(new Field(FieldNames.PROPERTIES,
-                FieldNames.createNamedValue(fieldName, LongField.longToString(longVal)),
-                Field.Store.NO,
-                Field.Index.UN_TOKENIZED,
-                Field.TermVector.NO));
+        doc.add(createFieldWithoutNorms(fieldName, LongField.longToString(longVal), false));
-        doc.add(new Field(FieldNames.PROPERTIES,
-                FieldNames.createNamedValue(fieldName, uuid),
-                Field.Store.YES, // store
-                Field.Index.UN_TOKENIZED,
-                Field.TermVector.NO));
+        doc.add(createFieldWithoutNorms(fieldName, uuid, true));
-        doc.add(new Field(FieldNames.PROPERTIES,
-                FieldNames.createNamedValue(fieldName, pathString),
-                Field.Store.NO,
-                Field.Index.UN_TOKENIZED,
-                Field.TermVector.NO));
+        doc.add(createFieldWithoutNorms(fieldName, pathString, false));
-        doc.add(new Field(FieldNames.PROPERTIES,
-                FieldNames.createNamedValue(fieldName, stringValue),
-                Field.Store.NO,
-                Field.Index.UN_TOKENIZED,
-                Field.TermVector.NO));
+        doc.add(createFieldWithoutNorms(fieldName, stringValue, false));
-        doc.add(new Field(FieldNames.PROPERTIES,
-                FieldNames.createNamedValue(fieldName, normValue),
-                Field.Store.NO,
-                Field.Index.UN_TOKENIZED,
-                Field.TermVector.NO));
+        doc.add(createFieldWithoutNorms(fieldName, normValue, false));

INS31 INS29 INS83 MOV43 INS42 INS44 INS44 INS44 INS8 INS65 MOV65 MOV65 INS65 INS43 INS42 INS43 INS42 INS39 INS42 INS60 INS41 INS65 INS65 INS66 INS66 INS42 INS66 INS66 INS42 INS42 MOV43 INS59 INS42 UPD66 UPD66 UPD66 INS42 INS66 INS42 INS66 MOV32 INS42 INS14 MOV32 MOV32 MOV32 INS32 INS32 INS32 INS32 UPD40 UPD42 INS9 MOV43 INS40 INS32 INS16 INS40 INS40 UPD42 INS9 UPD42 INS9 UPD42 INS9 UPD42 MOV42 MOV42 MOV42 INS9 UPD42 MOV42 MOV42 MOV42 INS9 UPD42 MOV42 MOV42 MOV42 INS9 UPD42 MOV42 MOV42 MOV42 INS9 INS42 INS42 INS42 INS42 INS42 INS40 INS40 UPD40 UPD40 UPD40 UPD40 DEL42 DEL40 DEL40 DEL40 DEL40 DEL14 DEL42 DEL40 DEL40 DEL40 DEL40 DEL14 DEL42 DEL40 DEL40 DEL40 DEL40 DEL14 DEL42 DEL42 DEL43 DEL40 DEL40 DEL40 DEL40 DEL14 DEL42 DEL43 DEL40 DEL42 DEL32 DEL40 DEL40 DEL40 DEL14 DEL42 DEL43 DEL40 DEL42 DEL32 DEL40 DEL40 DEL40 DEL14 DEL42 DEL43 DEL40 DEL42 DEL32 DEL40 DEL40 DEL40 DEL14 DEL42 DEL43 DEL40 DEL42 DEL32 DEL40 DEL40 DEL40 DEL14