catch IllegalStateException when registering shutdown hook

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@469197 13f79535-47bb-0310-9956-ffa450edef68

-        Runtime.getRuntime().addShutdownHook(new Thread() {
-            public void run() {
-                // synchronize on the list before iterating over it in order
-                // to avoid ConcurrentModificationException (JCR-549)
-                // @see java.lang.util.Collections.synchronizedList(java.util.List)
-                synchronized(trackedRefs) {
-                    for (Iterator it = trackedRefs.iterator(); it.hasNext();) {
-                        MoribundFileReference fileRef = (MoribundFileReference) it.next();
-                        fileRef.delete();
-                    }
+        try {
+            Runtime.getRuntime().addShutdownHook(new Thread() {
+                public void run() {
+                    // synchronize on the list before iterating over it in order
+                    // to avoid ConcurrentModificationException (JCR-549)
+                    // @see java.lang.util.Collections.synchronizedList(java.util.List)
+                    synchronized(trackedRefs) {
+                        for (Iterator it = trackedRefs.iterator(); it.hasNext();) {
+                            MoribundFileReference fileRef = (MoribundFileReference) it.next();
+                            fileRef.delete();
+                        }
+                    }
-            }
-        });
+            });
+        } catch (IllegalStateException e) {
+            // can't register shutdownhook because
+            // jvm shutdown sequence has already begun,
+            // silently ignore... 
+        }

INS54 INS8 INS12 MOV21 INS44 INS8 INS43 INS42 INS42