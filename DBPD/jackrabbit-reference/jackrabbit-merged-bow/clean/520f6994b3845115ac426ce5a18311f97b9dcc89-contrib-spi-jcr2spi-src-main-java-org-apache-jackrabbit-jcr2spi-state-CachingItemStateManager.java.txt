work in progress.

- nodestates must always be connected to their cne upon creation
  TODO: add some sort of caching to avoid traffic overhead
- add TODO for refresh, that currently doesn't work properly
- ItemState.refresh only takes changelog and returns the ids of the
  processed states. cleanup of events is left to caller.
- move of NodeStates does not work
- PathResolver: force start to be an NodeState
- all MODIFIED status for SessionStates as well in order to make sure
  that listeners are informed about external changes even if the 
  state is EXISTING.

next TODO: make sure, that public getChildNodeEntry/ies and hasChildNodeEntry check for validity of the connected NodeState. don't return entries, where the nodestate is (transiently) removed or stale.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@472818 13f79535-47bb-0310-9956-ffa450edef68

-        ItemState state;
+        NodeState start;
-            state = cache.getNodeState(id.getUUID());
-            if (state == null) {
+            start = cache.getNodeState(id.getUUID());
+            if (start == null) {
-                state = getRootState();
+                start = getRootState();
-                log.warn("unable to get root node state:" + e.getMessage());
+                // should never occur
+                log.error("Error while retrieving root node state:" + e.getMessage());
-        // resolve relative path
-        if (id.getPath() != null) {
+        if (id.getPath() == null) {
+            // path is null -> id points to a state identified by uuid
+            return start;
+        } else {
+            // resolve path part
-                state = PathResolver.lookup(state, id.getPath());
+                return PathResolver.lookup(start, id.getPath());
+            } catch (NoSuchItemStateException e) {
+                log.debug("exception while looking up state with id: " + id);
+                return null;
-                log.warn("exception while looking up state with id: " + id);
+                log.debug("exception while looking up state with id: " + id);
-
-        return state;

UPD43 UPD27 INS8 UPD42 UPD42 INS41 INS42 INS12 UPD42 UPD42 INS41 INS44 MOV44 INS8 MOV32 INS43 INS42 INS21 INS41 UPD42 UPD42 INS42 INS32 INS33 UPD42 UPD42 INS42 INS42 INS27 UPD45 INS45 INS42 DEL42 DEL7 DEL21 DEL42 DEL41