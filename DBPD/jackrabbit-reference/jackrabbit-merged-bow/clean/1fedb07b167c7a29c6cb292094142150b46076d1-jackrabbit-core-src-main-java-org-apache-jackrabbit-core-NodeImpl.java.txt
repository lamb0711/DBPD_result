JCR-772 Merging between workspaces fails


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@513414 13f79535-47bb-0310-9956-ffa450edef68

+     * <p/>
+     * jsr170 - 8.2.10 Merge:
+     * [...]
+     * <ul>
+     * <li>If N is currently checked-in then:</li>
+     * <ul>
+     * <li>If V' is a successor (to any degree) of V, then the merge result
+     *     for N is update.
+     * </li>
+     * <li>If V' is a predecessor (to any degree) of V or if V and
+     *     V' are identical (i.e., are actually the same version),
+     *     then the merge result for N is leave.
+     * </li>
+     * <li>If V is neither a successor of, predecessor of, nor
+     *     identical with V', then the merge result for N is failed.
+     *     This is the case where N and N' represent divergent
+     *     branches of the version graph, thus determining the
+     *     result of a merge is non-trivial.
+     * </li>
+     * </ul>
+     * <li>If N is currently checked-out then:</li>
+     * <ul>
+     * <li>If V' is a predecessor (to any degree) of V or if V and
+     *     V' are identical (i.e., are actually the same version),
+     *     then the merge result for N is leave.
+     * </li>
+     * <li>If any other relationship holds between V and V',
+     *     then the merge result for N is fail.
+     * </li>
+     * </ul>
+     * </ul>
-     * @param srcSession
-     * @param bestEffort
-     * @return
-     * @throws RepositoryException
-     * @throws AccessDeniedException
+     * @param srcSession the source session
+     * @param failedIds the list to store the failed node ids.
+     * @param bestEffort the best effort flag
+     * @return the corresponding source node or <code>null</code>
+     * @throws RepositoryException if an error occurs.
+     * @throws AccessDeniedException if access is denied
-                    if (!dstNode.getParent().isSame(srcNode)) {
+                    if (!isSame(dstNode.getParent())) {

INS65 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS42 INS66 INS66 INS66 INS66 INS66 MOV32 DEL42