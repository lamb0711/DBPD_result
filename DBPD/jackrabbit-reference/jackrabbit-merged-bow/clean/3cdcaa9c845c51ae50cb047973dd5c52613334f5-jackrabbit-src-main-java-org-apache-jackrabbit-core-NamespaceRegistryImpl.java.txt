JCR-283 NamespaceRegistry.registerNamespace(pre, uri) might accidentally remove namespace in certain situations

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@349939 13f79535-47bb-0310-9956-ffa450edef68

+        // check existing mappings
-        if (oldPrefix != null) {
-            // existing namespace
-            if (oldPrefix.equals(prefix)) {
-                throw new NamespaceException("failed to register namespace "
-                        + prefix + " -> " + uri + ": mapping already exists");
-            }
-            // remove old prefix
-            prefixToURI.remove(oldPrefix);
-            uriToPrefix.remove(uri);
+        if (prefix.equals(oldPrefix)) {
+            throw new NamespaceException("failed to register namespace "
+                    + prefix + " -> " + uri + ": mapping already exists");
-
+        if (oldPrefix != null) {
+            // remove old prefix mapping
+            prefixToURI.remove(oldPrefix);
+            uriToPrefix.remove(uri);
+        }
+
+        // add new prefix mapping

MOV25 MOV25 UPD42 UPD42