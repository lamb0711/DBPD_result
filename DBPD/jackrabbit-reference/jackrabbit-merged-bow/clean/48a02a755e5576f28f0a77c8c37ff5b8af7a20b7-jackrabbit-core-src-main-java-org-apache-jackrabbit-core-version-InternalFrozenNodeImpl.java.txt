JCR-1803: Node.restore() throws java.lang.ClassCastException

Explicitly handle both STRING and REFERENCE (used in Jackrabbit < 1.1, see JCR-487) values in jcr:frozenUUID. Since we do not automatically upgrade old content, we need to be ready to handle both types of values.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@704158 13f79535-47bb-0310-9956-ffa450edef68

-                frozenUUID = UUID.fromString(node.getPropertyValue(NameConstants.JCR_FROZENUUID).getString());
+                InternalValue value =
+                    node.getPropertyValue(NameConstants.JCR_FROZENUUID);
+                // JCR-1803: The value should be a STRING, but older Jackrabbit
+                // versions (< 1.1, see JCR-487) used REFERENCE values. Since
+                // we do not automatically upgrade old content, we need to be
+                // ready to handle both types of values here.
+                if (value.getType() == PropertyType.STRING) {
+                    frozenUUID = UUID.fromString(value.getString());
+                } else {
+                    frozenUUID = value.getUUID();
+                }

INS8 INS60 INS25 INS43 INS59 INS27 MOV8 INS8 INS42 INS42 MOV32 INS32 INS40 INS21 INS42 INS42 INS7 INS42 INS32 INS42 INS42 INS42