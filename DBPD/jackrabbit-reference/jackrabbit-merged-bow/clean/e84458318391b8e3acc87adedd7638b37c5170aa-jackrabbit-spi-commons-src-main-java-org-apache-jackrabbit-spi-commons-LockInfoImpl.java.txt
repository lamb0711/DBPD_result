JCR-1590 JSR 283: Locking

- getSecondsRemaining is negative if lock is expired or released
- getLockToken always returns null if lock is sessionscoped

JCR-2004 Update SPI locking to match JCR 2.0

- extend spi/LockInfo.java
- add JCR 2.0 variant of RepositoryService#lock that takes timeoutHint and ownerHint
- adjust jcr2spi
- adjust spi implementation(s)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@753244 13f79535-47bb-0310-9956-ffa450edef68

+     * Number of seconds until the lock time outs.
+     */
+    private final long secondsRemaining;
+
+    /**
+     * Flag indicating if the session is lock owner or not.
+     */
+    private final boolean isLockOwner;
+
+    /**
+        this(lockToken, lockOwner, isDeep, isSessionScoped, Long.MAX_VALUE, lockToken != null, nodeId);
+    }
+
+    /**
+     * Creates a new lock info for the given <code>lock</code> info.
+     *
+     * @param lockToken the lock token
+     * @param lockOwner the lock owner
+     * @param isDeep whether this lock is deep or not
+     * @param isSessionScoped whether this lock is session scoped or not
+     * @param secondsRemaining Number of seconds until the lock timeout is reached.
+     * @param isLockOwner <code>true</code> if the calling session is lock
+     * owner; <code>false</code> otherwise.
+     * @param nodeId the node id of the locked node.
+     * @since JCR 2.0
+     */
+    public LockInfoImpl(String lockToken, String lockOwner, boolean isDeep,
+                        boolean isSessionScoped, long secondsRemaining,
+                        boolean isLockOwner, NodeId nodeId) {
+        this.secondsRemaining = secondsRemaining;
+        this.isLockOwner = isLockOwner;
+    public long getSecondsRemaining() {
+        return secondsRemaining;
+    }
+
+    /**
+     * {@inheritDoc}
+     */
+    public boolean isLockOwner() {
+        return isLockOwner;
+    }
+
+    /**
+     * {@inheritDoc}
+     */
-}
+}

INS23 INS23 INS31 INS31 INS31 INS29 INS83 INS83 INS39 INS59 INS29 INS83 INS83 INS39 INS59 MOV29 INS83 INS42 INS44 INS44 INS44 INS44 INS44 INS8 INS29 INS44 INS44 INS29 INS83 INS39 INS42 INS8 INS29 INS83 INS39 INS42 INS8 INS65 INS42 INS65 INS42 INS43 INS42 INS43 INS42 INS39 INS42 INS39 INS42 INS43 INS42 INS17 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS39 INS42 INS39 INS42 INS21 INS21 INS65 INS41 INS65 INS41 INS66 INS66 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS40 INS27 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS66 INS42 INS66 INS66 INS7 INS7 INS65 INS42 INS65 INS42 INS42 INS33 INS22 INS42 INS22 INS42 INS52 INS42 INS52 INS42