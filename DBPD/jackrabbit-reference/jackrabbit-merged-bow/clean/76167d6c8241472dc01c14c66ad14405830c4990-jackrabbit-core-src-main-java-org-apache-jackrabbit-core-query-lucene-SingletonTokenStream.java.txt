JCR-2980 Nodes that have properties marked for async extraction should be available for querying

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1131652 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.IOException;
+
-import java.io.IOException;
-
-    private final Payload payload;
+    private Payload payload;
+    private boolean consumed = false;
+
-     *
-     * @param value the string value that will be returned with the token.
-     * @param payload the payload that will be attached to this token
+     * 
+     * @param value
+     *            the string value that will be returned with the token.
+     * @param payload
+     *            the payload that will be attached to this token
-     *
-     * @param value the string value that will be returned with the token.
-     * @param type the JCR property type.
+     * 
+     * @param value
+     *            the string value that will be returned with the token.
+     * @param type
+     *            the JCR property type.
-        if (value == null) {
+        if (consumed) {
-
-
-        value = null;
+        consumed = true;
+
+    /**
+     * {@inheritDoc}
+     */
+    @Override
+    public void reset() throws IOException {
+        consumed = false;
+    }
+
+    /**
+     * {@inheritDoc}
+     */
+    @Override
+    public void close() throws IOException {
+        consumed = true;
+        value = null;
+        payload = null;
+        payloadAttribute = null;
+        termAttribute = null;
+    }

MOV26 INS23 INS31 INS31 INS83 INS39 INS59 INS29 INS78 INS83 INS39 INS42 INS43 INS8 INS29 INS78 INS83 INS39 INS42 INS43 INS8 INS42 INS9 INS21 INS65 INS42 INS42 INS21 INS65 INS42 INS42 INS21 MOV21 INS21 INS21 INS21 UPD66 UPD66 UPD66 UPD66 INS42 INS7 INS65 INS7 INS65 INS7 INS7 INS7 INS7 INS42 INS9 INS42 INS9 INS42 INS9 INS42 INS33 INS42 INS33 INS42 INS33 DEL83 DEL42 DEL33 DEL27