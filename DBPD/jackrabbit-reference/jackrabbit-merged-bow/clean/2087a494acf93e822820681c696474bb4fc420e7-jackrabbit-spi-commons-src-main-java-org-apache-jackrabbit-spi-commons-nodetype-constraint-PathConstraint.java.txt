JCR-2064 Add new JSR283 features to CND reader/writer
JCR-2153 Introduce QValueConstraint and change return type of QPropertyDefinition.getValueConstraints()
JCR-2158 Consolidate CND related classes from SPI and Core


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@785777 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.spi.commons.name.NameConstants;
-        boolean deep = qualifiedDefinition.endsWith("*");
+        boolean deep = qualifiedDefinition.endsWith("\t{}*");
-            path = PathFactoryImpl.getInstance().create(qualifiedDefinition.substring(0, qualifiedDefinition.length() - 1));
+            path = PathFactoryImpl.getInstance().create(qualifiedDefinition.substring(0, qualifiedDefinition.length() - 4));
-            StringBuffer qualifiedDefinition = new StringBuffer();
-                    qualifiedDefinition.append('*');
-                    qualifiedDefinition.append("/*");
-            qualifiedDefinition.insert(0, path.getString());
-
+            StringBuffer qualifiedDefinition = new StringBuffer(path.getString());
+            if (deep) {
+                qualifiedDefinition.append(Path.DELIMITER);
+                qualifiedDefinition.append(NameConstants.ANY_NAME);
+            }
-     * @param resolver
+     * @param resolver name-path resolver
-            return getQualifiedDefinition();
+            return getString();
-    void check(QValue value) throws ConstraintViolationException, RepositoryException {
+    public void check(QValue value) throws ConstraintViolationException, RepositoryException {
-            throw new ConstraintViolationException("null value does not satisfy the constraint '" + getQualifiedDefinition() + "'");
+            throw new ConstraintViolationException("null value does not satisfy the constraint '" + getString() + "'");
-                                + getQualifiedDefinition() + "'");
+                                + getString() + "'");
-                            + getQualifiedDefinition() + "'");
+                            + getString() + "'");
-                            + getQualifiedDefinition() + "'");
+                            + getString() + "'");

INS26 INS40 INS83 MOV60 INS66 INS25 UPD45 MOV43 INS42 INS8 INS21 INS21 MOV43 MOV32 INS32 INS32 UPD42 INS42 INS42 MOV42 UPD42 MOV42 INS40 UPD42 MOV42 UPD42 MOV42 INS40 UPD42 UPD34 UPD42 UPD42 UPD42 DEL42 DEL42 DEL13 DEL32 DEL21 DEL42 DEL42 DEL45 DEL32 DEL21 DEL34 DEL32 DEL21