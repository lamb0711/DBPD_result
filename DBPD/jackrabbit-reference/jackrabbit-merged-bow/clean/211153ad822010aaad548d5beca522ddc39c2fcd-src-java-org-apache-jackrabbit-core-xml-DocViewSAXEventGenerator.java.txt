port to jcr api v0.16.4.1

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@165156 13f79535-47bb-0310-9956-ffa450edef68

-                if (prop.getType() == PropertyType.BINARY && skipBinary) {
-                    continue;
-                }
-                StringBuffer attrValue = new StringBuffer();
-                // process property value(s)
-                boolean multiValued = prop.getDefinition().isMultiple();
-                Value[] vals;
-                if (multiValued) {
-                    vals = prop.getValues();
+                if (prop.getType() == PropertyType.BINARY && skipBinary) {
+                    // add empty attribute
+                    attrs.addAttribute(propName.getNamespaceURI(),
+                            propName.getLocalName(), attrName, CDATA_TYPE, "");
-                    vals = new Value[]{prop.getValue()};
-                }
-                for (int i = 0; i < vals.length; i++) {
-                    if (i > 0) {
-                        // use space as delimiter for multi-valued properties
-                        attrValue.append(" ");
+                    StringBuffer attrValue = new StringBuffer();
+                    // process property value(s)
+                    boolean multiValued = prop.getDefinition().isMultiple();
+                    Value[] vals;
+                    if (multiValued) {
+                        vals = prop.getValues();
+                    } else {
+                        vals = new Value[]{prop.getValue()};
-                    attrValue.append(ValueHelper.serialize(vals[i], true));
+                    for (int i = 0; i < vals.length; i++) {
+                        if (i > 0) {
+                            // use space as delimiter for multi-valued properties
+                            attrValue.append(" ");
+                        }
+                        attrValue.append(ValueHelper.serialize(vals[i], true));
+                    }
+                    attrs.addAttribute(propName.getNamespaceURI(),
+                            propName.getLocalName(), attrName, CDATA_TYPE,
+                            attrValue.toString());
-                attrs.addAttribute(propName.getNamespaceURI(),
-                        propName.getLocalName(), attrName, CDATA_TYPE,
-                        attrValue.toString());

MOV25 INS8 INS21 MOV60 MOV60 MOV60 MOV25 MOV24 MOV21 INS32 INS42 INS42 INS32 INS32 INS42 INS42 INS45 INS42 INS42 INS42 INS42 DEL18