JCR-2715: Improved join query performance

Add support for offset and limit on join queries.
Better handling of queries with too many or clauses.
Various smaller improvements.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1024211 13f79535-47bb-0310-9956-ffa450edef68

-            RowIterator leftRows, RowIterator rightRows)
+            RowIterator leftRows, RowIterator rightRows, long offset, long limit)
+        while ((offset-- > 0 || limit == 0) && joinRows.hasNext()) {
+            joinRows.nextRow();
+        }
+        if (limit > 0) {
+            List<Row> rows = new ArrayList<Row>((int) limit);
+            for (int i = 0; i < limit && joinRows.hasNext(); i++) {
+                rows.add(joinRows.nextRow());
+            }
+            joinRows = new RowIteratorAdapter(rows);
+        }
-    public abstract Constraint getRightJoinConstraint(List<Row> leftRows)
+    public abstract List<Constraint> getRightJoinConstraints(List<Row> leftRows)

INS44 INS44 INS74 UPD42 INS39 INS42 INS39 INS42 INS61 INS25 INS43 MOV43 INS27 INS8 INS27 INS8 INS42 INS36 INS32 INS21 INS42 INS34 INS60 INS24 INS21 INS27 INS42 INS42 INS32 INS74 INS59 INS58 INS27 INS37 INS8 INS7 INS27 INS27 INS42 INS42 INS43 INS43 INS42 INS14 INS39 INS59 INS27 INS32 INS42 INS21 INS42 INS14 INS37 INS34 INS42 INS34 INS42 INS42 INS74 INS11 INS42 INS34 INS42 INS42 INS42 INS42 INS32 INS43 INS42 INS42 INS43 INS43 INS39 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42