- Extended observation test cases
- fixed observation bug that caused ItemStateException in case a property is removed and added again with the same name

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@156039 13f79535-47bb-0310-9956-ffa450edef68

-     * The HierarchyManager of the session that creates the events.
-     */
-    private final HierarchyManager hmgr;
-
-    /**
-                         SessionImpl session,
-                         HierarchyManager hmgr) {
+                         SessionImpl session) {
-        this.hmgr = hmgr;
+     * @param rootNodeUUID the UUID of the root node.
-    public void createEventStates(ChangeLog changes, ItemStateManager provider) throws ItemStateException {
+    public void createEventStates(String rootNodeUUID, ChangeLog changes, ItemStateManager provider) throws ItemStateException {
+        // create a hierarchy manager, that is based on the ChangeLog and
+        // the ItemStateProvider
+        // todo use CachingHierarchyManager ?
+        HierarchyManager hmgr = new ChangeLogBasedHierarchyMgr(rootNodeUUID, provider, changes, session.getNamespaceResolver());
+

INS44 INS65 INS43 INS42 INS60 INS42 INS66 INS42 MOV43 INS59 INS42 INS14 INS43 INS42 INS42 INS42 INS32 INS42 INS42 INS42 DEL66 DEL65 DEL29 DEL83 DEL83 DEL42 DEL43 DEL42 DEL59 DEL23 DEL42 DEL44 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21