JCR-2762: Optimize bundle serialization

Add common names used by the access control features. Reorder names by popularity.

Rename read/writeInt() to read/writeVarInt() as suggested by Thomas. Remove recursion from writeVarInt().

Minor optimizations in read/writeName(), including a fix to the case where the local name is more than 15 characters long.

Extend the use of read/writeVarInt() and read/writeString() to more places in the code.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1022488 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.Property;
+import javax.jcr.security.Privilege;
+
+    /** jcr:title */
+    public static final Name JCR_TITLE = FACTORY.create(Property.JCR_TITLE);
+
-    /**
-     * rep:root
-     */
-    public static final Name REP_ROOT = FACTORY.create(Name.NS_REP_URI, "root");
-    /**
-     * rep:system
-     */
-    public static final Name REP_SYSTEM = FACTORY.create(Name.NS_REP_URI, "system");
+    private static final Name rep(String local) {
+        return FACTORY.create(Name.NS_REP_URI, local);
+    }
-    /**
-     * rep:versionStorage
-     */
-    public static final Name REP_VERSIONSTORAGE = FACTORY.create(Name.NS_REP_URI, "versionStorage");
+    /** rep:root */
+    public static final Name REP_ROOT = rep("root");
-    /**
-     * rep:Activities
-     */
-    public static final Name REP_ACTIVITIES = FACTORY.create(Name.NS_REP_URI, "Activities");
+    /** rep:system */
+    public static final Name REP_SYSTEM = rep("system");
-    /**
-     * rep:Configurations
-     */
-    public static final Name REP_CONFIGURATIONS = FACTORY.create(Name.NS_REP_URI, "Configurations");
+    /** rep:versionStorage */
+    public static final Name REP_VERSIONSTORAGE = rep("versionStorage");
-    /**
-     * rep:baseVersions
-     */
-    public static final Name REP_BASEVERSIONS = FACTORY.create(Name.NS_REP_URI, "baseVersions");
+    /** rep:Activities */
+    public static final Name REP_ACTIVITIES = rep("Activities");
-    /**
-     * rep:VersionReference
-     */
-    public static final Name REP_VERSION_REFERENCE = FACTORY.create(Name.NS_REP_URI, "VersionReference");
+    /** rep:Configurations */
+    public static final Name REP_CONFIGURATIONS = rep("Configurations");
-    /**
-     * rep:versions
-     */
-    public static final Name REP_VERSIONS = FACTORY.create(Name.NS_REP_URI, "versions");
+    /** rep:baseVersions */
+    public static final Name REP_BASEVERSIONS = rep("baseVersions");
+
+    /** rep:VersionReference */
+    public static final Name REP_VERSION_REFERENCE = rep("VersionReference");
+
+    /** rep:versions */
+    public static final Name REP_VERSIONS = rep("versions");
-    /**
-     * rep:nodeTypes
-     */
-    public static final Name REP_NODETYPES = FACTORY.create(Name.NS_REP_URI, "nodeTypes");
+    /** rep:nodeTypes */
+    public static final Name REP_NODETYPES = rep("nodeTypes");
+
+    /** rep:policy */
+    public static final Name REP_POLICY = rep("policy");
+
+    /** rep:accesscontrol */
+    public static final Name REP_ACCESSCONTROL = rep("accesscontrol");
+
+    /** rep:privileges  */
+    public static final Name REP_PRIVILEGES = rep("privileges");
+
+    /** rep:principalName  */
+    public static final Name REP_PRINCIPAL_NAME = rep("principalName");
+
+    /** rep:glob */
+    public static final Name REP_GLOB = rep("glob");
+
+    /** rep:AccessControllable */
+    public static final Name REP_ACCESS_CONTROLLABLE = rep("AccessControllable");
+
+    /** rep:ACL */
+    public static final Name REP_ACL = rep("ACL");
+
+    /** rep:ACE */
+    public static final Name REP_ACE = rep("ACE");
+
+    /** rep:GrantACE */
+    public static final Name REP_GRANT_ACE = rep("GrantACE");
+
+    /** rep:DenyACE */
+    public static final Name REP_DENY_ACE = rep("DenyACE");
+
+    /** rep:AccessControl */
+    public static final Name REP_ACCESS_CONTROL = rep("AccessControl");
+
+    /** rep:PrincipalAccessControl */
+    public static final Name REP_PRINCIPAL_ACCESS_CONTROL =
+        rep("PrincipalAccessControl");
+
+    /** rep:nodePath */
+    public static final Name REP_NODE_PATH = rep("nodePath");
+    //--------------------------------------------< privilege name constants >
+
+    /** jcr:read */
+    public static final Name JCR_READ =
+        FACTORY.create(Privilege.JCR_READ);
+
+    /** jcr:modifyProperties */
+    public static final Name JCR_MODIFY_PROPERTIES =
+        FACTORY.create(Privilege.JCR_MODIFY_PROPERTIES);
+
+    /** jcr:addChildNodes */
+    public static final Name JCR_ADD_CHILD_NODES =
+        FACTORY.create(Privilege.JCR_ADD_CHILD_NODES);
+
+    /** jcr:removeChildNodes */
+    public static final Name JCR_REMOVE_CHILD_NODES =
+        FACTORY.create(Privilege.JCR_REMOVE_CHILD_NODES);
+
+    /** jcr:removeNode */
+    public static final Name JCR_REMOVE_NODE =
+        FACTORY.create(Privilege.JCR_REMOVE_NODE);
+
+    /** jcr:readAccessControl */
+    public static final Name JCR_READ_ACCESS_CONTROL =
+        FACTORY.create(Privilege.JCR_READ_ACCESS_CONTROL);
+
+    /** jcr:modifyAccessControl */
+    public static final Name JCR_MODIFY_ACCESS_CONTROL =
+        FACTORY.create(Privilege.JCR_MODIFY_ACCESS_CONTROL);
+
+    /** jcr:nodeTypeManagement */
+    public static final Name JCR_NODE_TYPE_MANAGEMENT =
+        FACTORY.create(Privilege.JCR_NODE_TYPE_MANAGEMENT);
+
+    /** jcr:versionManagement */
+    public static final Name JCR_VERSION_MANAGEMENT =
+        FACTORY.create(Privilege.JCR_VERSION_MANAGEMENT);
+
+    /** jcr:lockManagement */
+    public static final Name JCR_LOCK_MANAGEMENT =
+        FACTORY.create(Privilege.JCR_LOCK_MANAGEMENT);
+
+    /** jcr:lifecycleManagement */
+    public static final Name JCR_LIFECYCLE_MANAGEMENT =
+        FACTORY.create(Privilege.JCR_LIFECYCLE_MANAGEMENT);
+
+    /** jcr:retentionManagement */
+    public static final Name JCR_RETENTION_MANAGEMENT =
+        FACTORY.create(Privilege.JCR_RETENTION_MANAGEMENT);
+

INS26 INS26 MOV23 MOV23 MOV23 MOV23 MOV23 MOV23 MOV23 INS40 INS40 INS23 INS31 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 INS23 MOV29 MOV83 MOV83 MOV83 INS43 INS59 INS83 INS83 INS83 INS43 INS42 INS44 INS8 INS29 INS83 INS83 INS83 MOV43 INS59 MOV43 INS29 INS83 INS83 INS83 MOV43 INS59 INS29 INS83 INS83 INS83 MOV43 INS59 INS29 INS83 INS83 INS83 MOV43 INS59 INS29 INS83 INS83 INS83 MOV43 INS59 INS29 INS83 INS83 INS83 MOV43 INS59 INS29 INS83 INS83 INS83 MOV43 INS59 INS29 INS83 INS83 INS83 MOV43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS43 INS43 INS43 INS43 INS43 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS43 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS43 INS42 INS42 INS32 INS42 INS43 INS42 INS41 INS65 INS42 INS32 INS65 INS42 INS32 INS65 INS42 INS32 INS65 INS42 INS32 INS65 INS42 INS32 INS65 INS42 INS32 INS65 INS42 INS32 INS65 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS42 UPD42 INS42 UPD42 INS42 UPD42 INS42 UPD42 INS42 UPD42 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS42 UPD42 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS32 INS42 UPD42 UPD66 MOV42 MOV42 INS40 INS42 INS32 INS66 INS42 MOV45 UPD66 UPD42 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 INS66 INS42 INS45 UPD66 UPD40 UPD66 UPD40 UPD66 UPD40 UPD66 UPD40 UPD66 UPD40 INS66 INS42 INS42 INS40 INS66 INS42 INS42 INS40 INS66 INS42 INS42 INS40 UPD66 UPD40 INS66 INS42 INS42 INS40 INS66 INS42 INS42 INS40 UPD66 UPD40 INS42 INS42 MOV40 INS42 DEL42 DEL32 DEL59 DEL23 DEL42 DEL40 DEL45 DEL45 DEL45 DEL45 DEL45 DEL45 DEL45