JCR-2183 - Provide overridables for lock checking
- Add public LockInfo class
- Make AbstractLockInfo package private
- Rename internal LockInfo classes to avoid confusion
- Add overridable in LockManagerImpl with default implementation

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@790892 13f79535-47bb-0310-9956-ffa450edef68

-    private final Map lockedNodesMap = new HashMap();
+    private final Map<NodeId, XALockInfo> lockedNodesMap = 
+    		new HashMap<NodeId, XALockInfo>();
-    private final Map unlockedNodesMap = new HashMap();
+    private final Map<NodeId, XALockInfo> unlockedNodesMap = 
+    		new HashMap<NodeId, XALockInfo>();
-    private final List operations = new ArrayList();
+    private final List<XALockInfo> operations = new ArrayList<XALockInfo>();
-        LockInfo info = (LockInfo) unlockedNodesMap.get(id);
+        XALockInfo info = unlockedNodesMap.get(id);
-        info = new LockInfo(node, new LockToken(id), isSessionScoped, isDeep, lockOwner);
+        info = new XALockInfo(node, new LockToken(id), isSessionScoped, isDeep, lockOwner);
-        AbstractLockInfo info = (LockInfo) lockedNodesMap.get(id);
+        AbstractLockInfo info = lockedNodesMap.get(id);
-            } else if (info.getLockHolder() != node.getSession()) {
+            } else if (!info.isLockHolder(node.getSession())) {
-            info = new LockInfo(node, info);
-            unlockedNodesMap.put(id, info);
-            operations.add(info);
+            XALockInfo xaInfo = new XALockInfo(node, info);
+            unlockedNodesMap.put(id, xaInfo);
+            operations.add(xaInfo);
-        AbstractLockInfo info = getLockInfo(node);
-        return info != null;
+        return getLockInfo(node) != null;
-                LockInfo info = (LockInfo) lockedNodesMap.get(current.getId());
+                XALockInfo info = lockedNodesMap.get(current.getId());
-        ArrayList result = new ArrayList();
+    	
+        ArrayList<AbstractLockInfo> result = new ArrayList<AbstractLockInfo>();
-        // get lock infos from global lock manager first
+        // get lock informations from global lock manager first
-        // add 'uncommitted' lock infos
+        // add 'uncommitted' lock informations
-                if (info.getLockHolder() == null) {
+            	if (info.isLockHolder(session)) {
+            		// nothing to do
+            	} else if (info.getLockHolder() == null) {
-                if (session == info.getLockHolder()) {
+            	if (info.isLockHolder(session)) {
+            	} else if (info.getLockHolder() == null) {
+            		// nothing to do
-                        LockInfo info = (LockInfo) operations.get(opIndex);
+                        XALockInfo info = operations.get(opIndex);
-                            LockInfo info = (LockInfo) operations.get(opIndex - 1);
+                            XALockInfo info = operations.get(opIndex - 1);
-                        LockInfo info = (LockInfo) operations.get(opIndex - 1);
+                        XALockInfo info = operations.get(opIndex - 1);
-        if (info instanceof LockInfo) {
-            LockInfo lockInfo = (LockInfo) info;
+        if (info instanceof XALockInfo) {
+            XALockInfo lockInfo = (XALockInfo) info;
-    class LockInfo extends AbstractLockInfo {
+    class XALockInfo extends AbstractLockInfo {
-        public LockInfo(NodeImpl node, LockToken lockToken,
-                        boolean sessionScoped, boolean deep, String lockOwner) {
+        public XALockInfo(NodeImpl node, LockToken lockToken,
+        				  boolean sessionScoped, boolean deep, String lockOwner) {
-        public LockInfo(NodeImpl node, LockToken lockToken,
-                        boolean sessionScoped, boolean deep, String lockOwner,
-                        long timeoutHint) {
+        public XALockInfo(NodeImpl node, LockToken lockToken,
+                          boolean sessionScoped, boolean deep, String lockOwner,
+                          long timeoutHint) {
-        public LockInfo(NodeImpl node, AbstractLockInfo info) {
+        public XALockInfo(NodeImpl node, AbstractLockInfo info) {

INS74 INS74 INS74 UPD42 MOV43 INS43 INS43 MOV43 INS43 INS43 MOV43 INS43 INS41 UPD42 UPD42 UPD42 INS42 INS42 INS74 INS42 INS42 INS74 INS42 INS74 UPD43 INS27 INS74 MOV43 INS43 INS43 MOV43 INS43 INS43 MOV43 INS43 UPD42 MOV32 MOV32 INS60 INS32 MOV33 MOV43 INS43 UPD43 INS42 INS42 INS42 INS42 INS42 UPD43 INS43 INS59 MOV42 MOV42 INS42 INS74 UPD42 UPD43 UPD42 INS38 INS42 INS42 INS14 UPD42 UPD42 MOV43 INS43 INS25 UPD42 INS32 UPD43 MOV43 MOV42 MOV42 UPD43 INS42 INS32 INS8 MOV25 INS32 INS25 UPD43 INS42 INS42 MOV32 UPD42 UPD42 MOV32 INS42 INS42 INS42 MOV42 UPD42 MOV42 INS42 UPD27 MOV27 INS8 MOV8 UPD42 INS33 UPD43 UPD43 UPD42 MOV32 UPD42 MOV32 UPD43 UPD42 MOV32 DEL42 DEL43 DEL11 DEL42 DEL43 DEL11 DEL42 DEL14 DEL7 DEL21 DEL42 DEL43 DEL42 DEL32 DEL59 DEL60 DEL42 DEL27 DEL41 DEL42 DEL43 DEL11 DEL42 DEL32 DEL27 DEL42 DEL43 DEL11 DEL42 DEL43 DEL11 DEL42 DEL43 DEL11