JCR-2459: Improved error reporting from JcrUtils.getRepository

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@897858 13f79535-47bb-0310-9956-ffa450edef68

+        String newline = System.getProperty("line.separator");
+
+        // Prepare the potential error message (JCR-2459)
+        StringBuilder log = new StringBuilder("Unable to access a repository");
+        if (parameters != null) {
+            log.append(" with the following settings:");
+            for (Map.Entry<String, String> entry : parameters.entrySet()) {
+                log.append(newline);
+                log.append("    ");
+                log.append(entry.getKey());
+                log.append(": ");
+                log.append(entry.getValue());
+            }
+        } else {
+            log.append(" with the default settings.");
+        }
+
+        // Iterate through the available RepositoryFactories, with logging
+        log.append(newline);
+        log.append("The following RepositoryFactory classes were consulted:");
-
-            Repository repository = factory.getRepository(parameters);
-            if (repository != null) {
-                return repository;
+            log.append(newline);
+            log.append("    ");
+            log.append(factory.getClass().getName());
+            try {
+                Repository repository = factory.getRepository(parameters);
+                if (repository != null) {
+                    // We found the requested repository! Return it
+                    // and just ignore the error message being built.
+                    return repository;
+                } else {
+                    log.append(": declined");
+                }
+            } catch (Exception e) {
+                log.append(": ");
+                log.append(e.getMessage());
-        throw new RepositoryException(
-                "No repository factory can handle the given configuration: "
-                + parameters);
+        // No matching repository found. Throw an exception with the
+        // detailed information we gathered during the above process.
+        throw new RepositoryException(log.toString());

INS60 INS60 INS25 INS21 INS21 INS53 INS43 INS59 INS43 INS59 INS27 INS8 INS8 INS32 INS32 INS8 INS14 INS42 INS42 INS32 INS42 INS42 INS14 MOV42 INS33 INS21 INS70 INS21 INS42 INS42 INS42 INS42 INS42 INS45 MOV60 INS21 INS21 INS21 INS54 MOV43 INS32 INS42 INS42 INS45 INS43 INS45 INS32 INS44 INS32 INS8 INS32 INS32 INS32 INS32 MOV8 INS12 INS42 INS42 INS42 INS42 INS42 INS45 INS74 INS42 INS42 INS42 INS21 INS21 INS21 INS21 INS21 INS42 INS42 INS45 INS42 INS42 INS42 INS42 INS42 INS45 INS42 INS42 INS32 INS44 INS8 INS43 INS43 INS43 INS32 INS32 INS32 INS32 INS32 INS32 INS42 INS8 INS43 INS42 INS21 INS21 INS40 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS45 INS42 INS42 INS32 INS42 INS42 INS45 INS42 INS42 INS32 INS42 INS42 INS21 INS42 INS32 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS45 INS42 INS42 INS32 INS42 INS42 INS45 INS42 INS42 DEL45 DEL27 DEL14 DEL53