JCR-3367 implement InMemBundlePM#getAllNodeIds correctly

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1355402 13f79535-47bb-0310-9956-ffa450edef68

-        bundleStore = new HashMap<NodeId, byte[]>(initialCapacity, loadFactor);
+        bundleStore = new LinkedHashMap<NodeId, byte[]>(initialCapacity, loadFactor);
-        // ignore after and count parameters.
-        List<NodeId> result = new ArrayList<NodeId>();
-        result.addAll(bundleStore.keySet());
+        final List<NodeId> result = new ArrayList<NodeId>();
+        boolean add = after == null;
+        int count = 0;
+        for (NodeId nodeId : bundleStore.keySet()) {
+            if (add) {
+                result.add(nodeId);
+                if (++count == maxCount) {
+                    break;
+                }
+            } else {
+                add = nodeId.equals(after);
+            }
+        }

INS8 MOV60 INS60 INS60 INS70 MOV41 INS83 INS39 INS59 INS39 INS59 INS44 MOV32 INS8 INS42 INS27 INS42 INS34 INS43 INS42 INS25 UPD74 INS42 INS33 INS42 INS42 INS8 INS8 UPD43 MOV21 INS25 INS21 UPD42 INS27 INS8 INS7 UPD42 INS42 INS38 INS42 INS10 INS42 INS32 INS42 INS42 INS42 INS42 DEL8