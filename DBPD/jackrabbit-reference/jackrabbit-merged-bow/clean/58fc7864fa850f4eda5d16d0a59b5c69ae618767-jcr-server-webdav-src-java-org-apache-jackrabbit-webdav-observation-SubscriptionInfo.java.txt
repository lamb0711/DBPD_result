- add methods for observation to client
- minor improvements to observation impl in jcr-server
- fix client LockMethod and adjust LockDiscovery accordingly
- fix client MergeMethod adjust corresponding Info object accordingly
- improve UpdateInfo
- use CodedURLHeader instaed of building locktoken header manually

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@421206 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.header.TimeoutHeader;
+import org.apache.jackrabbit.webdav.header.DepthHeader;
-     * Create a new <code>SubscriptionInfo</code>
-     *
+     * Create a new <code>SubscriptionInfo</code> from the given Xml element
+     * and from additional information that is transported within the request
+     * header:
+     * <ul>
+     * <li>{@link TimeoutHeader timeout},</li>
+     * <li>{@link DepthHeader isDeep}</li>
+     * </ul>
-     * @param timeout as defined by the {@link org.apache.jackrabbit.webdav.DavConstants#HEADER_TIMEOUT timeout header}.
-     * @param isDeep as defined by the {@link org.apache.jackrabbit.webdav.DavConstants#HEADER_DEPTH depth header}.
+     * @param timeout as defined in the {@link org.apache.jackrabbit.webdav.DavConstants#HEADER_TIMEOUT timeout header}.
+     * @param isDeep as defined in the {@link org.apache.jackrabbit.webdav.DavConstants#HEADER_DEPTH depth header}.
-        List typeList = new ArrayList();
-            ElementIterator it = DomUtil.getChildren(el);
-            while (it.hasNext()) {
-                Element typeElem = it.nextElement();
-                EventType et = new SimpleEventType(typeElem.getLocalName(), DomUtil.getNamespace(typeElem));
-                typeList.add(et);
+            eventTypes = DefaultEventType.createFromXml(el);
+            if (eventTypes.length == 0) {
+                log.warn("'subscriptioninfo' must at least indicate a single, valid event type.");
+                throw new DavException(DavServletResponse.SC_BAD_REQUEST);
-        if (typeList.isEmpty()) {
-            log.warn("'subscriptioninfo' must at least indicate a single event type.");
-            throw new DavException(DavServletResponse.SC_BAD_REQUEST);
-        }
-        eventTypes = (EventType[]) typeList.toArray(new EventType[typeList.size()]);
-
-
-    //--------------------------------------------------------< inner class >---
-    /**
-     * Simple EventType implementation that only consists of a qualified event
-     * name.
-     */
-    private class SimpleEventType implements EventType {
-
-        private String localName;
-        private Namespace namespace;
-
-        SimpleEventType(String localName, Namespace namespace) {
-            this.localName = localName;
-            this.namespace = namespace;
-        }
-
-        public Element toXml(Document document) {
-            return DomUtil.createElement(document, localName, namespace);
-        }
-
-        public String getName() {
-            return localName;
-        }
-
-        public Namespace getNamespace() {
-            return namespace;
-        }
-    }

INS26 INS26 INS40 INS40 INS25 UPD66 INS66 INS66 INS66 INS66 INS65 INS66 INS66 INS65 INS66 INS66 UPD66 UPD66 MOV27 INS8 MOV8 INS42 INS66 INS42 INS66 MOV21 MOV25 INS27 INS32 INS40 INS34 INS42 UPD42 MOV42 UPD42 MOV42 UPD45 DEL42 DEL43 DEL42 DEL42 DEL43 DEL14 DEL59 DEL60 DEL42 DEL43 DEL85 DEL5 DEL42 DEL42 DEL42 DEL43 DEL85 DEL5 DEL32 DEL3 DEL32 DEL11 DEL42 DEL42 DEL32 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL42 DEL32 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL14 DEL59 DEL60 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL61 DEL8 DEL25 DEL66 DEL66 DEL65 DEL29 DEL83 DEL42 DEL42 DEL43 DEL83 DEL42 DEL43 DEL42 DEL59 DEL23 DEL83 DEL42 DEL43 DEL42 DEL59 DEL23 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL8 DEL31 DEL83 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31 DEL83 DEL42 DEL43 DEL42 DEL42 DEL41 DEL8 DEL31 DEL83 DEL42 DEL43 DEL42 DEL42 DEL41 DEL8 DEL31 DEL55