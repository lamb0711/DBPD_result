JCR-1588 - JSR 283: Access Control (work in progress)
JCR-1590 - JSR 283: Locking
JCR-1915 - Node.setPrimaryNodeType should only redefine child-definitions that are not covered by the new effective nt
JCR-1875 - Failing Node.unlock() might leave inconsistent transient state
JCR-538 - Failing Node.checkin() or Node.checkout() might leave inconsistent transient state

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@732693 13f79535-47bb-0310-9956-ffa450edef68

+        return lock(node, isDeep, isSessionScoped, Long.MAX_VALUE, null);
+    }
+    /**
+     * @see LockManager#lock(NodeImpl, boolean, boolean, long, String)
+     */
+    public Lock lock(NodeImpl node, boolean isDeep, boolean isSessionScoped, long timoutHint, String ownerInfo)
+            throws LockException, RepositoryException {
-            info = xaEnv.lock(node, isDeep, isSessionScoped);
+            info = xaEnv.lock(node, isDeep, isSessionScoped, timoutHint, ownerInfo);
-            info = lockMgr.internalLock(node, isDeep, isSessionScoped);
+            info = lockMgr.internalLock(node, isDeep, isSessionScoped, timoutHint, ownerInfo);
+        lockMgr.writeLockProperties(node, info.lockOwner, info.deep);
+        lockMgr.removeLockProperties(node);
-            lockMgr.unlock(node);
+            lockMgr.internalUnlock(node);

INS31 MOV29 INS83 INS43 INS42 INS44 INS44 INS44 INS43 INS43 INS8 INS29 INS44 INS44 INS42 INS43 INS42 INS39 INS42 INS39 INS42 INS42 INS42 INS41 INS65 INS39 INS42 INS43 INS42 INS21 INS21 INS42 INS32 INS68 INS42 INS32 INS32 INS42 INS42 INS42 INS42 INS40 INS33 INS42 INS42 INS69 INS69 INS69 INS69 INS69 INS42 INS42 INS42 INS40 INS40 INS42 INS42 INS42 INS43 INS39 INS39 INS39 INS43 INS42 INS42 UPD42 INS42 INS42 INS42 INS42