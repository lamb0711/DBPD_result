JCR-1588: 283 Access Control

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@689499 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.api.jsr283.security.AccessControlEntry;
-import org.apache.jackrabbit.api.jsr283.security.AccessControlException;
+import org.apache.jackrabbit.core.security.authorization.NamedAccessControlPolicyImpl;
-import org.apache.jackrabbit.core.security.authorization.PolicyTemplate;
-import javax.jcr.UnsupportedRepositoryOperationException;
-import java.security.Principal;
+     * The policy returned upon {@link #getEffectivePolicies(String)}
+     */
+    private static final AccessControlPolicy POLICY = new NamedAccessControlPolicyImpl("Simple AccessControlPolicy");
+
+    /**
+    private PrivilegeRegistry privilegeRegistry;
-    //--------------------------------------------------------< AccessManager >
+    //------------------------------------------------------< AccessManager >---
+        privilegeRegistry = new PrivilegeRegistry(resolver);
-            int bits = PrivilegeRegistry.getBits(privileges);
+            int bits = privilegeRegistry.getBits(privileges);
-            return new Privilege[] {PrivilegeRegistry.READ_PRIVILEGE};
+            return privilegeRegistry.getPrivileges(PrivilegeRegistry.READ);
-            return new Privilege[] {PrivilegeRegistry.ALL_PRIVILEGE};
+            return privilegeRegistry.getPrivileges(PrivilegeRegistry.ALL);
-            return new Privilege[] {PrivilegeRegistry.ALL_PRIVILEGE};
+            return privilegeRegistry.getPrivileges(PrivilegeRegistry.ALL);
-    public AccessControlPolicy getEffectivePolicy(String absPath) throws PathNotFoundException, AccessDeniedException, RepositoryException {
+    public AccessControlPolicy[] getEffectivePolicies(String absPath) throws PathNotFoundException, AccessDeniedException, RepositoryException {
-        return new AccessControlPolicy() {
-            public String getName() throws RepositoryException {
-                return "Simple AccessControlPolicy";
-            }
-            public String getDescription() throws RepositoryException {
-                return null;
-            }
-        };
-    }
-
-    /**
-     * {@inheritDoc}
-     */
-    public AccessControlEntry[] getEffectiveAccessControlEntries(String absPath) throws PathNotFoundException, AccessDeniedException, RepositoryException {
-        checkInitialized();
-        checkPrivileges(absPath, PrivilegeRegistry.READ_AC);
-
-        return new AccessControlEntry[0];
-    }
-
-    //-------------------------------------< JackrabbitAccessControlManager >---
-    /**
-     * {@inheritDoc}
-     */
-    public PolicyTemplate editPolicy(String absPath) throws AccessDeniedException, AccessControlException, UnsupportedRepositoryOperationException, RepositoryException {
-        checkInitialized();
-        checkPrivileges(absPath, PrivilegeRegistry.MODIFY_AC);
-
-        throw new UnsupportedRepositoryOperationException("Editing is not supported");
-    }
-
-    /**
-     * {@inheritDoc}
-     */
-    public PolicyTemplate editPolicy(Principal principal) throws AccessDeniedException, AccessControlException, UnsupportedRepositoryOperationException, RepositoryException {
-        throw new UnsupportedRepositoryOperationException("Editing is not supported");
+        return new AccessControlPolicy[] {POLICY};
-     * {@inheritDoc}
+     * @see AbstractAccessControlManager#checkInitialized()
+    /**
+     * @see AbstractAccessControlManager#checkPrivileges(String, int)
+     */
+    /**
+     * @see AbstractAccessControlManager#getPrivilegeRegistry()
+     */
+    protected PrivilegeRegistry getPrivilegeRegistry()
+            throws RepositoryException {
+        checkInitialized();
+        return privilegeRegistry;
+    }
+
+    /**
+     * @see AbstractAccessControlManager#checkValidNodePath(String)
+     */

MOV26 MOV31 MOV31 UPD40 INS23 INS23 INS29 INS83 INS83 INS83 INS43 INS59 INS83 INS43 INS59 MOV29 MOV5 INS42 MOV44 MOV43 MOV43 INS8 INS5 UPD42 INS29 UPD83 INS43 INS42 MOV43 INS29 INS65 UPD42 MOV42 INS42 INS14 UPD42 MOV42 INS42 INS21 MOV21 MOV21 INS25 MOV43 INS85 INS65 INS65 INS65 UPD42 MOV42 MOV21 INS41 INS65 INS66 INS65 INS43 INS45 INS7 INS42 INS8 INS25 INS3 INS68 INS68 INS68 INS42 INS68 INS68 UPD42 MOV42 INS42 INS14 INS41 INS42 INS8 INS8 INS5 INS4 INS42 INS42 INS42 INS42 INS69 INS69 INS42 INS42 INS42 INS42 INS69 INS42 INS69 INS43 INS42 INS32 INS41 INS41 MOV43 INS85 INS42 MOV43 INS39 MOV43 INS43 INS42 INS42 INS42 INS40 INS32 INS32 UPD42 MOV42 UPD42 INS42 INS42 INS40 UPD42 MOV42 UPD42 MOV42 UPD40 MOV40 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL83 DEL42 DEL42 DEL43 DEL85 DEL5 DEL40 DEL4 DEL3 DEL41 DEL8 DEL42 DEL42 DEL43 DEL85 DEL5 DEL40 DEL4 DEL3 DEL41 DEL8 DEL42 DEL43 DEL85 DEL5 DEL40 DEL4 DEL3 DEL41 DEL8 DEL25 DEL25 DEL8 DEL31 DEL65 DEL65 DEL29 DEL83 DEL43 DEL85 DEL5 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL43 DEL43 DEL42 DEL32 DEL21 DEL42 DEL42 DEL40 DEL32 DEL21 DEL42 DEL43 DEL85 DEL5 DEL34 DEL3 DEL41 DEL8 DEL31 DEL65 DEL65 DEL29 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL32 DEL21 DEL42 DEL43 DEL45 DEL14 DEL53 DEL8 DEL83 DEL42 DEL42 DEL43 DEL45 DEL41 DEL8 DEL31 DEL83 DEL42 DEL33 DEL41 DEL8 DEL31 DEL1 DEL14 DEL65 DEL65 DEL65 DEL65 DEL42 DEL43 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL45 DEL14 DEL53