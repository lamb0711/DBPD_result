fixing JCR-44: Overwriting a reference property with different type corrupts rep

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@153396 13f79535-47bb-0310-9956-ffa450edef68

-                if (propState.getType() == PropertyType.REFERENCE) {
-                    if (propState.getStatus() == ItemState.STATUS_EXISTING_MODIFIED) {
+                int type = propState.getType();
+                if (propState.getStatus() == ItemState.STATUS_EXISTING_MODIFIED) {
+                    // this is a modified property, check old type...
+                    PropertyState oldPropState = (PropertyState) propState.getOverlayedState();
+                    int oldType = oldPropState.getType();
+                    if (oldType == PropertyType.REFERENCE) {
-                        PropertyState oldPropState = (PropertyState) propState.getOverlayedState();
-                    // add the reference stored in the new value
+                }
+                if (type == PropertyType.REFERENCE) {
+                    // this is a modified REFERENCE property:
+                    // add the 'reference' stored in the new value

MOV8 MOV60 INS61 MOV60 MOV61 MOV60 MOV61 MOV41 MOV32 MOV8 MOV60 MOV38 MOV60 INS60 INS25 INS39 INS59 INS27 INS8 INS42 MOV32 INS60 INS25 INS42 INS40 MOV60 MOV24 INS39 INS59 INS27 INS8 INS42 INS32 INS42 INS40 MOV60 MOV24 INS42 INS42 DEL40 DEL27 DEL61 DEL8