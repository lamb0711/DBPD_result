JCR-1593 JSR 283: Simple versioning
JCR-2058 JSR 283: VersionManager and new versioning methods


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@765556 13f79535-47bb-0310-9956-ffa450edef68

-                    if (pd.getDeclaringNodeType().equals(NameConstants.MIX_VERSIONABLE)) {
+                    if (pd.getDeclaringNodeType().equals(NameConstants.MIX_VERSIONABLE)
+                            || pd.getDeclaringNodeType().equals(NameConstants.MIX_SIMPLE_VERSIONABLE)) {
+                } else if (nt.includesNodeType(NameConstants.MIX_SIMPLE_VERSIONABLE)) {
+                    // we need to check the version manager for an existing
+                    // version history, since simple versioning does not
+                    // expose it's reference in a property
+                    VersionManager vMgr = session.getVersionManager();
+                    vMgr.getVersionHistory(session, nodeState);
+
+                    // create isCheckedOutProperty if not already exists
+                    NodeImpl node = (NodeImpl) itemMgr.getItem(itemState.getId());
+                    if (!nodeState.hasPropertyName(NameConstants.JCR_ISCHECKEDOUT)) {
+                        node.internalSetProperty(
+                                NameConstants.JCR_ISCHECKEDOUT,
+                                InternalValue.create(true));
+                        createdTransientState = true;
+                    }

INS25 INS32 INS8 INS27 INS42 INS42 INS40 INS60 INS21 INS60 INS25 MOV32 INS32 INS43 INS59 INS32 INS43 INS59 INS38 INS8 INS32 INS42 INS40 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS11 INS32 INS21 INS21 INS42 INS42 INS42 INS42 INS43 INS32 INS42 INS42 INS40 INS32 INS7 INS42 INS42 INS42 INS32 INS42 INS42 INS40 INS32 INS42 INS9 INS42 INS42 INS42 INS42 INS9