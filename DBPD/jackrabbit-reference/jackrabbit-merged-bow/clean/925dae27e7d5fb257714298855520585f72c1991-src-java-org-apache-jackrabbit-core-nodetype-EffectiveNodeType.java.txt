- fixed value constraint handling as spec'ed
- misc. minor fixes

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@109221 13f79535-47bb-0310-9956-ffa450edef68

-        // check value constraints
-        if (constraints != null && constraints.length != 0) {
-            for (int i = 0; i < constraints.length; i++) {
-                if (values == null || values.length == 0) {
-                    constraints[i].check(null);
-                } else {
-                    for (int j = 0; j < values.length; j++) {
-                        constraints[i].check(values[j]);
+        if (constraints == null || constraints.length == 0) {
+            // no constraints to check
+            return;
+        }
+        if (values != null || values.length > 0) {
+            // check value constraints on every value
+            for (int i = 0; i < values.length; i++) {
+                // constraints are OR-ed together
+                boolean satisfied = false;
+                ConstraintViolationException cve = null;
+                for (int j = 0; j < constraints.length; j++) {
+                    try {
+                        constraints[j].check(values[i]);
+                        satisfied = true;
+                        break;
+                    } catch (ConstraintViolationException e) {
+                        cve = e;
+                        continue;
+                if (!satisfied) {
+                    // re-throw last exception we encountered
+                    throw cve;
+                }

INS25 MOV25 UPD27 MOV27 INS8 INS8 UPD27 UPD27 INS41 UPD27 UPD27 INS24 MOV58 INS27 MOV37 INS8 INS42 INS40 INS60 INS60 MOV24 INS25 INS39 INS59 INS43 INS59 INS8 INS38 INS8 INS42 INS9 INS42 INS42 INS33 UPD40 INS54 INS42 INS53 INS8 INS12 INS42 MOV21 INS21 INS10 INS44 INS8 INS7 INS43 INS42 INS21 INS18 INS42 INS9 INS42 INS7 UPD42 UPD42 INS42 INS42 DEL8 DEL42 DEL42 DEL2 DEL42 DEL33 DEL32 DEL21 DEL8 DEL8 DEL42 DEL40 DEL27 DEL8 DEL24 DEL8 DEL25