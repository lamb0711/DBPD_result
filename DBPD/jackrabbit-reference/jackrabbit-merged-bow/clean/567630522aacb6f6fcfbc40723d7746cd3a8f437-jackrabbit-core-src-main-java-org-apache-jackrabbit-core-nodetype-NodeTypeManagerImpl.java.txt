JCR-2170: Remove PropDefId and NodeDefId
- merged changes from sandbox branch

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@816343 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.spi.QPropertyDefinition;
+import org.apache.jackrabbit.spi.QNodeDefinition;
-import org.apache.jackrabbit.spi.commons.nodetype.AbstractNodeTypeManager;
-import org.apache.jackrabbit.spi.commons.nodetype.InvalidConstraintException;
+import org.apache.jackrabbit.spi.commons.nodetype.*;
+import org.apache.jackrabbit.spi.commons.nodetype.NodeDefinitionImpl;
+import org.apache.jackrabbit.spi.commons.nodetype.PropertyDefinitionImpl;
+import org.apache.jackrabbit.spi.commons.name.NameConstants;
-    private final Map<PropDefId, PropertyDefinitionImpl> pdCache;
+    private final Map<QPropertyDefinition, PropertyDefinitionImpl> pdCache;
-    private final Map<NodeDefId, NodeDefinitionImpl> ndCache;
+    private final Map<QNodeDefinition, NodeDefinitionImpl> ndCache;
-        ndCache.put(rootNodeDef.unwrap().getId(), rootNodeDef);
+        ndCache.put(rootNodeDef.unwrap(), rootNodeDef);
-     * @param id node def id
+     * @param def the QNodeDefinition
-    public NodeDefinitionImpl getNodeDefinition(NodeDefId id) {
+    public NodeDefinitionImpl getNodeDefinition(QNodeDefinition def) {
-            NodeDefinitionImpl ndi = ndCache.get(id);
+            NodeDefinitionImpl ndi = ndCache.get(def);
-                NodeDef nd = ntReg.getNodeDef(id);
-                if (nd != null) {
-                    ndi = new NodeDefinitionImpl(nd, this, session);
-                    ndCache.put(id, ndi);
-                }
+                ndi = new NodeDefinitionImpl(def, this, session);
+                ndCache.put(def, ndi);
-     * @param id prop def id
+     * @param def prop def
-    public PropertyDefinitionImpl getPropertyDefinition(PropDefId id) {
+    public PropertyDefinitionImpl getPropertyDefinition(QPropertyDefinition def) {
-            PropertyDefinitionImpl pdi = pdCache.get(id);
+            PropertyDefinitionImpl pdi = pdCache.get(def);
-                PropDef pd = ntReg.getPropDef(id);
-                if (pd != null) {
-                    pdi = new PropertyDefinitionImpl(pd, this, session, valueFactory);
-                    pdCache.put(id, pdi);
-                }
+                pdi = new PropertyDefinitionImpl(def, this, session, valueFactory);
+                pdCache.put(def, pdi);
-                NodeDefinitionImpl nd = (NodeDefinitionImpl) iter.next();
+                NodeDefinitionImpl nd = (org.apache.jackrabbit.spi.commons.nodetype.NodeDefinitionImpl) iter.next();
-            NodeDef[] qndefs = new NodeDef[ndefs.length];
+            QNodeDefinition[] qndefs = new QNodeDefinition[ndefs.length];
-                NodeDefImpl qndef = new NodeDefImpl();
+                QNodeDefinitionBuilder qndef = new QNodeDefinitionBuilder();
-                        qndef.setName(ItemDef.ANY_NAME);
+                        qndef.setName(NameConstants.ANY_NAME);
-                qndefs[i] = qndef;
+                qndefs[i] = qndef.build();
-            PropDef[] qpdefs = new PropDef[pdefs.length];
+            QPropertyDefinition[] qpdefs = new QPropertyDefinition[pdefs.length];
-                PropDefImpl qpdef = new PropDefImpl();
+                QPropertyDefinitionBuilder qpdef = new QPropertyDefinitionBuilder();
-                        qpdef.setName(ItemDef.ANY_NAME);
+                        qpdef.setName(NameConstants.ANY_NAME);
-                qpdefs[i] = qpdef;
+                qpdefs[i] = qpdef.build();

INS26 INS26 INS26 INS26 INS40 INS40 UPD40 UPD40 INS40 INS40 UPD74 UPD74 UPD43 UPD43 UPD43 UPD42 UPD43 UPD42 UPD42 UPD42 MOV32 MOV32 UPD42 UPD66 UPD42 UPD42 UPD66 UPD42 UPD42 INS42 INS42 MOV25 MOV25 MOV27 MOV43 MOV27 UPD5 UPD5 UPD43 UPD43 UPD42 UPD42 MOV43 UPD42 UPD5 UPD43 UPD42 UPD5 UPD43 UPD42 UPD42 UPD43 UPD42 INS32 UPD43 UPD42 INS32 UPD42 MOV43 UPD42 INS43 UPD42 UPD43 INS42 INS42 UPD42 UPD43 INS42 INS42 INS40 UPD42 UPD42 UPD40 UPD40 DEL42 DEL42 DEL42 DEL32 DEL42 DEL33 DEL27 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL8 DEL25 DEL42 DEL33 DEL27 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL8 DEL25 DEL42 DEL43 DEL42 DEL42