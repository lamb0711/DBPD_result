JCR-2085 test case (TCK) maintenance for JCR 2.0 (adding MergeActivityTest)
JCR-2058 JSR 283: VersionManager and new versioning methods (adapting to latest spec changes)


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@801413 13f79535-47bb-0310-9956-ffa450edef68

-            // workspaces are recorded.
+            // workspaces are recorded. so check all references if their sources
+            // exist in 'this' workspace
-                    if (refs.hasReferences()) {
-                        throw new ActivityViolationException("Unable to checkout. " +
-                                "Activity is already used for the same node in " +
-                                "another workspace.");
+                    for (PropertyId id: refs.getReferences()) {
+                        if (!state.hasNode(id.getParentId())) {
+                            throw new ActivityViolationException("Unable to checkout. " +
+                                    "Activity is already used for the same node in " +
+                                    "another workspace.");
+                        }

INS70 INS44 INS32 INS8 INS43 INS42 INS42 INS42 MOV25 INS42 INS38 INS32 UPD42 MOV42 UPD42 MOV42 INS32 INS42 INS42 DEL32