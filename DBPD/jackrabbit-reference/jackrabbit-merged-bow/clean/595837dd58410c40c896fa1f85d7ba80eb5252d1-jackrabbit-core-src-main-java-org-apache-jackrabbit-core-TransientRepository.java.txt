JCR-2555: Improved reusability of the JCA package

Fixed handing of repository map in RepositoryFactoryImpl. It turns out that RepositoryImpl.shutdown() will close the ConnectionFactory instance referenced by the RepositoryConfig object, so reusing the config for more than one repository instance will not work. A better fix would probably be to remove the ConnectionFactory reference from RepositoryConfig.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@923744 13f79535-47bb-0310-9956-ffa450edef68

-    public TransientRepository(Properties properties)
+    public TransientRepository(final Properties properties)
-        this(RepositoryConfig.install(properties));
+        this(new RepositoryFactory() {
+            public RepositoryImpl getRepository() throws RepositoryException {
+                try {
+                    return RepositoryImpl.create(
+                            RepositoryConfig.install(properties));
+                } catch (IOException e) {
+                    throw new RepositoryException(
+                            "Automatic repository configuration failed: "
+                            + RepositoryConfig.getRepositoryHome(properties), e);
+                } catch (ConfigurationException e) {
+                    throw new RepositoryException(
+                            "Invalid repository configuration: "
+                            + properties, e);
+                }
+            }
+        }, RepositoryConfig.getRepositoryHome(properties).getAbsolutePath());

INS8 INS83 INS17 INS14 INS32 INS43 INS1 INS32 INS42 INS42 INS31 INS42 INS42 INS42 INS83 INS43 INS42 INS43 INS8 INS42 INS42 INS54 MOV8 INS12 INS12 INS41 INS44 INS8 INS44 INS8 INS32 INS43 INS42 INS53 INS43 INS42 INS53 INS42 INS42 MOV32 INS42 INS14 INS42 INS14 INS43 INS27 INS42 INS43 INS27 INS42 INS42 INS45 INS32 INS42 INS45 INS42 INS42 INS42 INS42 DEL17