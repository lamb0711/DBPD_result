JCR-1850: Journal: Use buffered input / output streams

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@713072 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.BufferedOutputStream;
+import java.io.ByteArrayOutputStream;
-            DataInputStream in = new DataInputStream(new FileInputStream(logFile));
+            DataInputStream in = new DataInputStream(
+                    new BufferedInputStream(new FileInputStream(logFile), 128));
-            DataOutputStream out = new DataOutputStream(new FileOutputStream(logFile));
+            DataOutputStream out = new DataOutputStream(
+                    new BufferedOutputStream(new FileOutputStream(logFile), 128));
-        DataOutputStream out = new DataOutputStream(new FileOutputStream(logFile, true));
+        OutputStream out = new FileOutputStream(logFile, true);
-            out.writeUTF(journalId);
-            out.writeUTF(producerId);
-            out.writeInt(length);
+            DataBuffer buffer = new DataBuffer();
+            buffer.writeUTF(journalId);
+            buffer.writeUTF(producerId);
+            buffer.writeInt(length);
+            buffer.copy(out);
+
+    /**
+     * A simple helper class that writes to a buffer. The current buffer can
+     * be {@link #copy copied} to an output stream.
+     */
+    private static final class DataBuffer extends DataOutputStream {
+
+        public DataBuffer() {
+            super(new ByteArrayOutputStream());
+        }
+
+        /**
+         * Copies the bytes the are currently held in the buffer to the given
+         * output stream.
+         *
+         * @param out the output stream where the buffered data is written.
+         * @throws IOException if an error occurs while writing data to
+         *          <code>out</code>.
+         */
+        public void copy(OutputStream out) throws IOException {
+            byte[] buffer = ((ByteArrayOutputStream) super.out).toByteArray();
+            out.write(buffer);
+        }
+    }

INS26 INS26 INS40 INS40 INS55 INS29 INS83 INS83 INS83 INS42 MOV43 INS31 INS31 INS65 INS83 INS42 INS8 INS29 INS83 INS39 INS42 INS44 INS43 INS8 UPD43 INS66 INS66 INS65 INS66 INS46 INS65 INS65 INS65 INS43 INS42 INS42 INS60 INS21 UPD42 MOV14 INS60 INS21 INS67 INS66 INS14 INS66 INS66 INS42 INS66 INS42 INS66 INS66 INS42 INS5 INS59 INS32 INS43 INS59 INS32 INS42 INS43 INS39 INS85 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS14 UPD42 UPD42 UPD42 INS42 INS42 INS42 INS42 INS36 INS42 INS14 INS14 INS43 INS11 INS43 MOV14 INS34 INS43 MOV14 INS34 INS42 INS43 INS47 INS42 INS42 INS42 INS42 DEL14