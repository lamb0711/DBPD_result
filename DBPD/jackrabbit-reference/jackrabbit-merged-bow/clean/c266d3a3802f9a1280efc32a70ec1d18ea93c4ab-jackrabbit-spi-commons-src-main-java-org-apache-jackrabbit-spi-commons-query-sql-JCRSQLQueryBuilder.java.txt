JCR-1688: Query parser builds invalid parse tree

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@679054 13f79535-47bb-0310-9956-ffa450edef68

-                // create a dummy literal
-                ASTLiteral star = new ASTLiteral(JCRSQLParserTreeConstants.JJTLITERAL);
-                star.setType(QueryConstants.TYPE_STRING);
-                star.setValue("%");
-                        identifier, type, star);
+                        identifier, type, null);
-     * @param literal       the literal value for the relation.
+     * @param literal       the literal value for the relation or
+     *                      <code>null</code> if the relation does not have a
+     *                      literal (e.g. IS NULL).
-        String stringValue = literal.getValue();
-            if (literal.getType() == QueryConstants.TYPE_DATE) {
+            if (literal == null) {
+                node = factory.createRelationQueryNode(parent, operationType);
+                node.setRelativePath(relPath);
+            } else if (literal.getType() == QueryConstants.TYPE_DATE) {
-                Date date = format.parse(stringValue);
+                Date date = format.parse(literal.getValue());
-                double d = Double.parseDouble(stringValue);
+                double d = Double.parseDouble(literal.getValue());
-                long l = Long.parseLong(stringValue);
+                long l = Long.parseLong(literal.getValue());
-                node.setStringValue(stringValue);
+                node.setStringValue(literal.getValue());
-                Calendar c = ISO8601.parse(stringValue);
+                Calendar c = ISO8601.parse(literal.getValue());

UPD66 INS66 INS66 INS25 INS27 INS8 MOV25 INS42 INS33 INS21 INS21 INS7 INS32 MOV60 INS42 INS32 INS42 INS42 INS42 MOV43 INS42 INS42 INS42 INS42 UPD42 INS32 INS42 INS42 MOV32 INS32 INS42 UPD42 MOV42 INS32 INS32 INS33 INS42 UPD42 MOV42 INS42 UPD42 MOV42 INS32 INS42 UPD42 MOV42 DEL42 DEL43 DEL42 DEL42 DEL43 DEL40 DEL14 DEL59 DEL60 DEL42 DEL42 DEL40 DEL32 DEL21 DEL42 DEL42 DEL45 DEL32 DEL21 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60