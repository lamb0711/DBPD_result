- Minor fixes in jackrabbit that caused versioning test cases to fail.
- Added test case for ReferentialIntegrityException

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@161873 13f79535-47bb-0310-9956-ffa450edef68

-import javax.jcr.Session;
+import javax.jcr.version.VersionException;
-     * @param history
-     * @param name
+     *
+     * @param history the version history from where to remove the version.
+     * @param name the name of the version to remove.
+     * @throws VersionException if the version <code>history</code> does
+     *  not have a version with <code>name</code>.
+     * @throws RepositoryException if any other error occurs.
+        if (!((VersionHistoryImpl) history).hasNode(name)) {
+            throw new VersionException("Version with name " + name.toString()
+                    + " does not exist in this VersionHistory");
+        }
+        SessionImpl session = (SessionImpl) history.getSession();
-        obsMgr.dispatch(events, (SessionImpl) history.getSession());
+        obsMgr.dispatch(events, session);

MOV26 UPD40 INS65 INS65 INS25 INS60 INS66 INS66 INS42 INS66 INS66 INS42 INS66 INS38 INS8 INS43 INS59 INS32 INS53 INS42 INS42 MOV11 INS42 INS36 INS42 INS42 INS14 INS11 INS43 INS27 INS43 INS42 INS42 INS45 INS32 INS45 INS42 INS42 INS42