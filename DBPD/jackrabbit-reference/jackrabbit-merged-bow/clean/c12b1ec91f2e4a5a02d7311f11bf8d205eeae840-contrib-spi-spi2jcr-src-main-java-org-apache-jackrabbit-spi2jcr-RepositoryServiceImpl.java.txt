batch-operations: if parent cannot be retrieved InvalidItemStateException is appropriate rather than PathNotFoundException, because it indicates that the parent was available in jcr2spi but got removed in the mean time.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@518900 13f79535-47bb-0310-9956-ffa450edef68

-                    Node n = getNode(parentId, sInfo);
+                    Node parent = getParent(parentId, sInfo);
+
-                            n.addNode(jcrName);
+                            parent.addNode(jcrName);
-                            n.addNode(jcrName, ntName);
+                            parent.addNode(jcrName, ntName);
-                            s.importXML(n.getPath(), in, ImportUUIDBehavior.IMPORT_UUID_COLLISION_THROW);
+                            s.importXML(parent.getPath(), in, ImportUUIDBehavior.IMPORT_UUID_COLLISION_THROW);
-                    Node n = getNode(parentId, sInfo);
+                    Node parent = getParent(parentId, sInfo);
-                    n.setProperty(getJcrName(propertyName), jcrValue);
+                    parent.setProperty(getJcrName(propertyName), jcrValue);
-                    Node n = getNode(parentId, sInfo);
+                    Node n = getParent(parentId, sInfo);
-                    Node parent = getNode(parentId, sInfo);
+                    Node parent = getParent(parentId, sInfo);
-    private Node getNode(NodeId id, SessionInfoImpl sessionInfo) throws ItemNotFoundException, RepositoryException {
+    private Node getParent(NodeId parentId, SessionInfoImpl sessionInfo) throws InvalidItemStateException, RepositoryException {
+        try {
+            return getNode(parentId, sessionInfo);
+        } catch (PathNotFoundException e) {
+            // if the parent of an batch operation is not available, this indicates
+            // that it has been destroyed by another session.
+            throw new InvalidItemStateException(e);
+        }
+    }
+
+    private Node getNode(NodeId id, SessionInfoImpl sessionInfo) throws PathNotFoundException, RepositoryException {

INS31 INS83 INS43 INS42 INS44 INS44 INS43 INS43 INS8 UPD43 INS42 INS43 INS42 INS43 INS42 INS42 INS42 INS54 UPD42 INS42 INS42 INS8 INS12 INS41 INS44 INS8 INS32 INS43 INS42 INS53 INS42 INS42 INS42 INS42 INS14 INS43 INS42 INS42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42