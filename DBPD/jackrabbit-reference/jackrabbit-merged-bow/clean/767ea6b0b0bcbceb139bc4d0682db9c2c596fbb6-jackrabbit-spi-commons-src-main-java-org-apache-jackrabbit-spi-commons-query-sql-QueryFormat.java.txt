JCR-1674: Provide means for exception handling for QueryNodeVisitor implementations

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@677226 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.ArrayList;
+import java.util.Calendar;
+import java.util.Iterator;
+import java.util.List;
+import java.util.TimeZone;
+
+import javax.jcr.NamespaceException;
+import javax.jcr.RepositoryException;
+import javax.jcr.query.InvalidQueryException;
+
+import org.apache.jackrabbit.spi.Name;
+import org.apache.jackrabbit.spi.Path;
+import org.apache.jackrabbit.spi.commons.conversion.NameResolver;
-import org.apache.jackrabbit.spi.Name;
-import org.apache.jackrabbit.spi.Path;
-import org.apache.jackrabbit.spi.commons.conversion.NameResolver;
-
-import javax.jcr.query.InvalidQueryException;
-import javax.jcr.NamespaceException;
-import java.util.ArrayList;
-import java.util.Calendar;
-import java.util.Iterator;
-import java.util.List;
-import java.util.TimeZone;
-    private String statement;
+    private final String statement;
-    private List exceptions = new ArrayList();
+    private final List exceptions = new ArrayList();
-    private List nodeTypes = new ArrayList();
+    private final List nodeTypes = new ArrayList();
-            throws InvalidQueryException {
+            throws RepositoryException {
-        return new QueryFormat(root, resolver).toString();
+        try {
+            return new QueryFormat(root, resolver).toString();
+        }
+        catch (RepositoryException e) {
+            throw new InvalidQueryException(e);
+        }
-    public Object visit(QueryRootNode node, Object data) {
+    public Object visit(QueryRootNode node, Object data) throws RepositoryException {
-    public Object visit(OrQueryNode node, Object data) {
+    public Object visit(OrQueryNode node, Object data) throws RepositoryException {
-    public Object visit(AndQueryNode node, Object data) {
+    public Object visit(AndQueryNode node, Object data) throws RepositoryException {
-    public Object visit(NotQueryNode node, Object data) {
+    public Object visit(NotQueryNode node, Object data) throws RepositoryException {
-    public Object visit(PathQueryNode node, Object data) {
+    public Object visit(PathQueryNode node, Object data) throws RepositoryException {
-    public Object visit(RelationQueryNode node, Object data) {
+    public Object visit(RelationQueryNode node, Object data) throws RepositoryException {

MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 INS26 INS40 INS83 INS83 INS83 INS43 INS8 INS43 INS43 INS43 INS43 INS43 INS43 INS42 INS54 INS42 INS42 INS42 INS42 INS42 INS42 MOV8 INS12 INS44 INS8 INS43 INS42 INS53 INS42 INS14 MOV43 INS42