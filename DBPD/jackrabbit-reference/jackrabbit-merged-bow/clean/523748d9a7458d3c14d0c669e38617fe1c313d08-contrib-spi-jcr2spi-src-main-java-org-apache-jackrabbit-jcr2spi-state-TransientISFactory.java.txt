minor improvement: remove unused instance fields
minor improvement: let TransientISFactory listen to states created by the WorkspaceItemStateFactory
JCR-1004 SPI: Add RepositoryService.getQNodeTypeDefinition 
         >> modify to RepositoryService.getQNodeTypeDefinitions(QName)
         >> adjust SPI implementations
         >> change NodeTypeRegistry to load definitions upon demand.



git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@555209 13f79535-47bb-0310-9956-ffa450edef68

-public final class TransientISFactory extends AbstractItemStateFactory implements TransientItemStateFactory  {
+public final class TransientISFactory extends AbstractItemStateFactory implements TransientItemStateFactory, ItemStateCreationListener  {
-    public TransientISFactory(ItemStateFactory workspaceStateFactory, ItemDefinitionProvider defProvider) {
+    public TransientISFactory(AbstractItemStateFactory workspaceStateFactory, ItemDefinitionProvider defProvider) {
+        // start listening to 'creations' on the workspaceStateFactory (and
+        // consequently skip an extra notification if the has been built by the
+        // workspaceStateFactory.
+        workspaceStateFactory.addCreationListener(this);
-        notifyCreated(state);
-
-        notifyCreated(state);
-
-        notifyCreated(state);
-
-
-        notifyCreated(state);
-
-        notifyCreated(state);
-
+
+    //------------------------------------------< ItemStateCreationListener >---
+    /**
+     * @see ItemStateCreationListener#created(ItemState)
+     */
+    public void created(ItemState state) {
+        log.debug("ItemState created by WorkspaceItemStateFactory");
+        notifyCreated(state);
+    }
+
+    /**
+     * @see ItemStateCreationListener#statusChanged(ItemState, int)
+     */
+    public void statusChanged(ItemState state, int previousStatus) {
+        // ignore
+    }

INS43 INS31 INS31 INS42 INS29 INS83 INS39 INS42 INS44 INS8 INS29 INS83 INS39 INS42 INS44 INS44 INS8 UPD43 INS21 INS65 INS43 INS42 INS21 MOV21 INS65 INS43 INS42 INS39 INS42 UPD42 INS32 INS68 INS42 INS32 INS68 INS42 INS42 INS42 INS52 INS42 INS42 INS69 INS42 INS42 INS45 INS42 INS42 INS69 INS69 INS43 INS43 INS39 INS42 INS42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL32 DEL21