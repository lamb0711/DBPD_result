JCR-337 - Remove jcr dependency from dav-library
JCR-343 - Report#init limits the Report interface to DeltaV compliant resources
JCR-340 - ValuesProperty missing property type information
JCR-342 - DavResource#getDavSession() missing
JCR-344 - DeltaVResource lists MKWORKSPACE in the method constant.
JCR-345 - DavException does not allow to specify an exception cause

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@385540 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.xml.DomUtil;
+    private Element errorCondition;
+     * @see DavException#DavException(int, String, Throwable, Element)
-        super(message);
-        this.errorCode = errorCode;
-        log.debug("DavException: (" + errorCode + ") " + message);
+        this(errorCode, message, null, null);
+     * @param cause Cause of this DavException
+     * @see DavException#DavException(int, String, Throwable, Element)
+     */
+    public DavException(int errorCode, Throwable cause) {
+        this(errorCode, null, cause, null);
+    }
+
+    /**
+     * Create a new <code>DavException</code>.
+     *
+     * @param errorCode integer specifying any of the status codes defined by
+     * {@link DavServletResponse}.
+     * @see DavException#DavException(int, String, Throwable, Element)
-        this(errorCode, statusPhrases.getProperty(String.valueOf(errorCode)));
+        this(errorCode, statusPhrases.getProperty(String.valueOf(errorCode)), null, null);
+    }
+
+    /**
+     * Create a new <code>DavException</code>.
+     *
+     * @param errorCode integer specifying any of the status codes defined by
+     * {@link DavServletResponse}.
+     * @param message Human readable error message.
+     * @param cause Cause of this <code>DavException</code>.
+     * @param errorCondition Xml element providing detailled information about
+     * the error. If the condition is not <code>null</code>, {@link #toXml(Document)}
+     */
+    public DavException(int errorCode, String message, Throwable cause, Element errorCondition) {
+        super(message, cause);
+        this.errorCode = errorCode;
+        this.errorCondition = errorCondition;
+        log.debug("DavException: (" + errorCode + ") " + message);
-     * @return Always false
+     * @return true if a error condition has been specified, false otherwise.
-        return false;
+        return errorCondition != null;
-     * Returns <code>null</code>
+     * Returns a DAV:error element containing the error condition or
+     * <code>null</code> if no specific condition is available. See
+     * <a href="http://www.ietf.org/rfc/rfc3253.txt">RFC 3253</a>
+     * Section 1.6 "Method Preconditions and Postconditions" for additional
+     * information.
-     * @return <code>null</code>
+     * @return A DAV:error element indicating the error cause or <code>null</code>.
-        return null;
+        if (hasErrorCondition()) {
+            Element error = DomUtil.createElement(document, XML_ERROR, DavConstants.NAMESPACE);
+            error.appendChild(document.importNode(errorCondition, true));
+            return error;
+        } else {
+            return null;
+        }
-

INS26 MOV31 INS40 INS23 INS31 INS31 INS83 INS43 INS59 MOV29 INS44 INS44 INS8 MOV29 INS83 INS42 INS44 INS44 INS8 INS29 INS83 INS42 MOV44 MOV8 INS29 INS44 INS44 INS8 INS42 INS42 INS65 INS39 INS42 INS43 INS42 INS17 INS65 INS65 INS39 INS42 INS43 INS42 INS17 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS21 INS25 INS68 INS42 INS42 INS42 INS33 INS33 INS42 INS66 INS68 INS42 INS42 INS33 INS42 INS33 INS66 INS42 INS66 INS65 INS66 INS68 INS33 INS33 INS66 INS42 INS66 INS65 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS66 INS65 INS42 INS42 INS42 INS7 UPD66 INS27 INS66 UPD66 INS66 INS66 INS66 UPD66 INS32 INS8 MOV8 INS42 INS42 INS69 INS69 INS69 INS69 INS42 INS42 INS69 INS69 INS69 INS69 INS42 INS42 INS42 INS69 INS69 INS69 INS69 INS42 INS68 INS22 INS42 INS42 INS33 INS42 INS60 INS21 INS41 INS39 INS43 INS43 INS43 INS39 INS43 INS43 INS43 INS39 INS43 INS43 INS43 INS42 INS69 INS52 INS42 INS43 INS59 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS40 INS42 INS42 INS42 INS9 DEL9