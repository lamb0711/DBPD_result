JCR-2076: JSR 283: QOM and SQL2
- QueryObjectModelBuilder for SQL2 parser
- support for SQL2 in jackrabbit-core

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@785594 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.spi.Path;
-    protected final List buffer = new LinkedList();
+    protected final List<ScoreNode[]> buffer = new LinkedList<ScoreNode[]>();
-                        if (node.getSelector2QPath() != null) {
+                        Path selector2Path = node.getSelector2QPath();
+                        if (selector2Path == null || (selector2Path.getLength() == 1 && selector2Path.getNameElement().denotesCurrent())) {
+                            c = new SameNodeJoin(src2, node.getSelector2QName(), reader);
+                        } else {
-                        } else {
-                            c = new SameNodeJoin(src2, node.getSelector2QName(), reader);
-                        if (node.getSelector2QPath() != null) {
+                        Path selector2Path = node.getSelector2QPath();
+                        if (selector2Path == null || (selector2Path.getLength() == 1 && selector2Path.getNameElement().denotesCurrent())) {
+                            c = new SameNodeJoin(src1, node.getSelector1QName(), reader);
+                        } else {
-                        } else {
-                            c = new SameNodeJoin(src1, node.getSelector1QName(), reader);
-            return (ScoreNode[]) buffer.remove(0);
+            return buffer.remove(0);
-                for (int i = 0; i < nodes.length; i++) {
-                    ScoreNode[] node = nodes[i];
+                for (ScoreNode[] node : nodes) {
-        return (ScoreNode[]) buffer.remove(0);
+        return buffer.remove(0);

INS26 INS40 INS74 MOV8 MOV43 MOV5 MOV25 INS19 INS41 INS74 MOV8 MOV32 MOV32 MOV43 MOV5 MOV60 MOV25 MOV60 INS25 UPD42 MOV42 UPD42 MOV42 MOV34 MOV32 MOV27 MOV8 MOV25 INS70 INS44 INS42 INS8 MOV5 INS42 MOV60 MOV21 MOV21 MOV21 INS42 INS42 INS42 INS42 INS34 INS60 MOV8 INS60 MOV8 INS43 INS59 INS27 INS43 INS59 INS27 INS42 INS42 MOV32 INS27 INS36 INS42 INS42 MOV32 INS27 INS36 INS42 MOV33 INS27 INS42 MOV33 INS27 INS27 INS32 INS27 INS32 INS32 INS34 INS32 INS42 INS32 INS34 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL27 DEL27 DEL11 DEL42 DEL42 DEL42 DEL2 DEL59 DEL60 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL40 DEL27 DEL42 DEL37 DEL24 DEL25 DEL19 DEL11 DEL41 DEL8