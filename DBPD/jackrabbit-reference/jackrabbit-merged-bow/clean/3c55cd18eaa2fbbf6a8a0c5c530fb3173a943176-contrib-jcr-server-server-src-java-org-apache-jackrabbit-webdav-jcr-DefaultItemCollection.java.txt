[JCR-175] Contrib JCR-Server: enable PROPPATCH for simple-davresource
[JCR-174] Contrib JCR-Server: improve handing of strong etags

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@230679 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.jcr.version.report.ExportViewReport;
+import org.apache.jackrabbit.webdav.jcr.version.report.LocateCorrespondingNodeReport;
+        internalSetProperty(property);
+        complete();
+    }
+
+    /**
+     * Internal method used to set or add the given property
+     *
+     * @param property
+     * @throws DavException
+     * @see #setProperty(DavProperty)
+     * @see #alterProperties(DavPropertySet, DavPropertyNameSet)
+     */
+    private void internalSetProperty(DavProperty property) throws DavException {
-                complete();
-
+        internalRemoveProperty(propertyName);
+        complete();
+    }
+
+    /**
+     * Internal method used to remove the property with the given name.
+     *
+     * @param propertyName
+     * @throws DavException
+     * @see #removeProperty(DavPropertyName)
+     * @see #alterProperties(DavPropertySet, DavPropertyNameSet)
+     */
+    private void internalRemoveProperty(DavPropertyName propertyName) throws DavException {
-                complete();
-
+     *
+     * @param setProperties
+     * @param removePropertyNames
+     * @throws DavException
+     * @todo undo incomplete modifications...
+     */
+    public void alterProperties(DavPropertySet setProperties,
+                                DavPropertyNameSet removePropertyNames)
+        throws DavException {
+        DavPropertyIterator setIter = setProperties.iterator();
+        while (setIter.hasNext()) {
+            DavProperty prop = setIter.nextProperty();
+            internalSetProperty(prop);
+        }
+        Iterator remNameIter = removePropertyNames.iterator();
+        while (remNameIter.hasNext()) {
+            DavPropertyName propName = (DavPropertyName) remNameIter.next();
+            internalRemoveProperty(propName);
+        }
+        // save all changes together
+        complete();
+    }
+
+    /**
+     * Defines the additional reports supported by this resource (reports
+     * specific for resources representing a repository {@link Node node}):
+     * <ul>
+     * <li>{@link ExportViewReport export view report}</li>
+     * <li>{@link LocateCorrespondingNodeReport locate corresponding node report}</li>
+     * </ul>
+     * 
+     * @see org.apache.jackrabbit.webdav.version.report.SupportedReportSetProperty
+     */
+    protected void initSupportedReports() {
+        super.initSupportedReports();
+        if (exists()) {
+            supportedReports.addReportType(ExportViewReport.EXPORTVIEW_REPORT);
+            supportedReports.addReportType(LocateCorrespondingNodeReport.LOCATE_CORRESPONDING_NODE_REPORT);
+        }
+    }
+
+    /**
-                pHref[i] = this.getLocatorFromResourcePath(values[i].getPath()).getHref(true);
+                pHref[i] = getLocatorFromResourcePath(values[i].getPath()).getHref(true);

INS26 INS26 INS40 INS40 INS31 INS31 INS31 INS31 MOV29 INS83 INS39 INS42 INS44 INS43 INS8 INS29 UPD83 UPD42 MOV29 INS83 INS39 INS42 INS44 INS43 INS8 INS29 UPD83 UPD42 INS29 INS83 INS39 INS42 INS44 INS44 INS43 INS8 INS29 INS83 INS39 INS42 INS8 INS43 INS42 INS42 INS21 INS21 INS65 INS65 INS65 INS65 INS65 INS43 INS42 INS42 INS21 MOV21 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS42 INS60 INS61 INS60 INS61 MOV21 INS65 INS65 INS21 INS25 INS42 INS32 INS32 INS66 INS42 INS42 INS68 INS68 INS42 INS32 INS66 INS42 INS42 INS68 INS68 INS42 INS42 INS42 INS66 INS42 INS42 INS43 INS59 INS32 INS8 INS43 INS59 INS32 INS8 INS66 INS66 INS65 INS66 INS66 INS66 INS65 INS66 INS66 INS65 INS66 INS66 INS40 INS48 INS32 INS8 INS42 INS42 INS42 INS42 INS69 INS42 INS69 INS69 INS42 INS42 INS42 INS69 INS42 INS69 INS69 INS42 INS42 INS32 INS42 INS42 INS60 INS21 INS42 INS42 INS32 INS42 INS42 INS60 INS21 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS21 INS21 INS43 INS43 INS43 INS43 INS43 INS43 INS42 INS42 INS43 INS59 INS32 INS42 INS42 INS43 INS59 INS32 INS32 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS11 INS42 INS42 INS42 INS42 INS40 INS42 INS42 INS40 INS42 INS42 INS43 INS32 INS42 INS42 INS42 DEL52