JCR-2229: Improve behaviour when 'too many open files' occurs

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@799595 13f79535-47bb-0310-9956-ffa450edef68

-        String[] names = new String[dirs.length];
-        for (int i = 0; i < dirs.length; i++) {
-            names[i] = dirs[i].getName();
+        if (dirs != null) {
+            String[] names = new String[dirs.length];
+            for (int i = 0; i < dirs.length; i++) {
+                names[i] = dirs[i].getName();
+            }
+            return names;
+        } else {
+            throw new IOException("listFiles for " + baseDir.getPath() + " returned null");
-        return names;
-        for (File file : directory.listFiles()) {
-            if (!file.delete()) {
-                return false;
+        File[] files = directory.listFiles();
+        if (files != null) {
+            for (File file : files) {
+                if (!file.delete()) {
+                    return false;
+                }
+        } else {
+            return false;

INS25 INS60 INS25 INS27 INS8 INS8 INS5 INS59 INS27 INS8 INS8 INS42 INS33 MOV60 MOV24 MOV41 INS53 INS43 INS85 INS42 MOV32 INS42 INS33 MOV70 INS41 INS14 INS42 INS42 INS9 INS43 INS27 INS42 INS45 INS32 INS45 INS42 INS42