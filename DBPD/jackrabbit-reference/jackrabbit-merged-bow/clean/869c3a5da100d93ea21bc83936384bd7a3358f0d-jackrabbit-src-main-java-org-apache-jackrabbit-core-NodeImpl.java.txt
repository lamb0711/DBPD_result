JCR-423 Node.restore() fails for existing non-versioned OPV=Version child nodes

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@398968 13f79535-47bb-0310-9956-ffa450edef68

-                if (n.getDefinition().getOnParentVersion() == OnParentVersionAction.COPY
-                        || n.getDefinition().getOnParentVersion() == OnParentVersionAction.VERSION) {
-                    // only remove OPV=Copy or OPV=Version nodes
+                if (n.getDefinition().getOnParentVersion() == OnParentVersionAction.COPY) {
+                    // only remove OPV=Copy nodes
-                    if (n.getParent().isSame(this)) {
-                        // so order at end
-                        // orderBefore(n.getName(), "");
-                    } else if (removeExisting) {
+                    if (removeExisting) {
+                    } else if (n.getParent().isSame(this)) {
+                        n.internalRemove(true);
-                } else {
+                }
+                if (!itemMgr.itemExists(nodeId)) {

MOV8 MOV25 MOV25 MOV60 MOV21 MOV60 MOV60 MOV24 MOV60 MOV61 MOV60 MOV24 MOV60 MOV61 MOV60 INS24 MOV58 MOV27 MOV37 MOV8 MOV60 INS25 MOV62 MOV8 MOV25 MOV62 MOV27 MOV60 MOV60 MOV60 INS25 MOV32 INS38 MOV8 MOV60 MOV25 INS32 INS25 INS42 INS42 INS42 MOV32 INS8 MOV8 INS21 INS32 INS42 INS42 INS9 DEL42 DEL42 DEL32 DEL42 DEL32 DEL40 DEL27 DEL27 DEL25 DEL25 DEL24 DEL8