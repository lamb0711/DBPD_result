Work in progress
- Removed is-local flag from event bundle response and added transaction id which is equal to the lock token that was used to save changes.
- Added TransactionListener. SubscriptionManagerImpl now listens on the TxLockManagerImpl for transaction commits and registers special EventListeners for a short period of time to associate the lockToken / transactionId with an event bundle.
- Remove SubscriptionImpl as event listener when subscription expires
- Update currentVersion to 1.2-SNAPSHOT

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@482627 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.commons.collections.set.MapBackedSet;
+import java.util.Set;
+import java.util.IdentityHashMap;
+    private Set listeners = MapBackedSet.decorate(new IdentityHashMap());
+
-                tx.commit(resource);
+                TransactionListener[] txListeners;
+                synchronized (listeners) {
+                    txListeners = (TransactionListener[]) listeners.toArray(new TransactionListener[0]);
+                }
+                for (int i = 0; i < txListeners.length; i++) {
+                    txListeners[i].beforeCommit(resource, lockToken);
+                }
+                DavException ex = null;
+                try {
+                    tx.commit(resource);
+                } catch (DavException e) {
+                    ex = e;
+                }
+                for (int i = 0; i < txListeners.length; i++) {
+                    txListeners[i].afterCommit(resource, lockToken, ex == null);
+                }
+                if (ex != null) {
+                    throw ex;
+                }
+    //-----------------------------< listener support >-------------------------
+
+    /**
+     * Adds a transaction listener to this <code>TxLockManager</code>.
+     * @param listener the listener to add.
+     */
+    public void addTransactionListener(TransactionListener listener) {
+        synchronized (listeners) {
+            listeners.add(listener);
+        }
+    }
+
+    /**
+     * Removes a transaction listener from this <code>TxLockManager</code>.
+     * @param listener the listener to remove.
+     */
+    public void removeTransactionListener(TransactionListener listener) {
+        synchronized (listeners) {
+            listeners.remove(listener);
+        }
+    }
+

INS26 INS26 INS26 INS40 INS40 INS40 INS23 INS31 INS31 INS83 INS43 INS59 INS29 INS83 INS39 INS42 INS44 INS8 INS29 INS83 INS39 INS42 INS44 INS8 INS42 INS42 INS32 INS65 INS65 INS43 INS42 INS51 INS65 INS65 INS43 INS42 INS51 INS42 INS42 INS14 INS66 INS42 INS66 INS42 INS42 INS8 INS66 INS42 INS66 INS42 INS42 INS8 INS43 INS8 INS21 INS21 INS42 INS25 MOV21 INS32 INS32 MOV32 MOV8 MOV8 INS42 INS42 INS42 INS42 INS42 INS42 INS60 INS51 INS24 INS60 INS54 INS24 INS5 INS59 INS42 INS8 INS58 INS27 INS37 INS8 INS43 INS59 MOV8 INS12 INS58 INS27 INS37 INS8 INS27 INS8 INS43 INS85 INS42 INS21 INS39 INS59 INS42 INS40 INS42 INS21 INS42 INS42 INS33 INS44 INS8 INS39 INS59 INS42 INS40 INS42 INS21 INS42 INS33 INS53 INS42 INS7 INS42 INS34 INS32 INS43 INS42 INS21 INS42 INS34 INS32 INS42 INS42 INS11 INS2 INS42 INS42 INS42 INS42 INS7 INS2 INS42 INS42 INS42 INS27 INS5 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS33 INS43 INS85 INS42 INS42 INS3 INS42 INS5 INS34 INS43 INS85 INS42