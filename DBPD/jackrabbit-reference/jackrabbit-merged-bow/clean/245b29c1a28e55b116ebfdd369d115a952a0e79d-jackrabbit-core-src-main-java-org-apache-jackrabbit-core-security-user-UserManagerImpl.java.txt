JCR-2313 - Improvements to user management (2) [work in progress] 

- improve log output during user import
- fix issue with replacing/removing existing user upon import
- add test for the issue

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@831055 13f79535-47bb-0310-9956-ffa450edef68

-        if (getAuthorizable(principal) != null) {
+        /*
+         Check if there is *another* authorizable with the same principal.
+         The additial validation (nodes not be same) is required in order to
+         circumvent problems with re-importing existing authorizables in which
+         case the original user/group node is being recreated but the search
+         used to look for an colliding authorizable still finds the persisted
+         node.
+        */
+        Authorizable existing = getAuthorizable(principal);
+        if (existing != null && !((AuthorizableImpl) existing).getNode().isSame(node)) {

INS60 INS43 INS59 INS27 INS42 INS42 MOV32 INS27 INS38 INS42 MOV33 INS32 INS32 INS42 INS42 INS36 INS42 INS11 INS43 INS42 INS42 DEL27