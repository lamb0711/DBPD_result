JCR-3263 load in structural node information immediately for better performance and add option to load the complete node graph first before checking for consistency. performance is boosted dozens of times on large repositories when enabling this option but requires more memory

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1351240 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Map;
+import org.apache.jackrabbit.core.persistence.util.NodeInfo;
- * The iterable persistence manager can return the list of node ids that are stored.
+ * The iterable persistence manager can return the list of {@link NodeId}s and
+ * {@link NodeInfo}s that are stored.
- * and data store garbage collection.
+ * data store garbage collection, and consistency checking.
-     * is the last row read. The maxCount parameter defines the maximum number of
+     * is the last row read previously. The maxCount parameter defines the maximum number of
-     * @return a list of all bundles.
+     * @return a list of all node ids.
-     * @throws RepositoryException if a repository exception occurs
+     * @throws RepositoryException if a repository exception occurs.
+
+    /**
+     * Get all {@link NodeInfo}s.
+     * A typical application will call this method multiple time, where 'after'
+     * is the last row read previously. The maxCount parameter defines the maximum number of
+     * node ids returned, 0 meaning no limit. The order of the node ids is specific for the
+     * given persistence manager. Items that are added concurrently may not be included.
+     *
+     * @param after the lower limit, or null for no limit.
+     * @param maxCount the maximum number of node infos to return, or 0 for no limit.
+     * @return a list of all node infos.
+     * @throws ItemStateException if an error while loading occurs.
+     * @throws RepositoryException if a repository exception occurs.
+     */
+    Map<NodeId, NodeInfo> getAllNodeInfos(NodeId after, int maxCount)
+            throws ItemStateException, RepositoryException;
+

INS26 INS26 INS40 INS40 INS31 INS29 INS74 INS42 INS44 INS44 INS43 INS43 UPD66 INS65 INS66 INS65 INS66 UPD66 INS65 INS65 INS65 INS65 INS65 INS65 INS43 INS43 INS43 INS43 INS42 INS39 INS42 INS42 INS42 INS42 INS42 UPD66 UPD66 UPD66 INS66 INS65 INS66 INS66 INS66 INS66 INS66 INS42 INS66 INS42 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS42 INS42 INS42