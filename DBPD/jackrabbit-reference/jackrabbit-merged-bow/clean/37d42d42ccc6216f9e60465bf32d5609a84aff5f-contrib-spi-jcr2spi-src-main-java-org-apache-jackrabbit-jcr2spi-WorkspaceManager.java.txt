- Use new NodeState constructor

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@428726 13f79535-47bb-0310-9956-ffa450edef68

-        this.service = service;
-        this.sessionInfo = sessionInfo;
+        try {
+            this.service = service;
+            this.sessionInfo = sessionInfo;
-        cache = new CachingItemStateManager(this, service.getIdFactory());
-        addEventListener(cache);
+            cache = new CachingItemStateManager(this, service.getIdFactory());
+            addEventListener(cache);
-        nsRegistry = createNamespaceRegistry();
-        ntRegistry = createNodeTypeRegistry(nsRegistry);
-        rootNodeId = createRootNodeId();
-        externalChangeListener = createChangeListener();
+            nsRegistry = createNamespaceRegistry();
+            ntRegistry = createNodeTypeRegistry(nsRegistry);
+            rootNodeId = createRootNodeId();
+            externalChangeListener = createChangeListener();
+        } catch (ItemStateException e) {
+            throw new RepositoryException(e);
+        }
-            // TODO pass parent in constructor of NodeState
-
-            NodeState state = new NodeState(info.getId(), ntName, parent.getNodeId(), ItemState.STATUS_EXISTING, false, getIdFactory());
+            NodeState state = new NodeState(info.getId(), parent, ntName, ItemState.STATUS_EXISTING, false, this);

INS8 INS54 MOV8 INS12 INS44 INS8 INS43 INS42 INS53 INS42 INS14 INS43 INS42 INS42 INS42 INS52 INS42 DEL42 DEL42 DEL42 DEL32 DEL42 DEL32