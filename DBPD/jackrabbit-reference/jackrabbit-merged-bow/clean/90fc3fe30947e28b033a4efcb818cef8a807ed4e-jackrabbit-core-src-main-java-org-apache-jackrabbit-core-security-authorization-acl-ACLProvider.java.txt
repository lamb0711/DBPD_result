JCR-2386 - wrong eval order of access control entries within a single node

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@833210 13f79535-47bb-0310-9956-ffa450edef68

+            // first collect aces present on the given aclNode.
+            List<AccessControlEntry> gaces = new ArrayList<AccessControlEntry>();
+            List<AccessControlEntry> uaces = new ArrayList<AccessControlEntry>();
+
+                    /**
+                     * NOTE: access control entries must be collected in reverse
+                     * order in order to assert proper evaluation.
+                     */
-                        groupAces.add(ace);
+                        gaces.add(0, ace);
-                        userAces.add(ace);
+                        uaces.add(0, ace);
+
+            // add the lists of aces to the overall lists that contain the entries
+            // throughout the hierarchy.
+            if (!gaces.isEmpty()) {
+                groupAces.addAll(gaces);
+            }
+            if (!uaces.isEmpty()) {
+                userAces.addAll(uaces);
+            }

INS60 INS60 INS25 INS25 INS74 INS59 INS74 INS59 INS38 INS8 INS38 INS8 INS43 INS43 INS42 INS14 INS43 INS43 INS42 INS14 INS32 INS21 INS32 INS21 INS42 INS42 INS74 INS42 INS42 INS74 INS42 INS42 INS32 INS42 INS42 INS32 INS43 INS43 INS43 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 UPD42 INS34 UPD42 INS34