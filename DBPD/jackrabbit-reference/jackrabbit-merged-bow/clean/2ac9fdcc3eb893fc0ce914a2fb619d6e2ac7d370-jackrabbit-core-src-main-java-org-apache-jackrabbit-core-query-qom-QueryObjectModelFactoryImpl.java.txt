JCR-1378: Remove SessionImpl dependency from QueryObjectModelFactoryImpl

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@627328 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.query.QueryImpl;
-import org.apache.jackrabbit.core.SessionImpl;
-import org.apache.jackrabbit.core.SearchManager;
-public class QueryObjectModelFactoryImpl implements QueryObjectModelFactory {
+public abstract class QueryObjectModelFactoryImpl implements QueryObjectModelFactory {
-    /**
-     * The session of the user.
-     */
-    private final SessionImpl session;
-
-    /**
-     * The search manager of the workspace.
-     */
-    private final SearchManager searchMgr;
-
-    public QueryObjectModelFactoryImpl(SessionImpl session,
-                                       SearchManager searchMgr) {
-        this.resolver = session;
-        this.session = session;
-        this.searchMgr = searchMgr;
+    public QueryObjectModelFactoryImpl(NamePathResolver resolver) {
+        this.resolver = resolver;
+     * Creates a query object model from the internal tree representation.
+     *
+     * @param qomTree the qom tree.
+     * @return a query object model that can be executed.
+     * @throws InvalidQueryException the the query object model tree is
+     *                               considered invalid by the query handler
+     *                               implementation.
+     * @throws RepositoryException   if any other error occurs.
+     */
+    protected abstract QueryObjectModel createQuery(QueryObjectModelTree qomTree)
+            throws InvalidQueryException, RepositoryException;
+
+    /**
-        return searchMgr.createQueryObjectModel(session, qomTree, QueryImpl.JCR_SQL2);
+        return createQuery(qomTree);

INS83 INS31 INS31 INS83 INS42 INS44 MOV8 INS29 INS83 INS83 INS43 UPD42 MOV42 MOV44 INS43 INS43 INS43 INS42 INS65 UPD65 MOV65 INS65 INS65 INS65 UPD42 MOV42 UPD43 UPD42 UPD42 MOV42 INS42 UPD42 MOV42 INS66 INS42 UPD66 INS66 INS42 INS66 INS66 INS66 INS42 INS66 UPD42 UPD42 UPD42 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL66 DEL65 DEL29 DEL83 DEL83 DEL43 DEL42 DEL59 DEL23 DEL29 DEL83 DEL83 DEL43 DEL42 DEL59 DEL23 DEL83 DEL43 DEL42 DEL44 DEL31 DEL42 DEL42 DEL40