test for ambiguous residual child node definition is too restrictive

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@225151 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Arrays;
-                        // conflict
-                        String msg = "A child node definition in node type '"
-                                + def.getDeclaringNodeType()
-                                + "' conflicts with node type '"
-                                + existing.getDeclaringNodeType()
-                                + "': ambiguous residual child node definition";
-                        log.debug(msg);
-                        throw new NodeTypeConflictException(msg);
+                        NodeDef nd = (NodeDef) def;
+                        NodeDef end = (NodeDef) existing;
+                        // compare required & default primary types
+                        if (Arrays.equals(nd.getRequiredPrimaryTypes(), end.getRequiredPrimaryTypes())
+                                && (nd.getDefaultPrimaryType() == null
+                                ? end.getDefaultPrimaryType() == null
+                                : nd.getDefaultPrimaryType().equals(end.getDefaultPrimaryType()))) {
+                            // conflict
+                            String msg = "A child node definition in node type '"
+                                    + def.getDeclaringNodeType()
+                                    + "' conflicts with node type '"
+                                    + existing.getDeclaringNodeType()
+                                    + "': ambiguous residual child node definition";
+                            log.debug(msg);
+                            throw new NodeTypeConflictException(msg);
+                        }

INS26 INS40 INS8 INS60 INS60 INS25 INS43 INS59 INS43 INS59 INS27 MOV8 INS42 INS42 INS11 INS42 INS42 INS11 INS32 INS36 INS43 INS42 INS43 INS42 INS42 INS42 INS32 INS32 INS16 INS42 INS42 INS42 INS42 INS42 INS42 INS27 INS27 INS32 INS32 INS33 INS32 INS33 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42