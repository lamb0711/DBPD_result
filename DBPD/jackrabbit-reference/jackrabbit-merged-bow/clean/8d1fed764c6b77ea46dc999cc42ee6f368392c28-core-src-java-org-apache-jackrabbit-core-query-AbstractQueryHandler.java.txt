JCR-178: Allow concurrent index updates and queries

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@232801 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.state.NodeState;
+
+import javax.jcr.RepositoryException;
+import java.util.Iterator;
+
+    /**
+     * This default implementation calls the individual {@link #deleteNode(String)}
+     * and {@link #addNode(org.apache.jackrabbit.core.state.NodeState)} methods
+     * for each entry in the iterators. First the nodes to remove are processed
+     * then the nodes to add.
+     *
+     * @param remove uuids of nodes to remove.
+     * @param add NodeStates to add.
+     * @throws RepositoryException if an error occurs while indexing a node.
+     * @throws IOException if an error occurs while updating the index.
+     */
+    public synchronized void updateNodes(Iterator remove, Iterator add)
+            throws RepositoryException, IOException {
+        while (remove.hasNext()) {
+            deleteNode((String) remove.next());
+        }
+        while (add.hasNext()) {
+            addNode((NodeState) add.next());
+        }
+    }

INS26 INS26 INS26 INS40 INS40 INS40 INS31 INS29 INS83 INS83 INS39 INS42 INS44 INS44 INS43 INS43 INS8 INS65 INS65 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS42 INS42 INS61 INS61 INS66 INS65 INS66 INS65 INS66 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS32 INS8 INS32 INS8 INS68 INS68 INS42 INS42 INS21 INS42 INS42 INS21 INS42 INS69 INS42 INS69 INS32 INS32 INS43 INS43 INS42 INS11 INS42 INS11 INS42 INS40 INS43 INS32 INS43 INS32 INS42 INS42 INS42 INS42 INS42 INS42