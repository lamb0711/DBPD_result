Explode merge code to be more verbose and aligned with description in spec.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@801210 13f79535-47bb-0310-9956-ffa450edef68

-        // test versions
+        // test versions. the following code could be simplified but is
+        // intentionally expanded for follow the spec.
+        if (!isCheckedOut(state)) {
+            // If N is currently checked-in then:
+            if (vp.isMoreRecent(v)) {
+                // - If V' is an eventual successor of V, then the merge result for N is update.
+                return srcNode;
+            } else if (v.equals(vp) || v.isMoreRecent(vp)) {
+                // - If V' is an eventual predecessor of V or if V and V' are identical (i.e., are
+                // actually the same version), then the merge result for N is leave.
+                return null;
+            } else {
+                // - If V is neither an eventual successor of, eventual predecessor of, nor
+                // identical with V', then the merge result for N is failed. This is the case
+                // where N and N' represent divergent branches of the version graph.
+
+                // failed is covered below
+            }
+        } else {
+            // If N is currently checked-out then:
+            if (v.equals(vp) || v.isMoreRecent(vp)) {
+                // - If V' is an eventual predecessor of V or if V and V' are identical (i.e., are
+                //   actually the same version), then the merge result for
+                //   N is leave.
+                return null;
+            } else {
+                // - If any other relationship holds between V and V', then the merge result
+                //   for N is fail.
+
+                // failed is covered below
+            }
+        }
+
+

INS25 INS38 INS8 INS8 INS32 INS25 INS25 INS42 INS42 INS32 INS8 INS25 INS27 INS8 INS8 INS42 INS42 INS42 INS41 INS27 INS8 INS8 INS32 INS32 INS41 INS42 INS32 INS32 INS41 INS42 INS42 INS42 INS42 INS42 INS42 INS33 INS42 INS42 INS42 INS42 INS42 INS42 INS33