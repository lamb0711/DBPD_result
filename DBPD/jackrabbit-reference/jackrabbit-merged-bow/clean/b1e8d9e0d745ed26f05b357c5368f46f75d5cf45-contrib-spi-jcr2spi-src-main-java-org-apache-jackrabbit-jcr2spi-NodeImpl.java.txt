work in progress

- replace ItemImpl by Item in ItemManager interface and adjust
  usages.
- change all setters on ItemState and derived classes from public to
  package private
- NodeState: use collection return value instead of set/list whereever possible
- WorkspaceManager: put ItemStateFactory to a separate class and
  remove unused inner class NodeReferenceImpl 
- add methods to NodeState/PropertyState that avoids return a null
  QItemDefinition and remove corresponding methods from NodeTypeManagerImpl
- remove ItemDefinitionManager.
- VersionHistoryImpl: add safety check if cne for root version really exists
- Fix ImporterImpl: ItemState.getDefinition() may return 'null' value.
  use method instead, that sets the definition if it is still missing.
- javadoc and code formatting


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@430031 13f79535-47bb-0310-9956-ffa450edef68

+            } else if (!(parent instanceof NodeImpl)) {
+                String msg = "Incompatible Node object: " + parent + "(" + safeGetJCRPath() + ")";
+                log.debug(msg);
+                throw new RepositoryException(msg);
+            } else {
+                parentNode = (NodeImpl) parent;
-            parentNode = (NodeImpl) parent;
-            String msg = "Unable to retrieve REFERENCE properties that refer to " + getId();
+            String msg = "Unable to retrieve REFERENCE properties that refer to " + getPath();
-            while (referenceableNode.getDepth() != Path.ROOT_DEPTH && !referenceableNode.isNodeType(QName.MIX_REFERENCEABLE)) {
+            while (referenceableNode.getDepth() != Path.ROOT_DEPTH
+                && !referenceableNode.isNodeType(QName.MIX_REFERENCEABLE)) {
-                        nId = session.getIdFactory().createNodeId(((NodeImpl)parent).getNodeId(), relQPath);
+                        NodeId parentId = ((NodeImpl)parent).getNodeId();
+                        nId = session.getIdFactory().createNodeId(parentId, relQPath);

INS25 INS38 INS8 INS8 INS36 INS60 INS21 INS53 MOV21 INS62 INS43 INS59 INS32 INS14 INS42 INS43 INS42 INS42 INS27 INS42 INS42 INS42 INS43 INS42 UPD42 INS42 INS45 INS42 INS45 INS32 INS45 INS42 INS60 INS42 INS43 INS59 INS42 INS42 MOV32 INS42