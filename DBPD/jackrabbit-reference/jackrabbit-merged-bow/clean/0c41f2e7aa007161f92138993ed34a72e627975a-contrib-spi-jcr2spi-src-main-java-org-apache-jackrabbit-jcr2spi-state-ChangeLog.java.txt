ChangeLog.removeAffected() removes too many operations
- must also check name of item state

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@508454 13f79535-47bb-0310-9956-ffa450edef68

+     * TODO: remove parameter CacheBehaviour
-                                    if (op instanceof AddNode && ((AddNode)op).getParentState() == parent) {
-                                        it.remove();
-                                        break;
-                                    } else if (op instanceof AddProperty && ((AddProperty)op).getParentState() == parent) {
-                                        it.remove();
-                                        break;
+                                    if (op instanceof AddNode) {
+                                        AddNode operation = (AddNode) op;
+                                        if (operation.getParentState() == parent
+                                                && operation.getNodeName().equals(state.getQName())) {
+                                            // TODO: this will not work for name name siblings!
+                                            it.remove();
+                                            break;
+                                        }
+                                    } else if (op instanceof AddProperty) {
+                                        AddProperty operation = (AddProperty) op;
+                                        if (operation.getParentState() == parent
+                                                && operation.getPropertyName().equals(state.getQName())) {
+                                            it.remove();
+                                            break;
+                                        }

INS66 MOV62 INS8 INS60 INS25 MOV62 INS8 INS43 INS59 MOV27 MOV8 INS60 INS25 INS42 INS42 MOV11 INS32 INS43 INS59 MOV27 MOV8 INS32 INS42 INS32 INS42 INS42 MOV11 INS32 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS42 DEL36 DEL36