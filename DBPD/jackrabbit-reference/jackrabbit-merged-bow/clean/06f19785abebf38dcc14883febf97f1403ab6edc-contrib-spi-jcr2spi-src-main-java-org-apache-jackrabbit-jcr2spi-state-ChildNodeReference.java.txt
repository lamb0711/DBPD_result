- Create a factory method in ChildNodeReference, which creates a UUIDReference or a PathElementReference based on the availability of a UUID in the child NodeState.
- Introduce a propertiesInAttic in NodeState, which contains properties that are marked removed in the transient space and have been overlayed with a new property with the same name.
- Reviewed NodeState.moveChildNodeEntry()
- Removed unused NodeStateListener.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@432506 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.spi.IdFactory;
+     * Creates a new <code>ChildNodeEntry</code> for an already initialized
+     * child node state. The child node must already be attached to its parent.
+     *
+     * @param child     the child node state.
+     * @param isf       the item state factory to re-create node states.
+     * @param idFactory the <code>IdFactory</code> to create new ItemIds
+     */
+    public static ChildNodeEntry create(NodeState child, ItemStateFactory isf,
+                                        IdFactory idFactory) {
+        ChildNodeEntry cne;
+        if (child.getUUID() == null) {
+            cne = new PathElementReference(child, isf, idFactory);
+        } else {
+            cne = new UUIDReference(child, isf);
+        }
+        return cne;
+    }
+
+    /**
-    public ChildNodeReference(NodeState child, ItemStateFactory isf) {
-        super(child.getParent(), child, null, isf); // TODO: get name from child instead of null
+    protected ChildNodeReference(NodeState child, ItemStateFactory isf) {
+        super(child.getParent(), child, child.getName(), isf);

INS26 INS40 INS31 INS29 INS83 INS83 INS43 INS42 INS44 INS44 INS44 INS8 UPD83 INS65 INS65 INS65 INS65 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS60 INS25 INS41 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS42 INS43 INS59 INS27 INS8 INS8 INS42 INS32 INS42 INS42 INS32 INS33 INS21 INS21 INS42 INS42 INS42 INS42 INS7 INS7 INS42 INS14 INS42 INS14 INS43 INS42 INS42 INS42 INS43 INS42 INS42 INS42 INS42 DEL33