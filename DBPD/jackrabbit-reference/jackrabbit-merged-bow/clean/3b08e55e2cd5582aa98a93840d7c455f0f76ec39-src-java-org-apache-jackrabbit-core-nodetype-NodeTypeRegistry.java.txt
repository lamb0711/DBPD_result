allow re-registering node type definition if change is trivial

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@122642 13f79535-47bb-0310-9956-ffa450edef68

-        // store poperty & child node definitions of new node type by id
+        // store property & child node definitions of new node type by id
-        // remove all affected effective node types from aggregates cache
+        /**
+         * remove all affected effective node types from aggregates cache
+         * (collect keys first to prevent ConcurrentModificationException)
+         */
+        ArrayList keys = new ArrayList();
+        while (iter.hasNext()) {
+            keys.add(iter.next());
+        }
+        iter = keys.iterator();
-        // remove poperty & child node definitions
+        // remove property & child node definitions
-        if (registeredNTDefs.containsKey(name)) {
-            String msg = name + " already exists";
-            log.error(msg);
-            throw new InvalidNodeTypeDefException(msg);
-        }
-
+        if (!diff.isModified()) {
+            throw new RepositoryException(name.toString() + ": not modified");
+        }

INS60 INS61 INS21 INS25 INS43 INS59 INS32 INS8 INS7 INS38 INS8 INS42 INS42 INS14 INS42 INS42 INS21 INS42 INS32 INS32 INS53 INS43 INS32 INS42 INS42 INS42 INS42 INS14 INS42 INS42 INS42 INS32 INS43 INS27 INS42 INS42 INS42 INS32 INS45 INS42 INS42 DEL42 DEL42 DEL42 DEL32 DEL42 DEL43 DEL42 DEL42 DEL45 DEL27 DEL59 DEL60 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL43 DEL42 DEL14 DEL53 DEL8 DEL25