JCR-2104: JSR 283 Versioning

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@773930 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.commons.iterator.VersionIteratorAdapter;
+     * @see VersionHistory#getAllLinearVersions()
+     */
+    public VersionIterator getAllLinearVersions() throws RepositoryException {
+        checkStatus();
+
+        // TODO: improve and use lazy loading of versions as needed.
+        // TODO: change session.getNodeByUUID to Session.getNodeByIdentifier as soon as implemented
+
+        List versions = new ArrayList();
+        Version rootV = getRootVersion();
+        Node vn = session.getNodeByUUID(getVersionableUUID());
+        Version v = vn.getBaseVersion();
+        while (v != null && !rootV.isSame(v)) {
+            versions.add(0, v);
+            v = v.getLinearPredecessor();
+        }
+        versions.add(0, rootV);
+        
+        return new VersionIteratorAdapter(versions);
+    }
+
+    /**
+     * @see VersionHistory#getAllFrozenNodes()
+     */
+    public NodeIterator getAllFrozenNodes() throws RepositoryException {
+        return new FrozenNodeIteratorAdapter(getAllVersions());
+    }
+
+    /**
+     * @see VersionHistory#getAllLinearFrozenNodes()
+     */
+    public NodeIterator getAllLinearFrozenNodes() throws RepositoryException {
+        return new FrozenNodeIteratorAdapter(getAllLinearVersions());
+    }
+    
+    /**
-
-    /**
-     * @see VersionHistory#getAllFrozenNodes()
-     */
-    public NodeIterator getAllFrozenNodes() throws RepositoryException {
-        return new FrozenNodeIteratorAdapter(getAllVersions());
-    }
-
-    /**
-     * @see VersionHistory#getAllLinearFrozenNodes()
-     */
-    public NodeIterator getAllLinearFrozenNodes() throws RepositoryException {        
-        // TODO
-        throw new UnsupportedRepositoryOperationException("JCR-1104");
-    }
-
-    /**
-     * @see VersionHistory#getAllLinearVersions()
-     */
-    public VersionIterator getAllLinearVersions() throws RepositoryException {
-        // TODO
-        throw new UnsupportedRepositoryOperationException("JCR-1104");
-    }
-

INS26 MOV31 MOV31 MOV31 INS40 INS21 INS60 INS60 INS60 INS60 INS61 INS21 INS41 INS41 INS32 INS43 INS59 INS43 INS59 INS43 INS59 INS43 INS59 INS27 INS8 INS32 INS14 INS14 INS42 INS42 INS42 INS14 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS27 INS38 INS21 INS21 INS42 INS42 INS34 INS42 UPD43 MOV43 INS42 UPD43 MOV43 INS32 INS43 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS33 INS32 INS32 INS7 UPD42 UPD42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS34 INS42 INS42 INS32 INS42 INS42 DEL45 DEL14 DEL53 DEL45 DEL14 DEL53