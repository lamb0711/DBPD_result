fixing concurrency issue that could lead to inconsistent repository content

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@240263 13f79535-47bb-0310-9956-ffa450edef68

-        // copy state from transient state
-        persistentState.setDefinitionId(transientState.getDefinitionId());
-        persistentState.setType(transientState.getType());
-        persistentState.setMultiValued(transientState.isMultiValued());
-        persistentState.setValues(transientState.getValues());
-        // make state persistent
-        stateMgr.store(persistentState);
+
+        synchronized (persistentState) {
+            // copy state from transient state
+            persistentState.setDefinitionId(transientState.getDefinitionId());
+            persistentState.setType(transientState.getType());
+            persistentState.setMultiValued(transientState.isMultiValued());
+            persistentState.setValues(transientState.getValues());
+            // make state persistent
+            stateMgr.store(persistentState);
+        }
+

INS51 INS42 INS8 MOV21 MOV21 MOV21 MOV21 MOV21