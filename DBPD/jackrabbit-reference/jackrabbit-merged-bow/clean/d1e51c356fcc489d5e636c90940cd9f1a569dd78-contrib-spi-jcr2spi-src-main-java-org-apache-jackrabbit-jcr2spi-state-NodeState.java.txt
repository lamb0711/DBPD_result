work in progress

- NodeState: rename addNodeReferences to setNodeReferences
-            'set' is not possible if NodeState is transient
-            since NodeReferences are not copied to overlaying state, refs
             must be retrieved from overlayed state if present.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@432278 13f79535-47bb-0310-9956-ffa450edef68

-    void addNodeReferences(NodeReferences references) {
-        this.references = references;
+    /**
+     * Return the <code>NodeReferences</code> present on this state or
+     * <code>null</code>.
+     *
+     * @return references
+     */
+    NodeReferences getNodeReferences() {
+        if (hasOverlayedState()) {
+            return ((NodeState)getOverlayedState()).references;
+        } else {
+            return references;
+        }
-    NodeReferences getNodeReferences() {
-        return references;
+    /**
+     * Set the <code>NodeReferences</code> for this state.
+     *
+     * @param references
+     */
+    void setNodeReferences(NodeReferences references) {
+        if (isTransient()) {
+            // TODO: check again
+            throw new UnsupportedOperationException("Cannot set references to a transient node state.");
+        }
+        this.references = references;

MOV31 INS29 INS8 INS29 UPD42 INS65 INS65 INS25 INS65 INS65 INS25 INS66 INS66 INS66 INS32 INS8 MOV8 INS66 INS42 INS32 INS8 INS42 INS41 INS42 INS53 INS22 INS14 INS36 INS42 INS43 INS45 INS11 INS42 INS43 INS32 INS42 INS42