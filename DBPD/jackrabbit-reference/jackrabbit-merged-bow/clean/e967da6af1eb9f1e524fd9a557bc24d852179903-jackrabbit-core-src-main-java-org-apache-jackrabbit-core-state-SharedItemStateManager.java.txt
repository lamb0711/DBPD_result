JCR-954: Allow to disable referential integrity checking for workspace
    - Added protected RepositoryImpl.setReferentialIntegrityChecking method
      and supporting functionality in SharedItemStateManager
    - Based on patches by Przemo Pakulski

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@632738 13f79535-47bb-0310-9956-ffa450edef68

+     * Flag indicating whether this item state manager is checking referential
+     * integrity when storing modifications. The default is to to check
+     * for referential integrity.
+     * Should be changed very carefully by experienced developers only.
+     *
+     * @see https://issues.apache.org/jira/browse/JCR-954
+     */
+    private boolean checkReferences = true;
+
+    /**
+     * Enables or disables the referential integrity checking, this
+     * should be used very carefully by experienced developers only.
+     *
+     * @see https://issues.apache.org/jira/browse/JCR-954
+     * @param checkReferences whether to do referential integrity checks
+     */
+    public void setCheckReferences(boolean checkReferences) {
+        this.checkReferences = checkReferences;
+    }
+
+    /**
-                /**
-                 * Check whether reference targets exist/were not removed
-                 */
-                checkReferentialIntegrity(local);
+                // If enabled, check whether reference targets
+                // exist/were not removed
+                if (checkReferences) {
+                    checkReferentialIntegrity(local);
+                }

INS23 INS31 INS29 INS83 INS39 INS59 INS29 INS83 INS39 INS42 INS44 INS8 INS65 INS65 INS42 INS9 INS65 INS65 INS65 INS39 INS42 INS21 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS42 INS66 INS7 INS22 INS42 INS52 INS42 INS25 INS42 INS8 MOV21