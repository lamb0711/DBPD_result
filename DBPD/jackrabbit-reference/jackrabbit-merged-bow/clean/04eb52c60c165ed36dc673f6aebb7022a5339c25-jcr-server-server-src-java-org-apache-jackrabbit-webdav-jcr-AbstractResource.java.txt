JCR-405: PROPPATCH doesn't respect document order
minor improvements within 'jcr' package:
- reorder nodes
- fixing creation/replacement of multivalued JCR properties
- contentlength for single value JCR properties
- improve spooling of resource content

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@397835 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.property.DavPropertyNameIterator;
+import org.apache.jackrabbit.webdav.property.DavPropertyIterator;
-import java.io.InputStream;
-import java.io.OutputStream;
-     * Returns <code>null</code>
+     * Spools the properties of this resource to the context. Note that subclasses
+     * are in charge of spooling the data to the output stream provided by the
+     * context.
-     * @return Always returns <code>null</code>
-     */
-    InputStream getStream() {
-        return null;
-    }
-
-    /**
-
-
-        // spool content
-        InputStream in = getStream();
-        OutputStream out = outputContext.getOutputStream();
-        if (in != null && out != null) {
-            try {
-                IOUtil.spool(in, out);
-            } finally {
-                // also close stream if not sending content
-                try {
-                    in.close();
-                } catch (IOException e) {
-                    // ignore
-                }
-            }
-        }
-     * Throws {@link DavServletResponse#SC_METHOD_NOT_ALLOWED}
+     * Builds a single List from the properties to set and the properties to
+     * remove and delegates the list to {@link #alterProperties(List)};
+        List changeList = new ArrayList();
+        if (removePropertyNames != null) {
+            DavPropertyNameIterator it = removePropertyNames.iterator();
+            while (it.hasNext()) {
+                changeList.add(it.next());
+            }
+        }
+        if (setProperties != null) {
+            DavPropertyIterator it = setProperties.iterator();
+            while (it.hasNext()) {
+                changeList.add(it.next());
+            }
+        }
+        return alterProperties(changeList);
+    }
+
+    /**
+     * Throws {@link DavServletResponse#SC_METHOD_NOT_ALLOWED}
+     *
+     * @see DavResource#alterProperties(List)
+     */
+    public MultiStatusResponse alterProperties(List changeList) throws DavException {

MOV26 MOV26 MOV31 UPD40 UPD40 MOV29 INS83 UPD43 UPD42 MOV44 MOV44 INS43 INS29 INS44 INS65 INS65 UPD42 INS42 INS60 INS25 INS25 INS41 MOV65 INS65 INS43 INS42 INS66 INS66 INS66 INS66 INS66 INS65 INS66 INS43 INS59 INS27 INS8 INS27 INS8 INS32 INS68 INS42 INS68 INS42 INS42 INS14 INS42 INS33 INS60 INS61 INS42 INS33 INS60 INS61 INS42 INS42 INS42 INS42 INS69 INS42 INS69 INS43 INS43 INS59 INS32 INS8 INS43 INS59 INS32 INS8 INS43 INS43 INS42 INS42 INS42 INS32 INS42 INS42 INS21 INS42 INS42 INS32 INS42 INS42 INS21 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 DEL42 DEL43 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL42 DEL33 DEL27 DEL27 DEL42 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL42 DEL42 DEL32 DEL21 DEL8 DEL42 DEL43 DEL42 DEL44 DEL8 DEL12 DEL54 DEL8 DEL54 DEL8 DEL25 DEL66 DEL65 DEL66 DEL65 DEL29 DEL33 DEL41