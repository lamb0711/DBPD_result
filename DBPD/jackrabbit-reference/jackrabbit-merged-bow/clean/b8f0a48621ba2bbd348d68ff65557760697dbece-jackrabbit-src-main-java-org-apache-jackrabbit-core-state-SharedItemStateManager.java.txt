Fix potential deadlock in SharedItemStateManager

Because of the writer preference it was possible that reading threads were blocked even though a thread that finished storing changes through the PM already released the write lock.
Modified the lock to a reader preference read-write lock.

For a discussion see: http://thread.gmane.org/gmane.comp.apache.jackrabbit.devel/4507

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@349676 13f79535-47bb-0310-9956-ffa450edef68

-            new ReentrantWriterPreferenceReadWriteLock();
+            new ReentrantWriterPreferenceReadWriteLock() {
+                /**
+                 * Allow reader when there is no active writer, or current
+                 * thread owns the write lock (reentrant).
+                 */
+                protected boolean allowReader() {
+                    return activeWriter_ == null ||
+                      activeWriter_ == Thread.currentThread();
+                }
+            };

INS1 INS31 INS29 INS83 INS39 INS42 INS8 INS65 INS41 INS66 INS66 INS27 INS27 INS27 INS42 INS33 INS42 INS32 INS42 INS42