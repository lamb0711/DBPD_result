reworked transaction support, contributed by dominique

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@151380 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.state.UpdateOperation;
-    protected static PersistentNode checkin(UpdateOperation upd,
-                                            PersistentNode parent, QName name,
+    protected static PersistentNode checkin(PersistentNode parent, QName name,
-        node = parent.addNode(upd, name, NativePVM.NT_REP_FROZEN);
+        node = parent.addNode(name, NativePVM.NT_REP_FROZEN);
-            node.setPropertyValue(upd, VersionManager.PROPNAME_FROZEN_UUID, InternalValue.create(src.getUUID()));
+            node.setPropertyValue(VersionManager.PROPNAME_FROZEN_UUID, InternalValue.create(src.getUUID()));
-        node.setPropertyValue(upd, VersionManager.PROPNAME_FROZEN_PRIMARY_TYPE,
+        node.setPropertyValue(VersionManager.PROPNAME_FROZEN_PRIMARY_TYPE,
-            node.setPropertyValues(upd, VersionManager.PROPNAME_FROZEN_MIXIN_TYPES, PropertyType.NAME, ivalues);
+            node.setPropertyValues(VersionManager.PROPNAME_FROZEN_MIXIN_TYPES, PropertyType.NAME, ivalues);
-                        node.copyFrom(upd, prop);
+                        node.copyFrom(prop);
-                            PersistentNode newChild = node.addNode(upd, child.getQName(), NativePVM.NT_REP_FROZEN_HISTORY);
-                            newChild.setPropertyValue(upd, VersionManager.PROPNAME_VERSION_HISTORY,
+                            PersistentNode newChild = node.addNode(child.getQName(), NativePVM.NT_REP_FROZEN_HISTORY);
+                            newChild.setPropertyValue(VersionManager.PROPNAME_VERSION_HISTORY,
-                            newChild.setPropertyValue(upd, VersionManager.PROPNAME_BASE_VERSION,
+                            newChild.setPropertyValue(VersionManager.PROPNAME_BASE_VERSION,
-                        checkin(upd, node, child.getQName(), child, false, true);
+                        checkin(node, child.getQName(), child, false, true);

DEL40 DEL26 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL42