JCR-2199 - Improvements to user management
- Allow subclasses of UserManagerImpl/UserImpl for custom implementations


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@792467 13f79535-47bb-0310-9956-ffa450edef68

-            throw new IllegalArgumentException("Cannot create user: Principal may not be null and must have a valid name.");            
+            throw new IllegalArgumentException("Cannot create user: Principal may not be null and must have a valid name.");
-        User user = UserImpl.create(userNode, this);
+        if (userNode == null || !userNode.isNodeType(NT_REP_USER)) {
+            throw new IllegalArgumentException();
+        }
+        if (!Text.isDescendant(USERS_PATH, userNode.getPath())) {
+            throw new IllegalArgumentException("User has to be within the User Path");
+        }
+        User user = doCreateUser(userNode);
+     * Build the user object from the given user node. May be overridden to
+     * return a custom implementation.
+     *
+     * @param node user node
+     * @return user object
+     * @throws RepositoryException if an error occurs
+     */
+    protected User doCreateUser(NodeImpl node) throws RepositoryException {
+        return new UserImpl(node, this);
+    }
+
+
+    /**
-    
+
-     * @see SessionListener#loggedOut(org.apache.jackrabbit.core.SessionImpl) 
+     * @see SessionListener#loggedOut(org.apache.jackrabbit.core.SessionImpl)

INS31 INS29 INS83 INS43 INS42 INS44 INS43 INS8 INS25 INS25 INS65 INS65 INS65 INS65 INS42 INS43 INS42 INS42 INS41 INS27 INS8 INS38 INS8 INS66 INS66 INS42 INS66 INS66 INS42 INS66 INS42 INS14 INS27 INS38 INS53 INS32 INS53 INS43 INS42 INS52 INS42 INS33 INS32 INS14 INS42 INS42 INS42 INS32 INS14 UPD42 INS42 INS42 INS42 INS42 INS43 INS42 INS42 INS43 INS45 INS42 INS42 DEL42 DEL52 DEL66