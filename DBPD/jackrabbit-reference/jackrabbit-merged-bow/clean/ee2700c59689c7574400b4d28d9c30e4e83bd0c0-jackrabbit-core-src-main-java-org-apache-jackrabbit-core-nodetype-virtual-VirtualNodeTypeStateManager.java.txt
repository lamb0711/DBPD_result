JCR-2587: Coarser granularity of node type unregistration notifications

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@927945 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.id.NodeId;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.Collections;
+import java.util.List;
+
+import javax.jcr.NodeIterator;
+import javax.jcr.PropertyIterator;
+import javax.jcr.RepositoryException;
+
+import org.apache.jackrabbit.core.id.NodeId;
+import org.apache.jackrabbit.spi.commons.conversion.MalformedPathException;
-import org.apache.jackrabbit.spi.commons.conversion.MalformedPathException;
-import javax.jcr.NodeIterator;
-import javax.jcr.PropertyIterator;
-import javax.jcr.RepositoryException;
-import java.util.ArrayList;
-import java.util.List;
-
-        nodeTypeUnregistered(ntName);
+        nodeTypesUnregistered(Collections.singleton(ntName));
-    public void nodeTypeUnregistered(Name ntName) {
+    public void nodeTypesUnregistered(Collection<Name> names) {
-                NodeImpl root = (NodeImpl) systemSession.getItemManager().getItem(rootNodeId);
-                NodeImpl child = root.getNode(ntName);
-                List events = new ArrayList();
-                recursiveRemove(events, root, child);
+                List<EventState> events = new ArrayList<EventState>();
+
+                NodeImpl root = (NodeImpl)
+                    systemSession.getItemManager().getItem(rootNodeId);
+                for (Name name : names) {
+                    NodeImpl child = root.getNode(name);
+                    recursiveRemove(events, root, child);
+                }
+
-                virtProvider.onNodeTypeRemoved(ntName);
+                virtProvider.onNodeTypesRemoved(names);
-            log.error("Unable to index removed nodetype: " + e.toString());
+            log.error("Unable to index removed nodetypes: " + names, e);
-    private void recursiveAdd(List events, NodeImpl parent, NodeImpl node)
+    private void recursiveAdd(
+            List<EventState> events, NodeImpl parent, NodeImpl node)
-    private void recursiveRemove(List events, NodeImpl parent, NodeImpl node)
+    private void recursiveRemove(
+            List<EventState> events, NodeImpl parent, NodeImpl node)

MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 INS26 INS26 INS40 INS40 UPD42 INS74 UPD42 INS74 INS74 INS43 INS43 MOV43 INS43 MOV43 INS43 UPD42 INS32 INS42 MOV42 INS42 INS42 INS42 INS42 MOV42 MOV60 INS70 INS74 INS44 INS42 INS8 INS42 MOV43 INS43 INS43 INS42 MOV60 MOV21 UPD42 UPD42 UPD45 INS42 INS42 INS74 INS42 MOV43 INS43 INS42 UPD42 DEL43 DEL42 DEL42 DEL32