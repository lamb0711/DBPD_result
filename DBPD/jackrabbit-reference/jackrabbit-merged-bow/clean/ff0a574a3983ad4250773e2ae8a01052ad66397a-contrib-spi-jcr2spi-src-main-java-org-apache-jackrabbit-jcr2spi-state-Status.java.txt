work in progress

- more todos
- revert tmp status 'modified' immediately after notifying overlaying state.
- setStatus: delegate validation to Status

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@462717 13f79535-47bb-0310-9956-ffa450edef68

+    public static boolean isValidStatusChange(int oldStatus, int newStatus,
+                                              boolean isWorkspaceState) {
+        if (oldStatus == newStatus) {
+            return true;
+        }
+        boolean isValid = false;
+        if (isWorkspaceState) {
+            switch (newStatus) {
+                case EXISTING:
+                    isValid = (oldStatus == MODIFIED);
+                    break;
+                case MODIFIED:
+                    isValid = (oldStatus == EXISTING);
+                    break;
+                case REMOVED:
+                    isValid = (oldStatus == EXISTING);
+                    break;
+                // default: no other status possible : -> false
+            }
+        } else {
+            switch (newStatus) {
+               case EXISTING:
+                   switch (oldStatus) {
+                       case NEW: /* save */
+                       case EXISTING_MODIFIED: /* save, revert */
+                       case EXISTING_REMOVED:  /* revert */
+                       case STALE_MODIFIED:    /* revert */
+                           isValid = true;
+                           break;
+                       /* REMOVED, STALE_DESTROYED -> false */
+                   }
+                   break;
+               case EXISTING_MODIFIED:
+                   isValid = (oldStatus == EXISTING);
+                   break;
+               case EXISTING_REMOVED:
+                   isValid = (oldStatus == EXISTING || oldStatus == EXISTING_MODIFIED);
+                   break;
+               case STALE_MODIFIED:
+               case STALE_DESTROYED:
+                   isValid = (oldStatus == EXISTING_MODIFIED);
+                   break;
+               case REMOVED:
+                   isValid = (oldStatus == NEW || oldStatus == EXISTING || oldStatus == EXISTING_REMOVED);
+                   break;
+               /* default:
+                  NEW cannot change state to NEW -> false
+                  MODIFIED never applicable to session state -> false */
+
+            }
+        }
+        return isValid;
+    }

INS31 INS83 INS83 INS39 INS42 INS44 INS44 INS44 INS8 INS39 INS42 INS39 INS42 INS39 INS42 INS25 INS60 INS25 INS41 INS27 INS8 INS39 INS59 INS42 INS8 INS8 INS42 INS42 INS42 INS41 INS42 INS9 INS50 INS50 INS9 INS42 INS49 INS21 INS10 INS49 INS21 INS10 INS49 INS21 INS10 INS42 INS49 INS50 INS10 INS49 INS21 INS10 INS49 INS21 INS10 INS49 INS49 INS21 INS10 INS49 INS21 INS10 INS42 INS7 INS42 INS7 INS42 INS7 INS42 INS42 INS49 INS49 INS49 INS49 INS21 INS10 INS42 INS7 INS42 INS7 INS42 INS42 INS7 INS42 INS7 INS42 INS36 INS42 INS36 INS42 INS36 INS42 INS42 INS42 INS42 INS7 INS42 INS36 INS42 INS36 INS42 INS36 INS42 INS36 INS27 INS27 INS27 INS42 INS9 INS27 INS27 INS27 INS27 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS27 INS27 INS42 INS42 INS27 INS27 INS42 INS42 INS42 INS42 INS27 INS27 INS42 INS42 INS42 INS42 INS42 INS42