JCR-890: concurrent read-only access to a session

Turn Item.save() into a managed operation.

Introduce SessionContext to avoid having to pass a yet another reference around.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@956912 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.session.SessionContext;
+    /**
+     * Component context of the associated session.
+     */
+    protected final SessionContext sessionContext;
+
-     * @param session     the session associated with the new instance
+     * @param sessionContext component context of the associated session
-    protected ItemManager(SessionItemStateManager sism,
-                          HierarchyManager hierMgr,
-                          SessionImpl session,
-                          NodeDefinitionImpl rootNodeDef,
-                          NodeId rootNodeId,
-                          DataStore dataStore) {
+    protected ItemManager(
+            SessionItemStateManager sism, HierarchyManager hierMgr,
+            SessionContext sessionContext, NodeDefinitionImpl rootNodeDef,
+            NodeId rootNodeId, DataStore dataStore) {
-        this.session = session;
+        this.sessionContext = sessionContext;
+        this.session = sessionContext.getSessionImpl();
-     * @param session           the session associated with the new instance
+     * @param sessionContext component context of the associated session
-            SessionImpl session,
+            SessionContext sessionContext,
-                itemStateProvider, hierMgr, session, rootNodeDef,
+                itemStateProvider, hierMgr, sessionContext, rootNodeDef,
-            return new VersionImpl(this, session, data);
+            return new VersionImpl(this, sessionContext, data);
-            return new VersionHistoryImpl(this, session, data);
+            return new VersionHistoryImpl(this, sessionContext, data);
-            return new NodeImpl(this, session, data);
+            return new NodeImpl(this, sessionContext, data);
-        return new PropertyImpl(this, session, data, dataStore);
+        return new PropertyImpl(this, sessionContext, data, dataStore);

INS26 INS40 INS23 INS29 INS83 INS83 INS43 INS59 INS65 INS42 INS42 UPD43 UPD42 INS21 UPD43 UPD42 INS66 UPD42 UPD66 UPD42 INS7 UPD42 UPD66 UPD42 MOV43 INS22 INS42 INS32 UPD42 INS52 INS42 INS42 INS42 MOV43 UPD42 UPD42 UPD42 UPD42 DEL42