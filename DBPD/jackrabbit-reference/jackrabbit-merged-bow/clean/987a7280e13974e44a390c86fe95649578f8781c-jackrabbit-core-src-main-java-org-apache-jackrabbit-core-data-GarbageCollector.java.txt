JCR-2241 Data Store: garbage collection should ignore removed items

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@801894 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.InvalidItemStateException;
-        for (PropertyIterator it = n.getProperties(); it.hasNext();) {
-            Property p = it.nextProperty();
-            if (p.getType() == PropertyType.BINARY) {
-                if (n.hasProperty("jcr:uuid")) {
-                    rememberNode(n.getProperty("jcr:uuid").getString());
-                } else {
-                    rememberNode(n.getPath());
-                }
-                if (p.getDefinition().isMultiple()) {
-                    p.getLengths();
-                } else {
-                    p.getLength();
+        try {
+            for (PropertyIterator it = n.getProperties(); it.hasNext();) {
+                Property p = it.nextProperty();
+                if (p.getType() == PropertyType.BINARY) {
+                    if (n.hasProperty("jcr:uuid")) {
+                        rememberNode(n.getProperty("jcr:uuid").getString());
+                    } else {
+                        rememberNode(n.getPath());
+                    }
+                    if (p.getDefinition().isMultiple()) {
+                        p.getLengths();
+                    } else {
+                        p.getLength();
+                    }
+        } catch (InvalidItemStateException e) {
+            // the property may have been removed in the meantime - ignore
-        for (NodeIterator it = n.getNodes(); it.hasNext();) {
-            recurse(it.nextNode(), sleep);
+        try {
+            for (NodeIterator it = n.getNodes(); it.hasNext();) {
+                recurse(it.nextNode(), sleep);
+            }
+        } catch (InvalidItemStateException e) {
+            // the item may have been removed in the meantime - ignore

INS26 INS40 INS54 INS54 INS8 INS12 INS8 INS12 MOV24 INS44 INS8 MOV24 INS44 INS8 INS43 INS42 INS43 INS42 INS42 INS42