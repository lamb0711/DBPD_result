JCR-2809 Lock expires almost immediately

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1033964 13f79535-47bb-0310-9956-ffa450edef68

-     * Time (in seconds since epoch) when this lock will timeout. Set to
+     * Time (in milliseconds since the epoch) when this lock will timeout. Set to
-     * 
+     *
-     * 
+     *
-     * Return a flag indicating whether the session given is lock holder. 
+     * Return a flag indicating whether the session given is lock holder.
-     * Returns the time when this lock will expire. 
+     * Returns the time when this lock will expire.
-     * @return timeout time in seconds after epoch
+     * @return timeout time in milliseconds since the epoch
-            && timeoutTime * 1000 > System.currentTimeMillis();
+            && System.currentTimeMillis() > timeoutTime;
-            long now = (System.currentTimeMillis() + 999) / 1000; // round up
-            this.timeoutTime = now + timeoutHint;
+            long now = System.currentTimeMillis();
+            this.timeoutTime = now + timeoutHint * 1000;
-            buffer.append(lockHolder.getUserID());
+            buffer.append(lockHolder.getUserID()).append(' ');
-            buffer.append("none");
+            buffer.append("none ");

UPD66 UPD66 UPD66 UPD66 UPD27 MOV27 MOV27 UPD27 MOV27 INS42 INS32 MOV32 MOV32 INS42 INS13 UPD45 INS27 MOV42 INS34 DEL34 DEL36 DEL34 DEL42 DEL34 DEL27 DEL27 DEL27