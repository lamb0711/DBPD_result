JCR-1483: Move common node type functionality to jackrabbit-spi-commons
- replaced NodeTypeDef (jackrabbit-core) with QNodeTypeDefinition
- QNodeTypeDefinitionImpl is not immutable, hence no cloning needed anymore
- introduced QNodeTypeDefinitionBuilder
- moved constructors of Q*DefinitionImpl classes in spi2jcr to spi-commons
- fixed a bug in RepositoryServiceImpl in spi2jcr

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@816551 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.spi.commons.QPropertyDefinitionImpl;
+import org.apache.jackrabbit.spi.commons.QNodeDefinitionImpl;
+import org.apache.jackrabbit.spi.commons.QNodeTypeDefinitionImpl;
-    public Iterator getQNodeTypeDefinitions(SessionInfo sessionInfo) throws RepositoryException {
+    public Iterator<QNodeTypeDefinition> getQNodeTypeDefinitions(SessionInfo sessionInfo) throws RepositoryException {
-        List nodeTypes = new ArrayList();
+        List<QNodeTypeDefinition> nodeTypes = new ArrayList<QNodeTypeDefinition>();
-    public Iterator getQNodeTypeDefinitions(SessionInfo sessionInfo, Name[] nodetypeNames) throws RepositoryException {
+    public Iterator<QNodeTypeDefinition> getQNodeTypeDefinitions(SessionInfo sessionInfo, Name[] nodetypeNames) throws RepositoryException {
-        List defs = new ArrayList();
-        for (int i = 0; i < nodetypeNames.length; i++) {
+        List<QNodeTypeDefinition> defs = new ArrayList<QNodeTypeDefinition>();
+        for (Name nodetypeName : nodetypeNames) {
-                String ntName = sInfo.getNamePathResolver().getJCRName(nodetypeNames[i]);
+                String ntName = sInfo.getNamePathResolver().getJCRName(nodetypeName);
-                defs.add(new QNodeTypeDefinitionImpl(nt, sInfo.getNamePathResolver(), getQValueFactory()));
+                defs.add(new QNodeTypeDefinitionImpl(nt, 
+                        sInfo.getNamePathResolver(), getQValueFactory()));
-                for (int st = 0; st < supertypes.length; st++) {
-                    defs.add(new QNodeTypeDefinitionImpl(supertypes[i], sInfo.getNamePathResolver(), getQValueFactory()));
+                for (NodeType supertype : supertypes) {
+                    defs.add(new QNodeTypeDefinitionImpl(supertype,
+                            sInfo.getNamePathResolver(), getQValueFactory()));

INS26 INS26 INS26 INS40 INS40 INS40 INS74 INS74 MOV43 INS43 MOV43 INS43 INS70 INS42 INS74 INS42 INS74 INS44 INS42 MOV8 MOV43 INS43 MOV43 INS43 INS43 INS42 INS42 INS74 INS42 INS74 INS42 MOV43 INS43 MOV43 INS43 INS70 INS42 INS42 INS44 INS42 MOV8 INS43 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL2 DEL42 DEL42 DEL2 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL40 DEL27 DEL42 DEL37 DEL24 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL40 DEL27 DEL42 DEL37 DEL24