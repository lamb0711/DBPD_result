JCR-1588: JSR 283 Access Control (work in progress)
JCR-1622 - Session.getUserID returns first principal in the set obtained from Subject.getPrincipals()

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@659024 13f79535-47bb-0310-9956-ffa450edef68

-        /*
-         Retrieve userID from the subject.
-         Since the subject may contain multiple principals and the principal
-         name must not be equals to the UserID by definition, the proper way
-         is to check for known credentials the provide the correct userID.
-         The specification explicitely defines the UserID to be related to
-         the credentials and allows 'null' values in case the credentials do
-         not reveal a userID.
-         TODO: eval alternative approach via UserManager
-        */
-        String uid = null;
-        Iterator creds = subject.getPublicCredentials(SimpleCredentials.class).iterator();
-        if (creds.hasNext()) {
-            SimpleCredentials sc = (SimpleCredentials) creds.next();
-            uid = sc.getUserID();
-        }
-        userId = uid;
+        userId = retrieveUserId(subject);
+     * Retrieve the userID from the specified subject.
+     *
+     * @return the userID.
+     */
+    protected String retrieveUserId(Subject subject) throws RepositoryException {
+        return rep.getSecurityManager().getUserID(subject);
+    }
+
+    /**

INS31 INS29 INS83 MOV43 INS42 INS44 INS43 INS8 MOV21 INS65 INS65 INS43 INS42 INS42 INS41 INS66 INS66 INS42 INS32 UPD42 INS32 INS42 INS42 UPD42 UPD42 INS42 INS42 DEL42 DEL33 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL43 DEL57 DEL32 DEL42 DEL32 DEL59 DEL60 DEL42 DEL42 DEL32 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL42 DEL32 DEL11 DEL59 DEL60 DEL8 DEL25 DEL42 DEL42 DEL7 DEL21