JCR-1104: JSR 283 support (work in progress)
- NodeLocalName

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@647798 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.lucene.search.TermQuery;
+import org.apache.jackrabbit.spi.Name;
-    private final String nameTest;
+    private final Name nameTest;
+
+    /**
+     * The index format version.
+     */
+    private final IndexFormatVersion version;
+
+    /**
+     * The internal namespace mappings.
+     */
+    private final NamespaceMappings nsMappings;
+     * @param version the index format version.
+     * @param nsMappings the namespace mappings.
-    DerefQuery(Query context, String refProperty, String nameTest) {
+    DerefQuery(Query context, String refProperty, Name nameTest,
+               IndexFormatVersion version, NamespaceMappings nsMappings) {
+        this.version = version;
+        this.nsMappings = nsMappings;
-            return new DerefQuery(cQuery, refProperty, nameTest);
+            return new DerefQuery(cQuery, refProperty, nameTest, version, nsMappings);
-                nameTestScorer = new TermQuery(new Term(FieldNames.LABEL, nameTest)).weight(searcher).scorer(reader);
+                nameTestScorer = new NameQuery(nameTest, version, nsMappings).weight(searcher).scorer(reader);

MOV26 UPD40 INS23 INS23 UPD43 INS29 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS43 INS59 INS44 INS44 UPD42 INS65 INS42 INS42 INS65 INS42 INS42 INS65 INS65 UPD43 INS43 INS42 INS43 INS42 INS21 INS21 INS66 INS66 INS42 INS66 INS42 INS66 UPD42 INS42 INS42 INS7 INS7 INS22 INS42 INS22 INS42 INS52 INS42 INS52 INS42 INS42 INS42 UPD43 INS42 INS42 UPD42 MOV42 UPD42 DEL42 DEL43 DEL40 DEL14