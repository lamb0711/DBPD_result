JCR-890: concurrent read-only access to a session

Leverage SessionContext in more places.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@957229 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.security.AccessManager;
+import org.apache.jackrabbit.core.session.SessionContext;
+     * Component context of the associated session.
+     */
+    protected final SessionContext sessionContext;
+
+    /**
-    protected final AccessManager accessMgr;
-
-    protected final ItemManager itemMgr;
-
-     * @param ntReg      node type registry
-     * @param hierMgr    hierarchy manager
-     * @param session    session
+     * @param sessionContext component context of this session
-    public ItemValidator(NodeTypeRegistry ntReg,
-                         HierarchyManager hierMgr,
-                         SessionImpl session) throws RepositoryException {
-        this(ntReg, hierMgr, session, session.getLockManager(),
-                session.getAccessManager(), session.getRetentionRegistry(),
-                session.getItemManager());
-    }
-
-    /**
-     * Creates a new <code>ItemValidator</code> instance.
-     *
-     * @param ntReg      node type registry
-     * @param hierMgr    hierarchy manager
-     * @param resolver   resolver
-     * @param lockMgr    lockMgr
-     * @param accessMgr  accessMgr
-     * @param retentionReg
-     * @param itemMgr    the item manager
-     */
-    public ItemValidator(NodeTypeRegistry ntReg,
-                         HierarchyManager hierMgr,
-                         PathResolver resolver,
-                         LockManager lockMgr,
-                         AccessManager accessMgr,
-                         RetentionRegistry retentionReg,
-                         ItemManager itemMgr) {
-        this.ntReg = ntReg;
-        this.hierMgr = hierMgr;
-        this.resolver = resolver;
-        this.lockMgr = lockMgr;
-        this.accessMgr = accessMgr;
-        this.retentionReg = retentionReg;
-        this.itemMgr = itemMgr;
+    public ItemValidator(SessionContext sessionContext) throws RepositoryException {
+        this.sessionContext = sessionContext;
+        this.ntReg = sessionContext.getRepositoryContext().getNodeTypeRegistry();
+        this.hierMgr = sessionContext.getHierarchyManager();
+        this.resolver = sessionContext.getSessionImpl();
+        this.lockMgr = sessionContext.getSessionImpl().getLockManager();
+        this.retentionReg = sessionContext.getSessionImpl().getRetentionRegistry();
-        QNodeDefinition def = itemMgr.getDefinition(nodeState).unwrap();
+        QNodeDefinition def =
+            sessionContext.getItemManager().getDefinition(nodeState).unwrap();
-        QPropertyDefinition def = itemMgr.getDefinition(propState).unwrap();
+        QPropertyDefinition def =
+            sessionContext.getItemManager().getDefinition(propState).unwrap();
-            accessMgr.checkPermission(path, permissions);
+            sessionContext.getAccessManager().checkPermission(path, permissions);
-            if (!accessMgr.isGranted(path, permissions)) {
+            if (!sessionContext.getAccessManager().isGranted(path, permissions)) {

MOV26 MOV23 UPD40 INS29 UPD43 MOV8 MOV21 INS65 UPD42 UPD42 UPD43 UPD42 INS66 UPD42 UPD66 UPD42 UPD42 INS32 INS32 INS32 INS32 INS32 UPD42 INS32 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS32 INS32 INS42 UPD42 MOV42 INS42 UPD42 MOV42 INS42 UPD42 MOV42 INS32 INS42 UPD42 MOV42 DEL83 DEL83 DEL42 DEL43 DEL42 DEL59 DEL23 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL42 DEL42 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL17 DEL8 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL65 DEL42 DEL66 DEL65 DEL29 DEL83 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL31