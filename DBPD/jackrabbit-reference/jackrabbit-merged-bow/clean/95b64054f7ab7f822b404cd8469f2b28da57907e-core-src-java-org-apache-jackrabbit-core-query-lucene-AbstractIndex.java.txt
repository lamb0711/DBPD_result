JCR-190: Caching in QueryHandler does not scale well

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@234492 13f79535-47bb-0310-9956-ffa450edef68

+    /**
+     * The document number cache if this index may use one.
+     */
+    private DocNumberCache cache;
+
-     * @param analyzer the analyzer for text tokenizing.
+     *
+     * @param analyzer  the analyzer for text tokenizing.
+     * @param cache     the document number cache if this index should use one;
+     *                  otherwise <code>cache</code> is <code>null</code>.
-    AbstractIndex(Analyzer analyzer, Directory directory) throws IOException {
+    AbstractIndex(Analyzer analyzer,
+                  Directory directory,
+                  DocNumberCache cache) throws IOException {
+        this.cache = cache;
-            sharedReader = new SharedIndexReader(new CachingIndexReader(IndexReader.open(getDirectory())));
+            CachingIndexReader cr = new CachingIndexReader(IndexReader.open(getDirectory()), cache);
+            sharedReader = new SharedIndexReader(cr);

INS23 INS29 INS83 INS43 INS59 INS44 INS65 INS42 INS42 INS65 INS43 INS42 INS21 INS66 UPD66 INS42 INS66 INS66 INS42 INS7 INS22 INS42 INS60 INS52 INS42 INS43 INS59 INS42 INS42 MOV14 INS42 INS42