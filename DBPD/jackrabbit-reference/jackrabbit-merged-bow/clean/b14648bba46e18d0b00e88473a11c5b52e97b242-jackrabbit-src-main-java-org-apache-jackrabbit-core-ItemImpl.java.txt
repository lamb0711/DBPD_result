Restore of transient items after a unsuccessful save() failed when same item
was already in attic space.


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@368735 13f79535-47bb-0310-9956-ffa450edef68

-            ItemImpl item = itemMgr.getItem(itemState.getId());
+            ItemId id = itemState.getId();
+            ItemImpl item;
+
+            if (stateMgr.isItemStateInAttic(id)) {
+                // If an item has been removed and then again created, the
+                // item is lost after persistTransientItems() and the
+                // TransientItemStateManager will bark because of a deleted
+                // state in its attic. We therefore have to forge a new item
+                // instance ourself.
+                if (itemState.isNode()) {
+                    item = itemMgr.createNodeInstance((NodeState) itemState);
+                } else {
+                    item = itemMgr.createPropertyInstance((PropertyState) itemState);
+                }
+                itemState.setStatus(ItemState.STATUS_NEW);
+            } else {
+                item = itemMgr.getItem(id);
+            }

INS60 INS25 INS43 MOV43 INS59 INS32 INS8 INS8 INS42 UPD42 MOV32 INS42 INS42 INS42 INS42 INS25 INS21 INS21 INS32 INS8 INS8 INS32 INS7 INS42 INS42 INS21 INS21 INS42 INS42 INS40 INS42 INS32 INS7 INS7 INS42 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS11 INS42 INS42 INS11 INS43 INS42 INS43 INS42 INS42 INS42 DEL42 DEL42 DEL32