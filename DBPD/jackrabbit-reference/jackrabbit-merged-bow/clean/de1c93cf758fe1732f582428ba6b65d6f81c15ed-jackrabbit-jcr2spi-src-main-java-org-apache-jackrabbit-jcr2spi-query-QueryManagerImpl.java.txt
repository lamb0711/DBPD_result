JCR-1658: Executing query throws UnsupportedRepositoryOperationException(LEVEL_2_SUPPORTED) for a level 1 only implementation

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@674491 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.jcr2spi.hierarchy.HierarchyManager;
-import org.apache.jackrabbit.spi.commons.conversion.NamePathResolver;
+import org.apache.jackrabbit.jcr2spi.ManagerProvider;
-     * Name and Path resolver
+     * Provides various managers.
-    private final NamePathResolver resolver;
+    private final ManagerProvider mgrProvider;
-     * The <code>HierarchyManager</code> of for item retrieval in search results
-     */
-    private final HierarchyManager hierarchyManager;
-
-    /**
-     * @param session
-     * @param itemMgr
-     * @param hierarchyManager
-     * @param wspManager
+     * @param session the current session.
+     * @param mgrProvider the manager provider.
+     * @param itemMgr the item manager of the current session.
+     * @param wspManager the workspace manager.
-                            NamePathResolver resolver,
+                            ManagerProvider mgrProvider,
-                            HierarchyManager hierarchyManager,
-        this.resolver = resolver;
+        this.mgrProvider = mgrProvider;
-        this.hierarchyManager = hierarchyManager;
-        QueryImpl query = new QueryImpl(session, resolver, itemMgr, hierarchyManager, wspManager, statement, language);
-        return query;
+        return new QueryImpl(session, mgrProvider, itemMgr, wspManager, statement, language);
-        QueryImpl query = new QueryImpl(session, resolver, itemMgr, hierarchyManager, wspManager, node);
-        return query;
+        return new QueryImpl(session, mgrProvider, itemMgr, wspManager, node);

MOV23 UPD40 MOV44 UPD43 UPD42 UPD42 UPD43 UPD42 MOV21 INS41 MOV21 INS41 UPD66 INS66 UPD42 INS66 UPD42 INS66 INS66 UPD42 INS14 INS14 UPD42 MOV43 MOV42 UPD42 MOV42 MOV42 MOV42 MOV42 MOV42 MOV43 MOV42 UPD42 MOV42 MOV42 MOV42 MOV42 UPD42 DEL40 DEL26 DEL66 DEL65 DEL29 DEL83 DEL83 DEL42 DEL43 DEL42 DEL59 DEL23 DEL42 DEL43 DEL42 DEL44 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL42 DEL42 DEL14 DEL59 DEL60 DEL42 DEL41 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL14 DEL59 DEL60 DEL42 DEL41