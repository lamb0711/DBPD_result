redesigned transaction support & PersistenceManager

orginal code contributed by dominique pfister, required a lot of tweaking to make it run & work; not thoroughly tested

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@126221 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.commons.collections.BeanMap;
+import org.apache.jackrabbit.core.config.SearchConfig;
-import org.apache.jackrabbit.core.config.SearchConfig;
-import org.apache.commons.collections.BeanMap;
-import javax.jcr.RepositoryException;
+import javax.jcr.ItemNotFoundException;
-import javax.jcr.ItemNotFoundException;
+import javax.jcr.RepositoryException;
+import javax.jcr.observation.Event;
+import javax.jcr.observation.EventIterator;
-import javax.jcr.observation.EventIterator;
-import javax.jcr.observation.Event;
-import java.util.*;
+import java.util.HashSet;
+import java.util.Iterator;
+import java.util.Set;
-    /** Logger instance for this class */
+    /**
+     * Logger instance for this class
+     */
-    /** Namespace URI for xpath functions */
+    /**
+     * Namespace URI for xpath functions
+     */
-    /** Namespace URI for XML schema */
+    /**
+     * Namespace URI for XML schema
+     */
-    /** HierarchyManager for path resolution */
+    /**
+     * HierarchyManager for path resolution
+     */
-    /** Session for accessing Nodes */
+    /**
+     * Session for accessing Nodes
+     */
-    /** Storage for search index */
+    /**
+     * Storage for search index
+     */
-    /** QueryHandler where query execution is delegated to */
+    /**
+     * QueryHandler where query execution is delegated to
+     */
+     *
-     * @throws IOException if an error occurs while adding the node to the index.
+     * @throws IOException         if an error occurs while adding the node to the index.
+     *
-     * {@link org.apache.jackrabbit.core.fs.FileSystem} configured in
-     * {@link org.apache.jackrabbit.core.config.SearchConfig}.
+     * {@link FileSystem} configured in {@link SearchConfig}.
-     * @param session the session of the user executing the query.
-     * @param itemMgr the item manager of the user executing the query. Needed
-     *   to return <code>Node</code> instances in the result set.
+     * @param session   the session of the user executing the query.
+     * @param itemMgr   the item manager of the user executing the query. Needed
+     *                  to return <code>Node</code> instances in the result set.
-     * @param language the syntax of the query statement.
+     * @param language  the syntax of the query statement.
-     *
-     *   <code>language</code> is unknown.
-     * @throws RepositoryException if any other error occurs.
+     *                               <code>language</code> is unknown.
+     * @throws RepositoryException   if any other error occurs.
-    
+
-     *   to return <code>Node</code> instances in the result set.
+     *                to return <code>Node</code> instances in the result set.
-     *
-     *   persisted query (that is, a node of type nt:query)
+     *                               persisted query (that is, a node of type nt:query)
-     * @throws RepositoryException if any other error occurs.
+     * @throws RepositoryException   if any other error occurs.

MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 INS26 INS26 INS40 INS40 UPD40 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 INS42 INS42 DEL40 DEL40