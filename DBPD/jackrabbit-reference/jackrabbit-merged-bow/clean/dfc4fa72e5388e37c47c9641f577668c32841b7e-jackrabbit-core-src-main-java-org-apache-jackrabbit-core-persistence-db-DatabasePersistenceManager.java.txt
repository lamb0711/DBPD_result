JCR-1246: potential endless loop in DatabasePersistenceManager.store()

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@599769 13f79535-47bb-0310-9956-ffa450edef68

-                if (ise != null && ise.getCause() instanceof SQLException
-                        && --trials > 0) {
-                    // a SQLException has been thrown, try to reconnect
-                    log.warn("storing changes failed, about to reconnect...", ise.getCause());
+                if (ise != null && ise.getCause() instanceof SQLException) {
+                    // a SQLException has been thrown
+                    if (--trials > 0) {
+                        // try to reconnect
+                        log.warn("storing changes failed, about to reconnect...", ise.getCause());
-                    // try to reconnect
-                    if (reestablishConnection()) {
-                        // now let's give it another try
-                        ise = null;
-                        continue;
-                    } else {
-                        // reconnect failed, proceed with error processing
-                        break;
+                        // try to reconnect
+                        if (reestablishConnection()) {
+                            // now let's give it another try
+                            ise = null;
+                            continue;
+                        } else {
+                            // reconnect failed, proceed with error processing
+                            break;
+                        }
+                } else {
+                    // a non-SQLException has been thrown, 
+                    // proceed with error processing
+                    break;

MOV27 INS8 INS8 INS25 INS10 MOV27 MOV8 DEL27