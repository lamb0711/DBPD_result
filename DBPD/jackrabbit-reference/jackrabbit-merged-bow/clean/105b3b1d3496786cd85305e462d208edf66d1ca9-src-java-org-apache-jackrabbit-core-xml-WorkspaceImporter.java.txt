Workspace.clone(...,removeExisting=true) & Workspace.importXML(..., IMPORT_UUID_COLLISION_REMOVE_EXISTING) potentially leaves repository in inconsistent state

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@160782 13f79535-47bb-0310-9956-ffa450edef68

-            unlinkNodeState(target, parentUUID);
+            unlinkNode(target, parentUUID);
-    private void unlinkNodeState(NodeState target, String parentUUID)
+    private void unlinkNode(NodeState target, String parentUUID)
-                    NodeState nodeState = (NodeState) stateMgr.getItemState(nodeId);
+                    NodeState node = (NodeState) stateMgr.getItemState(nodeId);
-                    wsp.checkRemoveNode(nodeState, (NodeId) target.getId(),
+                    wsp.checkRemoveNode(node, (NodeId) target.getId(),
-                    unlinkNodeState(nodeState, target.getUUID());
+                    unlinkNode(node, target.getUUID());
-                    PropertyState propState = (PropertyState) stateMgr.getItemState(propId);
+                    PropertyState prop = (PropertyState) stateMgr.getItemState(propId);
-                    stateMgr.destroy(propState);
+                    stateMgr.destroy(prop);
-            // destroy target state
+            // destroy target
-            // store target state
+            // store target

UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42