Oops, forgot to include the default workspace creation code. (JCR-53)

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@156420 13f79535-47bb-0310-9956-ffa450edef68

-    private String wspConfigRootDir;
+    private String workspaceDirectory;
-    private VersioningConfig vConfig;
+    private VersioningConfig vc;
-        this.wspConfigRootDir = root;
+        this.workspaceDirectory = root;
-        this.vConfig = vc;
+        this.vc = vc;
-        vConfig.init();
+        vc.init();
-        File root = new File(wspConfigRootDir);
-        if (!root.exists()) {
-            root.mkdirs();
+        // Get the workspace root directory (create it if not found)
+        File directory = new File(workspaceDirectory);
+        if (!directory.exists()) {
+            directory.mkdirs();
-        File[] files = root.listFiles();
+        // Get all workspace subdirectories
+        File[] files = directory.listFiles();
-                    "Invalid workspace root directory: " + wspConfigRootDir);
+                    "Invalid workspace root directory: " + workspaceDirectory);
+
+        if (wspConfigs.isEmpty()) {
+            // create initial default workspace
+            createWorkspaceConfig(defaultWspName);
+        } else if (!wspConfigs.containsKey(defaultWspName)) {
+            throw new ConfigurationException(
+                    "no configuration found for default workspace: "
+                    + defaultWspName);
+        }
-        File wspFolder = new File(wspConfigRootDir, name);
+        File wspFolder = new File(workspaceDirectory, name);
-        return wspConfigRootDir;
+        return workspaceDirectory;
-        return vConfig;
+        return vc;

UPD42 UPD42 INS25 INS32 INS8 INS25 MOV43 UPD42 UPD42 UPD42 UPD42 INS42 INS42 INS21 INS38 INS8 UPD42 UPD42 UPD42 UPD42 UPD42 INS32 INS32 INS53 MOV43 UPD42 UPD42 INS42 INS42 INS42 INS42 INS42 INS14 UPD42 INS43 INS27 INS42 INS45 INS42