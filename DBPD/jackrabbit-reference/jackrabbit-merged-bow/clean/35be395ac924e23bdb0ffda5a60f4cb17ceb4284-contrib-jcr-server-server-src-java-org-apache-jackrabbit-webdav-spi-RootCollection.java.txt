- [JCR-84] WebDAV LocatorFactoryImpl$Locator.getHref() constructs root resource URLs incorrectly
- adapting for jcr-locking support
- adding nodetype reports

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@159607 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.spi.version.report.RegisteredNamespacesReport;
+import org.apache.jackrabbit.webdav.spi.version.report.NodeTypesReport;
+import org.apache.jackrabbit.webdav.version.report.SupportedReportSetProperty;
+import org.apache.jackrabbit.webdav.version.report.ReportType;
+import javax.jcr.Session;
+
+    //--------------------------------------------------------------------------
+    /**
+     * @see AbstractResource#initLockSupport()
+     */
+    protected void initLockSupport() {
+        // no locking supported
+    }
+
+    /**
+     * @see AbstractResource#initSupportedReports()
+     */
+    protected void initSupportedReports() {
+        if (exists()) {
+            supportedReports = new SupportedReportSetProperty(new ReportType[] {
+	    ReportType.EXPAND_PROPERTY,
+	    NodeTypesReport.NODETYPES_REPORT,
+	    RegisteredNamespacesReport.REGISTERED_NAMESPACES_REPORT
+            });
+        }
+    }
+
+    /**
+     * Since the root resource does not represent a repository item and therefore
+     * is not member of a workspace resource, the workspace href is calculated
+     * from the workspace name retrieved from the underlaying repository session.
+     *
+     * @return workspace href build from workspace name.
+     * @see AbstractResource#getWorkspaceHref()
+     */
+    protected String getWorkspaceHref() {
+	Session session = this.getRepositorySession();
+	if (session != null) {
+	    String workspaceName = session.getWorkspace().getName();
+	    DavResourceLocator loc = getLocator().getFactory().createResourceLocator(getLocator().getPrefix(), "/"+workspaceName, ItemResourceConstants.ROOT_ITEM_PATH);
+	    return loc.getHref(true);
+	}
+	return null;
+    }

INS26 INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS40 INS31 INS31 INS31 INS29 INS83 INS39 INS42 INS8 INS29 INS83 INS39 INS42 INS8 INS29 INS83 INS43 INS42 INS8 INS65 INS65 INS25 INS65 INS65 INS65 INS42 INS60 INS25 INS41 INS68 INS68 INS32 INS8 INS66 INS66 INS66 INS66 INS68 INS43 INS59 INS27 INS8 INS33 INS42 INS42 INS42 INS42 INS42 INS21 INS42 INS42 INS42 INS42 INS32 INS42 INS33 INS60 INS60 INS41 INS7 INS52 INS42 INS43 INS59 INS43 INS59 INS32 INS42 INS14 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS9 INS43 INS3 INS32 INS42 INS32 INS42 INS32 INS27 INS40 INS42 INS5 INS4 INS42 INS42 INS32 INS42 INS32 INS42 INS45 INS42 INS43 INS85 INS40 INS40 INS40 INS42 INS42 INS42