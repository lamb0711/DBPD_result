Fixed deadlock issue.
- introduced separate monitor for item state cache operations
- removed synchronized() where not needed and added comment


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@159676 13f79535-47bb-0310-9956-ffa450edef68

-        // check cache
-        if (isCached(id)) {
-            return (PropertyState) retrieve(id);
-        }
-
-    public synchronized ItemState getItemState(ItemId id)
+    public ItemState getItemState(ItemId id)
-        // check cache
-        if (isCached(id)) {
-            return retrieve(id);
-        }
+        // check cache. synchronized to ensure an entry is not created twice.
+        synchronized (cacheMonitor) {
+            if (isCached(id)) {
+                return retrieve(id);
+            }
-        // regular behaviour
-        if (id.denotesNode()) {
-            return getNodeState((NodeId) id);
-        } else {
-            return getPropertyState((PropertyId) id);
+            // regular behaviour
+            if (id.denotesNode()) {
+                return getNodeState((NodeId) id);
+            } else {
+                return getPropertyState((PropertyId) id);
+            }
-    public synchronized NodeReferences getNodeReferences(NodeReferencesId id)
+    public NodeReferences getNodeReferences(NodeReferencesId id)
+
+

INS51 INS42 INS8 MOV25 MOV25 DEL42 DEL42 DEL32 DEL42 DEL43 DEL42 DEL42 DEL32 DEL11 DEL41 DEL8 DEL25 DEL83 DEL83