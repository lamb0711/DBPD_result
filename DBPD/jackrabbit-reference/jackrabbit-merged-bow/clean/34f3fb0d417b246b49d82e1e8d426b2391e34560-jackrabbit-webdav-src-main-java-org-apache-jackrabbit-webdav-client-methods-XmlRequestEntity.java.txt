JCR-1310: Webdav: Drop xerces dependency
    - Removed Xerces dependency from jackrabbit-webdav.
    - Using SerializingContentHandler from jackrabbit-jcr-commons (JCR-1350)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@659084 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.ByteArrayOutputStream;
+import java.io.IOException;
+import java.io.OutputStream;
+
+import javax.xml.transform.Transformer;
+import javax.xml.transform.TransformerException;
+import javax.xml.transform.TransformerFactory;
+import javax.xml.transform.dom.DOMSource;
+import javax.xml.transform.sax.SAXResult;
+
+import org.apache.commons.httpclient.methods.RequestEntity;
+import org.apache.jackrabbit.commons.xml.SerializingContentHandler;
-import org.apache.commons.httpclient.methods.RequestEntity;
-import org.apache.commons.httpclient.methods.StringRequestEntity;
-import org.apache.xml.serialize.OutputFormat;
-import org.apache.xml.serialize.XMLSerializer;
-
-import java.io.OutputStream;
-import java.io.IOException;
-import java.io.ByteArrayOutputStream;
+import org.xml.sax.ContentHandler;
+import org.xml.sax.SAXException;
-    private final RequestEntity delegatee;
+    private final ByteArrayOutputStream xml = new ByteArrayOutputStream();
-        super();
-        ByteArrayOutputStream out = new ByteArrayOutputStream();
-        OutputFormat format = new OutputFormat("xml", "UTF-8", false);
-        XMLSerializer serializer = new XMLSerializer(out, format);
-        serializer.setNamespaces(true);
-        serializer.asDOMSerializer().serialize(xmlDocument);
-        delegatee = new StringRequestEntity(out.toString(), "text/xml", "UTF-8");
+        try {
+            ContentHandler handler =
+                SerializingContentHandler.getSerializer(xml);
+            TransformerFactory factory = TransformerFactory.newInstance();
+            Transformer transformer = factory.newTransformer();
+            transformer.transform(
+                    new DOMSource(xmlDocument), new SAXResult(handler));
+        } catch (TransformerException e) {
+            log.error(e.getMessage());
+            throw new IOException(e.getMessage());
+        } catch (SAXException e) {
+            log.error(e.getMessage());
+            throw new IOException(e.getMessage());
+        }
-        return delegatee.isRepeatable();
+        return true;
-        return delegatee.getContentType();
+        return "text/xml"; // TODO: Shouldn't this be application/xml?
-        delegatee.writeRequest(out);
+        xml.writeTo(out);
-        return delegatee.getContentLength();
+        return xml.size();
+

MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 INS26 INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS40 UPD40 UPD40 UPD40 MOV43 MOV59 UPD42 INS54 INS8 INS12 INS12 INS9 INS45 MOV60 MOV60 MOV60 MOV21 INS44 INS8 INS44 INS8 UPD42 UPD42 UPD42 UPD42 INS43 INS59 UPD43 UPD43 INS43 INS42 MOV21 INS53 INS43 INS42 INS21 INS53 INS42 INS42 INS32 UPD42 UPD42 INS32 UPD42 UPD42 INS32 UPD42 UPD42 INS14 INS14 INS42 INS14 INS42 INS32 INS14 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS42 INS43 INS42 UPD42 MOV42 UPD42 MOV42 INS32 INS43 INS32 INS42 INS42 INS32 UPD43 MOV43 MOV32 INS42 INS42 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS42 INS42 INS42 UPD42 UPD42 UPD42 DEL42 DEL43 DEL42 DEL59 DEL42 DEL43 DEL45 DEL45 DEL9 DEL14 DEL42 DEL43 DEL42 DEL42 DEL14 DEL9 DEL32 DEL46 DEL42 DEL45 DEL45 DEL14 DEL7 DEL21 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32