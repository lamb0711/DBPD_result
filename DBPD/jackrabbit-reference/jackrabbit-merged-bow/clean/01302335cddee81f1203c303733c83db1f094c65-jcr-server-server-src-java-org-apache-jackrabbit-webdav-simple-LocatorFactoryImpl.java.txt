JCR-417 (preparation):
- add AbstractLocatorFactory
- add separate loc-factory to simple project => reducing dependency
  to 'jcr' package.

JCR-544
- add separate workspace resource representing the jcr workspace
- move Workspace.restore call to workspace resource.
- consequently RootItemCollection not used any more

minor improvements
- root, workspace resource must not support 'observation' -> moving
  constant to item-resources
- get rid of 'setModificationTime'



git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@448257 13f79535-47bb-0310-9956-ffa450edef68

-        String rPrefix = prefix + repositoryPrefix;
-        String escPath = href;
-        // remove the configured repository prefix from the path
-        if (escPath != null && escPath.startsWith(repositoryPrefix)) {
-            escPath = escPath.substring(repositoryPrefix.length());
+        // build prefix string and remove all prefixes from the given href.
+        StringBuffer b = new StringBuffer("");
+        if (prefix != null && prefix.length() > 0) {
+            b.append(prefix);
+            if (href.startsWith(prefix)) {
+                href = href.substring(prefix.length());
+            }
+        if (repositoryPrefix != null && repositoryPrefix.length() > 0 && !prefix.endsWith(repositoryPrefix)) {
+            b.append(repositoryPrefix);
+            if (href.startsWith(repositoryPrefix)) {
+                href = href.substring(repositoryPrefix.length());
+            }
+        }
+
-        if (escPath == null || "".equals(escPath)) {
-            escPath = "/";
+        if (href == null || "".equals(href)) {
+            href = "/";
-        return new Locator(rPrefix, Text.unescape(escPath), this);
+        return new Locator(b.toString(), Text.unescape(href), this);

INS60 INS25 INS25 UPD43 MOV43 INS59 INS27 INS8 INS27 INS8 UPD42 INS42 INS14 INS27 INS27 INS21 INS25 INS27 INS38 INS21 MOV25 INS32 INS43 INS45 INS42 INS33 INS32 INS34 INS32 INS32 INS8 INS27 INS27 INS32 INS32 INS32 UPD42 UPD42 INS42 INS42 UPD42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS21 INS42 INS33 INS32 INS34 INS42 INS42 INS42 INS42 INS42 INS42 UPD42 MOV42 MOV42 MOV42 UPD42 INS7 INS42 INS42 INS42 INS32 UPD42 INS42 INS42 INS32 UPD42 INS42 INS42 DEL42 DEL33 DEL27 DEL32 DEL27 DEL42 DEL42 DEL42 DEL27 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL59 DEL60 DEL42