JCR-2144 InternalValue refactoring

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@784013 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.ValueFactory;
+import org.apache.jackrabbit.core.value.InternalValueFactory;
+import org.apache.jackrabbit.core.value.ValueFactoryImpl;
+import org.apache.jackrabbit.spi.commons.value.ValueFactoryQImpl;
- * Prints node type defs in a compact notation
+ * Prints node type defs in a compact notation.
+ * All used namespace declarations are also written.
-        this(out, r, npResolver, false);
-    }
-
-    /**
-     * Creates a new nodetype writer
-     *
-     * @param out the underlaying writer
-     * @param r the naespace resolver
-     * @param npResolver
-     * @param includeNS if <code>true</code> all used namespace decl. are also
-     */
-    public CompactNodeTypeDefWriter(Writer out, NamespaceResolver r, NamePathResolver npResolver, boolean includeNS) {
-        if (includeNS) {
-            this.out = new StringWriter();
-            this.nsWriter = out;
-        } else {
-            this.out = out;
-            this.nsWriter = null;
-        }
+        this.out = new StringWriter();
+        this.nsWriter = out;
-        CompactNodeTypeDefWriter w = new CompactNodeTypeDefWriter(out, r, npResolver, true);
+        CompactNodeTypeDefWriter w = new CompactNodeTypeDefWriter(out, r, npResolver);
-        
+
+            ValueFactoryQImpl factory = ValueFactoryImpl.getInstance(npResolver);
-                    out.write(escape(dva[i].toJCRValue(npResolver).getString()));
+                    InternalValue v = dva[i];
+                    out.write(escape(factory.createValue(v).getString()));

INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 MOV29 MOV8 UPD66 INS66 MOV21 MOV21 MOV43 INS60 MOV43 INS43 INS59 INS42 INS42 INS32 INS42 INS42 INS42 INS60 INS43 INS59 INS42 INS42 MOV2 INS42 UPD42 UPD42 DEL83 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL9 DEL17 DEL8 DEL31 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL65 DEL42 DEL66 DEL65 DEL29 DEL39 DEL42 DEL44 DEL42 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL52 DEL42 DEL22 DEL33 DEL7 DEL21 DEL8 DEL25 DEL8 DEL9