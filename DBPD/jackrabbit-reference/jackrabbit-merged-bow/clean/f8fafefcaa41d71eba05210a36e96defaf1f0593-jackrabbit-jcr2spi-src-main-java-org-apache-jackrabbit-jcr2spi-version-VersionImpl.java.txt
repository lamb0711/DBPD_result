JCR-2104: JSR 283 Versioning
   - VersionHistory.getAllFrozenNodes()  (move iteratoradaptor from core to jcr-commons), VersionHistory.getVersionableIdentifier()
   - Version.getFrozenNode, Version.getLinearPredecessor()
   - VersionManager (work in progress): 170-methods, shallow merge, checkpoint
      -> extend SPI interfaces accordingly

JCR-2003: JCR2SPI / SPI: Add support for JCR 2.0
   - Session.hasPermission()
   - Node.getProperties/getNodes with glob
   - Node.getIdentifier()

JCR-2004: Update SPI locking to match JCR 2.0
   - separate JCR LockManager from the internal lock manager

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@773828 13f79535-47bb-0310-9956-ffa450edef68

+     * @see Version#getLinearSuccessor()
+     */
+    public Version getLinearSuccessor() throws RepositoryException {
+        // TODO
+        throw new UnsupportedRepositoryOperationException("JCR-1104");
+    }
+    
+    /**
-     * @see Version#getFrozenNode()
-     */
-    public Node getFrozenNode() throws RepositoryException {
-        // TODO
-        throw new UnsupportedRepositoryOperationException("JCR-1104");
-    }
-
-    /**
-        // TODO
-        throw new UnsupportedRepositoryOperationException("JCR-1104");
+        Value[] values = getProperty(NameConstants.JCR_PREDECESSORS).getValues();
+        if (values != null && values.length > 0) {
+            Node n = session.getNodeByUUID(values[0].getString());
+            if (n instanceof Version) {
+                return (Version) n;
+            } else {
+                throw new RepositoryException("Version property contains invalid value not pointing to a 'Version'");
+            }
+        } else {
+            return null;
+        }
-     * @see Version#getLinearSuccessor()
+     * @see Version#getFrozenNode()
-    public Version getLinearSuccessor() throws RepositoryException {
-        // TODO
-        throw new UnsupportedRepositoryOperationException("JCR-1104");
+    public Node getFrozenNode() throws RepositoryException {
+        return getNode(NameConstants.JCR_FROZENNODE, 1);
+

MOV31 MOV31 INS8 INS60 INS25 INS41 INS5 INS59 INS27 INS8 INS8 INS32 INS43 INS85 INS42 INS32 INS27 INS27 INS60 INS25 INS41 INS42 INS40 INS34 INS42 INS32 INS42 INS42 INS33 INS40 INS34 INS43 INS59 INS62 INS8 INS8 INS33 INS42 INS40 INS42 INS42 INS32 INS42 INS43 INS41 MOV53 INS42 INS42 INS32 INS42 INS11 INS2 INS42 INS43 INS42 UPD43 UPD45 INS42 INS34 INS42 UPD42 DEL8 DEL42 DEL43 DEL45 DEL14 DEL53