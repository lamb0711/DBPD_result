JCR-1318: Repository Home locked not released despite RepositoryException being thrown.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@613160 13f79535-47bb-0310-9956-ffa450edef68

+        boolean succeeded = false;
+
+            succeeded = true;
+            log.info("Repository started");
+        } finally {
+            if (!succeeded) {
+                // repository startup failed, clean up...
+                shutdown();
+            }
-
-        log.info("Repository started");
-        try {
-            vMgr.close();
-        } catch (Exception e) {
-            log.error("Error while closing Version Manager.", e);
+        if (vMgr != null) {
+            try {
+                vMgr.close();
+            } catch (Exception e) {
+                log.error("Error while closing Version Manager.", e);
+            }
-        // persist repository properties
-        try {
-            storeRepProps(repProps);
-        } catch (RepositoryException e) {
-            log.error("failed to persist repository properties", e);
+        if (repProps != null) {
+            // persist repository properties
+            try {
+                storeRepProps(repProps);
+            } catch (RepositoryException e) {
+                log.error("failed to persist repository properties", e);
+            }
-        try {
-            // close repository file system
-            repStore.close();
-        } catch (FileSystemException e) {
-            log.error("error while closing repository file system", e);
+        if (repStore != null) {
+            try {
+                // close repository file system
+                repStore.close();
+            } catch (FileSystemException e) {
+                log.error("error while closing repository file system", e);
+            }

INS60 INS25 INS25 INS25 INS39 INS59 INS8 INS27 INS8 INS27 INS8 INS27 INS8 INS42 INS9 INS21 MOV21 INS25 INS42 INS33 MOV54 INS42 INS33 MOV54 INS42 INS33 MOV54 INS7 INS38 INS8 INS42 INS9 INS42 INS21 INS32 INS42