JCR-2762: Optimize bundle serialization

Since practically all of the names in the standard JCR namespaces are already included in BundleNames, we can use the namespace index field more efficiently to avoid duplicate serialization of most custom namespace URIs.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1022486 13f79535-47bb-0310-9956-ffa450edef68

- * Static collection of common JCR names and namespaces. This class is
- * used by the {@link BundleWriter} and {@link BundleReader} classes to
- * optimize the serialization of names used in bundles.
+ * Static collection of common JCR names. This class is used by the
+ * {@link BundleWriter} and {@link BundleReader} classes to optimize the
+ * serialization of names used in bundles.
-    /**
-     * Static list of standard namespaces.
-     */
-    private static final String[] NAMESPACE_ARRAY = {
-        // WARNING: Only edit if you really know what you're doing!
-        Name.NS_DEFAULT_URI,
-        Name.NS_JCR_URI,
-        Name.NS_MIX_URI,
-        Name.NS_NT_URI,
-        Name.NS_XMLNS_URI,
-        Name.NS_XML_URI,
-        Name.NS_REP_URI
-    };  // WARNING: Only edit if you really know what you're doing!
-
-    private static final Map<String, Integer> NAMESPACE_MAP =
-        new HashMap<String, Integer>();
-
-        assert NAME_ARRAY.length < 0x80;
+        assert NAME_ARRAY.length <= 0x80;
-
-        assert NAMESPACE_ARRAY.length < 0x08;
-        for (int i = 0; i < NAMESPACE_ARRAY.length; i++) {
-            NAMESPACE_MAP.put(NAMESPACE_ARRAY[i], i);
-        }
-    /**
-     * Returns the three-bit index (0-6) of a common JCR namespace,
-     * or -1 if the given namespace URI is not known.
-     *
-     * @param uri namespace URI
-     * @return three-bit index of the namespace, or -1
-     */
-    public static int namespaceToIndex(String uri) {
-        Integer index = NAMESPACE_MAP.get(uri);
-        if (index != null) {
-            return index;
-        } else {
-            return -1;
-        }
-    }
-
-    public static String indexToNamespace(int index) throws IOException {
-        try {
-            return NAMESPACE_ARRAY[index];
-        } catch (ArrayIndexOutOfBoundsException e) {
-            throw new IOExceptionWithCause(
-                    "Invalid common JCR namespace index: " + index, e);
-        }
-    }
-

UPD66 UPD66 UPD66 UPD27 DEL66 DEL66 DEL65 DEL29 DEL83 DEL83 DEL83 DEL42 DEL43 DEL85 DEL5 DEL42 DEL40 DEL40 DEL40 DEL40 DEL40 DEL40 DEL40 DEL4 DEL59 DEL23 DEL83 DEL83 DEL83 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL74 DEL14 DEL59 DEL23 DEL40 DEL34 DEL27 DEL6 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL40 DEL27 DEL42 DEL37 DEL42 DEL42 DEL42 DEL42 DEL2 DEL42 DEL32 DEL21 DEL8 DEL24 DEL66 DEL66 DEL65 DEL42 DEL66 DEL65 DEL66 DEL65 DEL29 DEL83 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL42 DEL41 DEL8 DEL34 DEL38 DEL41 DEL8 DEL25 DEL8 DEL31 DEL83 DEL83 DEL42 DEL43 DEL42 DEL39 DEL42 DEL44 DEL42 DEL43 DEL42 DEL42 DEL2 DEL41 DEL8 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL45 DEL42 DEL27 DEL42 DEL14 DEL53 DEL8 DEL12 DEL54 DEL8 DEL31