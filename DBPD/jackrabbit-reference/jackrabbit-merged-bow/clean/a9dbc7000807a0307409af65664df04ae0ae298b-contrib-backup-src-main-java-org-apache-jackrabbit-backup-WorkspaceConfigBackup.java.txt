JCR-442: Committed patch-060808-backup.txt from Nicolas.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@429606 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.zip.ZipException;
-import javax.jcr.SimpleCredentials;
+
+import org.apache.jackrabbit.core.config.ConfigurationException;
+import org.apache.jackrabbit.core.config.RepositoryConfig;
-import org.apache.jackrabbit.backup.Backup;
-    private static int called = 0;
-    
+
-    public WorkspaceConfigBackup(RepositoryImpl repo, BackupConfig conf, String name) throws LoginException, RepositoryException {
-        super(repo, conf);
+    public WorkspaceConfigBackup(RepositoryImpl repo, BackupConfig conf, String name, String login, String password) throws LoginException, RepositoryException {
+        super(repo, conf, login, password);
-    public void init(RepositoryImpl repo, BackupConfig conf, String name) throws LoginException, RepositoryException {
-        super.init(repo, conf);
+    public void init(RepositoryImpl repo, BackupConfig conf, String name, String login, String password) throws LoginException, RepositoryException {
+        super.init(repo, conf, login, password);
-        Session s = repo.login(new SimpleCredentials(this.conf.getLogin(), this.conf.getPassword().toCharArray()), this.wspName);
-     
+        Session s = this.getRepo().login(this.getCredentials(), this.wspName);
+
-        
+
-        h.write("WspConf" + called , wspXml);
-        called += 1;
+        h.write("WspConf_" + this.wspName , wspXml);
-    public void restore(BackupIOHandler h) {
-        // TODO Auto-generated method stub
+    public void restore(BackupIOHandler h) throws ConfigurationException, ZipException, IOException {
+        //Replace workspace.xml if needed
+        File wspXml = new File(this.getConf().getWorkFolder() + "/workspace.xml");
+        h.read("WspConf_" + this.wspName, wspXml);
-

MOV26 MOV26 INS26 UPD40 INS40 UPD40 INS44 INS44 INS44 INS44 INS43 INS43 INS43 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS42 INS42 INS42 INS60 INS21 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS59 INS32 INS42 INS42 INS42 INS42 INS14 INS42 INS42 INS27 INS42 INS32 UPD42 MOV42 MOV32 UPD45 INS22 INS43 INS27 INS45 INS22 INS52 INS42 INS52 UPD42 INS52 INS42 INS42 INS32 INS45 INS52 INS42 INS32 INS42 INS52 INS42 DEL83 DEL83 DEL39 DEL42 DEL34 DEL59 DEL23 DEL52 DEL42 DEL22 DEL42 DEL42 DEL42 DEL43 DEL52 DEL42 DEL22 DEL32 DEL42 DEL32 DEL14 DEL42 DEL42 DEL34 DEL7 DEL21