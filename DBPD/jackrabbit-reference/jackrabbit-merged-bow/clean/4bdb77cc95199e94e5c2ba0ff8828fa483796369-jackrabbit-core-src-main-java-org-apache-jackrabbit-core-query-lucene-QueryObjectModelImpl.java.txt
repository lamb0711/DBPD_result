JCR-2715: Improved join query performance

Extend LuceneQueryFactory to handle more QOM constraints.
Simplify handling of bind variables.
Improve OperandEvaluator, including its javadocs.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1026361 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashMap;
+import java.util.Map;
+import javax.jcr.Value;
-        super(sessionContext, index, propReg);
+        super(sessionContext, index, propReg, extractBindVariables(qomTree));
-        extractBindVariableNames();
-                getBindVariableValues());
+                getBindVariables());
-                    getBindVariableValues(), qomTree.getSource().getSelectors(),
+                    getBindVariables(), qomTree.getSource().getSelectors(),
-    private void extractBindVariableNames() {
+    private static Map<String, Value> extractBindVariables(
+            QueryObjectModelTree qomTree) {
+        final Map<String, Value> variables = new HashMap<String, Value>();
-                    addVariableName(node.getBindVariableQName());
+                    variables.put(node.getBindVariableName(), null);
+        return variables;

INS26 INS26 INS26 INS40 INS40 INS40 INS83 INS74 UPD42 INS44 INS46 INS43 INS43 INS43 INS43 INS42 INS60 INS41 MOV42 MOV42 MOV42 INS32 INS42 INS42 INS42 INS42 INS83 INS74 INS59 INS42 UPD42 MOV42 INS42 INS43 INS43 INS43 INS42 INS14 INS42 INS42 INS42 INS74 UPD42 INS43 INS43 INS43 INS42 INS42 INS42 UPD42 UPD42 INS42 INS33 UPD42 DEL46 DEL32 DEL21 DEL39