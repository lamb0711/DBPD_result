JCR-3162 Index update overhead on cluster slave due to JCR-905
 - and we are back!

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1214842 13f79535-47bb-0310-9956-ffa450edef68

-        IndexingQueueStore store = new IndexingQueueStore(indexDir);
-
-        this.indexingQueue = new IndexingQueue(store);
+        this.indexingQueue = new IndexingQueue(new IndexingQueueStore(indexDir));
-        for (Iterator<?> it = indexNames.iterator(); it.hasNext(); ) {
-            IndexInfo info = (IndexInfo) it.next();
+        Iterator<IndexInfo> iterator = indexNames.iterator();
+        while (iterator.hasNext()) {
+            IndexInfo info = iterator.next();
+                checkIndexingQueue(true);
-                scheduleFlushTask();
+                safeFlush();
+                scheduleFlushTask();
-        if (volatileIndex.getNumDocuments() > 0) {
+        int volatileIndexDocuments = volatileIndex.getNumDocuments();
+        if (volatileIndexDocuments > 0) {
-            log.debug("Committed in-memory index in " + time + "ms.");
+            log.debug("Committed in-memory index containing {} documents in {}ms.", volatileIndexDocuments, time);
-    
+

MOV60 INS61 INS60 UPD74 MOV74 MOV59 INS32 MOV8 INS39 INS59 MOV43 UPD42 UPD42 MOV42 MOV42 INS42 MOV32 INS42 MOV14 INS32 INS21 INS21 MOV21 INS45 INS42 INS42 UPD42 MOV42 MOV42 INS32 INS32 INS42 INS9 INS42 DEL42 DEL76 DEL42 DEL43 DEL42 DEL59 DEL32 DEL11 DEL58 DEL32 DEL24 DEL45 DEL42 DEL45 DEL27