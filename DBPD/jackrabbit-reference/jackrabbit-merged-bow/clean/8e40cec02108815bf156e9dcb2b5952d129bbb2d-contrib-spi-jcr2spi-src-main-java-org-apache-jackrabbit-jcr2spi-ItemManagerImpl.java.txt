div

- get rid of rootId stored with ISM, HierarchyManagers etc.
- remove corresponding method with WorkspaceManager and WorkspaceImpl

jcr2spi/state/ItemState

- move parent field from Node/PropertyState to ItemState
- move idFactory field from NodeState to ItemState
- let PropertyState build its id instead of calling parentstate method.
- minor reordering of status related methods
- remove modCount and its usage

jcr2spi/state/ItemStateManager

- add method getRootNode()

jcr2spi/security/AccessManager

- replace ItemId by ItemState

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@431352 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.jcr2spi.state.ItemStateException;
-import org.apache.jackrabbit.spi.NodeId;
-import org.apache.jackrabbit.spi.ItemId;
-import org.apache.jackrabbit.spi.PropertyId;
-     * // DIFF JR:
+     * 
-            ChildNodeEntry entry = (ChildNodeEntry) iter.next();
-            NodeId id = entry.getId();
-            // check read access
-            if (session.getAccessManager().canRead(id)) {
-                return true;
+            try {
+                // check read access
+                ChildNodeEntry entry = (ChildNodeEntry) iter.next();
+                if (session.getAccessManager().canRead(entry.getNodeState())) {
+                    return true;
+                }
+            } catch (ItemStateException e) {
+                // should not occur. ignore
+                log.debug("Failed to access node state.", e);
-            ChildPropertyEntry entry = (ChildPropertyEntry) iter.next();
-            PropertyId id = entry.getId();
-            // check read access
-            if (session.getAccessManager().canRead(id)) {
-                return true;
+            try {
+                ChildPropertyEntry entry = (ChildPropertyEntry) iter.next();
+                // check read access
+                if (session.getAccessManager().canRead(entry.getPropertyState())) {
+                    return true;
+                }
+            } catch (ItemStateException e) {
+                // should not occur. ignore
+                log.debug("Failed to access node state.", e);
-
-        ItemId id = state.getId();
-        if (!session.getAccessManager().canRead(id)) {
+        if (!session.getAccessManager().canRead(state)) {
-            throw new AccessDeniedException("cannot read item " + id);
+            throw new AccessDeniedException("cannot read item " + state.getId());

MOV26 UPD40 INS8 INS8 INS54 INS54 MOV8 INS12 MOV8 INS12 UPD42 INS44 INS8 INS44 INS8 INS43 INS42 INS21 INS43 INS42 INS21 MOV32 INS32 INS42 INS32 INS32 INS42 INS32 UPD42 MOV42 INS42 INS42 INS42 INS45 INS42 UPD42 MOV42 INS42 INS42 INS42 INS45 INS42 DEL40 DEL26 DEL40 DEL26 DEL66 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL43 DEL42 DEL59 DEL60 DEL42