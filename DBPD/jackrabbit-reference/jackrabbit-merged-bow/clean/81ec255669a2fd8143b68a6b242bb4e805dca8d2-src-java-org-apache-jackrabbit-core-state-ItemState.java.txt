- cleaned up XMLPersistenceManager
- ItemState#modCount is now persisted

see http://thread.gmane.org/gmane.comp.apache.jackrabbit.devel/4137


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@329841 13f79535-47bb-0310-9956-ffa450edef68

-    private static long LAST_MOD_COUNT = 1;
-
-    private transient long modCount;
+    /**
+     * a modification counter used to prevent concurrent modifications
+     */
+    private short modCount;
-     * Returns the modification count.
-     * @return the modification count.
-     */
-    long getModCount() {
-        return modCount;
-    }
-
-    /**
-     * Updates the modification count.
-     */
-    void touch() {
-        synchronized (ItemState.class) {
-            modCount = LAST_MOD_COUNT++;
-        }
-    }
-
-    /**
-            // ...but still keep reference to overlayed state to allow
-            // reconnecting at a later stage and to make sure
-            // it is not accidentally collected by the gc
-            //overlayedState = null;
+            overlayedState = null;
+     * Returns the modification count.
+     *
+     * @return the modification count.
+     */
+    public short getModCount() {
+        return modCount;
+    }
+
+    /**
+     * Sets the modification count.
+     *
+     * @param modCount the modification count of this item
+     */
+    public void setModCount(short modCount) {
+        this.modCount = modCount;
+    }
+
+    /**
+     * Updates the modification count.
+     */
+    synchronized void touch() {
+        modCount++;
+    }
+
+    /**

MOV31 MOV31 INS23 INS31 INS29 MOV83 INS39 MOV59 INS83 UPD39 INS29 INS83 INS39 INS42 INS44 INS8 INS83 INS8 INS65 INS65 INS65 INS39 INS42 INS21 MOV21 INS66 INS66 INS42 INS66 INS7 INS37 INS21 INS22 INS42 UPD42 MOV42 INS7 INS52 INS42 INS42 INS33 DEL83 DEL39 DEL42 DEL34 DEL59 DEL23 DEL83 DEL83 DEL39 DEL23 DEL42 DEL37 DEL7 DEL42 DEL43 DEL57 DEL8 DEL51 DEL8