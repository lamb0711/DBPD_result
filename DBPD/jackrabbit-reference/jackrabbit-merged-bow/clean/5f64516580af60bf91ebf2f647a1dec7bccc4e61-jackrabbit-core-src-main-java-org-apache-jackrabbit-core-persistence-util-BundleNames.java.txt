JCR-2762: Optimize bundle serialization

Add common names used by the access control features. Reorder names by popularity.

Rename read/writeInt() to read/writeVarInt() as suggested by Thomas. Remove recursion from writeVarInt().

Minor optimizations in read/writeName(), including a fix to the case where the local name is more than 15 characters long.

Extend the use of read/writeVarInt() and read/writeString() to more places in the code.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1022488 13f79535-47bb-0310-9956-ffa450edef68

-
-        NameConstants.JCR_ACTIVITIES,
-        NameConstants.JCR_ACTIVITY,
-        NameConstants.JCR_ACTIVITY_TITLE,
-        NameConstants.JCR_AUTOCREATED,
-        NameConstants.JCR_BASEVERSION,
-        NameConstants.JCR_CHILDNODEDEFINITION,
-        NameConstants.JCR_CHILDVERSIONHISTORY,
-        NameConstants.JCR_CONFIGURATION,
-        NameConstants.JCR_CONFIGURATIONS,
-        NameConstants.JCR_CONTENT,
-        NameConstants.JCR_COPIEDFROM,
+        // Most frequently used names
+        NameConstants.NT_UNSTRUCTURED,
+        NameConstants.NT_RESOURCE,
+        NameConstants.NT_FILE,
+        NameConstants.NT_FOLDER,
+        NameConstants.NT_HIERARCHYNODE,
+        NameConstants.MIX_REFERENCEABLE,
-        NameConstants.JCR_CURRENT_LIFECYCLE_STATE,
-        NameConstants.JCR_DATA,
-        NameConstants.JCR_DEFAULTPRIMARYTYPE,
-        NameConstants.JCR_DEFAULTVALUES,
-        NameConstants.JCR_ENCODING,
-        NameConstants.JCR_ETAG,
-        NameConstants.JCR_FROZENMIXINTYPES,
-        NameConstants.JCR_FROZENNODE,
-        NameConstants.JCR_FROZENPRIMARYTYPE,
-        NameConstants.JCR_FROZENUUID,
-        NameConstants.JCR_HASORDERABLECHILDNODES,
-        NameConstants.JCR_HOST,
-        NameConstants.JCR_ID,
-        NameConstants.JCR_ISCHECKEDOUT,
-        NameConstants.JCR_ISMIXIN,
-        NameConstants.JCR_LANGUAGE,
-        NameConstants.JCR_LIFECYCLE_POLICY,
+        NameConstants.JCR_CONTENT,
+        NameConstants.JCR_MIMETYPE,
+        NameConstants.JCR_DATA,
+        NameConstants.JCR_TITLE,
+        NameConstants.JCR_LANGUAGE,
+        NameConstants.JCR_ENCODING,
+        NameConstants.JCR_SYSTEM,
+        NameConstants.REP_ROOT,
+        NameConstants.REP_SYSTEM,
+
+        // Access control
+        NameConstants.JCR_ADD_CHILD_NODES,
+        NameConstants.JCR_LIFECYCLE_MANAGEMENT,
+        NameConstants.JCR_LOCK_MANAGEMENT,
+        NameConstants.JCR_MODIFY_ACCESS_CONTROL,
+        NameConstants.JCR_MODIFY_PROPERTIES,
+        NameConstants.JCR_NODE_TYPE_MANAGEMENT,
+        NameConstants.JCR_READ,
+        NameConstants.JCR_READ_ACCESS_CONTROL,
+        NameConstants.JCR_REMOVE_CHILD_NODES,
+        NameConstants.JCR_REMOVE_NODE,
+        NameConstants.JCR_VERSION_MANAGEMENT,
+        NameConstants.REP_ACCESSCONTROL,
+        NameConstants.REP_ACCESS_CONTROL,
+        NameConstants.REP_ACCESS_CONTROLLABLE,
+        NameConstants.REP_ACE,
+        NameConstants.REP_ACL,
+        NameConstants.REP_DENY_ACE,
+        NameConstants.REP_GLOB,
+        NameConstants.REP_GRANT_ACE,
+        NameConstants.REP_POLICY,
+        NameConstants.REP_PRINCIPAL_ACCESS_CONTROL,
+        NameConstants.REP_PRINCIPAL_NAME,
+        NameConstants.REP_PRIVILEGES,
+
+        // Locking
+        NameConstants.MIX_LOCKABLE,
-        NameConstants.JCR_MANDATORY,
-        NameConstants.JCR_MERGEFAILED,
-        NameConstants.JCR_MIMETYPE,
-        NameConstants.JCR_MIXINTYPES,
-        NameConstants.JCR_MULTIPLE,
-        NameConstants.JCR_NAME,
-        NameConstants.JCR_NODETYPENAME,
-        NameConstants.JCR_NODETYPES,
-        NameConstants.JCR_ONPARENTVERSION,
-        NameConstants.JCR_PATH,
-        NameConstants.JCR_PORT,
-        NameConstants.JCR_PREDECESSORS,
-        NameConstants.JCR_PRIMARYITEMNAME,
-        NameConstants.JCR_PRIMARYTYPE,
-        NameConstants.JCR_PROPERTYDEFINITION,
-        NameConstants.JCR_PROTECTED,
-        NameConstants.JCR_PROTOCOL,
-        NameConstants.JCR_REPOSITORY,
-        NameConstants.JCR_REQUIREDPRIMARYTYPES,
-        NameConstants.JCR_REQUIREDTYPE,
-        NameConstants.JCR_ROOT,
-        NameConstants.JCR_ROOTVERSION,
-        NameConstants.JCR_SAMENAMESIBLINGS,
-        NameConstants.JCR_SCORE,
-        NameConstants.JCR_STATEMENT,
-        NameConstants.JCR_SUCCESSORS,
-        NameConstants.JCR_SUPERTYPES,
-        NameConstants.JCR_SYSTEM,
-        NameConstants.JCR_UUID,
-        NameConstants.JCR_VALUECONSTRAINTS,
-        NameConstants.JCR_VERSIONHISTORY,
-        NameConstants.JCR_VERSIONLABELS,
+
+        // Versioning
+        NameConstants.MIX_VERSIONABLE,
+        NameConstants.NT_FROZENNODE,
+        NameConstants.NT_VERSION,
+        NameConstants.NT_VERSIONEDCHILD,
+        NameConstants.NT_VERSIONHISTORY,
+        NameConstants.NT_VERSIONLABELS,
+        NameConstants.JCR_FROZENPRIMARYTYPE,
+        NameConstants.JCR_FROZENUUID,
+        NameConstants.JCR_FROZENNODE,
+        NameConstants.JCR_PREDECESSORS,
+        NameConstants.JCR_SUCCESSORS,
+        NameConstants.JCR_VERSIONLABELS,
+        NameConstants.JCR_VERSIONHISTORY,
-        NameConstants.JCR_WORKSPACE,
-        NameConstants.JCR_XMLCHARACTERS,
-        NameConstants.JCR_XMLTEXT,
+        NameConstants.JCR_ROOTVERSION,
+        NameConstants.JCR_ISCHECKEDOUT,
+        NameConstants.JCR_BASEVERSION,
+        NameConstants.JCR_MERGEFAILED,
+        NameConstants.REP_NODETYPES,
+
+        // Node types
+        NameConstants.NT_NODETYPE,
+        NameConstants.NT_PROPERTYDEFINITION,
+        NameConstants.NT_CHILDNODEDEFINITION,
+        NameConstants.NT_BASE,
+        NameConstants.JCR_NODETYPES,
+        NameConstants.JCR_PROTECTED,
+        NameConstants.JCR_ONPARENTVERSION,
+        NameConstants.JCR_MANDATORY,
+        NameConstants.JCR_AUTOCREATED,
+        NameConstants.JCR_FROZENMIXINTYPES,
+        NameConstants.JCR_NAME,
+        NameConstants.JCR_VALUECONSTRAINTS,
+        NameConstants.JCR_REQUIREDTYPE,
+        NameConstants.JCR_PROPERTYDEFINITION,
+        NameConstants.JCR_MULTIPLE,
+        NameConstants.JCR_DEFAULTVALUES,
+        NameConstants.JCR_SUPERTYPES,
+        NameConstants.JCR_NODETYPENAME,
+        NameConstants.JCR_ISMIXIN,
+        NameConstants.JCR_HASORDERABLECHILDNODES,
+        NameConstants.JCR_SAMENAMESIBLINGS,
+        NameConstants.JCR_REQUIREDPRIMARYTYPES,
+        NameConstants.JCR_CHILDNODEDEFINITION,
+        NameConstants.JCR_DEFAULTPRIMARYTYPE,
+        NameConstants.JCR_PRIMARYITEMNAME,
+        NameConstants.JCR_CHILDVERSIONHISTORY,
+        NameConstants.REP_VERSIONS,
+        NameConstants.REP_VERSIONSTORAGE,
+        NameConstants.REP_VERSION_REFERENCE,
+        NameConstants.REP_BASEVERSIONS,
+
+        // Miscellaneous node types
-        NameConstants.MIX_LOCKABLE,
-        NameConstants.MIX_REFERENCEABLE,
-        NameConstants.MIX_VERSIONABLE,
-        NameConstants.NT_BASE,
-        NameConstants.NT_CHILDNODEDEFINITION,
-        NameConstants.NT_FILE,
-        NameConstants.NT_FOLDER,
-        NameConstants.NT_FROZENNODE,
-        NameConstants.NT_HIERARCHYNODE,
-        NameConstants.NT_NODETYPE,
-        NameConstants.NT_PROPERTYDEFINITION,
-        NameConstants.NT_RESOURCE,
-        NameConstants.NT_UNSTRUCTURED,
-        NameConstants.NT_VERSION,
-        NameConstants.NT_VERSIONEDCHILD,
-        NameConstants.NT_VERSIONHISTORY,
-        NameConstants.NT_VERSIONLABELS,
-        NameConstants.REP_ACTIVITIES,
-        NameConstants.REP_CONFIGURATIONS,
-        NameConstants.REP_VERSION_REFERENCE,
-        NameConstants.REP_BASEVERSIONS,
-        NameConstants.REP_NODETYPES,
-        NameConstants.REP_ROOT,
-        NameConstants.REP_SYSTEM,
-        NameConstants.REP_VERSIONS,
-        NameConstants.REP_VERSIONSTORAGE
-    };  // WARNING: Only edit if you really know what you're doing!
+        // Miscellaneous names
+        NameConstants.REP_ACTIVITIES,
+        NameConstants.JCR_ACTIVITIES,
+        NameConstants.JCR_ACTIVITY,
+        NameConstants.JCR_ACTIVITY_TITLE,
+        NameConstants.JCR_XMLCHARACTERS,
+        NameConstants.JCR_XMLTEXT,
+        NameConstants.REP_CONFIGURATIONS,
+        NameConstants.JCR_CONFIGURATION,
+        NameConstants.JCR_CONFIGURATIONS,
+        NameConstants.JCR_COPIEDFROM,
+        NameConstants.JCR_CURRENT_LIFECYCLE_STATE,
+        NameConstants.JCR_ETAG,
+        NameConstants.JCR_HOST,
+        NameConstants.JCR_ID,
+        NameConstants.JCR_LIFECYCLE_POLICY,
+        NameConstants.JCR_PATH,
+        NameConstants.JCR_STATEMENT,
+
+    };  // WARNING: Only edit if you really know what you're doing!

UPD40 UPD40 UPD40 UPD40 UPD40 INS40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 INS40 INS40 UPD40 UPD40 UPD40 INS40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 INS40 INS40 INS40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 INS40 INS40 INS40 INS40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 INS40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 INS40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 INS40 UPD40 UPD40 UPD40 INS40 UPD40 UPD40