JCR-258 - remove JDOM dependency from jcr-server contribution
JCR-295 - usage of Cache-Control header 
JCR-297 - log output while parsing xml
minor consistency issues and improvements

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@368683 13f79535-47bb-0310-9956-ffa450edef68

-import org.jdom.Element;
+import org.apache.jackrabbit.webdav.xml.XmlSerializable;
+import org.apache.jackrabbit.webdav.xml.DomUtil;
+import org.w3c.dom.Element;
+import org.w3c.dom.Document;
-public class TransactionInfo implements TransactionConstants {
+public class TransactionInfo implements TransactionConstants, XmlSerializable {
-    private Element status;
+    private final boolean isCommit;
+
+    /**
+     * Creates a <code>TransactionInfo</code> object
+     *
+     * @param isCommit
+     */
+    public TransactionInfo(boolean isCommit) {
+        this.isCommit = isCommit;
+    }
-        if (transactionInfo == null || !XML_TRANSACTIONINFO.equals(transactionInfo.getName())) {
+        if (transactionInfo == null || !XML_TRANSACTIONINFO.equals(transactionInfo.getLocalName())) {
-        Element tStatus = transactionInfo.getChild(XML_TRANSACTIONSTATUS, NAMESPACE);
-        if (tStatus == null) {
+        Element txStatus = DomUtil.getChildElement(transactionInfo, XML_TRANSACTIONSTATUS, NAMESPACE);
+        if (txStatus != null) {
+            // retrieve status: commit or rollback
+            isCommit = DomUtil.hasChildElement(txStatus, XML_COMMIT, NAMESPACE);
+        } else {
-
-        // retrieve status: commit or rollback
-        status = tStatus.getChild(XML_COMMIT, NAMESPACE);
-        if (status == null) {
-            status = tStatus.getChild(XML_ROLLBACK, NAMESPACE);
-        }
-
-        if (status == null) {
-            throw new IllegalArgumentException("'jcr:transactionstatus' element must contain either a '" + XML_COMMIT + "' or a '" + XML_ROLLBACK + "' elements.");
-        }
-     * Returns either 'commit' or 'rollback' with are the only allowed status
-     * types.
+     * Returns true, if this info requires a 'commit' action, false otherwise
+     * (i.e. 'rollback' is requested).
-     * @return 'commit' or 'rollback'
+     * @return true if a 'commit' element was present. false otherwise.
-    public String getStatus() {
-        return status.getName();
+    public boolean isCommit() {
+        return isCommit;
+
+    //------------------------------------------< XmlSerializable interface >---
+    /**
+     * @see org.apache.jackrabbit.webdav.xml.XmlSerializable#toXml(Document)
+     * @param document
+     */
+    public Element toXml(Document document) {
+        Element elem = DomUtil.createElement(document, XML_TRANSACTIONINFO, NAMESPACE);
+        Element st = DomUtil.addChildElement(elem, XML_TRANSACTIONSTATUS, NAMESPACE);
+        String lName = (isCommit) ? XML_COMMIT : XML_ROLLBACK;
+        DomUtil.addChildElement(st, lName, NAMESPACE);
+        return elem;
+    }
+

INS26 INS26 INS26 INS40 INS40 UPD40 INS40 INS43 INS31 INS31 INS42 INS83 INS39 INS29 INS83 INS42 INS44 INS8 INS39 UPD42 INS29 INS83 MOV43 INS42 INS44 INS8 UPD42 INS65 INS65 INS39 INS42 INS21 INS65 INS65 INS43 INS42 INS60 INS60 INS60 INS21 INS41 INS66 INS42 INS7 UPD27 MOV8 UPD66 UPD66 UPD66 INS42 INS68 INS42 INS42 INS43 INS59 INS43 INS59 MOV43 INS59 INS32 INS42 INS22 INS42 UPD42 UPD42 INS40 INS42 INS69 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS16 INS42 INS42 INS42 INS42 INS42 INS52 INS42 UPD42 UPD42 INS42 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS36 INS42 INS42 UPD42 INS42 INS42 UPD42 UPD42 UPD42 INS42 UPD42 DEL42 DEL33 DEL27 DEL25 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL7 DEL21 DEL42 DEL33 DEL27 DEL42 DEL43 DEL45 DEL42 DEL45 DEL42 DEL45 DEL27 DEL14 DEL53 DEL8 DEL25 DEL42 DEL42 DEL32