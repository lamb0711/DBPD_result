JCR-1590: JSR 283: Locking

Store lock timeout information along with the lock tokens.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@803882 13f79535-47bb-0310-9956-ffa450edef68

-     * @param lockToken lock token to apply
+     * @param lockTokenLine lock token to apply
-    private void reapplyLock(String lockToken) {
+    private void reapplyLock(String lockTokenLine) {
+        String[] parts = lockTokenLine.split(",");
+        String token = parts[0];
+        long timeoutHint = Long.MAX_VALUE;
+        if (parts.length > 1) {
+            try {
+                timeoutHint = Long.parseLong(parts[1]);
+            } catch (NumberFormatException e) {
+                log.warn("Unexpected timeout hint "
+                        + parts[1] + " for lock token " + token, e);
+            }
+        }
+
-            NodeId id = LockInfo.parseLockToken(lockToken);
+            NodeId id = LockInfo.parseLockToken(parts[0]);
-                    Long.MAX_VALUE);
+                    timeoutHint);
-            log.warn("Unable to recreate lock '" + lockToken
-                    + "': " + e.getMessage());
+            log.warn("Unable to recreate lock '" + token + "': " + e.getMessage());
+
+                // Store the timeout hint, if one is specified
+                if (info.getTimeoutHint() != Long.MAX_VALUE) {
+                    writer.write(',');
+                    writer.write(Long.toString(info.getTimeoutHint()));
+                }
+

UPD42 INS60 INS60 INS60 INS25 UPD42 INS5 INS59 INS43 INS59 INS39 INS59 INS27 INS8 INS43 INS85 INS42 INS32 INS42 INS42 INS2 INS42 INS40 INS40 INS34 INS54 INS42 INS42 INS42 INS45 INS42 INS34 INS8 INS12 INS21 INS44 INS8 INS25 INS7 INS43 INS42 INS21 INS2 INS42 INS27 INS8 INS42 INS32 INS42 INS32 INS42 INS34 UPD42 INS32 INS40 INS21 INS21 INS42 INS42 INS2 INS42 INS42 INS27 INS42 INS42 INS42 INS32 INS32 INS42 INS34 INS45 INS2 INS45 INS42 INS42 INS42 INS13 INS42 INS42 INS32 INS42 INS34 INS42 INS42 INS32 INS42 INS42 DEL42 DEL40