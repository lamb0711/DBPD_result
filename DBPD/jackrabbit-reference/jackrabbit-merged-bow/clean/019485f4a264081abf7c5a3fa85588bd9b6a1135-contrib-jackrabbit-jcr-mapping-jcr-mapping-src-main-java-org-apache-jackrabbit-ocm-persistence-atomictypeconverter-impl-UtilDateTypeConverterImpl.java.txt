
* Review the interface AtomicTypeConverter : rename the method getString into getXPathQueryValue. This method is mainly used by FiterImpl in order to build Xpath query expression based on the object attribute. 
* Solve issue JCR-930 : now dates are not converted in long if UtilDateConverterImpl is used. 

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@544959 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Calendar;
+import javax.jcr.ValueFormatException;
+	
-		}
-		return valueFactory.createValue(((java.util.Date) propValue).getTime());		
+		}		
+		Calendar calendar =  Calendar.getInstance();
+		calendar.setTime((Date) propValue);
+		return valueFactory.createValue(calendar);		
-			long time = value.getLong();
-			return new Date(time);
+			Calendar calendar = value.getDate();
+			return calendar.getTime();
-	public String getStringValue(Object object)
+	public String getXPathQueryValue(ValueFactory valueFactory, Object object)
-		return new Long(((java.util.Date) object).getTime()).toString();
+		try 
+		{
+			Calendar calendar =  Calendar.getInstance();
+			
+			calendar.setTime((Date) object);
+
+			return "xs:dateTime('" + valueFactory.createValue(calendar).getString() + "')";
+
+		} 
+		catch (RepositoryException e) 
+		{
+			throw new IncorrectAtomicTypeException("Impossible to get the sting value ", e);
+		}

INS26 INS26 INS40 INS40 UPD42 INS44 INS8 INS60 INS21 INS41 INS43 INS42 INS54 INS43 INS59 INS32 INS32 INS42 INS8 INS12 INS42 INS42 INS32 INS42 UPD42 MOV42 INS11 INS42 UPD42 MOV42 INS42 INS60 INS21 INS41 INS44 INS8 INS42 INS42 MOV43 MOV42 INS43 INS32 INS43 INS59 INS32 INS27 INS43 INS42 INS53 INS42 UPD42 INS42 INS42 UPD42 MOV42 INS42 INS32 INS42 INS42 INS11 INS45 INS32 INS45 INS42 INS14 UPD42 INS42 INS42 UPD43 MOV43 MOV42 INS32 UPD42 MOV42 INS43 INS45 INS42 INS42 INS42 UPD42 MOV42 INS42 INS42 DEL42 DEL40 DEL11 DEL36 DEL32 DEL32 DEL41 DEL39 DEL42 DEL14 DEL40 DEL43 DEL11 DEL36 DEL32 DEL14 DEL32 DEL41 DEL8