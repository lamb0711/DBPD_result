Removed JDOM dependency from nodetype XML handling (JCR-54)
 - converted all JDOM references to the equivalent standard DOM code
 - Moved the rest of XML references out of the NodeTypeDefStore class
 - Added the NodeTypeFormatter facade class
 - Made a number of small changes and restructurings to better match the DOM API
 - Added a mostly complete test case in src/test/o.a.j/core/nodetype/xml
   (the tests in .../test/api/nodetype are more concerned with the nodetype
   API than the XML handling)
 - Added a simple ValueConstraint.equals() method to simplify the test cases
   (fixes a problem in NodeTypeDef.equals())


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@157940 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Iterator;
+import javax.jcr.NamespaceRegistry;
+import javax.jcr.RepositoryException;
-import org.jdom.Element;
-import org.jdom.Namespace;
+import org.w3c.dom.Attr;
+import org.w3c.dom.Element;
+import org.w3c.dom.NamedNodeMap;
-     * Creates a namespace resolver using the additional namespaces declared
+     * Creates a namespace resolver using the namespaces declared
-        Iterator namespaces = element.getAdditionalNamespaces().iterator();
-        while (namespaces.hasNext()) {
-            Namespace namespace = (Namespace) namespaces.next();
-            addNamespace(namespace.getPrefix(), namespace.getURI());
+        NamedNodeMap attributes = element.getAttributes();
+        for (int i = 0; i < attributes.getLength(); i++) {
+            Attr attribute = (Attr) attributes.item(i);
+            if (Constants.NS_XMLNS_PREFIX.equals(attribute.getPrefix())) {
+                addNamespace(attribute.getLocalName(), attribute.getValue());
+            }
-
+     * Creates a namespace resolver using the namespaces declared
+     * in the given namespace registry.
+     *
+     * @param registry namespace registry
+     * @throws RepositoryException on repository errors
+     */
+    public AdditionalNamespaceResolver(NamespaceRegistry registry)
+            throws RepositoryException {
+        String[] prefixes = registry.getPrefixes();
+        for (int i = 0; i < prefixes.length; i++) {
+            addNamespace(prefixes[i], registry.getURI(prefixes[i]));
+        }
+    }
+
+    /**

MOV26 INS26 INS26 INS40 UPD40 INS40 UPD40 UPD40 INS31 INS29 INS83 INS42 INS44 INS43 INS8 INS24 INS65 INS65 INS65 INS43 INS42 INS42 INS60 INS24 UPD66 UPD43 INS58 INS27 INS37 INS8 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS5 INS59 INS58 INS27 INS37 INS8 UPD42 UPD42 INS32 INS39 INS59 INS42 INS32 INS42 MOV60 INS25 INS43 INS85 INS42 INS32 INS39 INS59 INS42 INS40 INS42 INS21 MOV42 UPD42 MOV42 INS42 INS34 UPD42 MOV42 UPD42 MOV42 UPD43 INS32 INS8 INS42 INS42 INS42 INS42 INS34 INS32 UPD42 UPD42 INS40 INS42 INS32 MOV21 INS42 INS2 INS32 UPD43 INS42 INS42 INS42 INS42 INS42 INS42 INS2 UPD42 UPD42 UPD42 INS42 INS42 INS42 UPD42 UPD42 UPD42 UPD42 DEL32 DEL42 DEL32 DEL32 DEL8 DEL61