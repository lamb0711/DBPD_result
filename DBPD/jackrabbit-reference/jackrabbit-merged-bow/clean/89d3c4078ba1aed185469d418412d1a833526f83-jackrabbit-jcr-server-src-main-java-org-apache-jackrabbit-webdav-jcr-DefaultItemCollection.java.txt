-getLock for resouce locked by deep lock returns null instead of lock
-missing unescape of relpath for Node.orderBefore

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@513275 13f79535-47bb-0310-9956-ffa450edef68

-        if (isLockable(type, scope)) {
-            if (Type.WRITE.equals(type)) {
-                try {
-                    if (!exists()) {
-                        log.warn("Unable to retrieve lock: no item found at '" + getResourcePath() + "'");
-                    } else if (((Node) item).isLocked()) {
-                        Lock jcrLock = ((Node) item).getLock();
-                        lock = new JcrActiveLock(jcrLock);
-                    }
-                } catch (AccessDeniedException e) {
-                    log.error("Error while accessing resource lock: "+e.getMessage());
-                } catch (UnsupportedRepositoryOperationException e) {
-                    log.error("Error while accessing resource lock: "+e.getMessage());
-                } catch (RepositoryException e) {
-                    log.error("Error while accessing resource lock: "+e.getMessage());
+        if (Type.WRITE.equals(type)) {
+            try {
+                if (!exists()) {
+                    log.warn("Unable to retrieve lock: no item found at '" + getResourcePath() + "'");
+                } else if (((Node) item).isLocked()) {
+                    Lock jcrLock = ((Node) item).getLock();
+                    lock = new JcrActiveLock(jcrLock);
-            } else {
-                lock = super.getLock(type, scope);
+            } catch (AccessDeniedException e) {
+                log.error("Error while accessing resource lock: "+e.getMessage());
+            } catch (UnsupportedRepositoryOperationException e) {
+                log.error("Error while accessing resource lock: "+e.getMessage());
+            } catch (RepositoryException e) {
+                log.error("Error while accessing resource lock: "+e.getMessage());
+        } else {
+            lock = super.getLock(type, scope);
-                String srcRelPath = instructions[i].getMemberHandle();
+                String srcRelPath = Text.unescape(instructions[i].getMemberHandle());
+        if (destRelPath != null) {
+            destRelPath = Text.unescape(destRelPath);
+        }

MOV8 MOV60 MOV41 INS25 INS27 INS8 INS42 INS33 INS21 INS7 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS42 MOV32 DEL42 DEL42 DEL42 DEL32 DEL25 DEL8