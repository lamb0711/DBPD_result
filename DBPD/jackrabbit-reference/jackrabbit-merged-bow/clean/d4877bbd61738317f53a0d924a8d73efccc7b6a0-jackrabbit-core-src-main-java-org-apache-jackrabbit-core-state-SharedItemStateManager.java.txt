JCR-2272: Update to match latest trunk

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/branches/JCR-2272@1176521 13f79535-47bb-0310-9956-ffa450edef68

-                // Let the shared item listeners know about the change
-                shared.persisted();
-
+                // Let the shared item listeners know about the change
+                // JCR-2171: This must happen after downgrading the lock!
+                shared.persisted();
+
-            Set sharedSet = childState.getSharedSet();
+            Set<NodeId> sharedSet = childState.getSharedSet();

MOV21 INS74 MOV43 INS43 INS42