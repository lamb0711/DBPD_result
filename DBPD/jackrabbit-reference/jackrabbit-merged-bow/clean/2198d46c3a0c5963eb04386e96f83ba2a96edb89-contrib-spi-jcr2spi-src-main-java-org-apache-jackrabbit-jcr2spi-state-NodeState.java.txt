work in progress

- add tmp workaround for 'reload' (tmp solution until state hierarchy has been reworked)
- minor improvement



git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@497037 13f79535-47bb-0310-9956-ffa450edef68

-     * @param uuid          the uniqueID of this NodeState or <code>null</code> if
+     * @param uniqueID      the uniqueID of this NodeState or <code>null</code> if
+                /* TODO: TOBEFIXED.
+                   recreating nodestate not correct. parent still has entry pointing
+                   to this state and subsequently retrieving the childentries fails,
+                   since id of tmp state cannot be resolved.
+                   -> add workaround until state hierarchy has been modified
+                */
+                tmp.childNodeEntries = isf.getChildNodeEntries(this);
+
-        if (another == null) {
+        if (another == null || another == this) {
+                    parent.childNodeEntries().remove((NodeState)state);
+                    parent.removePropertyEntry(state.getQName());
-
-
-                // should not occur: state has not been processed
-                log.error("State " + state + " has not been processed upon ChangeLog.persisted => invalidate");
+                log.info("State " + state + " with Status " + Status.getName(state.getStatus()) + " has not been processed upon ChangeLog.persisted => invalidate");

UPD42 UPD66 INS27 MOV27 INS27 INS42 INS52 INS21 INS7 INS40 INS32 INS21 INS21 UPD42 INS42 INS42 INS52 INS32 INS32 INS45 INS32 INS32 INS42 INS11 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS43 INS42 INS42 INS42 INS42 INS42 INS42