JCR-2375: Create ScoreNode on demand in SortedLuceneQueryHits

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@831851 13f79535-47bb-0310-9956-ffa450edef68

-     * The score nodes.
+     * The score docs.
-    private final List<ScoreNode> scoreNodes = new ArrayList<ScoreNode>();
+    private final List<ScoreDoc> scoreDocs = new ArrayList<ScoreDoc>();
-        } else if (hitIndex >= scoreNodes.size()) {
+        } else if (hitIndex >= scoreDocs.size()) {
-        return scoreNodes.get(hitIndex);
+        ScoreDoc doc = scoreDocs.get(hitIndex);
+        String uuid = reader.document(doc.doc,
+                FieldSelectors.UUID).get(FieldNames.UUID);
+        NodeId id = new NodeId(uuid);
+        return new ScoreNode(id, doc.score, doc.doc);
-        for (int i = scoreNodes.size(); i < docs.length; i++) {
-            String uuid = reader.document(docs[i].doc,
-                    FieldSelectors.UUID).get(FieldNames.UUID);
-            NodeId id = new NodeId(uuid);
-            scoreNodes.add(new ScoreNode(id, docs[i].score, docs[i].doc));
+        for (int i = scoreDocs.size(); i < docs.length; i++) {
+            scoreDocs.add(docs[i]);
-        log.debug("getHits() {}/{}", scoreNodes.size(), numHits);
+        log.debug("getHits() {}/{}", scoreDocs.size(), numHits);

UPD74 UPD43 UPD42 INS60 INS60 MOV60 INS41 UPD66 UPD42 UPD74 INS43 INS59 MOV43 INS59 INS14 UPD43 INS42 INS42 INS32 INS42 INS32 MOV43 INS42 INS40 INS40 UPD42 UPD42 MOV42 MOV42 MOV42 INS32 INS42 INS40 UPD42 UPD42 INS42 INS42 INS40 INS40 UPD42 UPD42 MOV2 DEL32 DEL41 DEL42 DEL42 DEL42 DEL42 DEL42 DEL2 DEL42 DEL22 DEL40 DEL32 DEL42 DEL40 DEL32 DEL59 DEL60 DEL42 DEL42 DEL42 DEL2 DEL42 DEL22 DEL42 DEL22 DEL14