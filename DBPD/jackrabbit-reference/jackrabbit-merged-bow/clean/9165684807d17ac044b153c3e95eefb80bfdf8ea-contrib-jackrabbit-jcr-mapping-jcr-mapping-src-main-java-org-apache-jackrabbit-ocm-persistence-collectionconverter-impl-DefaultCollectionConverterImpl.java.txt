Better management for null values 

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@537947 13f79535-47bb-0310-9956-ffa450edef68

-    	    String jcrName = getCollectionJcrName(collectionDescriptor);
-        if (collection == null)
+    	String jcrName = getCollectionJcrName(collectionDescriptor);
+    	boolean hasNode = parentNode.hasNode(jcrName);
+        // If the new value for the collection is null, drop the node matching to the collection
+    	if (collection == null)
-            if (parentNode.hasNode(jcrName)) 
+            if (hasNode) 
+    	// If there is not yet a node matching to the collection, insert the collection 
+    	if (! hasNode)
+    	{
+    		this.doInsertCollection(session, parentNode, collectionDescriptor, collection);
+    		return;
+    	}
+    	// update process
+    	
-            Object item = objectConverter.getObject(session, itemNode.getPath());
+            Object item = objectConverter.getObject(session, elementClass, itemNode.getPath());

INS60 INS25 INS39 INS59 INS38 INS8 INS42 MOV32 INS42 INS21 INS41 INS42 INS32 INS52 INS42 INS42 INS42 INS42 INS42 INS42