JCR-1878: Use Apache Tika for text extraction

Work around the POI loading issue in Java 1.4 by using a custom Tika configuration file.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@763242 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.tika.config.TikaConfig;
-        AutoDetectParser parser = new AutoDetectParser();
+        // The default Tika configuration refers to Apache POI libraries that
+        // are compiled for Java 5, and can thus not be loaded in Java 1.4.
+        // This makes it impossible to load the default Tika configuration
+        // (see TIKA-217 for background), and so we need to use the following
+        // workaround to instantiate the Tika AutoDetectParser without the
+        // POI classes (and thus support for MS Office formats) when running
+        // on Java 1.4.
+        AutoDetectParser parser;
+        if ("1.4".equals(System.getProperty("java.specification.version"))) {
+            InputStream stream =
+                DefaultTextExtractor.class.getResourceAsStream("tika-config-jdk14.xml");
+            try {
+                try {
+                    parser = new AutoDetectParser(new TikaConfig(stream));
+                } finally {
+                    stream.close();
+                }
+            } catch (Exception e) {
+                throw new RuntimeException(
+                        "Unable to load Tika configuration", e);
+            }
+        } else {
+            parser = new AutoDetectParser();
+        }
+

INS26 INS40 INS25 INS32 INS8 INS8 INS45 INS42 INS32 INS60 INS54 INS21 INS42 INS42 INS45 INS43 INS59 INS8 INS12 INS7 INS42 INS42 INS32 INS54 INS44 INS8 INS42 MOV14 INS57 INS42 INS45 INS8 INS8 INS43 INS42 INS53 INS43 INS21 INS21 INS42 INS14 INS42 INS7 INS32 INS43 INS45 INS42 INS42 INS14 INS42 INS42 INS42 INS43 INS14 INS42 INS43 INS42 INS42