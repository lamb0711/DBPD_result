JCR-1363: Migrate to Lucene 2.3

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@696653 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.lucene.index.FilterIndexReader;
-class ReadOnlyIndexReader extends FilterIndexReader {
+class ReadOnlyIndexReader extends RefCountingIndexReader {
-     * A reference counter. When constructed the refCount is one.
-     */
-    private int refCount = 1;
-
-    /**
-        // register this
-        reader.addClient(this);
-    }
-
-    /**
-     * Increments the reference count on this index reader. The reference count
-     * is decremented on {@link #close()}.
-     */
-    synchronized void incrementRefCount() {
-        refCount++;
-    }
-
-    /**
-     * @return the current reference count value.
-     */
-    synchronized int getRefCount() {
-        return refCount;
+        // acquire underlying reader
+        reader.acquire();
-     * Unregisters this reader from the shared index reader if the reference
-     * count for this reader drops to zero. Specifically, this method does
-     * <b>not</b> close the underlying index reader, because it is shared by
-     * multiple <code>ReadOnlyIndexReader</code>s.
-     *
-     * @throws IOException if an error occurs while closing the reader.
-     */
-    protected void doClose() throws IOException {
-        synchronized (this) {
-            if (--refCount == 0) {
-                reader.removeClient(this);
-            }
-        }
-    }
-
-    /**

UPD43 UPD42 UPD42 DEL40 DEL26 DEL66 DEL65 DEL29 DEL83 DEL39 DEL42 DEL34 DEL59 DEL23 DEL52 DEL66 DEL66 DEL42 DEL68 DEL65 DEL66 DEL65 DEL29 DEL83 DEL39 DEL42 DEL42 DEL37 DEL21 DEL8 DEL31 DEL66 DEL65 DEL29 DEL83 DEL39 DEL42 DEL42 DEL41 DEL8 DEL31 DEL66 DEL66 DEL66 DEL66 DEL65 DEL42 DEL66 DEL65 DEL29 DEL83 DEL39 DEL42 DEL42 DEL43 DEL52 DEL42 DEL38 DEL34 DEL27 DEL42 DEL42 DEL52 DEL32 DEL21 DEL8 DEL25 DEL8 DEL51 DEL8 DEL31