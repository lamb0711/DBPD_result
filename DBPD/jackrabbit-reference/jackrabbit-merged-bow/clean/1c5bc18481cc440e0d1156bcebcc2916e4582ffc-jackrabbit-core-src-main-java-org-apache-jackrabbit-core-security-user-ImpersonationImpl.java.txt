JCR-2272: Update branch to match latest trunk.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/branches/JCR-2272@1176340 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.security.SystemPrincipal;
+        boolean allows;
-        if (impersonators.removeAll(principalNames)) {
-            return true;
-        } else {
-            // check if subject belongs to an administrator or the system
+        allows = impersonators.removeAll(principalNames);
+
+        if (!allows) {
+            // check if subject belongs to administrator user
-                if (p instanceof SystemPrincipal) { 
-                    return true;
-                } else if (!(p instanceof Group)) {
-                    Authorizable a = userManager.getAuthorizable(p);
-                    if (a != null && userManager.isAdminId(a.getID())) {
-                        return true;
-                    }
+                if (p instanceof Group) {
+                    continue;
+                }
+                Authorizable a = userManager.getAuthorizable(p);
+                if (a != null && userManager.isAdminId(a.getID())) {
+                    allows = true;
+                    break;
-        return false;
+        return allows;

INS60 INS21 MOV25 MOV41 INS39 INS59 INS7 INS8 INS42 INS42 INS42 MOV32 INS42 INS70 MOV44 MOV32 MOV8 INS25 MOV62 INS8 INS18 INS21 INS10 INS7 INS42 INS9 DEL40 DEL26 DEL36 DEL9 DEL41 DEL9 DEL9 DEL41 DEL8 DEL42 DEL42 DEL43 DEL62 DEL8 DEL25 DEL8 DEL70 DEL8 DEL25 DEL9 DEL41