JCR-1456: Database connection pooling

Merge back all changes from the JCR-1456 sandbox branch.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@886191 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.util.db.ConnectionFactory;
-            new RepositoryConfigurationParser(variables);
+            new RepositoryConfigurationParser(variables, new ConnectionFactory());
+     * The configuration for the used DataSources.
+     */
+    private final DataSourceConfig dsc;
+
+    /**
+     * The {@link ConnectionFactory}
+     */
+    private final ConnectionFactory cf;
+
+    /**
+     * @param rlf the RepositoryLockMechanismFactory
+     * @param dsc the DataSource configuration
+     * @param cf the ConnectionFactory for all DatabasAware beans
+            DataSourceConfig dsc,
+            ConnectionFactory cf,
+        this.dsc = dsc;
+        this.cf = cf;
+        
+        // This needs to be done here and not by clients (e.g., RepositoryImpl ctor) because
+        // fsf is used below and this might be a DatabaseAware FileSystem
+        try {
+            cf.registerDataSources(dsc);
+        } catch (RepositoryException e) {
+            throw new ConfigurationException("failed to register data sources", e);
+        }
+
+     * Returns the {@link ConnectionFactory} for this repository.
+     * Please note that it must be closed explicitly.
+     */
+    public ConnectionFactory getConnectionFactory() {
+        return cf;
+    }
+
+    /**

INS26 INS40 INS23 INS23 INS31 INS29 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS43 INS59 INS44 INS44 INS29 INS83 INS43 INS42 INS8 INS65 INS42 INS42 INS65 INS42 INS42 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS21 INS21 INS54 INS65 INS42 INS41 MOV43 INS66 INS66 INS65 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS7 INS7 INS8 INS12 INS66 INS65 INS66 INS66 INS42 INS42 INS22 INS42 INS22 INS42 INS21 INS44 INS8 INS42 MOV43 INS14 INS52 INS42 INS52 INS42 INS32 INS43 INS42 INS53 INS43 INS42 INS42 INS42 INS42 INS14 INS42 INS43 INS45 INS42 INS42