JCR-3172: implement PERSIST events for the EventJournal

Add PERSIST events to EventJournal, add a minimal test case

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1212472 13f79535-47bb-0310-9956-ffa450edef68

-        return session.getJCRPath(getQPath());
+        Path p = getQPath();
+        return p != null ? session.getJCRPath(getQPath()) : null;
-        NodeId id = eventState.getChildId();
-        if (id == null) {
-            // property event
-            id = eventState.getParentId();
+        if (eventState.getType() == Event.PERSIST) {
+            return null;
-        return id.toString();
+        else {
+            NodeId id = eventState.getChildId();
+
+            if (id != null) {
+                return id.toString();
+            }
+            else {
+                // property event
+                return eventState.getParentId().toString();
+            }
+        }
-     * @return path
+     * @return path or <code>null</code> when no path is associated with the event
-            int index = child.getIndex();
-            if (index > 0) {
-                return PathFactoryImpl.getInstance().create(parent, child.getName(), index, false);
-            } else {
-                return PathFactoryImpl.getInstance().create(parent, child.getName(), false);
+
+            if (parent == null || child == null) {
+                // an event without associated path information
+                return null;
+            }
+            else {
+                int index = child.getIndex();
+                if (index > 0) {
+                    return PathFactoryImpl.getInstance().create(parent, child.getName(), index, false);
+                } else {
+                    return PathFactoryImpl.getInstance().create(parent, child.getName(), false);
+                }

INS8 INS60 INS25 INS43 INS59 INS16 INS27 INS8 MOV8 UPD66 INS42 INS42 INS32 INS27 MOV32 INS33 INS32 INS40 INS41 INS25 INS42 INS42 INS33 INS42 INS42 INS33 UPD27 INS8 INS27 INS8 INS8 MOV41 INS41 INS27 INS27 INS41 MOV60 MOV25 INS32 INS42 INS33 INS42 INS33 INS33 MOV32 INS42 DEL42 DEL7 DEL21