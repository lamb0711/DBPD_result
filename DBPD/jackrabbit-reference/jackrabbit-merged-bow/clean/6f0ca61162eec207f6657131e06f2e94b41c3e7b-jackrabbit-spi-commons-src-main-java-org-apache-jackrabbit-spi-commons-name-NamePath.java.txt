JCR-2744: Avoid element arrays in PathImpl

Replace the inner PathImpl class in PathFactoryImpl with the new path classes.

Minor fixes and tweaks to the way in which especially identifier-based paths are handled.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@995735 13f79535-47bb-0310-9956-ffa450edef68

-        return parent == null || parent.isNormalized();
+        return parent == null
+            || (parent.isNormalized()
+                    && !parent.getNameElement().denotesCurrent());
-            return new NamePath(parent.getNormalizedPath(), element);
+            Path normalized = parent.getNormalizedPath();
+            if (normalized.getNameElement().denotesCurrent()) {
+                normalized = null; // special case: ./a
+            }
+            return new NamePath(normalized, element);
-            return parent.getString() + "/" + element.getString();
+            return parent.getString() + Path.DELIMITER + element.getString();

INS36 INS60 INS25 INS27 INS43 INS59 INS32 INS8 MOV32 INS38 INS42 INS42 MOV32 INS32 INS42 INS21 INS42 INS40 INS32 INS42 INS42 INS7 INS32 INS42 INS42 INS33 INS42 INS42 DEL45