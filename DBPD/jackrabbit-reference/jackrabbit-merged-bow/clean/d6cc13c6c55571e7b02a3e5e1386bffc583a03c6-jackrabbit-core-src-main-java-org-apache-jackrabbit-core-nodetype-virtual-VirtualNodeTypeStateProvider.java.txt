JCR-1964: VirtualNodeTypeStateProvider creates PropertyState with type != value(s).getType
JCR-1969: Invalid node type definitions with test_nodetypes.xml

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@741100 13f79535-47bb-0310-9956-ffa450edef68

-        pState.setPropertyValues(NameConstants.JCR_DEFAULTVALUES, PropertyType.STRING, propDef.getDefaultValues());
+        InternalValue[] defVals = propDef.getDefaultValues();
+        // retrieve the property type from the first default value present with
+        // the property definition. in case no default values are defined,
+        // fallback to PropertyType.STRING in order to avoid creating a property
+        // with type UNDEFINED which is illegal.
+        int defValsType = PropertyType.STRING;
+        if (defVals != null && defVals.length > 0) {
+            defValsType = defVals[0].getType();
+        }
+        pState.setPropertyValues(NameConstants.JCR_DEFAULTVALUES, defValsType, defVals);

INS60 INS60 INS25 INS5 INS59 INS39 INS59 INS27 INS8 INS43 INS85 INS42 MOV32 INS42 INS40 INS27 INS27 INS21 INS42 INS42 INS42 INS42 INS33 INS40 INS34 INS7 INS42 INS32 INS2 INS42 INS42 INS34 DEL40