JCR-2980 Nodes that have properties marked for async extraction should be available for querying

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1131652 13f79535-47bb-0310-9956-ffa450edef68

-    void flush() throws IOException {
+    private void flush() throws IOException {
-                    synchronized (updateMonitor) {
-                        updateInProgress = true;
-                    }
-                    try {
-                        flush();
-                    } finally {
-                        synchronized (updateMonitor) {
-                            updateInProgress = false;
-                            updateMonitor.notifyAll();
-                            releaseMultiReader();
-                        }
-                    }
+                    safeFlush();
+    
+    void safeFlush() throws IOException{
+        synchronized (updateMonitor) {
+            updateInProgress = true;
+        }
+        try {
+            flush();
+        } finally {
+            synchronized (updateMonitor) {
+                updateInProgress = false;
+                updateMonitor.notifyAll();
+                releaseMultiReader();
+            }
+        }
+    }

INS31 INS83 INS39 INS42 INS43 MOV8 INS42 INS8 MOV21 INS21 INS32 INS42