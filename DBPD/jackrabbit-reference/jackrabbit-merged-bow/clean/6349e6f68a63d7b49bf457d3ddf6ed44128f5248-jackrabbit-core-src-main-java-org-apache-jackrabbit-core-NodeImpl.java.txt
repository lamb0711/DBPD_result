JCR-3419: Overwriting Cache Entry Warnings

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1382673 13f79535-47bb-0310-9956-ffa450edef68

+        PropertyId propId = new PropertyId(getNodeId(), name);
-            PropertyId propId = new PropertyId(getNodeId(), name);
-            // does not exist yet:
-            // find definition for the specified property and create property
+            // does not exist yet or has been removed transiently:
+            // find definition for the specified property and (re-)create property
-            PropertyImpl prop = createChildProperty(name, type, def);
+            PropertyImpl prop;
+            if (stateMgr.hasTransientItemStateInAttic(propId)) {
+                // remove from attic
+                try {
+                    stateMgr.disposeTransientItemStateInAttic(stateMgr.getAttic().getItemState(propId));
+                } catch (ItemStateException ise) {
+                    // shouldn't happen because we checked if it is in the attic
+                    throw new RepositoryException(ise);
+                }
+                prop = (PropertyImpl) itemMgr.getItem(propId);
+                PropertyState state = (PropertyState) prop.getOrCreateTransientItemState();
+                state.setMultiValued(multiValued);
+                state.setType(type);
+                getNodeState().addPropertyName(name);
+            } else {
+                prop = createChildProperty(name, type, def);
+            }

MOV60 INS8 MOV60 INS60 INS25 MOV21 MOV41 MOV43 INS59 INS32 INS8 INS8 INS42 INS42 INS42 INS42 INS54 INS21 MOV60 INS21 INS21 INS21 INS21 INS8 INS12 INS7 INS43 INS32 INS32 INS32 INS7 INS21 INS44 INS8 INS42 INS11 INS42 INS42 INS11 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 MOV32 INS32 INS43 INS42 INS53 INS43 INS32 INS43 INS32 INS42 INS42 INS42 INS32 INS42 INS14 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS43 INS42 INS42 INS42 INS42 DEL42 DEL8