JCR-2796: Restoring a node fails (partially) if done within a XA transaction

The restore operation can produce a ChangeLog that both adds and removes
(instead of just modifying) the same item states. The internal caching
logic expects this behaviour, but the ChangeLog.merge() logic used in
transactions would automatically convert such add/remove pairs to
individual modifications. This change modifies the merge() logic to
leave such add/remove pairs intact.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1032770 13f79535-47bb-0310-9956-ffa450edef68

-        // add 'added' state, but respect previously deleted
+        // add 'added' states
-            ItemState deletedState = deletedStates.remove(state.getId());
-            if (deletedState != null) {
-                // the newly 'added' state had previously been deleted;
-                // merging those two operations results in a modified state
-
-                // adapt status/modCount and add to modified
-                state.setStatus(deletedState.getStatus());
-                state.setModCount(deletedState.getModCount());
-                modifiedStates.put(state.getId(), state);
-            } else {
-                addedStates.put(state.getId(), state);
-            }
+            addedStates.put(state.getId(), state);

MOV8 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21 DEL42 DEL42 DEL42 DEL42 DEL32 DEL42 DEL32 DEL21 DEL8 DEL25 DEL8