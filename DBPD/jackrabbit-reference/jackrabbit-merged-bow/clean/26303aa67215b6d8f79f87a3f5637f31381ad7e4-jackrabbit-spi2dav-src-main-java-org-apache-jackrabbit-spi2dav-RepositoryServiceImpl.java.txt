JCR-2256: JSR 283 Repository Descriptors

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@804296 13f79535-47bb-0310-9956-ffa450edef68

-    private Map descriptors;
+    private Map<String, QValue[]> descriptors;
-    public Map getRepositoryDescriptors() throws RepositoryException {
+    public Map<String, QValue[]> getRepositoryDescriptors() throws RepositoryException {
-                        String descriptor = DomUtil.getChildText(elem, ItemResourceConstants.XML_DESCRIPTORVALUE, ItemResourceConstants.NAMESPACE);
-                        if (key != null && descriptor != null) {
-                            descriptors.put(key, descriptor);
-                        } else {
-                            log.error("Invalid descriptor key / value pair: " + key + " -> " + descriptor);
+                        ElementIterator it = DomUtil.getChildren(elem, ItemResourceConstants.XML_DESCRIPTORVALUE, ItemResourceConstants.NAMESPACE);
+                        List<QValue> vs = new ArrayList();
+                        while (it.hasNext()) {
+                            Element dv = it.nextElement();
+                            String descriptor = DomUtil.getText(dv);
+                            if (key != null && descriptor != null) {
+                                String typeStr = (DomUtil.getAttribute(dv, ItemResourceConstants.ATTR_VALUE_TYPE, null));
+                                int type = (typeStr == null) ? PropertyType.STRING : PropertyType.valueFromName(typeStr);
+                                vs.add(getQValueFactory().create(descriptor, type));
+                            } else {
+                                log.error("Invalid descriptor key / value pair: " + key + " -> " + descriptor);
+                            }
+
+                        descriptors.put(key, vs.toArray(new QValue[vs.size()]));
-            PropertyInfo pInfo = new PropertyInfoImpl(propertyId, path, type, isMultiValued, values);
-            return pInfo;
+            return new PropertyInfoImpl(propertyId, path, type, isMultiValued, values);

INS74 INS74 MOV43 INS43 INS5 MOV43 INS43 INS5 INS42 INS43 INS85 INS42 INS43 INS85 INS42 INS42 MOV14 INS60 INS61 INS21 INS43 INS74 INS59 INS32 INS8 INS32 INS42 UPD42 INS43 INS43 INS42 INS14 INS42 INS42 INS60 INS60 MOV25 INS42 INS42 INS42 INS32 UPD42 INS42 INS42 INS43 INS43 INS59 MOV43 INS59 INS42 INS42 INS3 INS42 INS42 INS42 INS32 INS42 INS32 INS60 INS60 INS5 INS32 INS42 INS42 INS42 INS42 INS42 INS43 INS59 INS39 INS59 INS43 INS85 INS42 INS42 INS42 INS42 INS36 INS42 INS16 UPD42 UPD42 INS32 INS42 INS32 INS36 INS40 INS32 INS32 INS42 MOV42 INS42 INS42 INS42 INS42 INS40 INS33 INS27 INS42 INS42 INS42 UPD42 MOV42 INS42 INS33 DEL42 DEL43 DEL42 DEL59 DEL60 DEL42