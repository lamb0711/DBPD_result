 JCR-1588: JSR 283: Access Control

- minor improvement: replace ace nodes instead of removing the acl altogether.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@790235 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.NodeIterator;
-        /* in order to assert that the parent (ac-controlled node) gets modified
-           an existing ACL node is removed first and the recreated.
-           this also asserts that all ACEs are cleared without having to
-           access and removed the explicitely
-         */
-            removeItem(aclNode);
+            // remove all existing aces
+            for (NodeIterator aceNodes = aclNode.getNodes(); aceNodes.hasNext();) {
+                NodeImpl aceNode = (NodeImpl) aceNodes.nextNode();
+                removeItem(aceNode);
+            }
+        } else {
+            // create the acl node
+            aclNode = createAclNode(nodePath);
-        // now (re) create it
-        aclNode = createAclNode(nodePath);
-
+        
+
+        // mark the parent modified.
+        markModified(((NodeImpl)aclNode.getParent()));

INS26 INS40 INS21 INS8 INS8 INS32 INS24 MOV21 INS42 INS36 INS58 INS32 INS8 INS11 INS43 INS59 INS42 INS42 INS60 MOV21 INS43 INS32 INS42 INS42 INS32 INS43 INS59 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS11 UPD42 INS43 INS32 INS42 INS42 INS42 DEL8