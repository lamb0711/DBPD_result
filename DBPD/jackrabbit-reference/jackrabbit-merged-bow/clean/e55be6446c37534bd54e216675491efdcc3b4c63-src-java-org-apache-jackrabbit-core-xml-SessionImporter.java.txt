re-implementing Workspace methods clone, copy, importXML [work in progress...]



git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@158489 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.util.ReferenceChangeTracker;
-     * mapping <original uuid> to <new uuid> of mix:referenceable nodes
+     * helper object that keeps track of remapped uuid's and imported reference
+     * properties that might need correcting depending on the uuid mappings
-    private final HashMap uuidMap;
-    /**
-     * list of imported reference properties that might need correcting
-     */
-    private final ArrayList references;
+    private final ReferenceChangeTracker refTracker;
-        uuidMap = new HashMap();
-        references = new ArrayList();
+        refTracker = new ReferenceChangeTracker();
-                uuidMap.put(nodeInfo.getUUID(), node.getUUID());
+                refTracker.mappedUUID(nodeInfo.getUUID(), node.getUUID());
-                references.add(node.getProperty(propName));
+                refTracker.processedReference(node.getProperty(propName));
-         * newly gererated uuid's on import
+         * newly generated uuid's on import
-        Iterator iter = references.iterator();
+        Iterator iter = refTracker.getProcessedReferences();
-                    String adjusted = (String) uuidMap.get(original);
+                    String adjusted = refTracker.getMappedUUID(original);
-                String adjusted = (String) uuidMap.get(original);
+                String adjusted = refTracker.getMappedUUID(original);
+        refTracker.clear();

INS26 INS40 UPD43 UPD42 UPD42 INS21 INS66 UPD66 INS32 UPD42 INS42 INS42 UPD43 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 INS32 UPD42 MOV42 UPD42 MOV42 MOV42 INS32 UPD42 MOV42 UPD42 MOV42 MOV42 DEL66 DEL65 DEL29 DEL83 DEL83 DEL42 DEL43 DEL42 DEL59 DEL23 DEL42 DEL42 DEL43 DEL14 DEL7 DEL21 DEL42 DEL43 DEL32 DEL11 DEL42 DEL43 DEL32 DEL11