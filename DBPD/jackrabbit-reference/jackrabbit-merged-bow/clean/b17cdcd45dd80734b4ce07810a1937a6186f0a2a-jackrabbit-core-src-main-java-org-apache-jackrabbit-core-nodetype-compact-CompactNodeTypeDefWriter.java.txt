JCR-1449 - Registering nodetypes with empty namespace prefix causes a namespace exception in sync node


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@633436 13f79535-47bb-0310-9956-ffa450edef68

-        if (name.equals(ItemDef.ANY_NAME)) {
-            out.write('*');
-        } else {
-            writeItemDefName(name);
-        }
+        writeItemDefName(name);
-        out.write(resolve(name));
+        if (name.equals(ItemDef.ANY_NAME)) {
+            out.write('*');
+        } else {
+            out.write(resolve(name));
+        }
-            if (prefix != null && !prefix.equals(Name.NS_EMPTY_PREFIX)) {
-                // check for writing namespaces
-                if (nsWriter != null) {
-                    if (!usedNamespaces.contains(prefix)) {
-                        usedNamespaces.add(prefix);
-                        nsWriter.write("<'");
-                        nsWriter.write(prefix);
-                        nsWriter.write("'='");
-                        nsWriter.write(escape(qname.getNamespaceURI()));
-                        nsWriter.write("'>\n");
-                    }
+            // check for writing namespaces
+            if (nsWriter != null) {
+                if (!usedNamespaces.contains(prefix)) {
+                    usedNamespaces.add(prefix);
+                    nsWriter.write("<'");
+                    nsWriter.write(prefix);
+                    nsWriter.write("'='");
+                    nsWriter.write(escape(qname.getNamespaceURI()));
+                    nsWriter.write("'>\n");
+            }
+            if (!prefix.equals(Name.NS_EMPTY_PREFIX)) {

MOV8 MOV21 MOV25 MOV25 INS54 MOV8 MOV12 MOV21 MOV60 INS25 MOV60 MOV60 MOV25 MOV38 INS8 MOV21 INS42 UPD42 MOV42 INS42 INS42 DEL42 DEL33 DEL27 DEL27 DEL25 DEL54 DEL8