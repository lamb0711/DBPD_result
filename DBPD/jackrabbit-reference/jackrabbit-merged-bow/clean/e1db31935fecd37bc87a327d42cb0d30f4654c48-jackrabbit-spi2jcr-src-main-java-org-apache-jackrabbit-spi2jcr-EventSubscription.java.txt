JCR-2108: JSR 283 Observation   (work in progress)

- properly handle null value in Event info
- use proper value type (Path)


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@781299 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.spi.commons.value.ValueFormat;
-                    Name name = resolver.getQName(key);
-                    // TODO: review again. how to determine value type?
-                    QValue v = qValueFactory.create(jcrInfo.get(key).toString(), PropertyType.STRING);
-                    info.put(name, v);
+                    Object value = jcrInfo.get(key);
+                    Name name = resolver.getQName(key);
+                    if (value != null) {
+                        // event information is generated for NODE_MOVED only in which
+                        // case all values are of type PATH.
+                        QValue v = ValueFormat.getQValue(value.toString(), PropertyType.PATH, resolver, qValueFactory);
+                        info.put(name, v);
+                    } else {
+                        info.put(name, null);
+                    }

INS26 INS40 MOV60 INS25 INS43 INS27 INS8 INS8 INS42 UPD42 MOV32 INS42 INS33 INS60 MOV21 INS21 MOV43 INS59 INS32 INS42 INS32 INS42 INS42 INS42 INS33 INS42 INS42 INS32 INS40 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL42 DEL32 DEL40 DEL32