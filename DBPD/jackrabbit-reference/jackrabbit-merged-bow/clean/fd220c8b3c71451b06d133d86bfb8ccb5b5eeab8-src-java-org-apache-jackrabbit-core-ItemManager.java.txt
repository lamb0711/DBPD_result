[JCR-136] Cached item could be lost in cache

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@191092 13f79535-47bb-0310-9956-ffa450edef68

-                if (isCached(id)) {
-                    evictItem(id);
-                }
+                evictItem(id);
-                if (isCached(id)) {
-                    evictItem(id);
-                }
+                evictItem(id);
-            if (isCached(id)) {
-                evictItem(id);
-            }
+            evictItem(id);
-        if (isCached(id)) {
-            return retrieveItem(id);
+        ItemImpl item = retrieveItem(id);
+        if (item == null) {
+            // shortcut
+            if (id.denotesNode() && id.equals(rootNodeId)) {
+                item = getRoot();
+            } else {
+                // create instance of item using its state object
+                item = createItemInstance(id);
+            }
-
-        // shortcut
-        if (id.denotesNode() && id.equals(rootNodeId)) {
-            return getRoot();
-        }
-
-        // create instance of item using its state object
-        return createItemInstance(id);
+        return item;
-    /**
-     * Checks if there's a cache entry for the specified id.
-     *
-     * @param id the id to be checked
-     * @return true if there's a corresponding cache entry, otherwise false.
-     */
-    private boolean isCached(ItemId id) {
-        return itemCache.containsKey(id);
-    }

INS60 INS25 MOV8 INS43 INS59 INS27 MOV8 INS42 MOV53 INS42 INS42 MOV32 INS42 INS33 MOV25 MOV8 MOV8 INS8 MOV41 MOV41 INS21 INS21 INS7 INS7 INS42 MOV32 INS42 MOV32 DEL42 DEL42 DEL32 DEL25 DEL8 DEL42 DEL42 DEL32 DEL25 DEL8 DEL42 DEL42 DEL32 DEL25 DEL8 DEL41 DEL41 DEL42 DEL42 DEL32 DEL25 DEL66 DEL65 DEL42 DEL66 DEL65 DEL66 DEL65 DEL29 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31