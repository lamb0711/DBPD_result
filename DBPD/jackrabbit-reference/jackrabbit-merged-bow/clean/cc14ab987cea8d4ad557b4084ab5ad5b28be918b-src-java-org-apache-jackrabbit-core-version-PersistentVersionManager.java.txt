- fixing problem with virtual overlay
- fixing PersistentNode issue described in JCR-15 [PersistentNode.store() ignores status when storing]

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@56421 13f79535-47bb-0310-9956-ffa450edef68

-     * the root node of the version histories
+     * the persistent root node of the version histories
+     * the virtual root node of the version histories
+     */
+    private final String virtHistoryRootId;
+
+    /**
-            systemRoot.save();
+        if (!systemRoot.hasNode(VersionManager.VERSION_HISTORY_ROOT_NAME)) {
+            // if not exist, create
+            systemRoot.addNode(VersionManager.VERSION_HISTORY_ROOT_NAME, NodeTypeRegistry.NT_UNSTRUCTURED);
+        }
+        systemRoot.save();
+        virtHistoryRootId = systemRoot.getNode(VersionManager.VERSION_HISTORY_ROOT_NAME).internalGetUUID();
-            versionManager = new VersionManager(this, systemRootId);
+            versionManager = new VersionManager(this, virtHistoryRootId);

INS23 INS29 INS83 INS83 MOV43 MOV59 INS43 INS59 INS65 INS42 INS42 INS25 MOV21 INS21 INS66 UPD66 INS38 INS8 INS7 INS32 INS21 INS42 INS32 INS42 INS42 INS40 INS32 INS32 INS42 INS42 INS42 INS40 INS40 INS42 INS42 INS40 UPD42