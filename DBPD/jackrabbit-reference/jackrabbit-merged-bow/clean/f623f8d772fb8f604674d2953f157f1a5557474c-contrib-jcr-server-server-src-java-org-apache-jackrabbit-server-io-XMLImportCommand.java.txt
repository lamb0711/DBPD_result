- adding configurable resource nodetype to FileImportCommand
- fixing unicode escaping problems
- fixing issues with docview/sysview import


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@201632 13f79535-47bb-0310-9956-ffa450edef68

-        boolean isSysView = false;
+        boolean isGenericXML = true;
-                isSysView = new String(buffer, 0, read).indexOf("<sv:node") >= 0;
+                //isSysView = new String(buffer, 0, read).indexOf("<sv:node") >= 0;
+                isGenericXML = new String(buffer, 0, read).indexOf("jcr:primaryType") < 0;
-        in = new FileInputStream(tmpFile);
-        context.setInputStream(in);
+        context.setInputStream(new FileInputStream(tmpFile));
-        if (isSysView) {
-            // just import sys view
+        if (!isGenericXML) {
+            // just import sys/doc view
+            in = context.getInputStream();
-                log.error("Unable to import sysview. will store as normal file: " + e.toString());
+                log.error("Unable to import sys/doc view. will try default xml import: " + e.toString());
+        }
+
+        // check 'file' node
+        in = context.getInputStream();
+        Node fileNode = parentNode.hasNode(context.getSystemId())
+                ? parentNode.getNode(context.getSystemId())
+                : parentNode.addNode(context.getSystemId(), nodeType);
+        if (importResource(context, fileNode, in)) {
+            context.setInputStream(null);
+            // set current node
+            context.setNode(fileNode);
-            // check 'file' node
-            Node fileNode = parentNode.hasNode(context.getSystemId())
-                    ? parentNode.getNode(context.getSystemId())
-                    : parentNode.addNode(context.getSystemId(), nodeType);
-            if (importResource(context, fileNode, in)) {
-                context.setInputStream(null);
-                // set current node
-                context.setNode(fileNode);
-            } else {
-                context.setInputStream(new FileInputStream(tmpFile));
-            }
+            context.setInputStream(new FileInputStream(tmpFile));
+            log.error("Error while importing XML. Will pass to next command: " + e.toString());

MOV21 MOV60 MOV25 INS32 INS38 INS7 UPD42 UPD9 INS42 INS42 INS14 INS42 INS21 INS42 INS32 MOV43 MOV42 INS7 MOV42 UPD42 MOV42 INS21 INS42 INS32 INS32 INS42 INS42 INS42 INS42 INS27 UPD42 UPD27 INS45 INS32 INS42 INS42 UPD45 UPD45 DEL42 DEL14 DEL7 DEL42 DEL8 DEL42 DEL32