- Checkin did not work if node has unreferenceable child node with OPV=Copy

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@54784 13f79535-47bb-0310-9956-ffa450edef68

-    private String frozenUUID;
+    private String frozenUUID=null;
-    private QName frozenPrimaryType;
+    private QName frozenPrimaryType=null;
-    private QName[] frozenMixinTypes;
+    private QName[] frozenMixinTypes=null;
-        // init the internal properties
-        frozenUUID = node.getPropertyValue(VersionManager.PROPNAME_FROZEN_UUID).internalValue().toString();
-        frozenPrimaryType = (QName) node.getPropertyValue(VersionManager.PROPNAME_FROZEN_PRIMARY_TYPE).internalValue();
-        InternalValue[] values = node.getPropertyValues(VersionManager.PROPNAME_FROZEN_MIXIN_TYPES);
-        if (values == null) {
-            frozenMixinTypes = new QName[0];
-        } else {
-            frozenMixinTypes = new QName[values.length];
-            for (int i = 0; i < values.length; i++) {
-                frozenMixinTypes[i] = (QName) values[i].internalValue();
-            }
-        }
-                // already set
+                // special property
+                frozenUUID = node.getPropertyValue(VersionManager.PROPNAME_FROZEN_UUID).internalValue().toString();
-                // already set
+                // special property
+                frozenPrimaryType = (QName) node.getPropertyValue(VersionManager.PROPNAME_FROZEN_PRIMARY_TYPE).internalValue();
-                // already set
+                // special property
+                InternalValue[] values = node.getPropertyValues(VersionManager.PROPNAME_FROZEN_MIXIN_TYPES);
+                if (values == null) {
+                    frozenMixinTypes = new QName[0];
+                } else {
+                    frozenMixinTypes = new QName[values.length];
+                    for (int j = 0; j < values.length; j++) {
+                        frozenMixinTypes[j] = (QName) values[j].internalValue();
+                    }
+                }
+        // do some checks
+        if (frozenMixinTypes==null) {
+            frozenMixinTypes=new QName[0];
+        }
+        if (frozenPrimaryType==null) {
+            throw new RepositoryException("Illegal frozen node. Must have 'frozenPrimaryType'");
+        }

INS33 INS33 INS33 INS25 INS25 INS27 INS8 INS27 INS8 INS42 INS33 INS21 INS42 INS33 INS53 INS7 INS14 MOV21 INS42 INS3 INS43 INS45 MOV21 INS5 INS34 INS42 MOV60 MOV25 INS43 INS85 INS42 UPD42 UPD42 UPD42 UPD42 UPD42