JCR-3352 : Minor improvements for collecting ACEs

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1353920 13f79535-47bb-0310-9956-ffa450edef68

-        ChildNodeEntry entry =
-                thisState.getChildNodeEntry(childId);
+        ChildNodeEntry entry = thisState.getChildNodeEntry(childId);
-        // check state of this instance
-        sanityCheck();
-
+     * Returns the name of the primary node type as exposed on the node state
+     * without retrieving the node type.
+     *
+     * @return the name of the primary node type.
+     */
+    public Name getPrimaryNodeTypeName() {
+        return data.getNodeState().getNodeTypeName();
+    }
+
+    /**
+     * Test if the given node is access controlled. The node is access
+     * controlled if it is of node type
+     * {@link org.apache.jackrabbit.core.security.authorization.AccessControlConstants#NT_REP_ACCESS_CONTROLLABLE "rep:AccessControllable"}
+     * and if it has a child node named
+     * {@link org.apache.jackrabbit.core.security.authorization.AccessControlConstants#N_POLICY}.
+     *
+     * @param node the node to be tested
+     * @return <code>true</code> if the node is access controlled and has a
+     * rep:policy child; <code>false</code> otherwise.
+     * @throws RepositoryException if an error occurs
+     */
+    public boolean isAccessControllable() throws RepositoryException {
+        return data.getNodeState().hasChildNodeEntry(NameConstants.REP_POLICY, 1)
+                    && isNodeType(NameConstants.REP_ACCESS_CONTROLLABLE);
+    }
+
+    /**
+        // check state of this instance
+        sanityCheck();
+

INS31 INS31 INS29 INS83 INS43 INS42 INS8 INS29 INS83 INS39 INS42 INS43 INS8 INS65 INS65 INS42 INS41 INS65 INS65 INS65 INS65 INS42 INS41 MOV21 INS66 INS66 INS66 INS32 INS66 INS66 INS65 INS66 INS65 INS66 INS42 INS66 INS66 INS66 INS42 INS66 INS27 INS32 INS42 INS67 INS66 INS67 INS32 INS32 INS42 INS42 INS40 INS42 INS40 INS42 INS32 INS42 INS40 INS34 INS42 INS40 INS42 INS42