JCR-1363: Migrate to Lucene 2.3

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@696653 13f79535-47bb-0310-9956-ffa450edef68

-class SharedIndexReader extends FilterIndexReader {
-
-    /**
-     * Set to <code>true</code> if this index reader should be closed, when
-     * all connected clients are disconnected.
-     */
-    private boolean closeRequested = false;
-
-    /**
-     * Map of all registered clients to this shared index reader. The Map
-     * is rather used as a Set, because each value is the same Object as its
-     * associated key.
-     */
-    private final Map clients = new IdentityHashMap();
+class SharedIndexReader extends RefCountingIndexReader {
-     * Registeres <code>client</code> with this reader. As long as clients are
-     * registered, this shared reader will not release resources on {@link
-     * #close()} and will not actually close but only marks itself to close when
-     * the last client is unregistered.
-     *
-     * @param client the client to register.
-     */
-    public synchronized void addClient(Object client) {
-        clients.put(client, client);
-    }
-
-    /**
-     * Unregisters the <code>client</code> from this index reader.
-     *
-     * @param client a client of this reader.
-     * @throws IOException if an error occurs while detaching the client from
-     *                     this shared reader.
-     */
-    public synchronized void removeClient(Object client) throws IOException {
-        clients.remove(client);
-        if (clients.isEmpty() && closeRequested) {
-            super.doClose();
-        }
-    }
-
-    /**
-     * Closes this index if no client is registered, otherwise this reader is
-     * marked to close when the last client is disconnected.
-     *
-     * @throws IOException if an error occurs while closing.
-     */
-    protected synchronized void doClose() throws IOException {
-        if (clients.isEmpty()) {
-            super.doClose();
-        } else {
-            closeRequested = true;
-        }
-    }
-
-    /**
-

UPD43 UPD42 DEL66 DEL66 DEL65 DEL29 DEL83 DEL39 DEL42 DEL9 DEL59 DEL23 DEL66 DEL66 DEL66 DEL65 DEL29 DEL83 DEL83 DEL42 DEL43 DEL42 DEL42 DEL43 DEL14 DEL59 DEL23 DEL66 DEL66 DEL42 DEL68 DEL65 DEL66 DEL66 DEL65 DEL42 DEL66 DEL65 DEL29 DEL83 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL31 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL66 DEL65 DEL29 DEL83 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL32 DEL42 DEL27 DEL42 DEL48 DEL21 DEL8 DEL25 DEL8 DEL31 DEL66 DEL66 DEL65 DEL42 DEL66 DEL65 DEL29 DEL83 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL42 DEL32 DEL42 DEL48 DEL21 DEL8 DEL42 DEL9 DEL7 DEL21 DEL8 DEL25 DEL8 DEL31