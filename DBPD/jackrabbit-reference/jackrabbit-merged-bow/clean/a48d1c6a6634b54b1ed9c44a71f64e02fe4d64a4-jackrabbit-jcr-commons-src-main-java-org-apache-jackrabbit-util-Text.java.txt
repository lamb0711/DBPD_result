JCR-3950: fix XSS vulnerability in DirListingExportHandler


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1732436 13f79535-47bb-0310-9956-ffa450edef68

-     * Replaces illegal XML characters in the given string by their corresponding
-     * predefined entity references.
+     * Replaces XML characters in the given string that might need escaping
+     * as XML text or attribute
+        return encodeMarkupCharacters(text, false);
+    }
+
+    /**
+     * Replaces HTML characters in the given string that might need escaping
+     * as HTML text or attribute
+     *
+     * @param text text to be escaped
+     * @return a string
+     */
+    public static String encodeIllegalHTMLCharacters(String text) {
+        return encodeMarkupCharacters(text, true);
+    }
+
+    private static String encodeMarkupCharacters(String text, boolean isHtml) {
-                buf.append("&apos;");
+                buf.append(isHtml ? "&#39;" : "&apos;");

INS31 INS31 MOV29 INS83 INS83 INS43 INS42 INS44 INS8 INS29 INS83 INS83 INS43 INS42 INS44 INS8 UPD83 UPD42 INS44 INS42 INS43 INS42 INS41 INS65 INS65 INS65 INS42 INS43 INS42 INS41 INS39 INS42 UPD66 UPD66 INS42 INS32 INS66 INS66 INS42 INS66 INS66 INS42 INS32 INS42 INS42 INS9 INS42 INS42 INS9 INS16 INS42 INS45 INS45 DEL45