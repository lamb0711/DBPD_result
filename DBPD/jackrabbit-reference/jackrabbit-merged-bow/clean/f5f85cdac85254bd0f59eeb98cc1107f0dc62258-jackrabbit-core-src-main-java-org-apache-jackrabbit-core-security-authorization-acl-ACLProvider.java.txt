JCR-3718 Inconsistent Principal Validation between API and Import behavior

- make principal check based on ACLProvider configuration
- adding new ACLProvider configuration parameter: "allow-unknown-principals", default: "false"
- make missing-principal bypass in AccessControlImporter based on configuration
- adding new AccessControlImporter configuration parameter: "importBehavior", default: "bestEffort"


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1560783 13f79535-47bb-0310-9956-ffa450edef68

+     * Constant for the name of the configuration option {@code allow-unknown-principals}.
+     * The option is a flag indicating whether access control entries with principals not known to the system
+     * can be added to an ACL. the default is {@code false}.
+     * <p/>
+     * Please note that the current implementation does only check principal existence when adding a new access
+     * control entry, but does not validate all ACEs when removing a principal. So even if this flag is {@code false},
+     * it's possible to create an ACL with a unknown principal.
+     */
+    public static final String PARAM_ALLOW_UNKNOWN_PRINCIPALS = "allow-unknown-principals";
+
+    /**
+    /**
+     * controls if unknown principals are allowed in ACLs
+     */
+    private boolean allowUnknownPrincipals;
+
+        allowUnknownPrincipals = "true".equals(configuration.get(PARAM_ALLOW_UNKNOWN_PRINCIPALS));
-        ACLEditor systemEditor = new ACLEditor(session, this);
+        ACLEditor systemEditor = new ACLEditor(session, this, allowUnknownPrincipals);
-        return new ACLEditor(session, this);
+        return new ACLEditor(session, this, allowUnknownPrincipals);
-        AccessControlList acl = new ACLTemplate(aclNode, path);
+        AccessControlList acl = new ACLTemplate(aclNode, path, allowUnknownPrincipals);

INS23 INS23 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS39 INS59 INS65 INS42 INS42 INS45 INS65 INS42 INS21 INS66 INS65 INS66 INS66 INS66 INS65 INS66 INS66 INS66 INS66 INS65 INS66 INS66 INS66 INS7 MOV43 INS66 INS66 INS66 INS42 INS32 INS42 INS45 INS42 INS32 MOV43 INS42 INS42 INS42 INS42 INS42