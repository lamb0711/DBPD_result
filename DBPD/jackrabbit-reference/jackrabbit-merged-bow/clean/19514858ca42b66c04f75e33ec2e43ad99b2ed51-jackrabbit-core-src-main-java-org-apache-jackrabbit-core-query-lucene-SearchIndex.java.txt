JCR-967: Only search the index for the "jcr:system" tree if needed

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@550419 13f79535-47bb-0310-9956-ffa450edef68

-        IndexReader reader = getIndexReader();
+        IndexReader reader = getIndexReader(queryImpl.needsSystemTree());
+        return getIndexReader(true);
+    }
+
+    /**
+     * Returns an index reader for this search index. The caller of this method
+     * is responsible for closing the index reader when he is finished using
+     * it.
+     *
+     * @param includeSystemIndex if <code>true</code> the index reader will
+     *                           cover the complete workspace. If
+     *                           <code>false</code> the returned index reader
+     *                           will not contains any nodes under /jcr:system.
+     * @return an index reader for this search index.
+     * @throws IOException the index reader cannot be obtained.
+     */
+    protected IndexReader getIndexReader(boolean includeSystemIndex)
+            throws IOException {
-        if (parentHandler instanceof SearchIndex) {
+        if (parentHandler instanceof SearchIndex && includeSystemIndex) {

INS31 MOV29 INS83 INS43 INS42 INS43 INS8 INS29 UPD83 INS44 INS42 INS42 INS41 INS65 INS65 INS65 INS65 INS39 INS42 INS32 INS66 INS66 INS66 INS42 INS66 INS66 INS66 INS66 INS66 INS42 INS66 INS27 INS42 INS9 MOV62 INS42 INS32 INS42 INS42