JCR-3277 Add consistency type information to consistency report items

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1439927 13f79535-47bb-0310-9956-ffa450edef68

-                String message = null;
-                                message = "NodeState '" + id + "' references inexistent child '" + childNodeId + "'";
+                                String message = "NodeState '" + id + "' references inexistent child '" + childNodeId + "'";
+                                addMessage(reports, childNodeId, message, ReportItem.Type.MISSING);
-                                    message = "ChildNode has invalid parent id: '" + cp + "' (instead of '" + id + "')";
+                                    String message = "Node has invalid parent id: '" + cp + "' (instead of '" + id + "')";
+                                    addMessage(reports, childNodeId, message, ReportItem.Type.DISCONNECTED);
-                if (message != null) {
-                    addMessage(reports, id, message);
-                }
-                addMessage(reports, id, e.getMessage());
+                addMessage(reports, id, e.getMessage(), ReportItem.Type.ERROR);
-                                addMessage(reports, id, message);
+                                addMessage(reports, id, message, ReportItem.Type.ORPHANED);
-                                addMessage(reports, id, message);
+                                addMessage(reports, id, message, ReportItem.Type.ABANDONED);
-            addMessage(reports, id, message);
+            addMessage(reports, id, message, ReportItem.Type.ERROR);
-        if ("cafebabe-cafe-babe-cafe-babecafebabe".equals(s)) {
-            // root node isn't virtual
-            return false;
-        }
-        else {
-            // all other system nodes are
-            return s.endsWith("babecafebabe");
-        }
+        return !isRoot(s) && s.endsWith("babecafebabe");
+    }
+
+    private boolean isRoot(String id) {
+        return "cafebabe-cafe-babe-cafe-babecafebabe".equals(id);
-    private void addMessage(Set<ReportItem> reports, NodeId id, String message) {
+    private void addMessage(Set<ReportItem> reports, NodeId id, String message, ReportItem.Type type) {
-            ReportItem ri = new ReportItemImpl(id.toString(), message);
+            ReportItem ri = new ReportItemImpl(id.toString(), message, type);
+

INS31 INS83 INS39 INS42 INS44 INS8 INS44 MOV41 INS43 INS42 INS41 INS43 INS42 INS27 INS42 INS32 INS40 INS38 MOV32 INS45 INS42 INS42 INS32 INS42 INS42 INS40 INS42 INS40 MOV21 INS60 MOV43 INS59 INS32 INS42 MOV27 INS42 INS42 INS42 INS42 INS40 INS60 INS21 INS40 INS40 INS43 INS59 INS32 INS42 INS42 INS27 INS42 INS42 INS42 INS42 INS40 UPD45 MOV45 MOV42 MOV45 MOV42 MOV45 DEL42 DEL33 DEL59 DEL60 DEL42 DEL7 DEL42 DEL27 DEL7 DEL21 DEL42 DEL33 DEL27 DEL42 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL25 DEL45 DEL42 DEL42 DEL32 DEL9 DEL41 DEL8 DEL8 DEL25