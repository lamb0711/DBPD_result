JCR-1775: Transaction-safe versioning

All calls to VersionManager's getVersionHistory and createVersionHistory followed this pattern:

    VersionHistory vh = manager.getVersionHistory(...);
    if (vh == null) {
        vh = manager.createVersionHistory(...);
    }

Simplified things by making getVersionHistory() automatically create the version history if it doesn't already exist. This simplifies the client code to:

    VersionHistory vh = manager.getVersionHistory(...);


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@702425 13f79535-47bb-0310-9956-ffa450edef68

-     * Creates a new version history. This action is needed either when creating
-     * a new 'mix:versionable' node or when adding the 'mix:versionable' mixin
-     * to a node.
-     *
-     * @param node
-     * @return
-     * @throws RepositoryException
-     * @see #getVersionHistory(Session, NodeState)
-     */
-    VersionHistory createVersionHistory(Session session, NodeState node)
-            throws RepositoryException;
-
-    /**
-     * Returns the version history of the specified <code>node</code> or
-     * <code>null</code> if the given node doesn't (yet) have an associated
-     * version history.
+     * Returns the version history of the specified node. If the given node
+     * does not already have an associated version history, then an empty
+     * history is automatically created. This method should only be called
+     * by code that already knows that the specified node is versionable.
-     * @return the version history of the specified <code>node</code> or
-     *         <code>null</code> if the given node doesn't (yet) have an
-     *        associated version history.
+     * @return the version history of the specified node
-     * @see #createVersionHistory(Session, NodeState)

UPD66 UPD66 INS66 UPD66 UPD66 DEL66 DEL66 DEL66 DEL65 DEL42 DEL65 DEL65 DEL42 DEL65 DEL42 DEL42 DEL43 DEL69 DEL42 DEL43 DEL69 DEL68 DEL65 DEL29 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL31 DEL66 DEL66 DEL42 DEL42 DEL43 DEL69 DEL42 DEL43 DEL69 DEL68 DEL65