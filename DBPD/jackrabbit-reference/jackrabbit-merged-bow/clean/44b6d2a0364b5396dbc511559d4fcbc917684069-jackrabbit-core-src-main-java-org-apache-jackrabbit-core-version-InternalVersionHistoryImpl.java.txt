JCR-1775: Transaction-safe versioning

Avoid instantiating full VersionHistoryImpl objects when all we need are the identifiers of the version history and root version nodes.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@702453 13f79535-47bb-0310-9956-ffa450edef68

-     * Creates a new <code>InternalVersionHistory</code> below the given parent
-     * node and with the given name.
+     * Creates a new version history below the given parent node and with
+     * the given name.
-    static InternalVersionHistoryImpl create(AbstractVersionManager vMgr,
-                                             NodeStateEx parent,
-                                             Name name,
-                                             NodeState nodeState)
-            throws RepositoryException {
+    static NodeStateEx create(
+            AbstractVersionManager vMgr, NodeStateEx parent, Name name,
+            NodeState nodeState) throws RepositoryException {
-        return new InternalVersionHistoryImpl(vMgr, pNode);
+        return pNode;

UPD43 UPD42 UPD66 UPD66 INS42 DEL42 DEL43 DEL42 DEL42 DEL14