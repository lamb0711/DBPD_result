JCR-2699: Improve read/write concurrency

It's better to allow the occasional cache overwrite than to block concurrent threads. The locking in SessionState and SISM already prevent concurrent read/write operations that could possibly lead to inconsistencies.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1004223 13f79535-47bb-0310-9956-ffa450edef68

-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-    /** Logger instance */
-    private static Logger log = LoggerFactory.getLogger(ConcurrentCache.class);
-
+     * @return the previous value, or <code>null</code>
-    public void put(K key, V value, long size) {
+    public V put(K key, V value, long size) {
-                log.warn("Overwriting cached entry {} from {} to {}",
-                        new Object[] { key, previous.value, value });
+                return previous.value;
+            } else {
+                return null;

INS43 INS65 INS42 INS66 INS8 INS41 INS41 INS40 INS33 DEL40 DEL26 DEL40 DEL26 DEL66 DEL65 DEL29 DEL83 DEL83 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL43 DEL57 DEL32 DEL59 DEL23 DEL39 DEL42 DEL42 DEL45 DEL42 DEL43 DEL85 DEL5 DEL42 DEL40 DEL42 DEL4 DEL3 DEL32 DEL21