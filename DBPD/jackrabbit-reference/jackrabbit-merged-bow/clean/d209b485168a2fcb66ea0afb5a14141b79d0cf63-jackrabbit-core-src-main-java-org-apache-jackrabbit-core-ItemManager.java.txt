JCR-2418 : Read permission on parent node required to access an item's definition

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@886120 13f79535-47bb-0310-9956-ffa450edef68

-            NodeImpl parent = (NodeImpl) getItem(parentId);
-            parentState = parent.getNodeState();
+            // access the parent state circumventing permission check, since
+            // read permission on the parent isn't required in order to retrieve
+            // a node's definition. see also JCR-2418
+            ItemData parentData = getItemData(parentId, null, false);
+            parentState = (NodeState) parentData.getState();
-            NodeImpl parent = (NodeImpl) getItem(state.getParentId());
+            // retrieve parent in 2 steps in order to avoid the check for
+            // read permissions on the parent which isn't required in order
+            // to read the property's definition. see also JCR-2418.
+            ItemData parentData = getItemData(state.getParentId(), null, false);
+            NodeImpl parent = (NodeImpl) createItemInstance(parentData);

INS60 UPD43 INS43 MOV43 INS59 UPD42 UPD42 INS32 INS11 INS42 UPD42 MOV32 INS42 INS11 UPD42 MOV42 MOV42 INS33 INS9 INS43 INS32 UPD42 INS33 INS9 MOV43 INS32 INS42 UPD42 MOV42 UPD42 MOV42 INS42 INS42 DEL42 DEL43 DEL32 DEL11 DEL32 DEL11