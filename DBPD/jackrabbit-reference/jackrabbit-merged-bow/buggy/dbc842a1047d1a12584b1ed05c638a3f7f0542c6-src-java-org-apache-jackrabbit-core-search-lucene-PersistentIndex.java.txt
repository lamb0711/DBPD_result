Speed up indexing using a volatile index with redo log.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@156632 13f79535-47bb-0310-9956-ffa450edef68

+    /** The underlying filesystem to store the index */
-    PersistentIndex(FileSystem fs,
-                    boolean create,
-                    Analyzer analyzer)
+    /**
+     * Creates a new <code>PersistentIndex</code> based on the file system
+     * <code>fs</code>.
+     * @param fs the underlying file system.
+     * @param create if <code>true</code> an existing index is deleted.
+     * @param analyzer the analyzer for text tokenizing.
+     * @throws IOException if an error occurs while opening / creating the
+     * index.
+     */
+    PersistentIndex(FileSystem fs, boolean create, Analyzer analyzer)
-
+    /**
+     * Merges another index into this persistent index.
+     * @param index the other index to merge.
+     * @throws IOException if an error occurs while merging.
+     */
-        this.getIndexWriter().addIndexes(new IndexReader[]{
-            index.getIndexReader()
+        // commit changes to directory on other index.
+        index.commit();
+        // merge index
+        getIndexWriter().addIndexes(new Directory[]{
+            index.getDirectory()
+    /**
+     * Returns the underlying directory.
+     * @return the directory.
+     * @throws IOException if an error occurs.
+     */

INS29 INS29 INS29 INS29 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS65 INS21 INS65 INS65 INS65 INS66 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS66 INS66 INS42 INS66 INS42 INS66 INS32 INS66 INS66 INS42 INS66 INS42 INS42 UPD5 UPD43 UPD42 UPD42 DEL52