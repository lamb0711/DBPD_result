[JCR-335] Deadlock caused by versioning operations within transaction

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@388178 13f79535-47bb-0310-9956-ffa450edef68

+        /**
+         * Create array that contains all resources that paricipate in this
+         * transactions. Because some resources depend on each other, there is
+         * also a workspace scoped lock resource inserted, that guards the
+         * entire transaction from deadlocks (see JCR-335) 
+         */
-            stateMgr, lockMgr, versionMgr
+            ((XAWorkspace) wsp).getXAResourceBegin(),
+            stateMgr, lockMgr, versionMgr,
+            ((XAWorkspace) wsp).getXAResourceEnd()

INS32 INS32 INS36 INS42 INS36 INS42 INS11 INS11 INS43 INS42 INS43 INS42 INS42 INS42