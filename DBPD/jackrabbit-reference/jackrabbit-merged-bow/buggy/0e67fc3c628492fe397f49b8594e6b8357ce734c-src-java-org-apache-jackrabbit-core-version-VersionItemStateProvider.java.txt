fixed issue JCR-36: NodeTypeRegistry.reregister unregisters dependent types
http://issues.apache.org/jira/browse/JCR-36




git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@123983 13f79535-47bb-0310-9956-ffa450edef68

-            try {
-                NodeTypeRegistry ntReg = getNodeTypeManager().getNodeTypeRegistry();
-                EffectiveNodeType ent = ntReg.buildEffectiveNodeType(new QName[]{NodeTypeRegistry.NT_UNSTRUCTURED});
-                ChildNodeDef cnd = ent.getApplicableChildNodeDef(name, nodeTypeName);
-                def = getNodeTypeManager().getNodeDef(new NodeDefId(cnd));
-            } catch (NodeTypeConflictException e) {
-                String msg = "no definition found in parent node's node type for new node";
-                throw new ConstraintViolationException(msg, re);
-            }
+            NodeTypeRegistry ntReg = getNodeTypeManager().getNodeTypeRegistry();
+            EffectiveNodeType ent = ntReg.getEffectiveNodeType(NodeTypeRegistry.NT_UNSTRUCTURED);
+            ChildNodeDef cnd = ent.getApplicableChildNodeDef(name, nodeTypeName);
+            def = getNodeTypeManager().getNodeDef(new NodeDefId(cnd));
-            return ntReg.buildEffectiveNodeType((QName[]) set.toArray(new QName[set.size()]));
+            return ntReg.getEffectiveNodeType((QName[]) set.toArray(new QName[set.size()]));

MOV54 MOV8 MOV44 MOV8 UPD42 UPD42 INS40 DEL42 DEL43 DEL85 DEL5 DEL40 DEL4 DEL3 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL45 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL14 DEL53 DEL8 DEL8 DEL12 DEL54