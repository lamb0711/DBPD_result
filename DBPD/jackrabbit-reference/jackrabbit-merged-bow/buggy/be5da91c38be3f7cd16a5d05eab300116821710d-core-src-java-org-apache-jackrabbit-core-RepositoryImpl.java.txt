jcr-213  Avoid creation of more than one jackrabbit instance with the same configuration.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@279766 13f79535-47bb-0310-9956-ffa450edef68

+     * repository home lock
+     */
+    private static final String REPOSITORY_LOCK = ".lock";
+
+    /**
+
+        this.acquireRepositoryLock() ;
+
+    
+    /**
+     * Lock the repository home.
+     * @throws RepositoryException
+     *         if the repository lock can not be acquired
+     */
+    private void acquireRepositoryLock() throws RepositoryException {
+        File home = new File(this.repConfig.getHomeDir());
+        File lock  = new File(home, REPOSITORY_LOCK) ;
+        if (lock.exists()) {
+            throw new RepositoryException("The repository home at " + home.getAbsolutePath() + 
+                " appears to be in use. If you are sure it's not in use please delete the file at " + 
+                lock.getAbsolutePath() + ". Probably the repository was not shutdown properly.");
+        }
+        try {
+            lock.createNewFile() ;
+        } catch (IOException e) {
+            throw new RepositoryException("Unable to create lock file at " + lock.getAbsolutePath());
+        }
+    }
+
+    /**
+     * Release repository lock
+     */
+    private void releaseRepositoryLock() {
+        File home = new File(this.repConfig.getHomeDir());
+        File lock  = new File(home, REPOSITORY_LOCK) ;
+        if (!lock.delete()) {
+            log.error("Unable to release repository lock") ;
+        }
+    }
+
+        this.releaseRepositoryLock() ;
+        

INS23 INS31 INS31 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS39 INS42 INS43 INS8 INS29 INS83 INS39 INS42 INS8 INS65 INS42 INS42 INS45 INS21 INS65 INS65 INS42 INS60 INS60 INS25 INS54 INS65 INS60 INS60 INS25 INS21 INS66 INS32 INS66 INS42 INS66 INS43 INS59 INS43 INS59 INS32 INS8 INS8 INS12 INS66 INS43 INS59 INS43 INS59 INS38 INS8 INS32 INS52 INS42 INS42 INS42 INS14 INS42 INS42 INS14 INS42 INS42 INS53 INS21 INS44 INS8 INS42 INS42 INS14 INS42 INS42 INS14 INS32 INS21 INS52 INS42 INS43 INS32 INS43 INS42 INS42 INS14 INS32 INS43 INS42 INS53 INS43 INS32 INS43 INS42 INS42 INS42 INS42 INS32 INS42 INS22 INS42 INS42 INS43 INS27 INS42 INS42 INS42 INS14 INS42 INS22 INS42 INS42 INS42 INS42 INS45 INS52 INS42 INS42 INS45 INS32 INS45 INS32 INS45 INS43 INS27 INS52 INS42 INS42 INS42 INS42 INS42 INS42 INS45 INS32 INS42 INS42