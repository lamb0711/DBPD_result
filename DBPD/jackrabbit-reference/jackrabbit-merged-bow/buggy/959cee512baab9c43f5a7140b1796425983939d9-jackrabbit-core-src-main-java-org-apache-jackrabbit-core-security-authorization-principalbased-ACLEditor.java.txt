 JCR-1588: JSR 283: Access Control

- align principalbased ac editing with latest changes made to JSR 283
   -> getApplicablePolicies(Principal) only returns policies that have not yet been set
   -> getPolicies(Principal) added -> used to modify policies that have been set before

- WorkspaceAccessManagerImpl.grants throws NoSuchWorkspaceException if an invalid
   wspName gets passed... TCK tests would fail if not executed with admin user that
   is covered by shortcut.

- Various improvements to AccessControlProvider handling
   > prevent closure of used provider
   > add AccessControlProvider#isLive that allows to rebuild the provider if it was closed before

- Simplify WriteTest and add test for changes made to principal-based ACLEditor

JCR-2087 Upgrade to Java 5 as the base platform
- use generics in security code (work in progress)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@788450 13f79535-47bb-0310-9956-ffa450edef68

+     * @see AccessControlEditor#getPolicies(Principal)
+     */
+    public JackrabbitAccessControlPolicy[] getPolicies(Principal principal) throws AccessControlException, RepositoryException {
+        if (!session.getPrincipalManager().hasPrincipal(principal.getName())) {
+            throw new AccessControlException("Cannot edit access control: " + principal.getName() +" isn't a known principal.");
+        }
+        JackrabbitAccessControlPolicy acl = getACL(principal);
+        if (acl == null) {
+            return new JackrabbitAccessControlPolicy[0];
+        } else {
+            return new JackrabbitAccessControlPolicy[] {acl};
+        }
+    }
+
+    /**
+            }
+
+            if (!isAccessControlled(acNode)) {
-        return new JackrabbitAccessControlPolicy[] {createTemplate(acNode)};
+        if (!isAccessControlled(acNode)) {
+            return new JackrabbitAccessControlPolicy[] {createTemplate(acNode)};
+        } else {
+            // policy child node has already been created -> set policy has
+            // been called before for this principal and getPolicy is used
+            // to retrieve the ACL template.
+            // no additional applicable policies present.
+            return new JackrabbitAccessControlPolicy[0];
+        }

INS31 INS29 INS83 INS5 INS42 INS44 INS43 INS43 INS8 INS65 INS43 INS85 INS43 INS42 INS42 INS42 INS25 INS60 INS25 INS25 INS68 INS42 INS42 INS38 INS8 INS43 INS59 INS27 INS8 INS8 INS38 INS8 INS8 INS42 INS42 INS69 INS32 INS53 INS42 INS42 INS32 INS42 INS33 INS41 INS41 INS25 INS32 MOV41 INS41 INS43 INS32 INS42 INS32 INS14 INS42 INS42 INS3 INS3 INS38 INS8 INS42 INS42 INS3 INS42 INS42 INS42 INS42 INS42 INS43 INS27 INS5 INS34 INS5 INS4 INS32 MOV41 INS5 INS34 INS42 INS45 INS32 INS45 INS43 INS85 INS43 INS85 INS42 INS42 INS42 INS43 INS85 INS42 INS42 INS42 INS42 INS42