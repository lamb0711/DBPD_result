JCR-890: concurrent read-only access to a session

Use the SessionContext and SessionOperations in search

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@983708 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.SessionImpl;
-import org.apache.jackrabbit.core.ItemManager;
+import org.apache.jackrabbit.core.session.SessionContext;
+import javax.jcr.Workspace;
-     * The session of the user executing this query
+     * Component context of the current session
-    protected final SessionImpl session;
-
-    /**
-     * The item manager of the user executing this query
-     */
-    protected final ItemManager itemMgr;
+    protected final SessionContext sessionContext;
-     * @param session the session of the user executing this query.
-     * @param itemMgr the item manager of the session executing this query.
+     * @param sessionContext component context of the current session
-    public AbstractQueryImpl(SessionImpl session,
-                             ItemManager itemMgr,
-                             SearchIndex index,
-                             PropertyTypeRegistry propReg) {
-        this.session = session;
-        this.itemMgr = itemMgr;
+    public AbstractQueryImpl(
+            SessionContext sessionContext, SearchIndex index,
+            PropertyTypeRegistry propReg) {
+        this.sessionContext = sessionContext;
-        return session.getWorkspace().getQueryManager().getQOMFactory();
+        Workspace workspace = sessionContext.getSessionImpl().getWorkspace();
+        return workspace.getQueryManager().getQOMFactory();

MOV26 UPD40 UPD40 INS31 UPD43 MOV29 INS83 MOV43 INS42 MOV43 INS8 UPD42 UPD42 UPD43 UPD42 INS60 MOV41 UPD66 UPD42 UPD66 UPD42 INS43 INS59 UPD42 UPD42 MOV42 UPD42 MOV42 INS32 UPD42 INS32 INS42 UPD42 MOV42 INS42 INS42 DEL66 DEL65 DEL29 DEL83 DEL83 DEL43 DEL59 DEL23 DEL42 DEL66 DEL65 DEL42 DEL43 DEL42 DEL44 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL42 DEL32 DEL83 DEL42 DEL8 DEL31