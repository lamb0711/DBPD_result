- fixing some versioning persistence problems

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@124539 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.state.NodeState;
-            // assuming only child
-            PersistentNode[] nodes = node.getChildNodes();
-            return nodes.length==0 ? null : (InternalFrozenNode) getVersionManager().getItemByInternal(nodes[0].getUUID());
+            NodeState.ChildNodeEntry entry = node.getState().getChildNodeEntry(VersionManager.NODENAME_FROZEN, 1);
+            if (entry==null) {
+                throw new IllegalStateException("version has no frozen node: " + getId());
+            }
+            return (InternalFrozenNode) getVersionManager().getItemByInternal(entry.getUUID());
-            // ignore
+            throw new IllegalStateException("unable to retrieve frozen node: " + e);
-        return null;

INS26 INS40 INS25 INS41 INS43 INS27 INS8 INS11 INS53 INS40 UPD42 INS42 INS33 INS53 MOV43 MOV32 INS14 INS32 UPD42 INS40 INS34 INS14 INS43 INS27 MOV42 INS42 INS43 INS27 INS42 INS42 INS45 INS42 INS42 INS45 INS32 INS42 DEL42 DEL43 DEL85 DEL5 DEL42 DEL34 DEL2 DEL40 DEL34 DEL27 DEL33 DEL11 DEL16 DEL41 DEL33 DEL41