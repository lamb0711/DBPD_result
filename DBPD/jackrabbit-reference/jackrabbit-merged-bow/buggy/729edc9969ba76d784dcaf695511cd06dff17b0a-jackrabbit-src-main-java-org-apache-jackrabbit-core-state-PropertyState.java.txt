JCR-428 BLOBFileValues might be discarded to early

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@407709 13f79535-47bb-0310-9956-ffa450edef68

+    /**
+     * {@inheritDoc}
+     */
+    protected void pull() {
+        super.pull();
+        if (overlayedState != null && type == PropertyType.BINARY) {
+            // special treatment for blobfile values. un-temp them
+            for (int i=0; i<values.length; i++) {
+                if (values[i].internalValue() instanceof BLOBFileValue) {
+                    BLOBFileValue old = (BLOBFileValue) values[i].internalValue();
+                    BLOBFileValue val = old.copy();
+                    if (old != val) {
+                        // only override if 'copy' returned a new instance
+                        try {
+                            values[i] = InternalValue.create(val, null);
+                        } catch (RepositoryException e) {
+                            // ignore
+                        }
+                    }
+                }
+           }
+        }
+    }
+

INS31 INS29 INS83 INS39 INS42 INS8 INS65 INS21 INS25 INS65 INS48 INS27 INS8 INS42 INS27 INS27 INS24 INS42 INS33 INS42 INS40 INS58 INS27 INS37 INS8 INS39 INS59 INS42 INS40 INS42 INS25 INS42 INS34 INS62 INS8 INS32 INS43 INS60 INS60 INS25 INS2 INS42 INS42 INS43 INS59 INS43 INS59 INS27 INS8 INS42 INS42 INS42 INS42 INS11 INS42 INS42 INS32 INS42 INS42 INS54 INS43 INS32 INS42 INS42 INS8 INS12 INS42 INS2 INS42 INS21 INS44 INS8 INS42 INS42 INS7 INS43 INS42 INS2 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS33