JCR-973 XML import using MacOS X WebDAV client does not work


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@548395 13f79535-47bb-0310-9956-ffa450edef68

-        Node contentNode;
+        Node contentNode = null;
-                // remove all entries in the jcr:content since replacing content
-                // includes properties (DefaultHandler) and nodes (e.g. ZipHandler)
-                if (contentNode.hasNodes()) {
-                    NodeIterator it = contentNode.getNodes();
-                    while (it.hasNext()) {
-                        it.nextNode().remove();
+                // check if nodetype is compatible (might be update of an existing file)
+                if (contentNode.isNodeType(getContentNodeType())) {
+                    // remove all entries in the jcr:content since replacing content
+                    // includes properties (DefaultHandler) and nodes (e.g. ZipHandler)
+                    if (contentNode.hasNodes()) {
+                        NodeIterator it = contentNode.getNodes();
+                        while (it.hasNext()) {
+                            it.nextNode().remove();
+                        }
+                } else {
+                    contentNode.remove();
+                    contentNode = null;
-            } else {
+            }
+            if (contentNode == null) {

MOV8 MOV60 MOV60 MOV25 INS60 MOV41 MOV43 INS59 INS42 MOV8 INS8 INS42 INS33 INS25 INS25 MOV32 INS8 INS27 MOV8 MOV21 INS25 INS42 INS33 INS32 MOV8 INS8 INS42 INS42 INS32 INS21 INS21 INS42 INS32 INS7 INS42 INS42 INS42 INS33 DEL42 DEL59 DEL60 DEL42 DEL25 DEL8