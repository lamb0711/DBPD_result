JCR-2058 JSR 283: VersionManager and new versioning methods
- added jcr:copiedFrom property to version history


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@778802 13f79535-47bb-0310-9956-ffa450edef68

-    private Map xaItems;
+    private Map<NodeId, InternalVersionItem> xaItems;
+     *
+     * @param vMgr the underlying version manager
+     * @param ntReg node type registry
+     * @param session the session
+     * @param cacheFactory cache factory
+     * @throws RepositoryException if a an error occurs
-    protected VersionHistoryInfo createVersionHistory(Session session, NodeState node)
+    protected VersionHistoryInfo createVersionHistory(Session session,
+                                                      NodeState node,
+                                                      NodeId copiedFrom)
-            NodeStateEx state = createVersionHistory(node);
+            NodeStateEx state = createVersionHistory(node, copiedFrom);
-        return vMgr.createVersionHistory(session, node);
+        return vMgr.createVersionHistory(session, node, copiedFrom);
-            item = (InternalVersionItem) xaItems.get(id);
+            item = xaItems.get(id);
-            for (int i = 0; i < vs.length; i++) {
-                xaItems.put(vs[i].getId(), vs[i]);
+            for (InternalVersion v1 : vs) {
+                xaItems.put(v1.getId(), v1);
-            for (int i = 0; i < vs.length; i++) {
-                xaItems.put(vs[i].getId(), vs[i]);
+            for (InternalVersion v1 : vs) {
+                xaItems.put(v1.getId(), v1);
+    @SuppressWarnings("unchecked")
-        Map xaItems = null;
+        Map<NodeId, InternalVersionItem> xaItems = null;
-            xaItems = (Map) tx.getAttribute(ITEMS_ATTRIBUTE_NAME);
+            xaItems = (Map<NodeId, InternalVersionItem>) tx.getAttribute(ITEMS_ATTRIBUTE_NAME);
-                xaItems = new HashMap();
+                xaItems = new HashMap<NodeId, InternalVersionItem>();
+     * @return <code>true</code> if the version manager is in a transaction
+     * @param history source
+     * @return the new copy
+     * @throws RepositoryException if an error occurs
+     * @param item the item to check
+     * @return <code>true</code> if in a different env

INS74 INS44 INS79 MOV43 INS43 INS43 INS65 INS65 INS65 INS65 INS65 INS43 INS42 INS42 INS45 INS65 INS65 INS65 INS65 INS65 INS65 INS42 INS42 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS74 INS66 INS42 INS66 INS66 INS42 INS66 INS42 INS66 INS66 INS42 INS70 INS70 MOV43 INS43 MOV43 INS44 INS42 INS8 INS44 INS42 INS8 INS42 MOV32 INS43 INS42 MOV21 INS43 INS42 MOV21 INS42 INS42 INS42 INS74 INS42 INS42 MOV43 INS43 INS43 INS42 INS42 INS42 INS42 INS74 MOV43 INS43 INS43 INS42 INS42 DEL11 DEL42 DEL42 DEL2 DEL42 DEL42 DEL2 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL40 DEL27 DEL42 DEL37 DEL8 DEL24 DEL42 DEL42 DEL2 DEL42 DEL42 DEL2 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL40 DEL27 DEL42 DEL37 DEL8 DEL24