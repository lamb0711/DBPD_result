JCR-926: configuration for data store in repository.xml

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@573209 13f79535-47bb-0310-9956-ffa450edef68

-                        if (store == null) {
-                            return new InternalValue(BLOBInTempFile.getInstance(value.getStream()));
-                        } else {
-                            return new InternalValue(getBLOBFileValue(store, value.getStream()));
-                        }
+                        return new InternalValue(getBLOBFileValue(store, value.getStream()));
-
-            return new InternalValue(BLOBInTempFile.getInstance(value));
+            return new InternalValue(getBLOBFileValue(null, value));
-     * Create an internal value that is backed by a temporary file (if data store usage is disabled)
-     * or (if it is enabled) in the data store.
+     * Create an internal value that is backed by a temporary file 
+     * (if data store usage is disabled or the store is null)
+     * or in the data store if it is not null and enabled.
-     * @param store the data store
+     * @param store the data store or null to use a temporary file
+        if (USE_DATA_STORE) {
+            return new InternalValue(getBLOBFileValue(null, value));
+        }
-    public static InternalValue create(FileSystemResource value)
-            throws IOException {
+    public static InternalValue create(FileSystemResource value) throws IOException {
+        if (USE_DATA_STORE) {
+            return new InternalValue(BLOBInResource.getInstance(value));
+        }        
+        if (USE_DATA_STORE) {
+            return new InternalValue(BLOBInTempFile.getInstance(value, false));
+        }                
-        assert USE_DATA_STORE;
+        assert USE_DATA_STORE && store != null;
-            return BLOBInDataStore.getInstance(store, in);
+            if (store != null) {
+                return BLOBInDataStore.getInstance(store, in);
+            } else {
+                return BLOBInTempFile.getInstance(in, true);
+            }

INS25 INS25 INS25 UPD66 INS66 UPD66 UPD66 INS42 INS8 INS42 INS8 INS42 INS8 INS27 INS41 INS41 INS41 INS42 INS27 INS25 MOV25 INS14 INS14 INS14 INS42 INS33 INS27 INS8 INS8 INS42 MOV43 INS32 INS43 INS32 INS43 INS32 INS42 INS33 MOV41 INS41 UPD42 INS33 INS42 INS33 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS9 INS32 INS42 INS42 INS42 INS9 DEL42 DEL33 DEL27 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL14 DEL41 DEL8 DEL42 DEL8 DEL25 DEL42 DEL42