JCR-2743: ClassCastException in GroupImpl.isCyclicMembership

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@995401 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.api.security.user.Authorizable;
+import org.apache.jackrabbit.api.security.user.Group;
+import org.apache.jackrabbit.api.security.user.UserManager;
+import org.apache.jackrabbit.commons.flat.BTreeManager;
+import org.apache.jackrabbit.commons.flat.ItemSequence;
+import org.apache.jackrabbit.commons.flat.PropertySequence;
+import org.apache.jackrabbit.commons.flat.Rank;
+import org.apache.jackrabbit.commons.flat.TreeManager;
+import org.apache.jackrabbit.commons.iterator.LazyIteratorChain;
+import org.apache.jackrabbit.core.NodeImpl;
+import org.apache.jackrabbit.core.PropertyImpl;
+import org.apache.jackrabbit.core.session.SessionContext;
+import org.apache.jackrabbit.core.session.SessionWriteOperation;
+import org.apache.jackrabbit.spi.commons.iterator.Iterators;
+import org.apache.jackrabbit.util.Text;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+import javax.jcr.ItemNotFoundException;
+import javax.jcr.Node;
+import javax.jcr.Property;
+import javax.jcr.PropertyType;
+import javax.jcr.RepositoryException;
+import javax.jcr.Value;
+
-import javax.jcr.ItemNotFoundException;
-import javax.jcr.Node;
-import javax.jcr.Property;
-import javax.jcr.PropertyType;
-import javax.jcr.RepositoryException;
-import javax.jcr.Value;
-
-import org.apache.jackrabbit.api.security.user.Authorizable;
-import org.apache.jackrabbit.api.security.user.Group;
-import org.apache.jackrabbit.api.security.user.UserManager;
-import org.apache.jackrabbit.commons.flat.BTreeManager;
-import org.apache.jackrabbit.commons.flat.ItemSequence;
-import org.apache.jackrabbit.commons.flat.PropertySequence;
-import org.apache.jackrabbit.commons.flat.Rank;
-import org.apache.jackrabbit.commons.flat.TreeManager;
-import org.apache.jackrabbit.commons.iterator.LazyIteratorChain;
-import org.apache.jackrabbit.core.NodeImpl;
-import org.apache.jackrabbit.core.PropertyImpl;
-import org.apache.jackrabbit.core.session.SessionContext;
-import org.apache.jackrabbit.core.session.SessionOperation;
-import org.apache.jackrabbit.core.session.SessionWriteOperation;
-import org.apache.jackrabbit.spi.commons.iterator.Iterators;
-import org.apache.jackrabbit.util.Text;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-                    return includeIndirect(toAuthorizables(members, type));
+                    return includeIndirect(toAuthorizables(members, type), type);
-                    return includeIndirect(toAuthorizables(members.iterator(), type));
+                    return includeIndirect(toAuthorizables(members.iterator(), type), type);
-    private Iterator<Authorizable> includeIndirect(final Iterator<Authorizable> authorizables) {
+    private Iterator<Authorizable> includeIndirect(final Iterator<Authorizable> authorizables, final int type) {
-                        return ((Group) authorizable).getMembers();
+                        return ((GroupImpl) authorizable).getMembers(true, type);

MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 INS44 INS83 INS39 INS42 INS42 INS42 INS9 INS42 UPD43 UPD42 DEL40 DEL26