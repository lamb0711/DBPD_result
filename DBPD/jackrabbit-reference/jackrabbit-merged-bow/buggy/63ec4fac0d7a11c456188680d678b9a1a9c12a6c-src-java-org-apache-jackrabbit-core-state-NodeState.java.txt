redesigned transaction support & PersistenceManager

orginal code contributed by dominique pfister, required a lot of tweaking to make it run & work; not thoroughly tested

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@126221 13f79535-47bb-0310-9956-ffa450edef68

-     * Package private constructor
+     * Constructor
+     * @param isTransient   flag indicating whether this state is transient or not
-    protected NodeState(NodeState overlayedState, int initialStatus) {
-        super(overlayedState, initialStatus);
+    public NodeState(NodeState overlayedState, int initialStatus,
+                     boolean isTransient) {
+        super(overlayedState, initialStatus, isTransient);
-        copy(overlayedState);
+        pull();
-     * Package private constructor
+     * Constructor
+     * @param isTransient   flag indicating whether this state is transient or not
-    protected NodeState(String uuid, QName nodeTypeName, String parentUUID, int initialStatus) {
-        super(parentUUID, new NodeId(uuid), initialStatus);
+    public NodeState(String uuid, QName nodeTypeName, String parentUUID,
+                     int initialStatus, boolean isTransient) {
+        super(parentUUID, new NodeId(uuid), initialStatus, isTransient);
+
+    /**
+     * Set the node type name. Needed for deserialization and should therefore
+     * not change the internal status.
+     *
+     * @param nodeTypeName node type name
+     */
+    public synchronized void setNodeTypeName(QName nodeTypeName) {
+        this.nodeTypeName = nodeTypeName;
+    }
+    

INS31 UPD83 INS44 UPD83 INS44 INS29 INS83 INS83 INS39 INS42 INS44 INS8 INS65 INS39 INS42 INS65 INS39 INS42 INS65 INS65 INS43 INS42 INS21 UPD66 INS42 INS66 INS42 UPD66 INS42 INS66 INS42 INS66 INS66 INS42 INS66 INS42 INS7 UPD42 INS22 INS42 INS52 INS42 DEL42