fixed potential NoSuchElementException in RepositoryImpl.shutdown()

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@389129 13f79535-47bb-0310-9956-ffa450edef68

-        while (!activeSessions.isEmpty()) {
-           ((Session) activeSessions.values().iterator().next()).logout();
-       }
+        // (copy sessions to array to avoid ConcurrentModificationException;
+        // manually copy entries rather than calling ReferenceMap#toArray() in
+        // order to work around  http://issues.apache.org/bugzilla/show_bug.cgi?id=25551)
+        int cnt = 0;
+        SessionImpl[] sa = new SessionImpl[activeSessions.size()];
+        for (Iterator it = activeSessions.values().iterator(); it.hasNext(); cnt++) {
+            sa[cnt] = (SessionImpl) it.next();
+        }
+        for (int i = 0; i < sa.length; i++) {
+            if (sa[i] != null) {
+                sa[i].logout();
+            }
+        }

INS60 INS60 INS24 INS24 INS39 INS59 INS5 INS59 INS58 INS32 INS37 INS8 INS58 INS27 INS37 INS8 INS42 INS34 INS43 INS85 INS42 INS3 INS43 INS59 INS42 INS42 INS42 INS21 INS39 INS59 INS42 INS40 INS42 INS25 INS42 INS5 INS32 INS42 INS42 MOV32 INS7 INS42 INS34 INS27 INS8 INS43 INS85 MOV42 UPD42 MOV42 INS2 INS11 INS2 INS33 INS21 INS42 INS42 INS42 UPD43 MOV43 MOV32 INS42 INS42 INS32 UPD42 INS42 INS2 MOV42 INS42 INS42 DEL32 DEL38 DEL11 DEL36 DEL32 DEL21 DEL8 DEL61