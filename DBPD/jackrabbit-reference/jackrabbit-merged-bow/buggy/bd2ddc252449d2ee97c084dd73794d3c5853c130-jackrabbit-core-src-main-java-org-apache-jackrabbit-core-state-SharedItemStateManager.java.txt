JCR-2171: Deadlock in SharedItemStateManager on session.move and node.save

Avoid the deadlock in CachingHierarchyManager by sending update notifications only after the SISM lock has been downgraded.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@792218 13f79535-47bb-0310-9956-ffa450edef68

-                /* Let the shared item listeners know about the change */
-                shared.persisted();
-
+                // Let the shared item listeners know about the change
+                // JCR-2171: This must happen after downgrading the lock!
+                shared.persisted();
+

MOV21