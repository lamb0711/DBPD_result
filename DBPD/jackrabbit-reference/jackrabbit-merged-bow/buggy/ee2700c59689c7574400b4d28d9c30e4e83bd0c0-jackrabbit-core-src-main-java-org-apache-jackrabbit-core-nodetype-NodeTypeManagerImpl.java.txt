JCR-2587: Coarser granularity of node type unregistration notifications

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@927945 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.spi.QNodeDefinition;
-import org.apache.jackrabbit.spi.QNodeDefinition;
+import org.apache.jackrabbit.spi.commons.QNodeTypeDefinitionImpl;
-import org.apache.jackrabbit.spi.commons.nodetype.*;
+import org.apache.jackrabbit.spi.commons.nodetype.AbstractNodeTypeManager;
-import org.apache.jackrabbit.spi.commons.QNodeTypeDefinitionImpl;
-public class NodeTypeManagerImpl extends AbstractNodeTypeManager implements JackrabbitNodeTypeManager,
-        Dumpable, NodeTypeRegistryListener {
+public class NodeTypeManagerImpl extends AbstractNodeTypeManager
+        implements JackrabbitNodeTypeManager, Dumpable, NodeTypeRegistryListener {
-    public void nodeTypeUnregistered(Name ntName) {
+    public void nodeTypesUnregistered(Collection<Name> names) {
-        ntCache.remove(ntName);
+        for (Name name : names) {
+            ntCache.remove(name);
+        }
-            Iterator iter = pdCache.values().iterator();
+            Iterator<PropertyDefinitionImpl> iter = pdCache.values().iterator();
-                PropertyDefinitionImpl pd = (PropertyDefinitionImpl) iter.next();
-                if (ntName.equals(pd.unwrap().getDeclaringNodeType())) {
+                PropertyDefinitionImpl pd = iter.next();
+                if (names.contains(pd.unwrap().getDeclaringNodeType())) {
-            Iterator iter = ndCache.values().iterator();
+            Iterator<NodeDefinitionImpl> iter = ndCache.values().iterator();
-                NodeDefinitionImpl nd = (NodeDefinitionImpl) iter.next();
-                if (ntName.equals(nd.unwrap().getDeclaringNodeType())) {
+                NodeDefinitionImpl nd = iter.next();
+                if (names.contains(nd.unwrap().getDeclaringNodeType())) {

MOV26 MOV26 UPD40 UPD42 INS44 INS74 INS42 INS70 INS43 INS43 MOV44 INS42 INS8 INS42 INS42 UPD42 MOV21 INS74 INS74 UPD42 MOV43 MOV43 MOV43 MOV43 MOV43 MOV43 MOV32 UPD42 UPD42 MOV32 UPD42 UPD42 DEL11 DEL11