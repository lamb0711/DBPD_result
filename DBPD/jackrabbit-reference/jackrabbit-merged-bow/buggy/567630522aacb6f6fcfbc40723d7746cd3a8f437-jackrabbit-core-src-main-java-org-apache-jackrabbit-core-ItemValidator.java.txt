JCR-2170: Remove PropDefId and NodeDefId
- merged changes from sandbox branch

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@816343 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.nodetype.NodeDef;
-import org.apache.jackrabbit.core.nodetype.PropDef;
+import org.apache.jackrabbit.spi.QPropertyDefinition;
+import org.apache.jackrabbit.spi.QItemDefinition;
+import org.apache.jackrabbit.spi.QNodeDefinition;
+    protected final ItemManager itemMgr;
+
-        this(ntReg, hierMgr, session, session.getLockManager(), session.getAccessManager(), session.getRetentionRegistry());
+        this(ntReg, hierMgr, session, session.getLockManager(),
+                session.getAccessManager(), session.getRetentionRegistry(),
+                session.getItemManager());
+     * @param itemMgr    the item manager
-                         RetentionRegistry retentionReg) {
+                         RetentionRegistry retentionReg,
+                         ItemManager itemMgr) {
+        this.itemMgr = itemMgr;
-        NodeDef def = ntReg.getNodeDef(nodeState.getDefinitionId());
+        QNodeDefinition def = itemMgr.getDefinition(nodeState).unwrap();
-        PropDef[] pda = entPrimaryAndMixins.getMandatoryPropDefs();
+        QPropertyDefinition[] pda = entPrimaryAndMixins.getMandatoryPropDefs();
-            PropDef pd = pda[i];
+            QPropertyDefinition pd = pda[i];
-        NodeDef[] cnda = entPrimaryAndMixins.getMandatoryNodeDefs();
+        QItemDefinition[] cnda = entPrimaryAndMixins.getMandatoryNodeDefs();
-            NodeDef cnd = cnda[i];
+            QItemDefinition cnd = cnda[i];
-        PropDef def = ntReg.getPropDef(propState.getDefinitionId());
+        QPropertyDefinition def = itemMgr.getDefinition(propState).unwrap();
-     * @return a <code>NodeDef</code>
+     * @return a <code>QNodeDefinition</code>
-    public NodeDef findApplicableNodeDefinition(Name name,
+    public QNodeDefinition findApplicableNodeDefinition(Name name,
-     * @return a <code>PropDef</code>
+     * @return a <code>QPropertyDefinition</code>
-    public PropDef findApplicablePropertyDefinition(Name name,
+    public QPropertyDefinition findApplicablePropertyDefinition(Name name,
-     * @return a <code>PropDef</code>
+     * @return a <code>QPropertyDefinition</code>
-    public PropDef findApplicablePropertyDefinition(Name name,
+    public QPropertyDefinition findApplicablePropertyDefinition(Name name,

MOV26 MOV26 INS26 INS40 UPD40 UPD40 INS23 INS83 INS83 INS43 INS59 INS44 UPD43 UPD43 UPD43 INS42 INS42 INS65 INS43 INS42 INS21 UPD42 UPD42 UPD42 INS32 INS42 INS66 INS42 INS7 UPD43 UPD5 UPD5 UPD43 UPD66 UPD66 UPD66 INS42 INS42 INS22 INS42 UPD42 UPD43 UPD43 UPD42 INS52 INS42 INS32 UPD42 MOV42 UPD42 UPD43 UPD42 UPD43 INS32 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 MOV42 UPD42 UPD42 UPD42 MOV42 UPD42 MOV42 MOV42 DEL32 DEL32