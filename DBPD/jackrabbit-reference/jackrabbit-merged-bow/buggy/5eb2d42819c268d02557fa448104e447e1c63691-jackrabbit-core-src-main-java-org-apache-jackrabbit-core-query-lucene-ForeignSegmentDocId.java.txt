JSR 283: Shareable nodes support in query

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@763188 13f79535-47bb-0310-9956-ffa450edef68

+     * Empty array of {@link ForeignSegmentDocId}s.
+     */
+    static final ForeignSegmentDocId[] EMPTY_ARRAY = new ForeignSegmentDocId[0];
+
+    /**
-    int getDocumentNumber(MultiIndexReader reader) throws IOException {
-        return reader.getDocumentNumber(this);
+    int[] getDocumentNumbers(MultiIndexReader reader, int[] docNumbers) throws IOException {
+        int doc = reader.getDocumentNumber(this);
+        if (doc == -1) {
+            return EMPTY;
+        } else {
+            if (docNumbers.length == 1) {
+                docNumbers[0] = doc;
+                return docNumbers;
+            } else {
+                return new int[]{doc};
+            }
+        }
-     * not known until resolved in {@link #getDocumentNumber(MultiIndexReader)}.
+     * not known until resolved in {@link DocId#getDocumentNumbers(MultiIndexReader,int[])}.
-     * checked in the method {@link #getDocumentNumber(MultiIndexReader)}.
+     * checked in the method {@link DocId#getDocumentNumbers(MultiIndexReader,int[])}.

INS23 INS29 INS83 INS83 INS5 INS59 INS5 UPD42 INS44 INS8 MOV29 MOV29 INS65 INS43 INS85 INS42 INS3 INS39 INS85 INS5 INS42 INS60 INS25 MOV65 MOV65 INS66 INS65 INS66 INS42 INS5 INS34 INS39 INS85 INS39 INS59 INS27 INS8 INS8 UPD66 UPD66 INS65 UPD66 INS66 INS66 UPD66 INS42 INS43 INS85 INS42 MOV32 INS42 INS38 MOV41 INS25 INS42 INS34 INS42 INS27 INS8 INS8 INS42 UPD42 INS69 INS42 UPD42 INS69 INS40 INS34 INS21 INS41 INS41 INS5 INS5 INS7 INS42 INS3 INS39 INS85 INS39 INS85 INS2 INS42 INS5 INS4 INS42 INS34 INS39 INS85 INS42 DEL39 DEL8 DEL66 DEL66 DEL65