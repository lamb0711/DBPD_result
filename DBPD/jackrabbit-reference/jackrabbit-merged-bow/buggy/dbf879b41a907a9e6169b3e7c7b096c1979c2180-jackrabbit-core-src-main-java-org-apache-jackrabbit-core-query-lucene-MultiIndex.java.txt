JCR-1998: Initialize hierarchy cache on startup

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@748066 13f79535-47bb-0310-9956-ffa450edef68

-        // set index format version
-        CachingMultiIndexReader reader = getIndexReader();
+        // set index format version and at the same time
+        // initialize hierarchy cache if requested.
+        CachingMultiIndexReader reader = getIndexReader(handler.isInitializeHierarchyCache());
+        return getIndexReader(false);
+    }
+
+    /**
+     * Returns an read-only <code>IndexReader</code> that spans alls indexes of this
+     * <code>MultiIndex</code>.
+     *
+     * @param initCache when set <code>true</code> the hierarchy cache is
+     *                  completely initialized before this call returns.
+     *                  Otherwise the cache is initialized in a background
+     *                  thread.
+     * @return an <code>IndexReader</code>.
+     * @throws IOException if an error occurs constructing the <code>IndexReader</code>.
+     */
+    public CachingMultiIndexReader getIndexReader(boolean initCache) throws IOException {
-                        readerList.add(pIdx.getReadOnlyIndexReader());
+                        readerList.add(pIdx.getReadOnlyIndexReader(initCache));

INS31 MOV29 INS83 INS43 INS42 INS43 INS8 INS29 INS44 INS42 INS42 INS41 INS65 INS65 INS65 INS65 INS39 INS42 INS32 INS66 INS66 INS42 INS66 INS66 INS66 INS66 INS66 INS42 INS66 INS42 INS9 INS32 INS42 INS42 INS42