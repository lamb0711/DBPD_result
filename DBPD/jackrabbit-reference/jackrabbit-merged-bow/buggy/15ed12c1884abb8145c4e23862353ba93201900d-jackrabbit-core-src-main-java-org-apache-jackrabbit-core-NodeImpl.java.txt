JCR-726: Improve NodeTypeRegistry.effectiveNodeType()


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@502223 13f79535-47bb-0310-9956-ffa450edef68

+        return getEffectiveNodeType(((NodeState) state).getMixinTypeNames());
+    }
+
+    /**
+     * Small optimization to void double call for mixin types.
+     *
+     * @param mixins the set of mixins
+     * @return the effective node type
+     * @throws RepositoryException if an error occurs
+     */
+    private EffectiveNodeType getEffectiveNodeType(Set mixins)
+            throws RepositoryException {
+
-        // mixin types
-        Set set = ((NodeState) state).getMixinTypeNames();
-        QName[] types = new QName[set.size() + 1];
-        set.toArray(types);
+
+        QName[] types = new QName[mixins.size() + 1];
+        mixins.toArray(types);
-        if (((NodeState) state).getMixinTypeNames().contains(ntName)) {
+        Set mixins = ((NodeState) state).getMixinTypeNames();
+        if (mixins.contains(ntName)) {
-        return getEffectiveNodeType().includesNodeType(ntName);
+        return getEffectiveNodeType(mixins).includesNodeType(ntName);

INS31 MOV29 INS83 INS43 INS42 INS43 INS8 INS29 UPD83 INS44 INS42 INS42 INS41 INS65 INS65 INS65 INS65 MOV43 INS42 INS60 INS32 INS66 INS42 INS66 INS66 INS42 INS66 MOV5 INS43 INS59 INS42 MOV32 UPD42 INS42 INS42 MOV32 INS42 MOV5 INS42 UPD42 DEL42 DEL59 DEL60