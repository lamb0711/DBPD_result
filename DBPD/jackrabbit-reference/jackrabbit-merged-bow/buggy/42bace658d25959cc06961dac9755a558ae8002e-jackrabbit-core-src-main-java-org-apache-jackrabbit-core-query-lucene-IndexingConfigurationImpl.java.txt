JCR-1704: Indexing rules inheritance doesn't work

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@682409 13f79535-47bb-0310-9956-ffa450edef68

+                log.debug("Found rule '{}' for NodeType '{}'", element, element.getNodeTypeName());
-                    if (ntReg.getEffectiveNodeType(ntNames[n]).includesNodeType(
-                            element.getNodeTypeName())) {
+                    if (ntReg.getEffectiveNodeType(ntNames[n]).includesNodeType(element.getNodeTypeName())) {
-                        perNtConfig.add(element);
+                        log.debug("Registering it for name '{}'", ntNames[n]);
+                        perNtConfig.add(new IndexingRule(element, ntNames[n]));
-        private final Map propConfigs = new HashMap();
+        private final Map propConfigs;
-        private final List namePatterns = new ArrayList();
+        private final List namePatterns;
+         * Creates a new indexing rule base on an existing one, but for a
+         * different node type name.
+         *
+         * @param original the existing rule.
+         * @param nodeTypeName the node type name for the rule.
+         */
+        IndexingRule(IndexingRule original, Name nodeTypeName) {
+            this.nodeTypeName = nodeTypeName;
+            this.propConfigs = original.propConfigs;
+            this.namePatterns = original.namePatterns;
+            this.condition = original.condition;
+            this.boost = original.boost;
+        }
+
+        /**
+            this.propConfigs = new HashMap();
+            this.namePatterns = new ArrayList();

INS31 INS29 INS42 INS44 INS44 INS8 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS21 INS21 INS21 INS21 INS21 INS21 INS21 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS7 INS7 INS7 INS7 INS7 INS7 INS7 INS22 INS42 INS22 INS40 INS22 INS40 INS22 INS40 INS22 INS40 INS22 MOV14 INS22 MOV14 INS21 INS52 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS32 INS42 INS42 INS45 INS42 INS32 INS42 INS42 INS21 INS32 INS42 INS42 INS45 INS2 INS14 INS42 INS42 INS43 INS42 INS2 INS42 INS42 INS42 DEL42