JCR-2058 JSR 283: VersionManager and new versioning methods
- added jcr:copiedFrom property to version history


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@778802 13f79535-47bb-0310-9956-ffa450edef68

+     * @return returns the write lock
+     * @return returns the read lock
-    public VersionHistoryInfo getVersionHistory(Session session, NodeState node)
+    public VersionHistoryInfo getVersionHistory(Session session, NodeState node,
+                                                NodeId copiedFrom)
-            info = createVersionHistory(session, node);
+            info = createVersionHistory(session, node, copiedFrom);
-     * @param session
-     * @param node NodeState
+     * @param session repository session
+     * @param node versionable node state
+     * @param copiedFrom node id for the jcr:copiedFrom property
-     * @throws RepositoryException
-     * @see #getVersionHistory(Session, NodeState)
+     * @throws RepositoryException if an error occurrs
+     * @see #getVersionHistory(Session, NodeState, NodeId)
-    protected abstract VersionHistoryInfo createVersionHistory(
-            Session session, NodeState node) throws RepositoryException;
+    protected abstract VersionHistoryInfo createVersionHistory(Session session,
+                                                               NodeState node,
+                                                               NodeId copiedFrom)
+            throws RepositoryException;
+     * @param copiedFrom node id for the jcr:copiedFrom parameter
-     * @throws javax.jcr.RepositoryException
+     * @throws RepositoryException if an error occurs
-    NodeStateEx createVersionHistory(NodeState node)
+    NodeStateEx createVersionHistory(NodeState node, NodeId copiedFrom)
-                InternalVersionHistoryImpl.create(this, parent, name, node);
+                InternalVersionHistoryImpl.create(this, parent, name, node, copiedFrom);
-            for (int i = 0; i < values.length; i++) {
-                InternalVersion pred = history.getVersion(NodeId.valueOf(values[i].getString()));
+            for (Value value: values) {
+                InternalVersion pred = history.getVersion(NodeId.valueOf(value.getString()));
-     * @param item
+     * @param item item that was discarded

INS44 INS44 INS44 INS65 INS65 INS43 INS42 INS65 INS43 INS42 INS65 INS43 INS42 INS66 INS66 INS42 INS66 UPD66 INS42 INS66 INS66 INS42 INS42 INS66 INS42 INS66 INS42 INS66 INS69 INS70 INS43 INS44 INS42 MOV8 INS42 INS43 INS42 INS42 INS42 INS42 INS42 DEL40 DEL42 DEL42 DEL2 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL40 DEL27 DEL42 DEL37 DEL24