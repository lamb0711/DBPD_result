JCR-1605 RepositoryLock does not work on NFS sometimes (configurable repository lock)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@744956 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.util.RepositoryLock;
+import org.apache.jackrabbit.core.util.RepositoryLockMechanism;
-     * the lock that guards instantiation of multiple repositories.
+     * The repository lock mechanism ensures that a repository is only instantiated once.
-    private RepositoryLock repLock;
+    private RepositoryLockMechanism repLock;
-            repLock = new RepositoryLock(repConfig.getHomeDir());
+            repLock = repConfig.getRepositoryLockMechanism();
+            repLock.init(repConfig.getHomeDir());
-        repLock.release();
+        if (repLock != null) {
+            try {
+                repLock.release();
+            } catch (RepositoryException e) {
+                log.error("failed to release the repository lock", e);
+            }            
+        }

UPD40 UPD43 UPD42 INS25 UPD66 INS27 INS8 INS21 INS42 INS33 INS54 INS32 INS8 INS12 INS32 INS42 INS42 MOV32 MOV21 INS44 INS8 INS42 INS42 INS43 INS42 INS21 INS42 INS32 INS42 INS42 INS45 INS42 DEL42 DEL43 DEL14