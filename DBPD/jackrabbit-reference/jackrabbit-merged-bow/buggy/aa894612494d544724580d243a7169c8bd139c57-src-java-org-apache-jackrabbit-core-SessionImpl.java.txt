- adapted versioning again to spec 0.15
- added VirtualItemStateManager for reflecting virtual content


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@55615 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.version.VersionManager;
+     * The version manager for this session
+     */
+    protected final VersionManager versionMgr;
+
+    /**
+        versionMgr = rep.getPersistentVersionManager()==null?null:rep.getPersistentVersionManager().getVersionManager();
+
+        // add virtual item managers only for normal sessions
+        if (!(this instanceof SystemSession)) {
+            try {
+                itemStateMgr.addVirtualItemStateProvider(versionMgr.getVirtualItemStateProvider(itemStateMgr));
+            } catch (Exception e) {
+                log.error("Unable to add vmgr: " + e.toString(), e);
+            }
+        }
+        versionMgr = rep.getPersistentVersionManager()==null?null:rep.getPersistentVersionManager().getVersionManager();
+
+        // add virtual item managers only for normal sessions
+        if (!(this instanceof SystemSession)) {
+            try {
+                itemStateMgr.addVirtualItemStateProvider(versionMgr.getVirtualItemStateProvider(itemStateMgr));
+            } catch (Exception e) {
+                log.error("Unable to add vmgr: " + e.toString(), e);
+            }
+        }

INS26 INS40 INS23 INS29 INS83 INS83 INS43 INS59 INS65 INS42 INS42 INS21 INS25 INS21 INS25 INS66 INS7 INS38 INS8 INS7 INS38 INS8 INS42 INS16 INS36 INS54 INS42 INS16 INS36 INS54 INS27 INS33 INS32 INS62 INS8 INS12 INS27 INS33 INS32 INS62 INS8 INS12 INS32 INS33 INS32 INS42 INS52 INS43 INS21 INS44 INS8 INS32 INS33 INS32 INS42 INS52 INS43 INS21 INS44 INS8 INS42 INS42 INS42 INS42 INS42 INS32 INS43 INS42 INS21 INS42 INS42 INS42 INS42 INS42 INS32 INS43 INS42 INS21 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS27 INS42 INS42 INS42 INS42 INS42 INS42 INS27 INS42 INS45 INS32 INS45 INS32 INS42 INS42 INS42 INS42