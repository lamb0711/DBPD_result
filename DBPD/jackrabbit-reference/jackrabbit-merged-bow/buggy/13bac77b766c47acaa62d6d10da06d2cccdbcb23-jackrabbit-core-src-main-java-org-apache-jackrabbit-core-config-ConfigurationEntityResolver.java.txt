JCR-695: Map configuration file entities to local files.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@493026 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashMap;
+import java.util.Map;
- * public identifiers used for the Jackrabbit configuration files.
+ * public identifiers used for the Jackrabbit configuration files:
- * <li><code>-//The Apache Software Foundation//DTD Workspace//EN</code></li>
- * <li><code>-//The Apache Software Foundation//DTD Repository//EN</code></li>
+ * <li><code>-//The Apache Software Foundation//DTD Jackrabbit 1.0//EN</code></li>
+ * <li><code>-//The Apache Software Foundation//DTD Jackrabbit 1.2//EN</code></li>
- * The public identifiers are mapped to a document type definition
- * file included in the Jackrabbit jar archive.
+ * Also the following system identifiers are mapped to local resources:
+ * <ul>
+ * <li><code>http://jackrabbit.apache.org/dtd/repository-1.2.dtd</code></li>
+ * <li><code>http://jackrabbit.apache.org/dtd/repository-1.0.dtd</code></li>
+ * </ul>
+ * <p>
+ * The public identifiers are mapped to document type definition
+ * files included in the Jackrabbit jar archive.
-     * Public identifier of the repository configuration DTD.
+     * The singleton instance of this class.
-    public static final String REPOSITORY_ID =
-        "-//The Apache Software Foundation//DTD Repository//EN";
+    public static final EntityResolver INSTANCE =
+        new ConfigurationEntityResolver();
-     * Public identifier of the workspace configuration DTD.
+     * Public identifiers.
-    public static final String WORKSPACE_ID =
-        "-//The Apache Software Foundation//DTD Workspace//EN";
+    private final Map publicIds = new HashMap();
-     * Resource path of the internal configuration DTD file.
+     * System identifiers.
-    private static final String CONFIG_DTD =
-            "org/apache/jackrabbit/core/config/config.dtd";
+    private final Map systemIds = new HashMap();
+
+    /**
+     * Creates the singleton instance of this class.
+     */
+    private ConfigurationEntityResolver() {
+        // Apache Jackrabbit 1.2 DTD
+        publicIds.put(
+                "-//The Apache Software Foundation//DTD Jackrabbit 1.2//EN",
+                "repository-1.2.dtd");
+        systemIds.put(
+                "http://jackrabbit.apache.org/dtd/repository-1.2.dtd",
+                "repository-1.2.dtd");
+
+        // Apache Jackrabbit 1.0 DTD
+        publicIds.put(
+                "-//The Apache Software Foundation//DTD Jackrabbit 1.0//EN",
+                "repository-1.0.dtd");
+        systemIds.put(
+                "http://jackrabbit.apache.org/dtd/repository-1.0.dtd",
+                "repository-1.0.dtd");
+    }
-     * {@inheritDoc}
-        if (REPOSITORY_ID.equals(publicId) || WORKSPACE_ID.equals(publicId)) {
-            InputStream dtd =
-                getClass().getClassLoader().getResourceAsStream(CONFIG_DTD);
-            return new InputSource(dtd);
-        } else {
-            return null;
+        String name;
+
+        name = (String) publicIds.get(publicId);
+        if (name != null) {
+            InputStream stream = getClass().getResourceAsStream(name);
+            if (stream != null) {
+                return new InputSource(stream);
+            }
+
+        name = (String) systemIds.get(systemId);
+        if (name != null) {
+            InputStream stream = getClass().getResourceAsStream(name);
+            if (stream != null) {
+                return new InputSource(stream);
+            }
+        }
+
+        return null;

INS26 INS26 INS40 INS40 INS31 INS43 UPD83 INS43 INS43 INS29 INS83 INS42 INS8 INS8 UPD66 UPD66 UPD66 INS66 INS66 INS66 INS66 INS66 INS66 UPD66 UPD66 INS42 UPD42 INS14 INS42 UPD42 INS14 INS42 UPD42 INS14 INS65 INS21 INS21 INS21 INS21 INS60 INS21 MOV25 INS21 INS25 MOV41 UPD66 INS43 UPD66 INS43 UPD66 INS43 INS66 INS32 INS32 INS32 INS32 MOV43 INS59 INS7 UPD27 INS7 INS27 INS8 INS42 INS42 INS42 INS42 INS42 INS45 INS45 INS42 INS42 INS45 INS45 INS42 INS42 INS45 INS45 INS42 INS42 INS45 INS45 INS42 INS42 INS11 INS42 INS33 INS25 INS42 INS11 INS42 INS33 INS60 INS25 MOV43 INS32 INS27 INS8 MOV43 INS32 INS43 INS59 INS27 INS8 INS42 INS42 INS42 INS42 MOV32 INS42 INS33 MOV41 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS33 INS41 UPD42 INS42 INS32 INS42 INS42 INS14 UPD42 INS42 INS43 INS42 INS42 DEL45 DEL83 DEL45 DEL83 DEL45 DEL65 DEL42 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL8 DEL8