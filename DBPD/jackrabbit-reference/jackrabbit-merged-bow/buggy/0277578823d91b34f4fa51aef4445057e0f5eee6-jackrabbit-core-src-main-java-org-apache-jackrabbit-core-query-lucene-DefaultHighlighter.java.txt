JCR-894: rep:excerpt() not working for attribute searches

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@535223 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.HashSet;
-import org.apache.lucene.search.Query;
-     * @param tvec    the term position vector for this hit
-     * @param query   the {@link Query query object} which must already have
-     *                been rewritten into primitive types
-     * @param field   the field name
-     * @param text    the original text that was used to create the tokens.
-     * @param prepend the string used to prepend a highlighted token, for
-     *                example <tt>&quot;&lt;b&gt;&quot;</tt>
-     * @param append  the string used to append a highlighted token, for example
-     *                <tt>&quot;&lt;/b&gt;&quot;</tt>
+     * @param tvec       the term position vector for this hit
+     * @param queryTerms the query terms.
+     * @param text       the original text that was used to create the tokens.
+     * @param prepend    the string used to prepend a highlighted token, for
+     *                   example <tt>&quot;&lt;b&gt;&quot;</tt>
+     * @param append     the string used to append a highlighted token, for
+     *                   example <tt>&quot;&lt;/b&gt;&quot;</tt>
-                                   Query query,
-                                   String field,
+                                   Set queryTerms,
-        return highlight(tvec, query, field, text, prepend, append,
+        return highlight(tvec, queryTerms, text, prepend, append,
-     * @param query        the {@link Query query object} which must already
-     *                     have been rewritten into primitive types
-     * @param field        the field name
+     * @param queryTerms   the query terms.
-                                   Query query,
-                                   String field,
+                                   Set queryTerms,
-        Set extractedTerms = new HashSet();
-        query.extractTerms(extractedTerms);
-        // only keep terms for given field
-        for (Iterator it = extractedTerms.iterator(); it.hasNext(); ) {
-            if (!((Term) it.next()).field().equals(field)) {
-                it.remove();
-            }
-        }
-        String[] terms = new String[extractedTerms.size()];
-        Iterator it = extractedTerms.iterator();
+        String[] terms = new String[queryTerms.size()];
+        Iterator it = queryTerms.iterator();

UPD43 UPD42 MOV43 UPD42 UPD66 UPD42 UPD66 MOV66 UPD66 UPD66 UPD66 UPD66 UPD42 UPD42 UPD66 MOV5 MOV43 UPD42 MOV5 UPD42 UPD42 DEL40 DEL26 DEL40 DEL26 DEL66 DEL42 DEL65 DEL66 DEL66 DEL42 DEL66 DEL65 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL66 DEL65 DEL66 DEL66 DEL42 DEL66 DEL65 DEL42 DEL43 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL43 DEL14 DEL59 DEL60 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL42 DEL32 DEL59 DEL58 DEL42 DEL42 DEL32 DEL42 DEL43 DEL42 DEL42 DEL32 DEL11 DEL36 DEL42 DEL32 DEL42 DEL42 DEL32 DEL38 DEL42 DEL42 DEL32 DEL21 DEL8 DEL25 DEL8 DEL24 DEL42 DEL43