JCR-257: Use separate index for jcr:system tree
- shut down unused query handler when it had been idle for some configurable time

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@358016 13f79535-47bb-0310-9956-ffa450edef68

-    private final Timer flushTimer = new Timer(true);
+    private static final Timer FLUSH_TIMER = new Timer(true);
+
+    /**
+     * Task that is periodically called by {@link #FLUSH_TIMER} and checks
+     * if index should be flushed.
+     */
+    private final TimerTask flushTask;
-     * @param indexDir      the base file system
-     * @param handler       the search handler
-     * @param stateMgr      shared item state manager
-     * @param rootUUID      uuid of the root node
+     * @param indexDir the base file system
+     * @param handler the search handler
+     * @param stateMgr shared item state manager
+     * @param rootUUID uuid of the root node
-        this.redoLog = new RedoLog(new File(indexDir, REDO_LOG));
+        this.redoLog = new RedoLog(new File(indexDir, REDO_LOG)); 
-        startFlushTimer();
+        lastFlushTime = System.currentTimeMillis();
+        flushTask = new TimerTask() {
+            public void run() {
+                checkFlush();
+    }
+        };
+        FLUSH_TIMER.schedule(flushTask, 0, 1000);
-            flushTimer.cancel();
+            flushTask.cancel();
-            log.info("Committed in-memory index in " + time + "ms.");
+            log.debug("Committed in-memory index in " + time + "ms.");
-     * Starts the flush timer that periodically checks if the index
-     * should be flushed. The timer task will call {@link #checkFlush()}.
-     */
-    private void startFlushTimer() {
-        lastFlushTime = System.currentTimeMillis();
-        flushTimer.schedule(new TimerTask() {
-            public void run() {
-                checkFlush();
-            }
-        }, 0, 1000);
-    }
-
-    /**
-                    log.info("Flushing index after being idle for " +
+                    log.debug("Flushing index after being idle for " +

INS23 INS83 INS29 INS83 INS83 INS43 INS59 UPD42 MOV65 MOV42 INS42 MOV21 INS21 UPD66 INS66 UPD66 UPD66 UPD66 UPD66 UPD66 INS7 INS67 INS42 MOV14 INS42 INS42 UPD42 INS34 INS34 INS42 INS42 UPD42 UPD42 UPD42 DEL66 DEL42 DEL68 DEL29 DEL83 DEL39 DEL42 DEL42 DEL42 DEL34 DEL34 DEL32 DEL21 DEL8 DEL31