fixed: move, reorder (work in progress)
fixed: locktoken transfer
fixed: recursive transient removal of invalidated tree fails (restoreTests)
improve: simplify usage of workspace operations
fixed: store original itemId with transient operations in order to properly reflect the changelog upon batch creation
fixed: workspace import doesn't invalidate
fixed: session import uuid handling




git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@513279 13f79535-47bb-0310-9956-ffa450edef68

-        } else {
-            state.checkIsSessionState();
-            if (!state.isValid()) {
-                throw new ItemStateException("Cannot remove an invalid ItemState");
+        }
+
+        state.checkIsSessionState();
+        // if during recursive removal an invalidated entry is found, reload
+        // it in order to determine the current status.
+        if (state.getStatus() == Status.INVALIDATED) {
+            reload(false, false);
+            // check if upon reload the item has been removed -> nothing to do
+            if (Status.isTerminal(state.getStatus())) {
+                return;
-            int oldStatus = state.getStatus();
-            if (oldStatus == Status.NEW) {
+        }
+
+        switch (state.getStatus()) {
+            case Status.NEW:
-            } else {
+                break;
+            case Status.EXISTING:
+            case Status.EXISTING_MODIFIED:
-            }
+                break;
+            default:
+                throw new ItemStateException("Cannot transiently remove an ItemState with status " + Status.getName(state.getStatus()));

INS25 MOV21 INS50 MOV27 MOV8 INS27 INS8 MOV32 INS49 MOV21 INS10 INS49 INS49 MOV21 INS10 INS49 INS53 INS32 INS40 INS21 MOV25 INS40 INS40 INS40 INS14 MOV42 UPD42 MOV42 INS32 INS32 MOV43 INS27 INS42 INS9 INS9 INS42 INS42 INS32 INS41 INS45 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 DEL42 DEL40 DEL27 DEL8 DEL32 DEL38 DEL45 DEL14 DEL53 DEL8 DEL25 DEL39 DEL42 DEL59 DEL60 DEL8