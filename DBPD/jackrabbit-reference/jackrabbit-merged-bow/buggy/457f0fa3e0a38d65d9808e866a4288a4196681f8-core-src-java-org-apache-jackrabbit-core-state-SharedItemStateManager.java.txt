Move preparation of events out of write lock to prevent possible deadlock situations.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@239609 13f79535-47bb-0310-9956-ffa450edef68

+        EventStateCollection events = null;
+        if (obsMgr != null) {
+            events = obsMgr.createEventStateCollection();
+            events.prepareDeleted(local);
+        }
+
-            EventStateCollection events = null;
-                /* prepare the events */
-                if (obsMgr != null) {
-                    events = obsMgr.createEventStateCollection();
+                /* create event states */
+                if (events != null) {
-                    events.prepare();

MOV60 INS25 MOV27 INS8 MOV21 INS21 INS32 INS42 INS42 INS42 INS27 INS42 INS33 DEL42 DEL42 DEL32 DEL21