JCR-2551: Recovery from a lost version history

Use proper logging in RepositoryChecker. Also remove the jcr:isCheckedOut property when fixing a broken version history reference.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@920982 13f79535-47bb-0310-9956-ffa450edef68

+import static org.apache.jackrabbit.core.RepositoryImpl.SYSTEM_ROOT_NODE_ID;
+import static org.apache.jackrabbit.spi.commons.name.NameConstants.JCR_ISCHECKEDOUT;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+    /**
+     * Logger instance.
+     */
+    private static final Logger log =
+        LoggerFactory.getLogger(RepositoryChecker.class);
+
+            log.debug("Checking consistency of node {}", id);
-                    if (child.getId() != RepositoryImpl.SYSTEM_ROOT_NODE_ID) {
+                    if (!SYSTEM_ROOT_NODE_ID.equals(child.getId())) {
-        System.out.println("Fixing workspace issues");
-            System.out.println("... workspace has issues");
+            log.warn("Fixing repository inconsistencies");
+        } else {
+            log.info("No repository inconcistencies found");
-            System.out.println("Checking version history of node " + node.getNodeId());
+            log.debug("Checking version history of node {}", node.getNodeId());
-                e.printStackTrace();
+                log.info("Removing references to a missing version history", e);
+        removeProperty(modified, JCR_ISCHECKEDOUT);

INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS23 INS29 INS83 INS83 INS83 INS43 INS59 INS65 INS42 INS42 INS32 INS21 INS66 INS42 INS42 INS57 INS8 INS32 INS43 INS21 INS21 INS42 INS42 INS42 INS42 INS32 INS32 INS42 INS42 INS45 INS42 INS42 UPD42 UPD45 INS42 INS42 INS45 UPD42 INS42 INS45 MOV32 INS38 UPD42 INS42 INS45 UPD42 INS32 INS42 INS42 MOV32 DEL40 DEL27 DEL40 DEL42 DEL45 DEL32 DEL21 DEL40 DEL40 DEL45 DEL27