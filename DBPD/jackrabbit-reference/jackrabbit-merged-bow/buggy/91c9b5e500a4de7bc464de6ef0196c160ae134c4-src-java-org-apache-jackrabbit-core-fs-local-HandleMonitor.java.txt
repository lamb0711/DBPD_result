[JCR-128] Deleting binary property does not remove 'blob file' in filesystem

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@180292 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.util.LazyFileInputStream;
-import java.io.FileInputStream;
-import java.io.IOException;
+import java.io.FileDescriptor;
-        private class MonitoredInputStream extends InputStream {
-
-            /**
-             * the underlying input stream
-             */
-            private final FileInputStream in;
+        private class MonitoredInputStream extends LazyFileInputStream {
-             * Creates a new stream
-             * @param file
-             * @throws FileNotFoundException
+             * {@inheritDoc}
-                in = new FileInputStream(file);
+                super(file);
+                // register the throwable
+                try {
+                    throw new Exception();
+                } catch (Exception e) {
+                    throwable = e;
+                }
+            }
+
+            /**
+             * {@inheritDoc}
+             */
+            public MonitoredInputStream(FileDescriptor fdObj) {
+                super(fdObj);
+                // register the throwable
+                try {
+                    throw new Exception();
+                } catch (Exception e) {
+                    throwable = e;
+                }
+            }
+
+            /**
+             * {@inheritDoc}
+             */
+            public MonitoredInputStream(String name) throws FileNotFoundException {
+                super(name);
+                // register the throwable
-            /**
-             * {@inheritDoc}
-             */
-            public int available() throws IOException {
-                return in.available();
-            }
-
-            /**
-             * {@inheritDoc}
-             */
-            public void close() throws IOException {
-                in.close();
-                Handle.this.close(this);
-            }
-
-            /**
-             * {@inheritDoc}
-             */
-            public synchronized void reset() throws IOException {
-                in.reset();
-            }
-
-            /**
-             * {@inheritDoc}
-             */
-            public boolean markSupported() {
-                return in.markSupported();
-            }
-
-            /**
-             * {@inheritDoc}
-             */
-            public synchronized void mark(int readlimit) {
-                in.mark(readlimit);
-            }
-
-            /**
-             * {@inheritDoc}
-             */
-            public long skip(long n) throws IOException {
-                return in.skip(n);
-            }
-
-            /**
-             * {@inheritDoc}
-             */
-            public int read(byte b[]) throws IOException {
-                return in.read(b);
-            }
-
-            /**
-             * {@inheritDoc}
-             */
-            public int read(byte b[], int off, int len) throws IOException {
-                return in.read(b, off, len);
-            }
-
-            /**
-             * {@inheritDoc}
-             */
-            public int read() throws IOException {
-                return in.read();
-            }

MOV26 UPD40 UPD40 UPD43 INS31 INS31 UPD42 MOV29 INS83 INS42 MOV44 MOV43 INS8 INS44 MOV29 MOV83 UPD42 MOV42 INS44 UPD43 MOV43 INS8 INS46 INS54 MOV65 INS43 INS42 INS46 INS43 UPD42 MOV42 UPD42 INS46 INS54 INS42 INS8 INS12 INS42 INS42 UPD42 MOV42 INS42 INS8 INS12 INS53 INS44 INS8 INS53 INS44 INS8 INS14 INS43 INS42 MOV21 INS14 INS43 INS42 INS21 INS43 UPD42 MOV42 INS7 INS43 UPD42 MOV42 INS7 UPD42 MOV42 INS42 INS42 UPD42 MOV42 INS42 INS42 DEL66 DEL65 DEL29 DEL83 DEL83 DEL42 DEL43 DEL42 DEL59 DEL23 DEL42 DEL52 DEL42 DEL52 DEL32 DEL66 DEL65 DEL42 DEL65 DEL42 DEL65 DEL42 DEL42 DEL43 DEL42 DEL14 DEL7 DEL21 DEL83 DEL39 DEL42 DEL43 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31 DEL83 DEL39 DEL42 DEL43 DEL42 DEL42 DEL32 DEL21 DEL8 DEL31 DEL83 DEL39 DEL43 DEL42 DEL42 DEL32 DEL21 DEL8 DEL31 DEL65 DEL65 DEL29 DEL83 DEL39 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31 DEL65 DEL65 DEL29 DEL83 DEL83 DEL39 DEL42 DEL39 DEL42 DEL44 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL31 DEL65 DEL65 DEL29 DEL83 DEL39 DEL42 DEL39 DEL44 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31 DEL65 DEL65 DEL29 DEL83 DEL39 DEL42 DEL39 DEL42 DEL85 DEL44 DEL43 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31 DEL65 DEL65 DEL29 DEL83 DEL39 DEL42 DEL39 DEL42 DEL85 DEL44 DEL39 DEL42 DEL44 DEL39 DEL42 DEL44 DEL43 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31 DEL65 DEL65 DEL29 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31