JCR-193, JCR-216, JCR-203, JCR 184 + various minor fixes

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@293331 13f79535-47bb-0310-9956-ffa450edef68

-     * forwards any other property to the super class.
+     * forwards any other property to the super class.<p/>
+     * Note that again no property status is set. Any failure while setting
+     * a property results in an exception (violating RFC 2518).
-     * @see VersionControlledItemCollection#setProperty(org.apache.jackrabbit.webdav.property.DavProperty)
+     * @see DavResource#setProperty(org.apache.jackrabbit.webdav.property.DavProperty)
+     * Handles an attempt to set {@link #JCR_NAMESPACES} and forwards any other
+     * set or remove requests to the super class.
+     * Please note, that RFC 2518 is violated because setting {@link #JCR_NAMESPACES}
+     * is handled out of the order indicated by the set and changes may be persisted
+     * even if altering another property fails.
+     *
-     * @see DavResource#alterProperties(org.apache.jackrabbit.webdav.property.DavPropertySet, org.apache.jackrabbit.webdav.property.DavPropertyNameSet)
+     * @see DefaultItemCollection#alterProperties(org.apache.jackrabbit.webdav.property.DavPropertySet, org.apache.jackrabbit.webdav.property.DavPropertyNameSet)
-    public void alterProperties(DavPropertySet setProperties, DavPropertyNameSet removePropertyNames) throws DavException {
+    public MultiStatusResponse alterProperties(DavPropertySet setProperties, DavPropertyNameSet removePropertyNames) throws DavException {
+        // TODO: respect order of the set and do not persist if super.alterProperties fails
-        super.alterProperties(setProperties, removePropertyNames);
+        return super.alterProperties(setProperties, removePropertyNames);
-            log.error("Failed to access NamespaceRegistry from the session/workspace: " + e.getMessage());
+            log.error("Failed to access NamespaceRegistry: " + e.getMessage());

INS43 INS65 INS42 INS41 UPD66 INS66 INS66 INS66 INS65 INS66 INS66 INS66 INS65 INS66 INS66 MOV48 UPD42 INS67 INS67 UPD42 INS42 INS42 UPD45 DEL39 DEL21