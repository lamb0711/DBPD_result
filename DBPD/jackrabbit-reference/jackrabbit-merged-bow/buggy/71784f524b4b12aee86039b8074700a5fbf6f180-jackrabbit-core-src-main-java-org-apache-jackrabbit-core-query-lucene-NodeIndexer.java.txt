JCR-1609:  new Property Types (WIP...)




git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@779228 13f79535-47bb-0310-9956-ffa450edef68

+import java.net.URI;
-                    addReferenceValue(doc, fieldName, value.getUUID());
+                    addReferenceValue(doc, fieldName, value.getUUID(), false);
+                }
+                break;
+            case PropertyType.WEAKREFERENCE:
+                if (isIndexed(name)) {
+                    addReferenceValue(doc, fieldName, value.getUUID(), true);
+            case PropertyType.URI:
+                if (isIndexed(name)) {
+                    addURIValue(doc, fieldName, value.getURI());
+                }
+                break;
+            // TODO support indexing of BigDecimal (JCR-1609: new Property Types)
+            case PropertyType.DECIMAL:
+
-                throw new IllegalArgumentException("illegal internal value type");
+                throw new IllegalArgumentException("illegal internal value type: " + value.getType());
+     * @param weak          Flag indicating whether it's a WEAKREFERENCE (true) or a REFERENCE (flase)
-    protected void addReferenceValue(Document doc, String fieldName, Object internalValue) {
+    protected void addReferenceValue(Document doc, String fieldName, Object internalValue, boolean weak) {
-                PropertyType.REFERENCE));
+                weak ? PropertyType.WEAKREFERENCE : PropertyType.REFERENCE));
+     * Adds the uri value to the document as the named field.
+     *
+     * @param doc           The document to which to add the field
+     * @param fieldName     The name of the field to add
+     * @param internalValue The value for the field to add to the document.
+     */
+    protected void addURIValue(Document doc, String fieldName, Object internalValue) {
+        URI uri = (URI) internalValue;
+        doc.add(createFieldWithoutNorms(fieldName, uri.toString(),
+                PropertyType.URI));
+    }
+
+    /**

INS26 INS40 INS31 INS44 INS29 INS83 INS39 INS42 INS44 INS44 INS44 INS8 MOV10 MOV10 MOV10 INS65 INS39 INS42 INS65 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS43 INS42 INS60 INS21 INS49 INS25 INS49 INS25 INS10 INS10 INS49 INS42 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS42 INS43 INS59 INS32 INS40 INS32 INS8 INS40 INS32 INS8 INS40 INS42 INS42 INS11 INS42 INS42 INS32 INS42 INS42 INS21 INS42 INS42 INS21 INS27 INS16 INS43 INS42 INS42 INS42 INS32 INS40 INS32 INS32 INS45 INS32 INS42 INS40 INS40 INS42 INS42 INS42 INS9 INS42 INS42 INS42 INS32 INS9 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 DEL45 DEL40