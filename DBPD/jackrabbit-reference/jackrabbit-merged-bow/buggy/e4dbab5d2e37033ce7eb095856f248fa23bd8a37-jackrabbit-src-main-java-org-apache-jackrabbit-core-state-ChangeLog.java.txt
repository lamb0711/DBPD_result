- fixed/tweaked ItemState Serializable support
- fixed minor issue in ChangeLog.merge
- tweaked SimpleDbPersistenceManager.store(PropertyState) and .store(NodeState) methods

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@330828 13f79535-47bb-0310-9956-ffa450edef68

-     * Merge another change log to this change log
+     * Merge another change log with this change log
-        // Remove all states from our added set that have now been deleted
+        // Remove all states from our 'added' set that have now been deleted
-            // also remove from eventual modified state
+            // also remove from possibly modified state
+            } else {
+                // adapt status and replace 'added'
+                state.setStatus(ItemState.STATUS_NEW);
+                addedStates.put(state.getId(), state);
-            addedStates.put(state.getId(), state);
-            deletedStates.remove(state.getId());
+            ItemState deletedState = (ItemState) deletedStates.remove(state.getId());
+            if (deletedState != null) {
+                // the newly 'added' state had previously been deleted;
+                // merging those two operations results in a modified state
+
+                // adapt status/modCount and add to modified
+                state.setStatus(deletedState.getStatus());
+                state.setModCount(deletedState.getModCount());
+                modifiedStates.put(state.getId(), state);
+            } else {
+                addedStates.put(state.getId(), state);
+            }

UPD66 INS60 INS25 INS8 INS43 INS59 INS27 INS8 INS8 INS21 INS21 INS42 INS42 INS11 INS42 INS33 INS21 INS21 MOV21 MOV21 INS32 INS32 INS43 MOV32 INS32 INS32 INS32 INS42 INS42 INS40 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 UPD42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42