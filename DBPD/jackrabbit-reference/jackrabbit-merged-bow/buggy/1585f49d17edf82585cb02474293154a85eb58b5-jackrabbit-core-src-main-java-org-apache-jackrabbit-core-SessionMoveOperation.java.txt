JCR-3291: Prevent the creation of cyclic paths in the transient and persistent states

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1327432 13f79535-47bb-0310-9956-ffa450edef68

+            // Create the transient parent nodes of the target node to prevent 
+            // conflicting and/or cyclic moves. See JCR-3921
+            createTransientParentStates(destParentNode);
+            
+    private void createTransientParentStates(NodeImpl node) throws RepositoryException {
+        while (node.getParentId() != null) {
+            node.getOrCreateTransientItemState();
+            node = (NodeImpl) node.getParent();
+        }
+    }

INS31 INS83 INS39 INS42 INS44 INS43 INS8 INS43 INS42 INS42 INS61 INS42 INS27 INS8 INS21 INS32 INS33 INS21 INS21 INS32 INS42 INS42 INS32 INS7 INS42 INS42 INS42 INS42 INS42 INS11 INS43 INS32 INS42 INS42 INS42