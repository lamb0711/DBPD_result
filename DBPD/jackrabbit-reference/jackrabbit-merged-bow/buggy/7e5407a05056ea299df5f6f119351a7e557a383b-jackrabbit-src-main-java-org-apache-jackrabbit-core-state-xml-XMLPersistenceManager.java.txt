[JCR-317] replace UUID strings by UUID classes in NodeId, etc..

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@378221 13f79535-47bb-0310-9956-ffa450edef68

-    private String buildNodeFolderPath(String uuid) {
+    private String buildNodeFolderPath(NodeId id) {
-        char[] chars = uuid.toCharArray();
+        char[] chars = id.getUUID().toString().toCharArray();
-    private String buildPropFilePath(String parentUUID, QName propName) {
+    private String buildPropFilePath(PropertyId id) {
-            md5.update(propName.getNamespaceURI().getBytes());
-            md5.update(propName.getLocalName().getBytes());
+            md5.update(id.getName().getNamespaceURI().getBytes());
+            md5.update(id.getName().getLocalName().getBytes());
-        return buildNodeFolderPath(parentUUID) + "/" + fileName;
+        return buildNodeFolderPath(id.getParentId()) + "/" + fileName;
-    private String buildNodeFilePath(String uuid) {
-        return buildNodeFolderPath(uuid) + "/" + NODEFILENAME;
+    private String buildNodeFilePath(NodeId id) {
+        return buildNodeFolderPath(id) + "/" + NODEFILENAME;
-    private String buildNodeReferencesFilePath(String uuid) {
-        return buildNodeFolderPath(uuid) + "/" + NODEREFSFILENAME;
+    private String buildNodeReferencesFilePath(NodeId id) {
+        return buildNodeFolderPath(id) + "/" + NODEREFSFILENAME;
-        if (!state.getUUID().equals(walker.getAttribute(UUID_ATTRIBUTE))) {
+        if (!state.getNodeId().getUUID().toString().equals(walker.getAttribute(UUID_ATTRIBUTE))) {
-            state.setParentUUID(parentUUID);
+            state.setParentId(NodeId.valueOf(parentUUID));
-                state.addChildNodeEntry(QName.valueOf(childName), childUUID);
+                state.addChildNodeEntry(QName.valueOf(childName), NodeId.valueOf(childUUID));
-        String parentUUID = walker.getAttribute(PARENTUUID_ATTRIBUTE);
-        if (!parentUUID.equals(state.getParentUUID())) {
+        NodeId parentId = NodeId.valueOf(walker.getAttribute(PARENTUUID_ATTRIBUTE));
+        if (!parentId.equals(state.getParentId())) {
-                    log.warn(state.getId() + ": ignoring empty value of type "
+                    log.warn(state.getPropertyId() + ": ignoring empty value of type "
-        String nodeFilePath = buildNodeFilePath(id.getUUID());
+        String nodeFilePath = buildNodeFilePath(id);
-        String propFilePath = buildPropFilePath(id.getParentUUID(), id.getName());
+        String propFilePath = buildPropFilePath(id);
-        String uuid = state.getUUID();
-        String nodeFilePath = buildNodeFilePath(uuid);
+        NodeId id = state.getNodeId();
+        String nodeFilePath = buildNodeFilePath(id);
-                        + UUID_ATTRIBUTE + "=\"" + state.getUUID() + "\" "
-                        + PARENTUUID_ATTRIBUTE + "=\"" + (state.getParentUUID() == null ? "" : state.getParentUUID()) + "\" "
+                        + UUID_ATTRIBUTE + "=\"" + id.getUUID() + "\" "
+                        + PARENTUUID_ATTRIBUTE + "=\"" + (state.getParentId() == null ? "" : state.getParentId().getUUID().toString()) + "\" "
-                            + UUID_ATTRIBUTE + "=\"" + entry.getUUID() + "\">\n");
+                            + UUID_ATTRIBUTE + "=\"" + entry.getId().getUUID().toString() + "\">\n");
-            String msg = "failed to write node state: " + uuid;
+            String msg = "failed to write node state: " + id;
-        String propFilePath = buildPropFilePath(state.getParentUUID(), state.getName());
+        String propFilePath = buildPropFilePath(state.getPropertyId());
-                        + PARENTUUID_ATTRIBUTE + "=\"" + state.getParentUUID() + "\" "
+                        + PARENTUUID_ATTRIBUTE + "=\"" + state.getParentId().getUUID() + "\" "
-                                String blobId = blobStore.createId((PropertyId) state.getId(), i);
+                                String blobId = blobStore.createId(state.getPropertyId(), i);
-            String msg = "failed to store property state: " + state.getParentUUID() + "/" + state.getName();
+            String msg = "failed to store property state: " + state.getParentId() + "/" + state.getName();
-        String uuid = state.getUUID();
-        String nodeFilePath = buildNodeFilePath(uuid);
+        NodeId id = state.getNodeId();
+        String nodeFilePath = buildNodeFilePath(id);
-            String msg = "failed to delete node state: " + uuid;
+            String msg = "failed to delete node state: " + id;
-        String propFilePath = buildPropFilePath(state.getParentUUID(), state.getName());
+        String propFilePath = buildPropFilePath(state.getPropertyId());
-            String msg = "failed to delete property state: " + state.getParentUUID() + "/" + state.getName();
+            String msg = "failed to delete property state: " + state.getParentId() + "/" + state.getName();
-        String uuid = id.getUUID();
-
-        String refsFilePath = buildNodeReferencesFilePath(uuid);
+        String refsFilePath = buildNodeReferencesFilePath(id);
-                throw new NoSuchItemStateException(uuid);
+                throw new NoSuchItemStateException(id.toString());
-        String msg = "failed to load references: " + uuid;
+        String msg = "failed to load references: " + id;
-        String uuid = refs.getUUID();
-        String refsFilePath = buildNodeReferencesFilePath(uuid);
+        NodeReferencesId id = refs.getTargetId();
+        String refsFilePath = buildNodeReferencesFilePath(id);
-            String msg = "failed to store references: " + uuid;
+            String msg = "failed to store references: " + id;
-        String uuid = refs.getUUID();
-        String refsFilePath = buildNodeReferencesFilePath(uuid);
+        NodeReferencesId id = refs.getTargetId();
+        String refsFilePath = buildNodeReferencesFilePath(id);
-            String msg = "failed to delete references: " + uuid;
+            String msg = "failed to delete references: " + id;
-            String nodeFilePath = buildNodeFilePath(id.getUUID());
+            String nodeFilePath = buildNodeFilePath(id);
-            String propFilePath = buildPropFilePath(id.getParentUUID(), id.getName());
+            String propFilePath = buildPropFilePath(id);
-            String uuid = id.getUUID();
-            String refsFilePath = buildNodeReferencesFilePath(uuid);
+            String refsFilePath = buildNodeReferencesFilePath(id);

UPD43 UPD42 UPD43 UPD42 UPD43 UPD42 UPD43 UPD42 UPD42 UPD42 UPD42 UPD42 UPD43 UPD43 UPD43 UPD43 UPD43 UPD42 UPD42 INS32 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 INS32 INS32 UPD42 UPD42 INS32 INS42 INS42 INS32 UPD42 INS42 MOV42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 MOV43 MOV32 INS42 INS42 UPD42 MOV42 MOV32 INS42 UPD42 INS32 MOV42 MOV42 MOV42 UPD42 UPD42 UPD42 UPD42 MOV42 INS32 INS42 INS42 MOV42 MOV42 MOV42 UPD42 MOV32 MOV32 MOV42 INS42 INS32 UPD42 UPD42 INS32 UPD42 UPD42 UPD42 MOV42 INS42 INS42 MOV42 MOV32 UPD42 UPD42 INS42 INS42 INS32 UPD42 INS32 INS32 MOV42 INS42 INS32 INS42 INS32 INS42 UPD42 UPD42 INS32 UPD42 MOV42 INS32 MOV42 MOV42 INS42 MOV42 INS42 INS32 MOV42 UPD42 MOV42 DEL42 DEL43 DEL42 DEL44 DEL32 DEL42 DEL32 DEL42 DEL42 DEL32 DEL32 DEL32 DEL42 DEL42 DEL32 DEL42 DEL43 DEL32 DEL11 DEL42 DEL42 DEL32 DEL42 DEL43 DEL42 DEL59 DEL60 DEL42 DEL42 DEL32 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL43