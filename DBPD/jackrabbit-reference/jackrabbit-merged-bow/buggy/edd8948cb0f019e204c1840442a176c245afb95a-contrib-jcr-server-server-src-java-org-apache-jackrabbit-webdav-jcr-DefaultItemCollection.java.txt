JCR-249, JCR-253

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@331281 13f79535-47bb-0310-9956-ffa450edef68

-    private InputStream in;
+    private File content;
-     *
-     * @return
-     * @see org.apache.jackrabbit.webdav.DavResource#getStream()
+        if (!initedProps)  {
-        return in;
+        }
+        if (content != null) {
+            try {
+                return new FileInputStream(content);
+            } catch (FileNotFoundException e) {
+                // should not occur
+                log.error(e.getMessage());
+            }
+        }
+        return null;
-     * In order to add / set any other repository property on the underlaying
+     * In order to add / set any other repository property on the underlying
-     * @param inputCxt
+     * @param inputContext
-    public void addMember(DavResource resource, InputContext inputCxt)
+    public void addMember(DavResource resource, InputContext inputContext)
-            InputStream in = (inputCxt != null) ? inputCxt.getInputStream() : null;
+            InputStream in = (inputContext != null) ? inputContext.getInputStream() : null;
+            String memberName = getItemName(resource.getLocator().getJcrPath());
-                    n.addNode(getItemName(itemPath));
+                    n.addNode(memberName);
-                    n.setProperty(getItemName(itemPath), in);
+                    n.setProperty(memberName, in);
-     * @see org.apache.jackrabbit.webdav.DavResource#addMember(org.apache.jackrabbit.webdav.DavResource)
-     */
-    public void addMember(DavResource resource) throws DavException {
-        InputContext ctx = new InputContext();
-        ctx.setInputStream(resource.getStream());
-        addMember(resource, ctx);
-    }
-
-    /**
-     * while deleting the underlaying item.
+     * while deleting the underlying item.
-     * on the underlaying repository item fails, <code>null</code> is return.
+     * on the underlying repository item fails, <code>null</code> is return.
-     * Creates a lock on this resource by locking the underlaying
+     * Creates a lock on this resource by locking the underlying
-     * {@link javax.jcr.lock lock} present on the underlaying {@link javax.jcr.Node node}
+     * {@link javax.jcr.lock lock} present on the underlying {@link javax.jcr.Node node}
-     * Remove the write lock from this resource by unlocking the underlaying
+     * Remove the write lock from this resource by unlocking the underlying
-     * underlaying repository node allow to reorder this nodes children.
+     * underlying repository node allow to reorder this nodes children.
-     * resource: write locks (exclusive or exclusive session-scoped) in case the underlaying
+     * resource: write locks (exclusive or exclusive session-scoped) in case the underlying
-                File tmpfile = File.createTempFile(prefix, null, null);
-                tmpfile.deleteOnExit();
-                FileOutputStream out = new FileOutputStream(tmpfile);
+                content = File.createTempFile(prefix, null, null);
+                content.deleteOnExit();
+                FileOutputStream out = new FileOutputStream(content);
-                in = new FileInputStream(tmpfile);
-
-                properties.add(new DefaultDavProperty(DavPropertyName.GETCONTENTLENGTH, new Long(tmpfile.length())));
+                properties.add(new DefaultDavProperty(DavPropertyName.GETCONTENTLENGTH, new Long(content.length())));

INS31 MOV43 MOV29 MOV83 MOV43 MOV42 INS8 UPD42 INS25 INS25 INS41 UPD42 INS38 MOV8 INS27 INS8 INS33 UPD66 UPD42 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 INS42 INS42 INS33 INS54 INS60 INS8 INS12 INS43 INS59 INS41 INS44 INS8 INS42 INS42 INS32 INS21 MOV14 UPD43 MOV43 UPD42 MOV42 MOV21 INS42 INS32 INS7 MOV43 UPD42 UPD42 UPD42 INS32 INS42 INS42 MOV32 UPD42 UPD42 UPD42 UPD42 INS42 INS42 MOV43 UPD42 UPD42 UPD42 UPD42 MOV42 UPD42 MOV42 UPD42 DEL42 DEL43 DEL65 DEL40 DEL42 DEL68 DEL65 DEL42 DEL41 DEL31 DEL42 DEL32 DEL42 DEL32 DEL40 DEL42 DEL40 DEL43 DEL69 DEL68 DEL65 DEL29 DEL83 DEL39 DEL42 DEL44 DEL42 DEL43 DEL42 DEL43 DEL42 DEL42 DEL43 DEL14 DEL59 DEL60 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL31 DEL42 DEL59 DEL60 DEL42 DEL7 DEL21