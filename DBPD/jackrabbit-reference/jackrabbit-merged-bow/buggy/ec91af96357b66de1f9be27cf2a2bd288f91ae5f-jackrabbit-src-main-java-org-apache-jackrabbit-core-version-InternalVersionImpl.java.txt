JCR-449 inconsistency in internal version items during commits


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@411154 13f79535-47bb-0310-9956-ffa450edef68

-        InternalValue[] values = node.getPropertyValues(QName.JCR_SUCCESSORS);
-        if (values != null) {
-            InternalVersion[] versions = new InternalVersion[values.length];
-            for (int i = 0; i < values.length; i++) {
-                NodeId vId = new NodeId((UUID) values[i].internalValue());
-                versions[i] = versionHistory.getVersion(vId);
+        try {
+            vMgr.aquireReadLock();
+            InternalValue[] values = node.getPropertyValues(QName.JCR_SUCCESSORS);
+            if (values != null) {
+                InternalVersion[] versions = new InternalVersion[values.length];
+                for (int i = 0; i < values.length; i++) {
+                    NodeId vId = new NodeId((UUID) values[i].internalValue());
+                    versions[i] = versionHistory.getVersion(vId);
+                }
+                return versions;
+            } else {
+                return new InternalVersion[0];
-            return versions;
-        } else {
-            return new InternalVersion[0];
+        } finally {
+            vMgr.releaseReadLock();

INS8 INS54 MOV8 INS8 INS21 INS21 INS32 INS32 INS42 INS42 INS42 INS42