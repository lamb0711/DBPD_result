changed configuration layout and bootstrapping of repository:
- added jndi support
- workspace configuration is now separated from repository config
  

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@54857 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.RepositoryFactory;
+import org.apache.jackrabbit.core.jndi.RegistryHelper;
+import org.apache.jackrabbit.core.config.RepositoryConfig;
+import org.apache.jackrabbit.core.RepositoryImpl;
+import javax.naming.InitialContext;
+import javax.naming.NamingException;
-     * Property for the repositry name
+     * Property for the repository name (used for jndi lookup)
-    public static final String PROP_REPOSITRY_HOME = "org.apache.jackrabbit.repository.home";
+    /**
+     * Property for the repository configuration file (used for repository instantiation)
+     */
+    public static final String PROP_REPOSITORY_CONFIG = "org.apache.jackrabbit.repository.config";
+    /**
+     * Property for the repository home directory (used for repository instantiation)
+     */
+    public static final String PROP_REPOSITORY_HOME = "org.apache.jackrabbit.repository.home";
-    private RepositoryFactory factory;
-
-     * The default repository name is 'localfs'.
+     * The default repository name is 'repo'.
-                String repName = environment.getProperty(PROP_REPOSITORY_NAME, "localfs");
-                String repHome = environment.getProperty(PROP_REPOSITRY_HOME);
-                factory = RepositoryFactory.create(repHome + "/config.xml", repHome);
-                repository = factory.getRepository(repName);
+                String repName = environment.getProperty(PROP_REPOSITORY_NAME, "repo");
+                String repConfig = environment.getProperty(PROP_REPOSITORY_CONFIG);
+                String repHome = environment.getProperty(PROP_REPOSITORY_HOME);
+/*
+                RepositoryConfig repConf = RepositoryConfig.create(repConfig, repHome);
+                repository = RepositoryImpl.create(repConf);
+*/
+                InitialContext ctx = new InitialContext();
+                RegistryHelper.registerRepository(ctx, "repo", repConfig, repHome, true);
+                repository = (Repository) ctx.lookup("repo");
+/*
-                        factory.shutdown();
+                        repository.shutdown();
+*/
+            } catch (NamingException e) {
+                throw new RepositoryStubException(e.toString());

INS26 INS26 INS26 INS26 MOV23 INS40 INS40 UPD40 INS40 INS40 INS29 INS29 UPD83 INS83 INS83 UPD43 INS65 UPD42 UPD45 INS65 UPD42 UPD42 INS45 UPD66 INS66 INS66 UPD66 INS8 INS12 MOV60 INS60 MOV60 INS60 INS21 MOV21 INS44 INS8 MOV43 MOV43 INS59 INS43 INS43 INS59 INS32 INS43 INS42 INS53 INS42 INS32 INS42 INS42 INS42 INS14 UPD42 MOV42 UPD42 MOV42 INS42 INS45 INS42 MOV42 INS9 INS11 INS42 INS14 UPD45 INS42 INS42 INS42 UPD42 INS43 INS43 INS32 UPD43 MOV43 INS32 INS42 INS42 UPD42 MOV42 UPD42 MOV42 INS45 UPD42 UPD42 MOV42 UPD42 MOV42 DEL42 DEL32 DEL42 DEL42 DEL45 DEL27 DEL32 DEL7 DEL21 DEL42 DEL42 DEL32 DEL42 DEL83 DEL39 DEL42 DEL32 DEL21 DEL8 DEL31 DEL1 DEL14 DEL32 DEL21 DEL8