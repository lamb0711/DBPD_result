JCR-623 - Clustering
+ Transmit namespace registrations
+ Transmit nodetype registrations


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@482707 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.cluster.NodeTypeEventChannel;
+import org.apache.jackrabbit.core.cluster.NodeTypeEventListener;
-public class NodeTypeRegistry implements Dumpable {
+public class NodeTypeRegistry implements Dumpable, NodeTypeEventListener {
+     * Node type event channel.
+     */
+    private NodeTypeEventChannel eventChannel;
+
+    /**
+        if (eventChannel != null) {
+            HashSet ntDefs = new HashSet();
+            ntDefs.add(ntd);
+            eventChannel.registered(ntDefs);
+        }
+
+
+        // inform cluster
+        if (eventChannel != null) {
+            eventChannel.registered(ntDefs);
+        }
+
+    //------------------------------------------------< NodeTypeEventListener >
+
+    /**
+     * {@inheritDoc}
+     */
+    public void externalRegistered(Collection ntDefs)
+            throws RepositoryException, InvalidNodeTypeDefException {
+
+        // validate and register new node type definitions
+        internalRegister(ntDefs);
+        // persist new node type definitions
+        for (Iterator iter = ntDefs.iterator(); iter.hasNext();) {
+            NodeTypeDef ntDef = (NodeTypeDef) iter.next();
+            customNTDefs.add(ntDef);
+        }
+        persistCustomNodeTypeDefs(customNTDefs);
+        // notify listeners
+        for (Iterator iter = ntDefs.iterator(); iter.hasNext();) {
+            NodeTypeDef ntDef = (NodeTypeDef) iter.next();
+            notifyRegistered(ntDef.getName());
+        }
+    }
+
+     * Set an event channel to inform about changes.
+     *
+     * @param eventChannel event channel
+     */
+    public void setEventChannel(NodeTypeEventChannel eventChannel) {
+        this.eventChannel = eventChannel;
+        eventChannel.setListener(this);
+    }
+
+
+    /**

INS26 INS26 MOV31 INS40 INS40 INS43 INS23 INS31 MOV43 INS31 INS42 INS29 INS83 INS43 INS59 MOV29 INS83 INS83 INS39 INS42 INS44 INS43 INS43 INS8 INS29 UPD42 INS29 INS83 INS39 INS42 INS44 INS8 INS65 INS42 INS42 INS25 INS43 INS42 INS42 INS42 INS21 INS24 INS21 INS25 INS24 INS65 INS65 INS65 INS43 INS42 INS21 INS21 INS66 INS27 INS8 INS42 INS32 INS58 INS32 INS8 INS32 INS27 INS8 INS58 INS32 INS8 INS65 INS66 INS42 INS66 INS42 INS7 INS32 INS42 INS33 INS60 INS21 INS21 INS42 INS42 INS43 INS59 INS42 INS42 INS60 INS21 INS42 INS42 INS42 INS33 INS21 INS43 INS59 INS42 INS42 INS60 INS21 INS22 INS42 INS42 INS42 INS52 INS43 INS59 INS32 INS32 INS42 INS42 INS32 INS43 INS59 INS32 INS32 INS42 INS42 INS32 INS43 INS59 INS32 INS52 INS42 INS42 INS42 INS14 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS11 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS11 INS42 INS32 INS43 INS43 INS32 INS43 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL83