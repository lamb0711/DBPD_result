JCR-3697 : UserManager not supported error when trying to remove Node in 2.7.2

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1543443 13f79535-47bb-0310-9956-ffa450edef68

-        securityMgr.init(this, getSystemSession(workspaceName));
+        SystemSession systemSession = getSystemSession(workspaceName);
+        securityMgr.init(this, systemSession);
+
+        // initial security specific repository descriptors that are defined
+        // by JackrabbitRepository
+        ValueFactory vf = ValueFactoryImpl.getInstance();
+        boolean hasUserMgt;
+        try {
+            securityMgr.getUserManager(systemSession);
+            hasUserMgt = true;
+        } catch (RepositoryException e) {
+            hasUserMgt = false;
+        }
+        setDescriptor(JackrabbitRepository.OPTION_USER_MANAGEMENT_SUPPORTED, vf.createValue(hasUserMgt));
+
+        boolean hasPrincipalMgt;
+        try {
+            securityMgr.getPrincipalManager(systemSession);
+            hasPrincipalMgt = true;
+        } catch (RepositoryException e) {
+            hasPrincipalMgt = false;
+        }
+        setDescriptor(JackrabbitRepository.OPTION_PRINCIPAL_MANAGEMENT_SUPPORTED, vf.createValue(hasPrincipalMgt));
+        setDescriptor(JackrabbitRepository.OPTION_PRIVILEGE_MANAGEMENT_SUPPORTED, vf.createValue(true));
+
-     * afterwards in order to add custom/overwrite standard repository decriptors.</li>
+     * afterwards in order to add custom/overwrite standard repository descriptors.</li>

INS60 INS60 INS60 INS54 INS21 INS60 INS54 INS21 INS21 INS43 INS59 INS43 INS59 INS39 INS59 INS8 INS12 INS32 INS39 INS59 INS8 INS12 INS32 INS32 UPD66 INS42 INS42 MOV32 INS42 INS42 INS42 INS32 INS42 INS21 INS21 INS44 INS8 INS42 INS40 INS32 INS42 INS21 INS21 INS44 INS8 INS42 INS40 INS32 INS42 INS40 INS32 INS42 INS42 INS32 INS7 INS43 INS42 INS21 INS42 INS42 INS42 INS32 INS7 INS43 INS42 INS21 INS42 INS42 INS42 INS42 INS42 INS9 INS42 INS42 INS42 INS42 INS9 INS42 INS7 INS42 INS42 INS42 INS42 INS9 INS42 INS7 INS42 INS9 INS42 INS9