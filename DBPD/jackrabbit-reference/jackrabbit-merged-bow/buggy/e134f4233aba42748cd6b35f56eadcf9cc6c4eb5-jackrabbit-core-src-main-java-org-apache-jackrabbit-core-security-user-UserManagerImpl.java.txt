JCR-3697 : UserManager not supported error when trying to remove Node in 2.7.2

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1543443 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.api.JackrabbitRepository;
-        UserManager uMgr = ((SessionImpl) node.getSession()).getUserManager();
-        if (uMgr instanceof UserManagerImpl) {
-            UserManagerImpl uMgrImpl = (UserManagerImpl) uMgr;
-            AuthorizableImpl admin = (AuthorizableImpl) uMgrImpl.getAuthorizable(uMgrImpl.adminId);
-            return Text.isDescendantOrEqual(node.getPath(), admin.getNode().getPath());
+        SessionImpl s = (SessionImpl) node.getSession();
+        if (s.getRepository().getDescriptorValue(JackrabbitRepository.OPTION_USER_MANAGEMENT_SUPPORTED).getBoolean()) {
+            UserManager uMgr = s.getUserManager();
+            if (uMgr instanceof UserManagerImpl) {
+                UserManagerImpl uMgrImpl = (UserManagerImpl) uMgr;
+                AuthorizableImpl admin = (AuthorizableImpl) uMgrImpl.getAuthorizable(uMgrImpl.adminId);
+                return Text.isDescendantOrEqual(node.getPath(), admin.getNode().getPath());
+            }

INS26 INS40 INS25 INS43 INS32 INS8 INS42 UPD42 MOV11 INS32 INS42 INS60 MOV25 INS32 INS42 INS40 MOV43 INS59 INS42 INS42 INS42 INS32 INS42 INS42 DEL36 DEL42 DEL32