JCR-442: Committed Nicolas' latest contrib/backup changes (patch-backup-060728.txt) with some modifications.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@426435 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.IOException;
+
+import javax.jcr.LoginException;
+import javax.jcr.RepositoryException;
+
+ * It extends Backup since it is based on the same semantics. However it is not at the same type as a ResourceBackup (indicated by different names)
+ * 
-public class ManagerBackup extends Backup {
+public class BackupManager extends Backup {
-    public ManagerBackup(RepositoryImpl repo, BackupConfig conf) {
+    public BackupManager(RepositoryImpl repo, BackupConfig conf) throws LoginException, RepositoryException {
-        //The repository is a special Resource: it is added here to the list of resource
-        // It is not in the XML Conf file to make it more generic
-        this.conf.getAllResources().add(new RepositoryBackup(repo, conf));
+        //Initiate correctly all objects in allResources
+        Iterator it = this.conf.getAllResources().iterator();
+        
+        while(it.hasNext()) {
+            Backup b = (Backup) it.next();
+            b.init(repo, conf);
+        }
-    public static ManagerBackup create(RepositoryImpl impl, BackupConfig conf2) {
-		return new ManagerBackup(impl, conf2);
+    public static BackupManager create(RepositoryImpl impl, BackupConfig conf2) throws LoginException, RepositoryException {
+		return new BackupManager(impl, conf2);
+     * @throws RepositoryException 
+     * @throws IOException 
-    public void backup(BackupIOHandler h) {
+    public void backup(BackupIOHandler h) throws RepositoryException, IOException {
+        h.initBackup();
-            h.init();
+           

INS26 INS26 INS26 INS40 INS40 INS40 UPD42 UPD42 INS43 INS43 INS8 UPD43 INS43 INS43 INS43 INS43 INS66 INS42 INS42 MOV46 INS60 INS61 UPD42 INS42 INS42 INS65 INS65 INS42 INS42 INS21 INS43 INS59 INS32 INS8 INS42 INS66 INS42 INS66 INS32 INS42 INS42 MOV32 INS42 INS42 INS60 MOV21 UPD43 INS42 INS42 INS42 INS43 INS59 INS32 UPD42 INS42 INS42 INS11 INS42 INS42 INS42 INS42 INS43 INS32 INS42 INS42 INS42 DEL42 DEL42 DEL43 DEL42 DEL42 DEL14 DEL8 DEL42 DEL42 DEL32 DEL21