JCR-3440: Add a special case for cluster startup. This prevents the cluster node taking the global cluster lock on all syncs

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1405767 13f79535-47bb-0310-9956-ffa450edef68

-            sync();
+            syncOnStartup();
-    /**
+    /** 
-     *
+     * 
+     * @param startup indicates if the cluster node is syncing on startup 
+     *        or does a normal sync.
-    public void sync() throws ClusterException {
+    private void internalSync(boolean startup) throws ClusterException {
-                journal.sync();
+                journal.sync(startup);
+
+    }
+
+    /**
+     * Synchronize contents from journal.
+     *
+     * @throws ClusterException if an error occurs
+     */
+    public void sync() throws ClusterException {
+        internalSync(false);
+    }
+
+    /**
+     * Synchronize contents from journal when a {@link ClusterNode} starts up.
+     *
+     * @throws ClusterException if an error occurs
+     */
+    public void syncOnStartup() throws ClusterException {
+        internalSync(true);

INS31 INS31 INS29 UPD83 UPD42 INS44 MOV29 INS83 INS39 INS42 INS43 INS8 INS29 INS83 INS39 INS42 INS43 INS8 INS65 INS65 INS65 INS39 INS42 INS42 INS21 INS65 INS65 INS42 INS21 INS66 INS42 INS66 INS66 INS42 INS66 INS32 INS66 INS65 INS66 INS42 INS66 INS32 INS42 INS9 INS42 INS42 INS9 UPD42 INS42