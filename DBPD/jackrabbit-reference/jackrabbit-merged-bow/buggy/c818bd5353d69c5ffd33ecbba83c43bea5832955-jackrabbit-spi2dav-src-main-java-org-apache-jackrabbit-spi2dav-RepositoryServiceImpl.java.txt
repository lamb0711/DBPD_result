JCR-2108: JSR 283 Observation   (work in progress)

- adjust spi2dav


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@781296 13f79535-47bb-0310-9956-ffa450edef68

-    private static final EventType[] ALL_EVENTS = new EventType[5];
+    private static final EventType[] ALL_EVENTS = new EventType[7];
+        ALL_EVENTS[5] = SubscriptionImpl.getEventType(javax.jcr.observation.Event.NODE_MOVED);
+        ALL_EVENTS[6] = SubscriptionImpl.getEventType(javax.jcr.observation.Event.PERSIST);
-        NamePathResolver resolver = ((SessionInfoImpl) sessionInfo).getNamePathResolver();
+        return getNamePathResolver(((SessionInfoImpl) sessionInfo));
+    }
+
+    private NamePathResolver getNamePathResolver(SessionInfoImpl sessionInfo) {
+        NamePathResolver resolver = sessionInfo.getNamePathResolver();
-    private List buildEventList(Element bundleElement, SessionInfo sessionInfo) {
+    private List buildEventList(Element bundleElement, SessionInfoImpl sessionInfo) {
-            events.add(new EventImpl(eventId, eventPath, parentId, type, evElem));
+
+            events.add(new EventImpl(eventId, eventPath, parentId, type, evElem, getNamePathResolver(sessionInfo), getQValueFactory()));

INS31 INS83 MOV43 INS42 MOV44 MOV43 INS8 UPD83 INS44 INS21 INS21 MOV21 INS41 INS43 INS42 UPD43 UPD34 INS7 INS7 MOV32 MOV36 INS42 INS43 UPD42 INS2 INS32 INS2 INS32 INS42 INS32 INS42 INS34 INS42 INS42 INS40 INS42 INS34 INS42 INS42 INS40 INS42 INS42 INS32 INS32 INS42 INS42 INS42