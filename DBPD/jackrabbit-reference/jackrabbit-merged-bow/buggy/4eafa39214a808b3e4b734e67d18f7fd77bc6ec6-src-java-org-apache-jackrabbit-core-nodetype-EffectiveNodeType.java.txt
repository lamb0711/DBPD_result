- re-implementing Workspace methods (-> work in progress!)
- avoiding "#import bla.*" stmts (in accordance with checkstyle settings)

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@156666 13f79535-47bb-0310-9956-ffa450edef68

-                    /**
-                     * there already exists at least one definition with that
-                     * name; make sure none of them is auto-create
-                     */
+                    // there already exists at least one definition with that name
+                        // make sure none of them is auto-create
-                            String msg = "The item definition for '" + name + "' in node type '" + def.getDeclaringNodeType() + "' conflicts with node type '" + existingDef.getDeclaringNodeType() + "': name collision with auto-create definition";
+                            String msg = "The item definition for '" + name
+                                    + "' in node type '"
+                                    + def.getDeclaringNodeType()
+                                    + "' conflicts with node type '"
+                                    + existingDef.getDeclaringNodeType()
+                                    + "': name collision with auto-create definition";
+                        // check ambiguous definitions
+                        if (def.definesNode() == existingDef.definesNode()) {
+                            if (!def.definesNode()) {
+                                // property definition
+                                PropDef pd = (PropDef) def;
+                                PropDef epd = (PropDef) existingDef;
+                                // compare type & multiValued flag
+                                if (pd.getRequiredType() == epd.getRequiredType()
+                                        && pd.isMultiple() == epd.isMultiple()) {
+                                    // conflict
+                                    String msg = "The property definition for '"
+                                            + name + "' in node type '"
+                                            + def.getDeclaringNodeType()
+                                            + "' conflicts with node type '"
+                                            + existingDef.getDeclaringNodeType()
+                                            + "': ambiguous property definition";
+                                    log.debug(msg);
+                                    throw new NodeTypeConflictException(msg);
+                                }
+                            } else {
+                                // child node definition
+                                // conflict
+                                String msg = "The child node definition for '"
+                                        + name + "' in node type '"
+                                        + def.getDeclaringNodeType()
+                                        + "' conflicts with node type '"
+                                        + existingDef.getDeclaringNodeType()
+                                        + "': ambiguous child node definition";
+                                log.debug(msg);
+                                throw new NodeTypeConflictException(msg);
+                            }
+                        }
-                            String msg = "A property definition in node type '" + def.getDeclaringNodeType() + "' conflicts with node type '" + existing.getDeclaringNodeType() + "': ambiguos residual property definition";
+                            String msg = "A property definition in node type '"
+                                    + def.getDeclaringNodeType()
+                                    + "' conflicts with node type '"
+                                    + existing.getDeclaringNodeType()
+                                    + "': ambiguous residual property definition";
-                        String msg = "A child node definition in node type '" + def.getDeclaringNodeType() + "' conflicts with node type '" + existing.getDeclaringNodeType() + "': ambiguos residual child node definition";
+                        String msg = "A child node definition in node type '"
+                                + def.getDeclaringNodeType()
+                                + "' conflicts with node type '"
+                                + existing.getDeclaringNodeType()
+                                + "': ambiguous residual child node definition";

MOV8 MOV60 MOV25 MOV60 INS61 MOV21 MOV32 MOV8 MOV60 MOV27 INS25 MOV38 INS8 MOV8 INS25 MOV60 MOV60 MOV25 INS27 INS8 INS8 INS32 INS32 INS25 INS60 MOV21 MOV53 INS42 INS42 INS42 INS42 INS38 INS8 INS8 MOV43 INS59 UPD45 UPD45 INS32 INS60 INS60 INS25 INS60 INS21 INS53 INS42 INS27 INS42 INS42 INS43 INS59 INS43 INS59 INS27 INS8 INS43 INS59 INS32 INS14 INS45 MOV32 INS45 MOV32 INS45 INS42 INS42 INS11 INS42 INS42 INS11 INS27 INS27 INS60 INS21 INS53 INS42 INS42 INS27 INS42 INS42 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS32 INS32 INS32 INS32 INS43 INS59 INS32 INS14 INS45 INS42 INS45 INS32 INS45 INS32 INS45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS27 INS42 INS42 INS42 INS43 INS42 INS42 INS42 INS42 INS42 INS45 INS42 INS45 INS32 INS45 INS32 INS45 INS42 INS42 INS42 INS42 INS42 DEL42 DEL45 DEL45 DEL45 DEL27 DEL59 DEL60 DEL8 DEL25 DEL61 DEL8