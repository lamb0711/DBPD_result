JCR-2363 - Node.orderBefore does not check permissions

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@831048 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.security.AccessManager;
+
+        /*
+        make sure the session is allowed to reorder child nodes.
+        since there is no specific privilege for reordering child nodes,
+        test if the the node to be reordered can be removed and added,
+        i.e. treating reorder similar to a move.
+        TODO: properly deal with sns in which case the index would change upon reorder.
+        */
+        AccessManager acMgr = session.getAccessManager();
+        PathBuilder pb = new PathBuilder(getPrimaryPath());
+        pb.addLast(srcName.getName(), srcName.getIndex());
+        Path childPath = pb.getPath();
+        if (!acMgr.isGranted(childPath, Permission.ADD_NODE | Permission.REMOVE_NODE)) {
+            String msg = "Not allowed to reorder child node " + session.getJCRPath(childPath) + ".";
+            log.debug(msg);
+            throw new AccessDeniedException(msg);
+        }
+        

INS26 INS40 INS60 INS60 INS21 INS60 INS25 INS43 INS59 INS43 INS59 INS32 INS43 INS59 INS38 INS8 INS42 INS42 INS32 INS42 INS42 INS14 INS42 INS42 INS32 INS32 INS42 INS42 INS32 INS32 INS60 INS21 INS53 INS42 INS42 INS43 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS27 INS43 INS59 INS32 INS14 INS42 INS42 INS40 INS40 INS42 INS42 INS27 INS42 INS42 INS42 INS43 INS42 INS45 INS32 INS45 INS42 INS42 INS42 INS42