reworked transaction support, contributed by dominique

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@151380 13f79535-47bb-0310-9956-ffa450edef68

-    protected void makePersistent(UpdateOperation update) {
+    protected void makePersistent() {
-            persistentState = update.createNew(transientState.getUUID(),
+            persistentState = stateMgr.createNew(transientState.getUUID(),
-        update.store(persistentState);
+        stateMgr.store(persistentState);
-            NodeReferences refs = stateMgr.getNodeReferences((NodeId) id);
+            NodeReferencesId targetId = new NodeReferencesId(((NodeId) id).getUUID());
+            NodeReferences refs = stateMgr.getNodeReferences(targetId);

UPD42 INS60 INS43 MOV43 INS59 INS42 UPD42 INS14 INS42 INS32 UPD42 INS43 MOV32 INS42 INS42 INS42 INS42 INS36 UPD42 MOV11 DEL42 DEL43 DEL42 DEL44 DEL42