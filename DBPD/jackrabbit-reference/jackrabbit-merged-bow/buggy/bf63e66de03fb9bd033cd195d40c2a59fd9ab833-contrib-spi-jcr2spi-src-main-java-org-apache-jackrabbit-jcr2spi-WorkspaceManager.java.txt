Polling thread should only get events if there are listeners.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@512987 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Collections;
-    private final Set listeners = Collections.synchronizedSet(new HashSet());
+    private final Set listeners = new HashSet();
-        listeners.add(listener);
+        synchronized (listeners) {
+            listeners.add(listener);
+            listeners.notify();
+        }
-        listeners.remove(listener);
+        synchronized (listeners) {
+            listeners.remove(listener);
+        }
-            InternalEventListener[] lstnrs = (InternalEventListener[]) listeners.toArray(new InternalEventListener[listeners.size()]);
+            InternalEventListener[] lstnrs;
+            synchronized (listeners) {
+                lstnrs = (InternalEventListener[]) listeners.toArray(new InternalEventListener[listeners.size()]);
+            }
-                    InternalEventListener[] iel = (InternalEventListener[]) listeners.toArray(new InternalEventListener[0]);
+                    InternalEventListener[] iel;
+                    synchronized (listeners) {
+                        while (listeners.isEmpty()) {
+                            listeners.wait();
+                        }
+                        iel = (InternalEventListener[]) listeners.toArray(new InternalEventListener[0]);
+                    }

INS8 INS8 MOV14 INS51 INS51 INS42 MOV8 INS42 MOV8 INS21 INS51 INS32 INS42 INS8 INS42 INS42 INS21 INS7 INS51 INS42 MOV11 INS42 INS8 INS61 INS21 INS32 INS8 INS7 INS42 INS42 INS21 INS42 MOV11 INS32 INS42 INS42 DEL40 DEL26 DEL42 DEL42 DEL32