JCR-2640: Internal repository context

Commit the first draft patch, more updates to come...

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@948757 13f79535-47bb-0310-9956-ffa450edef68

+     * The component context of the repository that created this workspace.
+     */
+    protected final RepositoryContext repositoryContext;
+
+    /**
-    protected WorkspaceImpl(WorkspaceConfig wspConfig,
-                            SharedItemStateManager stateMgr, RepositoryImpl rep,
-                            SessionImpl session) {
+    protected WorkspaceImpl(
+            WorkspaceConfig wspConfig, SharedItemStateManager stateMgr,
+            RepositoryContext repositoryContext, SessionImpl session) {
-        this.rep = rep;
+        this.repositoryContext = repositoryContext;
+        this.rep = repositoryContext.getRepository();
-        this.hierMgr =
-            new CachingHierarchyManager(rep.getRootNodeId(), this.stateMgr);
+        this.hierMgr = new CachingHierarchyManager(
+                repositoryContext.getRootNodeId(), this.stateMgr);
-                stateMgr, rep.getNodeTypeRegistry(), session.getLockManager(),
-                session, hierMgr);
+                stateMgr, repositoryContext.getNodeTypeRegistry(),
+                session.getLockManager(), session, hierMgr);
-                stateMgr, rep.getNodeTypeRegistry(), session.getLockManager(),
-                session, hierMgr);
+                stateMgr, repositoryContext.getNodeTypeRegistry(),
+                session.getLockManager(), session, hierMgr);
-        return rep.getNamespaceRegistry();
+        return repositoryContext.getNamespaceRegistry();
-                stateMgr, rep.getNodeTypeRegistry(), session.getLockManager(),
-                session, hierMgr);
+                stateMgr, repositoryContext.getNodeTypeRegistry(),
+                session.getLockManager(), session, hierMgr);
-        Importer importer = new WorkspaceImporter(parentPath, this,
-                rep.getNodeTypeRegistry(), uuidBehavior, wspConfig.getImportConfig());
+        Importer importer = new WorkspaceImporter(
+                parentPath, this,
+                repositoryContext.getNodeTypeRegistry(),
+                uuidBehavior, wspConfig.getImportConfig());

INS23 INS29 INS83 INS83 INS43 INS59 INS65 INS42 INS42 UPD43 UPD42 INS21 INS66 UPD42 INS7 MOV43 MOV43 MOV43 INS22 INS42 INS32 UPD42 INS52 INS42 INS42 INS42 MOV43 MOV43 MOV43 UPD42 UPD42 UPD42 UPD42 UPD42 DEL42