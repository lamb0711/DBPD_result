JCR-1564: JSR 283 namespace handling
    - No need for the NamespaceStorage interface, as 
      NamespaceRegistryImpl can just as well call RepositoryService directly

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@655574 13f79535-47bb-0310-9956-ffa450edef68

-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import javax.jcr.NamespaceException;
-import javax.jcr.UnsupportedRepositoryOperationException;
+import org.apache.jackrabbit.spi.RepositoryService;
+import org.apache.jackrabbit.spi.SessionInfo;
+
-    private static Logger log = LoggerFactory.getLogger(NamespaceRegistryImpl.class);
+    /**
+     * Repository service.
+     */
+    private final RepositoryService service;
-    private final NamespaceStorage storage;
+    /**
+     * Session info.
+     */
+    private final SessionInfo info;
-     * @param storage
+     * @param service repository service
+     * @param info session info
-    public NamespaceRegistryImpl(NamespaceStorage storage) {
-        this.storage = storage;
+    public NamespaceRegistryImpl(RepositoryService service, SessionInfo info) {
+        this.service = service;
+        this.info = info;
-    public void registerNamespace(String prefix, String uri) throws NamespaceException, UnsupportedRepositoryOperationException, RepositoryException {
-        storage.registerNamespace(prefix, uri);
+    public void registerNamespace(String prefix, String uri)
+            throws RepositoryException {
+        service.registerNamespace(info, prefix, uri);
-    public void unregisterNamespace(String prefix) throws NamespaceException, UnsupportedRepositoryOperationException, RepositoryException {
-        storage.unregisterNamespace(prefix);
+    public void unregisterNamespace(String prefix) throws RepositoryException {
+        service.unregisterNamespace(info, getURI(prefix));
-        Collection prefixes = storage.getRegisteredNamespaces().keySet();
+        Collection prefixes = service.getRegisteredNamespaces(info).keySet();
-        Collection uris = storage.getRegisteredNamespaces().values();
+        Collection uris = service.getRegisteredNamespaces(info).values();
-     * @see org.apache.jackrabbit.spi.commons.namespace.NamespaceResolver#getURI(String)
-    public String getURI(String prefix) throws NamespaceException {
-        // try to load the uri
-        try {
-            return storage.getURI(prefix);
-        } catch (RepositoryException ex) {
-            log.debug("Internal error while loading registered namespaces.");
-            throw new NamespaceException(prefix + ": is not a registered namespace prefix.");
-        }
+    public String getURI(String prefix) throws RepositoryException {
+        return service.getNamespaceURI(info, prefix);
-     * @see org.apache.jackrabbit.spi.commons.namespace.NamespaceResolver#getPrefix(String)
-    public String getPrefix(String uri) throws NamespaceException {
-        // try to load the prefix
-        try {
-            return storage.getPrefix(uri);
-        } catch (RepositoryException ex) {
-            log.debug("Internal error while loading registered namespaces.");
-            throw new NamespaceException(uri + ": is not a registered namespace uri.");
-        }
+    public String getPrefix(String uri) throws RepositoryException {
+        return service.getNamespacePrefix(info, uri);

MOV26 MOV26 UPD40 UPD40 INS29 UPD83 UPD43 INS29 UPD43 INS44 MOV43 INS8 MOV43 INS8 INS65 UPD42 UPD42 INS65 UPD42 UPD42 INS65 UPD43 UPD42 INS43 INS42 INS21 MOV41 MOV41 INS66 INS66 UPD42 INS66 INS42 INS66 UPD42 INS42 INS7 UPD42 INS22 INS42 UPD42 INS42 UPD42 INS42 INS32 UPD42 UPD42 INS42 UPD42 UPD42 INS42 UPD42 INS52 INS42 INS42 MOV42 UPD42 INS42 UPD42 INS42 DEL40 DEL26 DEL40 DEL26 DEL42 DEL42 DEL42 DEL43 DEL57 DEL32 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL40 DEL42 DEL42 DEL43 DEL69 DEL68 DEL65 DEL42 DEL43 DEL8 DEL42 DEL44 DEL42 DEL42 DEL45 DEL32 DEL21 DEL42 DEL43 DEL42 DEL45 DEL27 DEL14 DEL53 DEL8 DEL12 DEL54 DEL8 DEL40 DEL42 DEL42 DEL43 DEL69 DEL68 DEL65 DEL42 DEL43 DEL8 DEL42 DEL44 DEL42 DEL42 DEL45 DEL32 DEL21 DEL42 DEL43 DEL42 DEL45 DEL27 DEL14 DEL53 DEL8 DEL12 DEL54 DEL8