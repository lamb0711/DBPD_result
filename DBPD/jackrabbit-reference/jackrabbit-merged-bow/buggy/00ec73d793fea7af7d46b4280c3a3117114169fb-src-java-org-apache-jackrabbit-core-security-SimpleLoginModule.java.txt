JCR-81: Implement anonymous login with credentials

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@159358 13f79535-47bb-0310-9956-ffa450edef68

+    /** Name of the anonymous user id option in the LoginModule configuration */
+    private static final String OPT_ANONYMOUS = "anonymousId";
+
+    /** The default user id for anonymous login */
+    private static final String DEFAULT_ANONYMOUS_ID = "anonymous";
+
+    /** Id of an anonymous user login */
+    private String anonymousUserId = DEFAULT_ANONYMOUS_ID;
+
+        String userId = (String) options.get(OPT_ANONYMOUS);
+        if (userId != null) {
+            anonymousUserId = userId;
+        }
-                    // assume the user we authenticated is the UserPrincipal
-                    principals.add(new UserPrincipal(sc.getUserId()));
+                    if (anonymousUserId.equals(sc.getUserId())) {
+                        principals.add(new AnonymousPrincipal());
+                    } else {
+                        // else assume the user we authenticated is the UserPrincipal
+                        principals.add(new UserPrincipal(sc.getUserId()));
+                    }
-            } else {
-                // null credentials, assume AnonymousPrincipal
-                principals.add(new AnonymousPrincipal());
-                authenticated = true;

INS23 INS23 INS23 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS43 INS59 INS65 INS42 INS42 INS45 INS65 INS42 INS42 INS45 INS65 INS42 INS42 INS42 INS60 INS25 INS66 INS66 INS66 INS43 INS59 INS27 INS8 INS42 INS42 INS11 INS42 INS33 INS21 INS43 INS32 INS7 INS42 INS42 INS42 INS42 INS42 INS42 INS25 INS32 INS8 INS8 INS42 INS42 INS32 MOV21 MOV21 INS42 INS42 DEL42 DEL9 DEL7 DEL21 DEL8