JCR-2085 test case (TCK) maintenance for JCR 2.0 (adding MergeActivityTest)
JCR-2058 JSR 283: VersionManager and new versioning methods (adapting to latest spec changes)


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@801413 13f79535-47bb-0310-9956-ffa450edef68

-     * @param version the version to restore
+     * @param v the version to restore
-    protected void restore(NodeStateEx state, Version version, boolean removeExisting)
+    protected void restore(NodeStateEx state, InternalVersion v, boolean removeExisting)
-        InternalVersion v = getVersion(version);
+
-            internalRestore(state, v, new DateVersionSelector(version.getCreated()), removeExisting);
+            internalRestore(state, v, new DateVersionSelector(v.getCreated()), removeExisting);
-     * @param version version to restore
+     * @param v version to restore
-    protected void restore(NodeStateEx parent, Name name, Version version, boolean removeExisting)
+    protected void restore(NodeStateEx parent, Name name, InternalVersion v,
+                           boolean removeExisting)
-        InternalFrozenNode fn = ((VersionImpl) version).getInternalFrozenNode();
+        InternalFrozenNode fn = v.getFrozenNode();
-                InternalVersion v = getVersion(version);
-            restore(state, version, removeExisting);
+            restore(state, v, removeExisting);
-            state.copyFrom(prop);
-            propNames.add(prop.getName());
+            // don't restore jcr:activity
+            Name name = prop.getName();
+            if (!name.equals(NameConstants.JCR_ACTIVITY)) {
+                state.copyFrom(prop);
+                propNames.add(name);
+            }

MOV43 UPD42 MOV43 UPD42 UPD42 UPD42 INS8 INS60 INS25 INS42 UPD42 INS43 INS59 INS38 INS8 UPD42 INS42 INS42 MOV32 INS32 MOV21 MOV21 INS42 INS42 INS40 UPD42 INS42 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL43 DEL42 DEL43 DEL42 DEL11 DEL36 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL8