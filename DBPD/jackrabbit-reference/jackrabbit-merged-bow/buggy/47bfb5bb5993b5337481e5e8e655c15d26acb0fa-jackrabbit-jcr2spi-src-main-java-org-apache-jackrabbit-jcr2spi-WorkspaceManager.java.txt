JCR-2113 : WIP (Contribution by Alfusainey Jallow)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1640892 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.jcr2spi.config.RepositoryConfig;
+import org.apache.jackrabbit.jcr2spi.security.authorization.AccessControlProvider;
+import org.apache.jackrabbit.jcr2spi.security.authorization.AccessControlProviderStub;
+    private final RepositoryConfig config;
-    private final CacheBehaviour cacheBehaviour;
-    private final int pollTimeout;
+    private AccessControlProvider acProvider;
+
-    public WorkspaceManager(RepositoryService service, SessionInfo sessionInfo,
-                            CacheBehaviour cacheBehaviour, int pollTimeout,
-                            boolean observationSupported)
+    public WorkspaceManager(RepositoryConfig config, SessionInfo sessionInfo, boolean observationSupported)
-        this.service = service;
+        this.config = config;
+        this.service = config.getRepositoryService();
-        this.cacheBehaviour = cacheBehaviour;
-        this.pollTimeout = pollTimeout;
+        CacheBehaviour cacheBehaviour = config.getCacheBehaviour();
+    /**
+     * Locates and instantiates an AccessControlProvider implementation.
+     * @return      an access control manager provider.  
+     * @throws      RepositoryException
+     */
+    public AccessControlProvider getAccessControlProvider() throws RepositoryException {
+        if (acProvider == null) {
+            acProvider = AccessControlProviderStub.newInstance(config, service);
+        }
+        return acProvider;
+    }
+
-            changeFeed = createChangeFeed(pollTimeout, observationSupported);
+            changeFeed = createChangeFeed(config.getPollTimeout(), observationSupported);
-        InternalEventListener listener = new HierarchyEventListener(this, hierarchyMgr, cacheBehaviour);
+        InternalEventListener listener = new HierarchyEventListener(this, hierarchyMgr, config.getCacheBehaviour());

INS26 INS26 INS26 MOV23 MOV23 INS40 INS40 INS40 INS31 UPD43 INS43 MOV21 INS29 INS83 INS43 INS42 INS43 INS8 UPD42 UPD42 INS42 UPD42 UPD43 UPD42 INS60 INS65 INS65 INS65 INS42 INS42 INS25 INS41 UPD42 MOV43 INS59 INS66 INS66 INS42 INS27 INS8 INS42 UPD42 INS32 INS42 INS32 INS42 INS33 INS21 UPD42 INS42 INS42 INS42 INS42 INS7 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 UPD42 MOV42 DEL83 DEL39 DEL42 DEL44 DEL39 DEL42 DEL44 DEL42 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL42