JCR-1588: 283 Access Control

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@689499 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.security.AnonymousPrincipal;
+import org.apache.jackrabbit.core.security.AnonymousPrincipal;
+import org.apache.jackrabbit.core.security.SecurityConstants;
+    /**
+     * @see JackrabbitSecurityManager#init(Repository, Session)
+     */
-                anonymID = moduleConfig[i].getProperty(LoginModuleConfig.PARAM_ANONYMOUS_ID, null);
+                anonymID = moduleConfig[i].getProperty(LoginModuleConfig.PARAM_ANONYMOUS_ID);
+        // fallback:
+        if (adminID == null) {
+            log.debug("No adminID defined in LoginModule/JAAS config -> using default.");
+            adminID = SecurityConstants.ADMIN_ID;
+        }
+        if (anonymID == null) {
+            log.debug("No anonymousID defined in LoginModule/JAAS config -> using default.");
+            anonymID = SecurityConstants.ANONYMOUS_ID;
+        }
+
+        } else if (anonymID != null && !subject.getPrincipals(AnonymousPrincipal.class).isEmpty()) {
+            uid = anonymID;
-            // no SimpleCredentials: assume that UserID and principal name
+            // assume that UserID and principal name
-        return authCtxProvider.getAuthContext(creds, subject, systemSession, principalProviderRegistry);
+        return authCtxProvider.getAuthContext(creds, subject, systemSession, principalProviderRegistry, adminID, anonymID);
+
-
-        }
-
-        public boolean hasPrincipal(String principalName) {
-            return true;

MOV26 INS26 INS40 INS29 INS65 INS25 INS25 INS68 INS27 INS8 INS27 INS8 INS25 INS42 INS42 INS69 INS69 INS42 INS33 INS21 INS21 INS42 INS33 INS21 INS21 INS27 INS8 MOV8 INS42 INS42 INS43 INS43 INS32 INS7 INS32 INS7 INS27 INS38 INS21 INS42 INS42 INS42 INS42 INS45 INS42 INS40 INS42 INS42 INS45 INS42 INS40 INS42 INS33 INS32 INS7 INS32 INS42 INS42 INS42 INS42 INS42 INS57 INS43 INS42 DEL33 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL9 DEL41 DEL8 DEL31