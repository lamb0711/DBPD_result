JCR-139: Query for name literal without namespace fails
- coerce string literal to name as soon as it appears as a valid name
- changed coercing behaviour to only work on operations which are not ranges (eq, ne)

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@191426 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.xerces.util.XMLChar;
-                if (node.getOperation() == QueryConstants.OPERATION_LIKE
-                        || node.getOperation() == QueryConstants.OPERATION_NULL
-                        || node.getOperation() == QueryConstants.OPERATION_NOT_NULL) {
-                    stringValues[0] = node.getStringValue();
-                } else {
+                if (node.getOperation() == QueryConstants.OPERATION_EQ_GENERAL
+                        || node.getOperation() == QueryConstants.OPERATION_EQ_VALUE
+                        || node.getOperation() == QueryConstants.OPERATION_NE_GENERAL
+                        || node.getOperation() == QueryConstants.OPERATION_NE_VALUE) {
+                    // only use coercing on non-range operations
+                } else {
+                    stringValues[0] = node.getStringValue();
-            } else if (literal.indexOf(':') > -1) {
+            } else if (XMLChar.isValidName(literal)) {
+                    // also add literal as string value as is
+                    values.add(literal);
-                    // is it a date?
-                    Calendar c = ISO8601.parse(literal);
-                    if (c != null) {
-                        values.add(DateField.timeToString(c.getTimeInMillis()));
-                        log.debug("Coerced " + literal + " into DATE.");
-                    }
+                }
+            } else if (literal.indexOf(':') > -1) {
+                // is it a date?
+                Calendar c = ISO8601.parse(literal);
+                if (c != null) {
+                    values.add(DateField.timeToString(c.getTimeInMillis()));
+                    log.debug("Coerced " + literal + " into DATE.");

INS26 INS40 MOV8 INS27 MOV27 INS27 INS32 INS40 INS32 INS25 UPD40 INS42 INS42 INS42 INS42 INS42 MOV27 MOV8 MOV8 UPD40 UPD40 INS21 INS8 INS32 INS42 INS42 INS42