JCR-2272: Errors during concurrent session import of nodes with same UUIDs

Use ItemStateException instead of IllegalStateException to report ItemState consistency issues.
This avoids problem caused by unexpected RuntimeExceptions going up through the entire call stack.
TODO: We should be more resilient against such issues.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/branches/JCR-2272@1173558 13f79535-47bb-0310-9956-ffa450edef68

-        connect(overlayedState);
+        this.overlayedState = overlayedState;
-    protected void connect(ItemState overlayedState) {
-        if (this.overlayedState != null) {
-            if (this.overlayedState != overlayedState) {
-                throw new IllegalStateException("Item state already connected to another underlying state: " + this);
-            }
+    protected void connect(ItemState overlayedState)
+            throws ItemStateException {
+        if (this.overlayedState != null
+                && this.overlayedState != overlayedState) {
+            throw new ItemStateException(
+                    "Item state already connected to another"
+                            + " underlying state: " + this);
-    protected void reconnect() {
+    protected void reconnect() throws ItemStateException {
-            throw new IllegalStateException(
+            throw new ItemStateException(

INS43 INS43 INS42 INS42 INS7 INS27 MOV8 INS22 INS42 MOV27 MOV27 INS52 INS42 UPD43 UPD43 UPD42 UPD45 INS45 UPD42 DEL42 DEL42 DEL32 DEL25 DEL8