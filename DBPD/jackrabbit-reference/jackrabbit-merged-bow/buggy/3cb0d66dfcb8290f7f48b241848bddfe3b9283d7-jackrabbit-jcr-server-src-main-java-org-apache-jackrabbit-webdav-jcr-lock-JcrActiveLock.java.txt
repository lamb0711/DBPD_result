JCR-3205 - Missing support for lock timeout and ownerHint in jcr-server

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1230688 13f79535-47bb-0310-9956-ffa450edef68

-     * Since jcr locks do not reveal the time left until they expire, {@link #INFINITE_TIMEOUT}
-     * is returned. A missing timeout causes problems with Microsoft clients.
+     * Calculates the milliseconds of the timeout from
+     * {@link javax.jcr.lock.Lock#getSecondsRemaining()}. If the timeout of
+     * jcr lock is undefined or infinite {@link #INFINITE_TIMEOUT} is
+     * returned. A missing timeout causes problems with Microsoft clients.
-        return INFINITE_TIMEOUT;
+        try {
+            long to = lock.getSecondsRemaining();
+            return (to == Long.MAX_VALUE) ? INFINITE_TIMEOUT : to*1000;
+        } catch (RepositoryException e) {
+            return INFINITE_TIMEOUT;
+        }

INS8 INS54 INS66 INS65 UPD66 INS66 INS66 UPD66 INS8 INS12 INS68 INS60 INS41 INS44 MOV8 INS40 INS42 INS39 INS59 INS16 INS43 INS42 INS42 INS32 INS36 INS42 INS27 INS42 INS42 INS42 INS27 INS42 INS34 INS42 INS40