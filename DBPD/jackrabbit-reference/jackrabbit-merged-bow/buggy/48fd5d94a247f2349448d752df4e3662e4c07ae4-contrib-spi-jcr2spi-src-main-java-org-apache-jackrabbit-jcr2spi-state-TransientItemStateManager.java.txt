work in progress

- removeVersion missing
- LockManager/VersionManager: should not rely on observation (todo added)
- Add Operation.persisted() (Impl. still missing) in analogy to ChangeLog.persisted.
- ItemImpl.refresh behaves according to CacheBehaviour flag.
- NodeState: fix classcastexception when accessing state from propertiesInAttic
- ItemState: rename 'refresh()' to 'reload()
- ItemState: move code common to PropertyState and NodeState to ItemState
- ItemState: rename 'reset' to 'merge'
- add common interface ChildItemEntry
- SessionItemStateManager: avoid traversing twice during 'undo'

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@477095 13f79535-47bb-0310-9956-ffa450edef68

-     * Removes the <code>operation</code> from the list of operations.
-     * @param operation the Operation to remove.
-     * @return <code>true</code> if the operation was removed.
-     */
-    boolean removeOperation(Operation operation) {
-        return changeLog.removeOperation(operation);
-    }
-
-    /**
-     * Disposes a collection of {@link org.apache.jackrabbit.jcr2spi.operation.Operation}s.
+     * Remove the states and operations listed in the changeLog from the
+     * internal changeLog.
-     * @param operations the operations.
+     * @param subChangeLog
-    void disposeOperations(Iterator operations) {
-        while (operations.hasNext()) {
-            changeLog.removeOperation((Operation) operations.next());
-        }
+    void dispose(ChangeLog subChangeLog) {
+        changeLog.removeAll(subChangeLog);
-        if (!Status.isValidStatusChange(previousStatus, state.getStatus(), false)) {
-            log.error("ItemState has invalid status: " + state.getStatus());
-            return;
-        }
-

UPD42 INS8 UPD43 UPD42 MOV21 UPD66 UPD66 UPD42 UPD42 UPD42 INS42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL66 DEL65 DEL29 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31 DEL40 DEL65 DEL66 DEL42 DEL43 DEL42 DEL42 DEL32 DEL11 DEL42 DEL42 DEL32 DEL8 DEL61 DEL8 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL9 DEL32 DEL38 DEL42 DEL42 DEL45 DEL42 DEL42 DEL32 DEL27 DEL32 DEL21 DEL41 DEL8 DEL25