Locking and XA
- Introduce internal XA resources
- Add rollback thread that runs when transaction timeout has expired
- Make lock's live attribute transaction-aware
- Make NodeImpl's internalSetProperty protected again 



git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@365558 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.state.TransactionalItemStateManager;
+import org.apache.jackrabbit.core.state.LocalItemStateManager;
-    protected final TransactionalItemStateManager stateMgr;
+    protected final LocalItemStateManager stateMgr;
-        this.stateMgr = new TransactionalItemStateManager(stateMgr, this);
+        this.stateMgr = createItemStateManager(stateMgr);
-    public TransactionalItemStateManager getItemStateManager() {
+    public LocalItemStateManager getItemStateManager() {
+
+    /**
+     * Create the persistent item state manager on top of the shared item
+     * state manager. May be overridden by subclasses.
+     * @param shared shared item state manager
+     * @return local item state manager
+     */
+    protected LocalItemStateManager createItemStateManager(SharedItemStateManager shared) {
+        return new LocalItemStateManager(shared, this);
+    }

UPD40 INS31 UPD43 UPD43 INS29 INS83 INS43 INS42 INS44 INS8 UPD42 UPD42 INS65 INS65 INS65 INS42 INS43 INS42 INS41 INS66 INS66 INS42 INS66 INS66 INS42 INS14 INS32 INS43 INS42 INS52 INS42 INS42 INS42 DEL42 DEL43 DEL42 DEL52 DEL14