JCR-2820: FineGrainedISMLocking problems

Use the transaction id to identify the current thread for locking purposes.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1040090 13f79535-47bb-0310-9956-ffa450edef68

+import static org.apache.jackrabbit.core.TransactionContext.getCurrentThreadId;
+import static org.apache.jackrabbit.core.TransactionContext.isSameThreadId;
+
-    private volatile Thread activeWriterThread;
+    private volatile Object activeWriterId;
-        if (activeWriterThread == Thread.currentThread()) {
+        if (isSameThreadId(activeWriterId, getCurrentThreadId())) {
-                    activeWriterThread = Thread.currentThread();
+                    activeWriterId = getCurrentThreadId();
-                activeWriterThread = null;
+                activeWriterId = null;
-                activeWriterThread = null;
-                if (activeWriterThread != Thread.currentThread()) {
+                if (!isSameThreadId(activeWriterId, getCurrentThreadId())) {

INS26 INS26 INS40 INS40 UPD43 UPD42 UPD42 INS32 INS42 INS42 INS32 UPD42 MOV42 INS38 UPD42 INS32 INS42 INS42 INS32 UPD42 MOV42 UPD42 UPD42 DEL42 DEL42 DEL32 DEL27 DEL42 DEL42 DEL33 DEL7 DEL21 DEL42 DEL42 DEL32 DEL27