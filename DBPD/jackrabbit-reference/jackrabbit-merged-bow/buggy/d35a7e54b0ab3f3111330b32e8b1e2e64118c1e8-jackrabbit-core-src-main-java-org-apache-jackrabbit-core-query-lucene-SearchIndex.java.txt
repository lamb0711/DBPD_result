JCR-890: concurrent read-only access to a session

Use the SessionContext and SessionOperations in search

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@983708 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.session.SessionContext;
+import org.apache.jackrabbit.spi.commons.conversion.NamePathResolver;
-     * @param session the session of the current user creating the query object.
-     * @param itemMgr the item manager of the current user.
+     * @param sessionContext component context of the current session
-    public ExecutableQuery createExecutableQuery(SessionImpl session,
-                                             ItemManager itemMgr,
-                                             String statement,
-                                             String language)
+    public ExecutableQuery createExecutableQuery(
+            SessionContext sessionContext, String statement, String language)
-        QueryImpl query = new QueryImpl(session, itemMgr, this,
-                getContext().getPropertyTypeRegistry(), statement, language, getQueryNodeFactory());
+        QueryImpl query = new QueryImpl(
+                sessionContext, this, getContext().getPropertyTypeRegistry(),
+                statement, language, getQueryNodeFactory());
-     * @param session the session of the current user creating the query
-     *                object.
-     * @param itemMgr the item manager of the current user.
+     * @param sessionContext component context of the current session
-            SessionImpl session,
-            ItemManager itemMgr,
-            QueryObjectModelTree qomTree) throws InvalidQueryException {
-        QueryObjectModelImpl query = new QueryObjectModelImpl(session, itemMgr, this,
-                getContext().getPropertyTypeRegistry(), qomTree);
+            SessionContext sessionContext, QueryObjectModelTree qomTree)
+            throws InvalidQueryException {
+        QueryObjectModelImpl query = new QueryObjectModelImpl(
+                sessionContext, this, getContext().getPropertyTypeRegistry(),
+                qomTree);

INS26 INS26 INS40 INS40 UPD43 UPD42 UPD43 UPD42 UPD42 UPD66 UPD42 UPD42 UPD66 UPD42 MOV43 UPD42 MOV43 UPD42 DEL42 DEL66 DEL65 DEL42 DEL43 DEL42 DEL44 DEL42 DEL66 DEL42 DEL66 DEL65 DEL42 DEL43 DEL42 DEL44 DEL42