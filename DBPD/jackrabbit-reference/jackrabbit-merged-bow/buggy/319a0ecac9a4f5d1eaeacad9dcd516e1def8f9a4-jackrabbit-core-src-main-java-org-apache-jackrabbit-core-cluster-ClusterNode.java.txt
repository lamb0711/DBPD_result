JCR-3275: Audit log

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1308743 13f79535-47bb-0310-9956-ffa450edef68

-     * Logger.
+     * Audit logger.
+     */
+    private static Logger auditLogger = LoggerFactory.getLogger("org.apache.jackrabbit.core.audit");
+
+    /**
+     * Default Logger.
+     * Update counter, used in displaying the number of updates in audit log.
+     */
+    private final AtomicInteger updateCount = new AtomicInteger();
+
+    /**
+         * Attribute name used to store the size of the update.
+         */
+        private static final String ATTRIBUTE_UPDATE_SIZE = "updateSize";
+
+        /**
-                record.update();
-                setRevision(record.getRevision());
-                log.debug("revision {} {}", record.getRevision(), path);
+                long journalUpdateSize = record.update();
+
+                long recordRevision = record.getRevision();
+                setRevision(recordRevision);
+
+                log.debug("Stored record '{}' to Journal ({})", recordRevision, journalUpdateSize);
+
+                long updateSize = (Long)update.getAttribute(ATTRIBUTE_UPDATE_SIZE);
+                updateCount.compareAndSet(Integer.MAX_VALUE, 0);
+
+                auditLogger.info("[{}] {} {} ({})", new Object[]{updateCount.incrementAndGet(), 
+                        record.getRevision(), path, updateSize});
+

INS23 INS23 INS29 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS43 INS59 INS23 INS65 INS42 INS42 INS32 INS65 INS42 INS42 INS14 INS29 INS83 INS83 INS83 INS43 INS59 INS66 INS42 INS42 INS45 UPD66 INS66 INS43 INS65 INS42 INS42 INS45 INS42 INS66 INS60 INS60 INS60 INS21 INS21 INS39 INS59 INS39 INS59 INS39 INS59 INS32 INS32 INS42 MOV32 INS42 MOV32 INS42 UPD45 UPD42 INS42 INS42 INS11 INS42 INS42 INS40 INS34 INS42 INS42 INS45 INS3 INS43 INS32 INS5 INS4 INS42 INS42 INS42 INS42 INS43 INS85 INS32 MOV32 INS42 INS42 INS42 INS42 INS42 DEL21