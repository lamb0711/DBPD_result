JCR-2886 : Add SessionImpl#isAdminOrSystem

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1072095 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.SessionImpl;
-import org.apache.jackrabbit.core.security.principal.AdminPrincipal;
+import javax.jcr.Session;
- * <li>the Session's Subject contains a {@link SystemPrincipal} <i>or</i>
- * an {@link AdminPrincipal}</li>
+ * <li>the Session's represents a system session or a session associated with
+ * the repository's administrator</li>
-        wspAccess = new WorkspaceAccess(wspAccessManager, isSystemOrAdmin(subject));
+        wspAccess = new WorkspaceAccess(wspAccessManager, isSystemOrAdmin(amContext.getSession()));
-     * @param subject The subject associated with the session.
+     * @param s the session
-    private static boolean isSystemOrAdmin(Subject subject) {
-        if (subject == null) {
+    private static boolean isSystemOrAdmin(Session s) {
+        if (s == null || !(s instanceof SessionImpl)) {
-            return !(subject.getPrincipals(SystemPrincipal.class).isEmpty() &&
-                     subject.getPrincipals(AdminPrincipal.class).isEmpty());
+            SessionImpl sImpl = (SessionImpl) s;
+            return sImpl.isSystem() || sImpl.isAdmin();
-        private final boolean isAdmin;
+        private final boolean alwaysAllowed;
-                                boolean isAdmin) {
+                                boolean alwaysAllowed) {
-            this.isAdmin = isAdmin;
-            if (!isAdmin) {
+            this.alwaysAllowed = alwaysAllowed;
+            if (!alwaysAllowed) {
-            if (isAdmin || wspAccessManager == null || allowed.contains(workspaceName)) {
+            if (alwaysAllowed || wspAccessManager == null || allowed.contains(workspaceName)) {

MOV26 INS26 UPD40 INS40 UPD66 UPD66 UPD43 UPD42 UPD42 UPD66 UPD42 INS27 UPD42 UPD42 INS27 INS38 INS60 INS41 UPD42 MOV42 MOV33 INS36 INS43 INS59 INS27 UPD42 UPD42 INS32 INS62 INS42 INS42 INS11 INS32 INS32 UPD42 UPD42 UPD42 MOV42 INS42 INS42 INS43 INS43 INS42 UPD42 MOV42 UPD42 MOV42 INS42 UPD42 MOV42 INS42 UPD42 MOV42 DEL42 DEL65 DEL66 DEL66 DEL42 DEL65 DEL27 DEL42 DEL42 DEL43 DEL57 DEL32 DEL42 DEL32 DEL42 DEL43 DEL57 DEL32 DEL32 DEL27 DEL36 DEL38 DEL41