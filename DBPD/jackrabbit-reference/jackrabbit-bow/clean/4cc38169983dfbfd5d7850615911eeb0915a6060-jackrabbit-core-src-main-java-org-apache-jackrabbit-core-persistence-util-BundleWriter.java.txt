JCR-2762: Optimize bundle serialization

Move the binding version byte to the constructor for easier extensibility

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1005820 13f79535-47bb-0310-9956-ffa450edef68

+     * @throws IOException if an I/O error occurs.
-    public BundleWriter(BundleBinding binding, OutputStream stream) {
+    public BundleWriter(BundleBinding binding, OutputStream stream)
+            throws IOException {
+        this.out.writeByte(BundleBinding.VERSION_CURRENT);
-        out.writeInt(
-                (BundleBinding.VERSION_CURRENT << 24)
-                | binding.nsIndex.stringToIndex(bundle.getNodeTypeName().getNamespaceURI()));
-        out.writeInt(binding.nameIndex.stringToIndex(bundle.getNodeTypeName().getLocalName()));
+        Name type = bundle.getNodeTypeName();
+        int index = binding.nsIndex.stringToIndex(type.getNamespaceURI());
+        out.writeByte(index >>> 16);
+        out.writeByte(index >>> 8);
+        out.writeByte(index);
+        out.writeInt(binding.nameIndex.stringToIndex(type.getLocalName()));
