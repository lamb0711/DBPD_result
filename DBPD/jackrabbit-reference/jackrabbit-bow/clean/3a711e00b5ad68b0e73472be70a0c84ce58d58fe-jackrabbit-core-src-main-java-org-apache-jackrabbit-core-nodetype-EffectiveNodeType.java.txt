JCR-1947: JSR 283: Node Type Attribute Subtyping Rules

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@784824 13f79535-47bb-0310-9956-ffa450edef68

+    // flag indicating whether any included node type supports orderable child nodes
+    private boolean orderableChildNodes;
+
+    private Name primaryItemName;
+
+        orderableChildNodes = false;
+        primaryItemName = null;
+        // resolve 'orderable child nodes' attribute value (JCR-1947)
+        if (ntd.hasOrderableChildNodes()) {
+            ent.orderableChildNodes = true;
+        } else {
+            Name[] nta = ent.getInheritedNodeTypes();
+            for (int i = 0; i < nta.length; i++) {
+                NodeTypeDef def = (NodeTypeDef) ntdCache.get(nta[i]);
+                if (def.hasOrderableChildNodes()) {
+                    ent.orderableChildNodes = true;
+                    break;
+                }
+            }
+        }
+
+        // resolve 'primary item' attribute value (JCR-1947)
+        if (ntd.getPrimaryItemName() != null) {
+            ent.primaryItemName = ntd.getPrimaryItemName();
+        } else {
+            Name[] nta = ent.getInheritedNodeTypes();
+            for (int i = 0; i < nta.length; i++) {
+                NodeTypeDef def = (NodeTypeDef) ntdCache.get(nta[i]);
+                if (def.getPrimaryItemName() != null) {
+                    ent.primaryItemName = def.getPrimaryItemName();
+                    break;
+                }
+            }
+        }
+
+    /**
+     * Returns true if any of the included node types supports
+     * 'orderable child nodes'; returns alse otherwise.
+     */
+    public boolean hasOrderableChildNodes() {
+        return orderableChildNodes;
+    }
+    
+    public Name getPrimaryItemName() {
+        return primaryItemName;
+    }
+
+
+        // update 'orderable child nodes' attribute value (JCR-1947)
+        if (other.hasOrderableChildNodes()) {
+            orderableChildNodes = true;
+        }
+        // update 'primary item' attribute value (JCR-1947)
+        if (primaryItemName == null && other.getPrimaryItemName() != null) {
+            primaryItemName = other.getPrimaryItemName();
+        }
