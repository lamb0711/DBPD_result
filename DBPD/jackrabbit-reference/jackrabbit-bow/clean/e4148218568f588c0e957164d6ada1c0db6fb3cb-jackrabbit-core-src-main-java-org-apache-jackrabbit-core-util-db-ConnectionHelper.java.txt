JCR-3425 XAAwareRWLock implementation fails with IllegalStateException on JBoss AS7

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1389741 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Arrays;
-       	return batchConnectionMap.get(threadIdToObject(threadId));
+       	return batchConnectionMap.get(threadId);
-    	batchConnectionMap.put(threadIdToObject(threadId), batchConnection);
+    	batchConnectionMap.put(threadId, batchConnection);
-    	batchConnectionMap.remove(threadIdToObject(threadId));
+    	batchConnectionMap.remove(threadId);
-    /**
-     * Creates a comparable String from the given threadId
-     * 
-     * @param threadId
-     * @return String
-     */
-    private Object threadIdToObject(Object threadId) {
-    	if (threadId instanceof byte[]) {
-    		return new XidWrapper((byte[]) threadId);
-    	} else {
-    		return threadId.toString();
-    	}
-    }
-
-    
-    /**
-     * Wrapper around a global transaction id (byte[]) 
-     * that handles hashCode and equals in a proper way.
-     */
-    private class XidWrapper {
-    	private byte[] gtid;
-    	
-    	public XidWrapper(byte[] gtid) {
-    		this.gtid = gtid;
-    	}
-
-        @Override
-        public boolean equals(Object other) {
-            if (!(other instanceof XidWrapper)) {
-                return false;
-            }
-            return TransactionContext.isSameThreadId(gtid, ((XidWrapper)other).gtid);
-        }
-
-        @Override
-        public int hashCode() {
-            return Arrays.hashCode(gtid);
-        }
-    }
