JIRA issue: JCR-49
jcr:path LIKE '/foo/%' now selects descendants of /foo

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@154258 13f79535-47bb-0310-9956-ffa450edef68

+    /**
+     * If <code>true</code> this query acts on the descendant-or-self axis.
+     * If <code>false</code> this query acts on the descendant axis.
+     */
+    private final boolean includeSelf;
+
+        this(context, sub, true);
+    }
+
+    /**
+     * Creates a new <code>DescendantSelfAxisQuery</code> based on a
+     * <code>context</code> query and filtering the <code>sub</code> query.
+     * @param context the context for this query.
+     * @param sub the sub query.
+     * @param includeSelf if <code>true</code> this query acts like a
+     * descendant-or-self axis. If <code>false</code> this query acts like
+     * a descendant axis.
+     */
+    public DescendantSelfAxisQuery(Query context, Query sub, boolean includeSelf) {
+        this.includeSelf = includeSelf;
-                // check if nextDoc is really valid
-                String uuid = reader.document(nextDoc).get(FieldNames.UUID);
-                if (contextUUIDs.contains(uuid)) {
-                    return true;
+                // check if nextDoc is really valid against the context query
+
+                // check self if necessary
+                if (includeSelf) {
+                    String uuid = reader.document(nextDoc).get(FieldNames.UUID);
+                    if (contextUUIDs.contains(uuid)) {
+                        return true;
+                    }
+
