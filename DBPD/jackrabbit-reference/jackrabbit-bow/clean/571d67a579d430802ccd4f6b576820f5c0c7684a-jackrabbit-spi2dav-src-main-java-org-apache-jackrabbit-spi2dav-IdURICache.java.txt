JCR-3305 : spi2davex.RepositoryServiceImpl -> idUriCache raises until heap overflow  (patch by Alexander Muthmann applied with minor modifications)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1429816 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.LinkedHashMap;
+import java.util.Map;
+import org.apache.jackrabbit.spi.ItemId;
-import org.apache.jackrabbit.spi.ItemId;
-
-import java.util.Map;
-import java.util.HashMap;
-
-    private final String workspaceUri;
+    /**
+     * @see <a href="https://issues.apache.org/jira/browse/JCR-3305">JCR-3305</a>: limit cache size
+     */
+    private static final int CACHESIZE = 10000;
-    private Map<ItemId, String> idToUriCache = new HashMap<ItemId, String>();
-    private Map<String, ItemId> uriToIdCache = new HashMap<String, ItemId>();
+    private final String workspaceUri;
+    private Map<ItemId, String> idToUriCache;
+    private Map<String, ItemId> uriToIdCache;
+        idToUriCache = new LinkedHashMap<ItemId, String>(CACHESIZE, 1) {
+            @Override
+            protected boolean removeEldestEntry(Map.Entry<ItemId, String> eldest) {
+                return this.size() > CACHESIZE;
+            }
+        };
+        uriToIdCache = new LinkedHashMap<String, ItemId>(CACHESIZE, 1) {
+            @Override
+            protected boolean removeEldestEntry(Map.Entry<String, ItemId> eldest) {
+                return this.size() > CACHESIZE;
+            }
+        };
