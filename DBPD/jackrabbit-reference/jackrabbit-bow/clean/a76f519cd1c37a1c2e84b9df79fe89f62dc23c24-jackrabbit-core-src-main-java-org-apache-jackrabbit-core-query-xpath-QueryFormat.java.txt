Minor query format fixes
- XPath: element test not used for node type query node
- SQL: format may produce invalid statement
- JCRSQL parser: create node type query node as direct child of location step node

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@504476 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.query.DefaultQueryNodeVisitor;
-        StringBuffer sb = (StringBuffer) data;
-        try {
-            sb.append("@");
-            NameFormat.format(QName.JCR_PRIMARYTYPE, resolver, sb);
-            sb.append("='");
-            NameFormat.format(node.getValue(), resolver, sb);
-            sb.append("'");
-        } catch (NoPrefixDeclaredException e) {
-            exceptions.add(e);
-        }
-        return sb;
+        // handled in location step visit
+        return data;
+        final QName[] nodeType = new QName[1];
+        node.acceptOperands(new DefaultQueryNodeVisitor() {
+            public Object visit(NodeTypeQueryNode node, Object data) {
+                nodeType[0] = node.getValue();
+                return data;
+            }
+        }, null);
+
+        if (nodeType[0] != null) {
+            sb.append("element(");
+        }
+
+
+        if (nodeType[0] != null) {
+            sb.append(", ");
+            try {
+                NameFormat.format(ISO9075.encode(nodeType[0]), resolver, sb);
+            } catch (NoPrefixDeclaredException e) {
+                exceptions.add(e);
+            }
+            sb.append(")");
+        }
+
+            // ignore node type query nodes
+            if (predicates[i].getType() == QueryNode.TYPE_NODETYPE) {
+                continue;
+            }
