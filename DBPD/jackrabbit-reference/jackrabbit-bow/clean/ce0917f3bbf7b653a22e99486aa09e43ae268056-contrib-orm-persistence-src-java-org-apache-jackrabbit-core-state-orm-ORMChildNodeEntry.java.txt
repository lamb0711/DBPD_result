committing as-is Patch for ORM-Persistence posted by serge (JCR-100)

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@160863 13f79535-47bb-0310-9956-ffa450edef68

-    private Integer index;
+    // this is the index used for same name siblings
+    private Integer sameNameIndex;
+    // this is the index used for conserving the order of child nodes.
+    private Integer childrenIndex;
-    public ORMChildNodeEntry(ORMNodeState parent, ChildNodeEntry childNodeEntry, String parentUUID) {
+    public ORMChildNodeEntry(ORMNodeState parent, ChildNodeEntry childNodeEntry, String parentUUID, int childrenIndex) {
-        index = new Integer(childNodeEntry.getIndex());
+        sameNameIndex = new Integer(childNodeEntry.getIndex());
+        this.childrenIndex = new Integer(childrenIndex);
-    public void setIndex(Integer index) {
-        this.index = index;
+    public void setSameNameIndex(Integer sameNameIndex) {
+
+        this.sameNameIndex = sameNameIndex;
+    public void setChildrenIndex(Integer childrenIndex) {
+        this.childrenIndex = childrenIndex;
+    }
+
-    public Integer getIndex() {
-        return index;
+    public Integer getSameNameIndex() {
+
+        return sameNameIndex;
+    public Integer getChildrenIndex() {
+        return childrenIndex;
+    }
+
-                (getIndex().equals(right.getIndex()))) {
+                (getSameNameIndex().equals(right.getSameNameIndex())) &&
+                (getChildrenIndex().equals(right.getChildrenIndex()))) {
-        return (getUuid() + getName() + getIndex()).compareTo(right.getUuid() + right.getName() + right.getIndex());
+        return (getChildrenIndex() + getUuid() + getName() + getSameNameIndex()).compareTo(right.getChildrenIndex() + right.getUuid() + right.getName() + right.getSameNameIndex());
-        return (getUuid() + getName() + getIndex()).hashCode();
+        return (getChildrenIndex() + getUuid() + getName() + getSameNameIndex()).hashCode();
