JCR-2183 - Provide overridables for lock checking
- Add public LockInfo class
- Make AbstractLockInfo package private
- Rename internal LockInfo classes to avoid confusion
- Add overridable in LockManagerImpl with default implementation

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@790892 13f79535-47bb-0310-9956-ffa450edef68

-    private final Map lockedNodesMap = new HashMap();
+    private final Map<NodeId, XALockInfo> lockedNodesMap = 
+    		new HashMap<NodeId, XALockInfo>();
-    private final Map unlockedNodesMap = new HashMap();
+    private final Map<NodeId, XALockInfo> unlockedNodesMap = 
+    		new HashMap<NodeId, XALockInfo>();
-    private final List operations = new ArrayList();
+    private final List<XALockInfo> operations = new ArrayList<XALockInfo>();
-        LockInfo info = (LockInfo) unlockedNodesMap.get(id);
+        XALockInfo info = unlockedNodesMap.get(id);
-        info = new LockInfo(node, new LockToken(id), isSessionScoped, isDeep, lockOwner);
+        info = new XALockInfo(node, new LockToken(id), isSessionScoped, isDeep, lockOwner);
-        AbstractLockInfo info = (LockInfo) lockedNodesMap.get(id);
+        AbstractLockInfo info = lockedNodesMap.get(id);
-            } else if (info.getLockHolder() != node.getSession()) {
+            } else if (!info.isLockHolder(node.getSession())) {
-            info = new LockInfo(node, info);
-            unlockedNodesMap.put(id, info);
-            operations.add(info);
+            XALockInfo xaInfo = new XALockInfo(node, info);
+            unlockedNodesMap.put(id, xaInfo);
+            operations.add(xaInfo);
-        AbstractLockInfo info = getLockInfo(node);
-        return info != null;
+        return getLockInfo(node) != null;
-                LockInfo info = (LockInfo) lockedNodesMap.get(current.getId());
+                XALockInfo info = lockedNodesMap.get(current.getId());
-        ArrayList result = new ArrayList();
+    	
+        ArrayList<AbstractLockInfo> result = new ArrayList<AbstractLockInfo>();
-        // get lock infos from global lock manager first
+        // get lock informations from global lock manager first
-        // add 'uncommitted' lock infos
+        // add 'uncommitted' lock informations
-                if (info.getLockHolder() == null) {
+            	if (info.isLockHolder(session)) {
+            		// nothing to do
+            	} else if (info.getLockHolder() == null) {
-                if (session == info.getLockHolder()) {
+            	if (info.isLockHolder(session)) {
+            	} else if (info.getLockHolder() == null) {
+            		// nothing to do
-                        LockInfo info = (LockInfo) operations.get(opIndex);
+                        XALockInfo info = operations.get(opIndex);
-                            LockInfo info = (LockInfo) operations.get(opIndex - 1);
+                            XALockInfo info = operations.get(opIndex - 1);
-                        LockInfo info = (LockInfo) operations.get(opIndex - 1);
+                        XALockInfo info = operations.get(opIndex - 1);
-        if (info instanceof LockInfo) {
-            LockInfo lockInfo = (LockInfo) info;
+        if (info instanceof XALockInfo) {
+            XALockInfo lockInfo = (XALockInfo) info;
-    class LockInfo extends AbstractLockInfo {
+    class XALockInfo extends AbstractLockInfo {
-        public LockInfo(NodeImpl node, LockToken lockToken,
-                        boolean sessionScoped, boolean deep, String lockOwner) {
+        public XALockInfo(NodeImpl node, LockToken lockToken,
+        				  boolean sessionScoped, boolean deep, String lockOwner) {
-        public LockInfo(NodeImpl node, LockToken lockToken,
-                        boolean sessionScoped, boolean deep, String lockOwner,
-                        long timeoutHint) {
+        public XALockInfo(NodeImpl node, LockToken lockToken,
+                          boolean sessionScoped, boolean deep, String lockOwner,
+                          long timeoutHint) {
-        public LockInfo(NodeImpl node, AbstractLockInfo info) {
+        public XALockInfo(NodeImpl node, AbstractLockInfo info) {
