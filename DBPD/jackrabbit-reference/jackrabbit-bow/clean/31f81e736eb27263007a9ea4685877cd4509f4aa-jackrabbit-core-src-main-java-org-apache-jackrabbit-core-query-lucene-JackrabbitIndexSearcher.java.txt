JCR-2076: JSR 283: Joins

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@768954 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.query.lucene.constraint.EvaluationContext;
+import org.apache.jackrabbit.core.state.ItemStateManager;
+import org.apache.jackrabbit.spi.Name;
-public class JackrabbitIndexSearcher extends IndexSearcher {
+public class JackrabbitIndexSearcher
+        extends IndexSearcher
+        implements EvaluationContext {
+     * The item state manager of the workspace.
+     */
+    private final ItemStateManager ism;
+
+    /**
+     * @param ism the shared item state manager.
-    public JackrabbitIndexSearcher(SessionImpl s, IndexReader r) {
+    public JackrabbitIndexSearcher(SessionImpl s,
+                                   IndexReader r,
+                                   ItemStateManager ism) {
+        this.ism = ism;
+     * @param selectorName    the single selector name for the query hits.
-                                        long resultFetchHint)
+                                        long resultFetchHint,
+                                        Name selectorName)
-        return new QueryHitsAdapter(evaluate(query, sort, resultFetchHint),
-                QueryImpl.DEFAULT_SELECTOR_NAME);
+        return new QueryHitsAdapter(
+                evaluate(query, sort, resultFetchHint), selectorName);
+    //------------------------< EvaluationContext >-----------------------------
+
+
+    /**
+     * @return session that executes the query.
+     */
+    public SessionImpl getSession() {
+        return session;
+    }
+
+    /**
+     * @return the item state manager of the workspace.
+     */
+    public ItemStateManager getItemStateManager() {
+        return ism;
+    }
