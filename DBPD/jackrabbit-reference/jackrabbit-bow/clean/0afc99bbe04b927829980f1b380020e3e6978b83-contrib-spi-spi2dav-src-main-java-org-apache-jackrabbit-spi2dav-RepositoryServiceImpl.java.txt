Work in progress
- create subscription when session info is obtained, otherwise the session might miss events.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@482977 13f79535-47bb-0310-9956-ffa450edef68

-import javax.jcr.Repository;
+        SessionInfoImpl sessionInfo = new SessionInfoImpl(credentials, workspaceName);
-            SessionInfo sessionInfo = new SessionInfoImpl(credentials, workspaceName);
-
-                return sessionInfo;
+
+        // create a subscription on the server
+        String rootUri = uriResolver.getRootItemUri(workspaceName);
+        String subscriptionId = subscribe(rootUri, S_INFO, null, sessionInfo, null);
+        log.debug("Subscribed on server for session info " + sessionInfo);
+        sessionInfo.setSubscriptionId(subscriptionId);
+        return sessionInfo;
-        // make sure we have a subscription on the server before we
-        // submit the batch
-        if (((SessionInfoImpl) batchImpl.sessionInfo).getSubscriptionId() == null
-                && "true".equals(getRepositoryDescriptors().get(Repository.OPTION_OBSERVATION_SUPPORTED))) {
-            getEvents(batchImpl.sessionInfo, 0, new EventFilter[0]);
-        }        // send batched information
-        String subscriptionId = sessionInfoImpl.getSubscriptionId();
-        if (subscriptionId == null) {
-            subscriptionId = subscribe(rootUri, S_INFO, null, sessionInfo, null);
-            log.debug("Subscribed on server for session info " + sessionInfo);
-            sessionInfoImpl.setSubscriptionId(subscriptionId);
-        }
-        return poll(rootUri, subscriptionId, (SessionInfoImpl) sessionInfo);
+        return poll(rootUri, sessionInfoImpl.getSubscriptionId(), sessionInfoImpl);
-                    if (value != null && sessionInfo instanceof SessionInfoImpl) {
+                    if (value != null) {
