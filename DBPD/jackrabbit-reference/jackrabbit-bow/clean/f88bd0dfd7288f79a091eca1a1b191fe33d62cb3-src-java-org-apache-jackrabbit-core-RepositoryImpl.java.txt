fixed potential ConcurrentModificationException in RepositoryImpl.shutdown()

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@330018 13f79535-47bb-0310-9956-ffa450edef68

-     * Shuts down this repository. Note that this method is called automatically
-     * through a shutdown hook.
-     *
-     * @see Runtime#addShutdownHook(Thread)
+     * Shuts down this repository.
-        for (Iterator it = activeSessions.values().iterator(); it.hasNext();) {
-            SessionImpl session = (SessionImpl) it.next();
-            session.removeListener(this);
-            session.logout();
+        // (copy sessions to array to avoid ConcurrentModificationException)
+        int cnt = 0;
+        SessionImpl[] sa = new SessionImpl[activeSessions.size()];
+        for (Iterator it = activeSessions.values().iterator(); it.hasNext(); cnt++) {
+            sa[cnt] = (SessionImpl) it.next();
+        }
+        for (int i = 0; i < sa.length; i++) {
+            if (sa[i] != null) {
+                sa[i].removeListener(this);
+                sa[i].logout();
+            }
