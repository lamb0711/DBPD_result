JCR-2715: Improved join query performance

Implement also same, child and descendant node join conditions.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1025644 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Arrays;
-import javax.jcr.query.qom.Selector;
-import org.apache.lucene.search.BooleanClause;
-import org.apache.jackrabbit.spi.commons.conversion.IllegalNameException;
-import org.apache.jackrabbit.spi.commons.name.NameConstants;
-        return create(ntManager.getNodeType(selector.getNodeTypeName()));
-    }
-
-    private Term createNodeTypeTerm(NodeType type) throws RepositoryException {
-        String field;
-        if (type.isMixin()) {
-            // search for nodes where jcr:mixinTypes is set to this mixin
-            field = mixinTypesField;
-        } else {
-            // search for nodes where jcr:primaryType is set to this type
-            field = primaryTypeField;
-        }
-        String name = nsMappings.translateName(session.getQName(type.getName()));
-        return new Term(PROPERTIES, FieldNames.createNamedValue(field, name));
-    }
-
-    private Query create(NodeType type) throws RepositoryException {
-        String name = type.getName();
+        String name = selector.getNodeTypeName();
+    private Term createNodeTypeTerm(NodeType type) throws RepositoryException {
+        String field;
+        if (type.isMixin()) {
+            // search for nodes where jcr:mixinTypes is set to this mixin
+            field = mixinTypesField;
+        } else {
+            // search for nodes where jcr:primaryType is set to this type
+            field = primaryTypeField;
+        }
+        String name = nsMappings.translateName(session.getQName(type.getName()));
+        return new Term(PROPERTIES, FieldNames.createNamedValue(field, name));
+    }
+
