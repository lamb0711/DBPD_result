JCR-1309 Refactor DBMS support for JNDI datasources

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@613914 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.persistence.bundle.util.ConnectionFactory;
+import javax.jcr.RepositoryException;
+
+ * JNDI can be used to get the connection. In this case, use the javax.naming.InitialContext as the driver,
+ * and the JNDI name as the URL. If the user and password are configured in the JNDI resource,
+ * they should not be configured here. Example JNDI settings:
+ * <pre>
+ * &lt;param name="driver" value="javax.naming.InitialContext" />
+ * &lt;param name="url" value="java:comp/env/jdbc/Test" />
+ * </pre>
+     * @throws SQLException 
-     * @throws ClassNotFoundException if the JDBC driver class is not found
-     * @throws SQLException if a database access error occurs
+     * @throws RepositoryException if the driver could not be loaded
+     * @throws SQLException if the connection could not be established
-    protected Connection getConnection() throws ClassNotFoundException, SQLException {
-        Class.forName(driver);
-        Connection connection = DriverManager.getConnection(url, user, password);
-        return connection;
+    protected Connection getConnection() throws RepositoryException, SQLException {
+        return ConnectionFactory.getConnection(driver, url, user, password);
