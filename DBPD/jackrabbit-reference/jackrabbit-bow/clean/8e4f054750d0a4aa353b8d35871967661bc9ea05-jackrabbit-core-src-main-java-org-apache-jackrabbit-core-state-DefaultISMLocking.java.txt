JCR-2554 Deadlock inside XASession on Weblogic (Writer Preference)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@923597 13f79535-47bb-0310-9956-ffa450edef68

+	 * Thread concerning ReentrantWriterPreferenceReadWriteLock
-    private final ReadWriteLock rwLock = new RWLock();
+    private final ReadWriteLock rwLock = new ReentrantWriterPreferenceReadWriteLock();
-	 * Thread concerning ReentrantWriterPreferenceReadWriteLock
-	 */
-    private static final class RWLock extends ReentrantWriterPreferenceReadWriteLock {
-
-    	/**
-         * Allow reader when there is no active writer, or current thread owns
-         * the write lock (reentrant).
-         */
-        protected boolean allowReader() {
-            return activeWriter_ == null || activeWriter_ == Thread.currentThread();
-        }
-    }
-
-	/**
-        	return activeXid == null || isSameGlobalTx(currentXid);
+        	return (activeXid == null && waitingWriters_ == 0) || isSameGlobalTx(currentXid);
