- additional test for Node.refresh called on a moved node
- JCR-999  SPI: provide batch read functionality -> adjust test setup


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@552876 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.spi2jcr.ValueFactoryImpl;
+import org.apache.jackrabbit.spi2jcr.BatchReadConfig;
-import org.apache.jackrabbit.jcr2spi.config.RepositoryConfig;
-import org.apache.jackrabbit.jcr2spi.config.CacheBehaviour;
+import org.apache.jackrabbit.name.QName;
-import javax.jcr.ValueFactory;
-            Repository jackrabbitRepo = super.getRepository();
-            final RepositoryService repoService = new RepositoryServiceImpl(jackrabbitRepo);
+            final RepositoryService service = getRepositoryService();
-                repo = RepositoryImpl.create(new RepositoryConfig() {
+                repo = RepositoryImpl.create(new AbstractRepositoryConfig() {
-                        return repoService;
-                    }
-
-                    public ValueFactory getValueFactory() {
-                        return ValueFactoryImpl.getInstance();
-                    }
-
-                    public String getDefaultWorkspaceName() {
-                        // not needed for SPI2JCR
-                        return null;
-                    }
-
-                    public CacheBehaviour getCacheBehaviour() {
-                        return CacheBehaviour.INVALIDATE;
+                        return service;
+
+    /**
+     *
+     * @return
+     * @throws RepositoryStubException
+     */
+    public RepositoryService getRepositoryService() throws RepositoryStubException {
+        Repository jackrabbitRepo = super.getRepository();
+
+        // TODO: make configurable
+        BatchReadConfig brconfig = new BatchReadConfig();
+        brconfig.setDepth(QName.NT_FILE, BatchReadConfig.DEPTH_INFINITE);
+        brconfig.setDepth(QName.NT_RESOURCE, BatchReadConfig.DEPTH_INFINITE);
+
+        return new RepositoryServiceImpl(jackrabbitRepo, brconfig);
+    }
