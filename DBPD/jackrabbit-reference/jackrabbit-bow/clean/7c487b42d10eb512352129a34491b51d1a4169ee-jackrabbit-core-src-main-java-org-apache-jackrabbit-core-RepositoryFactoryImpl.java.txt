JCR-2360: JcrUtils.getRepository(...) for simple repository access

Make the jackrabbit-core RepositoryFactoryImpl interpret file: URIs.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@897836 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.File;
+import java.net.URI;
+import java.net.URISyntaxException;
+import org.apache.jackrabbit.commons.GenericRepositoryFactory;
+    @SuppressWarnings("unchecked")
-        JackrabbitRepository repo;
-                repo = getOrCreateRepository(null, null);
+                return getOrCreateRepository(null, null);
-                String conf = (String) parameters.get(REPOSITORY_CONF);
-                String home = (String) parameters.get(REPOSITORY_HOME);
-                repo = getOrCreateRepository(conf, home);
+                String conf = parameters.get(REPOSITORY_CONF).toString();
+                String home = parameters.get(REPOSITORY_HOME).toString();
+                return getOrCreateRepository(conf, home);
+            } else if (parameters.containsKey(GenericRepositoryFactory.URI)) {
+                Object parameter = parameters.get(GenericRepositoryFactory.URI);
+                try {
+                    URI uri = new URI(parameter.toString().trim());
+                    if ("file".equalsIgnoreCase(uri.getScheme())) {
+                        File file = new File(uri);
+                        String home, conf;
+                        if (file.isFile()) {
+                            home = file.getParentFile().getPath();
+                            conf = file.getPath();
+                        } else {
+                            home = file.getPath();
+                            conf = new File(file, "repository.xml").getPath();
+                        }
+                        return getOrCreateRepository(conf, home);
+                    } else {
+                        return null; // not a file: URI
+                    }
+                } catch (URISyntaxException e) {
+                    return null; // not a valid URI
+                }
-                // unknown or insufficient parameters
-                repo = null;
+                return null; // unknown or insufficient parameters
-        return repo;
