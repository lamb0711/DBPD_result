Update to spec 0.16.4:
- Value in Row of a query result must be of type StringValue if property is of type undefined.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@161492 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.PropertyType;
+import javax.jcr.StringValue;
+import javax.jcr.Property;
-                            tmp[i] = prop.getValue();
+                            if (prop.getDefinition().getRequiredType() == PropertyType.UNDEFINED) {
+                                tmp[i] = new StringValue(prop.getString());
+                            } else {
+                                tmp[i] = prop.getValue();
+                            }
-            return values;
+            // return a copy of the array
+            Value[] ret = new Value[values.length];
+            System.arraycopy(values, 0, ret, 0, values.length);
+            return ret;
-                    return node.getProperty(prop).getValue();
+                    Property p = node.getProperty(prop);
+                    if (p.getDefinition().getRequiredType() == PropertyType.UNDEFINED) {
+                        return new StringValue(p.getString());
+                    } else {
+                        return p.getValue();
+                    }
-                    // either jcr:score / jcr:path or not set
+                    // either jcr:score, jcr:path or not set
