JCR-2814 Login performance drop when using DefaultAccessManager
implemented growable LRU for compiled permissions

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1036450 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.security.authorization.AbstractCompiledPermissions;
-import org.apache.jackrabbit.core.security.authorization.AccessControlListener;
-import org.apache.jackrabbit.core.security.authorization.AccessControlModifications;
-import org.apache.jackrabbit.core.security.authorization.AccessControlUtils;
-import org.apache.jackrabbit.core.security.authorization.Permission;
-import org.apache.jackrabbit.core.security.authorization.PrivilegeRegistry;
+import org.apache.jackrabbit.core.security.authorization.*;
-import java.util.ArrayList;
-import java.util.Iterator;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
+import java.util.*;
-    
-    private final Map<ItemId, Boolean> readCache = new LRUMap(5000);
+
+    /*
+     * Start with initial map size of 1024 and grow up to 5000 before
+     * removing LRU items.
+     */
+    @SuppressWarnings("unchecked")
+    private final Map<ItemId, Boolean> readCache = new LRUMap(1024) {
+        @Override
+        protected boolean removeLRU(LinkEntry entry) {
+            return size() > 5000;
+        }
+    };
+
