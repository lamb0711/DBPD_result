JCR-2753: Deadlock in DefaultISMLocking

Restore the earlier revisions 995411 and 995412, and added the proposed patch that makes the lock re-entrant for related readers even after a write lock has been downgraded.

Documented this reentrancy requirement in ISMLocking javadocs and modified the DefaultISMLockingDeadlockTest case to check for this case.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1000947 13f79535-47bb-0310-9956-ffa450edef68

-
-            } catch (InterruptedException e) {
-                throw new ItemStateException("Interrupted while downgrading to read lock");
-        } catch (InterruptedException e) {
-            String msg = "Unable to downgrade to read lock.";
-            log.error(msg);
