work in progress

- add 'isSessionScoped' to LockInfo and RepositoryService.lock
- add index to NodeInfo
- evaluate EventIds upon call to getId, getParentId
- convert Method-Not-Allowed to ConstraintViolation

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@467911 13f79535-47bb-0310-9956-ffa450edef68

-                    // request locate-by-uuid report to build the uri
+                    // try to request locate-by-uuid report to build the uri
-        if (cache.containsUri(response.getHref())) {
-            ItemId id = cache.getItemId(response.getHref());
-            if (id.denotesNode()) {
-                return (NodeId) id;
-            }
-        }
-
+        
-        String repoUri = getRepositoryUri();
-        String wspUri = getWorkspaceUri(sessionInfo.getWorkspaceName());
+        String rootUri = getRootItemUri(sessionInfo.getWorkspaceName());
-        if (uri.startsWith(wspUri)) {
-            jcrPath = uri.substring(wspUri.length());
-        } else if (uri.startsWith(repoUri)) {
-            jcrPath = uri.substring(repoUri.length());
-            // then cut workspace name
-            jcrPath = jcrPath.substring(jcrPath.indexOf('/', 1));
+        if (uri.startsWith(rootUri)) {
+            jcrPath = uri.substring(rootUri.length());
-            return PathFormat.parse(jcrPath, nsResolver);
+            return PathFormat.parse(Text.unescape(jcrPath), nsResolver);
