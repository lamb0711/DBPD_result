JCR-1607: Add a NamespaceHelper in jcr-commons
    - Use NamespaceHelper in jcr-server

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@657038 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.commons.NamespaceHelper;
-import javax.jcr.NamespaceException;
-import javax.jcr.NamespaceRegistry;
-     * is made to register the uri with the prefix defined. Note, that no
-     * extra effort is made to generated a unique prefix.
+     * is made to register the uri with the prefix defined.
-            String prefix;
-            String emptyPrefix = Namespace.EMPTY_NAMESPACE.getPrefix();
-            try {
-                // lookup 'prefix' in the session-ns-mappings / namespace-registry
-                prefix = session.getNamespacePrefix(propNamespace.getURI());
-            } catch (NamespaceException e) {
-                // namespace uri has not been registered yet
-                NamespaceRegistry nsReg = session.getWorkspace().getNamespaceRegistry();
-                prefix = propNamespace.getPrefix();
-                // avoid trouble with default namespace
-                if (emptyPrefix.equals(prefix)) {
-                    prefix = "_pre" + nsReg.getPrefixes().length + 1;
-                }
-                // NOTE: will fail if prefix is already in use in the namespace registry
-                nsReg.registerNamespace(prefix, propNamespace.getURI());
-            }
-            if (prefix != null && !emptyPrefix.equals(prefix)) {
-                pName = prefix + ":" + pName;
-            }
+            NamespaceHelper helper = new NamespaceHelper(session);
+            String prefix = helper.registerNamespace(
+                    propNamespace.getPrefix(), propNamespace.getURI());
+            pName = prefix + ":" + pName;
