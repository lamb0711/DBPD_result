- prepare for 0.16.4

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@159668 13f79535-47bb-0310-9956-ffa450edef68

-        internalMerge(srcWorkspaceName, true, false);
+        internalMerge(srcWorkspaceName, null, false);
-        internalMerge(srcWorkspace, false, bestEffort);
+
+        List failedIds = new ArrayList();
+        internalMerge(srcWorkspace, failedIds, bestEffort);
+
+        // enable for 0.16.4
+        // return new LazyItemIterator(itemMgr, failedIds);
-    private NodeImpl doMergeTest(SessionImpl srcSession, boolean update, boolean bestEffort)
+    private NodeImpl doMergeTest(SessionImpl srcSession, List failedIds, boolean bestEffort)
-        if (!isNodeType(MIX_VERSIONABLE) || update) {
+        if (!isNodeType(MIX_VERSIONABLE) || failedIds == null) {
+                failedIds.add(state.getId());
-                               boolean update, boolean bestEffort)
+                               List failedIds, boolean bestEffort)
-
-                internalMerge(srcSession, update, bestEffort, removeExisting, replaceExisting);
+                internalMerge(srcSession, failedIds, bestEffort, removeExisting, replaceExisting);
-     * @param update
+     * @param failedIds
-    private void internalMerge(SessionImpl srcSession, boolean update, boolean bestEffort, boolean removeExisting, boolean replaceExisting)
+    private void internalMerge(SessionImpl srcSession, List failedIds, boolean bestEffort, boolean removeExisting, boolean replaceExisting)
-        NodeImpl srcNode = doMergeTest(srcSession, update, bestEffort);
+        NodeImpl srcNode = doMergeTest(srcSession, failedIds, bestEffort);
-                n.internalMerge(srcSession, update, bestEffort, removeExisting, replaceExisting);
+                n.internalMerge(srcSession, failedIds, bestEffort, removeExisting, replaceExisting);
-                dstNode.internalMerge(srcSession, true, bestEffort, removeExisting, replaceExisting);
+                dstNode.internalMerge(srcSession, null, bestEffort, removeExisting, replaceExisting);
-                dstNode.internalMerge(srcSession, update, bestEffort, removeExisting, replaceExisting);
+                dstNode.internalMerge(srcSession, failedIds, bestEffort, removeExisting, replaceExisting);
