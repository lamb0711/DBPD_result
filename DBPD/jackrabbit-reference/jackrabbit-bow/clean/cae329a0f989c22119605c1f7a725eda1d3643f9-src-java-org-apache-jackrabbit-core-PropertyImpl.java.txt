reworked transaction support, contributed by dominique

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@151380 13f79535-47bb-0310-9956-ffa450edef68

-    protected void makePersistent(UpdateOperation update) {
+    protected void makePersistent() {
-            persistentState = update.createNew(
+            persistentState = stateMgr.createNew(
-        update.store(persistentState);
+        stateMgr.store(persistentState);
