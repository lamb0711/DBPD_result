JCR-2487: WorkspaceItemStateFactory#createItemStates throws ClassCastException

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@907693 13f79535-47bb-0310-9956-ffa450edef68

+
-        if (infos.hasNext()) {
-            NodeInfo first = (NodeInfo) infos.next();
+        NodeInfo first = first(infos);
+        if (first == null) {
+            throw new ItemNotFoundException("Node with id " + nodeId + " could not be found.");
+        }
+        else {
-        } else {
-            // empty iterator
-            throw new ItemNotFoundException("Node with id " + nodeId + " could not be found.");
+    private static NodeInfo first(ItemInfos infos) {
+        if (infos.hasNext()) {
+            ItemInfo first = infos.next();
+            if (first.denotesNode()) {
+                return (NodeInfo) first;
+            }
+        }
+
+        return null;
+    }
+
