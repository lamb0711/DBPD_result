- add methods for observation to client
- minor improvements to observation impl in jcr-server
- fix client LockMethod and adjust LockDiscovery accordingly
- fix client MergeMethod adjust corresponding Info object accordingly
- improve UpdateInfo
- use CodedURLHeader instaed of building locktoken header manually

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@421206 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.header.TimeoutHeader;
+import org.apache.jackrabbit.webdav.header.DepthHeader;
-     * Create a new <code>SubscriptionInfo</code>
-     *
+     * Create a new <code>SubscriptionInfo</code> from the given Xml element
+     * and from additional information that is transported within the request
+     * header:
+     * <ul>
+     * <li>{@link TimeoutHeader timeout},</li>
+     * <li>{@link DepthHeader isDeep}</li>
+     * </ul>
-     * @param timeout as defined by the {@link org.apache.jackrabbit.webdav.DavConstants#HEADER_TIMEOUT timeout header}.
-     * @param isDeep as defined by the {@link org.apache.jackrabbit.webdav.DavConstants#HEADER_DEPTH depth header}.
+     * @param timeout as defined in the {@link org.apache.jackrabbit.webdav.DavConstants#HEADER_TIMEOUT timeout header}.
+     * @param isDeep as defined in the {@link org.apache.jackrabbit.webdav.DavConstants#HEADER_DEPTH depth header}.
-        List typeList = new ArrayList();
-            ElementIterator it = DomUtil.getChildren(el);
-            while (it.hasNext()) {
-                Element typeElem = it.nextElement();
-                EventType et = new SimpleEventType(typeElem.getLocalName(), DomUtil.getNamespace(typeElem));
-                typeList.add(et);
+            eventTypes = DefaultEventType.createFromXml(el);
+            if (eventTypes.length == 0) {
+                log.warn("'subscriptioninfo' must at least indicate a single, valid event type.");
+                throw new DavException(DavServletResponse.SC_BAD_REQUEST);
-        if (typeList.isEmpty()) {
-            log.warn("'subscriptioninfo' must at least indicate a single event type.");
-            throw new DavException(DavServletResponse.SC_BAD_REQUEST);
-        }
-        eventTypes = (EventType[]) typeList.toArray(new EventType[typeList.size()]);
-
-
-    //--------------------------------------------------------< inner class >---
-    /**
-     * Simple EventType implementation that only consists of a qualified event
-     * name.
-     */
-    private class SimpleEventType implements EventType {
-
-        private String localName;
-        private Namespace namespace;
-
-        SimpleEventType(String localName, Namespace namespace) {
-            this.localName = localName;
-            this.namespace = namespace;
-        }
-
-        public Element toXml(Document document) {
-            return DomUtil.createElement(document, localName, namespace);
-        }
-
-        public String getName() {
-            return localName;
-        }
-
-        public Namespace getNamespace() {
-            return namespace;
-        }
-    }
