JCR-2140 Configurations and Baselines


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@796586 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Map;
-        Map<NodeId, InternalVersion> changeSet = activity.getChangeSet();
-        ChangeSetVersionSelector vsel = new ChangeSetVersionSelector(changeSet);
+        VersionSet changeSet = activity.getChangeSet();
-            Iterator<NodeId> iter = changeSet.keySet().iterator();
+            Iterator<NodeId> iter = changeSet.versions().keySet().iterator();
-                InternalVersion v = changeSet.remove(iter.next());
+                InternalVersion v = changeSet.versions().remove(iter.next());
-                        for (InternalVersion restored: internalRestore(state, v, vsel, true)) {
-                            changeSet.remove(restored.getVersionHistory().getId());
+                        for (InternalVersion restored: internalRestore(state, v, changeSet, true)) {
+                            changeSet.versions().remove(restored.getVersionHistory().getId());
-                iter = changeSet.keySet().iterator();
+                iter = changeSet.versions().keySet().iterator();
-    /**
-     * Internal version selector that selects the version in the changeset.
-     */
-    private static class ChangeSetVersionSelector implements VersionSelector {
-
-        /**
-         * the change set.
-         */
-        private final Map<NodeId, InternalVersion> changeSet;
-
-        /**
-         * creates a changeset version selector
-         * @param changeSet the changeset map from history id -> version
-         */
-        private ChangeSetVersionSelector(Map<NodeId, InternalVersion> changeSet) {
-            this.changeSet = changeSet;
-        }
-
-        /**
-         * {@inheritDoc}
-         *
-         * Selects the version in the changeset
-         */
-        public InternalVersion select(InternalVersionHistory vh) throws RepositoryException {
-            return changeSet.get(vh.getId());
-        }
-    }
-
