JCR-178: Allow concurrent index updates and queries

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@232801 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.state.NodeState;
+
+import javax.jcr.RepositoryException;
+import java.util.Iterator;
+
+    /**
+     * This default implementation calls the individual {@link #deleteNode(String)}
+     * and {@link #addNode(org.apache.jackrabbit.core.state.NodeState)} methods
+     * for each entry in the iterators. First the nodes to remove are processed
+     * then the nodes to add.
+     *
+     * @param remove uuids of nodes to remove.
+     * @param add NodeStates to add.
+     * @throws RepositoryException if an error occurs while indexing a node.
+     * @throws IOException if an error occurs while updating the index.
+     */
+    public synchronized void updateNodes(Iterator remove, Iterator add)
+            throws RepositoryException, IOException {
+        while (remove.hasNext()) {
+            deleteNode((String) remove.next());
+        }
+        while (add.hasNext()) {
+            addNode((NodeState) add.next());
+        }
+    }
