JCR-1365: Query path constraints like foo//*/bar do not scale

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@620859 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.lucene.search.MatchAllDocsQuery;
-                    Query subQuery = null;
-                    try {
-                        subQuery = createMatchAllQuery(resolver.getJCRName(NameConstants.JCR_PRIMARYTYPE));
-                    } catch (NamespaceException e) {
-                        // will never happen, prefixes are created when unknown
-                    }
-                        context = new DescendantSelfAxisQuery(context, subQuery);
-                        andQuery.add(new ChildAxisQuery(sharedItemMgr, context, null, node.getIndex()), Occur.MUST);
+                        if (node.getIndex() == LocationStepQueryNode.NONE) {
+                            context = new DescendantSelfAxisQuery(context, false);
+                            andQuery.add(context, Occur.MUST);
+                        } else {
+                            context = new DescendantSelfAxisQuery(context, true);
+                            andQuery.add(new ChildAxisQuery(sharedItemMgr, context, null, node.getIndex()), Occur.MUST);
+                        }
-                        andQuery.add(subQuery, Occur.MUST);
+                        andQuery.add(new MatchAllDocsQuery(), Occur.MUST);
