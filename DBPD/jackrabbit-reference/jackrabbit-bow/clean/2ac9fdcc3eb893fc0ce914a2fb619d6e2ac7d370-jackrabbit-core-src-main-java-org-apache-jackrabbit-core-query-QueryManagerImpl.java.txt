JCR-1378: Remove SessionImpl dependency from QueryObjectModelFactoryImpl

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@627328 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.query.jsr283.qom.QueryObjectModel;
+import org.apache.jackrabbit.core.query.qom.QueryObjectModelTree;
-    public QueryManagerImpl(SessionImpl session,
-                            ItemManager itemMgr,
-                            SearchManager searchMgr) {
+    public QueryManagerImpl(final SessionImpl session,
+                            final ItemManager itemMgr,
+                            final SearchManager searchMgr) {
-        this.qomFactory = new QueryObjectModelFactoryImpl(session, searchMgr);
+        this.qomFactory = new QueryObjectModelFactoryImpl(session) {
+            protected QueryObjectModel createQuery(QueryObjectModelTree qomTree)
+                    throws InvalidQueryException, RepositoryException {
+                return searchMgr.createQueryObjectModel(
+                        session, qomTree, QueryImpl.JCR_SQL2);
+            }
+        };
