JCR-1590: JSR 283: Locking

Streamline LockInfo code to avoid extra type casts.

Move the isLockHolder access check from NodeInfo.getLockToken to LockImpl.getLockToken where it fits better.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@803484 13f79535-47bb-0310-9956-ffa450edef68

-    protected final Node node;
+    protected final NodeImpl node;
-    public LockImpl(LockInfo info, Node node) {
+    public LockImpl(LockInfo info, NodeImpl node) {
-        if (info.isSessionScoped()) {
-            return null;
-        }
-        try {
-            return info.getLockToken(node.getSession());
-        } catch (RepositoryException e) {
+        if (!info.isSessionScoped() || info.isLockHolder(node.getSession())) {
+            return info.getLockToken();
+        } else {
-        s.getAccessManager().checkPermission(((NodeImpl) node).getPrimaryPath(), Permission.LOCK_MNGMT);
+        s.getAccessManager().checkPermission(node.getPrimaryPath(), Permission.LOCK_MNGMT);
-        try {
-            return info.isLockHolder(node.getSession());
-        } catch (RepositoryException e) {
-            return false;
-        }
+        return info.isLockHolder(node.getSession());
+
