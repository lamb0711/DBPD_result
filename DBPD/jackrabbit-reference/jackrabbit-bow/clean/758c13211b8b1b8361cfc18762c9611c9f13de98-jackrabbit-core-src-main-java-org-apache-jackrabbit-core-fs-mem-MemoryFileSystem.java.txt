JCR-1176: MemoryFileSystem is different from other FileSystems
    - Moving a folder should move the entire subtree

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@585507 13f79535-47bb-0310-9956-ffa450edef68

-    public void move(String srcPath, String destPath) {
-        Object src = entries.remove(srcPath);
-        entries.put(destPath, src);
+    public void move(String srcPath, String destPath)
+            throws FileSystemException {
+        assertExistence(srcPath);
+        if (exists(destPath)) {
+            throw new FileSystemException("Destination exists: " + destPath);
+        }
+
+        Map moves = new HashMap();
+        moves.put(srcPath, destPath);
+        if (getEntry(srcPath).isFolder()) {
+            srcPath = srcPath + "/";
+            Iterator iterator= entries.keySet().iterator();
+            while (iterator.hasNext()) {
+                String name = (String) iterator.next();
+                if (name.startsWith(srcPath)) {
+                    moves.put(
+                            name,
+                            destPath + "/" + name.substring(srcPath.length()));
+                }
+            }
+        }
+
+        Iterator iterator = moves.entrySet().iterator();
+        while (iterator.hasNext()) {
+            Map.Entry entry = (Map.Entry) iterator.next();
+            entries.put(entry.getValue(), entries.remove(entry.getKey()));
+        }
