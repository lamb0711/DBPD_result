JCR-688: Apply the new Resolver interfaces in jackrabbit-core.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@496140 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.name.NameException;
+import org.apache.jackrabbit.name.NameResolver;
+import org.apache.jackrabbit.name.ParsingNameResolver;
+import org.apache.jackrabbit.name.ParsingPathResolver;
+import org.apache.jackrabbit.name.PathResolver;
+    private final NameResolver nameResolver;
+
+    private final PathResolver pathResolver;
+
+        nameResolver = new ParsingNameResolver(this);
+        pathResolver = new ParsingPathResolver(nameResolver);
+    public NameResolver getNameResolver() {
+        if (prefixToURI.isEmpty()) {
+            return nsReg.getNameResolver();
+        } else {
+            return nameResolver;
+        }
+    }
+
+    public PathResolver getPathResolver() {
+        if (prefixToURI.isEmpty()) {
+            return nsReg.getPathResolver();
+        } else {
+            return pathResolver;
+        }
+    }
+
-        if (prefixToURI.size() == 0) {
-            return nsReg.retrieveName(jcrName);
+        try {
+            return getNameResolver().getQName(jcrName);
+        } catch (NameException e) {
+            return null;
+        } catch (NamespaceException e) {
+            return null;
-        return null;
-        if (prefixToURI.size() == 0
-                || !uriToPrefix.containsKey(name.getNamespaceURI())) {
-            return nsReg.retrieveName(name);
+        try {
+            return getNameResolver().getJCRName(name);
+        } catch (NamespaceException e) {
+            return null;
-        return null;
-        if (prefixToURI.size() == 0
-                || !uriToPrefix.containsKey(name.getNamespaceURI())) {
-            nsReg.cacheName(jcrName, name);
-        }
-        nsReg.evictAllNames();
