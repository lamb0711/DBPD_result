JCR-1564: JSR 283 namespace handling
    - Use AbstractSession for namespace handling in core
    - LocalNamespaceMappings is no longer needed

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@655577 13f79535-47bb-0310-9956-ffa450edef68

-     * the transient prefix/namespace mappings with session scope
-     */
-    protected final LocalNamespaceMappings nsMappings;
-
-    /**
-    protected final NamePathResolver namePathResolver;
+    protected NamePathResolver namePathResolver;
-        nsMappings = new LocalNamespaceMappings(rep.getNamespaceRegistry());
-        namePathResolver = new DefaultNamePathResolver(nsMappings, true);
+        namePathResolver = new DefaultNamePathResolver(this, true);
-        return nsMappings.getPrefix(uri);
+        try {
+            return getNamespacePrefix(uri);
+        } catch (NamespaceException e) {
+            throw e;
+        } catch (RepositoryException e) {
+            throw new NamespaceException("Namespace not found: " + uri, e);
+        }
-        return nsMappings.getURI(prefix);
+        try {
+            return getNamespaceURI(prefix);
+        } catch (NamespaceException e) {
+            throw e;
+        } catch (RepositoryException e) {
+            throw new NamespaceException("Namespace not found: " + prefix, e);
+        }
-        // dispose name resolver
-        nsMappings.dispose();
-        nsMappings.setNamespacePrefix(prefix, uri);
+        super.setNamespacePrefix(prefix, uri);
+        // Clear name and path caches
+        namePathResolver = new DefaultNamePathResolver(this, true);
-    /**
-     * {@inheritDoc}
-     */
-    public String[] getNamespacePrefixes()
-            throws NamespaceException, RepositoryException {
-        return nsMappings.getPrefixes();
-    }
-
-    /**
-     * {@inheritDoc}
-     */
-    public String getNamespaceURI(String prefix)
-            throws NamespaceException, RepositoryException {
-        return nsMappings.getURI(prefix);
-    }
-
-    /**
-     * {@inheritDoc}
-     */
-    public String getNamespacePrefix(String uri)
-            throws NamespaceException, RepositoryException {
-        return nsMappings.getPrefix(uri);
-    }
