JCR-2699: Improve read/write concurrency

Revert revision 1003542 until I have time to solve the NPE issue.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1003773 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.cache.LRUCache;
+import org.apache.jackrabbit.core.persistence.util.BundleCache;
- * bundle cache that caches already loaded bundles. The other is the
+ * {@link BundleCache} that caches already loaded bundles. The other is the
-    private LRUCache<NodeId, NodePropBundle> bundles;
+    private BundleCache bundles;
-        bundles = new LRUCache<NodeId, NodePropBundle>(bundleCacheSize);
+        bundles = new BundleCache(bundleCacheSize);
-                    bundles.put(id, bundle, bundle.getSize());
+                    bundles.put(bundle);
-        if (bundles.containsKey(bundle.getId())) {
-            bundles.remove(bundle.getId());
-            bundles.put(bundle.getId(), bundle, bundle.getSize());
+        if (bundles.contains(bundle.getId())) {
+            bundles.put(bundle);
