Simplified bean instantiation code using the BeanConfig functionality.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@160536 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.commons.collections.BeanMap;
-import java.util.Map;
-     * Returns the workspace persistence manager
+     * Creates a workspace persistence manager based on the given
+     * configuration. The persistence manager is instantiated using
+     * information in the given persistencem manager configuration and
+     * initialized with a persistence manager context containing the other
+     * arguments.
-     * @return the workspace persistence manager
-     * @throws RepositoryException if the persistence manager could not be instantiated/initialized
+     * @return the created workspace persistence manager
+     * @throws RepositoryException if the persistence manager could
+     *                             not be instantiated/initialized
-    private static PersistenceManager createPersistenceManager(File homeDir,
-                                                               FileSystem fs,
-                                                               PersistenceManagerConfig pmConfig,
-                                                               String rootNodeUUID,
-                                                               NamespaceRegistry nsReg,
-                                                               NodeTypeRegistry ntReg)
+    private static PersistenceManager createPersistenceManager(
+            File homeDir, FileSystem fs, PersistenceManagerConfig pmConfig,
+            String rootNodeUUID, NamespaceRegistry nsReg, NodeTypeRegistry ntReg)
-        String className = pmConfig.getClassName();
-        Map params = pmConfig.getParameters();
-            Class c = Class.forName(className);
-            PersistenceManager persistMgr = (PersistenceManager) c.newInstance();
-            /**
-             * set the properties of the persistence manager object
-             * from the param map
-             */
-            BeanMap bm = new BeanMap(persistMgr);
-            Iterator iter = params.keySet().iterator();
-            while (iter.hasNext()) {
-                Object name = iter.next();
-                Object value = params.get(name);
-                bm.put(name, value);
-            }
-            PMContext ctx = new PMContext(homeDir, fs, rootNodeUUID, nsReg, ntReg);
-            persistMgr.init(ctx);
-            return persistMgr;
+            PersistenceManager pm = (PersistenceManager) pmConfig.newInstance();
+            pm.init(new PMContext(homeDir, fs, rootNodeUUID, nsReg, ntReg));
+            return pm;
-            String msg = "Cannot instantiate implementing class " + className;
+            String msg = "Cannot instantiate persistence manager " + pmConfig.getClassName();
