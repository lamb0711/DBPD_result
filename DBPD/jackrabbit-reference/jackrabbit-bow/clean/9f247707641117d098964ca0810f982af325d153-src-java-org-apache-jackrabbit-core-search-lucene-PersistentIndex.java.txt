- Implemented a lucene Directory which works on top of the jackrabbit FileSystem abstraction.
- Changed location of lucene locks to index directory, instead of user temp dir.
- Changed order of module shutdown in RepositryImpl. shutdown sequence is now: observation, search, filesystem.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@53863 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.lucene.store.FSDirectory;
+import org.apache.jackrabbit.core.fs.FileSystem;
+ * Implements a lucene index which is based on a
+ * {@link org.apache.jackrabbit.core.fs.FileSystem}.
-    private String location;
+    private final FileSystem fs;
-    PersistentIndex(String location, Analyzer analyzer) throws IOException {
-        super(analyzer,
-                IndexReader.indexExists(location)
-                ? FSDirectory.getDirectory(location, false)
-                : FSDirectory.getDirectory(location, true));
+    PersistentIndex(FileSystem fs,
+                    boolean create,
+                    Analyzer analyzer)
+            throws IOException {
-        this.location = location;
-
+        super(analyzer, FileSystemDirectory.getDirectory(fs, create));
+        this.fs = fs;
-        return FSDirectory.getDirectory(location, false);
+        return FileSystemDirectory.getDirectory(fs, false);
