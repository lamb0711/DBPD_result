JCR-3133 Query Stats should use the TimeSeries mechanism

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1195423 13f79535-47bb-0310-9956-ffa450edef68

-        TimeSeries src = getOrCreateRecorder(Type.SESSION_READ_COUNTER);
-        TimeSeries srd = getOrCreateRecorder(Type.SESSION_READ_DURATION);
-        avg.put(Type.SESSION_READ_AVERAGE, new TimeSeriesAverage(srd, src));
+        createAvg(Type.SESSION_READ_COUNTER, Type.SESSION_READ_DURATION,
+                Type.SESSION_READ_AVERAGE);
+        createAvg(Type.SESSION_WRITE_COUNTER, Type.SESSION_WRITE_DURATION,
+                Type.SESSION_WRITE_AVERAGE);
+        createAvg(Type.BUNDLE_CACHE_MISS_COUNTER,
+                Type.BUNDLE_CACHE_MISS_DURATION, Type.BUNDLE_CACHE_MISS_AVERAGE);
+        createAvg(Type.BUNDLE_WRITE_COUNTER, Type.BUNDLE_WRITE_DURATION,
+                Type.BUNDLE_WRITE_AVERAGE);
+        createAvg(Type.QUERY_COUNT, Type.QUERY_DURATION, Type.QUERY_AVERAGE);
-        TimeSeries swc = getOrCreateRecorder(Type.SESSION_WRITE_COUNTER);
-        TimeSeries swd = getOrCreateRecorder(Type.SESSION_WRITE_DURATION);
-        avg.put(Type.SESSION_WRITE_AVERAGE, new TimeSeriesAverage(swd, swc));
+    }
-        TimeSeries brc = getOrCreateRecorder(Type.BUNDLE_CACHE_MISS_COUNTER);
-        TimeSeries brd = getOrCreateRecorder(Type.BUNDLE_CACHE_MISS_DURATION);
-        avg.put(Type.BUNDLE_CACHE_MISS_AVERAGE, new TimeSeriesAverage(brd, brc));
-
-        TimeSeries bwc = getOrCreateRecorder(Type.BUNDLE_WRITE_COUNTER);
-        TimeSeries bwd = getOrCreateRecorder(Type.BUNDLE_WRITE_DURATION);
-        avg.put(Type.BUNDLE_WRITE_AVERAGE, new TimeSeriesAverage(bwd, bwc));
+    private void createAvg(Type count, Type duration, Type avgTs) {
+        avg.put(avgTs, new TimeSeriesAverage(getOrCreateRecorder(duration),
+                getOrCreateRecorder(count)));
