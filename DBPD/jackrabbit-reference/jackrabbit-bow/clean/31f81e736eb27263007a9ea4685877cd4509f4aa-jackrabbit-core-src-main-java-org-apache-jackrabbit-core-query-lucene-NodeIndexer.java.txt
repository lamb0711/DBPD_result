JCR-2076: JSR 283: Joins

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@768954 13f79535-47bb-0310-9956-ffa450edef68

-        long length;
-        if (value.getType() == PropertyType.BINARY) {
-            length = value.getBLOBFileValue().getLength();
-        } else if (value.getType() == PropertyType.NAME
-                || value.getType() == PropertyType.PATH) {
-            return;
-        } else {
-            length = value.toString().length();
+        long length = Util.getLength(value);
+        if (length != -1) {
+            doc.add(new Field(FieldNames.PROPERTY_LENGTHS,
+                    FieldNames.createNamedLength(propertyName, length),
+                    Field.Store.NO, Field.Index.NOT_ANALYZED_NO_NORMS));
-        doc.add(new Field(FieldNames.PROPERTY_LENGTHS,
-                FieldNames.createNamedLength(propertyName, length),
-                Field.Store.NO, Field.Index.NOT_ANALYZED_NO_NORMS));
