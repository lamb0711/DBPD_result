JCR-54: Switched from JDOM to standard DOM in Jackrabbit configuration handling.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@160449 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.FileOutputStream;
-import java.io.IOException;
+import javax.xml.transform.OutputKeys;
+import javax.xml.transform.Transformer;
+import javax.xml.transform.TransformerConfigurationException;
+import javax.xml.transform.TransformerException;
+import javax.xml.transform.TransformerFactory;
+import javax.xml.transform.dom.DOMSource;
+import javax.xml.transform.stream.StreamResult;
+
-import org.jdom.Document;
-import org.jdom.Element;
-import org.jdom.output.Format;
-import org.jdom.output.XMLOutputter;
+import org.w3c.dom.Element;
-        // Create the workspace.xml file from the configuration template.
+        // Create the workspace.xml file using the configuration template.
-            Element element = (Element) template.clone();
-            element.setAttribute("name", name);
-            Document document = new Document(element);
-            XMLOutputter outputter =
-                new XMLOutputter(Format.getPrettyFormat());
+            template.setAttribute("name", name);
+            File xml = new File(directory, WORKSPACE_XML);
-            FileOutputStream fos =
-                new FileOutputStream(new File(directory, WORKSPACE_XML));
-            try {
-                outputter.output(document, fos);
-            } finally {
-                try { fos.close(); } catch (Exception e) { }
-            }
-        } catch (IOException e) {
+            TransformerFactory factory = TransformerFactory.newInstance();
+            Transformer transformer = factory.newTransformer();
+            transformer.setOutputProperty(OutputKeys.INDENT, "yes");
+            transformer.transform(
+                    new DOMSource(template), new StreamResult(xml));
+        } catch (TransformerConfigurationException e) {
-                    "Failed to create a configuration file for workspace "
-                    + name + ".", e);
+                    "Cannot create a workspace configuration writer", e);
+        } catch (TransformerException e) {
+            throw new ConfigurationException(
+                    "Cannot create a workspace configuration file", e);
