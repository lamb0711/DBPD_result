- Minor fix / enhancement for query using descendant-or-self of root node
- Implement equals() method on QueryNode classes
- Implement efficient QueryResult for query that traverses the whole workspace

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@219897 13f79535-47bb-0310-9956-ffa450edef68

-                    Query subQuery = new DescendantSelfAxisQuery(context, andQuery, false);
-                    andQuery = new BooleanQuery();
-                    andQuery.add(subQuery, true, false);
+
+                    // only use descendant axis if path is not //*
+                    // otherwise the query for the predicate can be used itself
+                    PathQueryNode pathNode = (PathQueryNode) node.getParent();
+                    if (pathNode.getPathSteps()[0] != node) {
+                        Query subQuery = new DescendantSelfAxisQuery(context, andQuery, false);
+                        andQuery = new BooleanQuery();
+                        andQuery.add(subQuery, true, false);
+                    }
-                    context = new DescendantSelfAxisQuery(context, subQuery);
-                    andQuery.add(new ChildAxisQuery(sharedItemMgr, context, null, node.getIndex()), true, false);
+                    // only use descendant axis if path is not //*
+                    PathQueryNode pathNode = (PathQueryNode) node.getParent();
+                    if (pathNode.getPathSteps()[0] != node) {
+                        context = new DescendantSelfAxisQuery(context, subQuery);
+                        andQuery.add(new ChildAxisQuery(sharedItemMgr, context, null, node.getIndex()), true, false);
+                    } else {
+                        andQuery.add(subQuery, true, false);
+                    }
