JCR-3545: fix error handling for unknown WebDAV REPORTs

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1461064 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.xml.DomUtil;
+import org.w3c.dom.Element;
+import javax.xml.parsers.DocumentBuilder;
+import javax.xml.parsers.ParserConfigurationException;
+
-        if (supportedReports.isSupportedReport(reportInfo)) {
-            Report report = ReportType.getType(reportInfo).createReport(this, reportInfo);
-            return report;
-        } else {
-            throw new DavException(DavServletResponse.SC_UNPROCESSABLE_ENTITY, "Unknown report "+ reportInfo.getReportName() +"requested.");
+        if (!supportedReports.isSupportedReport(reportInfo)) {
+            Element condition = null;
+            try {
+                condition = DomUtil.createDocument().createElementNS("DAV:", "supported-report");
+            } catch (ParserConfigurationException ex) {
+                // we don't care THAT much
+            }
+            throw new DavException(DavServletResponse.SC_CONFLICT,
+                    "Unknown report '" + reportInfo.getReportName() + "' requested.", null, condition);
+
+        return ReportType.getType(reportInfo).createReport(this, reportInfo);
-            throw new DavException(DavServletResponse.SC_CONFLICT, "Unknown Href-Property '"+hrefPropertyName+"' on resource "+getResourcePath());
+            throw new DavException(DavServletResponse.SC_CONFLICT, "Unknown Href-Property '" + hrefPropertyName + "' on resource " + getResourcePath());
