JCR-1104 - JSR 283 support
- shareble nodes (work in progress)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@638734 13f79535-47bb-0310-9956-ffa450edef68

-        // 4. do clone operation (modify and store affected states)
+        // 4. detect share cycle
+        NodeId srcId = srcState.getNodeId();
+        NodeId destParentId = destParentState.getNodeId();
+        if (destParentId.equals(srcId) || 
+                hierMgr.isAncestor(srcId, destParentId)) {
+            String msg = "This would create a share cycle.";
+            log.debug(msg);
+            throw new RepositoryException(msg);
+        }
+        
+        // 5. do clone operation (modify and store affected states)
