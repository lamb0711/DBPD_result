work in progress

- invalidation of itemstates in case of CacheBehaviour != Observation
- CacheBehaviour.Observation not dependent on Observation-RepositoryDescriptor
- SPI-observation may be implemented even if Observation is not supported according
  jcr-Repository descriptor

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@478211 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.jcr2spi.state.PropertyState;
+import org.apache.jackrabbit.jcr2spi.state.ItemStateException;
+import org.apache.jackrabbit.jcr2spi.state.entry.ChildPropertyEntry;
+import java.util.Collection;
+import java.util.Iterator;
+     * Invalidates the <code>NodeState</code> that has been unlocked and all its
+     * child properties.
+     *
-        // TODO
+        Collection propEntries = nodeState.getPropertyEntries();
+        for (Iterator it = propEntries.iterator(); it.hasNext();) {
+            ChildPropertyEntry pe = (ChildPropertyEntry) it.next();
+            if (pe.isAvailable()) {
+                try {
+                    PropertyState st = pe.getPropertyState();
+                    st.invalidate(false);
+                } catch (ItemStateException e) {
+                    // ignore
+                }
+            }
+        }
+        nodeState.invalidate(false);
-    
+
