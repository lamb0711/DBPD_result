JCR-4458: When JcrRemotingServlet deployed on non-root context, AclResource Webdav request fails (patch by woon_san)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1866280 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.WebdavRequest;
+import org.apache.jackrabbit.webdav.WebdavRequestContext;
+import org.apache.jackrabbit.webdav.server.WebdavRequestContextHolder;
+    /**
+     * Normalize the resource {@code href}. For example, remove contextPath prefix if found.
+     * @param href resource href
+     * @return normalized resource {@code href}
+     */
+    protected String normalizeResourceHref(final String href) {
+        if (href == null) {
+            return href;
+        }
+
+        final WebdavRequestContext requestContext = WebdavRequestContextHolder.getContext();
+        final WebdavRequest request = (requestContext != null) ? requestContext.getRequest() : null;
+
+        if (request == null) {
+            log.error("WebdavRequest is unavailable in the current execution context.");
+            return href;
+        }
+
+        final String contextPath = request.getContextPath();
+
+        if (!contextPath.isEmpty() && href.startsWith(contextPath)) {
+            return href.substring(contextPath.length());
+        }
+
+        return href;
+    }
+
