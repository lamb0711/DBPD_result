JCR-3507 do an extra permissions check before deleting a version or a version history in order that repositories can prevent such actions as a matter of repository-wide policy

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1443652 13f79535-47bb-0310-9956-ffa450edef68

+            checkRemoveVersionPermission();
+     * Removes this VersionHistory from storage.
+     *
+     * @throws RepositoryException if an error occurs.
+     */
+    public void removeVersionHistory() throws RepositoryException {
+        checkRemoveVersionPermission();
+        checkVersionManagementPermission();
+        InternalVersionManager internalVersionManager =
+                sessionContext.getSessionImpl().getInternalVersionManager();
+        internalVersionManager.removeVersionHistory(
+                getSession(),
+                getInternalVersionHistory());
+    }
+
+    /**
-    
+
+    private void checkRemoveVersionPermission() throws RepositoryException {
+        sessionContext.getAccessManager().checkRepositoryPermission(Permission.REMOVE_VERSION);
+    }
+
