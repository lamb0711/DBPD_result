JCR-2144 InternalValue refactoring

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@784013 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.ValueFactory;
+import org.apache.jackrabbit.core.value.InternalValueFactory;
+import org.apache.jackrabbit.core.value.ValueFactoryImpl;
+import org.apache.jackrabbit.spi.commons.value.ValueFactoryQImpl;
- * Prints node type defs in a compact notation
+ * Prints node type defs in a compact notation.
+ * All used namespace declarations are also written.
-        this(out, r, npResolver, false);
-    }
-
-    /**
-     * Creates a new nodetype writer
-     *
-     * @param out the underlaying writer
-     * @param r the naespace resolver
-     * @param npResolver
-     * @param includeNS if <code>true</code> all used namespace decl. are also
-     */
-    public CompactNodeTypeDefWriter(Writer out, NamespaceResolver r, NamePathResolver npResolver, boolean includeNS) {
-        if (includeNS) {
-            this.out = new StringWriter();
-            this.nsWriter = out;
-        } else {
-            this.out = out;
-            this.nsWriter = null;
-        }
+        this.out = new StringWriter();
+        this.nsWriter = out;
-        CompactNodeTypeDefWriter w = new CompactNodeTypeDefWriter(out, r, npResolver, true);
+        CompactNodeTypeDefWriter w = new CompactNodeTypeDefWriter(out, r, npResolver);
-        
+
+            ValueFactoryQImpl factory = ValueFactoryImpl.getInstance(npResolver);
-                    out.write(escape(dva[i].toJCRValue(npResolver).getString()));
+                    InternalValue v = dva[i];
+                    out.write(escape(factory.createValue(v).getString()));
