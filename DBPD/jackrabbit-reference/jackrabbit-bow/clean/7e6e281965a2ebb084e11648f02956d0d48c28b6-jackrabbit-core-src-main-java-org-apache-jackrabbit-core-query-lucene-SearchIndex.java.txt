JCR-2370: Index recovery may fail when redo log contains nodes that are part of an index aggregate

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@831117 13f79535-47bb-0310-9956-ffa450edef68

-        mergeAggregatedNodeIndexes(node, doc);
+        mergeAggregatedNodeIndexes(node, doc, indexFormatVersion);
+     * @param ifv the current index format version.
-    protected void mergeAggregatedNodeIndexes(NodeState state, Document doc) {
+    protected void mergeAggregatedNodeIndexes(NodeState state,
+                                              Document doc,
+                                              IndexFormatVersion ifv) {
-                            Document aDoc = createDocument(aggregate, getNamespaceMappings(), index.getIndexFormatVersion());
+                            Document aDoc = createDocument(aggregate, getNamespaceMappings(), ifv);
-                            Document aDoc = createDocument(parent, getNamespaceMappings(), getIndex().getIndexFormatVersion());
+                            Document aDoc = createDocument(parent, getNamespaceMappings(), ifv);
