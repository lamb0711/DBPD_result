- adapted versioning again to spec 0.15
- added VirtualItemStateManager for reflecting virtual content


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@55615 13f79535-47bb-0310-9956-ffa450edef68

-                props[i] = new PersistentProperty((PropertyState) stateMgr.getItemState(propId));
+                PropertyState pState = (PropertyState) stateMgr.getItemState(propId);
+                props[i] = new PersistentProperty(pState, ntMgr.getPropDef(pState.getDefinitionId()).isMultiple());
-        setPropertyValues(name, value.getType(), new InternalValue[]{value});
+        setPropertyValues(name, value.getType(), new InternalValue[]{value}, false);
-        PersistentPropertyState prop = getOrCreatePropertyState(name, type, true);
+        setPropertyValues(name, type, values, true);
+    }
+
+    /**
+     * Sets the property values
+     *
+     * @param name
+     * @param type
+     * @param values
+     * @throws RepositoryException
+     */
+    protected void setPropertyValues(QName name, int type, InternalValue[] values, boolean multiple)
+            throws RepositoryException {
+        PersistentPropertyState prop = getOrCreatePropertyState(name, type, multiple);
