JCR-2028: JSR 283 JCR Path

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@772659 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.spi.commons.value.ValueFactoryQImpl;
+import javax.jcr.ValueFactory;
+import javax.jcr.GuestCredentials;
+     * The QValueFactory
+     */
+    private QValueFactory qValueFactory = QValueFactoryImpl.getInstance();
+
+    /**
+
+        try {
+            Session s = repository.login(new GuestCredentials());
+            ValueFactory vf = s.getValueFactory();
+            if (vf instanceof ValueFactoryQImpl) {
+                qValueFactory = ((ValueFactoryQImpl) vf).getQValueFactory();
+            }
+        } catch (RepositoryException e) {
+            // ignore            
+        }
-        return QValueFactoryImpl.getInstance();
+        return qValueFactory;
