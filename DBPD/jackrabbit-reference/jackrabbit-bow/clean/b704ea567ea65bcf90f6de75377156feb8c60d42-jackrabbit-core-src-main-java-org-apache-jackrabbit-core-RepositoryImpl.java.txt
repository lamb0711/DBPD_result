JCR-2851 - Authentication Mechanism Based on Login Token

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1070831 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.security.authentication.token.TokenBasedAuthentication;
-            } else if (credentials instanceof TokenCredentials) {
-                TokenCredentials tc = (TokenCredentials) credentials;
+            }
+            Set<TokenCredentials> tokenCreds = session.getSubject().getPublicCredentials(TokenCredentials.class);
+            if (!tokenCreds.isEmpty()) {
+                TokenCredentials tc = tokenCreds.iterator().next();
+                session.setAttribute(TokenBasedAuthentication.TOKEN_ATTRIBUTE, tc.getToken());
