JCR-3999 Possibility for a Deadlock in FineGrainedISMLocking in a XA Environment

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1755017 13f79535-47bb-0310-9956-ffa450edef68

+            Object currentId = getCurrentThreadId();
-                    activeWriterId = getCurrentThreadId();
+                    activeWriterId = currentId;
-                    signal = new Latch();
-                    waitingWriters.add(signal);
+                    if (isSameThreadId(activeWriterId, currentId) 
+                            && !readLockMap.hasDependency(changeLog)) {
+                        return activeWriter;
+                    } else {
+                        signal = new Latch();
+                        waitingWriters.add(signal);
+                    }
