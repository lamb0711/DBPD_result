JCR-920: rep:excerpt() should also work on properties

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@537791 13f79535-47bb-0310-9956-ffa450edef68

-            return excerptStart + excerptEnd;
+            StringBuffer text = new StringBuffer(excerptStart);
+            text.append(fragmentStart);
+            int min = text.length();
+            char[] buf = new char[surround * 2];
+            int len = reader.read(buf);
+            text.append(buf, 0, len);
+            if (len == buf.length) {
+                for (int i = text.length() - 1; i > min; i--) {
+                    if (Character.isWhitespace(text.charAt(i))) {
+                        text.delete(i, text.length());
+                        text.append(" ...");
+                        break;
+                    }
+                }
+            }
+            text.append(fragmentEnd).append(excerptEnd);
+            return text.toString();
-                char lastChar = sb.charAt(sb.length() - 1);
-                if (lastChar != '.' && lastChar != '!' && lastChar != '?') {
-                    sb.append(" ...");
+                if (!EOF) {
+                    char lastChar = sb.charAt(sb.length() - 1);
+                    if (lastChar != '.' && lastChar != '!' && lastChar != '?') {
+                        sb.append(" ...");
+                    }
-                sb.append(fragmentEnd);
+            sb.append(fragmentEnd);
