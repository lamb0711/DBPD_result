JCR-1378: Remove SessionImpl dependency from QueryObjectModelFactoryImpl

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@627328 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.query.QueryImpl;
-import org.apache.jackrabbit.core.SessionImpl;
-import org.apache.jackrabbit.core.SearchManager;
-public class QueryObjectModelFactoryImpl implements QueryObjectModelFactory {
+public abstract class QueryObjectModelFactoryImpl implements QueryObjectModelFactory {
-    /**
-     * The session of the user.
-     */
-    private final SessionImpl session;
-
-    /**
-     * The search manager of the workspace.
-     */
-    private final SearchManager searchMgr;
-
-    public QueryObjectModelFactoryImpl(SessionImpl session,
-                                       SearchManager searchMgr) {
-        this.resolver = session;
-        this.session = session;
-        this.searchMgr = searchMgr;
+    public QueryObjectModelFactoryImpl(NamePathResolver resolver) {
+        this.resolver = resolver;
+     * Creates a query object model from the internal tree representation.
+     *
+     * @param qomTree the qom tree.
+     * @return a query object model that can be executed.
+     * @throws InvalidQueryException the the query object model tree is
+     *                               considered invalid by the query handler
+     *                               implementation.
+     * @throws RepositoryException   if any other error occurs.
+     */
+    protected abstract QueryObjectModel createQuery(QueryObjectModelTree qomTree)
+            throws InvalidQueryException, RepositoryException;
+
+    /**
-        return searchMgr.createQueryObjectModel(session, qomTree, QueryImpl.JCR_SQL2);
+        return createQuery(qomTree);
