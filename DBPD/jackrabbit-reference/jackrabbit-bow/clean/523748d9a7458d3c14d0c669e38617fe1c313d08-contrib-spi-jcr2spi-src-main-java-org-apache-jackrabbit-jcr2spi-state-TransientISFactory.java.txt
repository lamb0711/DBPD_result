minor improvement: remove unused instance fields
minor improvement: let TransientISFactory listen to states created by the WorkspaceItemStateFactory
JCR-1004 SPI: Add RepositoryService.getQNodeTypeDefinition 
         >> modify to RepositoryService.getQNodeTypeDefinitions(QName)
         >> adjust SPI implementations
         >> change NodeTypeRegistry to load definitions upon demand.



git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@555209 13f79535-47bb-0310-9956-ffa450edef68

-public final class TransientISFactory extends AbstractItemStateFactory implements TransientItemStateFactory  {
+public final class TransientISFactory extends AbstractItemStateFactory implements TransientItemStateFactory, ItemStateCreationListener  {
-    public TransientISFactory(ItemStateFactory workspaceStateFactory, ItemDefinitionProvider defProvider) {
+    public TransientISFactory(AbstractItemStateFactory workspaceStateFactory, ItemDefinitionProvider defProvider) {
+        // start listening to 'creations' on the workspaceStateFactory (and
+        // consequently skip an extra notification if the has been built by the
+        // workspaceStateFactory.
+        workspaceStateFactory.addCreationListener(this);
-        notifyCreated(state);
-
-        notifyCreated(state);
-
-        notifyCreated(state);
-
-
-        notifyCreated(state);
-
-        notifyCreated(state);
-
+
+    //------------------------------------------< ItemStateCreationListener >---
+    /**
+     * @see ItemStateCreationListener#created(ItemState)
+     */
+    public void created(ItemState state) {
+        log.debug("ItemState created by WorkspaceItemStateFactory");
+        notifyCreated(state);
+    }
+
+    /**
+     * @see ItemStateCreationListener#statusChanged(ItemState, int)
+     */
+    public void statusChanged(ItemState state, int previousStatus) {
+        // ignore
+    }
