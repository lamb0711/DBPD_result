JCR-3726 DavEx should not always use multipart POTS to bypass potential form-size restrictions


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1567314 13f79535-47bb-0310-9956-ffa450edef68

-            if (parts.isEmpty()) {
-                // only a diff part. no multipart required.
-                method.addParameter(PARAM_DIFF, buf.toString());
-            } else {
-                // other parts are present -> add the diff part
-                addPart(PARAM_DIFF, buf.toString());
-                // ... and create multipart-entity (and set it to method)
-                Part[] partArr = parts.toArray(new Part[parts.size()]);
-                RequestEntity entity = new MultipartRequestEntity(partArr, method.getParams());
-                method.setRequestEntity(entity);
-            }
+            // add the diff part - always do multipart in case the receiving servlet
+            // engine has a form-size restriction (JCR-3726)
+            addPart(PARAM_DIFF, buf.toString());
+            Part[] partArr = parts.toArray(new Part[parts.size()]);
+            RequestEntity entity = new MultipartRequestEntity(partArr, method.getParams());
+            method.setRequestEntity(entity);
-            if (parts != null) {
-                for (Part part : parts) {
-                    if (part instanceof BinaryPart) {
-                        ((BinaryPart) part).dispose();
-                    }
+            for (Part part : parts) {
+                if (part instanceof BinaryPart) {
+                    ((BinaryPart) part).dispose();
