JCR-617 CachingHieraarchyManager may serve moved items


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@470745 13f79535-47bb-0310-9956-ffa450edef68

-import javax.jcr.ReferentialIntegrityException;
+import javax.jcr.ReferentialIntegrityException;
+
-        ItemState local = null;
+        ItemState local;
+        } else if (modified.isNode()) {
+            // if the state is not ours (and is not cached) it could have been
+            // vanished from the week-ref cache due to a gc. but there could
+            // still be some listeners (e.g. CachingHierarchyManager) that want
+            // to get notified.
+            dispatcher.notifyNodeModified((NodeState) modified);
+    public void nodeModified(NodeState state) {
+        dispatcher.notifyNodeModified(state);
+    }
+
+    /**
+     * {@inheritDoc}
+     * <p/>
+     * Optimization: shared state manager we're listening to does not deliver node state changes, therefore the state
+     * concerned must be a local state.
+     */
