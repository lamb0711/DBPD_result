JCR-776: More verbose message on reference constraint violation

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@516080 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.util.Text;
+                                String constraintViolationMsg = null;
+                                    if (!satisfied) {
+                                        NodeType[] mixinNodeTypes = targetNode.getMixinNodeTypes();
+                                        String[] targetMixins = new String[mixinNodeTypes.length];
+                                        for (int j = 0; j < mixinNodeTypes.length; j++) {
+                                            targetMixins[j] = mixinNodeTypes[j].getName();
+                                        }
+                                        String targetMixinsString = Text.implode(targetMixins, ", ");
+                                        String constraintsString = Text.implode(constraints, ", ");
+                                        constraintViolationMsg = prop.safeGetJCRPath()
+                                                + ": is constraint to ["
+                                                + constraintsString
+                                                + "] but references [primaryType="
+                                                + targetNode.getPrimaryNodeType().getName()
+                                                + ", mixins="
+                                                + targetMixinsString + "]";
+                                    }
-                                    String msg = prop.safeGetJCRPath()
-                                            + ": does not satisfy the value constraint "
-                                            + constraints[0];   // just report the 1st
-                                    log.debug(msg);
-                                    throw new ConstraintViolationException(msg);
+                                    log.debug(constraintViolationMsg);
+                                    throw new ConstraintViolationException(constraintViolationMsg);
