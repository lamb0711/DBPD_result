JCR-3226 stateCreated deadlock

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1693011 13f79535-47bb-0310-9956-ffa450edef68

-        dispatcher.notifyStateCreated(visibleState);
+        boolean notifyTransientSpace;
+        if (visibleState instanceof NodeState) {
+            // No need to push "node created" to transient space:
+            // either the transient already knows about this state, or it doesn't.
+            // If we notify in this case, this can lead to a deadlock,
+            // see JCR-3226.
+            notifyTransientSpace = false;
+        } else {
+            notifyTransientSpace = true;
+        }
+        if (notifyTransientSpace) {
+            dispatcher.notifyStateCreated(visibleState);
+        }
