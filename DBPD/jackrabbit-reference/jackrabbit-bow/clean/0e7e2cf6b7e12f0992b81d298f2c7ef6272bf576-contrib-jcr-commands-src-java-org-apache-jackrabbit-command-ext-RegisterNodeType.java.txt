- maven 2 descriptor added
- linux run script added
- register node type command added
- JcrCommandsServlet added. an interface to invoke jcr commands from html forms.



git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@447879 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.io.Reader;
+import java.util.Iterator;
+import java.util.List;
+
+import org.apache.jackrabbit.command.CommandHelper;
+import org.apache.jackrabbit.core.nodetype.NodeTypeDef;
+import org.apache.jackrabbit.core.nodetype.NodeTypeManagerImpl;
+import org.apache.jackrabbit.core.nodetype.NodeTypeRegistry;
+import org.apache.jackrabbit.core.nodetype.compact.CompactNodeTypeDefReader;
-    /**
-     * {@inheritDoc}
-     */
-    public boolean execute(Context arg0) throws Exception {
-        throw new UnsupportedOperationException("not implemented yet");
-    }
+	private String cndStreamKey = "cndStream";
+	private String cndName = "cndName";
+
+	private String encodingKey = "encoding";
+
+	/**
+	 * {@inheritDoc}
+	 */
+	public boolean execute(Context ctx) throws Exception {
+		InputStream is = (InputStream) ctx.get(cndStreamKey);
+		Reader reader = null;
+		if (ctx.containsKey(this.encodingKey)) {
+			reader = new InputStreamReader(is, "utf-8");
+		} else {
+			reader = new InputStreamReader(is, (String) ctx
+					.get(this.encodingKey));
+		}
+
+		String cndName = null;
+		if (ctx.containsKey(this.cndName)) {
+			cndName = (String) ctx.get(this.cndName);
+		} else {
+			cndName = "";
+		}
+
+		CompactNodeTypeDefReader cndReader = new CompactNodeTypeDefReader(
+				reader, cndName);
+
+		// Get the List of NodeTypeDef objects
+		List ntdList = cndReader.getNodeTypeDefs();
+
+		// Get the NodeTypeManager from the Workspace.
+		// Note that it must be cast from the generic JCR NodeTypeManager to the
+		// Jackrabbit-specific implementation.
+		NodeTypeManagerImpl ntmgr = (NodeTypeManagerImpl) CommandHelper
+				.getSession(ctx).getWorkspace().getNodeTypeManager();
+
+		// Acquire the NodeTypeRegistry
+		NodeTypeRegistry ntreg = ntmgr.getNodeTypeRegistry();
+
+		// Loop through the prepared NodeTypeDefs
+		for (Iterator i = ntdList.iterator(); i.hasNext();) {
+
+			// Get the NodeTypeDef...
+			NodeTypeDef ntd = (NodeTypeDef) i.next();
+
+			// ...and register it
+			ntreg.registerNodeType(ntd);
+		}
+
+		return false;
+	}
+
+	public String getCndName() {
+		return cndName;
+	}
+
+	public void setCndName(String cndName) {
+		this.cndName = cndName;
+	}
+
+	public String getCndStreamKey() {
+		return cndStreamKey;
+	}
+
+	public void setCndStreamKey(String cndStreamKey) {
+		this.cndStreamKey = cndStreamKey;
+	}
+
+	public String getEncodingKey() {
+		return encodingKey;
+	}
+
+	public void setEncodingKey(String encodingKey) {
+		this.encodingKey = encodingKey;
+	}
