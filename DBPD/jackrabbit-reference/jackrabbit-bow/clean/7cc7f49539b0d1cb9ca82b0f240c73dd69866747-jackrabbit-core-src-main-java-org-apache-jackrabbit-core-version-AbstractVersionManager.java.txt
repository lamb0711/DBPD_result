JCR-134: Unreferenced VersionHistory should be deleted automatically

Applied patch contributed by SÃ©bastien Launay

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@778645 13f79535-47bb-0310-9956-ffa450edef68

- * All read operations must aquire the read lock before reading, all write
- * operations must aquire the write lock.
+ * All read operations must acquire the read lock before reading, all write
+ * operations must acquire the write lock.
-     * Please note, that the overridden method must aquire the readlock before
+     * Please note, that the overridden method must acquire the readlock before
-     * that reference the given version item. Subclass responsiblity.
+     * that reference the given node. Subclass responsibility.
-     * Please note, that the overridden method must aquire the readlock before
+     * Please note, that the overridden method must acquire the readlock before
-     * @param item version item
+     * @param id the id of the node
-    protected abstract boolean hasItemReferences(InternalVersionItem item)
+    protected abstract boolean hasItemReferences(NodeId id)
+            throws RepositoryException;
+
+    /**
+     * Returns the node with the given persistent id. Subclass responsibility.
+     * <p/>
+     * Please note, that the overridden method must acquire the readlock before
+     * reading the state manager.
+     *
+     * @param id the id of the node
+     * @throws RepositoryException if an error occurs while reading from the
+     *                             repository.
+     */
+    protected abstract NodeStateEx getNodeStateEx(NodeId id)
