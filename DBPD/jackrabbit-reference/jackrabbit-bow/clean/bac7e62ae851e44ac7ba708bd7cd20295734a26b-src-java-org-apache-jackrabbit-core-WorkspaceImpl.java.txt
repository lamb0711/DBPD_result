- Redesigned observation to also include workspace modifications
- Extended observation tests and moved them into the api.observation package

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@155583 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.observation.ObservationManagerImpl;
-    protected ObservationManager obsMgr;
+    protected ObservationManagerImpl obsMgr;
-    WorkspaceImpl(WorkspaceConfig wspConfig, SharedItemStateManager stateMgr,
-                  RepositoryImpl rep, SessionImpl session) {
+    WorkspaceImpl(WorkspaceConfig wspConfig,
+                  SharedItemStateManager stateMgr,
+                  RepositoryImpl rep,
+                  SessionImpl session) {
-        this.stateMgr = new TransactionalItemStateManager(stateMgr);
+        this.stateMgr = new TransactionalItemStateManager(stateMgr, this);
-    public synchronized ObservationManager getObservationManager()
+    public ObservationManager getObservationManager()
+            throws UnsupportedRepositoryOperationException, RepositoryException {
+        return getObservationManagerImpl();
+    }
+
+    /**
+     * Returns the ObservationManagerImpl for this workspace instance.
+     * @return the ObservationManagerImpl for this workspace instance.
+     */
+    public synchronized ObservationManagerImpl getObservationManagerImpl()
-                obsMgr = rep.getObservationManagerFactory(wspConfig.getName()).createObservationManager(session, session.getItemManager());
+                obsMgr = rep.getObservationManagerFactory(wspConfig.getName()).createObservationManager(session, session.hierMgr, session.getItemManager());
