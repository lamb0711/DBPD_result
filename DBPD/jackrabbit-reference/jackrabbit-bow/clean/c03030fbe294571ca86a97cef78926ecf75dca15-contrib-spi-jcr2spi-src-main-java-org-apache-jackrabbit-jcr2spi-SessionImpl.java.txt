work in progress

- avoid usage of JCR event types for SPI events (and vice versa)
- fix checkPermission

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@449676 13f79535-47bb-0310-9956-ffa450edef68

+
+        // The given abs-path may point to a non-existing item
-            // The given abs-path may point to a non-existing item
-            Path parentPath = targetPath;
+            Path parentPath = targetPath;
-                        parentState = itemState.getParent();
+                        parentState = (NodeState) itemState;
+            // parentState is the nearest existing nodeState or the root state.
-                if (!isGranted) {
-                    throw new AccessControlException(actions);
-                }
+
+        if (!isGranted) {
+            throw new AccessControlException("Access control violation: path = " + absPath + ", actions = " + actions);
+        }
