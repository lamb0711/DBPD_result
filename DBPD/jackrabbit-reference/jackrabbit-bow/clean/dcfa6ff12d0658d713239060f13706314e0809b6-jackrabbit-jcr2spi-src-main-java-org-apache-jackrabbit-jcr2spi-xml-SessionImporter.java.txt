JCR-1547: JCR2SPI: remove dependency to state-package within nodetype package

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@650514 13f79535-47bb-0310-9956-ffa450edef68

+        Name[] parentNtNames = parent.getAllNodeTypeNames();                
-                PropertyState conflicting = parent.getPropertyState(nodeInfo.getName());
+            PropertyState conflicting = parent.getPropertyState(nodeInfo.getName());
-                        propDef = session.getItemDefinitionProvider().getQPropertyDefinition(parent, newName, conflicting.getType(), false);
+                        propDef = session.getItemDefinitionProvider().getQPropertyDefinition(parentNtNames, newName, conflicting.getType(), false);
-                        propDef = session.getItemDefinitionProvider().getQPropertyDefinition(parent, newName, conflicting.getType(), true);
+                        propDef = session.getItemDefinitionProvider().getQPropertyDefinition(parentNtNames, newName, conflicting.getType(), true);
-                    propDef = session.getItemDefinitionProvider().getQPropertyDefinition(parent, newName, conflicting.getType(), true);
+                    propDef = session.getItemDefinitionProvider().getQPropertyDefinition(parentNtNames, newName, conflicting.getType(), true);
-        QNodeDefinition def = session.getItemDefinitionProvider().getQNodeDefinition(parent, nodeInfo.getName(), nodeInfo.getNodeTypeName());
+        QNodeDefinition def = session.getItemDefinitionProvider().getQNodeDefinition(parentNtNames, nodeInfo.getName(), nodeInfo.getNodeTypeName());
-     * @param nsResolver
+     * @param resolver
-       if (def == null) {
-           // there's no property with that name, find applicable definition
-           if (tva.length == 1) {
-               // could be single- or multi-valued (n == 1)
-               def = session.getItemDefinitionProvider().getQPropertyDefinition(parentState, propName, infoType);
-           } else {
-               // can only be multi-valued (n == 0 || n > 1)
-               def = session.getItemDefinitionProvider().getQPropertyDefinition(parentState, propName, infoType, true);
-           }
-           if (def.isProtected()) {
-               // skip protected property
-               log.debug("skipping protected property " + propName);
-               return;
-           }
-       }
+        Name[] parentNtNames = parentState.getAllNodeTypeNames();
+        if (def == null) {
+            // there's no property with that name, find applicable definition
+            if (tva.length == 1) {
+                // could be single- or multi-valued (n == 1)
+                def = session.getItemDefinitionProvider().getQPropertyDefinition(parentNtNames, propName, infoType);
+            } else {
+                // can only be multi-valued (n == 0 || n > 1)
+                def = session.getItemDefinitionProvider().getQPropertyDefinition(parentNtNames, propName, infoType, true);
+            }
+            if (def.isProtected()) {
+                // skip protected property
+                log.debug("skipping protected property " + propName);
+                return;
+            }
+        }
