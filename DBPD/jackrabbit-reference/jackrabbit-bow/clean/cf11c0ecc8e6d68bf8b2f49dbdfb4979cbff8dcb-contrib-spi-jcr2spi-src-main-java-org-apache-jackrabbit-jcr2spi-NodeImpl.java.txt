work in progress

- minor improvement and some sync



git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@497068 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.name.IllegalNameException;
-import org.apache.jackrabbit.name.UnknownPrefixException;
+        QName propQName = getQName(name);
-        if (hasProperty(name)) {
+        if (hasProperty(propQName)) {
-            prop = getProperty(name);
+            prop = getProperty(propQName);
-                prop = createProperty(getQName(name), value, type);
+                prop = createProperty(propQName, value, type);
+        QName propName = getQName(name);
-        if (hasProperty(name)) {
+        if (hasProperty(propName)) {
-            prop = getProperty(name);
+            prop = getProperty(propName);
-                prop = createProperty(getQName(name), values, type);
+                prop = createProperty(propName, values, type);
+        // try shortcut first (avoids parsing of name)
+        try {
+            if (NameFormat.format(primaryTypeName, session.getNamespaceResolver()).equals(nodeTypeName)) {
+                return true;
+            }
+        } catch (NoPrefixDeclaredException npde) {
+            throw new RepositoryException("Invalid node type name: " + nodeTypeName, npde);
+        }
+        // parse to QName and check against effective nodetype
-                // TODO: find proper solution. problem with SNSs
+                // TODO TOBEFIXED find proper solution. problem with SNSs
-        } catch (IllegalNameException ine) {
-            throw new RepositoryException("invalid name: " + jcrName, ine);
-        } catch (UnknownPrefixException upe) {
+        } catch (NameException upe) {
