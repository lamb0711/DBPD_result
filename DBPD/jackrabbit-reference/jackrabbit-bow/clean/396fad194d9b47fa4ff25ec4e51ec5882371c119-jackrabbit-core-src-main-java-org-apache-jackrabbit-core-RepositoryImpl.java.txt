JCR-314: Fine grained locking in SharedItemStateManager

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@605173 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.state.ISMLocking;
+        ISMLocking ismLocking = vConfig.getISMLockingConfig().createISMLocking();
+
-                VERSION_STORAGE_NODE_ID, SYSTEM_ROOT_NODE_ID, cacheFactory);
+                VERSION_STORAGE_NODE_ID, SYSTEM_ROOT_NODE_ID, cacheFactory,
+                ismLocking);
-                                                            ItemStateCacheFactory cacheFactory)
+                                                            ItemStateCacheFactory cacheFactory,
+                                                            ISMLocking locking)
-        return new SharedItemStateManager(persistMgr, rootNodeId, ntReg, true, cacheFactory);
+        return new SharedItemStateManager(persistMgr, rootNodeId, ntReg, true, cacheFactory, locking);
+            ISMLocking ismLocking = config.getISMLockingConfig().createISMLocking();
+
-                itemStateMgr = createItemStateManager(persistMgr, rootNodeId, ntReg, true, cacheFactory);
+                itemStateMgr = createItemStateManager(persistMgr, rootNodeId,
+                        ntReg, true, cacheFactory, ismLocking);
