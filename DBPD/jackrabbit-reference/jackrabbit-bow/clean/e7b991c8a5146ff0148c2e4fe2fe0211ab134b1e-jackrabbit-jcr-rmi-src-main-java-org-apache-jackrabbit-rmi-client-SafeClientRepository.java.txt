JCR-3459 RmiRepositoryFactory regression, invalid stream header

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1422975 13f79535-47bb-0310-9956-ffa450edef68

-            remote = getRemoteRepository();
+            remote = getRemoteRepository(true);
+    /**
+     * Method to obtain the remote remote repository.
+     * If initialize is true and a RepositoryException will be thrown no {@link BrokenRemoteRepository}
+     * will be created. 
+     *
+     * @return remote repository
+     * @throws RemoteException if the remote repository could not be accessed
+     */
+    protected RemoteRepository getRemoteRepository(boolean initialize)
+            throws RemoteException {
+        if (initialize) {
+            try {
+                return getRemoteRepository();
+            } catch (RemoteException e) {
+                throw new RemoteRuntimeException(e);
+            }
+        } else {
+            return getRemoteRepository();
+        }
+    }
+
-                remote = getRemoteRepository();
+                remote = getRemoteRepository(false);
-                remote = getRemoteRepository();
+                remote = getRemoteRepository(false);
-                remote = getRemoteRepository();
+                remote = getRemoteRepository(false);
-                remote = getRemoteRepository();
+                remote = getRemoteRepository(false);
-                remote = getRemoteRepository();
+                remote = getRemoteRepository(false);
-                remote = getRemoteRepository();
+                remote = getRemoteRepository(false);
-                remote = getRemoteRepository();
+                remote = getRemoteRepository(false);
