JCR-2439: More utility methods in JcrUtils

Make the getOrAddNode(parent, name, type) method ensure that the returned node matches the given type.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@890824 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.ItemExistsException;
+     * <p>
+     * This method ensures not only that the named child node exists but
+     * also that it matches the given node type.  If the child node already
+     * exists but does not match the given node type, then an
+     * {@link ItemExistsException} is thrown to indicate that a node of the
+     * given type can only be added if the previous node is first removed.
-     * @see Node#addNode(String)
+     * @see Node#addNode(String, String)
+     * @see Node#isNodeType(String)
-     * @param type the node type to use for the child node in case
-     *             it needs to be created, ignored otherwise
+     * @param type type of the child node
+     * @throws ItemExistsException if the child node already exists but
+     *                             has a different type than specified
-            return parent.getNode(name);
+            Node node = parent.getNode(name);
+            if (node.isNodeType(type)) {
+                return node;
+            } else {
+                throw new ItemExistsException(
+                        "Unable to add a node of type " + type
+                        + " at path " + node.getPath()
+                        + " since it already exists with the different type "
+                        + node.getPrimaryNodeType().getName());
+            }
