JCR-3674 ignore attempt to register node types that are already registered locally when the attempt originates from an external update

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1527571 13f79535-47bb-0310-9956-ffa450edef68

-            internalRegister(ntDefs);
+            internalRegister(ntDefs, external);
-            internalRegister(builtInNTDefs.all(), true);
+            internalRegister(builtInNTDefs.all(), false, true);
-            internalRegister(customNTDefs.all());
+            internalRegister(customNTDefs.all(), false);
-    private void internalRegister(Collection<QNodeTypeDefinition> ntDefs)
+    private void internalRegister(Collection<QNodeTypeDefinition> ntDefs, boolean external)
-        internalRegister(ntDefs, false);
+        internalRegister(ntDefs, external, false);
-     * Same as {@link #internalRegister(java.util.Collection)} except for the
+     * Same as {@link #internalRegister(java.util.Collection, boolean)} except for the
-    private void internalRegister(Collection<QNodeTypeDefinition> ntDefs, boolean lenient)
+    private void internalRegister(Collection<QNodeTypeDefinition> ntDefs, boolean external, boolean lenient)
-            if (name != null && tmpNTDefCache.containsKey(name)) {
-                String msg = name + " already exists";
-                if (tmpNTDefCache.containsKey(name)) {
-                    msg += " locally";
-                }
+            if (!external && name != null && tmpNTDefCache.containsKey(name)) {
+                String msg = name + " already exists locally";
