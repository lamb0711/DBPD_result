work in progress

- invalidation of itemstates in case of CacheBehaviour != Observation
- CacheBehaviour.Observation not dependent on Observation-RepositoryDescriptor
- SPI-observation may be implemented even if Observation is not supported according
  jcr-Repository descriptor

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@478211 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.name.Path;
+import org.apache.jackrabbit.jcr2spi.state.ItemStateException;
+import org.apache.jackrabbit.jcr2spi.state.entry.ChildNodeEntry;
+     * Invalidates the jcr:versionlabel nodestate present with the given
+     * version history. If '<code>moveLabel</code>' is true, all decendant states
+     * (property states) are invalidated as well.
+     *
-        // TODO
+        ChildNodeEntry lnEntry = versionHistoryState.getChildNodeEntry(QName.JCR_VERSIONLABELS, Path.INDEX_DEFAULT);
+        if (lnEntry.isAvailable()) {
+            try {
+                NodeState labelNodeState = lnEntry.getNodeState();
+                // if an existing label must be moved -> invalidate recursively
+                labelNodeState.invalidate(moveLabel);
+            } catch (ItemStateException e) {
+                // ignore
+            }
+        }
