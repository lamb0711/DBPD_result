JCR-674: add base64 encoding for non-binary properties that do non-XML characters (checking for now: control characters other than TAB, NL, CR); note this only affects export, import still needs to be done.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@533070 13f79535-47bb-0310-9956-ffa450edef68

-            serialize(value, encodeBlanks, writer);
+            serialize(value, encodeBlanks, false, writer);
+     * @deprecated use {@link #serialize(Value, boolean, boolean, Writer)} instead
+     */
+    public static void serialize(Value value, boolean encodeBlanks,
+        Writer writer)
+        throws IllegalStateException, IOException, RepositoryException {
+        serialize(value, encodeBlanks, false, writer);
+    }
+    
+      /**
+     * @param enforceBase64 if <code>true</code>, base64 encoding will always be used
-    public static void serialize(Value value, boolean encodeBlanks,
+    public static void serialize(Value value, boolean encodeBlanks, boolean enforceBase64,
-            if (encodeBlanks) {
-                // enocde blanks in string
-                textVal = Text.replace(textVal, " ", "_x0020_");
+            if (enforceBase64) {
+                byte bytes[] = textVal.getBytes("UTF-8");
+                Base64.encode(bytes, 0, bytes.length, writer);
-            writer.write(textVal);
+            else {
+                if (encodeBlanks) {
+                    // enocde blanks in string
+                    textVal = Text.replace(textVal, " ", "_x0020_");
+                }
+                writer.write(textVal);
+            }
