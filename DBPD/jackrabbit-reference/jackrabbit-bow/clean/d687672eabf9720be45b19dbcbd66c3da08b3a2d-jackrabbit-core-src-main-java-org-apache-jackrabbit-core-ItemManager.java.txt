JCR-689: Minimize calls to PersistenceManager
- Remove obsolete call to ItemStateManager in EventStateCollection
- Introduce ItemManager.getItem(ItemState) with a check for status and skip access right check for NEW items
- Removed calls to ItemManager.getItem(ItemId) where not really necessary and all required information is present on given ItemState.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@518986 13f79535-47bb-0310-9956-ffa450edef68

+     * Returns the item instance for the given item state.
+     * @param state the item state
+     * @return the item instance for the given item <code>state</code>.
+     * @throws RepositoryException
+     */
+    public synchronized ItemImpl getItem(ItemState state)
+            throws ItemNotFoundException, AccessDeniedException, RepositoryException {
+        // check sanity of session
+        session.sanityCheck();
+
+        ItemId id = state.getId();
+        // check cache
+        ItemImpl item = retrieveItem(id);
+        if (item == null) {
+            // not yet in cache, need to create instance:
+            // only check privileges if state is not new
+            if (state.getStatus() != ItemState.STATUS_NEW
+                    && !session.getAccessManager().isGranted(id, AccessManager.READ)) {
+                throw new AccessDeniedException("cannot read item " + id);
+            }
+            // create instance of item
+            item = createItemInstance(id);
+        }
+        return item;
+    }
+
+    /**
