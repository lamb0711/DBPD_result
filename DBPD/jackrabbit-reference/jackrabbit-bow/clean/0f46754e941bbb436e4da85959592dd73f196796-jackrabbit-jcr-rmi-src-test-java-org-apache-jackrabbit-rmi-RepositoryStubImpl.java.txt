JCRRMI-27: JSR-283: Support AccessControlManager

Use a trick in RepositoryStub.getKnownPrincipal to enable ACL tests.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@927856 13f79535-47bb-0310-9956-ffa450edef68

+import java.security.Principal;
+import java.security.acl.Group;
+import javax.jcr.RepositoryException;
+import javax.jcr.Session;
+import javax.jcr.SimpleCredentials;
+import org.apache.jackrabbit.core.SessionImpl;
+    /**
+     * A known principal used for access control tests.
+     */
+    private Principal principal;
+
+                Repository repo = super.getRepository();
+                SessionImpl session = (SessionImpl) repo.login(
+                        new SimpleCredentials("admin", "admin".toCharArray()));
+                try {
+                    for (Principal p : session.getSubject().getPrincipals()) {
+                        if (!(p instanceof Group)) {
+                            principal = p;
+                        }
+                    }
+                } finally {
+                    session.logout();
+                }
+
+    @Override
+    public Principal getKnownPrincipal(Session ignored)
+            throws RepositoryException {
+        if (principal != null) {
+            return principal;
+        } else {
+            throw new RepositoryException("no applicable principal found");
+        }
+    }
+
