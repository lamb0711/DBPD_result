JCR-1819 : Add specific deep loading of Nodes and Properties
JCR-1843 : wrong status change upon conflicting removal (CacheBehaviour.OBSERVATION)
JCR-1293 : ReorderReferenceableSNSTest failure
JCR-1811 : ExportSysViewTest#testExportSysView_handler_session_saveBinary_occasionally failing


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@709211 13f79535-47bb-0310-9956-ffa450edef68

-            for (Iterator it = getPropertyNames().iterator(); it.hasNext();) {
+            for (Iterator it = properties.keySet().iterator(); it.hasNext();) {
-        return properties.keySet();
+        return Collections.unmodifiableCollection(properties.keySet());
-        Reference ref = new WeakReference(propertyEntry);
-        properties.put(propertyEntry.getName(), ref);
+        synchronized (properties) {
+            Reference ref = new WeakReference(propertyEntry);
+            properties.put(propertyEntry.getName(), ref);
+        }
-        Name pName = propertyEntry.getName();
-        PropertyEntry pe = get(pName);
-        if (pe == propertyEntry) {
-            properties.remove(pName);
-            return true;
-        } else {
-            return false;
+        synchronized (properties) {
+            Name pName = propertyEntry.getName();
+            PropertyEntry pe = get(pName);
+            if (pe == propertyEntry) {
+                properties.remove(pName);
+                return true;
+            } else {
+                return false;
+            }
