JCR-2573 - Performance of AC Evaluation [work in progress]

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@950440 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.id.NodeId;
+import org.apache.jackrabbit.core.nodetype.NodeTypeImpl;
+     * The id of the access controlled node or <code>null</code> if this
+     * ACLTemplate isn't created for an existing access controlled node.
+     * Used for the Entry#isLocal(NodeId) call only in order to avoid calls
+     * to {@link javax.jcr.Node#getPath()}.
+     */
+    private final NodeId id;
+
+    /**
+        this.id = null;
-        if (aclNode == null || !aclNode.isNodeType(AccessControlConstants.NT_REP_ACL)) {
+        if (aclNode == null || !AccessControlConstants.NT_REP_ACL.equals(((NodeTypeImpl)aclNode.getPrimaryNodeType()).getQName())) {
-        
+
+        this.id = aclNode.getParentId();
-                        aceNode.isNodeType(AccessControlConstants.NT_REP_GRANT_ACE));
+                        AccessControlConstants.NT_REP_GRANT_ACE.equals(((NodeTypeImpl) aceNode.getPrimaryNodeType()).getQName()));
-     * 
+     *
-     * @see javax.jcr.security.AccessControlList#getAccessControlEntries()
-     */
-    public AccessControlEntry[] getAccessControlEntries() throws RepositoryException {
-        List<? extends AccessControlEntry> l = getEntries();
-        return l.toArray(new AccessControlEntry[l.size()]);
-    }
-
-    /**
-     * @see org.apache.jackrabbit.api.security.JackrabbitAccessControlList#isEmpty()
-     */
-    public boolean isEmpty() {
-        return entries.isEmpty();
-    }
-
-    /**
-     * @see org.apache.jackrabbit.api.security.JackrabbitAccessControlList#size()
-     */
-    public int size() {
-        return getEntries().size();
-    }
-
-    /**
+    @Override
+    @Override
-         * @param nodePath
+         * @param nodeId
-         * at <code>nodePath</code>
+         * at <code>nodeId</code>
-        boolean isLocal(String nodePath) {
-            return path != null && path.equals(nodePath);
+        boolean isLocal(NodeId nodeId) {
+            return id != null && id.equals(nodeId);
