Patch for JCR-1869 (Make lazy loading proxy callback Serializable) provided by Stephane Landelle

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@720969 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.Serializable;
-
-public class BeanLazyLoader extends AbstractLazyLoader implements Serializable {
+public class BeanLazyLoader extends AbstractLazyLoader {
-	private BeanConverter beanConverter;
-	private Session session;
-	private Node parentNode;
-	private BeanDescriptor beanDescriptor;
-	private ClassDescriptor beanClassDescriptor;
-	private Class<?> beanClass;
-	private Object parent;
+	private volatile BeanConverter beanConverter;
+	private volatile Session session;
+	private volatile Node parentNode;
+	private volatile BeanDescriptor beanDescriptor;
+	private volatile ClassDescriptor beanClassDescriptor;
+	private volatile Class<?> beanClass;
+	private volatile Object parent;
+		if (session == null) {
+			throw new IllegalStateException("Session null, probably because bean was serialized. Impossible to lazy load.");
+		}
+
+		 beanClassDescriptor = null;
