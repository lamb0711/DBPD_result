JCR-2113 : JSR 283 Access Control Management (patch provided by alfusainey jallow, commit with minor modifications and some TODOs (in particular testing).

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1646435 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashSet;
-import javax.jcr.UnsupportedRepositoryOperationException;
-    public Set<Privilege> getPrivileges(SessionInfo sessionInfo, NodeId id) throws RepositoryException {
-        // TODO
-        throw new UnsupportedRepositoryOperationException("not yet implemented");
+    public Set<Privilege> getPrivileges(SessionInfo sessionInfo, NodeId id, NamePathResolver npResolver) throws RepositoryException {
+        PrivilegeDefinition[] defs = service.getPrivileges(sessionInfo, id);
+        Set<Privilege> privileges = new HashSet<Privilege>(defs.length);
+        for (PrivilegeDefinition def : defs) {
+            Privilege p = new PrivilegeImpl(def, defs, npResolver);
+            privileges.add(p);
+        }
+        return privileges;        
-        return new AccessControlManagerImpl(sessionInfo, itemStateManager, itemManager, definitionProvider, hierarchyManager, npResolver, service.getQValueFactory(), this);
+        return new AccessControlManagerImpl(sessionInfo, itemStateManager, definitionProvider, hierarchyManager, npResolver, service.getQValueFactory(), this);
