JCR-2703 : UserManagement: Add Membership Cache

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@984356 13f79535-47bb-0310-9956-ffa450edef68

+    private final MembershipCache membershipCache;
+
-        this(session, adminId, null);
+        this(session, adminId, null, null);
+    }
+
+    /**
+     * Create a new <code>UserManager</code>
+     *
+     * @param session The editing/reading session.
+     * @param adminId The user ID of the administrator.
+     * @param config The configuration parameters.
+     */
+    public UserManagerImpl(SessionImpl session, String adminId, Properties config) {
+        this(session, adminId, config, null);
+     * @param mCache Shared membership cache.
-    public UserManagerImpl(SessionImpl session, String adminId, Properties config) {
+    public UserManagerImpl(SessionImpl session, String adminId, Properties config,
+                           MembershipCache mCache) {
+        if (mCache != null) {
+            membershipCache = mCache;
+        } else {
+            membershipCache = new MembershipCache(session, groupsPath);
+        }
+
+    /**
+     * @return The membership cache present with this user manager instance.
+     */
+    public MembershipCache getMembershipCache() {
+        return membershipCache;
+    }
+
-         * Extra check for the existance of the administrator user that must
+         * Extra check for the existence of the administrator user that must
-     * - isn't placed underneith the configured user/group tree.
+     * - isn't placed underneath the configured user/group tree.
-     * @param principalName to be used as hint for the groupid.
+     * @param principalName to be used as hint for the group id.
-     * <li>The NodeId created by {@link #buildNodeId(String)} by conincidence
+     * <li>The NodeId created by {@link #buildNodeId(String)} by coincidence
