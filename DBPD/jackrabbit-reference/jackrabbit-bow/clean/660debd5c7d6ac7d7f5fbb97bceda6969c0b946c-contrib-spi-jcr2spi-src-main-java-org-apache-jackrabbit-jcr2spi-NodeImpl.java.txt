work in progress

- canAddMixin: should throw NoSuchNodeTypeException but catch LockExc.
  and VersionExc.
- setProperty: missing handling for null entries in values array.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@464423 13f79535-47bb-0310-9956-ffa450edef68

-        } catch (NoSuchNodeTypeException e) {
+        } catch (NodeTypeConflictException e) {
-        } catch (NodeTypeConflictException e) {
+        } catch (LockException e) {
+            log.debug("Cannot add mixin '" + mixinName + "': " + e.getMessage());
+            return false;
+        } catch (VersionException e) {
-                targetType = (values.length > 0) ? values[0].getType() : PropertyType.STRING;
+                // try to retrieve type from the values array
+                if (values.length > 0) {
+                    for (int i = 0; i < values.length; i++) {
+                        if (values[i] != null) {
+                            targetType = values[i].getType();
+                            break;
+                        }
+                    }
+                }
+                if (targetType == PropertyType.UNDEFINED) {
+                    // fallback
+                    targetType = PropertyType.STRING;
+                }
