- comitting latest changes from angela
- adding configuration for authorization header behaviour

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@159798 13f79535-47bb-0310-9956-ffa450edef68

+import org.jdom.Namespace;
-    private NodeTypeManager ntMgr;
+    private Session session;
-        try {
-            DavSession session = resource.getSession();
-            if (session == null || session.getRepositorySession() == null) {
-                throw new IllegalArgumentException("The resource must provide a non-null session object in order to create the jcr:nodetypes report.");
-            }
-            ntMgr = session.getRepositorySession().getWorkspace().getNodeTypeManager();
-        } catch (RepositoryException e) {
-            log.error(e.getMessage());
+        DavSession session = resource.getSession();
+        if (session == null || session.getRepositorySession() == null) {
+            throw new IllegalArgumentException("The resource must provide a non-null session object in order to create the jcr:nodetypes report.");
+        this.session = session.getRepositorySession();
-        if (info == null || ntMgr == null) {
+        if (info == null || session == null) {
+            // make sure all namespace declarations are present on the root element.
+            // since the nodetype-manager uses session-local jcr names, prefix/namespace
+            // pairs are retrieved from the session and not from the namespace registry.
+            String[] prefixes = session.getNamespacePrefixes();
+            for (int i = 0; i < prefixes.length; i++) {
+                report.addNamespaceDeclaration(Namespace.getNamespace(prefixes[i], session.getNamespaceURI(prefixes[i])));
+            }
+            // retrieve the requested nodetypes
+        NodeTypeManager ntMgr = session.getWorkspace().getNodeTypeManager();
