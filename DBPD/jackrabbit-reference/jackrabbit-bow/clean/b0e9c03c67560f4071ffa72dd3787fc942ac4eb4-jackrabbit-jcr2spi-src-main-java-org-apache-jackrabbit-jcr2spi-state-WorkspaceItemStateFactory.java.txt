JCR-1244: No need for NodeReferences in jcr2spi
    - Applied the proposed patch

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@605155 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.HashSet;
-import java.util.Set;
-import java.util.Arrays;
-    public NodeReferences getNodeReferences(NodeState nodeState) {
+    public PropertyId[] getNodeReferences(NodeState nodeState) {
-        if (entry.getUniqueID() == null || !entry.hasPropertyEntry(NameConstants.JCR_UUID)) {
+        if (entry.getUniqueID() == null
+                || !entry.hasPropertyEntry(NameConstants.JCR_UUID)) {
-            return EmptyNodeReferences.getInstance();
+            return new PropertyId[0];
-            return new NodeReferencesImpl(nInfo.getReferences());
+            return nInfo.getReferences();
-            // ignore
+            log.debug("Unable to determine references to {}", nodeState);
+            return new PropertyId[0];
-        // exception or no matching entry found.
-        log.debug("Unable to determine references for NodeState " + nodeState);
-        return EmptyNodeReferences.getInstance();
-    //-----------------------------------------------------< NodeReferences >---
-    /**
-     * <code>NodeReferences</code> represents the references (i.e. properties of
-     * type <code>REFERENCE</code>) to a particular node (denoted by its unique ID).
-     */
-    private class NodeReferencesImpl implements NodeReferences {
-
-        private PropertyId[] references;
-
-        /**
-         * Private constructor
-         *
-         * @param references
-         */
-        private NodeReferencesImpl(PropertyId[] references) {
-            this.references = references;
-        }
-
-        //-------------------------------------------------< NodeReferences >---
-        /**
-         * @see NodeReferences#isEmpty()
-         */
-        public boolean isEmpty() {
-            return references.length <= 0;
-        }
-
-        /**
-         * @see NodeReferences#iterator()
-         */
-        public Iterator iterator() {
-            if (references.length > 0) {
-                Set referenceIds = new HashSet();
-                referenceIds.addAll(Arrays.asList(references));
-                return Collections.unmodifiableSet(referenceIds).iterator();
-            } else {
-                return Collections.EMPTY_SET.iterator();
-            }
-        }
-    }
