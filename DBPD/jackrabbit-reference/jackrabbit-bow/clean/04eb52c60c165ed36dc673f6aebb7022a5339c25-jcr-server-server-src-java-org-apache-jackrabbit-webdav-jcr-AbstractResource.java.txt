JCR-405: PROPPATCH doesn't respect document order
minor improvements within 'jcr' package:
- reorder nodes
- fixing creation/replacement of multivalued JCR properties
- contentlength for single value JCR properties
- improve spooling of resource content

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@397835 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.property.DavPropertyNameIterator;
+import org.apache.jackrabbit.webdav.property.DavPropertyIterator;
-import java.io.InputStream;
-import java.io.OutputStream;
-     * Returns <code>null</code>
+     * Spools the properties of this resource to the context. Note that subclasses
+     * are in charge of spooling the data to the output stream provided by the
+     * context.
-     * @return Always returns <code>null</code>
-     */
-    InputStream getStream() {
-        return null;
-    }
-
-    /**
-
-
-        // spool content
-        InputStream in = getStream();
-        OutputStream out = outputContext.getOutputStream();
-        if (in != null && out != null) {
-            try {
-                IOUtil.spool(in, out);
-            } finally {
-                // also close stream if not sending content
-                try {
-                    in.close();
-                } catch (IOException e) {
-                    // ignore
-                }
-            }
-        }
-     * Throws {@link DavServletResponse#SC_METHOD_NOT_ALLOWED}
+     * Builds a single List from the properties to set and the properties to
+     * remove and delegates the list to {@link #alterProperties(List)};
+        List changeList = new ArrayList();
+        if (removePropertyNames != null) {
+            DavPropertyNameIterator it = removePropertyNames.iterator();
+            while (it.hasNext()) {
+                changeList.add(it.next());
+            }
+        }
+        if (setProperties != null) {
+            DavPropertyIterator it = setProperties.iterator();
+            while (it.hasNext()) {
+                changeList.add(it.next());
+            }
+        }
+        return alterProperties(changeList);
+    }
+
+    /**
+     * Throws {@link DavServletResponse#SC_METHOD_NOT_ALLOWED}
+     *
+     * @see DavResource#alterProperties(List)
+     */
+    public MultiStatusResponse alterProperties(List changeList) throws DavException {
