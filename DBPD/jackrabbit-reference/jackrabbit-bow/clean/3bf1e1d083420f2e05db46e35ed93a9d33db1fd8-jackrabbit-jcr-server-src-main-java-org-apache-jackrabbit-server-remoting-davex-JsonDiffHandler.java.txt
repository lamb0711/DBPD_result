JCR-2113 : JSR 283 Access Control Management (patch provided by alfusainey jallow, commit with minor modifications and some TODOs (in particular testing).

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1646435 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.Property;
+import javax.jcr.nodetype.ConstraintViolationException;
+import javax.jcr.nodetype.ItemDefinition;
+    private final ProtectedRemoveManager protectedRemoveManager;
+        this(session, requestItemPath, data, null);
+    }
+
+    JsonDiffHandler(Session session, String requestItemPath, RequestData data, ProtectedRemoveManager protectedRemoveManager) throws RepositoryException {
+        this.protectedRemoveManager = protectedRemoveManager;
-            session.getItem(itemPath).remove();
+            Item item = session.getItem(itemPath);
+            
+            ItemDefinition def = (item.isNode()) ? ((Node) item).getDefinition() : ((Property) item).getDefinition();
+            if (def.isProtected()) {
+                // delegate to the manager.
+                if (protectedRemoveManager == null || !protectedRemoveManager.remove(session, itemPath)) {
+                   throw new ConstraintViolationException("Cannot remove protected node: no suitable handler configured.");
+                }
+            } else {
+                item.remove();
+            }
