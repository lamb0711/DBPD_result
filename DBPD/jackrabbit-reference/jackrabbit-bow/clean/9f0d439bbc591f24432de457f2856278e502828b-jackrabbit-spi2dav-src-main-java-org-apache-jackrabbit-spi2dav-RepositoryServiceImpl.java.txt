JCR-3076: Mandatory authentication prevents webdav client connections

Return an empty set of descriptors when the descriptor report method requires authentication.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1173118 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.commons.httpclient.HttpStatus;
-    private Map<String, QValue[]> descriptors;
+    /** Repository descriptors. */
+    private final Map<String, QValue[]> descriptors =
+            new HashMap<String, QValue[]>();
-        if (descriptors == null) {
+        if (descriptors.isEmpty()) {
-                getClient(null).executeMethod(method);
+                int sc = getClient(null).executeMethod(method);
+                if (sc == HttpStatus.SC_UNAUTHORIZED
+                        || sc == HttpStatus.SC_PROXY_AUTHENTICATION_REQUIRED) {
+                    // JCR-3076: Mandatory authentication prevents us from
+                    // accessing the descriptors on the server, so instead
+                    // of failing with an exception we simply return an empty
+                    // set of descriptors
+                    log.warn("Authentication required to access repository descriptors");
+                    return descriptors;
+                }
+
-                descriptors = new HashMap<String, QValue[]>();
