JCR-1633: When node is created and locked in same transaction, exception is thrown

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@773483 13f79535-47bb-0310-9956-ffa450edef68

-    private final SessionImpl session;
+    private final SessionImpl sysSession;
-        this.session = session;
+        this.sysSession = session;
-                session.getItemManager().getItem(lockToken.getId());
-            Path path = getPath(lockToken.getId());
+                sysSession.getItemManager().getItem(lockToken.getId());
+            Path path = getPath(sysSession, lockToken.getId());
-            Path path = getPath(node.getId());
+            Path path = getPath(session, node.getId());
-            PathMap.Element element = lockMap.map(getPath(node.getId()), true);
+            PathMap.Element element = lockMap.map(getPath(session, node.getId()), true);
-            path = getPath(id);
+            path = getPath(sysSession, id);
-            Path path = getPath(node.getId());
+            Path path = getPath(session, node.getId());
-            PathMap.Element element = lockMap.map(getPath(node.getId()), true);
+            SessionImpl session = (SessionImpl) node.getSession();
+            PathMap.Element element = lockMap.map(getPath(session, node.getId()), true);
-            PathMap.Element element = lockMap.map(getPath(node.getId()), true);
+            SessionImpl nodeSession = (SessionImpl) node.getSession();
+            PathMap.Element element = lockMap.map(getPath(nodeSession, node.getId()), true);
-            Path path = getPath(node.getId());
+            SessionImpl session = (SessionImpl) node.getSession();
+            Path path = getPath(session, node.getId());
-        checkLock(getPath(node.getId()), session);
+        checkLock(getPath(session, node.getId()), session);
-                this.session.getItemManager().getItem(lockToken.getId());
+                this.sysSession.getItemManager().getItem(lockToken.getId());
-                this.session.getItemManager().getItem(lockToken.getId());
+                this.sysSession.getItemManager().getItem(lockToken.getId());
-    private Path getPath(ItemId id) throws RepositoryException {
+    private Path getPath(SessionImpl session, ItemId id) throws RepositoryException {
-                        session.getQPath(event.getPath()).getNormalizedPath(),
+                        sysSession.getQPath(event.getPath()).getNormalizedPath(),
-                NodeImpl node = (NodeImpl) session.getItemManager().
+                NodeImpl node = (NodeImpl) sysSession.getItemManager().
-                        SessionImpl systemSession = LockManagerImpl.this.session;
+                        SessionImpl systemSession = LockManagerImpl.this.sysSession;
-            Path path = getPath(nodeId);
+            Path path = getPath(sysSession, nodeId);
-            Path path = getPath(nodeId);
+            Path path = getPath(sysSession, nodeId);
