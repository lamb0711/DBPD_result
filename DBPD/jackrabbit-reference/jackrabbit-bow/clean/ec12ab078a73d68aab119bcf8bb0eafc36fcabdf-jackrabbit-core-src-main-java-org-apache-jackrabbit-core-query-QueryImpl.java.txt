JCR-3133 Query Stats should use the TimeSeries mechanism

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1195423 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.api.stats.RepositoryStatistics.Type;
+import org.apache.jackrabbit.core.stats.RepositoryStatisticsImpl;
-        long time = System.currentTimeMillis();
+        long time = System.nanoTime();
+
-        time = System.currentTimeMillis() - time;
-        log.debug("executed in {} ms. ({})", time, statement);
+        time = System.nanoTime() - time;
+        final long timeMs = time / 1000;
+        log.debug("executed in {} ms. ({})", timeMs, statement);
+        RepositoryStatisticsImpl statistics = sessionContext
+                .getRepositoryContext().getRepositoryStatistics();
+        statistics.getCounter(Type.QUERY_COUNT).incrementAndGet();
+        statistics.getCounter(Type.QUERY_DURATION).addAndGet(time);
-                .logQuery(language, statement, time);
+                .logQuery(language, statement, timeMs);
