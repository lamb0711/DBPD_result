JCR-906: Introduce similarity function
- initial version which uses a copy of the class MoreLikeThis from the lucene similar contrib.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@536515 13f79535-47bb-0310-9956-ffa450edef68

+     * QName for rep:similar
+     */
+    static final QName REP_SIMILAR = new QName(QName.NS_REP_URI, "similar");
+
+    /**
+            } else if (NameFormat.format(REP_SIMILAR, resolver).equals(fName)) {
+                if (node.jjtGetNumChildren() == 2) {
+                    if (queryNode instanceof NAryQueryNode) {
+                        NAryQueryNode parent = (NAryQueryNode) queryNode;
+                        RelationQueryNode rel = new RelationQueryNode(
+                                parent, RelationQueryNode.OPERATION_SIMILAR);
+                        parent.addOperand(rel);
+                        // get path string
+                        node.jjtGetChild(1).jjtAccept(this, rel);
+                        // check if string is set
+                        if (rel.getStringValue() == null) {
+                            exceptions.add(new InvalidQueryException(
+                                    "Argument for rep:similar() must be of type string"));
+                        }
+                    } else {
+                        exceptions.add(new InvalidQueryException(
+                                "Unsupported location for rep:similar()"));
+                    }
+                } else {
+                    exceptions.add(new InvalidQueryException(
+                            "Wrong number of arguments for rep:similar()"));
+                }
