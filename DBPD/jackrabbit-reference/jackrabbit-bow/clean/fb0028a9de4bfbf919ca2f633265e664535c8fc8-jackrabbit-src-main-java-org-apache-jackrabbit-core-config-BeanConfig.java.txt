JCR-561 Add support to provide custom classloader for class instantiation from configuration

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@440026 13f79535-47bb-0310-9956-ffa450edef68

+    /** The default class loader used by all instances of this class */
+    private static ClassLoader DEFAULT_CLASS_LOADER =
+        BeanConfig.class.getClassLoader();
+    
+    /**
+     * The current class loader used by this instance to create instances of
+     * configured classes.
+     */
+    private ClassLoader classLoader = getDefaultClassLoader();
+    
-            Object object = Class.forName(getClassName()).newInstance();
+            Class objectClass =
+                Class.forName(getClassName(), true, getClassLoader());
+            Object object = objectClass.newInstance();
+    //---------- Configurable class loader support ----------------------------
+    
+    /**
+     * Returns the current <code>ClassLoader</code> used to instantiate objects
+     * in the {@link #newInstance()} method.
+     * 
+     * @see #newInstance()
+     * @see #setClassLoader(ClassLoader)
+     * @see #getDefaultClassLoader()
+     * @see #setDefaultClassLoader(ClassLoader)
+     */
+    public ClassLoader getClassLoader() {
+        return classLoader;
+    }
+    
+    /**
+     * Sets the <code>ClassLoader</code> used to instantiate objects in the
+     * {@link #newInstance()} method.
+     * 
+     * @param classLoader The class loader to set on this instance. If this is
+     *      <code>null</code> the system class loader will be used, which may
+     *      lead to unexpected class loading failures.
+     *      
+     * @see #newInstance()
+     * @see #getClassLoader()
+     * @see #getDefaultClassLoader()
+     * @see #setDefaultClassLoader(ClassLoader)
+     */
+    public void setClassLoader(ClassLoader classLoader) {
+        this.classLoader = classLoader;
+    }
+    
+    /**
+     * Returns the current <code>ClassLoader</code> used for new instances of
+     * this class as the loader used to instantiate objects in the
+     * {@link #newInstance()} method.
+     * 
+     * @see #newInstance()
+     * @see #getClassLoader()
+     * @see #setClassLoader(ClassLoader)
+     * @see #setDefaultClassLoader(ClassLoader)
+     */
+    public static ClassLoader getDefaultClassLoader() {
+        return DEFAULT_CLASS_LOADER;
+    }
+    
+    /**
+     * Sets the <code>ClassLoader</code> used for new instances of this class as
+     * the loader to instantiate objects in the {@link #newInstance()} method.
+     * 
+     * @param classLoader The class loader to set as the default class loader.
+     *      If this is <code>null</code> the system class loader will be used,
+     *      which may lead to unexpected class loading failures. 
+     *      
+     * @see #newInstance()
+     * @see #getClassLoader()
+     * @see #setClassLoader(ClassLoader)
+     * @see #getDefaultClassLoader()
+     */
+    public static void setDefaultClassLoader(ClassLoader classLoader) {
+        DEFAULT_CLASS_LOADER = classLoader;
+    }
