JCR-3779 - Node.getPath() returns inconsistent values depending on whether node is saved or not
JCR-3368 - CachingHierarchyManager: inconsistent state after transient changes on root node


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1596550 13f79535-47bb-0310-9956-ffa450edef68

-        // Optimization: ignore notifications for nodes that are not in the cache
+                // Optimization: ignore notifications for nodes that are not in the cache
+            } else if (state.getParentId() == null && idCache.containsKey(id)) {
+                // A top level node was added
+                evictAll(id, true);
-        // Optimization: ignore notifications for nodes that are not in the cache
+                // Optimization: ignore notifications for nodes that are not in the cache
+            } else if (state.getParentId() == null && idCache.containsKey(id)) {
+                // A top level node was removed
+                evictAll(id, true);
