simplified and adapted bdb-persistence to latest modifications in core (r329224)

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@329242 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Collection;
-import java.util.Iterator;
-
-import org.apache.jackrabbit.core.PropertyId;
-import org.apache.jackrabbit.core.state.NodeReferences;
-import org.apache.jackrabbit.core.state.NodeReferencesId;
-
+import org.apache.commons.logging.Log;
+import org.apache.commons.logging.LogFactory;
+import org.apache.jackrabbit.core.state.NodeReferences;
+import org.apache.jackrabbit.core.state.NodeReferencesId;
+import org.apache.jackrabbit.core.state.util.Serializer;
+    private Log log = LogFactory.getLog(NodeReferencesTupleBinding.class);
+
-        refs.clearAllReferences();
-        // references
-        int count = in.readInt(); // count
-        for (int i = 0; i < count; i++) {
-            refs.addReference(PropertyId.valueOf(in.readString())); // propertyId
+        try {
+            Serializer.deserialize(refs, in);
+        } catch (Exception e) {
+            // since the TupleInput methods do not throw any
+            // exceptions the above call should neither...
+            String msg = "error while deserializing node references";
+            log.debug(msg);
+            throw new RuntimeException(msg, e);
-
-        NodeReferences refs = (NodeReferences) o;
-
-        // references
-        Collection c = refs.getReferences();
-        out.writeInt(c.size()); // count
-        for (Iterator iter = c.iterator(); iter.hasNext();) {
-            PropertyId propId = (PropertyId) iter.next();
-            out.writeString(propId.toString()); // propertyId
+        try {
+            Serializer.serialize((NodeReferences) o, out);
+        } catch (Exception e) {
+            // since the TupleOutput methods do not throw any
+            // exceptions the above call should neither...
+            String msg = "error while serializing node references";
+            log.debug(msg);
+            throw new RuntimeException(msg, e);
-
-
