JCR-890: concurrent read-only access to a session

Make ItemValidator a more integral part of SessionContext.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@985249 13f79535-47bb-0310-9956-ffa450edef68

-     * node type registry
-     */
-    protected final NodeTypeRegistry ntReg;
-
-    /**
-    public ItemValidator(SessionContext context) throws RepositoryException {
+    public ItemValidator(SessionContext context) {
-        this.ntReg = context.getRepositoryContext().getNodeTypeRegistry();
+        NodeTypeRegistry registry = context.getNodeTypeRegistry();
-                ntReg.getEffectiveNodeType(nodeState.getNodeTypeName());
+            registry.getEffectiveNodeType(nodeState.getNodeTypeName());
-            return ntReg.getEffectiveNodeType(
+            return context.getNodeTypeRegistry().getEffectiveNodeType(
-        return entParent.getApplicableChildNodeDef(name, nodeTypeName, ntReg);
+        return entParent.getApplicableChildNodeDef(
+                name, nodeTypeName, context.getNodeTypeRegistry());
