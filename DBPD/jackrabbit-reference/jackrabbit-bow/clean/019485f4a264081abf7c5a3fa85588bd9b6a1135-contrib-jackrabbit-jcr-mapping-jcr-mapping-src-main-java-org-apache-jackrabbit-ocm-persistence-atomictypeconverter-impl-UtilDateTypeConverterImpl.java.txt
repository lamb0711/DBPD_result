
* Review the interface AtomicTypeConverter : rename the method getString into getXPathQueryValue. This method is mainly used by FiterImpl in order to build Xpath query expression based on the object attribute. 
* Solve issue JCR-930 : now dates are not converted in long if UtilDateConverterImpl is used. 

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@544959 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Calendar;
+import javax.jcr.ValueFormatException;
+	
-		}
-		return valueFactory.createValue(((java.util.Date) propValue).getTime());		
+		}		
+		Calendar calendar =  Calendar.getInstance();
+		calendar.setTime((Date) propValue);
+		return valueFactory.createValue(calendar);		
-			long time = value.getLong();
-			return new Date(time);
+			Calendar calendar = value.getDate();
+			return calendar.getTime();
-	public String getStringValue(Object object)
+	public String getXPathQueryValue(ValueFactory valueFactory, Object object)
-		return new Long(((java.util.Date) object).getTime()).toString();
+		try 
+		{
+			Calendar calendar =  Calendar.getInstance();
+			
+			calendar.setTime((Date) object);
+
+			return "xs:dateTime('" + valueFactory.createValue(calendar).getString() + "')";
+
+		} 
+		catch (RepositoryException e) 
+		{
+			throw new IncorrectAtomicTypeException("Impossible to get the sting value ", e);
+		}
