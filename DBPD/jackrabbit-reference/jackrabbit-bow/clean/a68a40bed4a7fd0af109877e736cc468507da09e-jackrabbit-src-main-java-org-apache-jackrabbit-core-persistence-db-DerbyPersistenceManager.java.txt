JCR-633 DerbyPersistenceManager only usable for embedded databases


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@473373 13f79535-47bb-0310-9956-ffa450edef68

- * embedded Derby database using a simple custom serialization format and a
+ * embedded or standalone Derby database using a simple custom serialization format and a
- * <code>"jdbc:derby:[db];[attributes]"</code></li>
+ * <code>"jdbc:derby:[//host:port/][db];[attributes]"</code></li>
- * (default: <code>"org.apache.derby.jdbc.EmbeddedDriver"</code>)</li>
+ * (default: <code>"org.apache.derby.jdbc.EmbeddedDriver"</code>); Use
+ * <code>"org.apache.derby.jdbc.ClientDriver"</code> when using a standalone database</li>
- * <li><code>user</code>: the database user (default: <code>""</code>)</li>
- * <li><code>password</code>: the user's password (default: <code>""</code>)</li>
+ * <li><code>user</code>: the database user (default: <code>null</code>)</li>
+ * <li><code>password</code>: the user's password (default: <code>null</code>)</li>
+ * <li><code>shutdownOnClose</code>: if <code>true</code> (the default) the
+ * database is shutdown when the last connection is closed;
+ * set this to <code>false</code> when using a standalone database</li>
+     * Flag indicating whether this derby database should be shutdown on close.
+     */
+    protected boolean shutdownOnClose;
+
+    /**
-        user = "";
-        password = "";
+        shutdownOnClose = true;
+    }
+
+    public boolean getShutdownOnClose() {
+        return shutdownOnClose;
+    }
+
+    public void setShutdownOnClose(boolean shutdownOnClose) {
+        this.shutdownOnClose = shutdownOnClose;
-        // now it's safe to shutdown the embedded Derby database
-        try {
-            DriverManager.getConnection(url);
-        } catch (SQLException e) {
-            // a shutdown command always raises a SQLException
-            log.info(e.getMessage());
+        if (shutdownOnClose) {
+            // now it's safe to shutdown the embedded Derby database
+            try {
+                DriverManager.getConnection(url);
+            } catch (SQLException e) {
+                // a shutdown command always raises a SQLException
+                log.info(e.getMessage());
+            }
