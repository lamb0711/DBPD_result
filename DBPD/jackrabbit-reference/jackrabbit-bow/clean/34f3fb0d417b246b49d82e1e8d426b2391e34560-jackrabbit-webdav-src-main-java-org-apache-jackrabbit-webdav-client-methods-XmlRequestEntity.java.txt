JCR-1310: Webdav: Drop xerces dependency
    - Removed Xerces dependency from jackrabbit-webdav.
    - Using SerializingContentHandler from jackrabbit-jcr-commons (JCR-1350)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@659084 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.ByteArrayOutputStream;
+import java.io.IOException;
+import java.io.OutputStream;
+
+import javax.xml.transform.Transformer;
+import javax.xml.transform.TransformerException;
+import javax.xml.transform.TransformerFactory;
+import javax.xml.transform.dom.DOMSource;
+import javax.xml.transform.sax.SAXResult;
+
+import org.apache.commons.httpclient.methods.RequestEntity;
+import org.apache.jackrabbit.commons.xml.SerializingContentHandler;
-import org.apache.commons.httpclient.methods.RequestEntity;
-import org.apache.commons.httpclient.methods.StringRequestEntity;
-import org.apache.xml.serialize.OutputFormat;
-import org.apache.xml.serialize.XMLSerializer;
-
-import java.io.OutputStream;
-import java.io.IOException;
-import java.io.ByteArrayOutputStream;
+import org.xml.sax.ContentHandler;
+import org.xml.sax.SAXException;
-    private final RequestEntity delegatee;
+    private final ByteArrayOutputStream xml = new ByteArrayOutputStream();
-        super();
-        ByteArrayOutputStream out = new ByteArrayOutputStream();
-        OutputFormat format = new OutputFormat("xml", "UTF-8", false);
-        XMLSerializer serializer = new XMLSerializer(out, format);
-        serializer.setNamespaces(true);
-        serializer.asDOMSerializer().serialize(xmlDocument);
-        delegatee = new StringRequestEntity(out.toString(), "text/xml", "UTF-8");
+        try {
+            ContentHandler handler =
+                SerializingContentHandler.getSerializer(xml);
+            TransformerFactory factory = TransformerFactory.newInstance();
+            Transformer transformer = factory.newTransformer();
+            transformer.transform(
+                    new DOMSource(xmlDocument), new SAXResult(handler));
+        } catch (TransformerException e) {
+            log.error(e.getMessage());
+            throw new IOException(e.getMessage());
+        } catch (SAXException e) {
+            log.error(e.getMessage());
+            throw new IOException(e.getMessage());
+        }
-        return delegatee.isRepeatable();
+        return true;
-        return delegatee.getContentType();
+        return "text/xml"; // TODO: Shouldn't this be application/xml?
-        delegatee.writeRequest(out);
+        xml.writeTo(out);
-        return delegatee.getContentLength();
+        return xml.size();
+
