Make locking part of XAResource's transaction support

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@354456 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.SessionListener;
-import org.apache.log4j.Logger;
- * Contains information about a lock and gets placed inside the child
- * information of a {@link org.apache.jackrabbit.core.PathMap}.
+ * Common information about a lock.
-class LockInfo implements SessionListener {
-
-    /**
-     * Logger
-     */
-    private static final Logger log = Logger.getLogger(LockInfo.class);
-
-    /**
-     * Lock manager
-     */
-    private final LockManagerImpl lockMgr;
+abstract class AbstractLockInfo {
-    final LockToken lockToken;
+    protected final LockToken lockToken;
-    final boolean sessionScoped;
+    protected final boolean sessionScoped;
-    final boolean deep;
+    protected final boolean deep;
-    final String lockOwner;
+    protected final String lockOwner;
-    private SessionImpl lockHolder;
+    protected SessionImpl lockHolder;
-    private boolean live;
+    protected boolean live;
-     * @param lockMgr       lock manager
-    public LockInfo(LockManagerImpl lockMgr, LockToken lockToken,
-                    boolean sessionScoped, boolean deep, String lockOwner) {
-        this.lockMgr = lockMgr;
+    public AbstractLockInfo(LockToken lockToken, boolean sessionScoped, boolean deep,
+                    String lockOwner) {
-     *
-     *
-
-    //-------------------------------------------------------< SessionListener >
-
-    /**
-     * {@inheritDoc}
-     * <p/>
-     * When the owning session is logging out, we have to perform some
-     * operations depending on the lock type.
-     * (1) If the lock was session-scoped, we unlock the node.
-     * (2) If the lock was open-scoped, we remove the lock token
-     *     from the session and set the lockHolder field to <code>null</code>.
-     */
-    public void loggingOut(SessionImpl session) {
-        if (live) {
-            if (sessionScoped) {
-                lockMgr.unlock(this);
-            } else {
-                if (session.equals(lockHolder)) {
-                    session.removeLockToken(lockToken.toString());
-                    lockHolder = null;
-                }
-            }
-        }
-    }
-
-    /**
-     * {@inheritDoc}
-     */
-    public void loggedOut(SessionImpl session) {
-    }
