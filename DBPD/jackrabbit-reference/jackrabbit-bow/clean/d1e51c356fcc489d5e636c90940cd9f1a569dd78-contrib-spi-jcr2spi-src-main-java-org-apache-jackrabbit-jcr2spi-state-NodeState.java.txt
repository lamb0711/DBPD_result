work in progress

- NodeState: rename addNodeReferences to setNodeReferences
-            'set' is not possible if NodeState is transient
-            since NodeReferences are not copied to overlaying state, refs
             must be retrieved from overlayed state if present.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@432278 13f79535-47bb-0310-9956-ffa450edef68

-    void addNodeReferences(NodeReferences references) {
-        this.references = references;
+    /**
+     * Return the <code>NodeReferences</code> present on this state or
+     * <code>null</code>.
+     *
+     * @return references
+     */
+    NodeReferences getNodeReferences() {
+        if (hasOverlayedState()) {
+            return ((NodeState)getOverlayedState()).references;
+        } else {
+            return references;
+        }
-    NodeReferences getNodeReferences() {
-        return references;
+    /**
+     * Set the <code>NodeReferences</code> for this state.
+     *
+     * @param references
+     */
+    void setNodeReferences(NodeReferences references) {
+        if (isTransient()) {
+            // TODO: check again
+            throw new UnsupportedOperationException("Cannot set references to a transient node state.");
+        }
+        this.references = references;
