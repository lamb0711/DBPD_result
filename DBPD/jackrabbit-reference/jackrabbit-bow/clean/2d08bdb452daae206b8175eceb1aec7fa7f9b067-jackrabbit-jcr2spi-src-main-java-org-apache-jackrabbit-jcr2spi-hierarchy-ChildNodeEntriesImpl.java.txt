JCR-1798: Avoid individual Item reloading upon Session/Item.refresh(true)
JCR-1809: Avoid extra round trip to the SPI upon Node.getNode and Session.getItem

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@704933 13f79535-47bb-0310-9956-ffa450edef68

-     * @see HierarchyEntry#reload(boolean, boolean) that ignores items with
+     * @see HierarchyEntry#reload(boolean) that ignores items with
-                reorderAfter(ln, prevLN);
+                if (prevLN != ln) {
+                    reorderAfter(ln, prevLN);
+                } else {
+                    // there was an existing entry but it's the same as the one
+                    // created/retrieved before. getting here indicates that
+                    // the SPI implementation provided invalid childNodeInfos.
+                    log.error("ChildInfo iterator contains multiple entries with the same name|index or uniqueID -> ignore ChildNodeInfo.");
+                }
-            entries.reorderNode(insertLN, afterLN.getNextLinkNode());
+            entries.reorderNode(insertLN, currentAfter);
