JCR-455: InternalXAResource.rollback() can be called twice and without prepare
JCR-414: jcr:successors property not persisted correctly within a transaction


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@412995 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.InvalidItemStateException;
+     *
-    protected abstract InternalVersionHistory getInternalVersionHistory()
-            throws RepositoryException;
+    protected InternalVersionHistory getInternalVersionHistory()
+            throws RepositoryException {
+        InternalVersionHistory history =
+                session.getVersionManager().getVersionHistory((NodeId) id);
+        if (history == null) {
+            throw new InvalidItemStateException(id + ": the item does not exist anymore");
+        }
+        return history;
+    }
-     * @see javax.jcr.Node#getUUID()
-     */
-    public String getUUID()
-            throws UnsupportedRepositoryOperationException, RepositoryException {
-        return getInternalVersionHistory().getId().getUUID().toString();
-    }
-
-    /**
