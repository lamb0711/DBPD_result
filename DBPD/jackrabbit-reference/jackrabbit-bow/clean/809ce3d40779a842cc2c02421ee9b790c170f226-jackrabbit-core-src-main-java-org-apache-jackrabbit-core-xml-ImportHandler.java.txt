JCR-1607: Add a NamespaceHelper in jcr-commons
    - Use NamespaceHelper in core

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@657037 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.HashMap;
+import javax.jcr.Session;
-import org.apache.jackrabbit.core.NamespaceRegistryImpl;
-import org.apache.jackrabbit.spi.commons.namespace.NamespaceResolver;
+import org.apache.jackrabbit.commons.NamespaceHelper;
-    protected final NamespaceRegistryImpl nsReg;
-    protected final NamespaceResolver nsResolver;
+
+    private final NamespaceHelper helper;
-    private TargetImportHandler targetHandler;
+    private TargetImportHandler targetHandler = null;
-    public ImportHandler(Importer importer, NamespaceResolver nsResolver,
-                         NamespaceRegistryImpl nsReg) {
+    public ImportHandler(Importer importer, Session session)
+            throws RepositoryException {
-        this.nsResolver = nsResolver;
-        this.nsReg = nsReg;
+        this.helper = new NamespaceHelper(session);
+        this.localNamespaceMappings = helper.getNamespaces();
-    /**
-     * {@inheritDoc}
-     */
-    public void startDocument() throws SAXException {
-        targetHandler = null;
-
-        try {
-            localNamespaceMappings = new HashMap();
-            String[] uris = nsReg.getURIs();
-            for (int i = 0; i < uris.length; i++) {
-                localNamespaceMappings.put(
-                        nsResolver.getPrefix(uris[i]), uris[i]);
-            }
-        } catch (RepositoryException re) {
-            throw new SAXException(re);
-        }
-    }
-        targetHandler.endDocument();
+        if (targetHandler != null) {
+            targetHandler.endDocument();
+        }
-            // Register the namespace unless already registered
-            nsReg.safeRegisterNamespace(prefix, uri);
+            helper.registerNamespace(prefix, uri);
-    public void endPrefixMapping(String prefix) throws SAXException {
-        /**
-         * nothing to do here as namespace context has already been popped
-         * in endElement event
-         */
-    }
-
-    /**
-     * {@inheritDoc}
-     */
+
