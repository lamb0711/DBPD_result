misc. small changes for better performance

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@56480 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.BLOBFileValue;
-import org.apache.jackrabbit.core.InternalValue;
-import org.apache.jackrabbit.core.PropertyId;
-import org.apache.jackrabbit.core.QName;
+import org.apache.jackrabbit.core.*;
+
+    /**
+     * @see PersistenceManager#exists(org.apache.jackrabbit.core.ItemId id)
+     */
+    public boolean exists(ItemId id) throws ItemStateException {
+        if (!initialized) {
+            throw new IllegalStateException("not initialized");
+        }
+
+        try {
+            if (id.denotesNode()) {
+                NodeId nodeId = (NodeId) id;
+                String nodeFilePath = buildNodeFilePath(nodeId.getUUID());
+                FileSystemResource nodeFile = new FileSystemResource(itemStateStore, nodeFilePath);
+                return nodeFile.exists();
+            } else {
+                PropertyId propId = (PropertyId) id;
+                String propFilePath = buildPropFilePath(propId.getParentUUID(), propId.getName());
+                FileSystemResource propFile = new FileSystemResource(itemStateStore, propFilePath);
+                return propFile.exists();
+            }
+        } catch (FileSystemException fse) {
+            String msg = "failed to check existence of item state: " + id;
+            log.error(msg, fse);
+            throw new ItemStateException(msg, fse);
+        }
+    }
+
+    /**
+     * @see PersistenceManager#referencesExist(NodeId targetId)
+     */
+    public boolean referencesExist(NodeId targetId) throws ItemStateException {
+        if (!initialized) {
+            throw new IllegalStateException("not initialized");
+        }
+
+        try {
+            String uuid = targetId.getUUID();
+            String refsFilePath = buildNodeReferencesFilePath(uuid);
+            FileSystemResource refsFile = new FileSystemResource(itemStateStore, refsFilePath);
+            return refsFile.exists();
+        } catch (FileSystemException fse) {
+            String msg = "failed to check existence of references: " + targetId;
+            log.error(msg, fse);
+            throw new ItemStateException(msg, fse);
+        }
+    }
