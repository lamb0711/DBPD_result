JCR-3275: Audit log
- add log on external update

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1329195 13f79535-47bb-0310-9956-ffa450edef68

-            listener.externalUpdate(record.getChanges(), record.getEvents(),
+            List<EventState> eventStates = record.getEvents();
+
+            String path = getFirstUserId(eventStates)
+                    + "@" + workspace
+                    + ":" + EventState.getCommonPath(eventStates, null);
+
+            updateCount.compareAndSet(Integer.MAX_VALUE, 0);
+            auditLogger.info("[{}] {} {}", new Object[]{updateCount.incrementAndGet(), 
+                    record.getRevision(), path});
+
+            listener.externalUpdate(record.getChanges(), eventStates,
+
+    private String getFirstUserId(List<EventState> eventStates) {
+        if (eventStates == null || eventStates.isEmpty()) {
+            return "";
+        }
+        return eventStates.get(0).getUserId();
+    }
