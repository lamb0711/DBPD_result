JCR-2076: JSR 283: QOM and SQL2
- QueryObjectModelBuilder for SQL2 parser
- support for SQL2 in jackrabbit-core

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@785594 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.spi.Path;
-    protected final List buffer = new LinkedList();
+    protected final List<ScoreNode[]> buffer = new LinkedList<ScoreNode[]>();
-                        if (node.getSelector2QPath() != null) {
+                        Path selector2Path = node.getSelector2QPath();
+                        if (selector2Path == null || (selector2Path.getLength() == 1 && selector2Path.getNameElement().denotesCurrent())) {
+                            c = new SameNodeJoin(src2, node.getSelector2QName(), reader);
+                        } else {
-                        } else {
-                            c = new SameNodeJoin(src2, node.getSelector2QName(), reader);
-                        if (node.getSelector2QPath() != null) {
+                        Path selector2Path = node.getSelector2QPath();
+                        if (selector2Path == null || (selector2Path.getLength() == 1 && selector2Path.getNameElement().denotesCurrent())) {
+                            c = new SameNodeJoin(src1, node.getSelector1QName(), reader);
+                        } else {
-                        } else {
-                            c = new SameNodeJoin(src1, node.getSelector1QName(), reader);
-            return (ScoreNode[]) buffer.remove(0);
+            return buffer.remove(0);
-                for (int i = 0; i < nodes.length; i++) {
-                    ScoreNode[] node = nodes[i];
+                for (ScoreNode[] node : nodes) {
-        return (ScoreNode[]) buffer.remove(0);
+        return buffer.remove(0);
