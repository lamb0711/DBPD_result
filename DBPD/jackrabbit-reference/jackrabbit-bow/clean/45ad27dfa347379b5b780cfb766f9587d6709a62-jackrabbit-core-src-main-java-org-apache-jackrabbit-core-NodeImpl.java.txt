JCR-1868: Inconsistent state when removing mix:lockable from a locked Node

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@719575 13f79535-47bb-0310-9956-ffa450edef68

+        /*
+         * mix:lockable: the mixin cannot be removed if the node is currently
+         * locked even if the editing session is the lock holder.
+         */
+        if ((NameConstants.MIX_LOCKABLE.equals(mixinName)
+                || mixin.isDerivedFrom(NameConstants.MIX_LOCKABLE))
+                && !entRemaining.includesNodeType(NameConstants.MIX_LOCKABLE)
+                && isLocked()) {
+            throw new ConstraintViolationException(mixinName + " can not be removed: the node is locked.");
+        }
+
+
