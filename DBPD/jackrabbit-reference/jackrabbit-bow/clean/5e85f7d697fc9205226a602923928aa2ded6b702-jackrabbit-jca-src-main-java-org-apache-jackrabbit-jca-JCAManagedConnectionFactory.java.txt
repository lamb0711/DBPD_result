JCR-3570 Make immediately Repository start configureable in JCAManagedConnectionFactory

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1469698 13f79535-47bb-0310-9956-ffa450edef68

+     * Flag indicating whether the Repository should start
+     * immediately or lazy on first access. Per default true so the Repository will
+     * start immediately if this JCAManagedConnectionFactory will be initialized.
+     */
+    private Boolean startRepositoryImmediately = Boolean.TRUE;
+
+    /**
-        // JCR-3491 Start the Repository immediatly in JCA Environment. 
-        // If this Instance is in a Cluster it would not get any changes till someone performs a first login 
-        createRepository();
+    	if (startRepositoryImmediately) {
+    		createRepository();
+    	}
-    public Repository getRepository() throws RepositoryException {
+    @SuppressWarnings("deprecation")
+	public Repository getRepository() throws RepositoryException {
+    	if (repository == null) {
+    		synchronized (this) {
+    			try {
+    				createRepository();
+    			} catch (ResourceException e) {
+    				throw (RepositoryException) e.getLinkedException();
+    			}
+			}
+    	}
+    public Boolean getStartRepositoryImmediately() {
+        return startRepositoryImmediately;
+    }
+
+    public void setStartRepositoryImmediately(Boolean startRepositoryImmediately) {
+        this.startRepositoryImmediately = startRepositoryImmediately;
+    }
+
