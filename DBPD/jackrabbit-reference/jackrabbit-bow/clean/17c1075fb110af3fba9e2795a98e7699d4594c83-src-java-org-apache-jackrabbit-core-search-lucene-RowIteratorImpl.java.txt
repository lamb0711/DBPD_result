Simplify QueryHandler. Added support for jcr:score and jcr:path.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@152654 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.search.Constants;
+import javax.jcr.PathValue;
+import javax.jcr.LongValue;
-        return new RowImpl(nodes.nextNodeImpl());
+        return new RowImpl(nodes.getScore(), nodes.nextNodeImpl());
+        /** The score for this result row */
+        private final float score;
+
+         * @param score the score value for this result row
-        RowImpl(NodeImpl node) {
+        RowImpl(float score, NodeImpl node) {
+            this.score = score;
-                        // property not set
-                        tmp[i] = null;
+                        // property not set or jcr:path / jcr:score
+                        if (Constants.JCR_PATH.equals(properties[i])) {
+                            tmp[i] = PathValue.valueOf(node.getPath());
+                        } else if (Constants.JCR_SCORE.equals(properties[i])) {
+                            tmp[i] = new LongValue((int) (score * 1000f));
+                        } else {
+                            tmp[i] = null;
+                        }
-                    return null;
+                    // either jcr:score / jcr:path or not set
+                    if (Constants.JCR_PATH.equals(prop)) {
+                        return PathValue.valueOf(node.getPath());
+                    } else if (Constants.JCR_SCORE.equals(prop)) {
+                        return new LongValue((int) (score * 1000f));
+                    } else {
+                        return null;
+                    }
