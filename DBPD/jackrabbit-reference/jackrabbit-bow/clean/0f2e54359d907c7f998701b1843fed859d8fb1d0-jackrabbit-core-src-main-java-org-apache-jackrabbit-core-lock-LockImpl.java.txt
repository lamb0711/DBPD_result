JCR-1588 - JSR 283: Access Control (work in progress)
JCR-1590 - JSR 283: Locking
JCR-1915 - Node.setPrimaryNodeType should only redefine child-definitions that are not covered by the new effective nt
JCR-1875 - Failing Node.unlock() might leave inconsistent transient state
JCR-538 - Failing Node.checkin() or Node.checkout() might leave inconsistent transient state

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@732693 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.SessionImpl;
+import org.apache.jackrabbit.core.NodeImpl;
+import org.apache.jackrabbit.core.security.authorization.Permission;
+
-import javax.jcr.lock.Lock;
-        // TODO:  TOBEFIXED for 2.0
-        // TODO   - respect ownerInfo supplied by the client -> see LockManager#lock
+        // make sure the current session has sufficient privileges to refresh
+        // the lock.
+        SessionImpl s = (SessionImpl) node.getSession();
+        s.getAccessManager().checkPermission(((NodeImpl) node).getPrimaryPath(), Permission.LOCK_MNGMT);
+
-     * Always returns {@link Long#MAX_VALUE}.
-     *
-     * @return Always returns {@link Long#MAX_VALUE}.
-        // TODO: TOBEFIXED for 2.0
-        // TODO  - add support for timeout specified by the API user -> LockManager#lock
-        return Long.MAX_VALUE;
+        return info.getSecondsRemaining();
