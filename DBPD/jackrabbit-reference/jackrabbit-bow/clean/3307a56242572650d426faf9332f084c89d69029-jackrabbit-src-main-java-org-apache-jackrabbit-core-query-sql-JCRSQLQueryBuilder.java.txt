JCR-247: Child axis support for XPath predicates

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@477599 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.name.Path;
+import org.apache.jackrabbit.name.MalformedPathException;
-        parent.addOperand(new TextsearchQueryNode(parent, node.getQuery(), node.getPropertyName()));
+        try {
+            Path relPath = null;
+            if (node.getPropertyName() != null) {
+                Path.PathBuilder builder = new Path.PathBuilder();
+                builder.addLast(node.getPropertyName());
+                relPath = builder.getPath();
+            }
+            parent.addOperand(new TextsearchQueryNode(parent, node.getQuery(), relPath, true));
+        } catch (MalformedPathException e) {
+            // path is always valid
+        }
+            Path.PathBuilder builder = new Path.PathBuilder();
+            builder.addLast(propertyName);
+            Path relPath = builder.getPath();
-                node = new RelationQueryNode(parent, propertyName, date, operationType);
+                node = new RelationQueryNode(parent, relPath, date, operationType);
-                node = new RelationQueryNode(parent, propertyName, d, operationType);
+                node = new RelationQueryNode(parent, relPath, d, operationType);
-                node = new RelationQueryNode(parent, propertyName, l, operationType);
+                node = new RelationQueryNode(parent, relPath, l, operationType);
-                node = new RelationQueryNode(parent, propertyName, stringValue, operationType);
+                node = new RelationQueryNode(parent, relPath, stringValue, operationType);
-                node = new RelationQueryNode(parent, propertyName, c.getTime(), operationType);
+                node = new RelationQueryNode(parent, relPath, c.getTime(), operationType);
+        } catch (MalformedPathException e) {
+            // path is always valid, but throw anyway
+            throw new IllegalArgumentException(e.getMessage());
