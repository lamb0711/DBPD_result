JCR-442: Committed patch-060808-backup.txt from Nicolas.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@429606 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.zip.ZipException;
-import javax.jcr.SimpleCredentials;
+
+import org.apache.jackrabbit.core.config.ConfigurationException;
+import org.apache.jackrabbit.core.config.RepositoryConfig;
-import org.apache.jackrabbit.backup.Backup;
-    private static int called = 0;
-    
+
-    public WorkspaceConfigBackup(RepositoryImpl repo, BackupConfig conf, String name) throws LoginException, RepositoryException {
-        super(repo, conf);
+    public WorkspaceConfigBackup(RepositoryImpl repo, BackupConfig conf, String name, String login, String password) throws LoginException, RepositoryException {
+        super(repo, conf, login, password);
-    public void init(RepositoryImpl repo, BackupConfig conf, String name) throws LoginException, RepositoryException {
-        super.init(repo, conf);
+    public void init(RepositoryImpl repo, BackupConfig conf, String name, String login, String password) throws LoginException, RepositoryException {
+        super.init(repo, conf, login, password);
-        Session s = repo.login(new SimpleCredentials(this.conf.getLogin(), this.conf.getPassword().toCharArray()), this.wspName);
-     
+        Session s = this.getRepo().login(this.getCredentials(), this.wspName);
+
-        
+
-        h.write("WspConf" + called , wspXml);
-        called += 1;
+        h.write("WspConf_" + this.wspName , wspXml);
-    public void restore(BackupIOHandler h) {
-        // TODO Auto-generated method stub
+    public void restore(BackupIOHandler h) throws ConfigurationException, ZipException, IOException {
+        //Replace workspace.xml if needed
+        File wspXml = new File(this.getConf().getWorkFolder() + "/workspace.xml");
+        h.read("WspConf_" + this.wspName, wspXml);
-
