JCR-2640: Internal repository context

Restore factory methods that subclasses can use to override the default namespace and node type registries.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@949152 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.state.ItemStateCacheFactory;
-            context.setNamespaceRegistry(
-                    new NamespaceRegistryImpl(context.getFileSystem()));
-            context.setNodeTypeRegistry(new NodeTypeRegistry(
-                    context.getNamespaceRegistry(), context.getFileSystem()));
+            context.setNamespaceRegistry(createNamespaceRegistry());
+            context.setNodeTypeRegistry(createNodeTypeRegistry());
+     * Protected factory method for creating the namespace registry.
+     * Called by the constructor after the repository file system has
+     * been initialised.
+     *
+     * @return namespace registry
+     * @throws RepositoryException if the namespace registry can not be created
+     */
+    protected NamespaceRegistryImpl createNamespaceRegistry()
+            throws RepositoryException {
+        return new NamespaceRegistryImpl(context.getFileSystem());
+    }
+
+    /**
+     * Protected factory method for creating the node type registry.
+     * Called by the constructor after the repository file system and
+     * namespace registry have been initialised.
+     *
+     * @return node type registry
+     * @throws RepositoryException if the node type registry can not be created
+     */
+    protected NodeTypeRegistry createNodeTypeRegistry()
+            throws RepositoryException {
+        return new NodeTypeRegistry(
+                context.getNamespaceRegistry(), context.getFileSystem());
+    }
+
+    /**
-                    context.getFileSystem(), "meta/rootUUID");
+                    context.getFileSystem(), "/meta/rootUUID");
