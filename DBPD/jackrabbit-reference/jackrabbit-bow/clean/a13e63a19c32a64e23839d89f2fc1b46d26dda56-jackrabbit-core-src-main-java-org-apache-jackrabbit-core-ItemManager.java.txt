JCR-890: concurrent read-only access to a session

Move SessionItemStateManager and HierarchyManager into SessionContext.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@957133 13f79535-47bb-0310-9956-ffa450edef68

-     * @param sism        the item state manager associated with the new
-     *                    instance
-     * @param hierMgr     the hierarchy manager
-            SessionItemStateManager sism, HierarchyManager hierMgr,
-        this.sism = sism;
-        this.hierMgr = hierMgr;
+        this.sism = sessionContext.getItemStateManager();
+        this.hierMgr = sessionContext.getHierarchyManager();
-     * @param itemStateProvider the item state provider associated with
-     *                          the new instance
-     * @param hierMgr           the hierarchy manager
-            SessionItemStateManager itemStateProvider,
-            HierarchyManager hierMgr,
-                itemStateProvider, hierMgr, sessionContext, rootNodeDef,
-                rootNodeId, dataStore);
-        itemStateProvider.addListener(mgr);
+                sessionContext, rootNodeDef, rootNodeId, dataStore);
+        sessionContext.getItemStateManager().addListener(mgr);
-                    /**
-                     * the state is a transient wrapper for the underlying
-                     * persistent state, therefore restore the persistent state
-                     * and resurrect this item instance if necessary
-                     */
-                    SessionItemStateManager stateMgr = session.getItemStateManager();
+                    // the state is a transient wrapper for the underlying
+                    // persistent state, therefore restore the persistent state
+                    // and resurrect this item instance if necessary
+                    SessionItemStateManager stateMgr =
+                        sessionContext.getItemStateManager();
