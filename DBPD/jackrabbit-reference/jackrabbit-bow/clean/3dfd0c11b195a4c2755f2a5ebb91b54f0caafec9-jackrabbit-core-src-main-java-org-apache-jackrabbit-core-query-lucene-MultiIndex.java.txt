JCR-3162 Index update overhead on cluster slave due to JCR-905

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1214329 13f79535-47bb-0310-9956-ffa450edef68

-        IndexingQueueStore store = new IndexingQueueStore(indexDir);
-
-        this.indexingQueue = new IndexingQueue(store);
+        this.indexingQueue = new IndexingQueue(new IndexingQueueStore(indexDir));
-        for (Iterator<?> it = indexNames.iterator(); it.hasNext(); ) {
-            IndexInfo info = (IndexInfo) it.next();
+        Iterator<IndexInfo> iterator = indexNames.iterator();
+        while (iterator.hasNext()) {
+            IndexInfo info = iterator.next();
+                checkIndexingQueue(true);
-                scheduleFlushTask();
+                safeFlush();
+                scheduleFlushTask();
-        if (volatileIndex.getNumDocuments() > 0) {
+        int volatileIndexDocuments = volatileIndex.getNumDocuments();
+        if (volatileIndexDocuments > 0) {
-            log.debug("Committed in-memory index in " + time + "ms.");
+            log.debug("Committed in-memory index containing {} documents in {}ms.", volatileIndexDocuments, time);
-    
+
