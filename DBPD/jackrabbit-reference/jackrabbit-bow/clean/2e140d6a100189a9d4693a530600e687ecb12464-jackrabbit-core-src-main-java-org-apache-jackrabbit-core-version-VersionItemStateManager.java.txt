JCR-2087: Upgrade to Java 5 as the base platform

Use Iterables and the foreach loop construct to simplify code that accesses a ChangeLog.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@793238 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Iterator;
+import java.util.HashSet;
+import java.util.Set;
-            Iterator iterator = references.modifiedRefs();
-            while (iterator.hasNext()) {
+            for (NodeReferences source : references.modifiedRefs()) {
-                NodeReferences source = (NodeReferences) iterator.next();
-                Iterator iter = source.getReferences().iterator();
-                while (iter.hasNext()) {
-                    PropertyId id = (PropertyId) iter.next();
+                for (PropertyId id : source.getReferences()) {
-        for (Iterator iter = changes.modifiedRefs(); iter.hasNext();) {
-            NodeReferences refs = (NodeReferences) iter.next();
-            NodeId id = refs.getTargetId();
+        Set<NodeReferencesId> remove = new HashSet<NodeReferencesId>();
+        for (NodeReferences refs : changes.modifiedRefs()) {
+                NodeId id = refs.getTargetId();
-                    // remove references
-                    iter.remove();
+                    remove.add(refs.getId());
+        // remove references
+        for (NodeReferencesId id : remove) {
+            changes.removeReferencesEntry(id);
+        }
