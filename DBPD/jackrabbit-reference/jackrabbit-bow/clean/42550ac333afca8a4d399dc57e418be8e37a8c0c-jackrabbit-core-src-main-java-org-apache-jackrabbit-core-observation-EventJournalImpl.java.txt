JCR-515: Enhance test data

Use the FilteredRangeIterator class to implement FilteredEventIterator so that getSize() will return a good value and we can run more tests.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1000867 13f79535-47bb-0310-9956-ffa450edef68

+
+import org.apache.jackrabbit.core.SessionImpl;
-     * The name of the workspace to filter journal records.
+     * Target session.
-    private final String wspName;
+    private final SessionImpl session;
+     * @param session target session
-    public EventJournalImpl(EventFilter filter,
-                            Journal journal,
-                            String producerId) {
+    public EventJournalImpl(
+            EventFilter filter, Journal journal,
+            String producerId, SessionImpl session) {
-        this.wspName = filter.getSession().getWorkspace().getName();
+        this.session = session;
-                EventBundle bundle = new EventBundle(events,
-                        record.getTimestamp(), record.getUserData(), filter);
+                EventBundle bundle = new EventBundle(
+                        events, record.getTimestamp(), record.getUserData());
-                        if (!wspName.equals(cr.getWorkspace())) {
+                        if (!session.getWorkspace().getName().equals(cr.getWorkspace())) {
-    private static final class EventBundle {
+    private final class EventBundle {
-        private EventBundle(List<EventState> eventStates,
-                            long timestamp,
-                            String userData,
-                            EventFilter filter) {
-            this.events = new FilteredEventIterator(eventStates.iterator(),
-                    timestamp, userData, filter, Collections.EMPTY_SET);
+        private EventBundle(
+                List<EventState> eventStates, long timestamp, String userData) {
+            this.events = new FilteredEventIterator(
+                    session, eventStates.iterator(),
+                    timestamp, userData, filter, Collections.emptySet());
