JCR-2887 : Split PrivilegeRegistry in a per-session manager instance and a repository level registry [work in progress]

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1072154 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.WorkspaceImpl;
-import org.apache.jackrabbit.core.security.authorization.PrivilegeRegistry;
+import org.apache.jackrabbit.core.security.authorization.PrivilegeManager;
-    private PrivilegeRegistry privilegeRegistry;
+    private PrivilegeManager privilegeManager;
-        privilegeRegistry = new PrivilegeRegistry(resolver);
+        privilegeManager = ((WorkspaceImpl) context.getSession().getWorkspace()).getPrivilegeManager();
-                if (privileges.length != 1 || !privileges[0].equals(privilegeRegistry.getPrivilege(Privilege.JCR_READ))) {
+                if (privileges.length != 1 || !privileges[0].equals(privilegeManager.getPrivilege(Privilege.JCR_READ))) {
-            priv = privilegeRegistry.getPrivilege(Privilege.JCR_READ);
+            priv = privilegeManager.getPrivilege(Privilege.JCR_READ);
-            priv = privilegeRegistry.getPrivilege(Privilege.JCR_ALL);
+            priv = privilegeManager.getPrivilege(Privilege.JCR_ALL);
-            priv = privilegeRegistry.getPrivilege(Privilege.JCR_ALL);
+            priv = privilegeManager.getPrivilege(Privilege.JCR_ALL);
-     * @see AbstractAccessControlManager#getPrivilegeRegistry()
+     * @see AbstractAccessControlManager#getPrivilegeManager()
-    protected PrivilegeRegistry getPrivilegeRegistry()
-            throws RepositoryException {
-        checkInitialized();
-        return privilegeRegistry;
+    protected PrivilegeManager getPrivilegeManager() throws RepositoryException {
+        return privilegeManager;
-                return privileges.length == 1 && privileges[0].equals(privilegeRegistry.getPrivilege(Privilege.JCR_READ));
+                return privileges.length == 1 && privileges[0].equals(privilegeManager.getPrivilege(Privilege.JCR_READ));
-                return new Privilege[] {privilegeRegistry.getPrivilege(Privilege.JCR_READ)};
+                return new Privilege[] {privilegeManager.getPrivilege(Privilege.JCR_READ)};
-        return new Privilege[] {privilegeRegistry.getPrivilege(Privilege.JCR_ALL)};
+        return new Privilege[] {privilegeManager.getPrivilege(Privilege.JCR_ALL)};
