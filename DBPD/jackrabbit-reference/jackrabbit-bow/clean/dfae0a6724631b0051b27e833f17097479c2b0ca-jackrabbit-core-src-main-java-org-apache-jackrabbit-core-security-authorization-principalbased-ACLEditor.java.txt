 JCR-1588: JSR 283: Access Control

- minor improvement: replace ace nodes instead of removing the acl altogether.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@790235 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.NodeIterator;
+
-        /*
-         in order to assert that the parent (ac-controlled node) gets
-         modified an existing ACL node is removed first and the recreated.
-         this also asserts that all ACEs are cleared without having to
-         access and removed the explicitely
-        */
-            removeItem(aclNode);
+            // remove all existing aces
+            for (NodeIterator aceNodes = aclNode.getNodes(); aceNodes.hasNext();) {
+                NodeImpl aceNode = (NodeImpl) aceNodes.nextNode();
+                removeItem(aceNode);
+            }
+        } else {
+            /* doesn't exist yet -> create */
+            aclNode = addNode(acNode, N_POLICY, NT_REP_ACL);
-        /* now (re) create it */
-        aclNode = addNode(acNode, N_POLICY, NT_REP_ACL);
-        /* add all entries defined on the template */
+        /* add all new entries defined on the template */
+
+        // mark the parent modified.
+        markModified((NodeImpl) aclNode.getParent());
