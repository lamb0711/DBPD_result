JCR-2887 : Split PrivilegeRegistry in a per-session manager instance and a repository level registry [work in progress]

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1092723 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.security.authorization.PrivilegeBits;
-import javax.jcr.security.Privilege;
-import java.util.HashSet;
-        int allowBits = PrivilegeRegistry.NO_PRIVILEGE;
-        int denyBits = PrivilegeRegistry.NO_PRIVILEGE;
-        int parentAllowBits = PrivilegeRegistry.NO_PRIVILEGE;
-        int parentDenyBits = PrivilegeRegistry.NO_PRIVILEGE;
-
-        Set<Privilege> customAllow = new HashSet<Privilege>();
-        Set<Privilege> customDeny = new HashSet<Privilege>();
+        PrivilegeBits allowBits = PrivilegeBits.getInstance();
+        PrivilegeBits denyBits = PrivilegeBits.getInstance();
+        PrivilegeBits parentAllowBits = PrivilegeBits.getInstance();
+        PrivilegeBits parentDenyBits = PrivilegeBits.getInstance();
-            int entryBits = ace.getPrivilegeBits();
+            PrivilegeBits entryBits = ace.getPrivilegeBits();
-                    parentAllowBits |= Permission.diff(entryBits, parentDenyBits);
+                    parentAllowBits.addDifference(entryBits, parentDenyBits);
-                    parentDenyBits |= Permission.diff(entryBits, parentAllowBits);
+                    parentDenyBits.addDifference(entryBits, parentAllowBits);
-                allowBits |= Permission.diff(entryBits, denyBits);
+                allowBits.addDifference(entryBits, denyBits);
-
-                updatePrivileges(ace.getCustomPrivileges(), customAllow, customDeny);
-                denyBits |= Permission.diff(entryBits, allowBits);
+                denyBits.addDifference(entryBits, allowBits);
-
-                updatePrivileges(ace.getCustomPrivileges(), customDeny, customAllow);
-        return new Result(allows, denies, allowBits, denyBits, customAllow, customDeny);
+        return new Result(allows, denies, allowBits, denyBits);
-                        int entryBits = ace.getPrivilegeBits();
-                        if ((entryBits & Permission.READ) == Permission.READ) {
+                        if (ace.getPrivilegeBits().includesRead()) {
