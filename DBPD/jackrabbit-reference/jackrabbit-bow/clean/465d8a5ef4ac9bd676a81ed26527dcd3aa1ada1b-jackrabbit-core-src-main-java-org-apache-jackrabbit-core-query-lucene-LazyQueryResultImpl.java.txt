JCR-989: Added JackrabbitQuery interface which provides setLimit() and setOffset() and is implemented by QueryImpl.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@563688 13f79535-47bb-0310-9956-ffa450edef68

+     * The offset in the total result set
+     */
+    private final long offset;
+
+    /**
+     * The maximum size of this result if limit > 0
+     */
+    private final long limit;
+
+    /**
+     * @param limit         the maximum result size
+     * @param offset        the offset in the total result set
-                           boolean documentOrder) throws RepositoryException {
+                           boolean documentOrder,
+                           long offset,
+                           long limit) throws RepositoryException {
+        this.offset = offset;
+        this.limit = limit;
-    private void getResults(int size) throws RepositoryException {
+    private void getResults(long size) throws RepositoryException {
-        if (resultNodes.size() >= size) {
+        
+        long maxResultSize = size;
+        
+        // is there any limit?
+        if (limit > 0) {
+            maxResultSize = limit;
+        }
+        
+        if (resultNodes.size() >= maxResultSize) {
-            for (int i = start; i < max && resultNodes.size() < size; i++) {
+            for (int i = start; i < max && resultNodes.size() < maxResultSize; i++) {
-                        resultNodes.add(new ScoreNode(id, result.score(i)));
+                        if (i < offset) {
+                            invalid++;
+                        } else {
+                            resultNodes.add(new ScoreNode(id, result.score(i)));
+                        }
