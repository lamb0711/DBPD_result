assert that versionState used for restore/merge is obtained from the hierarchy belonging to 'this' session.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@515161 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.version.Version;
+    /**
+     * Returns the NodeState of the given Node and asserts that the state is
+     * listed in the hierarchy built by this Session. If the version
+     * was obtained from a different session, the 'corresponding' version
+     * state for this session is retrieved.
+     *
+     * @param node
+     * @return
+     */
+    NodeState getVersionState(Version version) throws RepositoryException {
+        ItemState itemState;
+        if (version.getSession() == this) {
+            itemState = ((NodeImpl) version).getItemState();
+        } else {
+            Path p = getQPath(version.getPath());
+            itemState = getHierarchyManager().getItemState(p);
+        }
+        return (NodeState) itemState;
+    }
