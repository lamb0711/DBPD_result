JCR-193, JCR-216, JCR-203, JCR 184 + various minor fixes

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@293331 13f79535-47bb-0310-9956-ffa450edef68

-
-                        Item item = session.getRepositorySession().getItem(locator.getResourcePath());
+                        Item item = getItem(session, locator);
-                        DavResourceLocator vloc = locator.getFactory().createResourceLocator(locator.getPrefix(), locator.getWorkspacePath(), v.getPath());
+                        DavResourceLocator vloc = locator.getFactory().createResourceLocator(locator.getPrefix(), locator.getWorkspacePath(), v.getPath(), false);
-        Item item = session.getRepositorySession().getItem(locator.getResourcePath());
+        Item item = getItem(session, locator);
-            } else if (ItemResourceConstants.ROOT_ITEM_PATH.equals(locator.getResourcePath())) {
+            } else if (ItemResourceConstants.ROOT_ITEM_PATH.equals(item.getPath())) {
+    private Item getItem(DavSession davSession, DavResourceLocator locator) throws PathNotFoundException, RepositoryException {
+        Session s = davSession.getRepositorySession();
+        return s.getItem(locator.getJcrPath());
+    }
+
