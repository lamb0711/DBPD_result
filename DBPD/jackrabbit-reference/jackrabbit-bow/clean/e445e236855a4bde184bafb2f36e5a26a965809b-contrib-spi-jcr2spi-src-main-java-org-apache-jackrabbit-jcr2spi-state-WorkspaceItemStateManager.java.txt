work in progress

- invalidation of itemstates in case of CacheBehaviour != Observation
- CacheBehaviour.Observation not dependent on Observation-RepositoryDescriptor
- SPI-observation may be implemented even if Observation is not supported according
  jcr-Repository descriptor

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@478211 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.jcr2spi.config.CacheBehaviour;
-    public WorkspaceItemStateManager(WorkspaceManager wspManager, ItemStateFactory isf, IdFactory idFactory) {
+    public WorkspaceItemStateManager(WorkspaceManager wspManager,
+                                     CacheBehaviour cacheBehaviour,
+                                     ItemStateFactory isf, IdFactory idFactory) {
-        EventFilter filter = null;
-        try {
-            // todo for now listen to everything
-            filter = wspManager.createEventFilter(Event.ALL_TYPES, Path.ROOT, true, null, null, false);
-        } catch (UnsupportedRepositoryOperationException e) {
-            // repository does not support observation
+        if (cacheBehaviour == CacheBehaviour.OBSERVATION) {
+            EventFilter filter = null;
+            try {
+                // todo for now listen to everything
+                filter = wspManager.createEventFilter(Event.ALL_TYPES, Path.ROOT, true, null, null, false);
+            } catch (UnsupportedRepositoryOperationException e) {
+                // spi does not support observation
+            }
+            this.eventFilter = (filter == null) ? Collections.EMPTY_LIST : Collections.singletonList(filter);
+        } else {
+            this.eventFilter = Collections.EMPTY_LIST;
-        this.eventFilter = (filter == null) ? Collections.EMPTY_LIST : Collections.singletonList(filter);
-
