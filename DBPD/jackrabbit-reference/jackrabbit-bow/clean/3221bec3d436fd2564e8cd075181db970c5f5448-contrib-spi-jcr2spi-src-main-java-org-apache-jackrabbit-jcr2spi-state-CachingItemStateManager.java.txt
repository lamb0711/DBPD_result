Clean up todos in CachingItemStateManager. Use newly available PathMap.Element.getDescendant() method.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@425002 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.name.MalformedPathException;
-        path2State = new PathMap();            // TODO: must use weak references
+        path2State = new PathMap();      // TODO: must use weak references
-                        // TODO TO-BE-FIXED: put element (marcel, here goes your extra method)
-                        // i removed it, since its not present in JR commons (anchela)
+                        Path.PathElement[] elements = new Path.PathElement[]{
+                            getNameElement((NodeState) parentElement.get(), state)};
+                        Path p = null;
+                        try {
+                            p = new Path.PathBuilder(elements).getPath();
+                        } catch (MalformedPathException e) {
+                            // elements is never empty
+                        }
+                        elem = parentElement.getDescendant(p, false);
-            // TODO TO-BE-FIXED: map element (Marcel, here goes your extra method)
-            // i removed it, since its not present in JR commons (anchela)
-            PathMap.Element tmp = null;
-            if (tmp == null) {
+            PathMap.Element tmp = elem.getDescendant(relPath, true);
+            if (tmp == null || tmp.get() == null) {
-                // TODO TO-BE-FIXED: put element (Marcel, here goes your extra method)
-                // i removed it, since its not present in JR commons (anchela)
-                tmp = null;
+                if (tmp == null) {
+                    tmp = elem.getDescendant(relPath, false);
+                }
-        PathMap.Element elem = null;
+        PathMap.Element elem;
+        } else {
+            // start from root
+            elem = path2State.map(Path.ROOT, false);
-            // TODO TO-BE-FIXED: map element (Marcel, here goes your extra method)
-            // i removed it, since its not present in JR commons (anchela)
-            elem = null;
+            elem = elem.getDescendant(id.getRelativePath(), true);
