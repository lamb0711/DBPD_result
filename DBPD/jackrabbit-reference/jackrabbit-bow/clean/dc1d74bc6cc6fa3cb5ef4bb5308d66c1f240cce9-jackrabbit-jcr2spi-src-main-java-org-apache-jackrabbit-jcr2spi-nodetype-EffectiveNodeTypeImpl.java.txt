JCR-1543: add QNodeTypeDefinition.getSupportedMixins(), use it for JCR2SPI's Node.canAddMixin.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@649548 13f79535-47bb-0310-9956-ffa450edef68

+    // (optional) set of additional mixins supported on node type
+    private Set supportedMixins;
+        supportedMixins = null;
+        Name[] smixins = ntd.getSupportedMixinTypes();
+    
+        if (smixins != null) {
+            ent.supportedMixins = new HashSet();
+            for (int i = 0; i < smixins.length; i++) {
+                ent.supportedMixins.add(smixins[i]);
+            }
+        }
+        
-    /**
-     * Factory method: creates a new 'empty' effective node type instance
-     *
-     * @return a new EffectiveNodeType
-     */
-    static EffectiveNodeType create() {
-        return new EffectiveNodeTypeImpl();
-    }
-
+     * @see EffectiveNodeType#supportsMixin(Name)
+     */
+    public boolean supportsMixin(Name mixin) {
+        if (supportedMixins == null) {
+            return true;
+        }
+        else {
+            return supportedMixins.contains(mixin);
+        }
+    }
+
+    /**
+     * @inheritDoc
+        
+        if (supportedMixins != null) {
+            clone.supportedMixins = new HashSet();
+            clone.supportedMixins.addAll(supportedMixins);
+        }
