
* Review the interface AtomicTypeConverter : rename the method getString into getXPathQueryValue. This method is mainly used by FiterImpl in order to build Xpath query expression based on the object attribute. 
* Solve issue JCR-930 : now dates are not converted in long if UtilDateConverterImpl is used. 

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@544959 13f79535-47bb-0310-9956-ffa450edef68

-        this.session = session;
-		this.mapper = new DigesterMapperImpl(xmlMappingFiles);
-		DefaultAtomicTypeConverterProvider converterProvider = new DefaultAtomicTypeConverterProvider();
-        Map atomicTypeConverters = converterProvider.getAtomicTypeConverters();
-		this.queryManager = new QueryManagerImpl(mapper, atomicTypeConverters);
-        this.requestObjectCache = new RequestObjectCacheImpl();        
-        this.objectConverter = new ObjectConverterImpl(mapper, converterProvider, new ProxyManagerImpl(), requestObjectCache);
+        try 
+        {
+			this.session = session;
+			this.mapper = new DigesterMapperImpl(xmlMappingFiles);
+			DefaultAtomicTypeConverterProvider converterProvider = new DefaultAtomicTypeConverterProvider();
+			Map atomicTypeConverters = converterProvider.getAtomicTypeConverters();
+			this.queryManager = new QueryManagerImpl(mapper, atomicTypeConverters, session.getValueFactory());
+			this.requestObjectCache = new RequestObjectCacheImpl();        
+			this.objectConverter = new ObjectConverterImpl(mapper, converterProvider, new ProxyManagerImpl(), requestObjectCache);
+		} 
+        catch (RepositoryException e) 
+        {
+            throw new org.apache.jackrabbit.ocm.exception.RepositoryException(
+                    "Impossible to instantiate the persistence manager", e);
+
+		}
