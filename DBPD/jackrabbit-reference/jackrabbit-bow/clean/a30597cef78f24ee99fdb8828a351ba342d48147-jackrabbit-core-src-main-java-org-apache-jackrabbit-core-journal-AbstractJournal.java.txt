JCR-884 - DatabaseJournal assigns same revision id to different revisions


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@533019 13f79535-47bb-0310-9956-ffa450edef68

-     * Append a record backed by a file. Subclass responsibility.
+     * Notification method called by an appended record at creation time.
+     * May be overridden by subclasses to save some context information
+     * inside the appended record.
-     * @param producerId producer identifier
+     * @param record record that was appended
+     */
+    protected void appending(AppendRecord record) {
+        // nothing to be done here
+    }
+
+    /**
+     * Append a record backed by a file. On exit, the new revision must have
+     * been set inside the appended record. Subclass responsibility.
+     *
+     * @param record record to append
-     * @return the new record's revision
-    protected abstract long append(String producerId, InputStream in, int length)
+    protected abstract void append(AppendRecord record, InputStream in, int length)
