JCR-2104: JSR 283 Versioning
   - VersionHistory.getAllFrozenNodes()  (move iteratoradaptor from core to jcr-commons), VersionHistory.getVersionableIdentifier()
   - Version.getFrozenNode, Version.getLinearPredecessor()
   - VersionManager (work in progress): 170-methods, shallow merge, checkpoint
      -> extend SPI interfaces accordingly

JCR-2003: JCR2SPI / SPI: Add support for JCR 2.0
   - Session.hasPermission()
   - Node.getProperties/getNodes with glob
   - Node.getIdentifier()

JCR-2004: Update SPI locking to match JCR 2.0
   - separate JCR LockManager from the internal lock manager

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@773828 13f79535-47bb-0310-9956-ffa450edef68

+    private LockManager jcrLockManager;
+    private javax.jcr.version.VersionManager jcrVersionManager;
+
-        session.checkHasPendingChanges();
-
-        NodeState[] versionStates = new NodeState[versions.length];
-        for (int i = 0; i < versions.length; i++) {
-            versionStates[i] = session.getVersionState(versions[i]);
-        }
-        getVersionStateManager().restore(versionStates, removeExisting);
+        getVersionManager().restore(versions, removeExisting);
-        return getLockStateManager();
+        if (jcrLockManager == null) {
+            jcrLockManager = new JcrLockManager(session);
+        }
+        return jcrLockManager;
-    public javax.jcr.version.VersionManager getVersionManager()
+    public synchronized javax.jcr.version.VersionManager getVersionManager()
-        // TODO: implementation missing
-        throw new UnsupportedRepositoryOperationException("JCR-1104");
+        session.checkIsAlive();
+        session.checkSupportedOption(Repository.OPTION_VERSIONING_SUPPORTED);
+        if (jcrVersionManager == null) {
+            jcrVersionManager = new JcrVersionManager(session);
+        }
+        return jcrVersionManager;
-     * @return a new <code>LockManager</code> instance.
+     * @return a new <code>LockStateManager</code> instance.
-        LockManagerImpl lMgr = new LockManagerImpl(wspManager, itemManager, session.getCacheBehaviour(), getPathResolver());
+        LockManagerImpl lMgr = new LockManagerImpl(wspManager, itemManager, session.getCacheBehaviour());
