JCR-2541: spi2dav : EventJournal not implemented

Add Atom Feed based Event Journal implementation.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1213890 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.AccessDeniedException;
+import javax.jcr.Item;
+import javax.jcr.Node;
+import javax.jcr.PathNotFoundException;
+import javax.jcr.RepositoryException;
+import javax.jcr.observation.EventJournal;
+import javax.jcr.version.Version;
+import javax.jcr.version.VersionHistory;
+import javax.servlet.http.HttpServletResponse;
+
+import org.apache.jackrabbit.JcrConstants;
+import org.apache.jackrabbit.util.Text;
-import org.apache.jackrabbit.JcrConstants;
-import javax.jcr.Item;
-import javax.jcr.Node;
-import javax.jcr.PathNotFoundException;
-import javax.jcr.RepositoryException;
-import javax.jcr.version.Version;
-import javax.jcr.version.VersionHistory;
-
+        String type = request.getParameter("type");
+
+        } else if ("journal".equals(type) && locator.getResourcePath().equals(locator.getWorkspacePath())) {
+            // feed/event journal resource
+            try {
+                EventJournal ej = session.getRepositorySession().getWorkspace().getObservationManager()
+                        .getEventJournal();
+                if (ej == null) {
+                    throw new DavException(HttpServletResponse.SC_NOT_IMPLEMENTED, "event journal not supported");
+                }
+                resource = new EventJournalResourceImpl(ej, locator, session, request, this);
+            } catch (AccessDeniedException ex) {
+                // EventJournal only allowed for admin?
+                throw new DavException(HttpServletResponse.SC_UNAUTHORIZED, ex);
+            } catch (RepositoryException ex) {
+                throw new DavException(HttpServletResponse.SC_BAD_REQUEST, ex);
+            }
