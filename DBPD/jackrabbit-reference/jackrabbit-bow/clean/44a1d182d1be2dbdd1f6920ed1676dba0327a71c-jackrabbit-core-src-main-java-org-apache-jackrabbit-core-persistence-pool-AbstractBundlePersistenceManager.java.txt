JCR-2699: Improve read/write concurrency

Refactor the LRU cache handling from MLRUItemStateCache and BundleCache to a new LRUCache class. Add a test case for the cache.

Switch from LinkedHashMap to ConcurrentHashMap with explicitly managed LRU linked list to reduce the size of the synchronized blocks.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1003542 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.cache.LRUCache;
-import org.apache.jackrabbit.core.persistence.util.BundleCache;
- * {@link BundleCache} that caches already loaded bundles. The other is the
+ * bundle cache that caches already loaded bundles. The other is the
-    private BundleCache bundles;
+    private LRUCache<NodeId, NodePropBundle> bundles;
-        bundles = new BundleCache(bundleCacheSize);
+        bundles = new LRUCache<NodeId, NodePropBundle>(bundleCacheSize);
-                    bundles.put(bundle);
+                    bundles.put(id, bundle, bundle.getSize());
-        if (bundles.contains(bundle.getId())) {
-            bundles.put(bundle);
+        if (bundles.containsKey(bundle.getId())) {
+            bundles.remove(bundle.getId());
+            bundles.put(bundle.getId(), bundle, bundle.getSize());
