Changed query handler to remove a possible write.lock on startup.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@154158 13f79535-47bb-0310-9956-ffa450edef68

+    /** Name of the write lock file */
+    private static final String WRITE_LOCK = "write.lock";
+
-        boolean create;
-            create = !getFileSystem().exists("segments");
+            // check if index is locked, probably from an unclean repository
+            // shutdown
+            if (getFileSystem().exists(WRITE_LOCK)) {
+                log.warn("Removing write lock on search index.");
+                try {
+                    getFileSystem().deleteFile(WRITE_LOCK);
+                } catch (FileSystemException e) {
+                    log.error("Unable to remove write lock on search index.");
+                }
+            }
+
+            boolean create = !getFileSystem().exists("segments");
