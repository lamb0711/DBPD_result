JCR-3761 : TokenInfo#resetExpiration always fails with ConstraintViolationException

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1582373 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.Value;
-                setProperty(tokenNode, session.getQName(TOKEN_ATTRIBUTE_EXPIRY), vf.createValue(createExpirationValue(creationTime)));
+                setProperty(tokenNode, session.getQName(TOKEN_ATTRIBUTE_EXPIRY), createExpirationValue(creationTime, session));
-    private Calendar createExpirationValue(long creationTime) {
+    private Value createExpirationValue(long creationTime, Session session) throws RepositoryException {
-        return cal;
+        return session.getValueFactory().createValue(cal);
-                    s.getNode(tokenPath).setProperty(TOKEN_ATTRIBUTE_EXPIRY, createExpirationValue(loginTime));
+                    setProperty((NodeImpl) s.getNode(tokenPath), session.getQName(TOKEN_ATTRIBUTE_EXPIRY), createExpirationValue(loginTime, session));
