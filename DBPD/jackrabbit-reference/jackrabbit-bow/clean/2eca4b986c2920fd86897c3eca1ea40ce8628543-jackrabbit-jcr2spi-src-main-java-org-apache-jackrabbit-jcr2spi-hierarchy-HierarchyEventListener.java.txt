JCR-1799 updating events swallowed (CacheBehavior.OBSERVATION)   	
JCR-1783 incomplete changelog when combining move with removal of new destination parent

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@704361 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.PathNotFoundException;
-                NodeEntry parent = (ev.getParentId() != null) ? (NodeEntry) hierarchyMgr.lookup(ev.getParentId()) : null;
-                if (parent != null) {
-                    parent.refresh(ev);
+                NodeId parentId = ev.getParentId();
+                HierarchyEntry parent = null;
+                if (parentId != null) {
+                    parent = hierarchyMgr.lookup(parentId);
+                    if (parent == null && ev.getPath() != null && parentId.getUniqueID() != null) {
+                        // parentID contains a uniqueID part -> try to lookup
+                        // the parent by path.
+                        try {
+                            Path parentPath = ev.getPath().getAncestor(1);
+                            parent = hierarchyMgr.lookup(parentPath);
+                        } catch (PathNotFoundException e) {
+                            // should not occur
+                            log.debug(e.getMessage());
+                        }
+                    }
+                }
+                if (parent != null && parent.denotesNode()) {
+                    ((NodeEntry) parent).refresh(ev);
