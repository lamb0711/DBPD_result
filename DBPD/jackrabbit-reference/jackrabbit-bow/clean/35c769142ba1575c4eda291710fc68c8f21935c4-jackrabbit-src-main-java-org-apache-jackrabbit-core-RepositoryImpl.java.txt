JCR-331: RepositoryConfig instance can not be reused once it has been passed to RepositoryImpl constructor

committing patch

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@386078 13f79535-47bb-0310-9956-ffa450edef68

-     * the name of the filesystem resource containing the properties of the
+     * the name of the file system resource containing the properties of the
-    // the master filesystem
+    // the virtual repository file system
-        repStore = repConfig.getFileSystem();
+        repStore = repConfig.getFileSystemConfig().createFileSystem();
+        FileSystem fs = vConfig.getFileSystemConfig().createFileSystem();
-                vConfig.getFileSystem(),
+                fs,
-        return new VersionManagerImpl(pm, ntReg, delegatingDispatcher,
+        return new VersionManagerImpl(pm, fs, ntReg, delegatingDispatcher,
-            log.error("error while closing repository filesystem", e);
-        }
-
-        try {
-            // close versioning file system
-            repConfig.getVersioningConfig().getFileSystem().close();
-        } catch (FileSystemException e) {
-            log.error("error while closing versioning filesystem", e);
+            log.error("error while closing repository file system", e);
+     * Returns the repository file system.
+     * @return repository file system
+     */
+    protected FileSystem getFileSystem() {
+        return repStore;
+    }
+
+    /**
-            fsConfig.init();
-            fs = fsConfig.getFileSystem();
+            fs = fsConfig.createFileSystem();
-            FileSystemConfig fsConfig = config.getFileSystemConfig();
-            fsConfig.dispose();
+            try {
+                fs.close();
+            } catch (FileSystemException fse) {
+                log.error("error while closing file system of workspace "
+                        + config.getName(), fse);
+            }
