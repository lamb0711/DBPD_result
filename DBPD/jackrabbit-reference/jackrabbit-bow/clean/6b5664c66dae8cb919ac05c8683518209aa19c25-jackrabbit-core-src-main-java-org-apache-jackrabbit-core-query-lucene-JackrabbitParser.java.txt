JCR-2817: Upgrade to Tika 0.8

Also fix the backwards-compatibility settings for MsPowerPoint*Text*Extractor as discussed on users@.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1038124 13f79535-47bb-0310-9956-ffa450edef68

-            try {
-                parser = new AutoDetectParser(new TikaConfig(stream));
-            } finally {
-                stream.close();
+            if (stream != null) {
+                try {
+                    parser = new AutoDetectParser(new TikaConfig(stream));
+                } finally {
+                    stream.close();
+                }
+            } else {
+                parser = new AutoDetectParser();
-        Map<String, Parser> parsers = new HashMap<String, Parser>();
+        Map<MediaType, Parser> parsers = new HashMap<MediaType, Parser>();
-                parsers.put("text/html", new HtmlParser());
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.MsExcelTextExtractor")) {
+                parsers.put(MediaType.text("html"), new HtmlParser());
+            } else if (name.equals("org.apache.jackrabbit.extractor.MsExcelTextExtractor")) {
-                parsers.put("application/vnd.ms-excel", parser);
-                parsers.put("application/msexcel", parser);
-                parsers.put("application/excel", parser);
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.MsOutlookTextExtractor")) {
-                parsers.put("application/vnd.ms-outlook", new OfficeParser());
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.MsPowerPointExtractor")) {
+                parsers.put(MediaType.application("vnd.ms-excel"), parser);
+                parsers.put(MediaType.application("msexcel"), parser);
+                parsers.put(MediaType.application("excel"), parser);
+            } else if (name.equals("org.apache.jackrabbit.extractor.MsOutlookTextExtractor")) {
+                parsers.put(MediaType.application("vnd.ms-outlook"), new OfficeParser());
+            } else if (name.equals("org.apache.jackrabbit.extractor.MsPowerPointExtractor")
+                    || name.equals("org.apache.jackrabbit.extractor.MsPowerPointTextExtractor")) {
-                parsers.put("application/vnd.ms-powerpoint", parser);
-                parsers.put("application/mspowerpoint", parser);
-                parsers.put("application/powerpoint", parser);
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.MsWordTextExtractor")) {
+                parsers.put(MediaType.application("vnd.ms-powerpoint"), parser);
+                parsers.put(MediaType.application("mspowerpoint"), parser);
+                parsers.put(MediaType.application("powerpoint"), parser);
+            } else if (name.equals("org.apache.jackrabbit.extractor.MsWordTextExtractor")) {
-                parsers.put("application/vnd.ms-word", parser);
-                parsers.put("application/msword", parser);
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.MsTextExtractor")) {
+                parsers.put(MediaType.application("vnd.ms-word"), parser);
+                parsers.put(MediaType.application("msword"), parser);
+            } else if (name.equals("org.apache.jackrabbit.extractor.MsTextExtractor")) {
-                parsers.put("application/vnd.ms-word", parser); 
-                parsers.put("application/msword", parser);
-                parsers.put("application/vnd.ms-powerpoint", parser);
-                parsers.put("application/mspowerpoint", parser);
-                parsers.put("application/vnd.ms-excel", parser);
-                parsers.put("application/vnd.openxmlformats-officedocument.wordprocessingml.document", parser);
-                parsers.put("application/vnd.openxmlformats-officedocument.presentationml.presentation", parser);
-                parsers.put("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", parser);
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.OpenOfficeTextExtractor")) {
+                parsers.put(MediaType.application("vnd.ms-word"), parser); 
+                parsers.put(MediaType.application("msword"), parser);
+                parsers.put(MediaType.application("vnd.ms-powerpoint"), parser);
+                parsers.put(MediaType.application("mspowerpoint"), parser);
+                parsers.put(MediaType.application("vnd.ms-excel"), parser);
+                parsers.put(MediaType.application("vnd.openxmlformats-officedocument.wordprocessingml.document"), parser);
+                parsers.put(MediaType.application("vnd.openxmlformats-officedocument.presentationml.presentation"), parser);
+                parsers.put(MediaType.application("vnd.openxmlformats-officedocument.spreadsheetml.sheet"), parser);
+            } else if (name.equals("org.apache.jackrabbit.extractor.OpenOfficeTextExtractor")) {
-                parsers.put("application/vnd.oasis.opendocument.database", parser);
-                parsers.put("application/vnd.oasis.opendocument.formula", parser);
-                parsers.put("application/vnd.oasis.opendocument.graphics", parser);
-                parsers.put("application/vnd.oasis.opendocument.presentation", parser);
-                parsers.put("application/vnd.oasis.opendocument.spreadsheet", parser);
-                parsers.put("application/vnd.oasis.opendocument.text", parser);
-                parsers.put("application/vnd.sun.xml.calc", parser);
-                parsers.put("application/vnd.sun.xml.draw", parser);
-                parsers.put("application/vnd.sun.xml.impress", parser);
-                parsers.put("application/vnd.sun.xml.writer", parser);
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.PdfTextExtractor")) {
-                parsers.put("application/pdf", new PDFParser());
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.PlainTextExtractor")) {
-                parsers.put("text/plain", new TXTParser());
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.PngTextExtractor")) {
+                parsers.put(MediaType.application("vnd.oasis.opendocument.database"), parser);
+                parsers.put(MediaType.application("vnd.oasis.opendocument.formula"), parser);
+                parsers.put(MediaType.application("vnd.oasis.opendocument.graphics"), parser);
+                parsers.put(MediaType.application("vnd.oasis.opendocument.presentation"), parser);
+                parsers.put(MediaType.application("vnd.oasis.opendocument.spreadsheet"), parser);
+                parsers.put(MediaType.application("vnd.oasis.opendocument.text"), parser);
+                parsers.put(MediaType.application("vnd.sun.xml.calc"), parser);
+                parsers.put(MediaType.application("vnd.sun.xml.draw"), parser);
+                parsers.put(MediaType.application("vnd.sun.xml.impress"), parser);
+                parsers.put(MediaType.application("vnd.sun.xml.writer"), parser);
+            } else if (name.equals("org.apache.jackrabbit.extractor.PdfTextExtractor")) {
+                parsers.put(MediaType.application("pdf"), new PDFParser());
+            } else if (name.equals("org.apache.jackrabbit.extractor.PlainTextExtractor")) {
+                parsers.put(MediaType.TEXT_PLAIN, new TXTParser());
+            } else if (name.equals("org.apache.jackrabbit.extractor.PngTextExtractor")) {
-                parsers.put("image/png", parser);
-                parsers.put("image/apng", parser);
-                parsers.put("image/mng", parser);
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.RTFTextExtractor")) {
+                parsers.put(MediaType.image("png"), parser);
+                parsers.put(MediaType.image("apng"), parser);
+                parsers.put(MediaType.image("mng"), parser);
+            } else if (name.equals("org.apache.jackrabbit.extractor.RTFTextExtractor")) {
-                parsers.put("application/rtf", parser);
-                parsers.put("text/rtf", parser);
-            } else if (name.equals(
-                    "org.apache.jackrabbit.extractor.XMLTextExtractor")) {
+                parsers.put(MediaType.application("rtf"), parser);
+                parsers.put(MediaType.text("rtf"), parser);
+            } else if (name.equals("org.apache.jackrabbit.extractor.XMLTextExtractor")) {
-                parsers.put("application/xml", parser);
-                parsers.put("text/xml", parser);
+                parsers.put(MediaType.APPLICATION_XML, parser);
+                parsers.put(MediaType.text("xml"), parser);
