JCR-3072: System session should be able to impersonate other users

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1170506 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.security.SystemPrincipal;
-        boolean allows;
-        allows = impersonators.removeAll(principalNames);
-
-        if (!allows) {
-            // check if subject belongs to administrator user
+        if (impersonators.removeAll(principalNames)) {
+            return true;
+        } else {
+            // check if subject belongs to an administrator or the system
-                if (p instanceof Group) {
-                    continue;
-                }
-                Authorizable a = userManager.getAuthorizable(p);
-                if (a != null && userManager.isAdminId(a.getID())) {
-                    allows = true;
-                    break;
+                if (p instanceof SystemPrincipal) { 
+                    return true;
+                } else if (!(p instanceof Group)) {
+                    Authorizable a = userManager.getAuthorizable(p);
+                    if (a != null && userManager.isAdminId(a.getID())) {
+                        return true;
+                    }
-        return allows;
+        return false;
