JCR-2995 : create ChangePolling thread on demand


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1136827 13f79535-47bb-0310-9956-ffa450edef68

+
+    private final boolean observationSupported;
+    private final int pollTimeout;
+     * It is also <code>null</code> if {@link CacheBehaviour#INVALIDATE} is
+     * configured and no event listeners have been registered.
-    private final Thread changeFeed;
+    private Thread changeFeed;
-                            boolean enableObservation)
+                            boolean observationSupported)
+        this.observationSupported = observationSupported;
+        this.pollTimeout = pollTimeout;
+
-        changeFeed = createChangeFeed(pollTimeout, enableObservation);
-    public void addEventListener(InternalEventListener listener)
-            throws RepositoryException {
+    public void addEventListener(InternalEventListener listener) throws RepositoryException {
+        if (changeFeed == null) {
+            changeFeed = createChangeFeed(pollTimeout, observationSupported);
+        }
+
