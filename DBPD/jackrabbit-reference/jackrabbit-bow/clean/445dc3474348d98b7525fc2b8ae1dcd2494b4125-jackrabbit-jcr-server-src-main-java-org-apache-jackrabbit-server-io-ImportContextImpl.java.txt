JCR-1188 WebDAV: Allow for Extensions of MimeResolver in the Configuration.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@588236 13f79535-47bb-0310-9956-ffa450edef68

+    private final MimeResolver mimeResolver;
+     * @param systemId
-        this(importRoot, systemId, (inputCtx != null) ? inputCtx.getInputStream() : null, null);
+        this(importRoot, systemId, inputCtx, null);
+    }
+
+    /**
+     * Creates a new item import context with the given root item and the
+     * specified <code>InputContext</code>. If the input context provides an
+     * input stream, the stream is written to a temporary file in order to avoid
+     * problems with multiple IOHandlers that try to run the import but fail.
+     * The temporary file is deleted as soon as this context is informed that
+     * the import has been completed and it will not be used any more.
+     *
+     * @param importRoot the import root node
+     * @param systemId
+     * @param inputCtx wrapped by this <code>ImportContext</code>
+     * @param mimeResolver
+     */
+    public ImportContextImpl(Item importRoot, String systemId, InputContext inputCtx,
+                             MimeResolver mimeResolver) throws IOException {
+        this(importRoot, systemId, (inputCtx != null) ? inputCtx.getInputStream() : null, null, mimeResolver);
-    public ImportContextImpl(Item importRoot, String systemId, InputStream in, IOListener ioListener) throws IOException {
+    public ImportContextImpl(Item importRoot, String systemId, InputStream in,
+                             IOListener ioListener) throws IOException {
+        this(importRoot, systemId, in, ioListener, null);
+    }
+
+    /**
+     * Creates a new item import context. The specified InputStream is written
+     * to a temporary file in order to avoid problems with multiple IOHandlers
+     * that try to run the import but fail. The temporary file is deleted as soon
+     * as this context is informed that the import has been completed and it
+     * will not be used any more.
+     *
+     * @param importRoot
+     * @param systemId
+     * @param in
+     * @param ioListener
+     * @param mimeResolver
+     * @throws IOException
+     * @see ImportContext#informCompleted(boolean)
+     */
+    public ImportContextImpl(Item importRoot, String systemId, InputStream in,
+                             IOListener ioListener, MimeResolver mimeResolver)
+            throws IOException {
+        this.mimeResolver = (mimeResolver == null) ? IOUtil.MIME_RESOLVER : mimeResolver;
+     * @see ImportContext#getImportRoot()
+     */
+    public MimeResolver getMimeResolver() {
+        return mimeResolver;
+    }
+
+    /**
-            mimeType = IOUtil.MIME_RESOLVER.getMimeType(getSystemId());
+            mimeType = mimeResolver.getMimeType(getSystemId());
