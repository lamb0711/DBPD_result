JCR-2845   	 NodeBasedGroup#isMember(Principal) should have shortcut for the everyone group.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1049491 13f79535-47bb-0310-9956-ffa450edef68

-
+    /**
+     * Principal Implementation
+     */
-            Collection<Principal> members = getMembers();
-            if (members.contains(member)) {
-                // shortcut.
-                return true;
-            }
-
-            // test if member of a member-group
-            for (Principal p : members) {
-                if (p instanceof java.security.acl.Group &&
-                        ((java.security.acl.Group) p).isMember(member)) {
-                    return true;
+            // shortcut for everyone group -> avoid collecting all members
+            // as all users and groups are member of everyone.
+            try {
+                if (isEveryone()) {
+                    return !getPrincipal().equals(member);
+            } catch (RepositoryException e) {
+                // continue using regular membership evaluation
-            return false;
+           
+            Collection<Principal> members = getMembers();
+            return members.contains(member);
