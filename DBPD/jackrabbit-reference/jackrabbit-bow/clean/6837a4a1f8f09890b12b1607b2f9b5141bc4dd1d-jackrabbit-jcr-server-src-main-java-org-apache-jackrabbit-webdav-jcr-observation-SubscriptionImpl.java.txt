Add PollTimeout header (required for spi2dav)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@506924 13f79535-47bb-0310-9956-ffa450edef68

+     * @param timeout time in milliseconds to wait at most for events if none
+     *                are present currently.
-    synchronized EventDiscovery discoverEvents() {
+    synchronized EventDiscovery discoverEvents(long timeout) {
+        if (eventBundles.isEmpty() && timeout > 0) {
+            try {
+                wait(timeout);
+            } catch (InterruptedException e) {
+                // continue and possibly return empty event discovery
+            }
+        }
-     * available with the next {@link #discoverEvents()} request. If this
+     * available with the next {@link #discoverEvents(long)} request. If this
-     * @see #discoverEvents()
+     * @see #discoverEvents(long)
+        notifyAll();
-     * @see SubscriptionImpl#discoverEvents()
+     * @see SubscriptionImpl#discoverEvents(long)
-            eventBundles.add(new EventBundleImpl(events, tId));
+            synchronized (SubscriptionImpl.this) {
+                eventBundles.add(new EventBundleImpl(events, tId));
+                SubscriptionImpl.this.notifyAll();
+            }
