JCR-257: Use separate index for jcr:system tree
- use common namespace mapping if there is a system index
- Added some test cases

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@388559 13f79535-47bb-0310-9956-ffa450edef68

+     * Name of the file to persist search internal namespace mappings
+     */
+    private static final String NS_MAPPING_FILE = "ns_mappings.properties";
+
+    /**
-        index = new MultiIndex(new File(path), this,
-                context.getItemStateManager(), context.getRootId(), excludedIDs);
+        File indexDir = new File(path);
+
+        NamespaceMappings nsMappings;
+        if (context.getParentHandler() instanceof SearchIndex) {
+            // use system namespace mappings
+            SearchIndex sysIndex = (SearchIndex) context.getParentHandler();
+            nsMappings = sysIndex.getNamespaceMappings();
+        } else {
+            // read local namespace mappings
+            File mapFile = new File(indexDir, NS_MAPPING_FILE);
+             nsMappings = new NamespaceMappings(mapFile);
+        }
+
+        index = new MultiIndex(indexDir, this, context.getItemStateManager(),
+                context.getRootId(), excludedIDs, nsMappings);
