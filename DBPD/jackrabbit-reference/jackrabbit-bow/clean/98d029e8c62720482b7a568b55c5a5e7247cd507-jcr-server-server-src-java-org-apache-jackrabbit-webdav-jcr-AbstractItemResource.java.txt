AbstractItemResource:
add DAV:current-user-privilege set.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@397831 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.security.CurrentUserPrivilegeSetProperty;
+import org.apache.jackrabbit.webdav.security.Privilege;
+import java.security.AccessControlException;
+import java.util.ArrayList;
+import java.util.List;
+
+        // TODO complete set of properties defined by RFC 3744
+        Privilege[] allPrivs = new Privilege[] {PRIVILEGE_JCR_READ,
+                                                PRIVILEGE_JCR_ADD_NODE,
+                                                PRIVILEGE_JCR_SET_PROPERTY,
+                                                PRIVILEGE_JCR_REMOVE};
+        // Add list of privileges granted to the current user. Note, that for
+        // this property it is not required that the item already exists.
+        List currentPrivs = new ArrayList();
+        for (int i = 0; i < allPrivs.length; i++) {
+            try {
+                getRepositorySession().checkPermission(getLocator().getRepositoryPath(), allPrivs[i].getName());
+                currentPrivs.add(allPrivs[i]);
+            } catch (AccessControlException e) {
+                // ignore
+                log.debug(e.toString());
+            } catch (RepositoryException e) {
+                // ignore
+                log.debug(e.toString());
+            }
+        }
+        properties.add(new CurrentUserPrivilegeSetProperty((Privilege[])currentPrivs.toArray(new Privilege[currentPrivs.size()])));
