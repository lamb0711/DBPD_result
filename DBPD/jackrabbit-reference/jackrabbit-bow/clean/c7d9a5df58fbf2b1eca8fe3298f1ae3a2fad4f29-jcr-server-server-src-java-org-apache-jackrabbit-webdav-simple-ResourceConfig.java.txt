a) JCR-407: read IOHandlers from the config.xml
b) Add static DocumentBuilderFactory constant to DomUtil 
   and replace existing constants present in various places.




git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@396565 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.server.io.DefaultIOManager;
-import org.apache.jackrabbit.webdav.xml.DomUtil;
+import org.apache.jackrabbit.server.io.DefaultIOManager;
+import org.apache.jackrabbit.server.io.IOHandler;
+import org.apache.jackrabbit.webdav.xml.DomUtil;
-import org.w3c.dom.Document;
+import org.w3c.dom.Document;
-import javax.xml.parsers.DocumentBuilderFactory;
+import java.net.URL;
+import java.util.List;
+import java.util.ArrayList;
-import java.net.URL;
-import java.util.ArrayList;
-import java.util.List;
-     * &lt;!ELEMENT iomanager (class) &gt;
+     * &lt;!ELEMENT iomanager (class, iohandler*) &gt;
+     * &lt;!ELEMENT iohandler (class) &gt;
-        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
-        factory.setNamespaceAware(true);
-            DocumentBuilder builder = factory.newDocumentBuilder();
+            DocumentBuilder builder = DomUtil.BUILDER_FACTORY.newDocumentBuilder();
+                    // get optional 'iohandler' child elements and populate the
+                    // ioManager with the instances
+                    ElementIterator iohElements = DomUtil.getChildren(el, "iohandler", null);
+                    while (iohElements.hasNext()) {
+                        Element iohEl = iohElements.nextElement();
+                        inst = buildClassFromConfig(iohEl);
+                        if (inst != null && inst instanceof IOHandler) {
+                            this.ioManager.addIOHandler((IOHandler) inst);
+                        } else {
+                            log.error("Resource configuration: the handler is not a valid IOHandler.");
+                        }
+                    }
+                } else {
+                    log.error("Resource configuration: 'iomanager' does not define a valid IOManager.");
