JCR-890: concurrent read-only access to a session

Introduce an initial SessionState concept for separating the session internals from SessionImpl.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@956879 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.session.ActiveSessionState;
+import org.apache.jackrabbit.core.session.ClosedSessionState;
+import org.apache.jackrabbit.core.session.SessionState;
-     * flag indicating whether this session is alive
+     * The state of this session.
-    protected boolean alive;
+    protected volatile SessionState state = new ActiveSessionState();
-        alive = true;
-        // check session status
-        if (!alive) {
-            throw new RepositoryException("this session has been closed");
-        }
+        state.checkAlive();
-        return alive;
+        return state.isAlive();
-        if (!alive) {
+        if (!isLive()) {
-        alive = false;
+        state = new ClosedSessionState();
-        if (!alive) {
+        if (!isLive()) {
-        if (alive) {
+        if (isLive()) {
