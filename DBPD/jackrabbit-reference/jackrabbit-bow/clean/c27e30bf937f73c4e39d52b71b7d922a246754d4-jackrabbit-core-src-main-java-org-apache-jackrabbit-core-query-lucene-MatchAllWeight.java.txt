JCR-791: Improve performance of MatchAllScorer

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@518979 13f79535-47bb-0310-9956-ffa450edef68

-        return new MatchAllScorer(reader, field);
+        if (reader instanceof MultiIndexReader) {
+            MultiIndexReader mir = (MultiIndexReader) reader;
+            IndexReader readers[] = mir.getIndexReaders();
+            int starts[] = new int[readers.length + 1];
+            int maxDoc = 0;
+            for (int i = 0; i < readers.length; i++) {
+                starts[i] = maxDoc;
+                maxDoc += readers[i].maxDoc();
+            }
+
+            starts[readers.length] = maxDoc;
+            Scorer scorers[] = new Scorer[readers.length];
+            for (int i = 0; i < readers.length; i++)
+                scorers[i] = scorer(readers[i]);
+
+            return new MultiScorer(searcher.getSimilarity(), scorers, starts);
+        } else {
+            return new MatchAllScorer(reader, field);
+        }
