JCR-3443: Normalize String properties when ordering query results

Patch by CÃ©dric Damioli

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1436914 13f79535-47bb-0310-9956-ffa450edef68

+     * Name for 'rep:normalize'
+     */
+    static final Name REP_NORMALIZE = NAME_FACTORY.create(Name.NS_REP_URI, "normalize");
+
+    /**
-                    exceptions.add(new InvalidQueryException("Unsupported location for fn:upper-case()"));
+                    exceptions.add(new InvalidQueryException("Wrong number of argument for fn:upper-case()"));
+                }
+            } else if (REP_NORMALIZE.equals(funName)) {
+                if (node.jjtGetNumChildren() == 2) {
+                    if (queryNode.getType() == QueryNode.TYPE_ORDER) {
+                        ((OrderQueryNode) queryNode).setFunction(REP_NORMALIZE.getLocalName());
+                        node.childrenAccept(this, queryNode);
+                    } else {
+                        exceptions.add(new InvalidQueryException("Unsupported location for rep:normalize()"));
+                    }
+                } else {
+                    exceptions.add(new InvalidQueryException("Wrong number of argument for rep:normalize()"));
