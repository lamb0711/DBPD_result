JCR-1469 Data store garbage collection: ScanEventListener not working

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@636774 13f79535-47bb-0310-9956-ffa450edef68

+    private boolean persistenceManagerScan;
+
+        this.persistenceManagerScan = list != null;
-        if (pmList == null) {
+        if (pmList == null || !persistenceManagerScan) {
+    /**
+     * Enable or disable using the IterablePersistenceManager interface
+     * to scan the items. This is important for clients that need
+     * the complete Node implementation in the ScanEventListener
+     * callback.
+     *
+     * @param allow true if using the IterablePersistenceManager interface is allowed
+     */
+    public void setPersistenceManagerScan(boolean allow) {
+        persistenceManagerScan = allow;
+    }
+
+    /**
+     * Check if using the IterablePersistenceManager interface is allowed.
+     *
+     * @return true if using IterablePersistenceManager is possible.
+     */
+    public boolean getPersistenceManagerScan() {
+        return persistenceManagerScan;
+    }
+
+                if (callback != null) {
+                    callback.beforeScanning(null);
+                }
+                if (callback != null) {
+                    callback.afterScanning(null);
+                }
