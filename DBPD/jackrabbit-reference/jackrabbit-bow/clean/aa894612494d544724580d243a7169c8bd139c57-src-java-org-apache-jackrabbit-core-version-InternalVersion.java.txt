- adapted versioning again to spec 0.15
- added VirtualItemStateManager for reflecting virtual content


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@55615 13f79535-47bb-0310-9956-ffa450edef68

-public final class InternalVersion {
+public final class InternalVersion extends InternalFreeze {
+     * the id of this version
+     */
+    private String versionId;
+
+    /**
+     * specifies if this is the root version
+     */
+    private final boolean isRoot;
+
+    /**
+        super(null);
+
+        // check name
+        isRoot = node.getName().equals(VersionManager.NODENAME_ROOTVERSION);
+
+        // get id
+        versionId = (String) node.getPropertyValue(PersistentVersionManager.PROPNAME_VERSION_ID).internalValue();
+
-        PersistentNode pNode = node.getNode(VersionManager.NODENAME_FROZEN, 1);
-        frozen = pNode == null ? null : new InternalFrozenNode(pNode);
+        PersistentNode pNode = node.getNode(PersistentVersionManager.NODENAME_FROZEN, 1);
+        frozen = pNode == null ? null : new InternalFrozenNode(this, pNode);
-    public String getUUID() {
-        return node.getUUID();
+    public String getId() {
+        return versionId;
+     * returns the version manager
+     * @return
+     */
+    public PersistentVersionManager getVersionManager() {
+        return versionHistory.getVersionManager();
+    }
+
+    /**
-            values[i] = InternalValue.create(new UUID(((InternalVersion) predecessors.get(i)).getUUID()));
+            values[i] = InternalValue.create(new UUID(((InternalVersion) predecessors.get(i)).getId()));
-        node.setPropertyValues(VersionManager.PROPNAME_PREDECESSORS, PropertyType.REFERENCE, values);
+        node.setPropertyValues(VersionManager.PROPNAME_PREDECESSORS, PropertyType.STRING, values);
+    /**
+     * checks if this is the root version.
+     * @return <code>true</code> if this version is the root version;
+     *         <code>false</code> otherwise.
+     */
+    public boolean isRootVersion() {
+        return isRoot;
+    }
