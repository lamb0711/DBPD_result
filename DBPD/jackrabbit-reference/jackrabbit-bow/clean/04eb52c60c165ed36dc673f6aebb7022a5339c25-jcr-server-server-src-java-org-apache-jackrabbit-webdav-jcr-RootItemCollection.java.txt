JCR-405: PROPPATCH doesn't respect document order
minor improvements within 'jcr' package:
- reorder nodes
- fixing creation/replacement of multivalued JCR properties
- contentlength for single value JCR properties
- improve spooling of resource content

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@397835 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.webdav.property.DavPropertyNameSet;
-import org.apache.jackrabbit.webdav.property.DavPropertySet;
+import java.util.List;
-    public MultiStatusResponse alterProperties(DavPropertySet setProperties, DavPropertyNameSet removePropertyNames) throws DavException {
+    public MultiStatusResponse alterProperties(List changeList) throws DavException {
-        if (setProperties.contains(JCR_NAMESPACES)) {
-            setProperty(setProperties.remove(JCR_NAMESPACES));
+        DavProperty namespaceProp = null;
+        Iterator it = changeList.iterator();
+        while (it.hasNext()) {
+            Object propEntry = it.next();
+            if (propEntry instanceof DavProperty && JCR_NAMESPACES.equals(((DavProperty)propEntry).getName())) {
+                namespaceProp = (DavProperty) propEntry;
+                break;
+            }
+        }
+        if (namespaceProp != null) {
+            setProperty(namespaceProp);
+            changeList.remove(namespaceProp);
-        return super.alterProperties(setProperties, removePropertyNames);
+        return super.alterProperties(changeList);
