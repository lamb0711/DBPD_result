create deeper path for version history

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@53957 13f79535-47bb-0310-9956-ffa450edef68

-        // check if history already exists
-        QName historyNodeName = new QName(NamespaceRegistryImpl.NS_DEFAULT_URI, node.getUUID());
-        if (historyRoot.hasNode(historyNodeName)) {
-            historyRoot.removeNode(historyNodeName);
+        // create deep path
+        String uuid = node.getUUID();
+        PersistentNode parent = historyRoot;
+        QName historyNodeName = new QName(NamespaceRegistryImpl.NS_DEFAULT_URI, uuid.substring(0, 2));
+        if (!parent.hasNode(historyNodeName)) {
+            parent = parent.addNode(historyNodeName, NodeTypeRegistry.NT_UNSTRUCTURED);
+        } else {
+            parent = parent.getNode(historyNodeName, 1);
+        }
+        historyNodeName = new QName(NamespaceRegistryImpl.NS_DEFAULT_URI, uuid.substring(2, 4));
+        if (!parent.hasNode(historyNodeName)) {
+            parent = parent.addNode(historyNodeName, NodeTypeRegistry.NT_UNSTRUCTURED);
+        } else {
+            parent = parent.getNode(historyNodeName, 1);
+        historyNodeName = new QName(NamespaceRegistryImpl.NS_DEFAULT_URI, uuid.substring(4));
+        if (parent.hasNode(historyNodeName)) {
+            parent.removeNode(historyNodeName);
+        }
+        historyRoot.store();
+
-        InternalVersionHistory history = InternalVersionHistory.create(historyRoot, historyNodeName);
+        InternalVersionHistory history = InternalVersionHistory.create(parent, historyNodeName);
