work in progress

- invalidation of itemstates in case of CacheBehaviour != Observation
- CacheBehaviour.Observation not dependent on Observation-RepositoryDescriptor
- SPI-observation may be implemented even if Observation is not supported according
  jcr-Repository descriptor

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@478211 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.jcr2spi.state.NodeState;
+import org.apache.jackrabbit.jcr2spi.state.ItemStateException;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+    private static Logger log = LoggerFactory.getLogger(Clone.class);
+
+    /* In case of 'removeExisting' and INVALIDATION-cachebehaviour we need
+       to invalidate the complete tree. */
+    private final ManagerProvider destMgrProvider;
+
+        this.destMgrProvider = destMgrProvider;
-        // TODO
+        if (removeExisting) {
+            // invalidate the complete tree
+            try {
+                NodeState rootState = destMgrProvider.getItemStateManager().getRootState();
+                rootState.invalidate(true);
+            } catch (ItemStateException e) {
+                // TODO: fallback behaviour?
+                log.error("Cannot invalidate root state.", e.getMessage());
+            }
+        } else {
+            super.persisted();
+        }
