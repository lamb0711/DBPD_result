JCR-2800: Implement search facility for users and groups
removed implementation details from API
work in progress

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1033535 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.security.user.XPathQueryBuilder.Condition;
+import org.apache.jackrabbit.api.security.user.QueryBuilder.Selector;
+import org.apache.jackrabbit.core.SessionImpl;
+import org.apache.jackrabbit.core.security.user.XPathQueryBuilder.Condition;
-import javax.jcr.Node;
-import javax.jcr.PropertyType;
-import javax.jcr.RepositoryException;
-import javax.jcr.Value;
+import javax.jcr.*;
-    private final QueryManager queryManager;
+    private final SessionImpl session;
-    public XPathQueryEvaluator(XPathQueryBuilder builder, UserManagerImpl userManager, QueryManager queryManager) {
+    public XPathQueryEvaluator(XPathQueryBuilder builder, UserManagerImpl userManager, SessionImpl session) {
-        this.queryManager = queryManager;
+        this.session = session;
-             .append(builder.getSelector().getNtName())
+             .append(getNtName(builder.getSelector()))
-                Condition boundCondition = builder.property(sortCol, sortDir.getRelOp(), bound);
+                Condition boundCondition = builder.property(sortCol, sortDir.getCollation(), bound);
+        QueryManager queryManager = session.getWorkspace().getQueryManager();
-            xPath.append(condition.getRelPath())    
+            xPath.append(condition.getRelPath())
-             .append(condition.getRelPath())     
+             .append(condition.getRelPath())
+    private String getNtName(Selector selector) throws RepositoryException {
+        switch (selector) {
+            case AUTHORIZABLE:
+                return session.getJCRName(UserConstants.NT_REP_AUTHORIZABLE);
+
+            case USER:
+                return session.getJCRName(UserConstants.NT_REP_USER);
+
+            case GROUP:
+                return session.getJCRName(UserConstants.NT_REP_GROUP);
+
+            default:
+                throw new RepositoryException("Invalid selector: " + selector);
+        }
+    }
+
