JCR-1949: NullPointerException on DelegatingObservationDispatcher cause by parameter null on call : createEventStateCollection(null)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@745824 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.observation.ObservationManager;
+
-     * @param userData   the user data attached to this event state collection.
-                                Path pathPrefix,
-                                String userData) {
+                                Path pathPrefix) {
-        this.userData = userData;
+        if (session != null) {
+            try {
+                ObservationManager manager =
+                    session.getWorkspace().getObservationManager();
+                this.userData = ((ObservationManagerImpl) manager).getUserData();
+            } catch (RepositoryException e) {
+                // should never happen because this
+                // implementation supports observation
+                this.userData = null;
+            }
+        } else {
+            this.userData = null;
+        }
