JCR-1588 - JSR 283: Access Control (work in progress)
JCR-1590 - JSR 283: Locking
JCR-1915 - Node.setPrimaryNodeType should only redefine child-definitions that are not covered by the new effective nt
JCR-1875 - Failing Node.unlock() might leave inconsistent transient state
JCR-538 - Failing Node.checkin() or Node.checkout() might leave inconsistent transient state

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@732693 13f79535-47bb-0310-9956-ffa450edef68

+    public void checkPermission(Path absPath, int permissions) throws AccessDeniedException, RepositoryException {
+        if (!isGranted(absPath, permissions)) {
+            throw new AccessDeniedException("Access denied");
+        }
+    }
+
+    /**
+     * {@inheritDoc}
+     */
-            int bits = privilegeRegistry.getBits(privileges);
-                if (bits != PrivilegeRegistry.READ) {
+                if (privileges.length != 1 || !privileges[0].equals(privilegeRegistry.getPrivilege(Privilege.JCR_READ))) {
+        Privilege priv;
-            return privilegeRegistry.getPrivileges(PrivilegeRegistry.READ);
+            priv = privilegeRegistry.getPrivilege(Privilege.JCR_READ);
-            return privilegeRegistry.getPrivileges(PrivilegeRegistry.ALL);
+            priv = privilegeRegistry.getPrivilege(Privilege.JCR_ALL);
-            return privilegeRegistry.getPrivileges(PrivilegeRegistry.ALL);
+            priv = privilegeRegistry.getPrivilege(Privilege.JCR_ALL);
+        return new Privilege[] {priv};
-        checkPrivileges(absPath, PrivilegeRegistry.READ_AC);
+        checkPermission(absPath, Permission.READ_AC);
-     * @see AbstractAccessControlManager#checkPrivileges(String, int)
+     * @see AbstractAccessControlManager#checkPermission(String,int)
-    protected void checkPrivileges(String absPath, int privileges) throws AccessDeniedException, PathNotFoundException, RepositoryException {
+    protected void checkPermission(String absPath, int permission) throws AccessDeniedException, PathNotFoundException, RepositoryException {
-        if (anonymous && privileges != PrivilegeRegistry.READ) {
+        if (anonymous && permission != Permission.READ) {
