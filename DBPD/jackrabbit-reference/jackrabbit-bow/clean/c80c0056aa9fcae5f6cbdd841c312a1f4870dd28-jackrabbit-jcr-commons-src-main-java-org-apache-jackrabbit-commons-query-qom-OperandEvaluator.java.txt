JCR-3159 LOWER operand with nested LOCALNAME operand not work with SQL2

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1207838 13f79535-47bb-0310-9956-ffa450edef68

-            Value value = factory.createValue(
-                    row.getNode(nn.getSelectorName()).getName(),
-                    PropertyType.NAME);
-            return new Value[] { value };
+            String name = row.getNode(nn.getSelectorName()).getName();
+            // root node
+            if ("".equals(name)) {
+                return new Value[] { factory.createValue(name,
+                        PropertyType.STRING) };
+            }
+            return new Value[] { factory.createValue(name, PropertyType.NAME) };
-            Value value = factory
-                    .createValue(node.getName(), PropertyType.NAME);
-            return new Value[] { value };
+            String name = node.getName();
+            // root node
+            if ("".equals(name)) {
+                return new Value[] { factory.createValue(name,
+                        PropertyType.STRING) };
+            }
+            return new Value[] { factory.createValue(name, PropertyType.NAME) };
+
+        // root node has no local name
+        if ("".equals(name)) {
+            return new Value[] { factory.createValue("", PropertyType.STRING) };
+        }
