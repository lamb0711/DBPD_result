JCR-1825 DbDataStore doesn't support concurrent reads

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@708598 13f79535-47bb-0310-9956-ffa450edef68

-import java.sql.Statement;
-    protected final Statement stmt;
+    
+    /**
+     * Construct a db resource using the specified input stream.
+     * 
+     * @param in the input stream
+     */
+    public DbResources(InputStream in) {
+        this(null, null, in, null);
+    }
-    public DbResources(ConnectionRecoveryManager conn, ResultSet rs, Statement stmt, InputStream in, DbDataStore store) {
+    /**
+     * Construct a db resource using the specified connection. The connection
+     * will be returned to the data store once the resource is fully read. If
+     * the connection is null, then this class is just a container for the input
+     * stream. This is to support other kinds of input streams as well.
+     * 
+     * @param conn the connection (may be null)
+     * @param rs the result set (may be null)
+     * @param in the input stream
+     * @param store the data store
+     */
+    public DbResources(ConnectionRecoveryManager conn, ResultSet rs, InputStream in, DbDataStore store) {
-        this.stmt = stmt;
-        this.closed = false;
+        if (conn == null) {
+            closed = true;
+        }
-    public ConnectionRecoveryManager getConnection() {
-        return conn;
-    }
-
+    /**
+     * Get the input stream.
+     * 
+     * @return the input stream
+     */
-    public ResultSet getResultSet() {
-        return rs;
-    }
-
-    public Statement getStatement() {
-        return stmt;
-    }
-
+    /**
+     * Close the stream, and return the connection to the data store.
+     */
