JCR-1677: Allow workspace creation over cluster

Patch by Matej Knopp

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@711238 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.xml.ClonedInputSource;
+import java.io.StringReader;
+import java.io.StringWriter;
-            createWorkspaceConfig(defaultWorkspace);
+            createWorkspaceConfig(defaultWorkspace, (StringBuffer)null);
+     * @param configContent optional stringbuffer that will have the content
+     *        of workspace configuration file written in
-                                                                       Element template)
+                                                                       Element template,
+                                                                       StringBuffer configContent)
+
-                transformer.transform(
-                        new DOMSource(template), new StreamResult(configWriter));
+
+                if (configContent == null)
+                {
+                    transformer.transform(
+                            new DOMSource(template), new StreamResult(configWriter));
+                }
+                else
+                {
+                    StringWriter writer = new StringWriter();
+                    transformer.transform(
+                            new DOMSource(template), new StreamResult(writer));
+
+                    String s = writer.getBuffer().toString();
+                    configWriter.write(s);
+                    configContent.append(s);
+                }
+            } catch (IOException e) {
+                throw new ConfigurationException(
+                        "Cannot create a workspace configuration file", e);
+     * @param configContent optional StringBuffer that will have the content
+     *        of workspace configuration file written in
-    public WorkspaceConfig createWorkspaceConfig(String name)
+    public WorkspaceConfig createWorkspaceConfig(String name, StringBuffer configContent)
-        return internalCreateWorkspaceConfig(name, template);
+        return internalCreateWorkspaceConfig(name, template, configContent);
-        return internalCreateWorkspaceConfig(name, workspaceTemplate);
+        return internalCreateWorkspaceConfig(name, workspaceTemplate, null);
