JCR-1590: JSR 283: Locking

Store lock timeout information along with the lock tokens.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@803882 13f79535-47bb-0310-9956-ffa450edef68

-     * @param lockToken lock token to apply
+     * @param lockTokenLine lock token to apply
-    private void reapplyLock(String lockToken) {
+    private void reapplyLock(String lockTokenLine) {
+        String[] parts = lockTokenLine.split(",");
+        String token = parts[0];
+        long timeoutHint = Long.MAX_VALUE;
+        if (parts.length > 1) {
+            try {
+                timeoutHint = Long.parseLong(parts[1]);
+            } catch (NumberFormatException e) {
+                log.warn("Unexpected timeout hint "
+                        + parts[1] + " for lock token " + token, e);
+            }
+        }
+
-            NodeId id = LockInfo.parseLockToken(lockToken);
+            NodeId id = LockInfo.parseLockToken(parts[0]);
-                    Long.MAX_VALUE);
+                    timeoutHint);
-            log.warn("Unable to recreate lock '" + lockToken
-                    + "': " + e.getMessage());
+            log.warn("Unable to recreate lock '" + token + "': " + e.getMessage());
+
+                // Store the timeout hint, if one is specified
+                if (info.getTimeoutHint() != Long.MAX_VALUE) {
+                    writer.write(',');
+                    writer.write(Long.toString(info.getTimeoutHint()));
+                }
+
