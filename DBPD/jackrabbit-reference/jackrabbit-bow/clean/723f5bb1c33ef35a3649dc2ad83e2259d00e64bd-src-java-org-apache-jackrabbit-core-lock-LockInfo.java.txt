JCR-137 Open-scoped locks may be lost on restart and might not be transferrable

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@191150 13f79535-47bb-0310-9956-ffa450edef68

-     * When the owning session is logging out, we should unlock the node on
-     * behalf of the user currently holding it.
+     * When the owning session is logging out, we have to perform some
+     * operations depending on the lock type.
+     * (1) If the lock was session-scoped, we unlock the node.
+     * (2) If the lock was open-scoped, we remove the lock token
+     *     from the session.
-            lockMgr.unlock(this);
+            if (sessionScoped) {
+                lockMgr.unlock(this);
+            } else {
+                if (session.equals(lockHolder)) {
+                    lockHolder = null;
+                }
+            }
