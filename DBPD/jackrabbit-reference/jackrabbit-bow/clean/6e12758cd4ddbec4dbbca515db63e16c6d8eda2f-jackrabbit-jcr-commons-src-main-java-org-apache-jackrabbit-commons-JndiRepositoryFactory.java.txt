JCR-2771: Simplified Repository URI format for JNDI lookups

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1005449 13f79535-47bb-0310-9956-ffa450edef68

+import javax.naming.Context;
-@SuppressWarnings("unchecked")
+@SuppressWarnings({ "rawtypes", "unchecked" })
-                        String name = uri.getSchemeSpecificPart();
-                        return getRepository(name, environment);
+                        return getRepository(uri, environment);
+    private Repository getRepository(URI uri, Hashtable environment)
+            throws RepositoryException {
+        String name;
+        if (uri.isOpaque()) {
+            name = uri.getSchemeSpecificPart();
+        } else {
+            name = uri.getPath();
+            if (name == null) {
+                name = "";
+            } else if (name.startsWith("/")) {
+                name = name.substring(1);
+            }
+            String authority = uri.getAuthority();
+            if (authority != null && authority.length() > 0) {
+                environment = new Hashtable(environment);
+                environment.put(Context.INITIAL_CONTEXT_FACTORY, authority);
+            }
+        }
+        return getRepository(name, environment);
+    }
+
