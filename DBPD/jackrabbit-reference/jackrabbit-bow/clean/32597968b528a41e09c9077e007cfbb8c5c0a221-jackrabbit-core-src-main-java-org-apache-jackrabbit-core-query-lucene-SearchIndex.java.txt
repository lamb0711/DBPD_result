JCR-1278: Add configuration path to SynonymProvider

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@606180 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.fs.FileSystem;
+import org.apache.jackrabbit.core.fs.FileSystemResource;
+import org.apache.jackrabbit.core.fs.FileSystemException;
+import org.apache.jackrabbit.core.fs.local.LocalFileSystem;
+     * The configuration path for the synonym provider.
+     */
+    private String synonymProviderConfigPath;
+
+    /**
+     * The FileSystem for the synonym if the query handler context does not
+     * provide one.
+     */
+    private FileSystem synonymProviderConfigFs;
+
+    /**
+        if (synonymProviderConfigFs != null) {
+            try {
+                synonymProviderConfigFs.close();
+            } catch (FileSystemException e) {
+                log.warn("Exception while closing FileSystem", e);
+            }
+        }
+                sp.initialize(createSynonymProviderConfigResource());
+     * Creates a file system resource to the synonym provider configuration.
+     *
+     * @return a file system resource or <code>null</code> if no path was
+     *         configured.
+     * @throws FileSystemException if an exception occurs accessing the file
+     *                             system.
+     */
+    protected FileSystemResource createSynonymProviderConfigResource()
+            throws FileSystemException {
+        if (synonymProviderConfigPath != null) {
+            FileSystemResource fsr;
+            // simple sanity check
+            if (synonymProviderConfigPath.endsWith(FileSystem.SEPARATOR)) {
+                throw new FileSystemException(
+                        "Invalid synonymProviderConfigPath: " +
+                        synonymProviderConfigPath);
+            }
+            FileSystem fs = getContext().getFileSystem();
+            if (fs == null) {
+                fs = new LocalFileSystem();
+                int lastSeparator = synonymProviderConfigPath.lastIndexOf(
+                        FileSystem.SEPARATOR_CHAR);
+                if (lastSeparator != -1) {
+                    File root = new File(path,
+                            synonymProviderConfigPath.substring(0, lastSeparator));
+                    ((LocalFileSystem) fs).setRoot(root);
+                    fs.init();
+                    fsr = new FileSystemResource(fs,
+                            synonymProviderConfigPath.substring(lastSeparator + 1));
+                } else {
+                    ((LocalFileSystem) fs).setPath(path);
+                    fs.init();
+                    fsr = new FileSystemResource(fs, synonymProviderConfigPath);
+                }
+                synonymProviderConfigFs = fs;
+            } else {
+                fsr = new FileSystemResource(fs, synonymProviderConfigPath);
+            }
+            return fsr;
+        } else {
+            // path not configured
+            return null;
+        }
+    }
+
+    /**
+    /**
+     * Sets the configuration path for the synonym provider.
+     *
+     * @param path the configuration path for the synonym provider.
+     */
+    public void setSynonymProviderConfigPath(String path) {
+        synonymProviderConfigPath = path;
+    }
+
+    /**
+     * @return the configuration path for the synonym provider. If none is set
+     *         this method returns <code>null</code>.
+     */
+    public String getSynonymProviderConfigPath() {
+        return synonymProviderConfigPath;
+    }
+
