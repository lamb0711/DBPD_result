JCR-977: jcr:deref in xpath predicates

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@791737 13f79535-47bb-0310-9956-ffa450edef68

-public abstract class NAryQueryNode extends QueryNode {
+public abstract class NAryQueryNode<T extends QueryNode> extends QueryNode {
-    protected List operands = null;
+    protected List<T> operands = null;
-    public NAryQueryNode(QueryNode parent, QueryNode[] operands) {
+    public NAryQueryNode(QueryNode parent, T[] operands) {
-            this.operands = new ArrayList();
+            this.operands = new ArrayList<T>();
-    public void addOperand(QueryNode operand) {
+    public void addOperand(T operand) {
-            operands = new ArrayList();
+            operands = new ArrayList<T>();
-    public boolean removeOperand(QueryNode operand) {
+    public boolean removeOperand(T operand) {
-            return (QueryNode[]) operands.toArray(new QueryNode[operands.size()]);
+            return operands.toArray(new QueryNode[operands.size()]);
-     * @throws RepositoryException
+     * @throws RepositoryException if an error occurs.
-        List result = new ArrayList(operands.size());
-        for (int i = 0; i < operands.size(); i++) {
-            Object r = ((QueryNode) operands.get(i)).accept(visitor, data);
+        List<Object> result = new ArrayList<Object>(operands.size());
+        for (T operand : operands) {
+            Object r = operand.accept(visitor, data);
-        for (Iterator iter = operands.iterator(); iter.hasNext();) {
-            QueryNode queryNode = (QueryNode) iter.next();
-            if (queryNode.needsSystemTree()) {
+        for (T operand : operands) {
+            if (operand.needsSystemTree()) {
