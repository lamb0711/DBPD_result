JCR-3598: Oak in Jackrabbit deployment packages

Upgrade to Oak 0.15.
Make it possible to use Oak repositories in webapp/standalone.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1566604 13f79535-47bb-0310-9956-ffa450edef68

+        String repType = req.getParameter("repository_type");
+
-        if (repXml == null || repXml.length() == 0) {
-            repXml = repHome + "/repository.xml";
-        }
-        File config = new File(repXml);
+
+        File config;
+        if ("oak".equals(repType)) {
+            config = null;
+            repXml = null;
+        } else if (repXml == null || repXml.length() == 0) {
+            config = new File(home, "repository.xml");
+            repXml = config.getPath();
+        } else {
+            config = new File(repXml);
+        }
+
-            if (config.exists()) {
+            if (config != null && config.exists()) {
-            // install repository xml
-            try {
-                installRepositoryConfig(config);
-            } catch (IOException e) {
-                log.error("Error while installing new repository config '{}': {}", repXml, e.toString());
-                return C_BOOTSTRAP_EXISTS;
+
+            if (config != null) {
+                // install repository xml for Jackrabbit Classic
+                try {
+                    installRepositoryConfig(config);
+                } catch (IOException e) {
+                    log.error("Error while installing new repository config '{}': {}", repXml, e.toString());
+                    return C_BOOTSTRAP_EXISTS;
+                }
-                log.error("Trying to use exisintg repository home '{}' but does not exists", repHome);
+                log.error("Trying to use existing repository home '{}' but does not exists", repHome);
-            if (!config.exists()) {
+            if (config != null && !config.exists()) {
-        props.setProperty("repository.config", repXml);
+        if (repXml != null) {
+            props.setProperty("repository.config", repXml);
+        }
