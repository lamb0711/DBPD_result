JCR-251 NullPointerException in VirtualNodeTypeStateManager.nodeTypeRegistered

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@314832 13f79535-47bb-0310-9956-ffa450edef68

-            // allow provider to update
+                // allow provider to update
-
-            NodeImpl root = (NodeImpl) systemSession.getItemManager().getItem(new NodeId(rootNodeId));
-            NodeImpl child = root.getNode(ntName);
-            List events = new ArrayList();
-            recursiveAdd(events, root, child);
-            obsDispatcher.dispatch(events, systemSession);
+            if (systemSession != null) {
+                // generate observation events
+                NodeImpl root = (NodeImpl) systemSession.getItemManager().getItem(new NodeId(rootNodeId));
+                NodeImpl child = root.getNode(ntName);
+                List events = new ArrayList();
+                recursiveAdd(events, root, child);
+                obsDispatcher.dispatch(events, systemSession);
+            }
-            NodeImpl root = (NodeImpl) systemSession.getItemManager().getItem(new NodeId(rootNodeId));
-            NodeImpl child = root.getNode(ntName);
-            List events = new ArrayList();
-            recursiveRemove(events, root, child);
-            obsDispatcher.dispatch(events, systemSession);
+            if (systemSession != null) {
+                // generated observation events
+                NodeImpl root = (NodeImpl) systemSession.getItemManager().getItem(new NodeId(rootNodeId));
+                NodeImpl child = root.getNode(ntName);
+                List events = new ArrayList();
+                recursiveRemove(events, root, child);
+                obsDispatcher.dispatch(events, systemSession);
+            }
+                // allow provider to update
