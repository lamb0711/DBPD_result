JCR-3419: Overwriting Cache Entry Warnings

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1382673 13f79535-47bb-0310-9956-ffa450edef68

+        PropertyId propId = new PropertyId(getNodeId(), name);
-            PropertyId propId = new PropertyId(getNodeId(), name);
-            // does not exist yet:
-            // find definition for the specified property and create property
+            // does not exist yet or has been removed transiently:
+            // find definition for the specified property and (re-)create property
-            PropertyImpl prop = createChildProperty(name, type, def);
+            PropertyImpl prop;
+            if (stateMgr.hasTransientItemStateInAttic(propId)) {
+                // remove from attic
+                try {
+                    stateMgr.disposeTransientItemStateInAttic(stateMgr.getAttic().getItemState(propId));
+                } catch (ItemStateException ise) {
+                    // shouldn't happen because we checked if it is in the attic
+                    throw new RepositoryException(ise);
+                }
+                prop = (PropertyImpl) itemMgr.getItem(propId);
+                PropertyState state = (PropertyState) prop.getOrCreateTransientItemState();
+                state.setMultiValued(multiValued);
+                state.setType(type);
+                getNodeState().addPropertyName(name);
+            } else {
+                prop = createChildProperty(name, type, def);
+            }
