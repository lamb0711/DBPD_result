JCR-890: concurrent read-only access to a session

Use the SessionContext and SessionOperations in search

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@983708 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.ItemManager;
-import org.apache.jackrabbit.core.SessionImpl;
+import org.apache.jackrabbit.core.session.SessionContext;
-    public void init(SessionImpl session,
-                     ItemManager itemMgr,
-                     QueryHandler handler,
-                     String statement,
-                     String language,
-                     Node node) throws InvalidQueryException {
+    @Override
+    public void init(
+            SessionContext sessionContext, QueryHandler handler,
+            String statement, String language, Node node)
+            throws InvalidQueryException {
-     * @param session  the session of the user executing this query.
-     * @param itemMgr  the item manager of the session executing this query.
+     * @param sessionContext component context of the current session
-    public void init(SessionImpl session,
-                     ItemManager itemMgr,
-                     QueryHandler handler,
-                     QueryObjectModelTree qomTree,
-                     String language,
-                     Node node)
+    public void init(
+            SessionContext sessionContext, QueryHandler handler,
+            QueryObjectModelTree qomTree, String language, Node node)
-        this.session = session;
+        this.sessionContext = sessionContext;
-        this.query = handler.createExecutableQuery(session, itemMgr, qomTree);
+        this.query = handler.createExecutableQuery(sessionContext, qomTree);
