JCR-2887 : Split PrivilegeRegistry in a per-session manager instance and a repository level registry [work in progress]

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1092723 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.security.authorization.PrivilegeBits;
-import java.util.Collections;
-import java.util.HashSet;
-        String absPath = resolver.getJCRPath(path.getNormalizedPath());
+        String absPath = session.getJCRPath(path.getNormalizedPath());
-        private int getPrivilegeBits(String privName) throws RepositoryException {
+        private PrivilegeBits getPrivilegeBits(String... privNames) throws RepositoryException {
-            return impl.getBits(impl.getPrivilege(privName));
+            Privilege[] privs = new Privilege[privNames.length];
+            for (int i = 0; i < privNames.length; i++) {
+                privs[i] = impl.getPrivilege(privNames[i]);
+            }
+            return impl.getBits(privs);
-            int privs;
+            PrivilegeBits privs;
-            String jcrPath = resolver.getJCRPath(path.getNormalizedPath());
+            String jcrPath = session.getJCRPath(path.getNormalizedPath());
-                privs = PrivilegeRegistry.NO_PRIVILEGE;
+                privs = PrivilegeBits.EMPTY;
-                            privs |= getPrivilegeBits(PrivilegeRegistry.REP_WRITE);
+                            privs.add(getPrivilegeBits(PrivilegeRegistry.REP_WRITE));
-                            privs |= getPrivilegeBits(Privilege.JCR_MODIFY_PROPERTIES);
+                            privs.add(getPrivilegeBits(Privilege.JCR_MODIFY_PROPERTIES));
-                            privs |= getPrivilegeBits(PrivilegeRegistry.REP_WRITE);
+                            privs.add(getPrivilegeBits(PrivilegeRegistry.REP_WRITE));
-                                privs |= getPrivilegeBits(PrivilegeRegistry.REP_WRITE);
-                                privs ^= getPrivilegeBits(Privilege.JCR_REMOVE_NODE);
+                                privs.add(getPrivilegeBits(Privilege.JCR_ADD_CHILD_NODES, Privilege.JCR_MODIFY_PROPERTIES, Privilege.JCR_NODE_TYPE_MANAGEMENT));
-                                privs |= getPrivilegeBits(PrivilegeRegistry.REP_WRITE);
+                                privs.add(getPrivilegeBits(PrivilegeRegistry.REP_WRITE));
-            return new Result(allows, denies, privs, PrivilegeRegistry.NO_PRIVILEGE);
+            return new Result(allows, denies, privs, PrivilegeBits.EMPTY);
