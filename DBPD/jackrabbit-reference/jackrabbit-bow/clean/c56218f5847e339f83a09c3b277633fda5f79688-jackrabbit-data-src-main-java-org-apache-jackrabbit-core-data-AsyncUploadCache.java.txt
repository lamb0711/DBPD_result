JCR-3873 CachingDataStore not safe against crashes, corrupted uploads file will prevent system startup

Fix is to reset AsyncUploadCache and reload all local files to S3. 
Test case TestCachingFDS#testAsyncUploadCacheCorruption added. 


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1677956 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.commons.io.IOUtils;
+        toBeDeletedUploads = new File(homeDir + "/" + TO_BE_DELETED_UPLOAD_FILE);
-        toBeDeletedUploads = new File(homeDir + "/" + TO_BE_DELETED_UPLOAD_FILE);
+        
-        if (pendingUploads.exists()) {
-            if (!pendingUploads.delete()) {
-                throw new IOException("Failed to delete file [" + filePath
-                    + "]");
-            }
+        if (!pendingUploads.exists()) {
+            pendingUploads.createNewFile();
-        filePath = toBeDeletedUploads.getAbsolutePath();
-        if (toBeDeletedUploads.exists()) {
-            if (!toBeDeletedUploads.delete()) {
-                throw new IOException("Failed to delete file [" + filePath
-                    + "]");
-            }
+        if (!toBeDeletedUploads.exists()) {
+            toBeDeletedUploads.createNewFile();
+            output.flush();
+            IOUtils.closeQuietly(buffer);
+            
-            // display its data
+            IOUtils.closeQuietly(buffer);
+            output.flush();
+            IOUtils.closeQuietly(buffer);
+            IOUtils.closeQuietly(buffer);
