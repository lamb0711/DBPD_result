JCR-1438: Replace Config classes with factories

Replaced DataStoreConfig with DataStoreFactory

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@698161 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.data.DataStore;
+import org.apache.jackrabbit.core.data.DataStoreFactory;
-        // Optional data store configuration
-        DataStoreConfig dsc = parseDataStoreConfig(root);
+        // Optional data store factory
+        DataStoreFactory dsf = getDataStoreFactory(root, home);
-                maxIdleTime, template, vc, sc, cc, dsc, this);
+                maxIdleTime, template, vc, sc, cc, dsf, this);
-    protected DataStoreConfig parseDataStoreConfig(Element parent)
+    protected DataStoreFactory getDataStoreFactory(
+            final Element parent, final String directory)
-        NodeList children = parent.getChildNodes();
-        for (int i = 0; i < children.getLength(); i++) {
-            Node child = children.item(i);
-            if (child.getNodeType() == Node.ELEMENT_NODE
-                    && DATA_STORE_ELEMENT.equals(child.getNodeName())) {
-                DataStoreConfig cfg = new DataStoreConfig(parseBeanConfig(
-                        parent, DATA_STORE_ELEMENT));
-                return cfg;
+        return new DataStoreFactory() {
+            public DataStore getDataStore() throws RepositoryException {
+                NodeList children = parent.getChildNodes();
+                for (int i = 0; i < children.getLength(); i++) {
+                    Node child = children.item(i);
+                    if (child.getNodeType() == Node.ELEMENT_NODE
+                            && DATA_STORE_ELEMENT.equals(child.getNodeName())) {
+                        BeanConfig bc =
+                            parseBeanConfig(parent, DATA_STORE_ELEMENT);
+                        DataStore store = (DataStore) bc.newInstance();
+                        store.init(directory);
+                        return store;
+                    }
+                }
+                return null;
-        }
-        return null;
+        };
