work in progress

- HierarchyManager: changes methods to take ItemState instead of ItemId
- HierarchyManager: remove log-utility methods (saveGetJCRPath)
- HierarchyManager: remove CachingHierachyManager. not used
- ItemManager: changes methods to take ItemState instead of ItemId
- ItemStateValidator: remove utility methods not related to validation
- new class LogUtil that provides static saveGetJCRPath methods previously
  present on HierarchyManager, ItemStateValidator
- NodeState: add method 'getPropertyEntries()'
- create interface ChildPropertyEntry
- let PropertyReference implement ChildPropertyEntry

TODO: query/NodeIteratorImpl needs to be fixed. 


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@429652 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.jcr2spi.state.ItemState;
+import org.apache.jackrabbit.jcr2spi.version.VersionImpl;
-import org.apache.jackrabbit.spi.ItemId;
-        Operation op = Copy.create(srcPath, destPath, this, validator);
+        Operation op = Copy.create(srcPath, destPath, this, this);
-            Operation op = Copy.create(srcPath, destPath, srcWsp.getName(), srcWsp, validator);
+            Operation op = Copy.create(srcPath, destPath, srcWsp.getName(), srcWsp, this);
-            Operation op = Clone.create(srcPath, destPath, srcWsp.getName(), removeExisting, srcWsp, validator);
+            Operation op = Clone.create(srcPath, destPath, srcWsp.getName(), removeExisting, srcWsp, this);
-        Operation op = Move.create(srcPath, destPath, validator);
+        Operation op = Move.create(srcPath, destPath, getHierarchyManager(), getNamespaceResolver());
-            ItemId versionId = session.getHierarchyManager().getItemId(versions[i]);
-            if (versionId.denotesNode()) {
-                versionIds[i] = (NodeId) versionId;
+            if (versions[i] instanceof VersionImpl) {
+                versionIds[i] = (NodeId) ((VersionImpl)versions[i]).getId();
-        ItemId parentId = getHierarchyManager().getItemId(parentPath);
-        if (parentId.denotesNode()) {
+        ItemState parentState = getHierarchyManager().getItemState(parentPath);
+        if (parentState.isNode()) {
-        ItemId parentId = getHierarchyManager().getItemId(parentPath);
-        if (parentId.denotesNode()) {
-            wspManager.importXml((NodeId) parentId, in, uuidBehavior);
+        ItemState parentState = getHierarchyManager().getItemState(parentPath);
+        if (parentState.isNode()) {
+            wspManager.importXml((NodeId) parentState.getId(), in, uuidBehavior);
-            hierManager = new CachingHierarchyManager(getRootNodeId(),
+            hierManager = new HierarchyManagerImpl(getRootNodeId(),
