JCR-3277 Add consistency type information to consistency report items

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1439927 13f79535-47bb-0310-9956-ffa450edef68

-                String message = null;
-                                message = "NodeState '" + id + "' references inexistent child '" + childNodeId + "'";
+                                String message = "NodeState '" + id + "' references inexistent child '" + childNodeId + "'";
+                                addMessage(reports, childNodeId, message, ReportItem.Type.MISSING);
-                                    message = "ChildNode has invalid parent id: '" + cp + "' (instead of '" + id + "')";
+                                    String message = "Node has invalid parent id: '" + cp + "' (instead of '" + id + "')";
+                                    addMessage(reports, childNodeId, message, ReportItem.Type.DISCONNECTED);
-                if (message != null) {
-                    addMessage(reports, id, message);
-                }
-                addMessage(reports, id, e.getMessage());
+                addMessage(reports, id, e.getMessage(), ReportItem.Type.ERROR);
-                                addMessage(reports, id, message);
+                                addMessage(reports, id, message, ReportItem.Type.ORPHANED);
-                                addMessage(reports, id, message);
+                                addMessage(reports, id, message, ReportItem.Type.ABANDONED);
-            addMessage(reports, id, message);
+            addMessage(reports, id, message, ReportItem.Type.ERROR);
-        if ("cafebabe-cafe-babe-cafe-babecafebabe".equals(s)) {
-            // root node isn't virtual
-            return false;
-        }
-        else {
-            // all other system nodes are
-            return s.endsWith("babecafebabe");
-        }
+        return !isRoot(s) && s.endsWith("babecafebabe");
+    }
+
+    private boolean isRoot(String id) {
+        return "cafebabe-cafe-babe-cafe-babecafebabe".equals(id);
-    private void addMessage(Set<ReportItem> reports, NodeId id, String message) {
+    private void addMessage(Set<ReportItem> reports, NodeId id, String message, ReportItem.Type type) {
-            ReportItem ri = new ReportItemImpl(id.toString(), message);
+            ReportItem ri = new ReportItemImpl(id.toString(), message, type);
+
