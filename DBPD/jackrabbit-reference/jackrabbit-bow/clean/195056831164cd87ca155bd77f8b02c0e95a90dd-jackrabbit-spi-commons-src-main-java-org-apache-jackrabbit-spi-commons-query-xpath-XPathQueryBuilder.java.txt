JCR-800: Child Axis support in order by clause

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@744884 13f79535-47bb-0310-9956-ffa450edef68

-        if (tmpRelPath != null) {
-            try {
-                Path relPath = tmpRelPath.getPath();
-                for (int i = 0; i < relPath.getLength(); i++) {
-                    node.addPathElement(relPath.getElements()[i]);
-                }
-            } catch (MalformedPathException e) {
-                // should never happen
+        Path relPath = getRelativePath();
+        if (relPath != null) {
+            for (int i = 0; i < relPath.getLength(); i++) {
+                node.addPathElement(relPath.getElements()[i]);
+        }
+    }
+
+    /**
+     * Returns {@link #tmpRelPath} or <code>null</code> if there is none set.
+     * When this method returns {@link #tmpRelPath} will have been set
+     * <code>null</code>.
+     *
+     * @return {@link #tmpRelPath}.
+     */
+    private Path getRelativePath() {
+        try {
+            if (tmpRelPath != null) {
+                return tmpRelPath.getPath();
+            }
+        } catch (MalformedPathException e) {
+            // should never happen
+        } finally {
+        return null;
+            PathBuilder builder = new PathBuilder();
-            spec = new OrderQueryNode.OrderSpec(name, true);
+            Path relPath = getRelativePath();
+            if (relPath != null) {
+                builder.addAll(relPath.getElements());
+            }
+            builder.addLast(name);
+            spec = new OrderQueryNode.OrderSpec(builder.getPath(), true);
