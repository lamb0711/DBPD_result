JCR-1104: JSR 283 support

- use valuefactory that supports 283 features

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@782921 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.value.InternalValueFactory;
+import org.apache.jackrabbit.spi.commons.value.ValueFactoryQImpl;
+import org.apache.jackrabbit.spi.commons.value.ValueFormat;
+import org.apache.jackrabbit.spi.QValueFactory;
-import org.apache.jackrabbit.value.ValueFactoryImpl;
+import javax.jcr.ValueFactory;
+import javax.jcr.Value;
+    private final ValueFactory valueFactory;
+
+    private final QValueFactory qValueFactory = InternalValueFactory.getInstance();
+
+        valueFactory = new ValueFactoryQImpl(qValueFactory, resolver);
-            List values = new ArrayList();
+            List<InternalValue> values = new ArrayList();
-                    values.add(InternalValue.create(ValueHelper.convert(
-                            value, type, ValueFactoryImpl.getInstance()), resolver));
+                    Value v = ValueHelper.convert(value, type, valueFactory);
+                    values.add((InternalValue) ValueFormat.getQValue(v, resolver, qValueFactory));
