JCR-2579: InvalidItemStateException when attempting concurrent, non conflicting writes

The problem was caused by NodeState returning the underlying ChildNodeEntries as an unsynchronized List<> instance. I've refactored the code so that whenever a list of ChildNodeEntries is returned from NodeState, that list is independent of the internal mutable state of the NodeState instance.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@955307 13f79535-47bb-0310-9956-ffa450edef68

-        ChildNodeEntry[] children = (ChildNodeEntry[])
-            node.getState().getChildNodeEntries().toArray();
-        for (ChildNodeEntry child : children) {
+        for (ChildNodeEntry child : node.getState().getChildNodeEntries()) {
