JCR-890: concurrent read-only access to a session

Leverage SessionContext in more places.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@957229 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.session.SessionContext;
+     * The component context of this session.
+     */
+    protected final SessionContext sessionContext;
+
+    /**
-     * @param stateMgr  The shared item state manager
-     * @param rep       The repository
-     * @param session   The session
+     * @param sessionContext component context of this session
-            WorkspaceConfig wspConfig, RepositoryContext repositoryContext,
-            SessionImpl session) throws RepositoryException {
+            WorkspaceConfig wspConfig, SessionContext sessionContext)
+            throws RepositoryException {
-        this.repositoryContext = repositoryContext;
+        this.sessionContext = sessionContext;
+        this.repositoryContext = sessionContext.getRepositoryContext();
-        this.session = session;
+        this.session = sessionContext.getSessionImpl();
-        BatchedItemOperations ops = new BatchedItemOperations(
-                stateMgr, repositoryContext.getNodeTypeRegistry(),
-                session.getLockManager(), session, hierMgr);
+        BatchedItemOperations ops =
+            new BatchedItemOperations(stateMgr, sessionContext);
-                    ((SessionImpl) srcWsp.getSession()).getAccessManager(),
+                    srcWsp.sessionContext.getAccessManager(),
-        BatchedItemOperations ops = new BatchedItemOperations(
-                stateMgr, repositoryContext.getNodeTypeRegistry(),
-                session.getLockManager(), session, hierMgr);
+        BatchedItemOperations ops =
+            new BatchedItemOperations(stateMgr, sessionContext);
-        if (!session.getAccessManager().canAccess(srcWorkspace)) {
+        if (!sessionContext.getAccessManager().canAccess(srcWorkspace)) {
-        if (!session.getAccessManager().canAccess(srcWorkspace)) {
+        if (!sessionContext.getAccessManager().canAccess(srcWorkspace)) {
-        BatchedItemOperations ops = new BatchedItemOperations(
-                stateMgr, repositoryContext.getNodeTypeRegistry(),
-                session.getLockManager(), session, hierMgr);
+        BatchedItemOperations ops =
+            new BatchedItemOperations(stateMgr, sessionContext);
-                parentPath, this,
-                repositoryContext.getNodeTypeRegistry(),
+                parentPath, this, sessionContext,
