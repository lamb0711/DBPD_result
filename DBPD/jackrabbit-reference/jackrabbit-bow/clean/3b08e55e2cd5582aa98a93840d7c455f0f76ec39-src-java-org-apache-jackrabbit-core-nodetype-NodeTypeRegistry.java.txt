allow re-registering node type definition if change is trivial

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@122642 13f79535-47bb-0310-9956-ffa450edef68

-        // store poperty & child node definitions of new node type by id
+        // store property & child node definitions of new node type by id
-        // remove all affected effective node types from aggregates cache
+        /**
+         * remove all affected effective node types from aggregates cache
+         * (collect keys first to prevent ConcurrentModificationException)
+         */
+        ArrayList keys = new ArrayList();
+        while (iter.hasNext()) {
+            keys.add(iter.next());
+        }
+        iter = keys.iterator();
-        // remove poperty & child node definitions
+        // remove property & child node definitions
-        if (registeredNTDefs.containsKey(name)) {
-            String msg = name + " already exists";
-            log.error(msg);
-            throw new InvalidNodeTypeDefException(msg);
-        }
-
+        if (!diff.isModified()) {
+            throw new RepositoryException(name.toString() + ": not modified");
+        }
