JCR-2744: Avoid element arrays in PathImpl

Use new path construction mechanisms in PathBuilder and PathFactoryImpl

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@995787 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.spi.Path;
+import org.apache.jackrabbit.spi.Path;
-import java.util.LinkedList;
-
- * <p/>
+ * <p>
-     * the list of path elements of the constructed path
+     * The current path
-    private final LinkedList<Path.Element> queue;
+    private Path path = null;
-        this.factory = (factory != null) ? factory : PathFactoryImpl.getInstance();
-        queue = new LinkedList<Path.Element>();
+        this.factory = factory;
-        addAll(elements);
+        path = factory.create(elements);
-        addAll(parent.getElements());
+        path = parent;
-        addFirst(factory.getRootElement());
+        if (path != null) {
+            path = RootPath.INSTANCE.resolve(path);
+        } else {
+            path = RootPath.INSTANCE;
+        }
-            addLast(element);
+            if (path != null) {
+                path = path.resolve(element);
+            } else {
+                path = factory.create(element);
+            }
-        queue.addFirst(elem);
+        Path first = factory.create(elem);
+        if (path != null) {
+            path = first.resolve(path);
+        } else {
+            path = first;
+        }
-        queue.addLast(elem);
+        if (path != null) {
+            path = path.resolve(elem);
+        } else {
+            path = factory.create(elem);
+        }
-        addLast(factory.createElement(name));
+        addLast(name, Path.INDEX_UNDEFINED);
-        addLast(factory.createElement(name, index));
+        path = new NamePath(path, NameElement.create(name, index));
-        if (queue.size() == 0) {
+        if (path != null) {
+            return path;
+        } else {
-        Path.Element[] elements = queue.toArray(new Path.Element[queue.size()]);
-        return factory.create(elements);
