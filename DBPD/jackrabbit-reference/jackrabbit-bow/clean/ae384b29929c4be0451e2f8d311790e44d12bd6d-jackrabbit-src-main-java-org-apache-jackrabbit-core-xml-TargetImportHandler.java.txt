JCR-270: Importer drops jcr:xmlcharacters fields after a large jcr:xmlcharacters entry

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@349446 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.FileWriter;
+import java.io.FileOutputStream;
+import java.io.OutputStreamWriter;
+                // flush writer first
-                if (length() > Integer.MAX_VALUE) {
+                // flush writer first
+                writer.flush();
+                if (tmpFile.length() > Integer.MAX_VALUE) {
+                // flush writer first
-                    writer = new FileWriter(tmpFile);
+                    final FileOutputStream fout = new FileOutputStream(tmpFile);
+                    writer = new OutputStreamWriter(fout) {
+                        public void flush() throws IOException {
+                            // flush this writer
+                            super.flush();
+                            // force synchronization with underlying file
+                            fout.getFD().sync();
+                        }
+                    };
+                tmpFile.delete();
