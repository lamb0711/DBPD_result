JCR-1904: Event user data

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@724300 13f79535-47bb-0310-9956-ffa450edef68

-    public void externalUpdate(ChangeLog changes, List events, long timestamp)
+    public void externalUpdate(ChangeLog changes, List events,
+                               long timestamp, String userData)
-        clusterEvents.add(new UpdateEvent(changes, events, timestamp));
+        clusterEvents.add(new UpdateEvent(changes, events, timestamp, userData));
+         * The user data associated with this update.
+         */
+        private final String userData;
+
+        /**
+         * @param userData the user data associated with this update.
-        public UpdateEvent(ChangeLog changes, List events, long timestamp) {
+        public UpdateEvent(ChangeLog changes, List events,
+                           long timestamp, String userData) {
+            this.userData = userData;
+        public String getUserData() {
+            return userData;
+        }
+
-            return changes.hashCode() ^ events.hashCode() ^ (int) (timestamp ^ (timestamp >>> 32));
+            int h = changes.hashCode() ^ events.hashCode() ^ (int) (timestamp ^ (timestamp >>> 32));
+            if (userData != null) {
+                h = h ^ userData.hashCode();
+            }
+            return h;
-                    timestamp == other.timestamp;
+                    timestamp == other.timestamp &&
+                    SimpleEventListener.equals(userData, other.userData);
