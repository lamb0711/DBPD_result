- make search manager configurable
- improve indexing performance

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@71500 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.log4j.Logger;
+    private static final Logger log = Logger.getLogger(AbstractIndex.class);
+
-    private boolean useCompoundFile = false;
+    private boolean useCompoundFile = true;
+
+    private int minMergeDocs = 1000;
+
+    private int maxMergeDocs = 10000;
+
+    private int mergeFactor = 10;
+            indexWriter.minMergeDocs = minMergeDocs;
+            indexWriter.maxMergeDocs = maxMergeDocs;
+            indexWriter.mergeFactor = mergeFactor;
-    synchronized void setUseCompoundFile(boolean b) {
-        useCompoundFile = b;
-        if (indexWriter != null) {
-            indexWriter.setUseCompoundFile(b);
-        }
-    }
-
-
+            log.debug("closing IndexWriter.");
+            log.debug("closing IndexReader.");
+            indexWriter.minMergeDocs = minMergeDocs;
+            indexWriter.maxMergeDocs = maxMergeDocs;
+            indexWriter.mergeFactor = mergeFactor;
-                // FIXME do logging
+                log.warn("Exception closing index writer: " + e.toString());
-                // FIXME do logging
+                log.warn("Exception closing index reader: " + e.toString());
+
+    void setUseCompoundFile(boolean b) {
+        useCompoundFile = b;
+        if (indexWriter != null) {
+            indexWriter.setUseCompoundFile(b);
+        }
+    }
+
+    void setMinMergeDocs(int minMergeDocs) {
+        this.minMergeDocs = minMergeDocs;
+        if (indexWriter != null) {
+            indexWriter.minMergeDocs = minMergeDocs;
+        }
+    }
+
+    void setMaxMergeDocs(int maxMergeDocs) {
+        this.maxMergeDocs = maxMergeDocs;
+        if (indexWriter != null) {
+            indexWriter.maxMergeDocs = maxMergeDocs;
+        }
+    }
+
+    void setMergeFactor(int mergeFactor) {
+        this.mergeFactor = mergeFactor;
+        if (indexWriter != null) {
+            indexWriter.mergeFactor = mergeFactor;
+        }
+    }
