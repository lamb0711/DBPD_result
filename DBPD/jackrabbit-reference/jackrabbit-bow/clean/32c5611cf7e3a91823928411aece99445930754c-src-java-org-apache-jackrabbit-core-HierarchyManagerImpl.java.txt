fixed ZombieHierarchyManager: 
resolvePath(), getDepth() and getName() did not allow 
for removed/moved items

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@202206 13f79535-47bb-0310-9956-ffa450edef68

+     *
+     * @param state
+     * @return
+     */
+    protected String getParentUUID(ItemState state) {
+        return state.getParentUUID();
+    }
+
+    /**
+     *
+     * @param parent
+     * @return
+     */
+    protected NodeState.ChildNodeEntry getChildNodeEntry(NodeState parent,
+                                                         String uuid) {
+        return parent.getChildNodeEntry(uuid);
+    }
+
+    /**
+     *
+     * @param parent
+     * @param name
+     * @param index
+     * @return
+     */
+    protected NodeState.ChildNodeEntry getChildNodeEntry(NodeState parent,
+                                                         QName name,
+                                                         int index) {
+        return parent.getChildNodeEntry(name, index);
+    }
+
+    /**
-                    parentState.getChildNodeEntry(name, index);
+                    getChildNodeEntry(parentState, name, index);
-        String parentUUID = state.getParentUUID();
-        if (parentUUID == null) {
+        // shortcut
+        if (state.getId().equals(rootNodeId)) {
+        String parentUUID = getParentUUID(state);
+        if (parentUUID == null) {
+            String msg = "failed to build path of " + state.getId()
+                    + ": orphaned item";
+            log.debug(msg);
+            throw new ItemNotFoundException(msg);
+        }
+
-            NodeState.ChildNodeEntry entry = parent.getChildNodeEntry(uuid);
+            NodeState.ChildNodeEntry entry = getChildNodeEntry(parent, uuid);
-                String parentUUID = nodeState.getParentUUID();
+                String parentUUID = getParentUUID(nodeState);
-                    parentState.getChildNodeEntry(nodeId.getUUID());
+                    getChildNodeEntry(parentState, nodeId.getUUID());
-            String parentUUID = state.getParentUUID();
+            String parentUUID = getParentUUID(state);
-            String parentUUID = state.getParentUUID();
+            String parentUUID = getParentUUID(state);
