JCR-2744: Avoid element arrays in PathImpl

Use relative paths instead of path elements in event states

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@997227 13f79535-47bb-0310-9956-ffa450edef68

-                                    oldPath.getNameElement(),
+                                    oldPath.getLastElement(),
-                                newPath.getNameElement(),
+                                newPath.getLastElement(),
-                        events.add(EventState.nodeMoved(newParentId,
-                                newPath, n.getNodeId(), oldPath,
+                        events.add(EventState.nodeMovedWithInfo(
+                                newParentId, newPath, n.getNodeId(), oldPath,
-                                        n.getNodeId(), oldPath.getNameElement(),
+                                        n.getNodeId(), oldPath.getLastElement(),
-                                        n.getNodeId(), newPath.getNameElement(),
+                                        n.getNodeId(), newPath.getLastElement(),
-                                events.add(EventState.nodeMoved(
+                                events.add(EventState.nodeMovedWithInfo(
-                        Path.Element addedElem = getPathElement(child);
+                        Path addedElem = getPathElement(child);
-                        Path.Element removedElem = getPathElement(entry);
+                        Path removedElem = getPathElement(entry);
-                        Path.Element beforeElem = null;
+                        Path beforeElem = null;
-                        getParent(path), path.getNameElement(),
+                        getParent(path), path.getLastElement(),
-                        path.getNameElement(),
+                        path.getLastElement(),
-                            path.getNameElement(),
+                            path.getLastElement(),
-                        path.getNameElement(),
+                        path.getLastElement(),
-                        path.getNameElement(),
+                        path.getLastElement(),
-    private Path.Element getNameElement(NodeId nodeId,
-                                        NodeId parentId,
-                                        HierarchyManager hmgr)
+    private Path getNameElement(
+            NodeId nodeId, NodeId parentId, HierarchyManager hmgr)
-            PathBuilder builder = new PathBuilder();
-            builder.addFirst(name);
-            return builder.getPath().getNameElement();
+            return PathFactoryImpl.getInstance().create(name);
-    private Path.Element getZombieNameElement(NodeId nodeId,
-                                              NodeId parentId,
-                                              ChangeLogBasedHierarchyMgr hmgr)
+    private Path getZombieNameElement(
+            NodeId nodeId, NodeId parentId, ChangeLogBasedHierarchyMgr hmgr)
-            PathBuilder builder = new PathBuilder();
-            builder.addFirst(name);
-            return builder.getPath().getNameElement();
+            return PathFactoryImpl.getInstance().create(name);
-    private Path.Element getPathElement(ChildNodeEntry entry) {
+    private Path getPathElement(ChildNodeEntry entry) {
-        return PathFactoryImpl.getInstance().createElement(name, index);
+        return PathFactoryImpl.getInstance().create(name, index);
