JCR-2272: Errors during concurrent session import of nodes with same UUIDs

Use SQLState 23xxx instead of the Java 6 SQLIntegrityConstraintViolationException to check for integrity issues

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/branches/JCR-2272@1173169 13f79535-47bb-0310-9956-ffa450edef68

-import java.sql.SQLIntegrityConstraintViolationException;
-                // if we got here due to a constraint violation and we are running in
-                // test mode, we really want to stop
-                assert !(e.getCause() instanceof SQLIntegrityConstraintViolationException);
+                // if we got here due to a constraint violation and we
+                // are running in test mode, we really want to stop
+                assert !isIntegrityConstraintViolation(e.getCause());
+    private boolean isIntegrityConstraintViolation(Throwable t) {
+        if (t instanceof SQLException) {
+            String state = ((SQLException) t).getSQLState();
+            return state != null && state.startsWith("23");
+        } else {
+            return false;
+        }
+    }
+
-            if (e instanceof SQLIntegrityConstraintViolationException) {
+            if (isIntegrityConstraintViolation(e)) {
