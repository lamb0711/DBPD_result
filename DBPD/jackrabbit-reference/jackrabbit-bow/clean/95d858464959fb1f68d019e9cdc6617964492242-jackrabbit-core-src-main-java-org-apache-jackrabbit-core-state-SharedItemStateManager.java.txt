JCR-2780  -  Best effort merge if concurrent modifications include changes to mixin types

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1027938 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Iterator;
+import javax.jcr.nodetype.NodeType;
-        for (int i = 0; i < virtualProviders.length; i++) {
-            if (virtualProviders[i].isVirtualRoot(id)) {
-                return virtualProviders[i].getItemState(id);
+        for (VirtualItemStateProvider virtualProvider : virtualProviders) {
+            if (virtualProvider.isVirtualRoot(id)) {
+                return virtualProvider.getItemState(id);
-        for (int i = 0; i < virtualProviders.length; i++) {
-            if (virtualProviders[i].hasItemState(id)) {
-                return virtualProviders[i].getItemState(id);
+        for (VirtualItemStateProvider virtualProvider : virtualProviders) {
+            if (virtualProvider.hasItemState(id)) {
+                return virtualProvider.getItemState(id);
-        for (int i = 0; i < virtualProviders.length; i++) {
-            if (virtualProviders[i].isVirtualRoot(id)) {
+        for (VirtualItemStateProvider virtualProvider : virtualProviders) {
+            if (virtualProvider.isVirtualRoot(id)) {
-        for (int i = 0; i < virtualProviders.length; i++) {
-            if (virtualProviders[i].hasItemState(id)) {
+        for (VirtualItemStateProvider virtualProvider : virtualProviders) {
+            if (virtualProvider.hasItemState(id)) {
-        for (int i = 0; i < virtualProviders.length; i++) {
+        for (VirtualItemStateProvider virtualProvider : virtualProviders) {
-                return virtualProviders[i].getNodeReferences(id);
+                return virtualProvider.getNodeReferences(id);
-        for (int i = 0; i < virtualProviders.length; i++) {
-            if (virtualProviders[i].hasNodeReferences(id)) {
+        for (VirtualItemStateProvider virtualProvider : virtualProviders) {
+            if (virtualProvider.hasNodeReferences(id)) {
-        for (int i = 0; i < virtualProviders.length; i++) {
-            virtualProviders[i].removeListener(this);
+        for (VirtualItemStateProvider virtualProvider : virtualProviders) {
+            virtualProvider.removeListener(this);
+                                        public EffectiveNodeType getEffectiveNodeType(Name ntName) throws NoSuchNodeTypeException {
+                                            return ntReg.getEffectiveNodeType(ntName);
+                                        }
+
-        Set mixins = state.getMixinTypeNames();
+        Set<Name> mixins = state.getMixinTypeNames();
