work in progress

jcr2spi
- HierarchyManager: fixing methods with ItemId param
- HierarchyManagerImpl(s): removing unused methods
- ItemManagerImpl: replacing NodeId as cacheKey
- ItemImpl: remove ISM field

jcr2spi/xml
- ImporterImpl renamed to SessionImporter (used for s-import only)
- xml import: Use UUID String instead of creating NodeIds
- ReferenceChangeTracker: remove usage of spi NodeId

jcr2spi/state
- SessionItemStateManager: ValueFactory not needed since QPropertyDefinition returns qualified values.

jcr2spi/util
- LogUtil: add 'saveGetJCRName' utility method

jcr2spi/locking
- locking: LockManager to use NodeState instead of NodeId
- locking: removing locktoken from Session checks if Session is lock holder

jcr2spi/query
- NodeIteratorImpl: fix commented code, that allows to retrieve
  search results from IdIterator returned from QueryInfo
- minor reformatting, javadoc

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@430791 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.jcr2spi.state.ItemStateManager;
-public class QueryResultImpl implements QueryResult {
+class QueryResultImpl implements QueryResult {
+     * The item state manager of the session executing the query
+     */
+    private final ItemStateManager itemStateMgr;
+
+    /**
-     * The namespace resolver of the session executing the query
+     * The namespace nsResolver of the session executing the query
+     * @param itemStateMgr the item state manager of the session executing the query.
-     * @param resolver    the namespace nsResolver of the session executing the query.
+     * @param nsResolver    the namespace nsResolver of the session executing the query.
-    public QueryResultImpl(ItemManager itemMgr,
-                           QueryInfo queryInfo,
-                           NamespaceResolver resolver) {
+    QueryResultImpl(ItemManager itemMgr, ItemStateManager itemStateMgr,
+                    QueryInfo queryInfo, NamespaceResolver nsResolver) {
+        this.itemStateMgr = itemStateMgr;
-        this.nsResolver = resolver;
+        this.nsResolver = nsResolver;
-        return new NodeIteratorImpl(itemMgr, nsResolver, queryInfo);
+        return new NodeIteratorImpl(itemMgr, itemStateMgr, queryInfo);
