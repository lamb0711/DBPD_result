Removed JDOM dependency from nodetype XML handling (JCR-54)
 - converted all JDOM references to the equivalent standard DOM code
 - Moved the rest of XML references out of the NodeTypeDefStore class
 - Added the NodeTypeFormatter facade class
 - Made a number of small changes and restructurings to better match the DOM API
 - Added a mostly complete test case in src/test/o.a.j/core/nodetype/xml
   (the tests in .../test/api/nodetype are more concerned with the nodetype
   API than the XML handling)
 - Added a simple ValueConstraint.equals() method to simplify the test cases
   (fixes a problem in NodeTypeDef.equals())


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@157940 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Iterator;
+import javax.jcr.NamespaceRegistry;
+import javax.jcr.RepositoryException;
-import org.jdom.Element;
-import org.jdom.Namespace;
+import org.w3c.dom.Attr;
+import org.w3c.dom.Element;
+import org.w3c.dom.NamedNodeMap;
-     * Creates a namespace resolver using the additional namespaces declared
+     * Creates a namespace resolver using the namespaces declared
-        Iterator namespaces = element.getAdditionalNamespaces().iterator();
-        while (namespaces.hasNext()) {
-            Namespace namespace = (Namespace) namespaces.next();
-            addNamespace(namespace.getPrefix(), namespace.getURI());
+        NamedNodeMap attributes = element.getAttributes();
+        for (int i = 0; i < attributes.getLength(); i++) {
+            Attr attribute = (Attr) attributes.item(i);
+            if (Constants.NS_XMLNS_PREFIX.equals(attribute.getPrefix())) {
+                addNamespace(attribute.getLocalName(), attribute.getValue());
+            }
-
+     * Creates a namespace resolver using the namespaces declared
+     * in the given namespace registry.
+     *
+     * @param registry namespace registry
+     * @throws RepositoryException on repository errors
+     */
+    public AdditionalNamespaceResolver(NamespaceRegistry registry)
+            throws RepositoryException {
+        String[] prefixes = registry.getPrefixes();
+        for (int i = 0; i < prefixes.length; i++) {
+            addNamespace(prefixes[i], registry.getURI(prefixes[i]));
+        }
+    }
+
+    /**
