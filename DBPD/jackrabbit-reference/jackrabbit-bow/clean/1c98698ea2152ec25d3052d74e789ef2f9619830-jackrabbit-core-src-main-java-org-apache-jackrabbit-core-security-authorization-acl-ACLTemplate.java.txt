JCR-2887 : Split PrivilegeRegistry in a per-session manager instance and a repository level registry [work in progress]

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1072154 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.WorkspaceImpl;
+import org.apache.jackrabbit.core.security.authorization.PrivilegeManager;
-     * The privilege registry
+     * The privilege mgr
-    private final PrivilegeRegistry privilegeRegistry;
+    private final PrivilegeManager privilegeMgr;
-     * @param privilegeRegistry registry
+     * @param privilegeMgr
-                PrivilegeRegistry privilegeRegistry, ValueFactory valueFactory,
+                PrivilegeManager privilegeMgr, ValueFactory valueFactory,
-        this.privilegeRegistry = privilegeRegistry;
+        this.privilegeMgr = privilegeMgr;
-     * @param privilegeRegistry registry
-    ACLTemplate(NodeImpl aclNode, PrivilegeRegistry privilegeRegistry) throws RepositoryException {
+    ACLTemplate(NodeImpl aclNode) throws RepositoryException {
+        privilegeMgr = ((WorkspaceImpl) sImpl.getWorkspace()).getPrivilegeManager();
-        this.privilegeRegistry = privilegeRegistry;
-                        Privilege[] mergedPrivs = privilegeRegistry.getPrivileges(mergedBits);
+                        Privilege[] mergedPrivs = privilegeMgr.getPrivileges(mergedBits);
-                            privilegeRegistry.getPrivileges(resultPrivs),
+                            privilegeMgr.getPrivileges(resultPrivs),
+
+        @Override
+        protected PrivilegeManager getPrivilegeManager() {
+            return privilegeMgr;
+        }
