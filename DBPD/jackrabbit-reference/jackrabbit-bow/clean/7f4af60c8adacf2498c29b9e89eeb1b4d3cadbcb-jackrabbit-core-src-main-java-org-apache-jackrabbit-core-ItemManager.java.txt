JCR-1601 - Occasional NullPointerException in ItemManager

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@656282 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.InvalidItemStateException;
-        if (data.getState().getStatus() == ItemState.STATUS_NEW &&
+        // JCR-1601: cached item may just have been invalidated
+        ItemState state = data.getState();
+        if (state == null) {
+            throw new InvalidItemStateException(data.getId() + ": the item does not exist anymore");
+        }
+        if (state.getStatus() == ItemState.STATUS_NEW &&
