JCR-1342 Use bundle packaging with the Maven Bundle Plugin and export all packages
JCR-1343 Replace use of Xerces by JAXP to implement SAX DocumentHandler

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@614859 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.xml.serialize.OutputFormat;
-import org.apache.xml.serialize.XMLSerializer;
+import javax.jcr.RepositoryException;
+import javax.xml.transform.TransformerConfigurationException;
+import javax.xml.transform.sax.SAXTransformerFactory;
+import javax.xml.transform.sax.TransformerHandler;
+import javax.xml.transform.stream.StreamResult;
+
-    private ContentHandler handler;
+    private TransformerHandler handler;
+     * 
+     * @throws RepositoryException if the this instance cannot be setup. This
+     *      exception contains the reason why it cannot be setup as its cause.
-    public ImportContentHandler() {
+    public ImportContentHandler() throws RepositoryException {
-        this.handler = new XMLSerializer(buffer, new OutputFormat());
+        
+        try {
+            SAXTransformerFactory stf = (SAXTransformerFactory) SAXTransformerFactory.newInstance();
+            this.handler = stf.newTransformerHandler();
+            this.handler.setResult(new StreamResult(buffer));
+        } catch (TransformerConfigurationException tce) {
+            throw new RepositoryException("Cannot create XML handler", tce);
+        }
