webapp: adding some better error reporting  (tobi)
webapp: adding support for late repository retrieval (tobi)
server: workspace not passed to Repository.login in webdav/simple/DavSessionProviderImpl
JCR-280 - IllegalArgumentException when retrieving DateHeader 
JCR-282 - respect maximal value for timeout
JCR-276 - SimpleWebdavServlet: avoid 404 on the root collection after successful connection to it.


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@349905 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.log4j.Logger;
-import org.apache.jackrabbit.webdav.*;
-import org.apache.jackrabbit.webdav.observation.*;
-import org.apache.jackrabbit.webdav.jcr.*;
-import org.apache.jackrabbit.webdav.jcr.observation.SubscriptionManagerImpl;
-import org.apache.jackrabbit.webdav.jcr.transaction.TxLockManagerImpl;
-import org.apache.jackrabbit.server.jcr.JCRWebdavServer;
-import org.apache.jackrabbit.server.SessionProviderImpl;
+import org.apache.jackrabbit.server.SessionProviderImpl;
+import org.apache.jackrabbit.server.jcr.JCRWebdavServer;
+import org.apache.jackrabbit.webdav.DavConstants;
+import org.apache.jackrabbit.webdav.DavLocatorFactory;
+import org.apache.jackrabbit.webdav.DavResource;
+import org.apache.jackrabbit.webdav.DavResourceFactory;
+import org.apache.jackrabbit.webdav.DavSessionProvider;
+import org.apache.jackrabbit.webdav.WebdavRequest;
+import org.apache.jackrabbit.webdav.jcr.DavLocatorFactoryImpl;
+import org.apache.jackrabbit.webdav.jcr.DavResourceFactoryImpl;
+import org.apache.jackrabbit.webdav.jcr.observation.SubscriptionManagerImpl;
+import org.apache.jackrabbit.webdav.jcr.transaction.TxLockManagerImpl;
+import org.apache.jackrabbit.webdav.observation.SubscriptionManager;
+import org.apache.log4j.Logger;
-import javax.servlet.ServletException;
-import javax.servlet.ServletContext;
+import javax.servlet.ServletException;
-        final ServletContext ctx = getServletContext();
-
-	Repository repository = RepositoryAccessServlet.getRepository(ctx);
-	if (repository == null) {
-	    throw new ServletException("Repository could not be retrieved. Check config of 'RepositoryAccessServlet'.");
-	}
-	server = new JCRWebdavServer(repository, new SessionProviderImpl(
-                new BasicCredentialsProvider(
-                        getInitParameter(INIT_PARAM_MISSING_AUTH_MAPPING)))
-        );
-        if (txId != null && !txMgr.hasLock(txId, resource)) {
-           return false;
-        }
-
-        return true;
+        return txId == null || txMgr.hasLock(txId, resource);
+        if (server == null) {
+            Repository repository = RepositoryAccessServlet.getRepository(getServletContext());
+            server = new JCRWebdavServer(repository, new SessionProviderImpl(
+                    new BasicCredentialsProvider(
+                            getInitParameter(INIT_PARAM_MISSING_AUTH_MAPPING)))
+            );
+        }
