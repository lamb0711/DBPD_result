- rearranging structure of versioning (will corrupt versioned data)
- adding observation of version storage (work in progress)


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@159366 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.version.VersionHistoryNodeState;
+            ItemState s;
-                return (ItemState) nodes.get(id);
+                s = (ItemState) nodes.get(id);
-                return getRootState();
+                s = getRootState();
-                return cache(internalGetNodeState((NodeId) id));
+                s = cache(internalGetNodeState((NodeId) id));
+            if (s instanceof VersionHistoryNodeState) {
+                s.getId();
+            }
+            return s;
+            state.addListener(this);
-        if (destroyed.isNode() && ((NodeState) destroyed).getId().equals(rootNodeId)) {
+        if (destroyed.isNode() && destroyed.getId().equals(rootNodeId)) {
-        if (discarded.isNode() && ((NodeState) discarded).getId().equals(rootNodeId)) {
+        if (discarded.isNode() && discarded.getId().equals(rootNodeId)) {
