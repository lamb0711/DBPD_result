JCR-3554: RepositoryService.getReferences needs to deal with absolute paths in hrefs

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1462153 13f79535-47bb-0310-9956-ffa450edef68

-                    } catch (URISyntaxException e) {
-                        throw new RepositoryException(e.getMessage());
-    private static String resolve(String wspUri, String href) throws URISyntaxException {
-        java.net.URI base = new java.net.URI(wspUri);
-        java.net.URI rel = new java.net.URI(href);
-        return base.resolve(rel).toASCIIString();
+    private static String resolve(String wspUri, String href) throws RepositoryException {
+        try {
+            java.net.URI base = new java.net.URI(wspUri);
+            java.net.URI rel = new java.net.URI(href);
+            return base.resolve(rel).toString();
+        }
+        catch (URISyntaxException ex) {
+            throw new RepositoryException(ex);
+        }
-    NodeId buildNodeId(NodeId parentId, MultiStatusResponse response,
+    protected NodeId buildNodeId(NodeId parentId, String baseUri, MultiStatusResponse response,
-        
+
-        cache.add(response.getHref(), nodeId);
+        cache.add(resolve(baseUri, response.getHref()), nodeId);
+
-            return buildNodeId(parentId, responses[0], sessionInfo.getWorkspaceName(), service.getNamePathResolver(sessionInfo));
+            return buildNodeId(parentId, uri, responses[0], sessionInfo.getWorkspaceName(), service.getNamePathResolver(sessionInfo));
