JCR-1799 updating events swallowed (CacheBehavior.OBSERVATION)   	
JCR-1783 incomplete changelog when combining move with removal of new destination parent

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@704361 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.jcr2spi.state.NodeState;
-import org.apache.jackrabbit.jcr2spi.version.VersionManager;
+import org.apache.jackrabbit.jcr2spi.state.NodeState;
+import org.apache.jackrabbit.jcr2spi.version.VersionManager;
-import javax.jcr.RepositoryException;
+import javax.jcr.RepositoryException;
-import javax.jcr.version.VersionException;
+import javax.jcr.version.VersionException;
+        assert status == STATUS_PENDING;
+        assert status == STATUS_PENDING;
+        status = STATUS_PERSISTED;
-            mgr.getVersionHistoryEntry(nodeState).invalidate(true);
+            NodeEntry vhe = mgr.getVersionHistoryEntry(nodeState);
+            if (vhe != null) {
+                vhe.invalidate(true);
+            }
-            log.warn("Internal error", e);
+            log.warn("Failed to access Version history entry -> skip invalidation.", e);
-    public NodeId getNodeId() {
+    public NodeId getNodeId() throws RepositoryException {
