JCR-2167 CompactNodeTypeDefReader could auto-provide default namespace mappings if omitted


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@786680 13f79535-47bb-0310-9956-ffa450edef68

+     * Default namespace mappings
+     */
+    public static final NamespaceMapping NS_DEFAULTS;
+    static {
+        try {
+            NS_DEFAULTS = new NamespaceMapping();
+            NS_DEFAULTS.setMapping(Name.NS_EMPTY_PREFIX, Name.NS_DEFAULT_URI);
+            NS_DEFAULTS.setMapping(Name.NS_JCR_PREFIX, Name.NS_JCR_URI);
+            NS_DEFAULTS.setMapping(Name.NS_MIX_PREFIX, Name.NS_MIX_URI);
+            NS_DEFAULTS.setMapping(Name.NS_NT_PREFIX, Name.NS_NT_URI);
+            NS_DEFAULTS.setMapping(Name.NS_REP_PREFIX, Name.NS_REP_URI);
+        } catch (NamespaceException e) {
+            throw new InternalError(e.toString());
+        }
+    }
+    
+    /**
-        this(r, systemId, new NamespaceMapping(), null);
+        this(r, systemId, null, null);
-        this(r, systemId, new NamespaceMapping(), builder);
+        this(r, systemId, null, builder);
-        this.nsMapping = mapping;
+        this.nsMapping = mapping == null
+                ? new NamespaceMapping(NS_DEFAULTS)
+                : mapping;
