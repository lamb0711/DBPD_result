JCR-2055: RepositoryStub implementation in jackrabbit-core

Use JackrabbitRepositoryStub for the tests in spi2jcr.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@762755 13f79535-47bb-0310-9956-ffa450edef68

-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-import org.apache.jackrabbit.spi.RepositoryServiceStub;
-import org.apache.jackrabbit.spi.RepositoryService;
-import org.apache.jackrabbit.core.jndi.RegistryHelper;
-
-import javax.jcr.RepositoryException;
-import javax.jcr.Repository;
-import javax.jcr.SimpleCredentials;
-import javax.jcr.Credentials;
-import javax.naming.Context;
-import javax.naming.InitialContext;
-import java.util.Hashtable;
+
+import javax.jcr.Credentials;
+import javax.jcr.Repository;
+import javax.jcr.RepositoryException;
+import javax.jcr.SimpleCredentials;
+
+import org.apache.jackrabbit.spi.RepositoryService;
+import org.apache.jackrabbit.spi.RepositoryServiceStub;
+import org.apache.jackrabbit.test.AbstractJCRTest;
-    private static Logger log = LoggerFactory.getLogger(ServiceStubImpl.class);
-
-    /**
-     * Property for the repository name (used for jndi lookup)
-     */
-    public static final String PROP_REPOSITORY_NAME = "org.apache.jackrabbit.spi2jcr.name";
-
-    /**
-     * Property for the repository configuration file (used for repository instantiation)
-     */
-    public static final String PROP_REPOSITORY_CONFIG = "org.apache.jackrabbit.spi2jcr.config";
-
-    /**
-     * Property for the repository home directory (used for repository instantiation)
-     */
-    public static final String PROP_REPOSITORY_HOME = "org.apache.jackrabbit.spi2jcr.home";
-
-    /**
-     * Property for the jaas config path. If the system property
-     * <code>java.security.auth.login.config</code> is not set this repository
-     * stub will try to read this property from the environment and use the
-     * value retrieved as the value for the system property.
-     */
-    public static final String PROP_JAAS_CONFIG = "org.apache.jackrabbit.spi2jcr.jaas.config";
-
-    /**
-     * The name of the jaas config system property.
-     */
-    private static final String SYS_JAAS_CONFIG = "java.security.auth.login.config";
-
-
-            Repository repository;
-            try {
-                String repName = environment.getProperty(PROP_REPOSITORY_NAME);
-                String repConfig = environment.getProperty(PROP_REPOSITORY_CONFIG);
-                String repHome = environment.getProperty(PROP_REPOSITORY_HOME);
-                String jaasConfig = environment.getProperty(PROP_JAAS_CONFIG);
-
-                // set jaas config from stub properties if system property is
-                // not set.
-                if (System.getProperty(SYS_JAAS_CONFIG) == null && jaasConfig != null) {
-                    System.setProperty(SYS_JAAS_CONFIG, jaasConfig);
-                }
-
-                // register repository instance
-                Hashtable env = new Hashtable();
-                env.put(Context.INITIAL_CONTEXT_FACTORY, "org.apache.jackrabbit.core.jndi.provider.DummyInitialContextFactory");
-                env.put(Context.PROVIDER_URL, "localhost");
-                InitialContext ctx = new InitialContext(env);
-                RegistryHelper.registerRepository(ctx, repName, repConfig, repHome, true);
-
-                repository = (Repository) ctx.lookup(repName);
-            } catch (Exception e) {
-                throw new RepositoryException(e.toString());
-            }
+            Repository repository = AbstractJCRTest.helper.getRepository();
