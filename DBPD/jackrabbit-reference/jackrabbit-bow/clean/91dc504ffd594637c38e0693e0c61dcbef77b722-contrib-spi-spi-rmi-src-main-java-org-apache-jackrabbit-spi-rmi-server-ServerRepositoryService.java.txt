JCR-1014: Convert Batch implementation in spi-rmi from remote object into a local one

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@553862 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.spi.rmi.remote.RemoteBatch;
+import org.apache.jackrabbit.spi.Batch;
+import org.apache.jackrabbit.spi.commons.SerializableBatch;
-     * Maps remote stubs to {@link ServerBatch}es.
-     */
-    private final Map activeBatches = Collections.synchronizedMap(new HashMap());
-
-    /**
-            activeSessionInfos.remove(RemoteObject.toStub(sessionInfo));
+            activeSessionInfos.remove(RemoteObject.toStub(sessionInfo));
-    public RemoteBatch createBatch(ItemId itemId,
-                                   RemoteSessionInfo sessionInfo)
+    public void submit(RemoteSessionInfo sessionInfo, SerializableBatch batch)
-            ServerBatch sBatch = new ServerBatch(
-                    service.createBatch(itemId, getSessionInfo(sessionInfo)));
-            activeBatches.put(RemoteObject.toStub(sBatch), sBatch);
-            return sBatch;
+            Batch local = service.createBatch(
+                    batch.getSaveTarget(), getSessionInfo(sessionInfo));
+            batch.replay(local);
+            service.submit(local);
-    public void submit(RemoteBatch batch) throws RepositoryException, RemoteException {
-        ServerBatch sBatch = (ServerBatch) activeBatches.remove(
-                RemoteObject.toStub(batch));
-        if (sBatch != null) {
-            try {
-                service.submit(sBatch.getBatch());
-            } catch (RepositoryException e) {
-                throw getRepositoryException(e);
-            }
-        } else {
-            throw new RepositoryException("Unknown RemoteBatch: " +
-                    ((RemoteObject) batch).getRef());
-        }
-    }
-
-    /**
-     * {@inheritDoc}
-     */
