Move preparation of events out of write lock to prevent possible deadlock situations.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@239609 13f79535-47bb-0310-9956-ffa450edef68

+    /**
+     * Set of <code>ItemId</code>s of denied <code>ItemState</code>s.
+     */
-     * @param denied <code>Set</code> of denied <code>EventState</code>s
+     * @param denied <code>Set</code> of <code>ItemId</code>s of denied <code>ItemState</code>s
-     *               <code>null</code> no <code>EventState</code> is denied.
+     *               <code>null</code> no <code>ItemState</code> is denied.
-            if (denied == null || !denied.contains(state)) {
+            if (denied == null || !denied.contains(state.getId())) {
-                    next = filter.blocks(state) ? null : new EventImpl(filter.getSession(),
-                            /* filter.getItemManager(), */
-                            state);
+                    next = filter.blocks(state) ? null : new EventImpl(filter.getSession(), state);
