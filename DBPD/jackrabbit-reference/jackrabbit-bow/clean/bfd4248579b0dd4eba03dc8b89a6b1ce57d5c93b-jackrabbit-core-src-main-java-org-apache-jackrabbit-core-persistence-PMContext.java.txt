JCR-3117: Stats for the PersistenceManager

Use AtomicLong counters and the TimeSeries mechanism for PM stats

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1186713 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.RepositoryContext;
-import org.apache.jackrabbit.core.stats.PersistenceManagerStatCore;
+import org.apache.jackrabbit.core.stats.RepositoryStatisticsImpl;
-    /**
-     * PersistenceManagerStatCore stats object for the PM.
-     */
-    private PersistenceManagerStatCore persistenceManagerStatCore;
+    /** Repository statistics collector. */
+    private final RepositoryStatisticsImpl stats;
-     * @param rootNodeId id of the root node
-     * @param nsReg        namespace registry
-     * @param ntReg        node type registry
+     * @param context repository component context
-                     NodeId rootNodeId,
-                     NamespaceRegistry nsReg,
-                     NodeTypeRegistry ntReg,
-                     DataStore dataStore) {
+                     RepositoryContext context) {
-        this.rootNodeId = rootNodeId;
-        this.nsReg = nsReg;
-        this.ntReg = ntReg;
-        this.dataStore = dataStore;
+        this.rootNodeId = context.getRootNodeId();
+        this.nsReg = context.getNamespaceRegistry();
+        this.ntReg = context.getNodeTypeRegistry();
+        this.dataStore = context.getDataStore();
+        this.stats = context.getRepositoryStatistics();
+
-     * Returns the PersistenceManagerStatCore stats object for the PM.
-     * 
-     * @return the PersistenceManagerStatCore stats object for the PM.
+     * Returns the repository statistics collector.
+     *
+     * @return repository statistics
-    public PersistenceManagerStatCore getPersistenceManagerStatCore() {
-        return persistenceManagerStatCore;
+    public RepositoryStatisticsImpl getRepositoryStatistics() {
+        return stats;
-    public void setPersistenceManagerStatCore(
-            PersistenceManagerStatCore persistenceManagerStatCore) {
-        this.persistenceManagerStatCore = persistenceManagerStatCore;
-    }
