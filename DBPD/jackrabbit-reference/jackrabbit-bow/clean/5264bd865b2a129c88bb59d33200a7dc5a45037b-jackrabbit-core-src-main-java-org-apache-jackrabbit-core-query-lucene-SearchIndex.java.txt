JCR-3517 double check capability for eliminating false positives due to concurrent updates

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1444515 13f79535-47bb-0310-9956-ffa450edef68

+    List<Document> getNodeDocuments(NodeId id) throws RepositoryException, IOException {
+        final List<Integer> docIds = new ArrayList<Integer>(1);
+        final List<Document> docs = new ArrayList<Document>();
+        final IndexReader reader = getIndexReader();
+        try {
+            IndexSearcher searcher = new IndexSearcher(reader);
+            try {
+                Query q = new TermQuery(new Term(FieldNames.UUID, id.toString()));
+                searcher.search(q, new AbstractHitCollector() {
+                    @Override
+                    protected void collect(final int doc, final float score) {
+                        docIds.add(doc);
+                    }
+                });
+                for (Integer docId : docIds) {
+                    docs.add(reader.document(docId, FieldSelectors.UUID_AND_PARENT));
+                }
+            } finally {
+                searcher.close();
+            }
+        } finally {
+            Util.closeOrRelease(reader);
+        }
+        return docs;
+    }
+
