JCR-2028: JSR 283 JCR Path

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@772659 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.value.ValueFactoryImpl;
+import org.apache.jackrabbit.spi.commons.value.ValueFormat;
+import javax.jcr.ValueFactory;
+    private final ValueFactory valueFactory;
-    protected BufferedStringValue(NamePathResolver nsContext) {
+    protected BufferedStringValue(NamePathResolver nsContext, ValueFactory valueFactory) {
+        this.valueFactory = valueFactory;
-                            retrieve(), targetType, ValueFactoryImpl.getInstance()), nsContext);
+                            retrieve(), targetType, valueFactory), nsContext);
-                return ival.toJCRValue(resolver);
+                return ValueFormat.getJCRValue(ival, resolver, valueFactory);
-                    return ValueHelper.deserialize(retrieve(), targetType, false, ValueFactoryImpl.getInstance());
+                    return ValueHelper.deserialize(retrieve(), targetType, false, valueFactory);
-                        return ValueHelper.deserialize(reader, targetType, false, ValueFactoryImpl.getInstance());
+                        return ValueHelper.deserialize(reader, targetType, false, valueFactory);
-                return ValueHelper.deserialize(retrieveString(), targetType, false, ValueFactoryImpl.getInstance());
+                return ValueHelper.deserialize(retrieveString(), targetType, false, valueFactory);
-                        retrieveString(), type, ValueFactoryImpl.getInstance()), nsContext);
+                        retrieveString(), type, valueFactory), nsContext);
