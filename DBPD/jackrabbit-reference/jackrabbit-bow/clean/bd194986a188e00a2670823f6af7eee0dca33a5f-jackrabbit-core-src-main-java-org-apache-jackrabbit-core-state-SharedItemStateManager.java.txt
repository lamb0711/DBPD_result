JCR-780 - Simultaneous updates by multiple sessions might not appear in the journal


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@516324 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashMap;
-    class Update {
+    class Update implements org.apache.jackrabbit.core.cluster.Update {
+         * Map of attributes stored for this update operation.
+         */
+        private HashMap attributes;
+
+        /**
-                eventChannel.updateCreated();
+                eventChannel.updateCreated(this);
-                    eventChannel.updateCancelled();
+                    eventChannel.updateCancelled(this);
-                    eventChannel.updatePrepared(local, events);
+                    eventChannel.updatePrepared(this);
-                    eventChannel.updateCommitted();
+                    eventChannel.updateCommitted(this);
-                    eventChannel.updateCancelled();
+                    eventChannel.updateCancelled(this);
+
+        /**
+         * {@inheritDoc}
+         */
+        public void setAttribute(String name, Object value) {
+            if (attributes == null) {
+                attributes = new HashMap();
+            }
+            attributes.put(name, value);
+        }
+
+        /**
+         * {@inheritDoc}
+         */
+        public Object getAttribute(String name) {
+            if (attributes != null) {
+                return attributes.get(name);
+            }
+            return null;
+        }
+
+        /**
+         * {@inheritDoc}
+         */
+        public ChangeLog getChanges() {
+            return local;
+        }
+
+        /**
+         * {@inheritDoc}
+         */
+        public EventStateCollection getEvents() {
+            return events;
+        }
