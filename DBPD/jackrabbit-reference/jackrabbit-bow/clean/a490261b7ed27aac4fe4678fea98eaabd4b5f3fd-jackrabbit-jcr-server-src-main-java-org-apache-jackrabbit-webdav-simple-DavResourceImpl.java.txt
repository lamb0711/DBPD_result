JCR-3078 - Add CopyMoveHanlder so that the copy/move behavior can be customized (as this is the case for the IOHandler and PropertyHandler)


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1173533 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.server.io.CopyMoveContextImpl;
-import javax.jcr.PathNotFoundException;
-        try {
-            String destItemPath = destination.getLocator().getRepositoryPath();
-            getJcrSession().getWorkspace().move(locator.getRepositoryPath(), destItemPath);
-        } catch (RepositoryException e) {
-            throw new JcrDavException(e);
+        if (!config.getCopyMoveManager().move(new CopyMoveContextImpl(getJcrSession()), this, destination)) {
+            throw new DavException(DavServletResponse.SC_UNSUPPORTED_MEDIA_TYPE);
-        if (shallow && isCollection()) {
-            // TODO: currently no support for shallow copy; however this is
-            // only relevant if the source resource is a collection, because
-            // otherwise it doesn't make a difference
-            throw new DavException(DavServletResponse.SC_FORBIDDEN, "Unable to perform shallow copy.");
-        }
-        try {
-            String destItemPath = destination.getLocator().getRepositoryPath();
-            getJcrSession().getWorkspace().copy(locator.getRepositoryPath(), destItemPath);
-        } catch (PathNotFoundException e) {
-            // according to rfc 2518: missing parent
-            throw new DavException(DavServletResponse.SC_CONFLICT, e.getMessage());
-        } catch (RepositoryException e) {
-            throw new JcrDavException(e);
+        if (!config.getCopyMoveManager().copy(new CopyMoveContextImpl(getJcrSession(), shallow), this, destination)) {
+            throw new DavException(DavServletResponse.SC_UNSUPPORTED_MEDIA_TYPE);
