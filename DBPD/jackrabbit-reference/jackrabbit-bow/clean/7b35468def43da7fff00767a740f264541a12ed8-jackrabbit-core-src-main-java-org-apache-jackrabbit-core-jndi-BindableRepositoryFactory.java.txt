JCR-1778: BindableRepositoryFactory doesn't handle repository shutdown

Fix based on the patch by Ren√© Link

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@933694 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.commons.collections.map.ReferenceMap;
+import java.util.Hashtable;
+import java.util.Map;
-import java.util.Hashtable;
-import java.util.Map;
+
+import org.apache.commons.collections.map.ReferenceMap;
-    public synchronized Object getObjectInstance(
+    public Object getObjectInstance(
+
+    /**
+     * Invalidates the given reference in this factory's cache. Called by
+     * {@link BindableRepository#shutdown()} to remove the old reference.
+     *
+     * @param reference repository reference
+     */
+    static void removeReference(Reference reference) {
+        synchronized (cache) {
+            cache.remove(reference);
+        }
+    }
+
