- Extended observation test cases
- fixed observation bug that caused ItemStateException in case a property is removed and added again with the same name

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@156039 13f79535-47bb-0310-9956-ffa450edef68

-     * The HierarchyManager of the session that creates the events.
-     */
-    private final HierarchyManager hmgr;
-
-    /**
-                         SessionImpl session,
-                         HierarchyManager hmgr) {
+                         SessionImpl session) {
-        this.hmgr = hmgr;
+     * @param rootNodeUUID the UUID of the root node.
-    public void createEventStates(ChangeLog changes, ItemStateManager provider) throws ItemStateException {
+    public void createEventStates(String rootNodeUUID, ChangeLog changes, ItemStateManager provider) throws ItemStateException {
+        // create a hierarchy manager, that is based on the ChangeLog and
+        // the ItemStateProvider
+        // todo use CachingHierarchyManager ?
+        HierarchyManager hmgr = new ChangeLogBasedHierarchyMgr(rootNodeUUID, provider, changes, session.getNamespaceResolver());
+
