JCR-2104: JSR 283 Full Versioning
- checkpoint must be aware of current activity for the checkout part
- minor improvements such as @Override annotations, removal of unused params, methods, use generics whereever possible



git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@918491 13f79535-47bb-0310-9956-ffa450edef68

-            NodeEntry newVersion = session.getVersionStateManager().checkpoint(getNodeState());
+            NodeEntry newVersion;
+            if (session.isSupportedOption(Repository.OPTION_ACTIVITIES_SUPPORTED)) {
+                NodeImpl activity = (NodeImpl) session.getWorkspace().getVersionManager().getActivity();
+                NodeId activityId = (activity == null) ? null : activity.getNodeState().getNodeId();
+                newVersion = session.getVersionStateManager().checkpoint(getNodeState(), activityId);
+            } else {
+                newVersion = session.getVersionStateManager().checkpoint(getNodeState());
+            }
-        Name[] mixins = getNodeState().getMixinTypeNames();
-        for (int i = 0; i < mixins.length; i++) {
-            if (mixins[i].equals(qName)) {
+        for (Name mixin : getNodeState().getMixinTypeNames()) {
+            if (mixin.equals(qName)) {
-     * Create a new multivalue property
+     * Create a new multi valued property
-                    for (int i = 0; i < values.length; i++) {
-                        if (values[i] != null) {
-                            targetType = values[i].getType();
+                    for (Value value : values) {
+                        if (value != null) {
+                            targetType = value.getType();
