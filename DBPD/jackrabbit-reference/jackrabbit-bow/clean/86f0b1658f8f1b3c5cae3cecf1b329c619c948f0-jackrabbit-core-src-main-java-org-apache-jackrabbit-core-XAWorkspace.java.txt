JCR-2640: Internal repository context

Streamline WorkspaceImpl creation with the new WorkspaceManager class.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@948857 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.RepositoryException;
+
-import org.apache.jackrabbit.core.state.SharedItemStateManager;
-import org.apache.jackrabbit.core.state.XAItemStateManager;
+import org.apache.jackrabbit.core.state.XAItemStateManager;
-     * @param stateMgr  The shared item state manager
-            WorkspaceConfig wspConfig, SharedItemStateManager stateMgr,
-            RepositoryContext repositoryContext, SessionImpl session) {
-        super(wspConfig, stateMgr, repositoryContext, session);
+            WorkspaceConfig wspConfig, RepositoryContext repositoryContext,
+            SessionImpl session) throws RepositoryException {
+        super(wspConfig, repositoryContext, session);
-    /**
-     * {@inheritDoc}
-     */
-    protected LocalItemStateManager createItemStateManager(SharedItemStateManager shared) {
-        return XAItemStateManager.createInstance(shared, this, null, rep.getItemStateCacheFactory());
+    @Override
+    protected LocalItemStateManager createItemStateManager()
+            throws RepositoryException {
+        return XAItemStateManager.createInstance(
+                getSharedItemStateManager(), this, null,
+                rep.getItemStateCacheFactory());
