work in progress

- resolve some TODOs
- replace // JR DIFF comments
- remove unused/unimplemented validation methods from NodeTypeRegistry, that should
  be implemented on serverside
- Validation of NodeTypeDefinition: check if autocreated props defined default-value
  is not required on the client-side.
- LockManagerImpl: be prepared for observation not being supported by spi.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@479569 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.UnsupportedRepositoryOperationException;
+
-        private final EventFilter eventFilter;
+        private EventFilter eventFilter;
-            // TODO: TOBEFIXED...SPI may not support observation
-            // register as internal listener to the wsp manager in order to get
-            // informed if this lock ends his life.
-            eventFilter = wspManager.createEventFilter(Event.PROPERTY_REMOVED,
+            try {
+                // register as internal listener to the wsp manager in order to get
+                // informed if this lock ends his life.
+                eventFilter = wspManager.createEventFilter(Event.PROPERTY_REMOVED,
-            wspManager.addEventListener(this);
+                wspManager.addEventListener(this);
+            } catch (UnsupportedRepositoryOperationException e) {
+                eventFilter = null;
+            }
-            return Collections.singletonList(eventFilter);
+            return (eventFilter == null) ?  Collections.EMPTY_LIST : Collections.singletonList(eventFilter);
-
-            // store lock in the map
-            lockMap.put(lockState.lockHoldingState, this);
+            // if observation is supported -> store lock in the map
+            if (lockState.eventFilter != null) {
+                lockMap.put(lockState.lockHoldingState, this);
+            }
