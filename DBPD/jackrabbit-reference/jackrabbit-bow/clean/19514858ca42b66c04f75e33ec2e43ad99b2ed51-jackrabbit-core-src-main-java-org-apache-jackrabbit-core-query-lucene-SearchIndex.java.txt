JCR-967: Only search the index for the "jcr:system" tree if needed

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@550419 13f79535-47bb-0310-9956-ffa450edef68

-        IndexReader reader = getIndexReader();
+        IndexReader reader = getIndexReader(queryImpl.needsSystemTree());
+        return getIndexReader(true);
+    }
+
+    /**
+     * Returns an index reader for this search index. The caller of this method
+     * is responsible for closing the index reader when he is finished using
+     * it.
+     *
+     * @param includeSystemIndex if <code>true</code> the index reader will
+     *                           cover the complete workspace. If
+     *                           <code>false</code> the returned index reader
+     *                           will not contains any nodes under /jcr:system.
+     * @return an index reader for this search index.
+     * @throws IOException the index reader cannot be obtained.
+     */
+    protected IndexReader getIndexReader(boolean includeSystemIndex)
+            throws IOException {
-        if (parentHandler instanceof SearchIndex) {
+        if (parentHandler instanceof SearchIndex && includeSystemIndex) {
