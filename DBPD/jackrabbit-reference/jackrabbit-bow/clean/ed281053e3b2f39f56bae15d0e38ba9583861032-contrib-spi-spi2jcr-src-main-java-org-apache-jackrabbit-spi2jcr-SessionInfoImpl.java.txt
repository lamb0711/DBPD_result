JCR-1157 : Expose namespace registry via workspace instead via session in spi2jcr. (Apply patch provided by michael duerig)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@582276 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.name.SessionNamespaceResolver;
+import org.apache.jackrabbit.name.AbstractNamespaceResolver;
+import javax.jcr.NamespaceException;
+import javax.jcr.NamespaceRegistry;
+     * @throws RepositoryException 
-    SessionInfoImpl(Session session, Credentials credentials) {
+    SessionInfoImpl(Session session, Credentials credentials) throws RepositoryException {
-        this.resolver = new SessionNamespaceResolver(session);
+        
+        final NamespaceRegistry nsReg = session.getWorkspace().getNamespaceRegistry();
+       
+        this.resolver = new AbstractNamespaceResolver() {
+            public String getPrefix(String uri) throws NamespaceException {
+                try {
+                    return nsReg.getPrefix(uri);
+                }
+                catch (RepositoryException e) {
+                    // should never get here...
+                    throw new NamespaceException("internal error: failed to resolve namespace uri", e);
+                }
+            }
+
+            public String getURI(String prefix) throws NamespaceException {
+                try {
+                    return nsReg.getURI(prefix);
+                }
+                catch (RepositoryException e) {
+                    // should never get here...
+                    throw new NamespaceException("internal error: failed to resolve namespace prefix", e);
+                }
+            }
+        };
+        
