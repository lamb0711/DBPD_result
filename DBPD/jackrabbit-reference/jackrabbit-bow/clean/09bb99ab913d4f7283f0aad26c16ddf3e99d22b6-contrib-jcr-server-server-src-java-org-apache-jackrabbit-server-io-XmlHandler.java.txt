- ExportContxtImpl: check for null property values when spooling export properties.
- XmlHandler: set content type manually if default handler could not retrieve the jcr:mimetype property
- IOUtil: don't add charset if mimetype is null.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@374706 13f79535-47bb-0310-9956-ffa450edef68

-     * @see DefaultHandler#exportProperties(ExportContext, boolean, Node)
+     * @see DefaultHandler#exportData(ExportContext, boolean, Node)
+
+    /**
+     * @see DefaultHandler#exportProperties(ExportContext, boolean, Node)
+     */
+    protected void exportProperties(ExportContext context, boolean isCollection, Node contentNode) throws IOException {
+        super.exportProperties(context, isCollection, contentNode);
+        // set mimetype if the content node did not provide the
+        // jcr property (thus not handled by super class)
+        try {
+            if (!contentNode.hasProperty(JcrConstants.JCR_MIMETYPE)) {
+                context.setContentType("text/xml", "UTF-8");
+            }
+        } catch (RepositoryException e) {
+            // should never occur
+            throw new IOException(e.getMessage());
+        }
+    }
