JCR-1459: NullPointerException on startup if IndexingQueue has pending nodes

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@634632 13f79535-47bb-0310-9956-ffa450edef68

+     * Flag that indicates whether this indexing queue had been
+     * {@link #initialize(MultiIndex) initialized}.
+     */
+    private volatile boolean initialized = false;
+
+    /**
-    IndexingQueue(IndexingQueueStore queueStore, MultiIndex index) {
+    IndexingQueue(IndexingQueueStore queueStore) {
+    }
+
+    /**
+     * Initializes the indexing queue.
+     *
+     * @param index the multi index this indexing queue belongs to.
+     */
+    void initialize(MultiIndex index) {
+        if (initialized) {
+            throw new IllegalStateException("already initialized");
+        }
+        initialized = true;
+        checkInitialized();
+        checkInitialized();
+        checkInitialized();
+        checkInitialized();
+        checkInitialized();
+
+    /**
+     * Checks if this indexing queue is initialized and otherwise throws a
+     * {@link IllegalStateException}.
+     */
+    private void checkInitialized() {
+        if (!initialized) {
+            throw new IllegalStateException("not initialized");
+        }
+    }
