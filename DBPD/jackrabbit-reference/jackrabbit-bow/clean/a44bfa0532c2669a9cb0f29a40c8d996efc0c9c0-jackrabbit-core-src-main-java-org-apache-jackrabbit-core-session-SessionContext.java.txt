JCR-2741: Improved logging for session operations

Add a unique internal name for sessions.
Set this name as the "jcr.session" MDC variable during SessionOperations.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@994951 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.test.api.util.Text;
+     * Session counter. Used to generate unique internal session names.
+     */
+    private static long counter = 0;
+
+    /**
+     * Creates a unique internal session name for a session with the
+     * given user.
+     *
+     * @param userId session user, or <code>null</code>
+     * @return session name
+     */
+    private static synchronized String createSessionName(String userId) {
+        if (userId != null) {
+            String user = Text.escapeIllegalJcrChars(userId);
+            return "session-" + user + "-" + counter++;
+        } else {
+            return "session-" + counter++;
+        }
+    }
+
+    /**
+     * Unique internal name of this session. Returned by the
+     * {@link #toString()} method for use in logging and debugging.
+     */
+    private final String sessionName;
+
+    /**
+        this.sessionName = createSessionName(session.getUserID());
+    //--------------------------------------------------------------< Object >
+
+    /**
+     * Returns the unique internal name of this session. The returned name
+     * is especially useful for debugging and logging purposes.
+     *
+     * @see #sessionName
+     * @return session name
+     */
+    @Override
+    public String toString() {
+        return sessionName;
+    }
+
