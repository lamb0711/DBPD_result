JCR-2640: Internal repository context

Use the RepositoryContext to track the ItemStateCacheFactory instance.
Remove the RepositoryImpl member variables from SessionImpl and WorkspaceImpl.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@948874 13f79535-47bb-0310-9956-ffa450edef68

-     * The repository that created this workspace instance
-     */
-    protected final RepositoryImpl rep;
-
-    /**
-        this.rep = repositoryContext.getRepository();
-            tmpSession = rep.createSession(session.getSubject(), name);
+            tmpSession = repositoryContext.getWorkspaceManager().createSession(
+                    session.getSubject(), name);
-        rep.getWorkspaceInfo(name);
+        repositoryContext.getRepository().getWorkspaceInfo(name);
-            lockMgr = rep.getLockManager(wspConfig.getName());
+            lockMgr = repositoryContext.getRepository().getLockManager(
+                    wspConfig.getName());
-            retentionRegistry = rep.getRetentionRegistry(wspConfig.getName());
+            retentionRegistry =
+                repositoryContext.getRepository().getRetentionRegistry(wspConfig.getName());
-            srcSession = rep.createSession(session.getSubject(), srcWorkspace);
+            srcSession = repositoryContext.getWorkspaceManager().createSession(
+                    session.getSubject(), srcWorkspace);
-            srcSession = rep.createSession(session.getSubject(), srcWorkspace);
+            srcSession = repositoryContext.getWorkspaceManager().createSession(
+                    session.getSubject(), srcWorkspace);
-                        rep.getObservationDispatcher(wspConfig.getName()),
+                        repositoryContext.getRepository().getObservationDispatcher(wspConfig.getName()),
-                searchManager = rep.getSearchManager(wspConfig.getName());
+                searchManager = repositoryContext.getRepository().getSearchManager(wspConfig.getName());
-                getSharedItemStateManager(), this, rep.getItemStateCacheFactory());
+                getSharedItemStateManager(), this,
+                repositoryContext.getItemStateCacheFactory());
