JCR-4018: Consistent Async Upload Executor handling in Backend implementations

Slightly modified patch from Woonsan Ko

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1760825 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.data.AbstractBackend;
-import org.apache.jackrabbit.core.data.Backend;
-public class S3Backend implements Backend {
+public class S3Backend extends AbstractBackend {
-    private CachingDataStore store;
-
-    
-    private ThreadPoolExecutor asyncWriteExecuter;
+        super.init(store, homeDir, config);
-            this.store = store;
+            setDataStore(store);
-            
-            asyncWriteExecuter = (ThreadPoolExecutor) Executors.newFixedThreadPool(
-                asyncWritePoolSize, new NamedThreadFactory("s3-write-worker"));
+            setAsyncWritePoolSize(asyncWritePoolSize);
-        asyncWriteExecuter.execute(new AsyncUploadJob(identifier, file,
+        getAsyncWriteExecutor().execute(new AsyncUploadJob(identifier, file,
-            asyncWriteExecuter.execute(new Runnable() {
+            getAsyncWriteExecutor().execute(new Runnable() {
-                        && store.confirmDelete(identifier)
+                        && getDataStore().confirmDelete(identifier)
-                        store.deleteFromCache(identifier);
+                        getDataStore().deleteFromCache(identifier);
-    public void close() {
+    public void close() throws DataStoreException {
+        super.close();
-        asyncWriteExecuter.shutdownNow();
