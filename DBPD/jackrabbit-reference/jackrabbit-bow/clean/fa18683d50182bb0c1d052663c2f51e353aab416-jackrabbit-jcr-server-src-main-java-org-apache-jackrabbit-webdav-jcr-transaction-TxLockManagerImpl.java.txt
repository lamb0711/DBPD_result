Work in progress
- Removed is-local flag from event bundle response and added transaction id which is equal to the lock token that was used to save changes.
- Added TransactionListener. SubscriptionManagerImpl now listens on the TxLockManagerImpl for transaction commits and registers special EventListeners for a short period of time to associate the lockToken / transactionId with an event bundle.
- Remove SubscriptionImpl as event listener when subscription expires
- Update currentVersion to 1.2-SNAPSHOT

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@482627 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.commons.collections.set.MapBackedSet;
+import java.util.Set;
+import java.util.IdentityHashMap;
+    private Set listeners = MapBackedSet.decorate(new IdentityHashMap());
+
-                tx.commit(resource);
+                TransactionListener[] txListeners;
+                synchronized (listeners) {
+                    txListeners = (TransactionListener[]) listeners.toArray(new TransactionListener[0]);
+                }
+                for (int i = 0; i < txListeners.length; i++) {
+                    txListeners[i].beforeCommit(resource, lockToken);
+                }
+                DavException ex = null;
+                try {
+                    tx.commit(resource);
+                } catch (DavException e) {
+                    ex = e;
+                }
+                for (int i = 0; i < txListeners.length; i++) {
+                    txListeners[i].afterCommit(resource, lockToken, ex == null);
+                }
+                if (ex != null) {
+                    throw ex;
+                }
+    //-----------------------------< listener support >-------------------------
+
+    /**
+     * Adds a transaction listener to this <code>TxLockManager</code>.
+     * @param listener the listener to add.
+     */
+    public void addTransactionListener(TransactionListener listener) {
+        synchronized (listeners) {
+            listeners.add(listener);
+        }
+    }
+
+    /**
+     * Removes a transaction listener from this <code>TxLockManager</code>.
+     * @param listener the listener to remove.
+     */
+    public void removeTransactionListener(TransactionListener listener) {
+        synchronized (listeners) {
+            listeners.remove(listener);
+        }
+    }
+
