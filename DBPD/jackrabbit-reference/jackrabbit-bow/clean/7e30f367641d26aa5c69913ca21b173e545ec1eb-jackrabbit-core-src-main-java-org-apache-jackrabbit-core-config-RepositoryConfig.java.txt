JCR-2555: Improved reusability of the JCA package

More robust handling of default configuration

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@923693 13f79535-47bb-0310-9956-ffa450edef68

+import java.net.URL;
-        ClassLoader loader = RepositoryImpl.class.getClassLoader();
-        String resource = REPOSITORY_XML;
+        URL resource = RepositoryImpl.class.getResource(REPOSITORY_XML);
-            loader = Thread.currentThread().getContextClassLoader();
-            resource = conf.substring("classpath:".length());
+            ClassLoader loader = Thread.currentThread().getContextClassLoader();
+            if (loader == null) {
+                loader = RepositoryImpl.class.getClassLoader();
+            }
+            resource = loader.getResource(conf.substring("classpath:".length()));
-        installRepositorySkeleton(dir, xml, loader, resource);
+        installRepositorySkeleton(dir, xml, resource);
-                dir, xml,
-                RepositoryImpl.class.getClassLoader(),
-                "org/apache/jackrabbit/core/" + REPOSITORY_XML);
+                dir, xml, RepositoryImpl.class.getResource(REPOSITORY_XML));
-            File dir, File xml, ClassLoader loader, String resource)
+            File dir, File xml, URL resource)
-            log.info("Installing default repository configuration to {}", xml);
+            log.info("Copying configuration from {} to {}", resource, xml);
-                InputStream input = loader.getResourceAsStream(resource);
+                InputStream input = resource.openStream();
