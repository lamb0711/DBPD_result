- Redesigned observation to also include workspace modifications
- Extended observation tests and moved them into the api.observation package

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@155583 13f79535-47bb-0310-9956-ffa450edef68

-     * @throws RepositoryException if an error occurs while checking access
-     *                             rights on the {@link EventStateCollection}.
-    void prepareEvents(EventStateCollection events) throws RepositoryException {
+    void prepareEvents(EventStateCollection events) {
-                    targetId = new PropertyId(state.getParentUUID(), state.getChildRelPath().getElements()[0].getName());
+                    targetId = new PropertyId(state.getParentUUID(), state.getChildRelPath().getName());
-                if (!session.getAccessManager().isGranted(targetId, AccessManager.READ)) {
+                boolean granted = false;
+                try {
+                    granted = session.getAccessManager().isGranted(targetId, AccessManager.READ);
+                } catch (RepositoryException e) {
+                    log.warn("Unable to check access rights for item: " + targetId);
+                }
+                if (!granted) {
-                    targetId = new PropertyId(state.getParentUUID(), state.getChildRelPath().getElements()[0].getName());
+                    targetId = new PropertyId(state.getParentUUID(), state.getChildRelPath().getName());
