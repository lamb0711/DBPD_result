JCR-3367 implement InMemBundlePM#getAllNodeIds correctly

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1355402 13f79535-47bb-0310-9956-ffa450edef68

-        bundleStore = new HashMap<NodeId, byte[]>(initialCapacity, loadFactor);
+        bundleStore = new LinkedHashMap<NodeId, byte[]>(initialCapacity, loadFactor);
-        // ignore after and count parameters.
-        List<NodeId> result = new ArrayList<NodeId>();
-        result.addAll(bundleStore.keySet());
+        final List<NodeId> result = new ArrayList<NodeId>();
+        boolean add = after == null;
+        int count = 0;
+        for (NodeId nodeId : bundleStore.keySet()) {
+            if (add) {
+                result.add(nodeId);
+                if (++count == maxCount) {
+                    break;
+                }
+            } else {
+                add = nodeId.equals(after);
+            }
+        }
