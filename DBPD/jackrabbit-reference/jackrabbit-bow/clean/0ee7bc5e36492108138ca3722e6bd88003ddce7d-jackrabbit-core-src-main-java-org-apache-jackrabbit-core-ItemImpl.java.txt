JCR-2456 Repository is corrupt after concurrent changes with the same session

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@900453 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.ConcurrentModificationException;
-                    if (!nodeState.hasChildNodeEntry(cnd.getName())) {                      
+                    if (!nodeState.hasChildNodeEntry(cnd.getName())) {
-            Collection<ItemState> dirty = getTransientStates();
+            Collection<ItemState> dirty;
+            try {
+                dirty = getTransientStates();
+            } catch (ConcurrentModificationException e) {
+                String msg = "Concurrent modification; session is closed";
+                log.error(msg, e);
+                session.logout();
+                throw e;
+            }
