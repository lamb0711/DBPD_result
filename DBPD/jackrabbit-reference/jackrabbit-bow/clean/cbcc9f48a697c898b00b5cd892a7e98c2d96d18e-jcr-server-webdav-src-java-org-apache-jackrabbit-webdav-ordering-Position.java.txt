- DAV:after, DAV:before must contain the segment within a separate DAV:segment element (wrong serialization of Position).
- Position retrieved from xml is never returned.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@397818 13f79535-47bb-0310-9956-ffa450edef68

-        Element pos = DomUtil.createElement(document, XML_POSITION, NAMESPACE);
-        DomUtil.addChildElement(pos, type, NAMESPACE, segment);
-        return pos;
+        Element positionElement = DomUtil.createElement(document, XML_POSITION, NAMESPACE);
+        Element typeElement = DomUtil.addChildElement(positionElement, type, NAMESPACE);
+        if (segment != null) {
+            DomUtil.addChildElement(typeElement, XML_SEGMENT, NAMESPACE, segment);
+        }
+        return positionElement;
-        while (it.hasNext()) {
+        if (it.hasNext()) {
-            new Position(type, segmentText);
+            return new Position(type, segmentText);
+        } else {
+            throw new IllegalArgumentException("The 'DAV:position' element required with exact one child indicating the type.");
-        throw new IllegalArgumentException("The 'DAV:position' element required with exact one child indicating the type.");
