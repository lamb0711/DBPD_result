JCR-1216 Unreferenced sessions should get garbage collected

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@752831 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Map;
-import java.util.Set;
-import javax.jcr.Repository;
+import org.apache.commons.collections.map.ReferenceMap;
-     * Buffer size for copying the default repository configuration file.
-     */
-    private static final int BUFFER_SIZE = 4096;
-
-    /**
-    private final Set sessions;
+    private final Map sessions = new ReferenceMap(ReferenceMap.WEAK, ReferenceMap.WEAK);
-        this.sessions = new HashSet();
-            Session session = repository.login(credentials, workspaceName);
-            sessions.add(session);
-            ((SessionImpl) session).addListener(this);
+            SessionImpl session = (SessionImpl) repository.login(credentials, workspaceName);
+            sessions.put(session, session);
+            session.addListener(this);
-        Iterator iterator = new HashSet(sessions).iterator();
+        Iterator iterator = new HashSet(sessions.keySet()).iterator();
-        assert sessions.contains(session);
+        assert sessions.containsKey(session);
