work in progress

- more todos
- revert tmp status 'modified' immediately after notifying overlaying state.
- setStatus: delegate validation to Status

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@462717 13f79535-47bb-0310-9956-ffa450edef68

-
-        if (isWorkspaceState()) {
-            switch (newStatus) {
-                case Status.EXISTING:
-                case Status.MODIFIED:
-                case Status.REMOVED:
-                    status = newStatus;
-                    break;
-
-                case Status.NEW:
-                case Status.EXISTING_REMOVED:
-                case Status.EXISTING_MODIFIED:
-                case Status.STALE_MODIFIED:
-                case Status.STALE_DESTROYED:
-                default:
-                    String msg = "Illegal status " + newStatus + " for 'workspace' state.";
-                    log.debug(msg);
-                    throw new IllegalArgumentException(msg);
-            }
+        if (Status.isValidStatusChange(oldStatus, newStatus, isWorkspaceState)) {
+            status = newStatus;
-            switch (newStatus) {
-                case Status.NEW:
-                case Status.EXISTING:
-                case Status.EXISTING_REMOVED:
-                case Status.EXISTING_MODIFIED:
-                case Status.STALE_MODIFIED:
-                case Status.STALE_DESTROYED:
-                case Status.REMOVED:
-                    status = newStatus;
-                    break;
-
-                case Status.MODIFIED:
-                default:
-                    String msg = "Illegal status " + newStatus + " for 'session' state.";
-                    log.debug(msg);
-                    throw new IllegalArgumentException(msg);
-            }
+            throw new IllegalArgumentException("Invalid new status " + newStatus + " for state with status " + oldStatus);
-
+        if (status == Status.MODIFIED) {
+            // change back tmp MODIFIED status, that is used only to have a marker
+            // to inform the overlaying state, that it needs to synchronize with
+            // its overlayed state again
+            // TODO: improve...
+            status = Status.EXISTING;
+        }
-                    // change back // TODO: improve...
-                    state.status = Status.EXISTING;
-                } else {
-                    // ILLEGAL
-                    throw new IllegalArgumentException();
