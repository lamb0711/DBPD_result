JCR-3319 Improve performance of repository updates - tweak index 'deletes' creation

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1350552 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Collection;
-    private final BitSet deleted;
+    private BitSet deleted;
-        int maxDoc = reader.maxDoc();
-        for (int i = 0; i < maxDoc; i++) {
-            if (reader.isDeleted(i)) {
-                deleted.set(i);
+        Collection<Integer> deletes = reader.getDeletedSince(deletedDocsVersion);
+        if (deletes == null) {
+            // full update needed
+            this.deleted = reader.getDeletedDocs();
+        } else {
+            // incremental update
+            for (Integer d : deletes) {
+                deleted.set(d);
