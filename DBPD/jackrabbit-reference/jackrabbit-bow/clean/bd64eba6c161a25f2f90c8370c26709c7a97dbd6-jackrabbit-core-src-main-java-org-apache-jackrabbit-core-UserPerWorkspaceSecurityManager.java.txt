JCR-3826: AbstractPrincipalProvider cachesize is not configurable

LoginModule configurations without an explicit principal provider class name will now be applied to the DefaultPrincipalProvider.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1634584 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.config.LoginModuleConfig;
+import org.apache.jackrabbit.core.security.authentication.AuthContextProvider;
+import org.apache.jackrabbit.core.security.principal.AbstractPrincipalProvider;
+                Properties[] moduleConfig = new AuthContextProvider("", ((RepositoryImpl) getRepository()).getConfig().getSecurityConfig().getLoginModuleConfig()).getModuleConfig();
+
-                defaultPP.init(new Properties());
+
+                boolean initialized = false;
+                for (Properties props : moduleConfig) {
+                    //GRANITE-4470: apply config to DefaultPrincipalProvider if there is no explicit PrincipalProvider configured
+                    if (!props.containsKey(LoginModuleConfig.PARAM_PRINCIPAL_PROVIDER_CLASS) && props.containsKey(AbstractPrincipalProvider.MAXSIZE_KEY)) {
+                        defaultPP.init(props);
+                        initialized = true;
+                        break;
+                    }
+                }
+                if (!initialized) {
+                    defaultPP.init(new Properties());
+                }
-    protected PrincipalProvider createDefaultPrincipalProvider() throws RepositoryException {
+    protected PrincipalProvider createDefaultPrincipalProvider(Properties[] moduleConfig) throws RepositoryException {
