JCR-623 Clustering


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@473380 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.uuid.Constants;
+import org.apache.jackrabbit.uuid.UUID;
-import java.io.File;
-import java.io.RandomAccessFile;
-import java.io.InputStream;
- * Defines methods to read members out of a file record.
+ * Allows reading data from a <code>FileRecord</code>.
-    public FileRecordInput(InputStream in, NamespaceResolver resolver) {
-        this.in = new DataInputStream(in);
+    public FileRecordInput(DataInputStream in, NamespaceResolver resolver) {
+        this.in = in;
-        byte b = readByte();
-        if (b == FileRecord.UUID_INDEX) {
+        byte uuidType = readByte();
+        if (uuidType == FileRecord.UUID_INDEX) {
-        } else if (b == FileRecord.UUID_LITERAL) {
-            NodeId nodeId = NodeId.valueOf(readString());
+        } else if (uuidType == FileRecord.UUID_LITERAL) {
+            byte[] b = new byte[Constants.UUID_BYTE_LENGTH];
+            in.readFully(b);
+            NodeId nodeId = new NodeId(new UUID(b));
-            String msg = "UUID indicator unknown: " + b;
+            String msg = "UUID type unknown: " + uuidType;
-     * Close this input.
-     *
-     * @throws IOException if an I/O error occurs
+     * Close this input. Does not close underlying stream as this is a shared resource.
-    public void close() throws IOException {
+    public void close() {
-        try {
-            in.close();
-        } finally {
-            closed = true;
-        }
+        closed = true;
