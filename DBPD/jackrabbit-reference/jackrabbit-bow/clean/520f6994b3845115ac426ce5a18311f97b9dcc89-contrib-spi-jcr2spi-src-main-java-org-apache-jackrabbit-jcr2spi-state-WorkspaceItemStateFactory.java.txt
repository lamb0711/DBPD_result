work in progress.

- nodestates must always be connected to their cne upon creation
  TODO: add some sort of caching to avoid traffic overhead
- add TODO for refresh, that currently doesn't work properly
- ItemState.refresh only takes changelog and returns the ids of the
  processed states. cleanup of events is left to caller.
- move of NodeStates does not work
- PathResolver: force start to be an NodeState
- all MODIFIED status for SessionStates as well in order to make sure
  that listeners are informed about external changes even if the 
  state is EXISTING.

next TODO: make sure, that public getChildNodeEntry/ies and hasChildNodeEntry check for validity of the connected NodeState. don't return entries, where the nodestate is (transiently) removed or stale.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@472818 13f79535-47bb-0310-9956-ffa450edef68

-            return createNodeState(service.getRootId(sessionInfo), ism);
+            NodeInfo info = service.getNodeInfo(sessionInfo, service.getRootId(sessionInfo));
+            return createNodeState(info, null);
-
-            // get parent
-            NodeId parentId = (info.getParentId() != null) ? info.getParentId() : null;
-            NodeState parent = (parentId != null) ? (NodeState) ism.getItemState(parentId) : null;
-
-            if (parent != null) {
-                return parent.getChildNodeEntry(info.getQName(), info.getIndex()).getNodeState();
+            NodeId parentId = info.getParentId();
+            if (parentId != null) {
+                NodeState parent = (NodeState) ism.getItemState(parentId);
+                return parent.getChildNodeEntry(nodeId).getNodeState();
-                return createNodeState(info, parent);
+                // special case for root state
+                return createNodeState(info, null);
-     * @param info   the <code>NodeInfo</code> to use to create the
-     *               <code>NodeState</code>.
+     * @param info the <code>NodeInfo</code> to use to create the
+     * <code>NodeState</code>.
