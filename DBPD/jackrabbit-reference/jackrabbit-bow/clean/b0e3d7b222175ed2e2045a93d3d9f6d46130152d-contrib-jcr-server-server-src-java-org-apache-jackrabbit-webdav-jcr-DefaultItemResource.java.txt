JCR-193, JCR-216, JCR-203, JCR 184 + various minor fixes

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@293331 13f79535-47bb-0310-9956-ffa450edef68

-     *
-     * todo: undo incomplete modifications...
-     * the {@link #complete()} method.
+     * the {@link #complete()} method.<p>
+     * Please note: since there is only a single property than can be set
+     * from a client (i.e. jcr:value OR jcr:values) this method either succeeds
+     * or throws an exception, even if this violates RFC 2518.
-    public void alterProperties(DavPropertySet setProperties,
+    public MultiStatusResponse alterProperties(DavPropertySet setProperties,
-            throw new DavException(DavServletResponse.SC_FORBIDDEN);
+            Iterator it = removePropertyNames.iterator();
+            while (it.hasNext()) {
+                throw new DavException(DavServletResponse.SC_FORBIDDEN);
+            }
+        return new MultiStatusResponse(getHref(), DavServletResponse.SC_OK);
-     * @see org.apache.jackrabbit.webdav.DavResource#addMember(org.apache.jackrabbit.webdav.DavResource, InputStream)
+     * @see org.apache.jackrabbit.webdav.DavResource#addMember(org.apache.jackrabbit.webdav.DavResource, InputContext)
-                    properties.add(new DefaultDavProperty(JCR_LENGTH, String.valueOf(prop.getLength())));
+                    properties.add(new DefaultDavProperty(JCR_LENGTH, String.valueOf(prop.getLength()), true));
