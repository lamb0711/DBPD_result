fixed: move, reorder (work in progress)
fixed: locktoken transfer
fixed: recursive transient removal of invalidated tree fails (restoreTests)
improve: simplify usage of workspace operations
fixed: store original itemId with transient operations in order to properly reflect the changelog upon batch creation
fixed: workspace import doesn't invalidate
fixed: session import uuid handling




git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@513279 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.jcr2spi.state.NoSuchItemStateException;
+    private final NodeId destParentId;
+    private final QName destName;
+
-    private final QName destName;
+        this.destParentId = destParentState.getNodeId();
+        this.destName = destName;
+
-        this.destName = destName;
-            if (srcState.isWorkspaceState()) {
-                // non-recursive invalidation
+            // non-recursive invalidation
+            try {
+                srcState.getNodeEntry().move(destName, destParentState.getNodeEntry(), false);
+                // TODO: TOBEFIXED. moved state ev. got a new definition.
+            } catch (RepositoryException e) {
+                // should not occure
+                log.error("Internal error", e);
-            } else {
-                throw new UnsupportedOperationException("persisted() not implemented for transient modification.");
+    public NodeId getDestinationParentId() {
+        return destParentId;
+    }
+
+        // lazy check for existing items at destination. since the hierarchy
+        // may not be complete it is possible that an conflict is only detected
+        // upon saving the 'move'.
+            } catch (NoSuchItemStateException e) {
+                // existing apparent not valid any more -> probably no conflict
