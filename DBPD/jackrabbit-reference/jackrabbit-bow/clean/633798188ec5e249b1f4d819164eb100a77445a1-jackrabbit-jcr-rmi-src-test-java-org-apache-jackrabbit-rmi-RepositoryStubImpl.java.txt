JCRRMI-27: JSR-283: Support AccessControlManager

Some streamlining of the test setup

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@927858 13f79535-47bb-0310-9956-ffa450edef68

-                SessionImpl session = (SessionImpl) repo.login(
-                        new SimpleCredentials("admin", "admin".toCharArray()));
-                try {
-                    for (Principal p : session.getSubject().getPrincipals()) {
-                        if (!(p instanceof Group)) {
-                            principal = p;
-                        }
-                    }
-                } finally {
-                    session.logout();
-                }
+                principal = findKnownPrincipal(repo);
-                remote = raf.getRemoteRepository(super.getRepository());
+                remote = raf.getRemoteRepository(repo);
+    private static Principal findKnownPrincipal(Repository repo)
+            throws RepositoryException {
+        SessionImpl session = (SessionImpl) repo.login(
+                new SimpleCredentials("admin", "admin".toCharArray()));
+        try {
+            for (Principal principal : session.getSubject().getPrincipals()) {
+                if (!(principal instanceof Group)) {
+                    return principal;
+                }
+            }
+            throw new RepositoryException("Known principal not found");
+        } finally {
+            session.logout();
+        }
+    }
+
-        if (principal != null) {
-            return principal;
-        } else {
-            throw new RepositoryException("no applicable principal found");
-        }
+        return principal;
