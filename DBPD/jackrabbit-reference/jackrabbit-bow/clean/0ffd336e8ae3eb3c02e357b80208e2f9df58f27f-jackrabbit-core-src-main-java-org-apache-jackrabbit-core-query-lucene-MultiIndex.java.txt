JCR-778: Error on query initialization - intermittent

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@533080 13f79535-47bb-0310-9956-ffa450edef68

+            if (redoLogApplied) {
+                // wait for the index merge to finish pending jobs
+                try {
+                    merger.waitUntilIdle();
+                } catch (InterruptedException e) {
+                    // move on
+                }
+                flush();
+            }
+
-                executeAndLog(new Start(Action.INTERNAL_TRANSACTION));
+                executeAndLog(new Start(Action.INTERNAL_TRANS_REPL_INDEXES));
-         * Transaction identifier for internal actions like index replace or
-         * volatile index commit triggered by timer thread.
+         * Transaction identifier for internal actions like volatile index
+         * commit triggered by timer thread.
+         * Transaction identifier for internal action that replaces indexs.
+         */
+        static final long INTERNAL_TRANS_REPL_INDEXES = -2;
+
+        /**
+                idx.close();
