Implemented RowIterator and Row interfaces. Adapted test queries to latest jcr version. jcr:score and jcr:path as select properties are not yet implemented!

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@149237 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.nodetype.NodeTypeImpl;
+import org.apache.jackrabbit.core.nodetype.PropertyDefImpl;
+import org.apache.jackrabbit.core.search.LocationStepQueryNode;
+import org.apache.jackrabbit.core.search.QueryNode;
+import org.apache.jackrabbit.core.search.NodeTypeQueryNode;
+import org.apache.jackrabbit.core.search.DefaultQueryNodeVisitor;
+import javax.jcr.nodetype.PropertyDef;
+        // get select properties
+        QName[] selectProps = root.getSelectProperties();
+        if (selectProps.length == 0) {
+            // use node type constraint
+            LocationStepQueryNode[] steps = root.getLocationNode().getPathSteps();
+            final QName[] ntName = new QName[1];
+            steps[steps.length - 1].acceptOperands(new DefaultQueryNodeVisitor() {
+                public Object visit(NodeTypeQueryNode node, Object data) {
+                    ntName[0] = node.getValue();
+                    return data;
+                }
+            }, null);
+            if (ntName[0] == null) {
+                ntName[0] = NodeTypeRegistry.NT_BASE;
+            }
+            NodeTypeImpl nt = session.getNodeTypeManager().getNodeType(ntName[0]);
+            PropertyDef[] propDefs = (PropertyDef[]) nt.getPropertyDefs();
+            List tmp = new ArrayList();
+            for (int i = 0; i < propDefs.length; i++) {
+                if (!propDefs[i].isMultiple()) {
+                    tmp.add(((PropertyDefImpl) propDefs[i]).getQName());
+                }
+            }
+            selectProps = (QName[]) tmp.toArray(new QName[tmp.size()]);
+        }
+
-                root.getSelectProperties(),
+                selectProps,
