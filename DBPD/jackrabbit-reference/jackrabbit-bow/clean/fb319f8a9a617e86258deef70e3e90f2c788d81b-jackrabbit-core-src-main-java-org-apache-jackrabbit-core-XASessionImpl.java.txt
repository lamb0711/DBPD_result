JCR-2640: Internal repository context

Commit the first draft patch, more updates to come...

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@948757 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.version.InternalVersionManagerImpl;
-     * @param rep          repository
+     * @param repositoryContext repository context
-    protected XASessionImpl(RepositoryImpl rep, AuthContext loginContext,
-                            WorkspaceConfig wspConfig)
+    protected XASessionImpl(
+            RepositoryContext repositoryContext, AuthContext loginContext,
+            WorkspaceConfig wspConfig)
-
-        super(rep, loginContext, wspConfig);
-
+        super(repositoryContext, loginContext, wspConfig);
-     * @param rep       repository
+     * @param repositoryContext repository context
-    protected XASessionImpl(RepositoryImpl rep, Subject subject,
-                            WorkspaceConfig wspConfig)
+    protected XASessionImpl(
+            RepositoryContext repositoryContext, Subject subject,
+            WorkspaceConfig wspConfig)
-
-        super(rep, subject, wspConfig);
-
+        super(repositoryContext, subject, wspConfig);
-    protected WorkspaceImpl createWorkspaceInstance(WorkspaceConfig wspConfig,
-                                                    SharedItemStateManager stateMgr,
-                                                    RepositoryImpl rep,
-                                                    SessionImpl session) {
-        return new XAWorkspace(wspConfig, stateMgr, rep, session);
+    @Override
+    protected WorkspaceImpl createWorkspaceInstance(
+            WorkspaceConfig wspConfig, SharedItemStateManager stateMgr) {
+        return new XAWorkspace(wspConfig, stateMgr, repositoryContext, this);
-
-        InternalVersionManagerImpl vMgr = (InternalVersionManagerImpl) rep.getVersionManager();
-        return new InternalXAVersionManager(vMgr, rep.getNodeTypeRegistry(), this, rep.getItemStateCacheFactory());
+        return new InternalXAVersionManager(
+                repositoryContext.getInternalVersionManager(),
+                repositoryContext.getNodeTypeRegistry(),
+                this, rep.getItemStateCacheFactory());
