JCR-549: TransientFileFactory may throw ConcurrentModificationException on shutdown

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@438504 13f79535-47bb-0310-9956-ffa450edef68

-                for (Iterator it = trackedRefs.iterator(); it.hasNext();) {
-                    MoribundFileReference fileRef = (MoribundFileReference) it.next();
-                    fileRef.delete();
+                // synchronize on the list before iterating over it in order
+                // to avoid ConcurrentModificationException (JCR-549)
+                // @see java.lang.util.Collections.synchronizedList(java.util.List)
+                synchronized(trackedRefs) {
+                    for (Iterator it = trackedRefs.iterator(); it.hasNext();) {
+                        MoribundFileReference fileRef = (MoribundFileReference) it.next();
+                        fileRef.delete();
+                    }
+
