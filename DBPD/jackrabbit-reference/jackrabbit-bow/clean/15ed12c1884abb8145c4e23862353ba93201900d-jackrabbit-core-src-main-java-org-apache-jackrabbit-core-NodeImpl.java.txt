JCR-726: Improve NodeTypeRegistry.effectiveNodeType()


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@502223 13f79535-47bb-0310-9956-ffa450edef68

+        return getEffectiveNodeType(((NodeState) state).getMixinTypeNames());
+    }
+
+    /**
+     * Small optimization to void double call for mixin types.
+     *
+     * @param mixins the set of mixins
+     * @return the effective node type
+     * @throws RepositoryException if an error occurs
+     */
+    private EffectiveNodeType getEffectiveNodeType(Set mixins)
+            throws RepositoryException {
+
-        // mixin types
-        Set set = ((NodeState) state).getMixinTypeNames();
-        QName[] types = new QName[set.size() + 1];
-        set.toArray(types);
+
+        QName[] types = new QName[mixins.size() + 1];
+        mixins.toArray(types);
-        if (((NodeState) state).getMixinTypeNames().contains(ntName)) {
+        Set mixins = ((NodeState) state).getMixinTypeNames();
+        if (mixins.contains(ntName)) {
-        return getEffectiveNodeType().includesNodeType(ntName);
+        return getEffectiveNodeType(mixins).includesNodeType(ntName);
