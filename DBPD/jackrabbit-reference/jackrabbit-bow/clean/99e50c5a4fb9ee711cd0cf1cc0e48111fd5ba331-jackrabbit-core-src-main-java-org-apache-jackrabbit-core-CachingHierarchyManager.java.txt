JCR-1380 CachingHierarchyManager synchronization problem

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@627461 13f79535-47bb-0310-9956-ffa450edef68

-                entry.touch();
+                synchronized (cacheMonitor) {
+                    entry.touch();
+                }
-        pathCache.traverse(new PathMap.ElementVisitor() {
-            public void elementVisited(PathMap.Element element) {
-                StringBuffer line = new StringBuffer();
-                for (int i = 0; i < element.getDepth(); i++) {
-                    line.append("--");
+        synchronized (cacheMonitor) {
+            pathCache.traverse(new PathMap.ElementVisitor() {
+                public void elementVisited(PathMap.Element element) {
+                    StringBuffer line = new StringBuffer();
+                    for (int i = 0; i < element.getDepth(); i++) {
+                        line.append("--");
+                    }
+                    line.append(element.getName());
+                    int index = element.getIndex();
+                    if (index != 0 && index != 1) {
+                        line.append('[');
+                        line.append(index);
+                        line.append(']');
+                    }
+                    line.append("  ");
+                    line.append(element.get());
+                    ps.println(line.toString());
-                line.append(element.getName());
-                int index = element.getIndex();
-                if (index != 0 && index != 1) {
-                    line.append('[');
-                    line.append(index);
-                    line.append(']');
-                }
-                line.append("  ");
-                line.append(element.get());
-                ps.println(line.toString());
-            }
-        }, true);
+            }, true);
+        }
