JCR-1638: Redundant calls to RepositoryService.getChildInfos

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@701388 13f79535-47bb-0310-9956-ffa450edef68

-        parent.markModified();
+        try {
+            parent.markModified();
+        } catch (RepositoryException e) {
+            nodeState.getHierarchyEntry().remove();
+            throw e;
+        }
-        throws ItemExistsException, ConstraintViolationException, RepositoryException {
+            throws ItemExistsException, ConstraintViolationException, RepositoryException {
-        PropertyState propState = ((NodeEntry) parent.getHierarchyEntry()).addNewPropertyEntry(propName, definition);
-        propState.setValues(values, propertyType);
-        parent.markModified();
-
+        NodeEntry nodeEntry = (NodeEntry) parent.getHierarchyEntry();
+        PropertyState propState = nodeEntry.addNewPropertyEntry(propName, definition);
+        try {
+            propState.setValues(values, propertyType);
+            parent.markModified();
+        } catch (RepositoryException e) {
+            propState.getHierarchyEntry().remove();
+            throw e;
+        }
