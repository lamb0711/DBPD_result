- refactoring of DavSession acquisition in jcr-server (JCR-66)
- some cleanup

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@157746 13f79535-47bb-0310-9956-ffa450edef68

-abstract class AbstractItemResource extends AbstractResource implements DavResource,
-        SearchResource, DeltaVResource, ItemResourceConstants {
+abstract class AbstractItemResource extends AbstractResource implements
+    SearchResource, DeltaVResource, ItemResourceConstants {
+
+	    // 'workspace' property as defined by RFC 3253
+	    String workspaceHref = getWorkspaceHref();
+	    if (workspaceHref != null) {
+		properties.add(new HrefProperty(DeltaVConstants.WORKSPACE, workspaceHref, true));
+	    }
+     * @return href of the workspace or <code>null</code> if this resource
+     * does not represent a repository item.
+     */
+    private String getWorkspaceHref() {
+        String workspaceHref = null;
+	DavResourceLocator locator = getLocator();
+        if (locator != null && locator.getWorkspaceName() != null) {
+            workspaceHref = locator.getHref(isCollection());
+            if (locator.getResourcePath() != null) {
+                workspaceHref = workspaceHref.substring(workspaceHref.indexOf(locator.getResourcePath()));
+            }
+        }
+        return workspaceHref;
+    }
+
+    /**
