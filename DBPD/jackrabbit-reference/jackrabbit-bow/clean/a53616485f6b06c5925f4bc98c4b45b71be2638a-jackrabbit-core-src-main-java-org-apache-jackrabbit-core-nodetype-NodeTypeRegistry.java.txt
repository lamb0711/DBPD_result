JCR-2066 NodeTypeRegistry could auto-subtype from nt:base


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@786003 13f79535-47bb-0310-9956-ffa450edef68

-                // make sure that all primary types except nt:base extend from nt:base
-                if (!ntd.isMixin() && !NameConstants.NT_BASE.equals(ntd.getName())
-                        && !est.includesNodeType(NameConstants.NT_BASE)) {
-                    String msg = "[" + name + "] all primary node types except"
-                            + " nt:base itself must be (directly or indirectly) derived from nt:base";
-                    log.debug(msg);
-                    throw new InvalidNodeTypeDefException(msg);
-                }
+                // make sure that all primary types except nt:base extend from nt:base
+                if (!ntd.isMixin() && !NameConstants.NT_BASE.equals(ntd.getName())
+                        && !est.includesNodeType(NameConstants.NT_BASE)) {
+                    // auto-subtype from nt:base
+                    Name[] s = new Name[supertypes.length + 1];
+                    System.arraycopy(supertypes, 0 ,s, 1, supertypes.length);
+                    s[0] = NameConstants.NT_BASE;
+                    supertypes = s;
+                    ntd.setSupertypes(s);
+                }
