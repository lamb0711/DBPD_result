JCR-1564: JSR 283 namespace handling
    - Use AbstractSession for namespace handling in jcr2spi
    - LocalNamespaceMappings is no longer needed

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@655569 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.commons.AbstractSession;
-import org.apache.jackrabbit.jcr2spi.name.LocalNamespaceMappings;
-public class SessionImpl implements Session, ManagerProvider {
+public class SessionImpl extends AbstractSession
+        implements NamespaceResolver, ManagerProvider {
-    private final LocalNamespaceMappings nsMappings;
-    private final NamePathResolver npResolver;
+    private NamePathResolver npResolver;
-        nsMappings = new LocalNamespaceMappings(workspace.getNamespaceRegistryImpl());
-        npResolver = new DefaultNamePathResolver(nsMappings, true);
+        npResolver = new DefaultNamePathResolver(this, true);
-     * @see LocalNamespaceMappings#setNamespacePrefix(String, String)
-    public void setNamespacePrefix(String prefix, String uri) throws NamespaceException, RepositoryException {
-        nsMappings.setNamespacePrefix(prefix, uri);
-    }
-
-    /**
-     * @see javax.jcr.Session#getNamespacePrefixes()
-     * @see LocalNamespaceMappings#getPrefixes()
-     */
-    public String[] getNamespacePrefixes() throws RepositoryException {
-        return nsMappings.getPrefixes();
-    }
-
-    /**
-     * @see javax.jcr.Session#getNamespaceURI(String)
-     * @see NamespaceResolver#getURI(String)
-     */
-    public String getNamespaceURI(String prefix) throws NamespaceException, RepositoryException {
-        return nsMappings.getURI(prefix);
-    }
-
-    /**
-     * @see javax.jcr.Session#getNamespacePrefix(String)
-     * @see NamespaceResolver#getPrefix(String)
-     */
-    public String getNamespacePrefix(String uri) throws NamespaceException, RepositoryException {
-        return nsMappings.getPrefix(uri);
+    public void setNamespacePrefix(String prefix, String uri)
+            throws RepositoryException {
+        super.setNamespacePrefix(prefix, uri);
+        // Reset name and path caches
+        npResolver = new DefaultNamePathResolver(this, true);
-        // dispose name nsResolver
-        nsMappings.dispose();
+    //-------------------------------------------------< NamespaceResolver >--
+
+    public String getPrefix(String uri) throws NamespaceException {
+        try {
+            return getNamespacePrefix(uri);
+        } catch (NamespaceException e) {
+            throw e;
+        } catch (RepositoryException e) {
+            throw new NamespaceException("Namespace not found: " + uri, e);
+        }
+    }
+
+    public String getURI(String prefix) throws NamespaceException {
+        try {
+            return getNamespaceURI(prefix);
+        } catch (NamespaceException e) {
+            throw e;
+        } catch (RepositoryException e) {
+            throw new NamespaceException("Namespace not found: " + prefix, e);
+        }
+    }
+
-        return nsMappings;
+        return this;
-    LocalNamespaceMappings getLocalNamespaceMappings() {
-        return nsMappings;
-    }
-
