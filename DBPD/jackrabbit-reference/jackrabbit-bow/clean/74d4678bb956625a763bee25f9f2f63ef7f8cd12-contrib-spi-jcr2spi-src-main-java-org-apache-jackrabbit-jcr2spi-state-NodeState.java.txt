Replace ChildNodeEntries.remove(NodeId) with ChildNodeEntries.remove(NodeState)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@431896 13f79535-47bb-0310-9956-ffa450edef68

-        NodeId childId = childState.getNodeId();
-        ChildNodeEntry oldEntry = childNodeEntries.remove(childId);
+        ChildNodeEntry oldEntry = childNodeEntries.remove(childState);
-         * Removes the child node entry refering to the node with the given id.
+         * Removes the child node entry refering to the node state.
-         * @param id id of node whose entry is to be removed.
+         * @param nodeState the node state whose entry is to be removed.
-        ChildNodeEntry remove(NodeId id) {
-            ChildNodeEntry entry = (ChildNodeEntry) entries.get(id);
+        ChildNodeEntry remove(NodeState nodeState) {
+            ChildNodeEntry entry = null;
+            for (Iterator it = get(nodeState.getName()).iterator(); it.hasNext(); ) {
+                ChildNodeEntry tmp = (ChildNodeEntry) it.next();
+                try {
+                    if (tmp.getNodeState() == nodeState) {
+                        entry = tmp;
+                        break;
+                    }
+                } catch (ItemStateException e) {
+                    log.warn("error accessing child node state: " + e.getMessage());
+                }
+            }
