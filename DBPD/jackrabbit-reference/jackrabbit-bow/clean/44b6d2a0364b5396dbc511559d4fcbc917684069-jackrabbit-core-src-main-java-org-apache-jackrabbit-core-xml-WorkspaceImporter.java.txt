JCR-1775: Transaction-safe versioning

Avoid instantiating full VersionHistoryImpl objects when all we need are the identifiers of the version history and root version nodes.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@702453 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.version.VersionHistoryInfo;
-import javax.jcr.version.Version;
-import javax.jcr.version.VersionHistory;
-            VersionHistory history =
+            VersionHistoryInfo history =
-            Version rootVersion = history.getRootVersion();
+            InternalValue historyId = InternalValue.create(
+                    history.getVersionHistoryId().getUUID());
+            InternalValue versionId = InternalValue.create(
+                    history.getRootVersionId().getUUID());
-                    node, NameConstants.JCR_VERSIONHISTORY, PropertyType.REFERENCE, false,
-                    InternalValue.create(new UUID(history.getUUID())));
+                    node, NameConstants.JCR_VERSIONHISTORY,
+                    PropertyType.REFERENCE, false, historyId);
-                    node, NameConstants.JCR_BASEVERSION, PropertyType.REFERENCE, false,
-                    InternalValue.create(new UUID(rootVersion.getUUID())));
+                    node, NameConstants.JCR_BASEVERSION,
+                    PropertyType.REFERENCE, false, versionId);
-                    node, NameConstants.JCR_PREDECESSORS, PropertyType.REFERENCE, true,
-                    InternalValue.create(new UUID(rootVersion.getUUID())));
+                    node, NameConstants.JCR_PREDECESSORS,
+                    PropertyType.REFERENCE, true, versionId);
-                    node, NameConstants.JCR_ISCHECKEDOUT, PropertyType.BOOLEAN, false,
-                    InternalValue.create(true));
+                    node, NameConstants.JCR_ISCHECKEDOUT,
+                    PropertyType.BOOLEAN, false, InternalValue.create(true));
