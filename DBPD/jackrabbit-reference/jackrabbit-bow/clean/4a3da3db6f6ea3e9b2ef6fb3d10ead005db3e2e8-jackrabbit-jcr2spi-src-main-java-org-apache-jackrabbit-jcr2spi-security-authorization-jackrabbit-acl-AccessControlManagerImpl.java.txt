JCR-2113 : JSR 283 Access Control Management (contribution by Alfusainey Jallow)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1656464 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashSet;
+import javax.jcr.AccessDeniedException;
-import javax.jcr.UnsupportedRepositoryOperationException;
-        return privs.containsAll(Arrays.asList(privileges));
+        List<Privilege> toTest = Arrays.asList(privileges);
+        if (privs.containsAll(toTest)) {
+            return true;
+        } else {
+            Set<Privilege> agg = new HashSet<Privilege>(privs);
+            for (Privilege p : privs) {
+                if (p.isAggregate()) {
+                    agg.addAll(Arrays.asList(p.getAggregatePrivileges()));
+                }
+            }
+            return agg.containsAll(toTest);
+        }
-        // TODO
-        throw new UnsupportedRepositoryOperationException("not yet implemented");
+        checkValidNodePath(absPath);
+        checkAccessControlRead(absPath);
+
+        // TODO : add proper implementation
+        return new AccessControlPolicy[] {new AccessControlPolicy() {}};
+        checkValidNodePath(absPath);
+
-            operation = SetTree.create(parent, name, NT_REP_ACL, null);
+            operation = SetTree.create(itemStateMgr, parent, name, NT_REP_ACL, null);            
-
-    
+
+    private void checkAccessControlRead(String absPath) throws RepositoryException {
+        if (!hasPrivileges(absPath, new Privilege[] {privilegeFromName(Privilege.JCR_READ_ACCESS_CONTROL)})) {
+            throw new AccessDeniedException();
+        }
+    }
+
-        // TODO: add rep:glob property            
+        // TODO: add single and mv restrictions
