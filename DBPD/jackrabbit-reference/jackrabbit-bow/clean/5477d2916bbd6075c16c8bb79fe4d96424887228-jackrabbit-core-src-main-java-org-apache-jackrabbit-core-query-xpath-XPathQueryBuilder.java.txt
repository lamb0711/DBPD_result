JCR-981: XPath relative path support missing for "is null" and "is not null"

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@553213 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.name.MalformedPathException;
+     * Temporary relative path
+     */
+    private Path.PathBuilder tmpRelPath;
+
+    /**
+                        applyRelativePath(isNull);
-                        RelationQueryNode notNull
-                                = new RelationQueryNode(queryNode,
+                        RelationQueryNode notNull =
+                                new RelationQueryNode(queryNode,
+                        applyRelativePath(notNull);
+                    } else {
+                        // step within a predicate
+                        RelationQueryNode tmp = new RelationQueryNode(
+                                null, RelationQueryNode.OPERATION_NOT_NULL);
+                        node.childrenAccept(this, tmp);
+                        if (tmpRelPath == null) {
+                            tmpRelPath = new Path.PathBuilder();
+                        }
+                        tmpRelPath.addLast(tmp.getRelativePath().getNameElement());
+     * Applies {@link #tmpRelPath} to <code>node</code> and reset the path to
+     * <code>null</code>.
+     *
+     * @param node a relation query node.
+     */
+    private void applyRelativePath(RelationQueryNode node) {
+        if (tmpRelPath != null) {
+            try {
+                Path relPath = tmpRelPath.getPath();
+                for (int i = 0; i < relPath.getLength(); i++) {
+                    node.addPathElement(relPath.getElement(i));
+                }
+            } catch (MalformedPathException e) {
+                // should never happen
+            }
+            tmpRelPath = null;
+        }
+    }
+
+    /**
