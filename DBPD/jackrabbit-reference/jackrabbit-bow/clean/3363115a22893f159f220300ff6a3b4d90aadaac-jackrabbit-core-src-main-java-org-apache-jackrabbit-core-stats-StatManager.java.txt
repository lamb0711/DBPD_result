JCR-3117 Stats for the PersistenceManager

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1186195 13f79535-47bb-0310-9956-ffa450edef68

+import static java.lang.Boolean.getBoolean;
- * StatManager represents a single entry point to the stats objects available.<br>
+ * StatManager represents a single entry point to the statistics objects
+ * available.<br>
+    public static String ALL_STATS_ENABLED_PROPERTY = "org.apache.jackrabbit.api.stats.ALL";
+    public static String QUERY_STATS_ENABLED_PROPERTY = "org.apache.jackrabbit.api.stats.QueryStat";
+    public static String PM_STATS_ENABLED_PROPERTY = "org.apache.jackrabbit.api.stats.PersistenceManagerStat";
+
-    /* STATS */
+    /* STAT OBJECTS */
+    private final PersistenceManagerStatCore pmStat = new PersistenceManagerStatImpl();
+
+        init();
-    public void init() {
-        queryStat.setEnabled(false);
-        log.debug("Started StatManager");
-    }
-
-    public void stop() {
-
+    protected void init() {
+        boolean allEnabled = getBoolean(ALL_STATS_ENABLED_PROPERTY);
+        queryStat.setEnabled(allEnabled
+                || getBoolean(QUERY_STATS_ENABLED_PROPERTY));
+        pmStat.setEnabled(allEnabled || getBoolean(PM_STATS_ENABLED_PROPERTY));
+        log.debug(
+                "Started StatManager. QueryStat is enabled {}, PersistenceManagerStat is enabled {}",
+                new Object[] { queryStat.isEnabled(), pmStat.isEnabled() });
+
+    public PersistenceManagerStatCore getPersistenceManagerStatCore() {
+        return pmStat;
+    }
