JCR-1022: Reduce calls to RepositoryService.getRepositoryDescriptors()

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@555263 13f79535-47bb-0310-9956-ffa450edef68

-import javax.jcr.Repository;
-                            CacheBehaviour cacheBehaviour, int pollTimeout)
+                            CacheBehaviour cacheBehaviour, int pollTimeout,
+                            boolean enableObservation)
-        Map repositoryDescriptors = service.getRepositoryDescriptors();
-        changeFeed = createChangeFeed(pollTimeout);
+        changeFeed = createChangeFeed(pollTimeout, enableObservation);
+     * @param enableObservation if observation should be enabled.
-    private Thread createChangeFeed(int pollTimeout) {
+    private Thread createChangeFeed(int pollTimeout, boolean enableObservation) {
-        try {
-            String desc = (String) service.getRepositoryDescriptors().get(
-                    Repository.OPTION_OBSERVATION_SUPPORTED);
-            if ("true".equals(desc)) {
-                t = new Thread(new ChangePolling(pollTimeout));
-                t.setName("Change Polling");
-                t.setDaemon(true);
-                t.start();
-            }
-        } catch (RepositoryException e) {
-            log.warn("Unable to get repository descriptors: " + e);
+        if (enableObservation) {
+            t = new Thread(new ChangePolling(pollTimeout));
+            t.setName("Change Polling");
+            t.setDaemon(true);
+            t.start();
