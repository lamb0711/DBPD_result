JCR-1007: Move common implementations of SPI interfaces to spi-commons module

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@553507 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.spi.rmi.common.SerializableIdFactory;
-import org.apache.jackrabbit.spi.rmi.common.QNodeDefinitionImpl;
-import org.apache.jackrabbit.spi.rmi.common.QPropertyDefinitionImpl;
-import org.apache.jackrabbit.spi.rmi.common.NodeInfoImpl;
-import org.apache.jackrabbit.spi.rmi.common.PropertyInfoImpl;
-import org.apache.jackrabbit.spi.rmi.common.LockInfoImpl;
-import org.apache.jackrabbit.spi.rmi.common.QNodeTypeDefinitionImpl;
-import org.apache.jackrabbit.spi.rmi.common.ChildInfoImpl;
-import org.apache.jackrabbit.spi.rmi.common.IteratorHelper;
-import org.apache.jackrabbit.spi.rmi.common.EventImpl;
-import org.apache.jackrabbit.spi.rmi.common.EventBundleImpl;
-import org.apache.jackrabbit.spi.rmi.common.EventFilterImpl;
-import org.apache.jackrabbit.spi.Event;
+import org.apache.jackrabbit.spi.Event;
+import org.apache.jackrabbit.spi.IdFactory;
+import org.apache.jackrabbit.spi.commons.EventFilterImpl;
+import org.apache.jackrabbit.spi.commons.QPropertyDefinitionImpl;
+import org.apache.jackrabbit.spi.commons.QNodeDefinitionImpl;
+import org.apache.jackrabbit.spi.commons.QNodeTypeDefinitionImpl;
+import org.apache.jackrabbit.spi.commons.EventImpl;
+import org.apache.jackrabbit.spi.commons.EventBundleImpl;
+import org.apache.jackrabbit.spi.commons.ChildInfoImpl;
+import org.apache.jackrabbit.spi.commons.NodeInfoImpl;
+import org.apache.jackrabbit.spi.commons.PropertyInfoImpl;
+import org.apache.jackrabbit.spi.commons.LockInfoImpl;
+import org.apache.jackrabbit.identifier.IdFactoryImpl;
+import org.apache.jackrabbit.util.IteratorHelper;
-    private final SerializableIdFactory idFactory = SerializableIdFactory.getInstance();
+    private final IdFactory idFactory = IdFactoryImpl.getInstance();
-            return idFactory.createSerializableNodeId(
-                    service.getRootId(getSessionInfo(sessionInfo)));
+            NodeId id = service.getRootId(getSessionInfo(sessionInfo));
+            return idFactory.createNodeId(id.getUniqueID(), id.getPath());
+                NodeId id = lockInfo.getNodeId();
-                        idFactory.createSerializableNodeId(lockInfo.getNodeId()));
+                        idFactory.createNodeId(id.getUniqueID(), id.getPath()));
+                NodeId id = lockInfo.getNodeId();
-                        idFactory.createSerializableNodeId(lockInfo.getNodeId()));
+                        idFactory.createNodeId(id.getUniqueID(), id.getPath()));
+                    // make sure node ids are serializable
+                    NodeId parentId = e.getParentId();
+                    parentId = idFactory.createNodeId(
+                            parentId.getUniqueID(), parentId.getPath());
-                        id = idFactory.createSerializableNodeId((NodeId) e.getItemId());
+                        NodeId nodeId = (NodeId) e.getItemId();
+                        id = idFactory.createNodeId(nodeId.getUniqueID(), nodeId.getPath());
-                        id = idFactory.createSerializablePropertyId((PropertyId) e.getItemId());
+                        PropertyId propId = (PropertyId) e.getItemId();
+                        id = idFactory.createPropertyId(parentId, propId.getQName());
-                            e.getQPath(), id,
-                            idFactory.createSerializableNodeId(e.getParentId()),
+                            e.getQPath(), id, parentId,
