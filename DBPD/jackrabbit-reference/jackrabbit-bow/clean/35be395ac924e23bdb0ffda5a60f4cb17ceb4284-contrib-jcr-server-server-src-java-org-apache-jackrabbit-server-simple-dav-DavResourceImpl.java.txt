- [JCR-84] WebDAV LocatorFactoryImpl$Locator.getHref() constructs root resource URLs incorrectly
- adapting for jcr-locking support
- adding nodetype reports

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@159607 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.lock.Lock;
+	if (isLocked(this)) {
+            throw new DavException(DavServletResponse.SC_LOCKED);
+        }
+        } catch (ItemExistsException e) {
+            // according to RFC 2518: MKCOL only possible on non-existing/deleted resource
+            throw new JcrDavException(e, DavServletResponse.SC_METHOD_NOT_ALLOWED);
+	if (isLocked(this)) {
+            throw new DavException(DavServletResponse.SC_LOCKED);
+        }
-	    /*
-	     do not use jcr locks until implemented
-
-	    */
+        } catch (PathNotFoundException e) {
+            // according to rfc 2518: missing parent
+            throw new DavException(DavServletResponse.SC_CONFLICT, e.getMessage());
-	    /*
-	    do not use jcr locks until implemented
-
-            if (isJsrLockable()) {
+	    if (isJsrLockable()) {
-	    */
-	    lock = lockManager.getLock(type, scope, this);
-	    /*
-	    do not use jcr lock until implemented
-
-	    */
-	    lock = lockManager.createLock(lockInfo, this);
+	} else {
+	    throw new DavException(DavServletResponse.SC_PRECONDITION_FAILED, "Unsupported lock type or scope.");
-
