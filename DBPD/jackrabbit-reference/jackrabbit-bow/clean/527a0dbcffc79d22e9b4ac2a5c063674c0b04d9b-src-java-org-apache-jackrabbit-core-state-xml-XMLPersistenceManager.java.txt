fixing bug http://issues.apache.org/jira/browse/JCR-11:
wrong implementation of reload(PersistentPropertyState state) 
in XMLPersistenceManager

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@55162 13f79535-47bb-0310-9956-ffa450edef68

+        Exception e = null;
+        String propFilePath = buildPropFilePath(parentUUID, propName);
-	Exception e = null;
-	String propFilePath = buildPropFilePath(parentUUID, propName);
-	try {
+	// read property state from xml file
+        try {
-	String msg = "failed to read property state: " + parentUUID + "/" + propName;
-	log.error(msg, e);
-	throw new ItemStateException(msg, e);
-        Exception e = null;
-        String propFilePath = buildPropFilePath(parentUUID, propName);
+        // read property state from java.util.Properties file
+
+/*
+	// read property state from xml file
+*/
+        // read property state from java.util.Properties file
+        try {
+            if (!itemStateStore.isFile(propFilePath)) {
+                throw new NoSuchItemStateException(parentUUID + "/" + propName);
+            }
+            InputStream in = itemStateStore.getInputStream(propFilePath);
+            try {
+                Properties props = new Properties();
+                props.load(in);
+                readState(props, state);
+                return;
+            } finally {
+                in.close();
+            }
+        } catch (IOException ioe) {
+            e = ioe;
+            // fall through
+        } catch (FileSystemException fse) {
+            e = fse;
+            // fall through
+        }
+
+            // write property state to xml file
+            // write property state to java.util.Properties file
-        // delete property xml file
+        // delete property file
