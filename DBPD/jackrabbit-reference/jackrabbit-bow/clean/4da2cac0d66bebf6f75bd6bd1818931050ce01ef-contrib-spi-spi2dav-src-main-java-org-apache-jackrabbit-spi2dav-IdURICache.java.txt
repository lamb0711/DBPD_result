work in progress

- MKCOL fails if resource already exists => problem with SNSs
- make sure resource hrefs are always cached without trailing /


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@463335 13f79535-47bb-0310-9956-ffa450edef68

-        return (ItemId) uriToIdCache.get(uri);
+        return (ItemId) uriToIdCache.get(getCleanUri(uri));
-        return uriToIdCache.containsKey(uri);
+        return uriToIdCache.containsKey(getCleanUri(uri));
-        uriToIdCache.put(uri, itemId);
-        idToUriCache.put(itemId, uri);
-        log.debug("Added: ItemId = " + itemId + " URI = " + uri);
+        String cleanUri = getCleanUri(uri);
+        uriToIdCache.put(cleanUri, itemId);
+        idToUriCache.put(itemId, cleanUri);
+        log.debug("Added: ItemId = " + itemId + " URI = " + cleanUri);
-        Object itemId = uriToIdCache.remove(uri);
-        log.debug("Removed: ItemId = " + itemId + " URI = " + uri);
+        String cleanUri = getCleanUri(uri);
+        Object itemId = uriToIdCache.remove(cleanUri);
+        log.debug("Removed: ItemId = " + itemId + " URI = " + cleanUri);
+
+    private static String getCleanUri(String uri) {
+        if (uri.endsWith("/")) {
+            return uri.substring(0, uri.length() - 1);
+        } else {
+            return uri;
+        }
+    }
