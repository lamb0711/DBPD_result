- [JCR-84] WebDAV LocatorFactoryImpl$Locator.getHref() constructs root resource URLs incorrectly
- adapting for jcr-locking support
- adding nodetype reports

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@159607 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.spi.version.report.RegisteredNamespacesReport;
+import org.apache.jackrabbit.webdav.spi.version.report.NodeTypesReport;
+import org.apache.jackrabbit.webdav.version.report.SupportedReportSetProperty;
+import org.apache.jackrabbit.webdav.version.report.ReportType;
+import javax.jcr.Session;
+
+    //--------------------------------------------------------------------------
+    /**
+     * @see AbstractResource#initLockSupport()
+     */
+    protected void initLockSupport() {
+        // no locking supported
+    }
+
+    /**
+     * @see AbstractResource#initSupportedReports()
+     */
+    protected void initSupportedReports() {
+        if (exists()) {
+            supportedReports = new SupportedReportSetProperty(new ReportType[] {
+	    ReportType.EXPAND_PROPERTY,
+	    NodeTypesReport.NODETYPES_REPORT,
+	    RegisteredNamespacesReport.REGISTERED_NAMESPACES_REPORT
+            });
+        }
+    }
+
+    /**
+     * Since the root resource does not represent a repository item and therefore
+     * is not member of a workspace resource, the workspace href is calculated
+     * from the workspace name retrieved from the underlaying repository session.
+     *
+     * @return workspace href build from workspace name.
+     * @see AbstractResource#getWorkspaceHref()
+     */
+    protected String getWorkspaceHref() {
+	Session session = this.getRepositorySession();
+	if (session != null) {
+	    String workspaceName = session.getWorkspace().getName();
+	    DavResourceLocator loc = getLocator().getFactory().createResourceLocator(getLocator().getPrefix(), "/"+workspaceName, ItemResourceConstants.ROOT_ITEM_PATH);
+	    return loc.getHref(true);
+	}
+	return null;
+    }
