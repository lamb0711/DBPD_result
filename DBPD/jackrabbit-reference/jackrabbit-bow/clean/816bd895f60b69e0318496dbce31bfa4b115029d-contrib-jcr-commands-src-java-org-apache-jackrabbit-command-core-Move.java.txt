- handle absolute paths in addnode, copy and move commands
- add setnamespaceprefix command
- lookup jcr session in httpsession in jcrcommandservlet

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@477140 13f79535-47bb-0310-9956-ffa450edef68

-import javax.jcr.Workspace;
+import javax.jcr.Item;
+import javax.jcr.Session;
+    /** persistent key */
+    private String persistentKey = "persistent";
+
+        boolean persistent = Boolean.valueOf(
+                (String) ctx.get(this.persistentKey)).booleanValue();
+
-                .getString("exception.illegalargument")
+                    .getString("exception.illegalargument")
-        Workspace w = CommandHelper.getSession(ctx).getWorkspace();
+        Session s = CommandHelper.getSession(ctx);
-        w.move(srcAbsPath, destAbsPath);
+        if (destAbsPath.endsWith("/")) {
+            Item source = s.getItem(srcAbsPath);
+            destAbsPath = destAbsPath + source.getName();
+        }
+
+        if (persistent) {
+            s.getWorkspace().move(srcAbsPath, destAbsPath);
+        } else {
+            s.move(srcAbsPath, destAbsPath);
+        }
-     *        the destintation absolute path key to set
+     *            the destintation absolute path key to set
-     *        the source absolute path key to set
+     *            the source absolute path key to set
+
+    public String getPersistentKey() {
+        return persistentKey;
+    }
+
+    public void setPersistentKey(String persistentKey) {
+        this.persistentKey = persistentKey;
+    }
