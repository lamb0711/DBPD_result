JCR-1588: Access Control

tests: missing session.logout (within tests and in case of failing setup)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@758653 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Iterator;
-   static JackrabbitAccessControlList getPolicy(AccessControlManager acM, String path, Principal principal) throws RepositoryException,
-                AccessDeniedException, NotExecutableException {
+    static boolean isExecutable(SessionImpl s, AccessControlManager acMgr) {
+        if (acMgr instanceof JackrabbitAccessControlManager) {
+            for (Iterator it = s.getSubject().getPrincipals().iterator(); it.hasNext();) {
+                Principal princ = (Principal) it.next();
+                try {
+                    AccessControlPolicy[] policies = ((JackrabbitAccessControlManager) acMgr).getApplicablePolicies(princ);
+                    for (int i = 0; i < policies.length; i++) {
+                        if (policies[i] instanceof ACLTemplate) {
+                            return true;
+                        }
+                    }
+                } catch (RepositoryException e) {
+                    // ignore
+                }
+            }
+        }
+        return false;
+    }
+
+    static JackrabbitAccessControlList getPolicy(AccessControlManager acM, String path, Principal principal) throws RepositoryException,
+            AccessDeniedException, NotExecutableException {
