misc. small changes for better performance

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@56480 13f79535-47bb-0310-9956-ffa450edef68

-     * Called by {@link #validateTransientItems(Iterator)}.
+     * Called by {@link #save()}.
+     * @return true if this call generated new transient state; otherwise false
-    private void initVersionHistories(Iterator iter) throws RepositoryException {
+    private boolean initVersionHistories(Iterator iter) throws RepositoryException {
+        boolean createdTransientState = false;
+                    createdTransientState = true;
+        return createdTransientState;
-             * (assuming that the paths won't change during the save() call)
+             * (assuming that the paths won't change during this save() call)
-                // initialize version histories for new nodes (might create new transient state)
-                initVersionHistories(dirty.iterator());
-
-                // re-build the list of transient states (might have changed by now)
-                dirty = getTransientStates();
+                // initialize version histories for new nodes (might generate new transient state)
+                if (initVersionHistories(dirty.iterator())) {
+                    /**
+                     * re-build the list of transient states because the previous call
+                     * generated new transient state
+                     */
+                    dirty = getTransientStates();
+                }
