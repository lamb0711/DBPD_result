JCR-2238: Binary throws NullPointerException

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@802676 13f79535-47bb-0310-9956-ffa450edef68

-    static BLOBInTempFile getInstance(InputStream in, boolean temp) throws RepositoryException {
-        return new BLOBInTempFile(in, temp);
+    static BLOBFileValue getInstance(InputStream in, boolean temp) throws RepositoryException {
+        if (temp) {
+            return new RefCountingBLOBFileValue(new BLOBInTempFile(in, temp));
+        } else {
+            return new BLOBInTempFile(in, temp);
+        }
-    static BLOBInTempFile getInstance(File file, boolean temp) throws IOException {
+    static BLOBInTempFile getInstance(File file, boolean temp) {
-    void discard() {
+    public void dispose() {
-    boolean isImmutable() {
-        // discard and delete can modify the state.
-        return false;
+    BLOBFileValue copy() throws RepositoryException {
+        if (temp) {
+            return BLOBInTempFile.getInstance(getStream(), temp);
+        } else {
+            return BLOBInTempFile.getInstance(file, temp);
+        }
