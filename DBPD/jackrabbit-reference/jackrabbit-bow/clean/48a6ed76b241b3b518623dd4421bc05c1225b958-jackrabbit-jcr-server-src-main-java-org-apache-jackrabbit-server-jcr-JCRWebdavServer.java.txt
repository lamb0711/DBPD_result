minor changes needed for spi2dav (see spi contrib)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@506936 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.webdav.DavServletResponse;
+import org.apache.jackrabbit.webdav.header.IfHeader;
+import java.util.Iterator;
+
-            if ((lockToken != null || txId != null) && subscriptionId != null) {
-                throw new DavException(DavServletResponse.SC_PRECONDITION_FAILED, "Ambiguous headers: either TransactionId/Lock-Token or SubscriptionId can be present, not both.");
-            }
-
+
+            if (session == null) {
+                // try tokens present in the if-header
+                IfHeader ifHeader = new IfHeader(request);
+                for (Iterator it = ifHeader.getAllTokens(); it.hasNext();) {
+                    String token = it.next().toString();
+                    if (containsReference(token)) {
+                        session = getSessionByReference(token);
+                        break;
+                    }
+                }
+            }
+
