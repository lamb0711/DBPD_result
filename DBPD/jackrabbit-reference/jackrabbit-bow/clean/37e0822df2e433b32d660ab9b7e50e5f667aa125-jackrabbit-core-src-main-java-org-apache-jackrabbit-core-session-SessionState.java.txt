JCR-2741: Improved logging for session operations

Detect and warn about concurrent writes using the same session

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@994955 13f79535-47bb-0310-9956-ffa450edef68

+     * Flag to indicate that the current operation is a write operation.
+     * Used to detect concurrent writes.
+     */
+    private volatile boolean isWriteOperation = false;
+
+    /**
+    /**
+     * Creates a state instance for a session.
+     *
+     * @param context component context of this session
+     */
-            log.debug("Attempt to perform {} while another thread is"
-                    + " concurrently accessing the session. Blocking until"
-                    + " the other thread is finished using this session.",
-                    operation);
+            if (isWriteOperation && operation instanceof SessionWriteOperation) {
+                log.warn("Attempt to perform {} while another thread is"
+                        + " concurrently modifying the session. Blocking until"
+                        + " the other thread is finished using this session.",
+                        operation);
+            } else {
+                log.debug("Attempt to perform {} while another thread is"
+                        + " concurrently accessing the session. Blocking until"
+                        + " the other thread is finished using this session.",
+                        operation);
+            }
+        boolean wasWriteOperation = isWriteOperation;
+        if (!wasWriteOperation && operation instanceof SessionWriteOperation) {
+            isWriteOperation = true;
+        }
+            isWriteOperation = wasWriteOperation;
