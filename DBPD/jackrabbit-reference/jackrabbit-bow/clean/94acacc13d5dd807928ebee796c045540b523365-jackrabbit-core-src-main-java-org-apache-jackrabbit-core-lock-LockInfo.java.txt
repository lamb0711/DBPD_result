JCR-1590: JSR 283: Locking

Create and use a LockInfo.throwLockException utility method for setting the failure node path in LockExceptions.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@803566 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.RepositoryException;
+import javax.jcr.lock.LockException;
+     * Utility method that throws a {@link LockException} with the
+     * "failure node path" set to the path of the node that holds this lock.
+     * The given session is used to resolve the path of the lock holder node.
+     *
+     * @param message exception message
+     * @param session session that the user was using for the failing operation
+     * @throws LockException always thrown, unless another error occurs
+     * @throws RepositoryException if the path of this lock can not be resolved
+     */
+    public void throwLockException(String message, SessionImpl session)
+            throws LockException, RepositoryException {
+        String path;
+        try {
+            path = session.getJCRPath(
+                    session.getHierarchyManager().getPath(id));
+        } catch (RepositoryException ignored) {
+            path = null;
+        }
+        if (path != null) {
+            throw new LockException(
+                    message + " (lock held by node " + path + ")", null, path);
+        } else {
+            throw new LockException(message);
+        }
+    }
+
+    /**
