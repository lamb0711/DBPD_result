JCR-3026 - apply modified patch (original author: chad davis)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1151110 13f79535-47bb-0310-9956-ffa450edef68

+    /**
+     * Optional configuration parameter: It's value defines the
+     * maximumConnectionsPerHost value on the HttpClient configuration and
+     * must be an int greater than zero.
+     */
+    public static final String PARAM_MAX_CONNECTIONS = "org.apache.jackrabbit.spi2dav.MaxConnections";
+
-            }
-            catch (NumberFormatException e) {
+            } catch (NumberFormatException e) {
-        return new RepositoryServiceImpl(uri, idFactory, nameFactory, pathFactory, vFactory, itemInfoCacheSize);
-    }
+        // max connections config
+        int maximumHttpConnections = 0;
+        param = parameters.get(PARAM_MAX_CONNECTIONS);
+        if (param != null) {
+            try {
+                maximumHttpConnections = Integer.parseInt(param.toString());
+            } catch ( NumberFormatException e ) {
+                // using default
+            }
+        }
+        
+        if (maximumHttpConnections > 0) {
+            return new RepositoryServiceImpl(uri, idFactory, nameFactory, pathFactory, vFactory, itemInfoCacheSize, maximumHttpConnections);
+        } else {
+            return new RepositoryServiceImpl(uri, idFactory, nameFactory, pathFactory, vFactory, itemInfoCacheSize);
+        }
+    }
