JCR-313: Restored the initConnection() method to allow external subclasses to override either initConnection() or getConnection().

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@386957 13f79535-47bb-0310-9956-ffa450edef68

- * Abstract base class for database file systems. This class contains common
+ * Base class for database file systems. This class contains common
- * in the way the database connection is acquired.
+ * in the way the database connection is acquired. Subclasses should override
+ * the {@link #getConnection()} method to return the configured database
+ * connection.
-public abstract class DatabaseFileSystem implements FileSystem {
+public class DatabaseFileSystem implements FileSystem {
-            con = getConnection();
-            con.setAutoCommit(false);
+            initConnection();
+     * Initializes the database connection used by this file system. 
+     * <p>
+     * Subclasses should normally override the {@link #getConnection()}
+     * method instead of this one. The default implementation calls
+     * {@link #getConnection()} to get the database connection and disables
+     * the autocommit feature.
+     *
+     * @throws Exception if an error occurs
+     */
+    protected void initConnection() throws Exception {
+        con = getConnection();
+        con.setAutoCommit(false);
+    }
+    
+    /**
-     * method is called by {@link #init()} when the file system is started.
-     * The returned connection should come with the default JDBC settings,
-     * as the {@link #init()} method will explicitly set the
-     * <code>autoCommit</code> and other properties as needed.
+     * method is called by {@link #initConnection()} when the file system is
+     * started. The returned connection should come with the default JDBC
+     * settings, as the {@link #initConnection()} method will explicitly set
+     * the <code>autoCommit</code> and other properties as needed.
-    protected abstract Connection getConnection() throws Exception;
+    protected Connection getConnection() throws Exception {
+        throw new UnsupportedOperationException("Override in a subclass!");
+    }
