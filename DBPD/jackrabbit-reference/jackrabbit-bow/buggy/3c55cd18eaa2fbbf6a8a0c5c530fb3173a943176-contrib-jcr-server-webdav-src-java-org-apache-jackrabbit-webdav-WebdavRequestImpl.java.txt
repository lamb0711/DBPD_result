[JCR-175] Contrib JCR-Server: enable PROPPATCH for simple-davresource
[JCR-174] Contrib JCR-Server: improve handing of strong etags

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@230679 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.webdav.property.DavProperty;
-            // todo: do not ignore etag
-            isMatching = matchesIfHeader(resource.getHref(), lockToken, "");
+            isMatching = matchesIfHeader(resource.getHref(), lockToken, getStrongETag(resource));
+     * Returns the strong etag present on the given resource or empty string
+     * if either the resource does not provide any etag or if the etag is weak.
+     *
+     * @param resource
+     * @return strong etag or empty string.
+     */
+    private String getStrongETag(DavResource resource) {
+        DavProperty prop = resource.getProperty(DavPropertyName.GETETAG);
+        if (prop != null) {
+            String etag = prop.getValue().toString();
+            if (etag != null && etag.length() > 0 && !etag.startsWith("W\\")) {
+                return etag;
+            }
+        }
+        // no strong etag available
+        return "";
+    }
+
+    /**
