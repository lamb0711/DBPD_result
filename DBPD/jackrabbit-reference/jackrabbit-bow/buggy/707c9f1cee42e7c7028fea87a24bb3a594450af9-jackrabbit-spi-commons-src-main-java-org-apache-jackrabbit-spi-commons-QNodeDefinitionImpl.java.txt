JCR-2490: jackrabbit wrongly think nodetype is changed on nodetype re-registration

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@988151 13f79535-47bb-0310-9956-ffa450edef68

-     * @param declaringNodeType the delaring node type
+     * @param declaringNodeType the declaring node type
+        // sanitize field value
+        if (this.requiredPrimaryTypes.isEmpty()) {
+            this.requiredPrimaryTypes.add(NameConstants.NT_BASE);
+        }
-     * if the given object is a node defintion and has the same attributes
+     * if the given object is a node definition and has the same attributes
-            // build hashCode (format: <declaringNodeType>/<name>/<requiredPrimaryTypes>)
-            StringBuffer sb = new StringBuffer();
-
-            if (getDeclaringNodeType() != null) {
-                sb.append(getDeclaringNodeType().toString());
-                sb.append('/');
-            }
-            if (definesResidual()) {
-                sb.append('*');
-            } else {
-                sb.append(getName().toString());
-            }
-            sb.append('/');
-            // set of required node type names, sorted in ascending order
-            TreeSet<Name> set = new TreeSet<Name>();
-            Name[] names = getRequiredPrimaryTypes();
-            set.addAll(Arrays.asList(names));
-            sb.append(set.toString());
-
-            hashCode = sb.toString().hashCode();
+            int h = super.hashCode();
+            h = 37 * h + (defaultPrimaryType == null ? 0 : defaultPrimaryType.hashCode());
+            h = 37 * h + requiredPrimaryTypes.hashCode();
+            h = 37 * h + (allowsSameNameSiblings ? 11 : 43);
+            hashCode = h;
+
