JCR-2129: Prevent data inconsistencies due to incorrect or missed merges in the ItemStateManagers

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@789279 13f79535-47bb-0310-9956-ffa450edef68

-                        if (context.isAdded(cne.getId())) {
+                        if (context.isAdded(cne.getId()) || context.isModified(cne.getId())) {
+                        } else {
+                            // externally added
-                        if (context.isDeleted(cne.getId())) {
+                        if (context.isDeleted(cne.getId()) || context.isModified(cne.getId())) {
+                        } else {
+                            // externally removed
-                            // a new property name has been added to this state;
-                            // check for name collisions
-                            if (overlayedState.hasPropertyName(name)
-                                    || overlayedState.hasChildNodeEntry(name)) {
-                                // conflicting names
-                                return false;
-                            }
-
+        boolean isModified(ItemId id);
