JCR-1952: DOMException: NAMESPACE_ERR thrown when exporting document view

Use the new XML serializer classes instead of the JAXP-based SerializingContentHandler for serializing JCR export formats

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@746603 13f79535-47bb-0310-9956-ffa450edef68

-import javax.xml.transform.OutputKeys;
-import javax.xml.transform.Transformer;
-import javax.xml.transform.TransformerException;
-import javax.xml.transform.TransformerFactoryConfigurationError;
-import javax.xml.transform.sax.SAXTransformerFactory;
-import javax.xml.transform.sax.TransformerHandler;
-import javax.xml.transform.stream.StreamResult;
+import org.apache.jackrabbit.commons.xml.ToXmlContentHandler;
+import org.apache.jackrabbit.commons.xml.XmlnsContentHandler;
-            ContentHandler handler = getExportContentHandler(out);
+            ContentHandler handler =
+                new XmlnsContentHandler(new ToXmlContentHandler(out));
-            ContentHandler handler = getExportContentHandler(out);
+            ContentHandler handler =
+                new XmlnsContentHandler(new ToXmlContentHandler(out));
-    /**
-     * Creates a {@link ContentHandler} instance that serializes the
-     * received SAX events to the given output stream.
-     *
-     * @param stream output stream to which the SAX events are serialized
-     * @return SAX content handler
-     * @throws RepositoryException if an error occurs
-     */
-    private ContentHandler getExportContentHandler(OutputStream stream)
-            throws RepositoryException {
-        try {
-            SAXTransformerFactory stf = (SAXTransformerFactory)
-                SAXTransformerFactory.newInstance();
-            TransformerHandler handler = stf.newTransformerHandler();
-
-            Transformer transformer = handler.getTransformer();
-            transformer.setOutputProperty(OutputKeys.METHOD, "xml");
-            transformer.setOutputProperty(OutputKeys.ENCODING, "UTF-8");
-            transformer.setOutputProperty(OutputKeys.INDENT, "no");
-
-            handler.setResult(new StreamResult(stream));
-            return handler;
-        } catch (TransformerFactoryConfigurationError e) {
-            throw new RepositoryException(
-                    "SAX transformer implementation not available", e);
-        } catch (TransformerException e) {
-            throw new RepositoryException(
-                    "Error creating an XML export content handler", e);
-        }
-    }
-
