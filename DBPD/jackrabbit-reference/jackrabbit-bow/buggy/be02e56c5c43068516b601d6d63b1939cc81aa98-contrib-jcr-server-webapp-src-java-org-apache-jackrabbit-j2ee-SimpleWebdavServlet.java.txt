- [JCR-134] extensibility patch for DavResourceImpl
- moving JcrConstants.java to commons
- fixing minor import issues
- readding lost stuff
- adding proper shutdown to RepositoryStartupServlet.java

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@190721 13f79535-47bb-0310-9956-ffa450edef68

-     * the session provider
+     * the webdav session provider
-     * the session provider
+     * the repository session provider
-        // init repository
-        repository = RepositoryAccessServlet.getRepository();
-        if (repository == null) {
-            throw new ServletException("Repository could not be retrieved. Check config of 'RepositoryAccessServlet'.");
-        }
+     * @see AbstractWebdavServlet#getLocatorFactory()
+     * Sets the <code>DavLocatorFactory</code>.
+     *
+     * @param locatorFactory
+     * @see AbstractWebdavServlet#setLocatorFactory(DavLocatorFactory)
+     */
+    public void setLocatorFactory(DavLocatorFactory locatorFactory) {
+        this.locatorFactory = locatorFactory;
+    }
+
+    /**
+     * Sets the <code>LockManager</code>.
+     *
+     * @param lockManager
+     */
+    public void setLockManager(LockManager lockManager) {
+        this.lockManager = lockManager;
+    }
+
+    /**
+     * @see org.apache.jackrabbit.server.AbstractWebdavServlet#getResourceFactory()
-     * Returns the header value retrieved from the {@link #INIT_PARAM_AUTHENTICATE_HEADER}
-     * init parameter. If the parameter is missing, the value defaults to
-     * {@link #DEFAULT_AUTHENTICATE_HEADER}.
+     * Sets the <code>DavResourceFactory</code>.
-     * @return the header value retrieved from the corresponding init parameter
-     * or {@link #DEFAULT_AUTHENTICATE_HEADER}.
+     * @param resourceFactory
+     * @see AbstractWebdavServlet#setResourceFactory(org.apache.jackrabbit.webdav.DavResourceFactory)
-    public String getAuthenticateHeaderValue() {
-        return authenticate_header;
+    public void setResourceFactory(DavResourceFactory resourceFactory) {
+        this.resourceFactory = resourceFactory;
-     * Returns the <code>DavSessionProvider</code>.
+     * Returns the <code>SessionProvider</code>. If no session provider has been
+     * set or created a new instance of {@link SessionProviderImpl} that extracts
+     * credentials from the request's <code>Authorization</code> header is
+     * returned.
+     * @see RepositoryAccessServlet#getCredentialsFromHeader(String)
-    public synchronized SessionProvider getRepositorySessionProvider() {
+    public synchronized SessionProvider getSessionProvider() {
-     * Returns the <code>DavSessionProvider</code>.
+     * Sets the <code>SessionProvider</code>.
+     *
+     * @param sessionProvider
+     */
+    public synchronized void setSessionProvider(SessionProvider sessionProvider) {
+        this.sessionProvider = sessionProvider;
+    }
+
+    /**
+     * Returns the <code>DavSessionProvider</code>. If no session provider has
+     * been set or created a new instance of {@link DavSessionProviderImpl}
+     * is returned.
+     * @see org.apache.jackrabbit.server.AbstractWebdavServlet#getDavSessionProvider()
-    public synchronized DavSessionProvider getSessionProvider() {
+    public synchronized DavSessionProvider getDavSessionProvider() {
-                    new DavSessionProviderImpl(repository, getRepositorySessionProvider());
+                new DavSessionProviderImpl(getRepository(), getSessionProvider());
+    /**
+     * Sets the <code>DavSessionProvider</code>.
+     *
+     * @param sessionProvider
+     * @see AbstractWebdavServlet#setDavSessionProvider(org.apache.jackrabbit.webdav.DavSessionProvider)
+     */
+    public synchronized void setDavSessionProvider(DavSessionProvider sessionProvider) {
+        this.davSessionProvider = sessionProvider;
+    }
+
+    /**
+     * Returns the header value retrieved from the {@link #INIT_PARAM_AUTHENTICATE_HEADER}
+     * init parameter. If the parameter is missing, the value defaults to
+     * {@link #DEFAULT_AUTHENTICATE_HEADER}.
+     *
+     * @return the header value retrieved from the corresponding init parameter
+     * or {@link #DEFAULT_AUTHENTICATE_HEADER}.
+     * @see org.apache.jackrabbit.server.AbstractWebdavServlet#getAuthenticateHeaderValue()
+     */
+    public String getAuthenticateHeaderValue() {
+        return authenticate_header;
+    }
+
+    /**
+     * Returns the <code>Repository</code>. If no repository has been set or
+     * created the repository initialized by <code>RepositoryAccessServlet</code>
+     * is returned.
+     *
+     * @return repository
+     * @see RepositoryAccessServlet#getRepository()
+     */
+    public Repository getRepository() {
+        if (repository == null) {
+            repository = RepositoryAccessServlet.getRepository();
+            if (repository == null) {
+                throw new IllegalStateException("Repository could not be retrieved. Check config of 'RepositoryAccessServlet'.");
+            }
+        }
+        return repository;
+    }
+
+    /**
+     * Sets the <code>Repository</code>.
+     *
+     * @param repository
+     */
+    public void setRepository(Repository repository) {
+        this.repository = repository;
+    }
