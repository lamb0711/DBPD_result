JCR-247: Child axis support for XPath predicates

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@477599 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.name.Path;
-        if (node.getPropertyName() == null) {
+        if (node.getRelativePath() == null) {
-            try {
-                appendName(node.getPropertyName(), resolver, sb);
-            } catch (NoPrefixDeclaredException e) {
-                exceptions.add(e);
+            if (node.getRelativePath().getLength() > 1
+                    || !node.getReferencesProperty()) {
+                exceptions.add(new InvalidQueryException("Child axis not supported in SQL"));
+            } else {
+                try {
+                    appendName(node.getRelativePath().getNameElement().getName(), resolver, sb);
+                } catch (NoPrefixDeclaredException e) {
+                    exceptions.add(e);
+                }
+        Path relPath = node.getRelativePath();
+        if (relPath.getLength() > 1) {
+            exceptions.add(new InvalidQueryException("Child axis not supported in SQL"));
+            return data;
+        }
-            appendName(node.getProperty(), resolver, propName);
+            appendName(relPath.getNameElement().getName(), resolver, propName);
