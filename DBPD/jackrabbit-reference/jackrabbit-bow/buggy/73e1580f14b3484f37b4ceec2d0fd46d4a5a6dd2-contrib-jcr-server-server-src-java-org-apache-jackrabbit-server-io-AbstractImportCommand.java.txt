applying patch from angela, fixing:

[JCR-122] cannot PUT changes to a resource in the simple webdav server
[JCR-123] Webdav: Error when accessing Simple-Server
[JCR-126] Jcr-Server Module: Remove Dependency from Jackrabbit-Core


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@180346 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.commons.chain.Command;
-import org.apache.commons.chain.Context;
-import org.apache.jackrabbit.JcrConstants;
+import org.apache.jackrabbit.util.Text;
+import javax.jcr.RepositoryException;
-public abstract class AbstractImportCommand implements Command, JcrConstants {
+public abstract class AbstractImportCommand extends AbstractCommand {
+
+    /**
+     * the nodetype for the node
+     */
+    private String nodeType = "nt:file";
-    public boolean execute(Context context) throws Exception {
+    public boolean execute(AbstractContext context) throws Exception {
-        if (importResource(context, parentNode, in)) {
+        // check 'file' node
+        Node fileNode = parentNode.hasNode(context.getSystemId())
+            ? parentNode.getNode(context.getSystemId())
+            : parentNode.addNode(context.getSystemId(), nodeType);
+
+        if (importResource(context, fileNode, in)) {
+        // set current node
+        context.setNode(fileNode);
+     * Creates collection recursively.
+     *
+     * @param root
+     * @param relPath
+     * @return
+     * @throws RepositoryException
+     */
+    static public Node mkDirs(ImportContext context, Node root, String relPath)
+            throws RepositoryException {
+        String[] seg = Text.explode(relPath, '/');
+        for (int i=0; i< seg.length; i++) {
+            if (!root.hasNode(seg[i])) {
+                // not quite correct
+                ImportContext subctx = context.createSubContext(root);
+                subctx.setSystemId(seg[i]);
+                try {
+                    ImportCollectionChain.getChain().execute(subctx);
+                } catch (Exception e) {
+                    throw new RepositoryException(e);
+                }
+            }
+            root = root.getNode(seg[i]);
+        }
+        return root;
+    }
+
+    /**
+     * Sets the node type
+     * @param nodeType
+     */
+    public void setNodeType(String nodeType) {
+        this.nodeType = nodeType;
+    }
+
+    /**
