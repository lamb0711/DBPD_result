JCR-2104: JSR 283 Versioning (intermediate commit, work in progress)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@779101 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.jcr2spi.operation.CreateActivity;
+import org.apache.jackrabbit.jcr2spi.operation.CreateConfiguration;
+import org.apache.jackrabbit.jcr2spi.operation.RemoveActivity;
-            Iterator failed = service.merge(sessionInfo, nId, operation.getSourceWorkspaceName(), operation.bestEffort(), operation.isShallow());
+            Iterator failed;
+            if (operation.isActivityMerge()) {
+                failed = service.mergeActivity(sessionInfo, nId);
+            } else {
+                failed = service.merge(sessionInfo, nId, operation.getSourceWorkspaceName(), operation.bestEffort(), operation.isShallow());
+            }
+
+        /**
+         * @see OperationVisitor#visit(CreateActivity)
+         */
+        public void visit(CreateActivity operation) throws RepositoryException {
+            NodeId activityId = service.createActivity(sessionInfo, operation.getTitle());
+            operation.setNewActivityId(activityId);
+        }
+
+        /**
+         * @see OperationVisitor#visit(RemoveActivity)
+         */
+        public void visit(RemoveActivity operation) throws RepositoryException {
+            service.removeActivity(sessionInfo, (NodeId) operation.getRemoveId());
+        }
+
+        /**
+         * @see OperationVisitor#visit(CreateConfiguration)
+         */
+        public void visit(CreateConfiguration operation) throws RepositoryException {
+            NodeId configId = service.createConfiguration(sessionInfo, operation.getNodeId(), operation.getBaselineId());
+            operation.setNewConfigurationId(configId);
+        }
