JCR-1438: Replace Config classes with factories

Replace SearchConfig with a QueryHandlerFactory.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@816678 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.fs.FileSystemException;
+import org.apache.jackrabbit.core.query.QueryHandlerFactory;
-     * The search configuration.
-     */
-    private final SearchConfig config;
-
-    /**
-     * The node type registry.
-     */
-    private final NodeTypeRegistry ntReg;
-
-    /**
-     * The underlying persistence manager.
-     */
-    private final PersistenceManager pm;
-
-    /**
-     * Storage for search index
-     */
-    private final FileSystem fs;
-
-    /**
-     * The root node for this search manager.
-     */
-    private final NodeId rootNodeId;
-
-    /**
-     * ID of the node that should be excluded from indexing or <code>null</code>
-     * if no node should be excluded.
-     */
-    private final NodeId excludedNodeId;
-
-    /**
-     * Background task executor.
-     */
-    private final Executor executor;
-
-    /**
-    public SearchManager(SearchConfig config,
+    public SearchManager(QueryHandlerFactory qhf,
-        this.fs = config.getFileSystem();
-        this.config = config;
-        this.ntReg = ntReg;
-        this.pm = pm;
-        this.rootNodeId = rootNodeId;
-        this.excludedNodeId = excludedNodeId;
-        this.executor = executor;
-        initializeQueryHandler();
+        this.handler = qhf.getQueryHandler(new QueryHandlerContext(
+                itemMgr, pm, rootNodeId, ntReg, nsReg,
+                parentHandler, excludedNodeId, executor));
-
-            if (fs != null) {
-                fs.close();
-            }
-        } catch (FileSystemException e) {
-            log.error("Exception closing FileSystem.", e);
-     * Initializes the query handler.
-     *
-     * @throws RepositoryException if the query handler cannot be initialized.
-     */
-    private void initializeQueryHandler() throws RepositoryException {
-        // initialize query handler
-        try {
-            handler = (QueryHandler) config.newInstance();
-            QueryHandlerContext context = new QueryHandlerContext(
-                    fs, itemMgr, pm, rootNodeId, ntReg, nsReg,
-                    parentHandler, excludedNodeId, executor);
-            handler.init(context);
-        } catch (Exception e) {
-            throw new RepositoryException(e.getMessage(), e);
-        }
-    }
-
-    /**
