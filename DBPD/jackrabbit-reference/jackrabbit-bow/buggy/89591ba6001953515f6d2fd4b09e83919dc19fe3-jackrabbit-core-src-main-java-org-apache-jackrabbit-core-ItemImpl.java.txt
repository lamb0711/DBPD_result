JCR-1589: JSR 283 Retention & Hold Management (work in progress)
JCR-1957: Move common validation checks to a single place

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@738422 13f79535-47bb-0310-9956-ffa450edef68

-import javax.jcr.Property;
-
-            // check if protected
-            ItemDefinition definition;
-            if (isNode()) {
-                definition = ((Node) this).getDefinition();
-            } else {
-                definition = ((Property) this).getDefinition();
-            }
-            if (definition.isProtected()) {
-                throw new ConstraintViolationException(
-                        "Cannot remove a protected item: " + this);
-            }
+            // check if protected and not under retention/hold
+            int options = ItemValidator.CHECK_CONSTRAINTS | ItemValidator.CHECK_HOLD |
+                    ItemValidator.CHECK_RETENTION;
+            session.getValidator().checkRemove(this, options, Permission.NONE);
-            // verify that parent node is checked-out and not protected
-            if (!parentNode.internalIsCheckedOut()) {
-                throw new VersionException(
-                        "Cannot remove a child of a checked-in node: " + this);
-            }
-            if (parentNode.getDefinition().isProtected()) {
-                throw new ConstraintViolationException(
-                        "Cannot remove a child of a protected node: " + this);
-            }
-
-            // check lock status
-            parentNode.checkLock();
+            // parent node: make sure it is checked-out and not protected nor locked.
+            options = ItemValidator.CHECK_LOCK | ItemValidator.CHECK_VERSIONING |
+                    ItemValidator.CHECK_CONSTRAINTS;
+            session.getValidator().checkModify(parentNode, options, Permission.NONE);
