JCR-2245: Make QValueFactoryImpl extensible

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@802695 13f79535-47bb-0310-9956-ffa450edef68

-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
+import org.apache.commons.io.IOUtils;
+import java.io.InputStream;
+import java.io.IOException;
+import java.io.Serializable;
-public abstract class AbstractQValue implements QValue {
+public abstract class AbstractQValue implements QValue, Serializable {
-    /**
-     * logger instance
-     */
-    private static final Logger log = LoggerFactory.getLogger(AbstractQValue.class);
+    private static final long serialVersionUID = 6976433831974695272L;
-            return ((Boolean) val).booleanValue();
+            return (Boolean) val;
-            return Boolean.valueOf(getString()).booleanValue();
+            return Boolean.valueOf(getString());
+     * @see QValue#getPath()
+     */
+    public String getString() throws RepositoryException {
+        if (type == PropertyType.BINARY) {
+            InputStream stream = getStream();
+            try {
+                return IOUtils.toString(stream, "UTF-8");
+            } catch (IOException e) {
+                throw new RepositoryException("conversion from stream to string failed", e);
+            } finally {
+                IOUtils.closeQuietly(stream);
+            }
+        } else if (type == PropertyType.DATE) {
+            return ISO8601.format(((Calendar) val));
+        } else {
+            return val.toString();
+        }
+    }
+
+    /**
+
-        return val.toString();
+        if (type == PropertyType.DATE) {
+            return ISO8601.format((Calendar) val);
+        } else {
+            return val.toString();
+        }
