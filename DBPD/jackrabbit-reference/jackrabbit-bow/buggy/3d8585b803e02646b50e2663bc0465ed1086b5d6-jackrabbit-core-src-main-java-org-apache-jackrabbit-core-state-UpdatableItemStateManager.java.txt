JCR-2272: Errors during concurrent session import of nodes with same UUIDs

Move node id generation into the createNew() method, and add a check for existing nodes when an existing node id is being used

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/branches/JCR-2272@1174016 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.id.NodeIdFactory;
+import javax.jcr.RepositoryException;
-     * @param id           the id of the node
+     * @param id the id of the node, or <code>null</code> for a new node id
-     * @throws IllegalStateException if the manager is not in edit mode.
+     * @throws RepositoryException if the node state can not be created
-    NodeState createNew(NodeId id, Name nodeTypeName,
-                        NodeId parentId) throws IllegalStateException;
+    NodeState createNew(
+            NodeId id, Name nodeTypeName, NodeId parentId)
+            throws RepositoryException;
-    NodeIdFactory getNodeIdFactory();
-
