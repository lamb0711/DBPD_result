JCR-1104 : JSR 283 support (security work in progress)

- user API: improve creation of new users
- user API: add distinction between declared and indirect group membership
- user Impl: move group membership to authorizable node type
- javadoc
- minor fixes/improvements

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@653726 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.security.principal.PrincipalImpl;
-import javax.jcr.Credentials;
-import javax.jcr.SimpleCredentials;
-     * The <code>userID</code> is expected to be a valid JCR-<code>Name</code>.
-     * @param credentials
-     * @see UserManager#createUser(String, Credentials, Principal principal)
+     * @param password
+     * @see UserManager#createUser(String,String)
-    public User createUser(String userID, Credentials credentials,
-                           Principal principal) throws RepositoryException {
-        return createUser(userID, credentials, principal, null);
+    public User createUser(String userID, String password) throws RepositoryException {
+        return createUser(userID, password, new PrincipalImpl(userID), null);
-     * @param credentials
+     * @param password
-    public User createUser(String userID, Credentials credentials,
+    public User createUser(String userID, String password,
-        if (userID == null || credentials == null || principal == null) {
+        if (userID == null || password == null || principal == null) {
-        if (!(credentials instanceof SimpleCredentials)) {
-            throw new RepositoryException("SimpleCredentials required. Found " + credentials.getClass());
-        } else if (!userID.equals(((SimpleCredentials) credentials).getUserID())) {
-            throw new RepositoryException("UserID mismatch: " + userID + " <-> " + ((SimpleCredentials) credentials).getUserID());
-        }
-            setSecurityProperty(userNode, P_USERID, getValue(userID));
-            CryptedSimpleCredentials creds = new CryptedSimpleCredentials((SimpleCredentials) credentials);
+            CryptedSimpleCredentials creds = new CryptedSimpleCredentials(userID, password);
+            setSecurityProperty(userNode, P_USERID, getValue(creds.getUserID()));
