porting to v0.16.4 of the jsr170 specification

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@161260 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.Constants;
-import org.apache.jackrabbit.core.Constants;
-    public String getPersistentQueryPath() throws ItemNotFoundException, RepositoryException {
+    public String getStoredQueryPath()
+            throws ItemNotFoundException, RepositoryException {
-    public void save(String absPath)
+    public Node storeAsNode(String absPath)
-                throw new RepositoryException(absPath + " is not an absolut path");
+                throw new RepositoryException(absPath + " is not an absolute path");
-            if (!session.getRootNode().hasNode(p.getAncestor(1).toJCRPath(resolver).substring(1))) {
+            if (session.itemExists(absPath)) {
+                throw new ItemExistsException(absPath);
+            }
+            if (!session.itemExists(p.getAncestor(1).toJCRPath(resolver))) {
-            if (session.getRootNode().hasNode(relPath)) {
-                throw new ItemExistsException(p.toJCRPath(resolver));
-            }
+            return node;
