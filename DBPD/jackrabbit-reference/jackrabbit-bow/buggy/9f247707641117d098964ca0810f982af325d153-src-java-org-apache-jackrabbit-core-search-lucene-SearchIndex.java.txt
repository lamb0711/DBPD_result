- Implemented a lucene Directory which works on top of the jackrabbit FileSystem abstraction.
- Changed location of lucene locks to index directory, instead of user temp dir.
- Changed order of module shutdown in RepositryImpl. shutdown sequence is now: observation, search, filesystem.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@53863 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.fs.FileSystem;
+import org.apache.jackrabbit.core.fs.FileSystemException;
+import org.apache.jackrabbit.core.fs.BasedFileSystem;
-    public SearchIndex(String location, Analyzer analyzer) throws IOException {
+    public SearchIndex(FileSystem fs, String location, Analyzer analyzer)
+            throws IOException {
-        persistentIndex = new PersistentIndex(location, analyzer);
-        persistentIndex.setUseCompoundFile(true);
-        this.location = location;
-        this.analyzer = analyzer;
+        boolean create;
+        try {
+            if (!fs.exists(location)) {
+                fs.createFolder(location);
+            }
+            FileSystem indexFS = new BasedFileSystem(fs, location);
+            create = !indexFS.exists("segments");
+            persistentIndex = new PersistentIndex(indexFS, create, analyzer);
+            persistentIndex.setUseCompoundFile(true);
+            this.location = location;
+            this.analyzer = analyzer;
+        } catch (FileSystemException e) {
+            throw new IOException(e.getMessage());
+        }
