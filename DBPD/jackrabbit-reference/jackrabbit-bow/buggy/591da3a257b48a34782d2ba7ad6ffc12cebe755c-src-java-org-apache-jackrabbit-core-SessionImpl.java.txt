adding Locking support contributed by Dominique Pfister

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@156949 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.ArrayList;
+import java.util.List;
+     * Lock tokens
+     */
+    protected final List lockTokens = new ArrayList();
+
+    /**
-    protected ItemManager getItemManager() {
+    public ItemManager getItemManager() {
+        // check lock status
+        destParentNode.checkLock();
+
+        // check lock status
+        parent.checkLock();
+
-        // @todo implement locking support
-        throw new UnsupportedOperationException("Locking not implemented yet.");
+        addLockToken(lt, true);
+    }
+
+    /**
+     * Internal implementation of {@link #addLockToken(String)}. Additionally
+     * takes a parameter indicating whether the lock manager needs to be
+     * informed.
+     */
+    public void addLockToken(String lt, boolean notify) {
+        synchronized (lockTokens) {
+            lockTokens.add(lt);
+
+            if (notify) {
+                try {
+                    wsp.getLockManager().lockTokenAdded(this, lt);
+                } catch (RepositoryException e) {
+                    log.error("Lock manager not available.", e);
+                }
+            }
+        }
-        // @todo implement locking support
-        return new String[0];
+        synchronized (lockTokens) {
+            String[] result = new String[lockTokens.size()];
+            lockTokens.toArray(result);
+            return result;
+        }
-        // @todo implement locking support
-        throw new UnsupportedOperationException("Locking not implemented yet.");
+        removeLockToken(lt, true);
+    }
+
+    /**
+     * Internal implementation of {@link #removeLockToken(String)}. Additionally
+     * takes a parameter indicating whether the lock manager needs to be
+     * informed.
+     */
+    public void removeLockToken(String lt, boolean notify) {
+        synchronized (lockTokens) {
+            lockTokens.remove(lt);
+
+            if (notify) {
+                try {
+                    wsp.getLockManager().lockTokenRemoved(this, lt);
+                } catch (RepositoryException e) {
+                    log.error("Lock manager not available.", e);
+                }
+            }
+        }
