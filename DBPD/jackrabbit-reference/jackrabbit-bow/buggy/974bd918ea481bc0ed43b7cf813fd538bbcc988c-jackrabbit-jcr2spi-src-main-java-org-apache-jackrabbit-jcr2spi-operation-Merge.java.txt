JCR-2104: JSR 283 Versioning (intermediate commit, work in progress)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@779101 13f79535-47bb-0310-9956-ffa450edef68

-        try {
-            NodeEntry vhe = mgr.getVersionHistoryEntry(nodeState);
-            if (vhe != null) {
-                vhe.invalidate(true);
+        if (isActivityMerge()) {
+            // TODO invalidate
+        } else {
+            try {
+                NodeEntry vhe = mgr.getVersionHistoryEntry(nodeState);
+                if (vhe != null) {
+                    vhe.invalidate(true);
+                }
+            } catch (RepositoryException e) {
+                log.warn("Error while retrieving VersionHistory entry:", e.getMessage());
-        } catch (RepositoryException e) {
-            log.warn("Error while retrieving VersionHistory entry:", e.getMessage());
+            nodeState.getHierarchyEntry().invalidate(true);
-        nodeState.getHierarchyEntry().invalidate(true);
+    public boolean isActivityMerge() {
+        return srcWorkspaceName == null;
+    }
+
