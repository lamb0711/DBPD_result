Polling thread should only get events if there are listeners.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@512987 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Collections;
-    private final Set listeners = Collections.synchronizedSet(new HashSet());
+    private final Set listeners = new HashSet();
-        listeners.add(listener);
+        synchronized (listeners) {
+            listeners.add(listener);
+            listeners.notify();
+        }
-        listeners.remove(listener);
+        synchronized (listeners) {
+            listeners.remove(listener);
+        }
-            InternalEventListener[] lstnrs = (InternalEventListener[]) listeners.toArray(new InternalEventListener[listeners.size()]);
+            InternalEventListener[] lstnrs;
+            synchronized (listeners) {
+                lstnrs = (InternalEventListener[]) listeners.toArray(new InternalEventListener[listeners.size()]);
+            }
-                    InternalEventListener[] iel = (InternalEventListener[]) listeners.toArray(new InternalEventListener[0]);
+                    InternalEventListener[] iel;
+                    synchronized (listeners) {
+                        while (listeners.isEmpty()) {
+                            listeners.wait();
+                        }
+                        iel = (InternalEventListener[]) listeners.toArray(new InternalEventListener[0]);
+                    }
