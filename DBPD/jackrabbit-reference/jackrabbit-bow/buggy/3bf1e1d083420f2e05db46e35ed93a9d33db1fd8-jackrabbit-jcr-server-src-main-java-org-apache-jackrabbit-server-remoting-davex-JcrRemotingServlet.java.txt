JCR-2113 : JSR 283 Access Control Management (patch provided by alfusainey jallow, commit with minor modifications and some TODOs (in particular testing).

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1646435 13f79535-47bb-0310-9956-ffa450edef68

+    /**
+     * the 'protectedhandlers-config' init paramter.
+     */
+    public static final String INIT_PARAM_PROTECTED_HANDLERS_CONFIG = "protectedhandlers-config";
+    
+    private ProtectedRemoveManager protectedRemoveManager;
+        String protectedHandlerConfig = getServletConfig().getInitParameter(INIT_PARAM_PROTECTED_HANDLERS_CONFIG);
+        try {
+            protectedRemoveManager = new ProtectedRemoveManager(protectedHandlerConfig);
+        } catch (IOException e) {
+            log.debug("Unable to create ProtectedRemoveManager from " + protectedHandlerConfig + ".");
+        }
+
-                    processDiff(session, targetPath, data);
+                    processDiff(session, targetPath, data, protectedRemoveManager);
-                    loc = modifyContent(session, targetPath, data);
+                    loc = modifyContent(session, targetPath, data, protectedRemoveManager);
-    private static void processDiff(Session session, String targetPath, RequestData data)
+    private static void processDiff(Session session, String targetPath, RequestData data, ProtectedRemoveManager protectedRemoveManager)
-        DiffHandler handler = new JsonDiffHandler(session, targetPath, data);
+        DiffHandler handler = new JsonDiffHandler(session, targetPath, data, protectedRemoveManager);
-    private static String modifyContent(Session session, String targetPath, RequestData data)
+    private static String modifyContent(Session session, String targetPath, RequestData data, ProtectedRemoveManager protectedRemoveManager)
-        JsonDiffHandler dh = new JsonDiffHandler(session, targetPath, data);
+        JsonDiffHandler dh = new JsonDiffHandler(session, targetPath, data, protectedRemoveManager);
