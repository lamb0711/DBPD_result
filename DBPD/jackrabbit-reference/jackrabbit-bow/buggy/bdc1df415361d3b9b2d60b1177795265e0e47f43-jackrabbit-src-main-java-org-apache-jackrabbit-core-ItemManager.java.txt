JCR-552 Move listeners from item state to item state managers


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@438851 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.state.SessionItemStateManager;
+import org.apache.jackrabbit.core.state.ItemStateListener;
-public class ItemManager implements ItemLifeCycleListener, Dumpable {
+public class ItemManager implements ItemLifeCycleListener, Dumpable, ItemStateListener {
-    protected ItemManager(ItemStateManager itemStateProvider, HierarchyManager hierMgr,
+    protected ItemManager(SessionItemStateManager itemStateProvider, HierarchyManager hierMgr,
+        itemStateProvider.addListener(this);
+
+    //----------------------------------------------------< ItemStateListener >
+
+    /**
+     * {@inheritDoc}
+     */
+    public void stateCreated(ItemState created) {
+        ItemImpl item = retrieveItem(created.getId());
+        if (item != null) {
+            item.stateCreated(created);
+        }
+    }
+
+    /**
+     * {@inheritDoc}
+     */
+    public void stateModified(ItemState modified) {
+        ItemImpl item = retrieveItem(modified.getId());
+        if (item != null) {
+            item.stateModified(modified);
+        }
+    }
+
+    /**
+     * {@inheritDoc}
+     */
+    public void stateDestroyed(ItemState destroyed) {
+        ItemImpl item = retrieveItem(destroyed.getId());
+        if (item != null) {
+            item.stateDestroyed(destroyed);
+        }
+    }
+
+    /**
+     * {@inheritDoc}
+     */
+    public void stateDiscarded(ItemState discarded) {
+        ItemImpl item = retrieveItem(discarded.getId());
+        if (item != null) {
+            item.stateDiscarded(discarded);
+        }
+    }
