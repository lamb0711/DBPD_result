- JCR-17 Creating and saving a mix:versionable node creates two VersionHistory nodes
- JCR-18 Multithreading issue with versioning


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@76106 13f79535-47bb-0310-9956-ffa450edef68

-        EffectiveNodeType entExisting, entNew;
+        EffectiveNodeType entExisting;
-            entNew = ntReg.buildEffectiveNodeType((QName[]) set.toArray(new QName[set.size()]));
+            ntReg.buildEffectiveNodeType((QName[]) set.toArray(new QName[set.size()]));
-
-            // check for special node types
-            // todo consolidate version history creation code (currently in NodeImpl.addMixin & ItemImpl.initVersionHistories
-            if (!entExisting.includesNodeType(NodeTypeRegistry.MIX_VERSIONABLE) &&
-                    entNew.includesNodeType(NodeTypeRegistry.MIX_VERSIONABLE)) {
-                // node has become 'versionable', initialize version history
-                VersionHistory hist = session.versionMgr.createVersionHistory(this);
-                internalSetProperty(VersionManager.PROPNAME_VERSION_HISTORY, InternalValue.create(new UUID(hist.getUUID())));
-                internalSetProperty(VersionManager.PROPNAME_BASE_VERSION, InternalValue.create(new UUID(hist.getRootVersion().getUUID())));
-                internalSetProperty(VersionManager.PROPNAME_IS_CHECKED_OUT, InternalValue.create(true));
-                internalSetProperty(VersionManager.PROPNAME_PREDECESSORS, new InternalValue[]{InternalValue.create(new UUID(hist.getRootVersion().getUUID()))});
-            }
