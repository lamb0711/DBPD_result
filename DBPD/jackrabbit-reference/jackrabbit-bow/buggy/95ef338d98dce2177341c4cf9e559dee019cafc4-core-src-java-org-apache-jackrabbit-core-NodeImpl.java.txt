fixing concurrency issue that could lead to inconsistent repository content

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@240263 13f79535-47bb-0310-9956-ffa450edef68

-        // copy state from transient state:
-        // parent uuid's
-        persistentState.setParentUUID(transientState.getParentUUID());
-        // mixin types
-        persistentState.setMixinTypeNames(transientState.getMixinTypeNames());
-        // id of definition
-        persistentState.setDefinitionId(transientState.getDefinitionId());
-        // child node entries
-        persistentState.setChildNodeEntries(transientState.getChildNodeEntries());
-        // property entries
-        persistentState.setPropertyNames(transientState.getPropertyNames());
-        // make state persistent
-        stateMgr.store(persistentState);
+        synchronized (persistentState) {
+            // copy state from transient state:
+            // parent uuid's
+            persistentState.setParentUUID(transientState.getParentUUID());
+            // mixin types
+            persistentState.setMixinTypeNames(transientState.getMixinTypeNames());
+            // id of definition
+            persistentState.setDefinitionId(transientState.getDefinitionId());
+            // child node entries
+            persistentState.setChildNodeEntries(transientState.getChildNodeEntries());
+            // property entries
+            persistentState.setPropertyNames(transientState.getPropertyNames());
+
+            // make state persistent
+            stateMgr.store(persistentState);
+        }
+
