JCR-552 Move listeners from item state to item state managers


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@438851 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.state.ItemStateListener;
+import org.apache.jackrabbit.core.state.ItemState;
-public class VersionManagerImpl extends AbstractVersionManager {
+public class VersionManagerImpl extends AbstractVersionManager implements ItemStateListener {
+
+            stateMgr.addListener(this);
+
+    /**
+     * {@inheritDoc}
+     * <p/>
+     * Not used.
+     */
+    public void stateCreated(ItemState created) {}
+
+    /**
+     * {@inheritDoc}
+     * <p/>
+     * Not used.
+     */
+    public void stateModified(ItemState modified) {}
+
+    /**
+     * {@inheritDoc}
+     * <p/>
+     * Remove item from cache on removal.
+     */
+    public void stateDestroyed(ItemState destroyed) {
+        // evict removed item from cache
+        aquireReadLock();
+        versionItems.remove(destroyed.getId());
+        releaseReadLock();
+    }
+
+    /**
+     * {@inheritDoc}
+     * <p/>
+     * Not used.
+     */
+    public void stateDiscarded(ItemState discarded) {}
+
