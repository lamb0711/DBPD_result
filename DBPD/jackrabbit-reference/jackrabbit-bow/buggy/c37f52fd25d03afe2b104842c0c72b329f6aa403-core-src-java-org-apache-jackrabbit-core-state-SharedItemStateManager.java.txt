- seperating VersionManagerImpl from ItemStateProvider to avoid potential deadlocks during checkin.
- VersionItemStateProvider returns now shared item states
- Node References handling adjusted

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@267207 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.ArrayList;
-        // set of virtual node references
-        // todo: remember by provider
-        ArrayList virtualRefs = new ArrayList();
-
-                // if targetid is in virtual provider, transfer to its modified set
-                for (int i = 0; i < virtualProviders.length; i++) {
-                    VirtualItemStateProvider provider = virtualProviders[i];
-                    if (provider.hasItemState(id)) {
-                        virtualRefs.add(refs);
-                        refs = null;
-                        break;
+                if (refs.hasReferences()) {
+                    if (!local.has(id) && !hasItemState(id)) {
+                        String msg = "Target node " + id
+                                + " of REFERENCE property does not exist";
+                        throw new ItemStateException(msg);
-                if (refs != null) {
-                    if (refs.hasReferences()) {
-                        if (!local.has(id) && !hasItemState(id)) {
-                            String msg = "Target node " + id
-                                    + " of REFERENCE property does not exist";
-                            throw new ItemStateException(msg);
-                        }
-                    }
-                    shared.modified(refs);
-                }
+                shared.modified(refs);
-            /* notify virtual providers about node references */
-            iter = virtualRefs.iterator();
-            while (iter.hasNext()) {
-                NodeReferences refs = (NodeReferences) iter.next();
-                // if targetid is in virtual provider, transfer to its modified set
-                for (int i = 0; i < virtualProviders.length; i++) {
-                    if (virtualProviders[i].setNodeReferences(refs)) {
-                        break;
-                    }
-                }
-            }
-
