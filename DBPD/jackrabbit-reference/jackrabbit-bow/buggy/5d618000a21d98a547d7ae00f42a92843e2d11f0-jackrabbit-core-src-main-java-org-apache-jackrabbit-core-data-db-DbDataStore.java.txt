JCR-1838 Garbage collection deletes temporary files in DataStore

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@727402 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.List;
+    
+    /**
+     * The temporary identifiers that are currently in use.
+     */
+    protected List temporaryInUse = Collections.synchronizedList(new ArrayList());
+        String id = null, tempId = null;
-            String id = null, tempId = null;
+            temporaryInUse.add(tempId);
+            if (tempId != null) {
+                temporaryInUse.remove(tempId);
+            }
-            Iterator it = new ArrayList(inUse.keySet()).iterator();
-            while (it.hasNext()) {
+            ArrayList touch = new ArrayList();
+            for (Iterator it = new ArrayList(inUse.keySet()).iterator(); it.hasNext();) {
-                    touch(identifier, 0);
+                    touch.add(identifier.toString());
+            touch.addAll(temporaryInUse);
+            Iterator it = touch.iterator();
+            while (it.hasNext()) {
+                String key = (String) it.next();
+                updateLastModifiedDate(key, 0);
+            }
+        return updateLastModifiedDate(identifier.toString(), lastModified);
+    }
+
+    private long updateLastModifiedDate(String key, long lastModified) throws DataStoreException {
-                        n, identifier.toString(), n
+                        n, key, n
