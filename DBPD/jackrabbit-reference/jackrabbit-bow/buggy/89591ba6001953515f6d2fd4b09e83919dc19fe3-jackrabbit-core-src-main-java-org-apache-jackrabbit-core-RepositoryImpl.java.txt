JCR-1589: JSR 283 Retention & Hold Management (work in progress)
JCR-1957: Move common validation checks to a single place

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@738422 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.retention.RetentionRegistry;
+import org.apache.jackrabbit.core.retention.RetentionRegistryImpl;
+     * Returns the {@link org.apache.jackrabbit.core.retention.RetentionRegistry} for the workspace with name
+     * <code>workspaceName</code>
+     *
+     * @param workspaceName workspace name
+     * @return <code>RetentionEvaluator</code> for the workspace
+     * @throws NoSuchWorkspaceException if such a workspace does not exist
+     * @throws RepositoryException      if some other error occurs
+     */
+    RetentionRegistry getRetentionRegistry(String workspaceName) throws NoSuchWorkspaceException, RepositoryException {
+        // check sanity of this instance
+        sanityCheck();
+        return getWorkspaceInfo(workspaceName).getRetentionRegistry();
+    }
+
+    /**
+         * internal manager for evaluation of effective retention policies
+         * and holds
+         */
+        private RetentionRegistryImpl retentionReg;
+
+        /**
+         * Return manager used for evaluating effect retention and holds.
+         *
+         * @return
+         * @throws RepositoryException
+         */
+        protected RetentionRegistry getRetentionRegistry() throws RepositoryException {
+            if (!isInitialized()) {
+                throw new IllegalStateException("workspace '" + getName() + "' not initialized");
+            }
+            synchronized (this) {
+                if (retentionReg == null) {
+                    retentionReg = new RetentionRegistryImpl(getSystemSession(), fs);
+                }
+                return retentionReg;
+            }
+        }
+
+        /**
+            // close retention registry
+            if (retentionReg != null) {
+                retentionReg.close();
+                retentionReg = null;
+            }
+
-                log.error("error while closing file system of workspace "
-                        + config.getName(), fse);
+                log.error("error while closing file system of workspace " + config.getName(), fse);
