JCR-1612: Reintroduce NamespaceStorage and namespace-caching

Make NamespaceRegistryImpl implement StringIndex and simplify the downstream classes accordingly.

To make this happen I modified the StringIndex contract a bit, allowing (and, for indexToString, requiring) implementations to throw exceptions if an unknown index is requested. Modified implementing classes accordingly.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@681121 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.util.StringIndex;
-public class NamespaceRegistryImpl
-        implements NamespaceRegistry, NamespaceResolver, NamespaceEventListener {
+public class NamespaceRegistryImpl implements
+        NamespaceRegistry, NamespaceResolver,
+        NamespaceEventListener, StringIndex {
+    //-------------------------------------------------------< StringIndex >--
+
-     * Returns the index (i.e. stable prefix) for the given uri.
+     * Returns the index (i.e. stable prefix) for the given namespace URI.
-     * @param uri the uri to retrieve the index for
-     * @return the index
-     * @throws NamespaceException if the URI is not registered.
+     * @param uri namespace URI
+     * @return namespace index
+     * @throws IllegalArgumentException if the namespace is not registered
-    public int getURIIndex(String uri) throws NamespaceException {
+    public int stringToIndex(String uri) {
-            throw new NamespaceException("URI " + uri + " is not registered.");
+            throw new IllegalArgumentException("Namespace not registered: " + uri);
-     * Returns the URI for a given index (i.e. stable prefix).
+     * Returns the namespace URI for a given index (i.e. stable prefix).
-     * @param idx the index to retrieve the uri for.
-     * @return the uri
-     * @throws NamespaceException if the URI is not registered.
+     * @param idx namespace index
+     * @return namespace URI
+     * @throws IllegalArgumentException if the given index is invalid
-    public String getURI(int idx) throws NamespaceException {
+    public String indexToString(int idx) {
-            throw new NamespaceException("URI for index " + idx +  " not registered.");
+            throw new IllegalArgumentException("Invalid namespace index: " + idx);
