JCR-993: corrupted paths after moving nodes


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@552445 13f79535-47bb-0310-9956-ffa450edef68

+
+            /**
+             * Do not cache paths to elements if the parent is transient, since
+             * children may be reordered multiple times (see JCR-993). If a
+             * child's position is cached at some intermediate stage but the
+             * total reordering effectively leaves the child at its initial
+             * position, the child's bad position is hardly detectable.
+             */
+            try {
+                NodeId parentId = state.getParentId();
+                if (parentId != null && provider.getItemState(parentId).isTransient()) {
+                    return;
+                }
+            } catch (ItemStateException e) {
+                String msg = "Unable to retrieve parent state of: " + id;
+                log.warn(msg, e);
+            }
+
