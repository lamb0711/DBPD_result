JCR-367 - Remove dependency on Xerces
   Part 2: JAXP Transform instead of Xerces Serializer

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@418357 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.xml.serialize.OutputFormat;
-import org.apache.xml.serialize.XMLSerializer;
+import javax.xml.transform.OutputKeys;
+import javax.xml.transform.Result;
+import javax.xml.transform.TransformerException;
+import javax.xml.transform.TransformerFactory;
+import javax.xml.transform.sax.SAXTransformerFactory;
+import javax.xml.transform.sax.TransformerHandler;
+import javax.xml.transform.stream.StreamResult;
+
-        boolean indenting = false;
-        OutputFormat format = new OutputFormat("xml", "UTF-8", indenting);
-        XMLSerializer serializer = new XMLSerializer(out, format);
+
+        SAXTransformerFactory stf = (SAXTransformerFactory) SAXTransformerFactory.newInstance();
+
-            exportDocumentView(absPath, serializer.asContentHandler(),
-                    skipBinary, noRecurse);
+            TransformerHandler th = stf.newTransformerHandler();
+            th.setResult(new StreamResult(out));
+            th.getTransformer().setParameter(OutputKeys.METHOD, "xml");
+            th.getTransformer().setParameter(OutputKeys.ENCODING, "UTF-8");
+            th.getTransformer().setParameter(OutputKeys.INDENT, "no");
+
+            exportDocumentView(absPath, th, skipBinary, noRecurse);
+        } catch (TransformerException te) {
+            throw new RepositoryException(te);
-        boolean indenting = false;
-        OutputFormat format = new OutputFormat("xml", "UTF-8", indenting);
-        XMLSerializer serializer = new XMLSerializer(out, format);
+
+        SAXTransformerFactory stf = (SAXTransformerFactory) SAXTransformerFactory.newInstance();
-            exportSystemView(absPath, serializer.asContentHandler(),
-                    skipBinary, noRecurse);
+            TransformerHandler th = stf.newTransformerHandler();
+            th.setResult(new StreamResult(out));
+            th.getTransformer().setParameter(OutputKeys.METHOD, "xml");
+            th.getTransformer().setParameter(OutputKeys.ENCODING, "UTF-8");
+            th.getTransformer().setParameter(OutputKeys.INDENT, "no");
+
+            exportSystemView(absPath, th, skipBinary, noRecurse);
+        } catch (TransformerException te) {
+            throw new RepositoryException(te);
