JCR-325: Applied the namespace-context.patch that makes the namespace context immutable and thus safe to use even after the processing of the current XML element.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@387959 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.name.NamespaceResolver;
+import java.util.Map;
-    protected final NamespaceResolver nsContext;
-    protected TargetImportHandler(Importer importer,
-                                  NamespaceResolver nsContext) {
+    /**
+     * The current namespace context. A new namespace context is created
+     * for each XML element and the parent reference is used to link the
+     * namespace contexts together in a tree hierarchy. This variable contains
+     * a reference to the namespace context associated with the XML element
+     * that is currently being processed.
+     */
+    protected NamespaceContext nsContext;
+
+    protected TargetImportHandler(Importer importer) {
-        this.nsContext = nsContext;
+            nsContext = null;
+    /**
+     * Starts a local namespace context for the current XML element.
+     * This method is called by {@link ImportHandler} when the processing of
+     * an XML element starts. The given local namespace mappings have been
+     * recorded by {@link ImportHandler#startPrefixMapping(String, String)}
+     * for the current XML element.
+     *
+     * @param mappings local namespace mappings
+     */
+    public final void startNamespaceContext(Map mappings) {
+        nsContext = new NamespaceContext(nsContext, mappings);
+    }
+
+    /**
+     * Restores the parent namespace context. This method is called by
+     * {@link ImportHandler} when the processing of an XML element ends.
+     */
+    public final void endNamespaceContext() {
+        nsContext = nsContext.getParent();
+    }
+
