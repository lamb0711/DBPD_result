JCR-619: CacheManager (Memory Management in Jackrabbit)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@475223 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.state.CacheManager;
+import org.apache.jackrabbit.core.state.ItemStateCacheFactory;
+import org.apache.jackrabbit.core.state.ManagedMLRUItemStateCacheFactory;
+     * There is one cache manager per repository that manages the sizes of the caches used.
+     */
+    private final CacheManager cacheMgr = new CacheManager();
+
+    /**
+     * There is only one item state cache factory
+     */
+    private final ItemStateCacheFactory cacheFactory = new ManagedMLRUItemStateCacheFactory(cacheMgr);
+
+    /**
+     * Get the item state cache factory of this repository.
+     *
+     * @return the cache manager
+     */
+    public ItemStateCacheFactory getItemStateCacheFactory() {
+        return cacheFactory;
+    }
+
+    /**
-                VERSION_STORAGE_NODE_ID, SYSTEM_ROOT_NODE_ID);
+                VERSION_STORAGE_NODE_ID, SYSTEM_ROOT_NODE_ID, cacheFactory);
-                            new SharedItemStateManager(persistMgr, rootNodeId, ntReg, true);
+                            new SharedItemStateManager(persistMgr, rootNodeId, ntReg, true, cacheFactory);
