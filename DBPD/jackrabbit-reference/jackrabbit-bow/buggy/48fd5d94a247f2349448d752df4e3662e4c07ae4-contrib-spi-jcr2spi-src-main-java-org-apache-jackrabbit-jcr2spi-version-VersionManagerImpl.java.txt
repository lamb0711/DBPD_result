work in progress

- removeVersion missing
- LockManager/VersionManager: should not rely on observation (todo added)
- Add Operation.persisted() (Impl. still missing) in analogy to ChangeLog.persisted.
- ItemImpl.refresh behaves according to CacheBehaviour flag.
- NodeState: fix classcastexception when accessing state from propertiesInAttic
- ItemState: rename 'refresh()' to 'reload()
- ItemState: move code common to PropertyState and NodeState to ItemState
- ItemState: rename 'reset' to 'merge'
- add common interface ChildItemEntry
- SessionItemStateManager: avoid traversing twice during 'undo'

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@477095 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.jcr2spi.operation.Remove;
+import org.apache.jackrabbit.jcr2spi.operation.RemoveVersion;
+import javax.jcr.UnsupportedRepositoryOperationException;
-        Operation op = Remove.create(wspVersionState);
+        Operation op = RemoveVersion.create(wspVersionState);
+        // TODO : needs to be fixed... repository may not support observation
+        EventFilter eventFilter;
+        try {
+            eventFilter = workspaceManager.createEventFilter(Event.ALL_TYPES, nodeState.getQPath(), true, null, null, false);
+        } catch (UnsupportedRepositoryOperationException e) {
+            eventFilter = null;
+        }
-        final EventFilter eventFilter = workspaceManager.createEventFilter(
-                Event.ALL_TYPES, nodeState.getQPath(), true, null, null, false);
+        final Collection fts = (eventFilter == null) ? Collections.EMPTY_LIST : Collections.singletonList(eventFilter);
+
-
-                return Collections.singletonList(eventFilter);
+                return fts;
-
