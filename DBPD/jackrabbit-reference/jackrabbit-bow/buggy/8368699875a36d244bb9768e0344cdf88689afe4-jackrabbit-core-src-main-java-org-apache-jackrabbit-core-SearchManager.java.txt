JCR-734: Update namespace uri for prefix fn

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@504206 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.NamespaceException;
-    // @todo this is not final! What should we use?
-    public static final String NS_FN_URI = "http://www.w3.org/2004/10/xpath-functions";
+    public static final String NS_FN_URI = "http://www.w3.org/2005/xpath-functions";
+
+    /**
+     * Deprecated namespace URI for xpath functions
+     */
+    private static final String NS_FN_OLD_PREFIX = "fn_old";
+    public static final String NS_FN_OLD_URI = "http://www.w3.org/2004/10/xpath-functions";
+        try {
+            if (nsReg.getPrefix(NS_FN_OLD_URI).equals(NS_FN_PREFIX)) {
+                // old uri is mapped to 'fn' prefix -> re-map
+                String prefix;
+                for (int i = 0; ; i++) {
+                    try {
+                        nsReg.getURI(NS_FN_OLD_PREFIX + i);
+                    } catch (NamespaceException e) {
+                        // not mapped to uri
+                        prefix = NS_FN_OLD_PREFIX + i;
+                        break;
+                    }
+                }
+                nsReg.registerNamespace(prefix, NS_FN_OLD_URI);
+            }
+        } catch (NamespaceException e) {
+            // does not yet exist
+            nsReg.safeRegisterNamespace(NS_FN_OLD_PREFIX, NS_FN_OLD_URI);
+        }
+        // at this point the 'fn' prefix shouldn't be assigned anymore
