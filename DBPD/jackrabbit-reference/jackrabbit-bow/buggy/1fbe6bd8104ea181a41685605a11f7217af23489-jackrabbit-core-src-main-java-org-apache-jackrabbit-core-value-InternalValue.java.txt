JCR-3083 Degrade gracefully when reading invalid date values

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1176423 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.TimeZone;
-                return new InternalValue(value.getString());
+                return new InternalValue(value.getString(), PropertyType.STRING);
-        return new InternalValue(value);
+        return new InternalValue(value, PropertyType.STRING);
+    
+    /**
+     * https://issues.apache.org/jira/browse/JCR-3083
+     * 
+     * @param value
+     * @return the created value
+     */
+    public static InternalValue createDate(String value) {
+        InternalValue iv = new InternalValue(Calendar.getInstance(TimeZone.getTimeZone("GMT+00:00")));
+        iv.val = value;
+        return iv;
+    }
-    public Calendar getDate() {
+    public Calendar getDate() throws RepositoryException {
-        try {
-            return getCalendar();
-        } catch (RepositoryException ignore) {
-            assert false;
-            return null;
-        }
+        return getCalendar();
-    private InternalValue(String value) {
-        super(value, PropertyType.STRING);
+    private InternalValue(String value, int type) {
+        super(value, type);
-
+    
-                return that.type == PropertyType.DATE
-                    && getDate().getTimeInMillis() == that.getDate().getTimeInMillis();
+                try {
+                    return that.type == PropertyType.DATE
+                            && getDate().getTimeInMillis() == that.getDate()
+                                    .getTimeInMillis();
+                } catch (RepositoryException e) {
+                    return false;
+                }
