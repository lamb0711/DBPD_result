JCR-1600: Remove noLockHack in SharedItemStateManager

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@657031 13f79535-47bb-0310-9956-ffa450edef68

-import EDU.oswego.cs.dl.util.concurrent.ReadWriteLock;
-     * JCR-447: deadlock might occur when this manager is still write-locked and events are dispatched.
-     */
-    private boolean noLockHack = false;
-
-    /**
-    private final ReadWriteLock rwLock = new ReentrantWriterPreferenceReadWriteLock() {
-        /**
-         * Allow reader when there is no active writer, or current thread owns
-         * the write lock (reentrant).
-         */
-        protected boolean allowReader() {
-            return activeWriter_ == null
-                    || activeWriter_ == Thread.currentThread()
-                    || noLockHack;
-        }
-    };
-
-    /**
-     * enables or disables the write-lock hack.
-     *
-     * @param noLockHack
-     */
-    public void setNoLockHack(boolean noLockHack) {
-        this.noLockHack = noLockHack;
-    }
+    private final RWLock rwLock = new RWLock();
+
+    private static final class RWLock extends ReentrantWriterPreferenceReadWriteLock {
+
+        /**
+         * Allow reader when there is no active writer, or current thread owns
+         * the write lock (reentrant).
+         */
+        protected boolean allowReader() {
+            return activeWriter_ == null
+                    || activeWriter_ == Thread.currentThread();
+        }
+    }
