JCR-623 - Clustering
+ Transmit namespace registrations
+ Transmit nodetype registrations


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@482707 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.cluster.NodeTypeEventChannel;
+import org.apache.jackrabbit.core.cluster.NodeTypeEventListener;
-public class NodeTypeRegistry implements Dumpable {
+public class NodeTypeRegistry implements Dumpable, NodeTypeEventListener {
+     * Node type event channel.
+     */
+    private NodeTypeEventChannel eventChannel;
+
+    /**
+        if (eventChannel != null) {
+            HashSet ntDefs = new HashSet();
+            ntDefs.add(ntd);
+            eventChannel.registered(ntDefs);
+        }
+
+
+        // inform cluster
+        if (eventChannel != null) {
+            eventChannel.registered(ntDefs);
+        }
+
+    //------------------------------------------------< NodeTypeEventListener >
+
+    /**
+     * {@inheritDoc}
+     */
+    public void externalRegistered(Collection ntDefs)
+            throws RepositoryException, InvalidNodeTypeDefException {
+
+        // validate and register new node type definitions
+        internalRegister(ntDefs);
+        // persist new node type definitions
+        for (Iterator iter = ntDefs.iterator(); iter.hasNext();) {
+            NodeTypeDef ntDef = (NodeTypeDef) iter.next();
+            customNTDefs.add(ntDef);
+        }
+        persistCustomNodeTypeDefs(customNTDefs);
+        // notify listeners
+        for (Iterator iter = ntDefs.iterator(); iter.hasNext();) {
+            NodeTypeDef ntDef = (NodeTypeDef) iter.next();
+            notifyRegistered(ntDef.getName());
+        }
+    }
+
+     * Set an event channel to inform about changes.
+     *
+     * @param eventChannel event channel
+     */
+    public void setEventChannel(NodeTypeEventChannel eventChannel) {
+        this.eventChannel = eventChannel;
+        eventChannel.setListener(this);
+    }
+
+
+    /**
