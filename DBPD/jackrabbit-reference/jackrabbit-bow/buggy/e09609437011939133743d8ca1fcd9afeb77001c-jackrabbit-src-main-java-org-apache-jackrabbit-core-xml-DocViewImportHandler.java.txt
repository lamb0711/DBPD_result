JCR-325: Applied the xml-refactoring.patch that puts the PropInfo instances in charge of applying the imported property values to content nodes.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@387961 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.Value;
+
-    private BufferedStringValue textHandler = new BufferedStringValue();
+    private BufferedStringValue textHandler = null;
-            textHandler = new BufferedStringValue();
+            textHandler = new BufferedStringValue(nsContext);
-                Importer.NodeInfo node =
-                        new Importer.NodeInfo(QName.JCR_XMLTEXT, null, null, null);
-                Importer.TextValue[] values =
-                        new Importer.TextValue[]{textHandler};
+                NodeInfo node =
+                        new NodeInfo(QName.JCR_XMLTEXT, null, null, null);
+                TextValue[] values =
+                        new TextValue[]{textHandler};
-                Importer.PropInfo prop =
-                        new Importer.PropInfo(QName.JCR_XMLCHARACTERS,
-                                PropertyType.STRING, values);
+                PropInfo prop = new PropInfo(
+                        QName.JCR_XMLCHARACTERS, PropertyType.STRING, values);
-                importer.startNode(node, props, nsContext);
+                importer.startNode(node, props);
-                Importer.TextValue[] propValues;
+                TextValue[] propValues;
-                propValues = new Importer.TextValue[1];
-                propValues[0] = new StringValue(attrValue);
+                propValues = new TextValue[1];
+                propValues[0] = new StringValue(attrValue, nsContext);
-                            String val = ((StringValue) propValues[j]).retrieve();
+                            Value value = 
+                                propValues[j].getValue(PropertyType.NAME, nsContext);
-                                mixinTypes[j] = QName.fromJCRName(val, nsContext);
+                                mixinTypes[j] =
+                                    QName.fromJCRName(value.getString(), nsContext);
-                                        + val, ne);
+                                        + value.getString(), ne);
-                    props.add(new Importer.PropInfo(propName,
-                            PropertyType.UNDEFINED, propValues));
+                    props.add(new PropInfo(
+                            propName, PropertyType.UNDEFINED, propValues));
-            Importer.NodeInfo node =
-                    new Importer.NodeInfo(nodeName, nodeTypeName, mixinTypes, id);
+            NodeInfo node =
+                    new NodeInfo(nodeName, nodeTypeName, mixinTypes, id);
-            importer.startNode(node, props, nsContext);
+            importer.startNode(node, props);
-        Importer.NodeInfo node = (Importer.NodeInfo) stack.peek();
+        NodeInfo node = (NodeInfo) stack.peek();
