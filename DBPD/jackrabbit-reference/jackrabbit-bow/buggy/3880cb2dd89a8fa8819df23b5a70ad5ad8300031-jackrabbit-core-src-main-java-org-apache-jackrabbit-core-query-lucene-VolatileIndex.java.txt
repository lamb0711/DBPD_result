JCR-1222: Index nodes in parallel

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@596654 13f79535-47bb-0310-9956-ffa450edef68

-     * Overwrites the default implementation by adding the document to a
+     * Overwrites the default implementation by adding the documents to a
-     * @param doc the document to add to the index.
+     * @param docs the documents to add to the index.
-    void addDocument(Document doc) throws IOException {
-        Document old = (Document) pending.put(doc.get(FieldNames.UUID), doc);
-        if (old != null) {
-            Util.disposeDocument(old);
-        }
-        if (pending.size() >= bufferSize) {
-            commitPending();
+    void addDocuments(Document[] docs) throws IOException {
+        for (int i = 0; i < docs.length; i++) {
+            Document old = (Document) pending.put(docs[i].get(FieldNames.UUID), docs[i]);
+            if (old != null) {
+                Util.disposeDocument(old);
+            }
+            if (pending.size() >= bufferSize) {
+                commitPending();
+            }
+            numDocs++;
-        numDocs++;
-        for (Iterator it = pending.values().iterator(); it.hasNext();) {
-            Document doc = (Document) it.next();
-            super.addDocument(doc);
-            it.remove();
-        }
+        super.addDocuments((Document[]) pending.values().toArray(
+                new Document[pending.size()]));
+        pending.clear();
