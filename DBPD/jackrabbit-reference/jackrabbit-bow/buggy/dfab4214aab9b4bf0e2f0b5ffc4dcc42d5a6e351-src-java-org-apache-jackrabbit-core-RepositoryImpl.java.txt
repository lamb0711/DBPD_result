- rearranging structure of versioning (will corrupt versioned data)
- adding observation of version storage (work in progress)


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@159366 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.observation.DelegatingObservationDispatcher;
-import java.security.AccessControlContext;
-import java.security.AccessController;
+    /** the deletagin observation dispatcher for all workspaces */
+    private final DelegatingObservationDispatcher delegatingDispatcher = new DelegatingObservationDispatcher();
+
-        vMgr = new VersionManagerImpl(pvMgr, ntReg, VERSION_STORAGE_NODE_UUID, SYSTEM_ROOT_NODE_UUID);
+        vMgr = new VersionManagerImpl(pvMgr, ntReg, delegatingDispatcher, VERSION_STORAGE_NODE_UUID, SYSTEM_ROOT_NODE_UUID);
+
+        // register the observation factory of that workspace
+        delegatingDispatcher.addDispatcher(getObservationManagerFactory(wspName));
