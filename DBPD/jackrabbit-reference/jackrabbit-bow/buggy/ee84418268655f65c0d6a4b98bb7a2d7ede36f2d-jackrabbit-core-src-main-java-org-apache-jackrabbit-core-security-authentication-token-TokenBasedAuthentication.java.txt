JCR-2851 - Authentication Mechanism Based on Login Token

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1073299 13f79535-47bb-0310-9956-ffa450edef68

-                if (!name.startsWith(TOKEN_ATTRIBUTE)) {
+                if (!isMandatoryAttribute(name)) {
+     * Returns <code>true</code> if the given <code>credentials</code> object
+     * is an instance of <code>TokenCredentials</code>.
-     * @return
+     * @return <code>true</code> if the given <code>credentials</code> object
+     * is an instance of <code>TokenCredentials</code>; <code>false</code> otherwise.
+     * Returns <code>true</code> if the specified <code>attributeName</code>
+     * starts with or equals {@link #TOKEN_ATTRIBUTE}.
+     *  
+     * @param attributeName
+     * @return <code>true</code> if the specified <code>attributeName</code>
+     * starts with or equals {@link #TOKEN_ATTRIBUTE}.
+     */
+    public static boolean isMandatoryAttribute(String attributeName) {
+        return attributeName != null && attributeName.startsWith(TOKEN_ATTRIBUTE);
+    }
+
+    /**
+     * Returns <code>true</code> if the specified <code>credentials</code>
+     * should be used to create a new login token.
-     * @return
+     * @return <code>true</code> if upon successful authentication a new
+     * login token should be created; <code>false</code> otherwise.
-            tokenCredentials = new TokenCredentials(tokenNode.getIdentifier());
+            String token = tokenNode.getIdentifier();
+            tokenCredentials = new TokenCredentials(token);
+            credentials.setAttribute(TOKEN_ATTRIBUTE, token);
