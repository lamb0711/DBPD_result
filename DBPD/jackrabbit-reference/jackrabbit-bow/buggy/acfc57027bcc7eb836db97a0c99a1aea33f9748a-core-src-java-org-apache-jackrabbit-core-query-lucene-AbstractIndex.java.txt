JCR-197: Index merging should run in a separate thread

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@264144 13f79535-47bb-0310-9956-ffa450edef68

-    protected synchronized ReadOnlyIndexReader getReadOnlyIndexReader()
+    synchronized ReadOnlyIndexReader getReadOnlyIndexReader()
-
-    protected synchronized void commit() throws IOException {
+    protected void commit() throws IOException {
+        commit(false);
+    }
+
+    /**
+     * Commits all pending changes to the underlying <code>Directory</code>.
+     *
+     * @param optimize if <code>true</code> the index is optimized after after
+     *                 the commit.
+     * @throws IOException if an error occurs while commiting changes.
+     */
+    protected synchronized void commit(boolean optimize) throws IOException {
+        // optimize if requested
+        if (optimize) {
+            IndexWriter writer = getIndexWriter();
+            writer.optimize();
+        }
