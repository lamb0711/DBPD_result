JCR-594: It's not possible to register event listeners that filters on mixin supertypes

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@464496 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.nodetype.NodeTypeManagerImpl;
+import org.apache.jackrabbit.name.QName;
+import org.slf4j.LoggerFactory;
+import org.slf4j.Logger;
+import javax.jcr.nodetype.NoSuchNodeTypeException;
+import java.util.HashSet;
+import java.util.Iterator;
+import java.util.Collections;
+     * The logger instance for this class.
+     */
+    private static final Logger log = LoggerFactory.getLogger(EventState.class);
+
+    /**
+     * Set of node types. This Set consists of the primary node type and all
+     * mixin types assigned to the associated parent node of this event state.
+     * </p>
+     * This <code>Set</code> is initialized when
+     * {@link #getNodeTypes(NodeTypeManagerImpl)} is called for the first time.
+     */
+    private Set allTypes;
+
+    /**
+     * Returns the <code>Set</code> of {@link javax.jcr.nodetype.NodeType}s
+     * assigned to the parent node associated with this event. This
+     * <code>Set</code> includes the primary type as well as all the mixin types
+     * assigned to the parent node.
+     *
+     * @return <code>Set</code> of {@link javax.jcr.nodetype.NodeType}s.
+     */
+    public Set getNodeTypes(NodeTypeManagerImpl ntMgr) {
+        if (allTypes == null) {
+            Set tmp = new HashSet();
+            tmp.add(nodeType);
+            for (Iterator it = mixins.iterator(); it.hasNext(); ) {
+                QName mixinName = (QName) it.next();
+                try {
+                    tmp.add(ntMgr.getNodeType(mixinName));
+                } catch (NoSuchNodeTypeException e) {
+                    log.warn("Unknown node type: " + mixinName);
+                }
+            }
+            allTypes = Collections.unmodifiableSet(tmp);
+        }
+        return allTypes;
+    }
+
+    /**
