- adapted versioning again to spec 0.15
- added VirtualItemStateManager for reflecting virtual content


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@55615 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.version.VersionManager;
+     * The version manager for this session
+     */
+    protected final VersionManager versionMgr;
+
+    /**
+        versionMgr = rep.getPersistentVersionManager()==null?null:rep.getPersistentVersionManager().getVersionManager();
+
+        // add virtual item managers only for normal sessions
+        if (!(this instanceof SystemSession)) {
+            try {
+                itemStateMgr.addVirtualItemStateProvider(versionMgr.getVirtualItemStateProvider(itemStateMgr));
+            } catch (Exception e) {
+                log.error("Unable to add vmgr: " + e.toString(), e);
+            }
+        }
+        versionMgr = rep.getPersistentVersionManager()==null?null:rep.getPersistentVersionManager().getVersionManager();
+
+        // add virtual item managers only for normal sessions
+        if (!(this instanceof SystemSession)) {
+            try {
+                itemStateMgr.addVirtualItemStateProvider(versionMgr.getVirtualItemStateProvider(itemStateMgr));
+            } catch (Exception e) {
+                log.error("Unable to add vmgr: " + e.toString(), e);
+            }
+        }
