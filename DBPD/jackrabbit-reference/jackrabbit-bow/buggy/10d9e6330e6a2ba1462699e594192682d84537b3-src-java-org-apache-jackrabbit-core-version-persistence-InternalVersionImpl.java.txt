- fixing some versioning persistence problems

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@124539 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.state.NodeState;
-            // assuming only child
-            PersistentNode[] nodes = node.getChildNodes();
-            return nodes.length==0 ? null : (InternalFrozenNode) getVersionManager().getItemByInternal(nodes[0].getUUID());
+            NodeState.ChildNodeEntry entry = node.getState().getChildNodeEntry(VersionManager.NODENAME_FROZEN, 1);
+            if (entry==null) {
+                throw new IllegalStateException("version has no frozen node: " + getId());
+            }
+            return (InternalFrozenNode) getVersionManager().getItemByInternal(entry.getUUID());
-            // ignore
+            throw new IllegalStateException("unable to retrieve frozen node: " + e);
-        return null;
