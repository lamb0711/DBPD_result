JAAS support 

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@155344 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.security.AccessManager;
+import org.apache.jackrabbit.core.security.SimpleAccessManager;
+import org.apache.jackrabbit.core.security.SystemPrincipal;
-import javax.jcr.RepositoryException;
+import javax.jcr.RepositoryException;
+import javax.security.auth.Subject;
+import java.util.Collections;
+import java.util.HashSet;
+import java.util.Set;
-    private static final String SYSTEM_USER_ID = "system";
+    /**
+     * Package private factory method
+     *
+     * @param rep
+     * @param wspConfig
+     * @return
+     * @throws RepositoryException
+     */
+    static SystemSession create(RepositoryImpl rep, WorkspaceConfig wspConfig)
+            throws RepositoryException {
+        // create subject with SystemPrincipal
+        Set principals = new HashSet();
+        principals.add(new SystemPrincipal());
+        Subject subject =
+                new Subject(true, principals, Collections.EMPTY_SET,
+                        Collections.EMPTY_SET);
+        return new SystemSession(rep, subject, wspConfig);
+    }
-     * Package private constructor.
+     * private constructor
-    SystemSession(RepositoryImpl rep, WorkspaceConfig wspConfig)
+    private SystemSession(RepositoryImpl rep, Subject subject,
+                          WorkspaceConfig wspConfig)
-        super(rep, SYSTEM_USER_ID, wspConfig);
+        super(rep, subject, wspConfig);
+    }
-        accessMgr = new SystemAccessManqager(hierMgr);
+    /**
+     * Overridden in order to create custom access manager
+     *
+     * @return access manager
+     */
+    protected AccessManager createAccessManager(Subject subject,
+                                                HierarchyManager hierMgr) {
+        //return new SystemAccessManager(subject, hierMgr);
+        return super.createAccessManager(subject, hierMgr);
-    private class SystemAccessManqager extends AccessManagerImpl {
+    private class SystemAccessManager extends SimpleAccessManager {
-        SystemAccessManqager(HierarchyManager hierMgr) {
-            super(null, hierMgr);
+        SystemAccessManager(Subject subject, HierarchyManager hierMgr) {
+            super(subject, hierMgr);
