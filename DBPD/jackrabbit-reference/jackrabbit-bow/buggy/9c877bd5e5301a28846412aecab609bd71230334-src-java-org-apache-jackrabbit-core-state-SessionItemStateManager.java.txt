fixed bug that occured when calling Node.setProperty, specifying a non-existing property and an illegal value: 

exception was thrown but property had nevertheless been created with null value

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@106099 13f79535-47bb-0310-9956-ffa450edef68

-        return transientStateMgr.hasItemStateInAttic(id)
-                || transientStateMgr.hasItemState(id)
-                || persistentStateMgr.hasItemState(id)
-                || hasVirtualItemState(id);
+	// first check if the specified item has been transiently removed
+	if (transientStateMgr.hasItemStateInAttic(id)) {
+	    /**
+	     * check if there's new transient state for the specified item
+	     * (e.g. if a property with name 'x' has been removed and a new
+	     * property with same name has been created);
+	     */
+	    return transientStateMgr.hasItemState(id);
+	}
+
+	// check if there's transient state for the specified item
+	if (transientStateMgr.hasItemState(id)) {
+	    return true;
+	}
+
+	// check if there is a virtual state for the specified item
+	for (int i = 0; i < virtualProviders.length; i++) {
+	    if (virtualProviders[i].hasItemState(id)) {
+		return true;
+	    }
+	}
+
+	// check if there's persistent state for the specified item
+	if (persistentStateMgr.hasItemState(id)) {
+	    return true;
+	}
+
+	return false;
