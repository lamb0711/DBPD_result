Use namespace prefixes supplied with request to execute the query.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@483369 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.NamespaceRegistry;
+import java.util.Map;
+import java.util.Iterator;
-        Node rootNode = getRepositorySession().getRootNode();
+        Session session = getRepositorySession();
+        NamespaceRegistry nsReg = session.getWorkspace().getNamespaceRegistry();
+        Node rootNode = session.getRootNode();
-            q = qMgr.createQuery(sInfo.getQuery(), sInfo.getLanguageName());
+            // apply namespace mappings to session
+            Map namespaces = sInfo.getNamespaces();
+            try {
+                for (Iterator it = namespaces.keySet().iterator(); it.hasNext(); ) {
+                    String prefix = (String) it.next();
+                    String uri = (String) namespaces.get(prefix);
+                    session.setNamespacePrefix(prefix, uri);
+                }
+                q = qMgr.createQuery(sInfo.getQuery(), sInfo.getLanguageName());
+            } finally {
+                // reset namespace mappings
+                for (Iterator it = namespaces.values().iterator(); it.hasNext(); ) {
+                    String uri = (String) it.next();
+                    try {
+                        session.setNamespacePrefix(nsReg.getPrefix(uri), uri);
+                    } catch (RepositoryException e) {
+                        log.warn("Unable to reset mapping of namespace: " + uri);
+                    }
+                }
+            }
