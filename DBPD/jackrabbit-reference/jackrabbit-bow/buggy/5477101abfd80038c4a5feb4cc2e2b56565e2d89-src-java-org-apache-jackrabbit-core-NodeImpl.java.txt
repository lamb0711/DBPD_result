some cleaning up in NodeImpl & PropertyImpl as suggested by angela (JCR-114)

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@164488 13f79535-47bb-0310-9956-ffa450edef68

-            propState = stateMgr.createTransientPropertyState(parentUUID, name, ItemState.STATUS_NEW);
+            propState =
+                    stateMgr.createTransientPropertyState(parentUUID, name,
+                            ItemState.STATUS_NEW);
-            String msg = "failed to add property " + name + " to " + safeGetJCRPath();
+            String msg = "failed to add property " + name + " to "
+                    + safeGetJCRPath();
-    protected synchronized NodeImpl createChildNode(QName name, NodeDefinitionImpl def,
-                                                    NodeTypeImpl nodeType, String uuid)
+    protected synchronized NodeImpl createChildNode(QName name,
+                                                    NodeDefinitionImpl def,
+                                                    NodeTypeImpl nodeType,
+                                                    String uuid)
-            nodeState = stateMgr.createTransientNodeState(uuid, nodeType.getQName(), parentUUID, ItemState.STATUS_NEW);
+            nodeState =
+                    stateMgr.createTransientNodeState(uuid, nodeType.getQName(),
+                            parentUUID, ItemState.STATUS_NEW);
-            String msg = "failed to add child node " + name + " to " + safeGetJCRPath();
+            String msg = "failed to add child node " + name + " to "
+                    + safeGetJCRPath();
-            node.createChildNode(nd.getQName(), nd, (NodeTypeImpl) nd.getDefaultPrimaryType(), null);
+            node.createChildNode(nd.getQName(), nd,
+                    (NodeTypeImpl) nd.getDefaultPrimaryType(), null);
-            throw new RepositoryException("invalid property name: " + propName, ine);
+            throw new RepositoryException("invalid property name: "
+                    + propName, ine);
-            throw new RepositoryException("invalid property name: " + propName, upe);
+            throw new RepositoryException("invalid property name: "
+                    + propName, upe);
-            String msg = "failed to remove property " + propName + " of " + safeGetJCRPath();
+            String msg = "failed to remove property " + propName + " of "
+                    + safeGetJCRPath();
-    protected void removeChildNode(QName nodeName, int index) throws RepositoryException {
+    protected void removeChildNode(QName nodeName, int index)
+            throws RepositoryException {
-        NodeState.ChildNodeEntry entry = thisState.getChildNodeEntry(nodeName, index);
+        NodeState.ChildNodeEntry entry =
+                thisState.getChildNodeEntry(nodeName, index);
-            String msg = "failed to remove child " + nodeName + " of " + safeGetJCRPath();
+            String msg = "failed to remove child " + nodeName + " of "
+                    + safeGetJCRPath();
-            String msg = "failed to remove child " + nodeName + " of " + safeGetJCRPath();
+            String msg = "failed to remove child " + nodeName + " of "
+                    + safeGetJCRPath();
-        NodeDefinitionImpl newDef = session.getNodeTypeManager().getNodeDefinition(defId);
+        NodeDefinitionImpl newDef =
+                session.getNodeTypeManager().getNodeDefinition(defId);
-                NodeState.ChildNodeEntry entry = (NodeState.ChildNodeEntry) tmp.get(i);
+                NodeState.ChildNodeEntry entry =
+                        (NodeState.ChildNodeEntry) tmp.get(i);
-                NodeState.PropertyEntry entry = (NodeState.PropertyEntry) tmp.get(i);
+                NodeState.PropertyEntry entry =
+                        (NodeState.PropertyEntry) tmp.get(i);
-            nodePath = Path.create(getPrimaryPath(), relPath, session.getNamespaceResolver(), true);
+            nodePath =
+                    Path.create(getPrimaryPath(), relPath,
+                            session.getNamespaceResolver(), true);
-            String msg = "failed to resolve path " + relPath + " relative to " + safeGetJCRPath();
+            String msg = "failed to resolve path " + relPath + " relative to "
+                    + safeGetJCRPath();
-            String msg = safeGetJCRPath() + ": cannot add a child to a checked-in node";
+            String msg = safeGetJCRPath()
+                    + ": cannot add a child to a checked-in node";
-    protected NodeImpl internalAddChildNode(QName nodeName, NodeTypeImpl nodeType)
-            throws ItemExistsException, ConstraintViolationException, RepositoryException {
+    protected NodeImpl internalAddChildNode(QName nodeName,
+                                            NodeTypeImpl nodeType)
+            throws ItemExistsException, ConstraintViolationException,
+            RepositoryException {
-    protected NodeImpl internalAddChildNode(QName nodeName, NodeTypeImpl nodeType, String uuid)
-            throws ItemExistsException, ConstraintViolationException, RepositoryException {
+    protected NodeImpl internalAddChildNode(QName nodeName,
+                                            NodeTypeImpl nodeType, String uuid)
+            throws ItemExistsException, ConstraintViolationException,
+            RepositoryException {
+     * Checks various pre-conditions that are common to all
+     * <code>setProperty()</code> methods. The checks performed are:
+     * <ul>
+     * <li>this node must be checked-out</li>
+     * <li>this node must not be locked by somebody else</li>
+     * </ul>
+     * Note that certain checks are performed by the respective
+     * <code>Property.setValue()</code> methods. 
+     *
+     * @throws VersionException if this node is not checked-out
+     * @throws LockException if this node is locked by somebody else
+     * @throws RepositoryException if another error occurs
+     *
+     * @see javax.jcr.Node#setProperty
+     */
+    protected void checkSetProperty()
+            throws VersionException, LockException, RepositoryException {
+        // make sure this node is checked-out
+        if (!internalIsCheckedOut()) {
+            String msg = safeGetJCRPath()
+                    + ": cannot set property of a checked-in node";
+            log.debug(msg);
+            throw new VersionException(msg);
+        }
+
+        // check lock status
+        checkLock();
+    }
+
+    /**
+     * @throws ConstraintViolationException
-            RepositoryException {
+            ConstraintViolationException, RepositoryException {
+     * @throws ConstraintViolationException
-            RepositoryException {
+            ConstraintViolationException, RepositoryException {
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath()
-                    + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
+     * @throws ConstraintViolationException
-            RepositoryException {
+            ConstraintViolationException, RepositoryException {
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath()
-                    + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
-        // make sure this node is checked-out
-        if (!internalIsCheckedOut()) {
-            String msg = safeGetJCRPath() + ": cannot set property of a checked-in node";
-            log.debug(msg);
-            throw new VersionException(msg);
-        }
-
-        // check lock status
-        checkLock();
+        // check pre-conditions for setting property
+        checkSetProperty();
