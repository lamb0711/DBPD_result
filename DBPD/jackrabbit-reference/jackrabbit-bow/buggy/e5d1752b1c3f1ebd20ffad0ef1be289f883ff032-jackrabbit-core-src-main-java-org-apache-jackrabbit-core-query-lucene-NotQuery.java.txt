JCR-2415: Update Lucene to 3.0
- Merge all from JCR-2415-lucene-3.0 at 1064038 (reintegration)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1064058 13f79535-47bb-0310-9956-ffa450edef68

+@SuppressWarnings("serial")
-    protected Weight createWeight(Searcher searcher) {
+    public Weight createWeight(Searcher searcher) {
-    private class NotQueryWeight implements Weight {
+    private class NotQueryWeight extends Weight {
-        public Scorer scorer(IndexReader reader) throws IOException {
-            contextScorer = context.weight(searcher).scorer(reader);
+        public Scorer scorer(IndexReader reader, boolean scoreDocsInOrder,
+                boolean topScorer) throws IOException {
+            contextScorer = context.weight(searcher).scorer(reader, scoreDocsInOrder, topScorer);
-        /**
-         * {@inheritDoc}
-         */
-        public boolean next() throws IOException {
+        @Override
+        public int nextDoc() throws IOException {
+            if (docNo == NO_MORE_DOCS) {
+                return docNo;
+            }
+
-                if (contextScorer.next()) {
-                    contextNo = contextScorer.doc();
+                int docId = contextScorer.nextDoc();
+                if (docId != NO_MORE_DOCS) {
+                    contextNo = docId;
-                if (contextScorer.next()) {
-                    contextNo = contextScorer.doc();
-                } else {
-                    contextNo = -1;
-                }
+                int docId = contextScorer.nextDoc();
+                contextNo = docId == NO_MORE_DOCS ? -1 : docId;
-            return docNo < reader.maxDoc();
-        }
-
-        /**
-         * {@inheritDoc}
-         */
-        public int doc() {
+            if (docNo >= reader.maxDoc()) {
+                docNo = NO_MORE_DOCS;
+            }
-        /**
-         * {@inheritDoc}
-         */
+        @Override
+        public int docID() {
+            return docNo;
+        }
+
+        @Override
-        /**
-         * {@inheritDoc}
-         */
-        public boolean skipTo(int target) throws IOException {
+        @Override
+        public int advance(int target) throws IOException {
+            if (docNo == NO_MORE_DOCS) {
+                return docNo;
+            }
+
-                if (contextScorer.skipTo(target)) {
-                    contextNo = contextScorer.doc();
-                } else {
-                    contextNo = -1;
-                }
+                int docId = contextScorer.advance(target);
+                contextNo = docId == NO_MORE_DOCS ? -1 : docId;
-            return next();
+            return nextDoc();
-        /**
-         * @throws UnsupportedOperationException always
-         */
-        public Explanation explain(int doc) throws IOException {
-            throw new UnsupportedOperationException();
-        }
