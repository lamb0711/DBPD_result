- adding 'Handle monitor' to track open filehandles on windows boxes (see [JCR-128]

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@180286 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.FileInputStream;
+import java.io.FileInputStream;
+    private HandleMonitor monitor = null;
+
+        log.info("LocaaFileSystem initialized on " + root.getPath());
+        if (monitor != null) {
+            log.info("LocalFileSystem using handle monitor");
+        }
+            if (monitor != null && monitor.isOpen(f)) {
+                log.error("Unable to delete. Still open streams");
+                monitor.dump(f);
+            }
+
-            return new FileInputStream(f);
+            if (monitor == null) {
+                return new FileInputStream(f);
+            } else {
+                return monitor.open(f);
+            }
+
+    /**
+     * Enables the usage of the handle monitor.
+     *
+     * @param enable
+     */
+    public void setEnableHandleMonitor(String enable) {
+        setEnableHandleMonitor(Boolean.valueOf(enable).booleanValue());
+    }
+
+
+    /**
+     * Returns if the handle monitor is enabled
+     */
+    public String getEnableHandleMonitor() {
+        return monitor == null ? "false" : "true";
+    }
+
+
+    /**
+     * Enables the usage of the handle monitor.
+     *
+     * @param enable
+     */
+    public void setEnableHandleMonitor(boolean enable) {
+        if (enable && monitor == null) {
+            monitor = new HandleMonitor();
+        }
+        if (!enable && monitor != null) {
+            monitor = null;
+        }
+    }
