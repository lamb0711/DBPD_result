JCR-2104:  JSR 283 Full Versioning (work in progress)

- setActivity
- checkout with activity param -> spi level
- more checks in version manager
- invalidation after sucessful mergeActivity

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@803444 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.Repository;
+import org.apache.jackrabbit.spi.NodeId;
-            session.getVersionStateManager().checkout(getNodeState());
+            if (session.isSupportedOption(Repository.OPTION_ACTIVITIES_SUPPORTED)) {
+                NodeImpl activity = (NodeImpl) session.getWorkspace().getVersionManager().getActivity();
+                NodeId activityId = (activity == null) ? null : activity.getNodeState().getNodeId();
+                session.getVersionStateManager().checkout(getNodeState(), activityId);
+            } else {
+                session.getVersionStateManager().checkout(getNodeState());
+            }
