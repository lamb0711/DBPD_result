JCR-3098 Add hit miss statistics and logging to caches
 - patch by Bart van der Schans

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1182713 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.List;
+    /** The default minimum stats logging interval (in ms). */
+    private static final int DEFAULT_LOG_STATS_INTERVAL = 60 * 1000;
+
-        /** The last time the caches where resized. */
+    /** The minimum interval time between stats are logged */
+    private long minLogStatsInterval = Long.getLong(
+            "org.apache.jackrabbit.cacheLogStatsInterval",
+            DEFAULT_LOG_STATS_INTERVAL);
+
+    /** The last time the caches where resized. */
+    /** The last time the cache stats were logged. */
+    private volatile long nextLogStats =
+            System.currentTimeMillis() + DEFAULT_LOG_STATS_INTERVAL;
+
+
-    public void cacheAccessed() {
+    public void cacheAccessed(long accessCount) {
+
+        logCacheStats();
+
-     * Re-calcualte the maximum memory for each cache, and set the new limits.
+     * Log info about the caches.
+     */
+    private void logCacheStats() {
+        if (log.isDebugEnabled()) {
+            long now = System.currentTimeMillis();
+            if (now < nextLogStats) {
+                return;
+            }
+            for (Cache cache : caches.keySet()) {
+                log.debug(cache.getCacheInfoAsString());
+            }
+            nextLogStats = now + minLogStatsInterval;
+        }
+    }
+    /**
+     * Re-calculate the maximum memory for each cache, and set the new limits.
-        ArrayList<Cache> list = new ArrayList<Cache>();
+        List<Cache> list = new ArrayList<Cache>();
-            for (Cache c: caches.keySet()) {
-                list.add(c);
-            }
+            list.addAll(caches.keySet());
