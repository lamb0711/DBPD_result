JCR-1799 updating events swallowed (CacheBehavior.OBSERVATION)   	
JCR-1783 incomplete changelog when combining move with removal of new destination parent

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@704361 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.jcr2spi.state.ChangeLog;
+import org.apache.jackrabbit.jcr2spi.operation.Operation;
-     * @throws IllegalStateException If the entry has already been resolved.
-    public void setItemState(ItemState state) throws IllegalStateException;
+    public void setItemState(ItemState state);
-     * states with transient changes are left untouched in order to obtain stale
+     * states with transient changes are left untouched in order to detect stale
-     * Checks if the underlying <code>ItemState</code> is available and if it
-     * has been transiently modified or if is new or stale modified. If either of
-     * the conditions is true, the state is added to the <code>ChangeLog</code>.
-     * If this <code>HierarchyEntry</code> has children it will call
-     * {@link #collectStates(ChangeLog, boolean)} recursively.
+     * Clean up this entry upon {@link Operation#undo()} or {@link Operation#persisted()}.
-     * @param changeLog the <code>ChangeLog</code> collecting the transient
-     * item states present in a given tree.
-     * @param throwOnStale If the given flag is true, this methods throws
-     * InvalidItemStateException if this state is stale.
-     * @throws InvalidItemStateException if <code>throwOnStale</code> is true and
-     * this state is stale.
+     * @param transientOperation
-    public void collectStates(ChangeLog changeLog, boolean throwOnStale) throws InvalidItemStateException;
+    public void complete(Operation transientOperation) throws RepositoryException;
