work in progress

- NodeInfo does not load information about child-node-entries
  -> add separate SPI call
  -> add initial draft ChildInfo interface
  -> ChildNodeEntries are not built upon creation of the NodeState
  -> ItemStateFactory: add method to retrieve ChildNodeEntries

- respect CacheBehaviour while persisting transient modifications

- LockInfo.getNodeId() -> not used so far -> remove

- SessionItemStateManager: getHierarchyManager() only used by SessionImpl -> moved

- Improve TODO comments
- Javadoc


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@482657 13f79535-47bb-0310-9956-ffa450edef68

+    private final HierarchyManager hierarchyManager;
-        // build the state mananger
-        itemStateManager = createSessionItemStateManager(workspace.getUpdatableItemStateManager(), nsMappings);
-
-        itemManager = createItemManager(getHierarchyManager());
+        itemStateManager = createSessionItemStateManager(workspace.getUpdatableItemStateManager());
+        hierarchyManager = createHierarchyManager();
+        itemManager = createItemManager();
-    protected SessionItemStateManager createSessionItemStateManager(UpdatableItemStateManager workspaceStateManager, NamespaceResolver nsResolver) {
-        return new SessionItemStateManager(workspaceStateManager, getIdFactory(), getValidator(), nsResolver);
+    protected SessionItemStateManager createSessionItemStateManager(UpdatableItemStateManager workspaceStateManager) {
+        return new SessionItemStateManager(workspaceStateManager, getIdFactory(), getValidator());
-    protected ItemManager createItemManager(HierarchyManager hierarchyMgr) {
-        return new ItemManagerImpl(hierarchyMgr, this);
+    protected HierarchyManager createHierarchyManager() {
+        return new HierarchyManagerImpl(getItemStateManager(), getNamespaceResolver());
+    }
+
+    protected ItemManager createItemManager() {
+        return new ItemManagerImpl(getHierarchyManager(), this);
-        return itemStateManager.getHierarchyManager();
+        return hierarchyManager;
