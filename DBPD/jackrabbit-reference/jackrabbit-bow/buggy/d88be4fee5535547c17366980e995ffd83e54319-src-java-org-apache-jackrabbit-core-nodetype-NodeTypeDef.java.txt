more work on value constraints

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@109359 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.PropertyType;
-     * Returns a collection of node type <code>QName</code>s which are being referenced
-     * by this node type definition (e.g. in supertypes and/or in child node
-     * definitions).
+     * Returns a collection of node type <code>QName</code>s that are being
+     * referenced by <i>this</i> node type definition (e.g. as supertypes, as
+     * required/default primary types in child node definitions, as REFERENCE
+     * value constraints in property definitions).
+     * <p/>
+     * Note that self-references (e.g. a child node definition that specifies
+     * the declaring node type as the default primary type) are not considered 
+     * dependencies.
+            // supertypes
+            // child node definitions
+                // default primary type
+                // required primary type
+            // property definitions
+            for (int i = 0; i < propDefs.length; i++) {
+                // REFERENCE value constraints
+                if (propDefs[i].getRequiredType() == PropertyType.REFERENCE) {
+                    ValueConstraint[] ca = propDefs[i].getValueConstraints();
+                    if (ca != null) {
+                        for (int j = 0; j < ca.length; j++) {
+                            ReferenceConstraint rc = (ReferenceConstraint) ca[j];
+                            if (!name.equals(rc.getNodeTypeName())) {
+                                dependencies.add(rc.getNodeTypeName());
+                            }
+                        }
+                    }
+                }
+            }
