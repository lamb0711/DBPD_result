JCR-1176: MemoryFileSystem is different from other FileSystems
    - Fixed incorrect behavior in MemoryFileSystem
    - Fixed incorrect tests in AbstractFileSystemTest

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@585472 13f79535-47bb-0310-9956-ffa450edef68

-        assertExistence(folderPath);
-        if (hasChildren(folderPath)) {
-            throw new FileSystemException(folderPath + " not empty");
+        assertIsFolder(folderPath);
+        Set allNames = entries.keySet();
+        Set selectedNames = new HashSet();
+        for (Iterator iter = allNames.iterator(); iter.hasNext();) {
+            String name = (String) iter.next();
+            if (name.startsWith(folderPath)) {
+                selectedNames.add(name);
+            }
-        entries.remove(folderPath);
+        for (Iterator iter = selectedNames.iterator(); iter.hasNext();) {
+            String name = (String) iter.next();
+            entries.remove(name);
+        }
-                selectedNames.add(name);
+                selectedNames.add(name.substring(folderPath.length() + 1));
-        String[] entryPaths = list(folderPath);
-        Set resultEntryPaths = new HashSet();
-        for (int i = 0; i < entryPaths.length; i++) {
-            String entryPath = entryPaths[i];
-            MemoryFileSystemEntry entry = getEntry(entryPath);
-            if (entry.isFolder() == isFolder) {
-                resultEntryPaths.add(entryPath);
+        String[] names = list(folderPath);
+        if (folderPath.equals("/")) {
+            folderPath = "";
+        }
+        Set result = new HashSet();
+        for (int i = 0; i < names.length; i++) {
+            if (getEntry(folderPath + "/" + names[i]).isFolder() == isFolder) {
+                result.add(names[i]);
-        return (String[]) resultEntryPaths.toArray(new String[0]);
+        return (String[]) result.toArray(new String[0]);
