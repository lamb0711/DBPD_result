JCR-131: simplifying internal data model (NodeState) by limiting a node to *one* parent



git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@191499 13f79535-47bb-0310-9956-ffa450edef68

-                                    List childNodes = state.getChildNodeEntries(uuid);
-                                    if (childNodes.size() == 0) {
+                                    NodeState.ChildNodeEntry entry =
+                                            state.getChildNodeEntry(uuid);
+                                    if (entry == null) {
-                                        QName name = ((NodeState.ChildNodeEntry) childNodes.get(0)).getName();
-                                        childNodes = state.getChildNodeEntries(name);
+                                        QName name = entry.getName();
+                                        List childNodes = state.getChildNodeEntries(name);
-                                    List childNodes = state.getChildNodeEntries(uuid);
-                                    if (childNodes.size() == 0) {
+                                    NodeState.ChildNodeEntry entry =
+                                            state.getChildNodeEntry(uuid);
+                                    if (entry == null) {
-                                        for (int j = 0; j < childNodes.size(); j++) {
-                                            NodeState.ChildNodeEntry entry = (NodeState.ChildNodeEntry) childNodes.get(j);
-                                            if (entry.getIndex() != position) {
-                                                hits.flip(i);
-                                            }
+                                        if (entry.getIndex() != position) {
+                                            hits.flip(i);
