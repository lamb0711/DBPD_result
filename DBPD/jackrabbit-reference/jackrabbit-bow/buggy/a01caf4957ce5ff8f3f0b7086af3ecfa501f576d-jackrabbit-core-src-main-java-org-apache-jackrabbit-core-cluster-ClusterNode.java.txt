JCR-1753: Allow means force a Repository to synchronize with the cluster

Synchronize with the cluster whenever Session.refresh(boolean) is called, unless the "org.apache.jackrabbit.disableClusterSyncOnRefresh" attribute is set.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@792211 13f79535-47bb-0310-9956-ffa450edef68

+     * Sync counter, used to avoid repeated sync() calls from piling up.
+     * Only updated within the critical section guarded by {@link #syncLock}.
+     *
+     * @since Apache Jackrabbit 1.6
+     * @see <a href="https://issues.apache.org/jira/browse/JCR-1753">JCR-1753</a>
+     */
+    private volatile int syncCount = 0;
+
+    /**
+        int count = syncCount;
+
-            journal.sync();
+            // JCR-1753: Only synchronize if no other thread already did so
+            // while we were waiting to acquire the syncLock.
+            if (count == syncCount) {
+                journal.sync();
+                syncCount++;
+            }
