JCR-1564: JSR 283 namespace handling
    - No need for the NamespaceStorage interface, as 
      NamespaceRegistryImpl can just as well call RepositoryService directly

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@655574 13f79535-47bb-0310-9956-ffa450edef68

-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import javax.jcr.NamespaceException;
-import javax.jcr.UnsupportedRepositoryOperationException;
+import org.apache.jackrabbit.spi.RepositoryService;
+import org.apache.jackrabbit.spi.SessionInfo;
+
-    private static Logger log = LoggerFactory.getLogger(NamespaceRegistryImpl.class);
+    /**
+     * Repository service.
+     */
+    private final RepositoryService service;
-    private final NamespaceStorage storage;
+    /**
+     * Session info.
+     */
+    private final SessionInfo info;
-     * @param storage
+     * @param service repository service
+     * @param info session info
-    public NamespaceRegistryImpl(NamespaceStorage storage) {
-        this.storage = storage;
+    public NamespaceRegistryImpl(RepositoryService service, SessionInfo info) {
+        this.service = service;
+        this.info = info;
-    public void registerNamespace(String prefix, String uri) throws NamespaceException, UnsupportedRepositoryOperationException, RepositoryException {
-        storage.registerNamespace(prefix, uri);
+    public void registerNamespace(String prefix, String uri)
+            throws RepositoryException {
+        service.registerNamespace(info, prefix, uri);
-    public void unregisterNamespace(String prefix) throws NamespaceException, UnsupportedRepositoryOperationException, RepositoryException {
-        storage.unregisterNamespace(prefix);
+    public void unregisterNamespace(String prefix) throws RepositoryException {
+        service.unregisterNamespace(info, getURI(prefix));
-        Collection prefixes = storage.getRegisteredNamespaces().keySet();
+        Collection prefixes = service.getRegisteredNamespaces(info).keySet();
-        Collection uris = storage.getRegisteredNamespaces().values();
+        Collection uris = service.getRegisteredNamespaces(info).values();
-     * @see org.apache.jackrabbit.spi.commons.namespace.NamespaceResolver#getURI(String)
-    public String getURI(String prefix) throws NamespaceException {
-        // try to load the uri
-        try {
-            return storage.getURI(prefix);
-        } catch (RepositoryException ex) {
-            log.debug("Internal error while loading registered namespaces.");
-            throw new NamespaceException(prefix + ": is not a registered namespace prefix.");
-        }
+    public String getURI(String prefix) throws RepositoryException {
+        return service.getNamespaceURI(info, prefix);
-     * @see org.apache.jackrabbit.spi.commons.namespace.NamespaceResolver#getPrefix(String)
-    public String getPrefix(String uri) throws NamespaceException {
-        // try to load the prefix
-        try {
-            return storage.getPrefix(uri);
-        } catch (RepositoryException ex) {
-            log.debug("Internal error while loading registered namespaces.");
-            throw new NamespaceException(uri + ": is not a registered namespace uri.");
-        }
+    public String getPrefix(String uri) throws RepositoryException {
+        return service.getNamespacePrefix(info, uri);
