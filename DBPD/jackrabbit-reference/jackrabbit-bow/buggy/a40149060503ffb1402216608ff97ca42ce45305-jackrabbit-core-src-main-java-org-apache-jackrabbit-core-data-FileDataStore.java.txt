JCR-2674 FileDataStore ignores return code from setLastModified

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@964365 13f79535-47bb-0310-9956-ffa450edef68

-     * Creates a uninitialized data store.
-     *
-     */
-    public FileDataStore() {
-    }
-
-    /**
-    /**
-     * {@inheritDoc}
-     */
-    public DataRecord getRecordIfStored(DataIdentifier identifier) {
+    public DataRecord getRecordIfStored(DataIdentifier identifier) throws DataStoreException {
-                    file.setLastModified(System.currentTimeMillis() + ACCESS_TIME_RESOLUTION);
+                	    // The current GC approach depends on this call succeeding
+                    if (!file.setLastModified(System.currentTimeMillis() + ACCESS_TIME_RESOLUTION)) {
+                        throw new DataStoreException("Failed to update record modified date: " + identifier);
+                    }
-                    if (file.lastModified() < now) {
-                        file.setLastModified(now);
+                    if (file.lastModified() < now + ACCESS_TIME_RESOLUTION) {
+                        // The current GC approach depends on this call succeeding (for writable files)
+                        if (!file.setLastModified(now + ACCESS_TIME_RESOLUTION)) {
+                            if (file.canWrite()) {
+                                throw new DataStoreException("Failed to update record modified date: " + identifier);
+                            }
+                        }
-    /**
-     * {@inheritDoc}
-     */
-    /**
-     * {@inheritDoc}
-     */
-    /**
-     * {@inheritDoc}
-     */
-    /**
-     * {@inheritDoc}
-     */
-    /**
-     * {@inheritDoc}
-     */
-    /**
-     * {@inheritDoc}
-     */
+        // nothing to do
