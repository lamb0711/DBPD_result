JCR-1365: Query path constraints like foo//*/bar do not scale
- more performance improvements

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@629453 13f79535-47bb-0310-9956-ffa450edef68

-        IndexReader reader = getIndexReader(queryImpl.needsSystemTree());
-        return new JackrabbitIndexSearcher(session, reader).execute(query, sort);
+        final IndexReader reader = getIndexReader(queryImpl.needsSystemTree());
+        return new FilterQueryHits(new JackrabbitIndexSearcher(session, reader).execute(query, sort)) {
+            public void close() throws IOException {
+                try {
+                    super.close();
+                } finally {
+                    PerQueryCache.getInstance().dispose();
+                    reader.close();
+                }
+            }
+        };
