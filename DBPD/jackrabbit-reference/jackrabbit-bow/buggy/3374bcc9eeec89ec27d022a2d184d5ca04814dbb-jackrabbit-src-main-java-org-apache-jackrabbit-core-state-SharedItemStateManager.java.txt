JCR-447 deadlock on concurrent commit/locking

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@410655 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.version.XAVersionManager;
+     * special flag for then this manager is used by the version manager and
+     * transactional versioning operations. in this case, deadlocks could occurr
+     * (see issue JCR-447).
+     */
+    private boolean noLockHack = false;
+
+    /**
+                 * <p/>
+                 * the 'noLockHack' is only temporary (hopefully)
-                        || activeWriter_ == Thread.currentThread();
+                        || activeWriter_ == Thread.currentThread()
+                        || noLockHack;
+    /**
+     * enables or disables the write-lock hack. this should only be called by
+     * the {@link XAVersionManager}.
+     *
+     * @param noLockHack
+     */
+    public void setNoLockHack(boolean noLockHack) {
+        this.noLockHack = noLockHack;
+    }
+
