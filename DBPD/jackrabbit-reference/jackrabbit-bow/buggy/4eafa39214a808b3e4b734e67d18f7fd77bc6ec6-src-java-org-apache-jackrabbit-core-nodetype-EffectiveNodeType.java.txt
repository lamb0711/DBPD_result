- re-implementing Workspace methods (-> work in progress!)
- avoiding "#import bla.*" stmts (in accordance with checkstyle settings)

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@156666 13f79535-47bb-0310-9956-ffa450edef68

-                    /**
-                     * there already exists at least one definition with that
-                     * name; make sure none of them is auto-create
-                     */
+                    // there already exists at least one definition with that name
+                        // make sure none of them is auto-create
-                            String msg = "The item definition for '" + name + "' in node type '" + def.getDeclaringNodeType() + "' conflicts with node type '" + existingDef.getDeclaringNodeType() + "': name collision with auto-create definition";
+                            String msg = "The item definition for '" + name
+                                    + "' in node type '"
+                                    + def.getDeclaringNodeType()
+                                    + "' conflicts with node type '"
+                                    + existingDef.getDeclaringNodeType()
+                                    + "': name collision with auto-create definition";
+                        // check ambiguous definitions
+                        if (def.definesNode() == existingDef.definesNode()) {
+                            if (!def.definesNode()) {
+                                // property definition
+                                PropDef pd = (PropDef) def;
+                                PropDef epd = (PropDef) existingDef;
+                                // compare type & multiValued flag
+                                if (pd.getRequiredType() == epd.getRequiredType()
+                                        && pd.isMultiple() == epd.isMultiple()) {
+                                    // conflict
+                                    String msg = "The property definition for '"
+                                            + name + "' in node type '"
+                                            + def.getDeclaringNodeType()
+                                            + "' conflicts with node type '"
+                                            + existingDef.getDeclaringNodeType()
+                                            + "': ambiguous property definition";
+                                    log.debug(msg);
+                                    throw new NodeTypeConflictException(msg);
+                                }
+                            } else {
+                                // child node definition
+                                // conflict
+                                String msg = "The child node definition for '"
+                                        + name + "' in node type '"
+                                        + def.getDeclaringNodeType()
+                                        + "' conflicts with node type '"
+                                        + existingDef.getDeclaringNodeType()
+                                        + "': ambiguous child node definition";
+                                log.debug(msg);
+                                throw new NodeTypeConflictException(msg);
+                            }
+                        }
-                            String msg = "A property definition in node type '" + def.getDeclaringNodeType() + "' conflicts with node type '" + existing.getDeclaringNodeType() + "': ambiguos residual property definition";
+                            String msg = "A property definition in node type '"
+                                    + def.getDeclaringNodeType()
+                                    + "' conflicts with node type '"
+                                    + existing.getDeclaringNodeType()
+                                    + "': ambiguous residual property definition";
-                        String msg = "A child node definition in node type '" + def.getDeclaringNodeType() + "' conflicts with node type '" + existing.getDeclaringNodeType() + "': ambiguos residual child node definition";
+                        String msg = "A child node definition in node type '"
+                                + def.getDeclaringNodeType()
+                                + "' conflicts with node type '"
+                                + existing.getDeclaringNodeType()
+                                + "': ambiguous residual child node definition";
