JCR-258 - remove JDOM dependency from jcr-server contribution
JCR-295 - usage of Cache-Control header 
JCR-297 - log output while parsing xml
minor consistency issues and improvements

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@368683 13f79535-47bb-0310-9956-ffa450edef68

+    private OutputStream outStream;
-                return new FileOutputStream(outFile);
+                // clean up the stream retrieved by the preceeding handler, that
+                // did not behave properly and failed to export although initially
+                // willing to handle the export.
+                if (outStream != null) {
+                    outStream.close();
+                }
+                outStream = new FileOutputStream(outFile);
+                return outStream;
+        // make sure the outputStream gets closed (and don't assume the handlers
+        // took care of this.
+        if (outStream != null) {
+            try {
+                outStream.close();
+            } catch (IOException e) {
+                // ignore
+            }
+        }
+                boolean hasContentLength = false;
+                    // check for content-length
+                    hasContentLength = DavConstants.HEADER_CONTENT_LENGTH.equals(name);
+                        // make sure the content-length is set
+                        if (!hasContentLength) {
+                            outputCtx.setContentLength(outFile.length());
+                        }
