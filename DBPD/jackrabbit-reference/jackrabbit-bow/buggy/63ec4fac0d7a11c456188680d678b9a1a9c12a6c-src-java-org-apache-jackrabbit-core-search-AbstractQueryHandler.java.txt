redesigned transaction support & PersistenceManager

orginal code contributed by dominique pfister, required a lot of tweaking to make it run & work; not thoroughly tested

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@126221 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.state.ItemStateProvider;
+import org.apache.jackrabbit.core.state.ItemStateManager;
-    /** A <code>FileSystem</code> to store the search index */
+    /**
+     * A <code>FileSystem</code> to store the search index
+     */
-    /** The persistent <code>ItemStateProvider</code> */
-    private ItemStateProvider stateProvider;
+    /**
+     * The persistent <code>ItemStateManager</code>
+     */
+    private ItemStateManager stateProvider;
-     * @param fs a {@link org.apache.jackrabbit.core.fs.FileSystem} this
-     *  <code>QueryHandler</code> may use to store its index.
+     * @param fs            a {@link FileSystem} this
+     *                      <code>QueryHandler</code> may use to store its index.
-    public final void init(FileSystem fs, ItemStateProvider stateProvider)
+    public final void init(FileSystem fs, ItemStateManager stateProvider)
-     * Returns the persistent {@link org.apache.jackrabbit.core.state.ItemStateProvider}
+     * Returns the persistent {@link ItemStateManager}
-     *   workspace.
+     *         workspace.
-    protected ItemStateProvider getItemStateProvider() {
+    protected ItemStateManager getItemStateProvider() {
+     *
-     *   <code>QueryHandler</code>.
+     *         <code>QueryHandler</code>.
