Implement document order on query result.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@157170 13f79535-47bb-0310-9956-ffa450edef68

+     * If <code>true</code> nodes are returned in document order.
+     */
+    private final boolean docOrder;
+
+    /**
+     * @param docOrder    if <code>true</code> the result is returned in document
+     *  order.
-                           NamespaceResolver resolver) {
+                           NamespaceResolver resolver,
+                           boolean docOrder) {
+        this.docOrder = docOrder;
-        return new NodeIteratorImpl(itemMgr, uuids, scores);
+        return getNodeIterator();
-        return new RowIteratorImpl(new NodeIteratorImpl(itemMgr, uuids, scores), selectProps, resolver);
+        return new RowIteratorImpl(getNodeIterator(), selectProps, resolver);
+    }
+
+    /**
+     * Creates a node iterator over the result nodes.
+     * @return a node iterator over the result nodes.
+     */
+    private NodeIteratorImpl getNodeIterator() {
+        if (docOrder) {
+            return new DocOrderNodeIteratorImpl(itemMgr, uuids, scores);
+        } else {
+            return new NodeIteratorImpl(itemMgr, uuids, scores);
+        }
