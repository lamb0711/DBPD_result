JCR-2746 Sleep in possibly endless loop in ObservationDispatcher

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@999406 13f79535-47bb-0310-9956-ffa450edef68

-                while (eventQueueSize.get() > MAX_QUEUED_EVENTS) {
-                    try {
-                        Thread.sleep(100);
-                    } catch (InterruptedException e) {
-                        // ignore
-                    }
+                if (eventQueueSize.get() > MAX_QUEUED_EVENTS) {
+                    // slow down the current session
+                    // but not here, because locks are held
+                    // (that may block an observation listener, which is not what we want)
+                    events.getSession().delayNextOperation(notificationThread, 100);
