JCR-2363 - Node.orderBefore does not check permissions

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@831048 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.security.AccessManager;
+
+        /*
+        make sure the session is allowed to reorder child nodes.
+        since there is no specific privilege for reordering child nodes,
+        test if the the node to be reordered can be removed and added,
+        i.e. treating reorder similar to a move.
+        TODO: properly deal with sns in which case the index would change upon reorder.
+        */
+        AccessManager acMgr = session.getAccessManager();
+        PathBuilder pb = new PathBuilder(getPrimaryPath());
+        pb.addLast(srcName.getName(), srcName.getIndex());
+        Path childPath = pb.getPath();
+        if (!acMgr.isGranted(childPath, Permission.ADD_NODE | Permission.REMOVE_NODE)) {
+            String msg = "Not allowed to reorder child node " + session.getJCRPath(childPath) + ".";
+            log.debug(msg);
+            throw new AccessDeniedException(msg);
+        }
+        
