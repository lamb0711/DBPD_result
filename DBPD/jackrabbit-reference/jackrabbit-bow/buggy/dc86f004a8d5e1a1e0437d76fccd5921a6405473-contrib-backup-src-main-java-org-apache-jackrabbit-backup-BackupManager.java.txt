JCR-442: Committed Nicolas' latest contrib/backup changes (patch-backup-060728.txt) with some modifications.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@426435 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.IOException;
+
+import javax.jcr.LoginException;
+import javax.jcr.RepositoryException;
+
+ * It extends Backup since it is based on the same semantics. However it is not at the same type as a ResourceBackup (indicated by different names)
+ * 
-public class ManagerBackup extends Backup {
+public class BackupManager extends Backup {
-    public ManagerBackup(RepositoryImpl repo, BackupConfig conf) {
+    public BackupManager(RepositoryImpl repo, BackupConfig conf) throws LoginException, RepositoryException {
-        //The repository is a special Resource: it is added here to the list of resource
-        // It is not in the XML Conf file to make it more generic
-        this.conf.getAllResources().add(new RepositoryBackup(repo, conf));
+        //Initiate correctly all objects in allResources
+        Iterator it = this.conf.getAllResources().iterator();
+        
+        while(it.hasNext()) {
+            Backup b = (Backup) it.next();
+            b.init(repo, conf);
+        }
-    public static ManagerBackup create(RepositoryImpl impl, BackupConfig conf2) {
-		return new ManagerBackup(impl, conf2);
+    public static BackupManager create(RepositoryImpl impl, BackupConfig conf2) throws LoginException, RepositoryException {
+		return new BackupManager(impl, conf2);
+     * @throws RepositoryException 
+     * @throws IOException 
-    public void backup(BackupIOHandler h) {
+    public void backup(BackupIOHandler h) throws RepositoryException, IOException {
+        h.initBackup();
-            h.init();
+           
