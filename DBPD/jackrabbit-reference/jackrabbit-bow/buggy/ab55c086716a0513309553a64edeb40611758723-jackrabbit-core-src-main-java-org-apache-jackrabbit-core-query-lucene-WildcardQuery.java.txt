JCR-2790: jcr:like on node name

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1030038 13f79535-47bb-0310-9956-ffa450edef68

-     * Name of the property to search.
+     * Creates a term value for a given string.
-    private final String propName;
+    private final WildcardTermEnum.TermValueFactory tvf;
-     * How property values are tranformed before they are matched using the
+     * How property values are transformed before they are matched using the
-    public WildcardQuery(String field, String propName, String pattern, int transform) {
+    public WildcardQuery(String field, final String propName, String pattern, int transform) {
-        this.propName = propName;
+        if (propName != null) {
+            tvf = new WildcardTermEnum.TermValueFactory() {
+                @Override
+                public String createValue(String s) {
+                    return FieldNames.createNamedValue(propName, s);
+                }
+            };
+        } else {
+            tvf = new WildcardTermEnum.TermValueFactory();
+        }
-                return new WildcardTermEnum(reader, field, propName, pattern, transform);
+                return new WildcardTermEnum(reader, field, tvf, pattern, transform);
-        return propName + ":" + pattern;
+        return field + ":" + tvf.createValue(pattern);
-            this.cacheKey = field + '\uFFFF' + propName + '\uFFFF' + transform + '\uFFFF' + pattern;
+            this.cacheKey = field + '\uFFFF' + tvf.createValue('\uFFFF' + pattern) + '\uFFFF' + transform;
-            TermEnum terms = new WildcardTermEnum(reader, field, propName, pattern, transform);
+            TermEnum terms = new WildcardTermEnum(reader, field, tvf, pattern, transform);
