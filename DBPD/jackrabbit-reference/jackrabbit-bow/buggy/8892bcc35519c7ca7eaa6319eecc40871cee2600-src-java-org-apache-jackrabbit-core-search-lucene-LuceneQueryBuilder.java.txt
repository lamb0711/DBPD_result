Implement jcrfn:deref() function for XPath. Level 1 test cases for jcrfn:deref()

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@157120 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.search.DerefQueryNode;
+    public Object visit(DerefQueryNode node, Object data) {
+        Query context = (Query) data;
+        if (context == null) {
+            exceptions.add(new IllegalArgumentException("Unsupported query"));
+        }
+        try {
+            String refProperty = node.getRefProperty().toJCRName(nsMappings);
+            String nameTest = null;
+            if (node.getNameTest() != null) {
+                nameTest = node.getNameTest().toJCRName(nsMappings);
+            }
+            return new DerefQuery(context, refProperty, nameTest);
+        } catch (NoPrefixDeclaredException e) {
+            // should never happen
+            exceptions.add(e);
+        }
+        // fallback in case of exception
+        return context;
+    }
+
-    
+
