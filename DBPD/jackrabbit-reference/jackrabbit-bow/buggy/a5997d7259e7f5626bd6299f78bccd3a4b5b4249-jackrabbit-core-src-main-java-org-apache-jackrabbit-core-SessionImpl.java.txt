JCR-2080 DataStore: garbage collection can fail when using workspace maxIdleTime

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@767416 13f79535-47bb-0310-9956-ffa450edef68

-        SystemSession[] sysSessions = new SystemSession[wspNames.length];
+        Session[] sessions = new Session[wspNames.length];
-            sysSessions[i] = rep.getSystemSession(wspName);
+            // this will initialize the workspace if required
+            wspInfo.getSystemSession();
+            SessionImpl session = SystemSession.create(rep, wspInfo.getConfig());
+            // mark this session as 'active' so the workspace does not get disposed
+            // by the workspace-janitor until the garbage collector is done
+            rep.onSessionCreated(session);
+            sessions[i] = session;
-        GarbageCollector gc = new GarbageCollector(this, ipmList, sysSessions);
+        GarbageCollector gc = new GarbageCollector(this, ipmList, sessions);
