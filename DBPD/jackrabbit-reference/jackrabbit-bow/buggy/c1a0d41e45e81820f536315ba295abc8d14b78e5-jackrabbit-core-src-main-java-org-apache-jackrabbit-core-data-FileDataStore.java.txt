JCR-2676 FileDataStore should check for lastModified error result

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@979263 13f79535-47bb-0310-9956-ffa450edef68

-                if (file.lastModified() < minModifiedDate) {
+                long lastModified = file.lastModified();
+                if (lastModified == 0) {
+                    throw new DataStoreException("Failed to read record modified date: " + identifier);
+                } 
+                if (lastModified < minModifiedDate) {
+                    long lastModified = file.lastModified();
+                    if (lastModified == 0) {
+                        throw new DataStoreException("Failed to read record modified date: " + identifier);
+                    }
-                    if (file.lastModified() < now + ACCESS_TIME_RESOLUTION) {
+                    if (lastModified < now + ACCESS_TIME_RESOLUTION) {
-                String fileName = file.getName();
-                if (file.lastModified() < min) {
-                    DataIdentifier id = new DataIdentifier(fileName);
+                long lastModified = file.lastModified();
+                if (lastModified == 0) {
+                    // Don't delete the file, since the lastModified date is uncertain!
+                    log.warn("Failed to read modification date for " + file.getAbsolutePath());
+                } else if (lastModified < min) {
+                    DataIdentifier id = new DataIdentifier(file.getName());
-                                    " modified: " + new Timestamp(file.lastModified()).toString() +
+                                    " modified: " + new Timestamp(lastModified).toString() +
-                        file.delete();
+                        if (!file.delete()) {
+                            log.warn("Failed to delete old file " + file.getAbsolutePath());
+                        }
