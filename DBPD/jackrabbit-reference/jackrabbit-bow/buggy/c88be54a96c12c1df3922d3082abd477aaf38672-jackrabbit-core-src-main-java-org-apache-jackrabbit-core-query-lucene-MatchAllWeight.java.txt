JCR-804: Avoid using MultiTermDocs

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@520841 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.lucene.search.Weight;
-class MatchAllWeight implements Weight {
+class MatchAllWeight extends AbstractWeight {
-    private final String field;
-
-    /**
-     * the current Searcher instance
-     */
-    private final Searcher searcher;
-
-    MatchAllWeight(Query query, Searcher searcher, String field) {
+    MatchAllWeight(Query query, Searcher searcher, final String field) {
+        super(searcher, new ScorerFactory() {
+            public Scorer createScorer(IndexReader reader) throws IOException {
+                return new MatchAllScorer(reader, field);
+            }
+        });
-        this.searcher = searcher;
-        this.field = field;
-    public Scorer scorer(IndexReader reader) throws IOException {
-        if (reader instanceof MultiIndexReader) {
-            MultiIndexReader mir = (MultiIndexReader) reader;
-            IndexReader readers[] = mir.getIndexReaders();
-            int starts[] = new int[readers.length + 1];
-            int maxDoc = 0;
-            for (int i = 0; i < readers.length; i++) {
-                starts[i] = maxDoc;
-                maxDoc += readers[i].maxDoc();
-            }
-
-            starts[readers.length] = maxDoc;
-            Scorer scorers[] = new Scorer[readers.length];
-            for (int i = 0; i < readers.length; i++)
-                scorers[i] = scorer(readers[i]);
-
-            return new MultiScorer(searcher.getSimilarity(), scorers, starts);
-        } else {
-            return new MatchAllScorer(reader, field);
-        }
-    }
-
-    /**
-     * {@inheritDoc}
-     */
