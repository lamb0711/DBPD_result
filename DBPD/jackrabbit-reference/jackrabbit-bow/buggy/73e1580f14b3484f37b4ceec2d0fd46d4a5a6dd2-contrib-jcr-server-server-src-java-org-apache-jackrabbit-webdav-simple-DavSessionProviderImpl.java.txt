applying patch from angela, fixing:

[JCR-122] cannot PUT changes to a resource in the simple webdav server
[JCR-123] Webdav: Error when accessing Simple-Server
[JCR-126] Jcr-Server Module: Remove Dependency from Jackrabbit-Core


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@180346 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.client.RepositoryAccessServlet;
+import org.apache.jackrabbit.server.CredentialsProvider;
+import org.apache.jackrabbit.server.SessionProvider;
- * interface that uses the {@link RepositoryAccessServlet} to locate
+ * interface that uses a {@link CredentialsProvider} to locate
+     * the repository
+     */
+    private final Repository repository;
+
+    /**
+     * the credentials provider
+     */
+    private final SessionProvider sesProvider;
+
+    /**
+     * Creates a new DavSessionProviderImpl
+     * @param rep
+     * @param sesProvider
+     */
+    public DavSessionProviderImpl(Repository rep, SessionProvider sesProvider) {
+        this.repository = rep;
+        this.sesProvider = sesProvider;
+    }
+
+    /**
-     * @see DavSessionProvider#acquireSession(org.apache.jackrabbit.webdav.WebdavRequest)
+     * @see DavSessionProvider#attachSession(org.apache.jackrabbit.webdav.WebdavRequest)
-    public void acquireSession(WebdavRequest request) throws DavException {
+    public boolean attachSession(WebdavRequest request) throws DavException {
-            // extract credentials from the auth header. depending of the
-            // configuration of the RepositoryAccessServlet, this could also
-            // throw a login excetpion.
-            Credentials creds = RepositoryAccessServlet.getCredentialsFromHeader(
-                    request.getHeader(DavConstants.HEADER_AUTHORIZATION));
-
-            Session repSession = RepositoryAccessServlet.getRepository().login(creds);
+            Session repSession = sesProvider.getSession(request, repository, null);
+            if (repSession == null) {
+                return false;
+            }
+            return true;
