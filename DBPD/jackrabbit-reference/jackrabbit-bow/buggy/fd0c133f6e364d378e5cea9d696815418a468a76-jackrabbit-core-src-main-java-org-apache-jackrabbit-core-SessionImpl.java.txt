JCR-890: concurrent read-only access to a session

Leverage SessionContext in more places.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@957229 13f79535-47bb-0310-9956-ffa450edef68

-     * the AccessManager associated with this session
-     */
-    protected AccessManager accessMgr;
-
-    /**
-        accessMgr = createAccessManager(subject);
+        context.setAccessManager(createAccessManager(subject));
-        return new WorkspaceImpl(wspConfig, repositoryContext, this);
+        return new WorkspaceImpl(wspConfig, context);
-            validator = new ItemValidator(
-                    repositoryContext.getNodeTypeRegistry(),
-                    getHierarchyManager(), this);
+            validator = new ItemValidator(context);
-        return accessMgr;
+        return context.getAccessManager();
-                if (getAccessManager().canAccess(name)) {
+                if (context.getAccessManager().canAccess(name)) {
-            return getHierarchyManager().getPath(NodeId.valueOf(identifier));
+            return context.getHierarchyManager().getPath(NodeId.valueOf(identifier));
-        AccessManager acMgr = getAccessManager();
+        AccessManager acMgr = context.getAccessManager();
-            accessMgr.close();
+            context.getAccessManager().close();
-            return getAccessManager().isGranted(path, permissions);
+            return context.getAccessManager().isGranted(path, permissions);
+        AccessManager accessMgr = context.getAccessManager();
-            throw new UnsupportedRepositoryOperationException("Access control discovery is not supported.");
+            throw new UnsupportedRepositoryOperationException(
+                    "Access control discovery is not supported.");
