- JCR-17 Creating and saving a mix:versionable node creates two VersionHistory nodes
- JCR-18 Multithreading issue with versioning


git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@76106 13f79535-47bb-0310-9956-ffa450edef68

-    protected static PersistentNode checkin(PersistentNode parent, QName name, NodeImpl src, boolean initOnly)
+    protected static PersistentNode checkin(PersistentNode parent, QName name, NodeImpl src, boolean initOnly, boolean forceCopy)
-    // ignore some properties that not have a OPV=Ignore yet
-                if (prop.getQName().equals(VersionManager.PROPNAME_VERSION_HISTORY)) {
-                    continue;
-                }
-                if (prop.getQName().equals(VersionManager.PROPNAME_PREDECESSORS)) {
-                    continue;
-                }
-                switch (prop.getDefinition().getOnParentVersion()) {
+                int opv = forceCopy ? OnParentVersionAction.COPY : prop.getDefinition().getOnParentVersion();
+                switch (opv) {
-                switch (child.getDefinition().getOnParentVersion()) {
+                int opv = forceCopy ? OnParentVersionAction.COPY : child.getDefinition().getOnParentVersion();
+                switch (opv) {
-                        checkin(node, child.getQName(), child, false);
+                        checkin(node, child.getQName(), child, false, true);
