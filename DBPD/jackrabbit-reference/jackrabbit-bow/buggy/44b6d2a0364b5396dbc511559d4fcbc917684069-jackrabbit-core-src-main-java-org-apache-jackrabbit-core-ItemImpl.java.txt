JCR-1775: Transaction-safe versioning

Avoid instantiating full VersionHistoryImpl objects when all we need are the identifiers of the version history and root version nodes.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@702453 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.version.VersionHistoryInfo;
-import javax.jcr.version.VersionHistory;
-                        VersionHistory vh =
+                        VersionHistoryInfo history =
-                        node.internalSetProperty(NameConstants.JCR_VERSIONHISTORY, InternalValue.create(new UUID(vh.getUUID())));
-                        node.internalSetProperty(NameConstants.JCR_BASEVERSION, InternalValue.create(new UUID(vh.getRootVersion().getUUID())));
-                        node.internalSetProperty(NameConstants.JCR_ISCHECKEDOUT, InternalValue.create(true));
-                        node.internalSetProperty(NameConstants.JCR_PREDECESSORS,
-                                new InternalValue[]{InternalValue.create(new UUID(vh.getRootVersion().getUUID()))});
+                        InternalValue historyId = InternalValue.create(
+                                history.getVersionHistoryId().getUUID());
+                        InternalValue versionId = InternalValue.create(
+                                history.getRootVersionId().getUUID());
+                        node.internalSetProperty(
+                                NameConstants.JCR_VERSIONHISTORY, historyId);
+                        node.internalSetProperty(
+                                NameConstants.JCR_BASEVERSION, versionId);
+                        node.internalSetProperty(
+                                NameConstants.JCR_ISCHECKEDOUT,
+                                InternalValue.create(true));
+                        node.internalSetProperty(
+                                NameConstants.JCR_PREDECESSORS,
+                                new InternalValue[] { versionId });
