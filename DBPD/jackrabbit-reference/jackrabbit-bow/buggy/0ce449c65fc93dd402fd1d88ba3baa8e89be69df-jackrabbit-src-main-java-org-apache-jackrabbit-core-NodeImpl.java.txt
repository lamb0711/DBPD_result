JCR_423 Node.restore() fails for existing non-versioned OPV=Version child nodes

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@405417 13f79535-47bb-0310-9956-ffa450edef68

-        // first delete all non frozen version histories (i.e. all OPV=Copy)
+        // first delete some of the version histories
-            if (!freeze.hasFrozenHistory(n.internalGetUUID())) {
-                if (n.getDefinition().getOnParentVersion() == OnParentVersionAction.COPY) {
-                    // only remove OPV=Copy nodes
+            if (n.getDefinition().getOnParentVersion() == OnParentVersionAction.COPY) {
+                // only remove OPV=Copy nodes
+                n.internalRemove(true);
+            } else if (n.getDefinition().getOnParentVersion() == OnParentVersionAction.VERSION) {
+                // only remove, if node to be restored does not contain child
+                UUID vhUUID = new UUID(n.getProperty(QName.JCR_VERSIONHISTORY).getString());
+                if (!freeze.hasFrozenHistory(vhUUID)) {
