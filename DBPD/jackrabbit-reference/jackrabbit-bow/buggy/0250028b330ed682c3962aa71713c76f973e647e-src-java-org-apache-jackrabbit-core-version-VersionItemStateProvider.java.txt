JCR-45 fixes:
- fixing references into version storage
- fixing inter-version storage references

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@156188 13f79535-47bb-0310-9956-ffa450edef68

+        try {
+            InternalVersionItem vi = vMgr.getItem(id.getUUID());
+            if (vi != null) {
+                // todo: add caching
+                NodeReferences ref = new NodeReferences(id);
+                ref.addAllReferences(vMgr.getItemReferences(vi));
+                // check for versionstorage internal references
+                if (vi instanceof InternalVersion) {
+                    InternalVersion v = (InternalVersion) vi;
+                    InternalVersion[] suc = v.getSuccessors();
+                    for (int i=0; i<suc.length; i++) {
+                        InternalVersion s = suc[i];
+                        ref.addReference(new PropertyId(s.getId(), JCR_PREDECESSORS));
+                    }
+                    InternalVersion[] pred = v.getPredecessors();
+                    for (int i=0; i<pred.length; i++) {
+                        InternalVersion p = pred[i];
+                        ref.addReference(new PropertyId(p.getId(), JCR_SUCCESSORS));
+                    }
+                }
-        //@todo return node references
+                return ref;
+            }
+        } catch (RepositoryException e) {
+            // ignore
+        }
+    public boolean setNodeReferences(NodeReferences refs) {
+        try {
+            InternalVersionItem vi = vMgr.getItem(refs.getUUID());
+            if (vi != null) {
+                vMgr.setItemReferences(vi, refs.getReferences());
+                return true;
+            }
+        } catch (RepositoryException e) {
+            // ignore
+        }
+        return false;
+    }
+
+    /**
+     * {@inheritDoc}
+     */
