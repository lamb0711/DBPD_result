JCR-3275: Audit log

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1308743 13f79535-47bb-0310-9956-ffa450edef68

-     * Logger.
+     * Audit logger.
+     */
+    private static Logger auditLogger = LoggerFactory.getLogger("org.apache.jackrabbit.core.audit");
+
+    /**
+     * Default Logger.
+     * Update counter, used in displaying the number of updates in audit log.
+     */
+    private final AtomicInteger updateCount = new AtomicInteger();
+
+    /**
+         * Attribute name used to store the size of the update.
+         */
+        private static final String ATTRIBUTE_UPDATE_SIZE = "updateSize";
+
+        /**
-                record.update();
-                setRevision(record.getRevision());
-                log.debug("revision {} {}", record.getRevision(), path);
+                long journalUpdateSize = record.update();
+
+                long recordRevision = record.getRevision();
+                setRevision(recordRevision);
+
+                log.debug("Stored record '{}' to Journal ({})", recordRevision, journalUpdateSize);
+
+                long updateSize = (Long)update.getAttribute(ATTRIBUTE_UPDATE_SIZE);
+                updateCount.compareAndSet(Integer.MAX_VALUE, 0);
+
+                auditLogger.info("[{}] {} {} ({})", new Object[]{updateCount.incrementAndGet(), 
+                        record.getRevision(), path, updateSize});
+
