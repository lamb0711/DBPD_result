JCR-805: Introduce a temprary cache for intermediate query results

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@520878 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Map;
+import java.util.HashMap;
- * In case there are no filters, this MatchAllScores simply collects
- * all documents in the index that are not marked as deleted.
+        PerQueryCache cache = PerQueryCache.getInstance();
+        Map readerCache = (Map) cache.get(MatchAllScorer.class, reader);
+        if (readerCache == null) {
+            readerCache = new HashMap();
+            cache.put(MatchAllScorer.class, reader, readerCache);
+        }
+        // get BitSet for field
+        docFilter = (BitSet) readerCache.get(field);
+
+        if (docFilter != null) {
+            // use cached BitSet;
+            return;
+        }
+
+        // otherwise calculate new
+
+        // put BitSet into cache
+        readerCache.put(field, docFilter);
