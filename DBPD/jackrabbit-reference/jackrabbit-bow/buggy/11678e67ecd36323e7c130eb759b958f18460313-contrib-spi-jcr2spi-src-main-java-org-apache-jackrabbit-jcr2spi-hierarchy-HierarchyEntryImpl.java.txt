- remove cachebehaviour flag from ChangeLog.persisted
- minor improvement

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@521356 13f79535-47bb-0310-9956-ffa450edef68

+    static void removeEntry(HierarchyEntryImpl entry) {
+        ItemState state = entry.internalGetItemState();
+        if (state != null) {
+            if (state.getStatus() == Status.NEW) {
+                state.setStatus(Status.REMOVED);
+            } else {
+                state.getWorkspaceState().setStatus(Status.REMOVED);
+            }
+        }
+    }
-    public void transientRemove() throws RepositoryException {
+    public void transientRemove() throws InvalidItemStateException, RepositoryException {
+            case Status.REMOVED:
+            case Status.STALE_DESTROYED:
+                throw new InvalidItemStateException("Item has already been removed by someone else. Status = " + Status.getName(state.getStatus()));
-        // only interested in transient modifications or stale-modified states
+        // only interested in transient modifications or stale states
+            case Status.STALE_DESTROYED:
