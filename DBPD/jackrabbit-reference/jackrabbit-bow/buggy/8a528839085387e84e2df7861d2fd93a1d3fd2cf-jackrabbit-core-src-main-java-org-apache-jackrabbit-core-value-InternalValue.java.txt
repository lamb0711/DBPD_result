JCR-926: configuration for data store in repository.xml

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@573209 13f79535-47bb-0310-9956-ffa450edef68

-                        if (store == null) {
-                            return new InternalValue(BLOBInTempFile.getInstance(value.getStream()));
-                        } else {
-                            return new InternalValue(getBLOBFileValue(store, value.getStream()));
-                        }
+                        return new InternalValue(getBLOBFileValue(store, value.getStream()));
-
-            return new InternalValue(BLOBInTempFile.getInstance(value));
+            return new InternalValue(getBLOBFileValue(null, value));
-     * Create an internal value that is backed by a temporary file (if data store usage is disabled)
-     * or (if it is enabled) in the data store.
+     * Create an internal value that is backed by a temporary file 
+     * (if data store usage is disabled or the store is null)
+     * or in the data store if it is not null and enabled.
-     * @param store the data store
+     * @param store the data store or null to use a temporary file
+        if (USE_DATA_STORE) {
+            return new InternalValue(getBLOBFileValue(null, value));
+        }
-    public static InternalValue create(FileSystemResource value)
-            throws IOException {
+    public static InternalValue create(FileSystemResource value) throws IOException {
+        if (USE_DATA_STORE) {
+            return new InternalValue(BLOBInResource.getInstance(value));
+        }        
+        if (USE_DATA_STORE) {
+            return new InternalValue(BLOBInTempFile.getInstance(value, false));
+        }                
-        assert USE_DATA_STORE;
+        assert USE_DATA_STORE && store != null;
-            return BLOBInDataStore.getInstance(store, in);
+            if (store != null) {
+                return BLOBInDataStore.getInstance(store, in);
+            } else {
+                return BLOBInTempFile.getInstance(in, true);
+            }
