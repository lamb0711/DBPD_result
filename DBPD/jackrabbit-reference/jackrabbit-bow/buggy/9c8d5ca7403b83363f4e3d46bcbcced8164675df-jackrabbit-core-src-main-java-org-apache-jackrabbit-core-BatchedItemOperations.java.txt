JCR-2598: Saving concurrent sessions executing random operations causes a corrupt JCR

Patch by Stephan Huttenhuis

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@955229 13f79535-47bb-0310-9956-ffa450edef68

-            // remove child node entry from old parent
-            srcParent.removeChildNodeEntry(srcName.getName(), srcNameIndex);
-
-            // re-parent target node
-            target.setParentId(destParent.getNodeId());
-
-            // add child node entry to new parent
-            destParent.addChildNodeEntry(destName.getName(), target.getNodeId());
+            // do move:
+            // 1. remove child node entry from old parent
+            if (srcParent.removeChildNodeEntry(target.getNodeId())) {
+                // 2. re-parent target node
+                target.setParentId(destParent.getNodeId());
+                // 3. add child node entry to new parent
+                destParent.addChildNodeEntry(destName.getName(), target.getNodeId());
+            }
