JCR-594: It's not possible to register event listeners that filters on mixin supertypes

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@464496 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Iterator;
+import java.util.Set;
+
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-    /**
-     * Logger instance for this class.
-     */
-    private static final Logger log = LoggerFactory.getLogger(EventFilter.class);
-
+            Set eventTypes = eventState.getNodeTypes(session.getNodeTypeManager());
-                match |= eventState.getNodeType().getQName().equals(nodeTypes[i].getQName())
-                        || eventState.getMixinNames().contains(nodeTypes[i].getQName())
-                        || eventState.getNodeType().isDerivedFrom(nodeTypes[i].getQName());
+                for (Iterator iter = eventTypes.iterator(); iter.hasNext();) {
+                    NodeTypeImpl nodeType = (NodeTypeImpl) iter.next();
+                    match |= nodeType.getQName().equals(nodeTypes[i].getQName())
+                            || nodeType.isDerivedFrom(nodeTypes[i].getQName());
+                }
-            Path eventPath = null;
+            Path eventPath;
