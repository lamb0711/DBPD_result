JCR-1588 - JSR 283: Access Control (work in progress)
JCR-1590 - JSR 283: Locking
JCR-1915 - Node.setPrimaryNodeType should only redefine child-definitions that are not covered by the new effective nt
JCR-1875 - Failing Node.unlock() might leave inconsistent transient state
JCR-538 - Failing Node.checkin() or Node.checkout() might leave inconsistent transient state

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@732693 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.api.jsr283.security.Privilege;
+    protected int privAll;
+    protected int privRead;
+
-     * that grants everything and returns {@link PrivilegeRegistry#ALL}
+     * that grants everything and returns the int representation of {@link Privilege#JCR_ALL}
-     * grants everything and always returns {@link PrivilegeRegistry#ALL}
-     * upon {@link CompiledPermissions#getPrivileges(Path)}.
+     * grants everything and always returns the int representation of
+     * {@link Privilege#JCR_ALL} upon {@link CompiledPermissions#getPrivileges(Path)}.
-    protected static CompiledPermissions getAdminPermissions() {
+    protected CompiledPermissions getAdminPermissions() {
-                return PrivilegeRegistry.ALL;
+                return privAll;
-                    return PrivilegeRegistry.READ;
+                    return privRead;
+
+        privAll = PrivilegeRegistry.getBits(new Privilege[] {session.getAccessControlManager().privilegeFromName(Privilege.JCR_ALL)});
+        privRead = PrivilegeRegistry.getBits(new Privilege[] {session.getAccessControlManager().privilegeFromName(Privilege.JCR_READ)});
+
