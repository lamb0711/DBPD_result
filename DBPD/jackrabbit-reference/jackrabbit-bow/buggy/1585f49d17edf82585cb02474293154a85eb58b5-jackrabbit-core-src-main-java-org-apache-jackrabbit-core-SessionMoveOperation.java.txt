JCR-3291: Prevent the creation of cyclic paths in the transient and persistent states

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1327432 13f79535-47bb-0310-9956-ffa450edef68

+            // Create the transient parent nodes of the target node to prevent 
+            // conflicting and/or cyclic moves. See JCR-3921
+            createTransientParentStates(destParentNode);
+            
+    private void createTransientParentStates(NodeImpl node) throws RepositoryException {
+        while (node.getParentId() != null) {
+            node.getOrCreateTransientItemState();
+            node = (NodeImpl) node.getParent();
+        }
+    }
