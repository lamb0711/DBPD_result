JCR-4002 : CSRF in Jackrabbit-Webdav using empty content-type

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1756604 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.webdav.DavMethods;
-import java.util.Arrays;
-     * Request content types for CSRF checking, see JCR-3909
-     */
-    public static final Set<String> CONTENT_TYPES = Collections.unmodifiableSet(new HashSet<String>(
-            Arrays.asList(
-                    new String[] {
-                            "application/x-www-form-urlencoded",
-                            "multipart/form-data",
-                            "text/plain",
-                            null // no content type included in request
-                    }
-            )
-    ));
-
-    /**
-        int methodCode = DavMethods.getMethodCode(request.getMethod());
-        if (disabled || DavMethods.DAV_POST != methodCode || !CONTENT_TYPES.contains(request.getContentType())) {
+        if (disabled) {
-
-            // empty referrer headers are not allowed for POST + relevant content types (see JCR-3909)
-                return false;
+                // empty referrer is always allowed
+                return true;
+            } else {
+                String host = new URL(refHeader).getHost();
+                // test referrer-host equelst server or
+                // if it is contained in the set of explicitly allowed host names
+                return host.equals(request.getServerName()) || allowedReferrerHosts.contains(host);
-
-            String host = new URL(refHeader).getHost();
-            // test referrer-host equals server or
-            // if it is contained in the set of explicitly allowed host names
-            return host.equals(request.getServerName()) || allowedReferrerHosts.contains(host);
