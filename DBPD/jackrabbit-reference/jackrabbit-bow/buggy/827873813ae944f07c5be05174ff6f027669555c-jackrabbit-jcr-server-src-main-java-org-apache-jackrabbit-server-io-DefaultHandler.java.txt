JCR-973 XML import using MacOS X WebDAV client does not work


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@548395 13f79535-47bb-0310-9956-ffa450edef68

-        Node contentNode;
+        Node contentNode = null;
-                // remove all entries in the jcr:content since replacing content
-                // includes properties (DefaultHandler) and nodes (e.g. ZipHandler)
-                if (contentNode.hasNodes()) {
-                    NodeIterator it = contentNode.getNodes();
-                    while (it.hasNext()) {
-                        it.nextNode().remove();
+                // check if nodetype is compatible (might be update of an existing file)
+                if (contentNode.isNodeType(getContentNodeType())) {
+                    // remove all entries in the jcr:content since replacing content
+                    // includes properties (DefaultHandler) and nodes (e.g. ZipHandler)
+                    if (contentNode.hasNodes()) {
+                        NodeIterator it = contentNode.getNodes();
+                        while (it.hasNext()) {
+                            it.nextNode().remove();
+                        }
+                } else {
+                    contentNode.remove();
+                    contentNode = null;
-            } else {
+            }
+            if (contentNode == null) {
