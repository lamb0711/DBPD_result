JCR-2627: System-view export/import of multi-value property does not respect JCR 2.0

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@943567 13f79535-47bb-0310-9956-ffa450edef68

-     * Creates a proprety information instance.
+     * Hint indicating whether the property is multi- or single-value
+     */
+    public enum MultipleStatus { UNKNOWN, SINGLE, MULTIPLE };
+    private MultipleStatus multipleStatus;
+
+    /**
+     * Creates a property information instance.
+        multipleStatus =
+                values.length == 1
+                        ? MultipleStatus.UNKNOWN : MultipleStatus.MULTIPLE;
+    }
+
+    /**
+     * Creates a property information instance.
+     *
+     * @param name name of the property being imported
+     * @param type type of the property being imported
+     * @param values value(s) of the property being imported
+     * @param multipleStatus Hint indicating whether the property is
+     *                       multi- or single-value
+     */
+    public PropInfo(Name name, int type, TextValue[] values,
+                    MultipleStatus multipleStatus) {
+        this.name = name;
+        this.type = type;
+        this.values = values;
+        this.multipleStatus = multipleStatus;
-        if (values.length == 1) {
-            // could be single- or multi-valued (n == 1)
-            return ent.getApplicablePropertyDef(name, type);
-        } else {
-            // can only be multi-valued (n == 0 || n > 1)
+        if (multipleStatus == MultipleStatus.MULTIPLE) {
+        } else if (multipleStatus == MultipleStatus.SINGLE) {
+            return ent.getApplicablePropertyDef(name, type, false);
+        } else {
+            // could be single- or multi-valued
+            return ent.getApplicablePropertyDef(name, type);
+    public MultipleStatus getMultipleStatus() {
+        return multipleStatus;
+    }
+
