- quotes are not unescaped in string literal when using jcr:like

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@328092 13f79535-47bb-0310-9956-ffa450edef68

-            String value = node.getValue().substring(1, node.getValue().length() - 1);
-            if (node.getValue().charAt(0) == '"') {
-                value = value.replaceAll("\"\"", "\"");
-            } else {
-                value = value.replaceAll("''", "'");
-            }
-            queryNode.setStringValue(value);
+            queryNode.setStringValue(unescapeQuotes(node.getValue()));
-                            String value = literal.getValue();
-                            if (value.charAt(0) == '"') {
-                                value = value.replaceAll("\"\"", "\"");
-                            } else {
-                                value = value.replaceAll("''", "'");
-                            }
-                            // strip quotes
-                            value = value.substring(1, value.length() - 1);
-                            TextsearchQueryNode contains = new TextsearchQueryNode(queryNode, value);
+                            TextsearchQueryNode contains = new TextsearchQueryNode(queryNode,
+                                    unescapeQuotes(literal.getValue()));
-                            String value = literal.getValue();
-                            // strip quotes
-                            value = value.substring(1, value.length() - 1);
-                            like.setStringValue(value);
+                            like.setStringValue(unescapeQuotes(literal.getValue()));
+    /**
+     * Unescapes single or double quotes depending on how <code>literal</code>
+     * is enclosed and strips enclosing quotes.
+     *
+     * </p>
+     * Examples:</br>
+     * <code>"foo""bar"</code> -&gt; <code>foo"bar</code></br>
+     * <code>'foo''bar'</code> -&gt; <code>foo'bar</code></br>
+     * but:</br>
+     * <code>'foo""bar'</code> -&gt; <code>foo""bar</code>
+     *
+     * @param literal the string literal to unescape
+     * @return the unescaped and stripped literal.
+     */
+    private String unescapeQuotes(String literal) {
+        String value = literal.substring(1, literal.length() - 1);
+        if (value.length() == 0) {
+            // empty string
+            return value;
+        }
+        if (literal.charAt(0) == '"') {
+            value = value.replaceAll("\"\"", "\"");
+        } else {
+            value = value.replaceAll("''", "'");
+        }
+        return value;
+    }
