first implementation of jta support

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@55234 13f79535-47bb-0310-9956-ffa450edef68

-        nodeTypeName = overlayedState.getNodeTypeName();
-        mixinTypeNames.addAll(overlayedState.getMixinTypeNames());
-        defId = overlayedState.getDefinitionId();
-        uuid = overlayedState.getUUID();
-        parentUUIDs.addAll(overlayedState.getParentUUIDs());
-        propertyEntries.addAll(overlayedState.getPropertyEntries());
-        childNodeEntries.addAll(overlayedState.getChildNodeEntries());
+
+        copy(overlayedState);
+    /**
+     * @see ItemState#copy
+     */
+    protected void copy(ItemState state) {
+        super.copy(state);
+
+        NodeState nodeState = (NodeState) state;
+        nodeTypeName = nodeState.getNodeTypeName();
+        mixinTypeNames.clear();
+        mixinTypeNames.addAll(nodeState.getMixinTypeNames());
+        defId = nodeState.getDefinitionId();
+        uuid = nodeState.getUUID();
+        parentUUIDs.clear();
+        parentUUIDs.addAll(nodeState.getParentUUIDs());
+        propertyEntries.clear();
+        propertyEntries.addAll(nodeState.getPropertyEntries());
+        childNodeEntries.removeAll();
+        childNodeEntries.addAll(nodeState.getChildNodeEntries());
+    }
+
+
-     * @see ItemState#setParentUUID
+     * Sets the UUID of the parent <code>NodeState</code>.
+     *
+     * @param parentUUID the parent <code>NodeState</code>'s UUID or <code>null</code>
+     *                   if either this item state should represent the root node or this item state
+     *                   should be 'free floating', i.e. detached from the repository's hierarchy.
-        if (!parentUUIDs.contains(parentUUID) && parentUUID != null) {
+        if (parentUUID != null && !parentUUIDs.contains(parentUUID)) {
-        super.setParentUUID(parentUUID);
+        this.parentUUID = parentUUID;
