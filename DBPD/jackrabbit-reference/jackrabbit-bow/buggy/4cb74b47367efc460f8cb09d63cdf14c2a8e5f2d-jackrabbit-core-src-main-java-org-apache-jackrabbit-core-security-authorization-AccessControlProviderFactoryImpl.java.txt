JCR-1765: Config: make all elements in the security configuration optional

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@704324 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.security.JackrabbitSecurityManager;
+import org.apache.jackrabbit.core.SessionImpl;
+import org.apache.jackrabbit.core.RepositoryImpl;
+    private String defaultWorkspaceName = null;
-     * @see AccessControlProviderFactory#init(JackrabbitSecurityManager)
+     * @see AccessControlProviderFactory#init(Session)
-    public void init(JackrabbitSecurityManager securityMgr) throws RepositoryException {
-        secWorkspaceName = securityMgr.getSecurityConfig().getSecurityManagerConfig().getWorkspaceName();
+    public void init(Session securitySession) throws RepositoryException {
+        secWorkspaceName = securitySession.getWorkspace().getName();
+        if (securitySession instanceof SessionImpl) {
+            defaultWorkspaceName = ((RepositoryImpl) securitySession.getRepository()).getConfig().getDefaultWorkspaceName();
+        } // else: unable to determine default workspace name
-            if (workspaceName.equals(secWorkspaceName)) {
+            if (workspaceName.equals(secWorkspaceName) && !workspaceName.equals(defaultWorkspaceName)) {
+                // UserAccessControlProvider is designed to work with an extra
+                // workspace storing user and groups. therefore avoid returning
+                // this ac provider for the default workspace.
