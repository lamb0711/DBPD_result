JCR-1006: Applied patch from Christoph Kiehl

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@558167 13f79535-47bb-0310-9956-ffa450edef68

-        // retrieve inital size, since size of the list is not stable
+        // retrieve initial size, since size of the list is not stable
-     * Adds the version 'v' to the list of versions to return and then calls
-     * it self recursively with all the verions prodecessors.
+     * Adds the version 'v' to the list of versions to return and then iterates
+     * over the hierarchy of successors of 'v'.
-        NodeId id = v.getId();
-        if (!versions.contains(id)) {
-            versions.add(id);
-            InternalVersion[] vs = v.getSuccessors();
-            for (int i = 0; i < vs.length; i++) {
-                addVersion(vs[i]);
+        LinkedList workQueue = new LinkedList();
+        workQueue.add(v);
+        while (!workQueue.isEmpty()) {
+            InternalVersion currentVersion = (InternalVersion) workQueue.removeFirst();
+            NodeId id = currentVersion.getId();
+            if (!versions.contains(id)) {
+                versions.add(id);
+                InternalVersion[] successors = currentVersion.getSuccessors();
+                for (int i = 0; i < successors.length; i++) {
+                    workQueue.add(successors[i]);
+                }
+
