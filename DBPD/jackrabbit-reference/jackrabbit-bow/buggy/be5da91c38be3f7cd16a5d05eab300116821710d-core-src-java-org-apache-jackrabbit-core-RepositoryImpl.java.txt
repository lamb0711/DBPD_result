jcr-213  Avoid creation of more than one jackrabbit instance with the same configuration.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@279766 13f79535-47bb-0310-9956-ffa450edef68

+     * repository home lock
+     */
+    private static final String REPOSITORY_LOCK = ".lock";
+
+    /**
+
+        this.acquireRepositoryLock() ;
+
+    
+    /**
+     * Lock the repository home.
+     * @throws RepositoryException
+     *         if the repository lock can not be acquired
+     */
+    private void acquireRepositoryLock() throws RepositoryException {
+        File home = new File(this.repConfig.getHomeDir());
+        File lock  = new File(home, REPOSITORY_LOCK) ;
+        if (lock.exists()) {
+            throw new RepositoryException("The repository home at " + home.getAbsolutePath() + 
+                " appears to be in use. If you are sure it's not in use please delete the file at " + 
+                lock.getAbsolutePath() + ". Probably the repository was not shutdown properly.");
+        }
+        try {
+            lock.createNewFile() ;
+        } catch (IOException e) {
+            throw new RepositoryException("Unable to create lock file at " + lock.getAbsolutePath());
+        }
+    }
+
+    /**
+     * Release repository lock
+     */
+    private void releaseRepositoryLock() {
+        File home = new File(this.repConfig.getHomeDir());
+        File lock  = new File(home, REPOSITORY_LOCK) ;
+        if (!lock.delete()) {
+            log.error("Unable to release repository lock") ;
+        }
+    }
+
+        this.releaseRepositoryLock() ;
+        
