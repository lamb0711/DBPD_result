- adjusting proper startup order for VersionManager
- adding shutdown to persistence manager of versions

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@153192 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.state.ItemStateManager;
-        // add virtual item managers only for normal sessions
-        if (!(this instanceof SystemSession)) {
-            try {
-                itemStateMgr.addVirtualItemStateProvider(versionMgr.getVirtualItemStateProvider(this, itemStateMgr));
-            } catch (Exception e) {
-                log.error("Unable to add vmgr: " + e.toString(), e);
-            }
+        // add virtual item managers
+        try {
+            itemStateMgr.addVirtualItemStateProvider(versionMgr.getVirtualItemStateProvider(this, itemStateMgr));
+        } catch (Exception e) {
+            throw new RepositoryException("Uanbel to add virtual item state manager.", e);
-        // add virtual item managers only for normal sessions
-        if (!(this instanceof SystemSession)) {
-            try {
-                itemStateMgr.addVirtualItemStateProvider(versionMgr.getVirtualItemStateProvider(this, itemStateMgr));
-            } catch (Exception e) {
-                log.error("Unable to add vmgr: " + e.toString(), e);
-            }
+        // add virtual item managers
+        try {
+            itemStateMgr.addVirtualItemStateProvider(versionMgr.getVirtualItemStateProvider(this, itemStateMgr));
+        } catch (Exception e) {
+            throw new RepositoryException("Uanbel to add virtual item state manager.", e);
