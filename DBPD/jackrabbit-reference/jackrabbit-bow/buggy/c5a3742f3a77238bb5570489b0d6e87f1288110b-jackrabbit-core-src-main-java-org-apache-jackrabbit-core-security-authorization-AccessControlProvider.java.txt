JCR-2646 : AccessControlManager#getEffectivePolicies(String) may expose AC content without proper permissions
JCR-2657 : DefaultAccessManager#hasPrivileges(String,Set,Privilege[]) doesn't close compiled permissions
JCR-2649 : Provide means to display the effective policies for a given set of principals

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@954964 13f79535-47bb-0310-9956-ffa450edef68

+
+     * @param permissions The effective permissions of the editing
+     * sessions that attempts to view the effective policies.
-    AccessControlPolicy[] getEffectivePolicies(Path absPath) throws ItemNotFoundException, RepositoryException;
+    AccessControlPolicy[] getEffectivePolicies(Path absPath, CompiledPermissions permissions) throws ItemNotFoundException, RepositoryException;
+
+    /**
+     * Returns the effective policies for the given principals.
+     *
+     * @param principals A set of principal.
+     * @param permissions The effective permissions of the editing
+     * sessions that attempts to view the effective policies.  @return The effective policies that are in effect for the given
+     * <code>principal</code> or an empty array.
+     * @throws RepositoryException If error occurs.
+     * @see org.apache.jackrabbit.api.security.JackrabbitAccessControlManager#getEffectivePolicies(Set)
+     */
+    AccessControlPolicy[] getEffectivePolicies(Set<Principal> principals, CompiledPermissions permissions) throws RepositoryException;
