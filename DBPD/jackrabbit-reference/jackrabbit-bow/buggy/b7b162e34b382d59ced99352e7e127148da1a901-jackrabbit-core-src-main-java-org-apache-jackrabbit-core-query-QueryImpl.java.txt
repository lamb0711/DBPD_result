JCR-688: Apply the new Resolver interfaces in jackrabbit-core.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@496140 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.name.NameException;
-        try {
-            if (!node.isNodeType(NameFormat.format(QName.NT_QUERY, session.getNamespaceResolver()))) {
-                throw new InvalidQueryException("node is not of type nt:query");
-            }
-            statement = node.getProperty(NameFormat.format(QName.JCR_STATEMENT, session.getNamespaceResolver())).getString();
-            language = node.getProperty(NameFormat.format(QName.JCR_LANGUAGE, session.getNamespaceResolver())).getString();
-            query = handler.createExecutableQuery(session, itemMgr, statement, language);
-        } catch (NoPrefixDeclaredException e) {
-            throw new RepositoryException(e.getMessage(), e);
+        if (!node.isNodeType(session.getJCRName(QName.NT_QUERY))) {
+            throw new InvalidQueryException("node is not of type nt:query");
+        statement = node.getProperty(session.getJCRName(QName.JCR_STATEMENT)).getString();
+        language = node.getProperty(session.getJCRName(QName.JCR_LANGUAGE)).getString();
+        query = handler.createExecutableQuery(session, itemMgr, statement, language);
-            NamespaceResolver resolver = session.getNamespaceResolver();
-            Path p = PathFormat.parse(absPath, resolver).getNormalizedPath();
+            Path p = session.getQPath(absPath).getNormalizedPath();
-            String relPath = PathFormat.format(p, resolver).substring(1);
-            Node queryNode = session.getRootNode().addNode(relPath,
-                    NameFormat.format(QName.NT_QUERY, resolver));
+            String relPath = session.getJCRPath(p).substring(1);
+            Node queryNode = session.getRootNode().addNode(
+                    relPath, session.getJCRName(QName.NT_QUERY));
-            queryNode.setProperty(NameFormat.format(QName.JCR_LANGUAGE, resolver), language);
-            queryNode.setProperty(NameFormat.format(QName.JCR_STATEMENT, resolver), statement);
+            queryNode.setProperty(session.getJCRName(QName.JCR_LANGUAGE), language);
+            queryNode.setProperty(session.getJCRName(QName.JCR_STATEMENT), statement);
-        } catch (MalformedPathException e) {
-            throw new RepositoryException(e.getMessage(), e);
-        } catch (NoPrefixDeclaredException e) {
+        } catch (NameException e) {
