- fixing verisoning issues (version labels still missing)

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@151144 13f79535-47bb-0310-9956-ffa450edef68

-                    state.setPropertyValue(VersionManager.PROPNAME_FROZEN_UUID, InternalValue.create(v.getFrozenNode().getFrozenUUID()));
-                    state.setPropertyValue(VersionManager.PROPNAME_FROZEN_PRIMARY_TYPE, InternalValue.create(v.getFrozenNode().getFrozenPrimaryType()));
-                    state.setPropertyValues(VersionManager.PROPNAME_FROZEN_MIXIN_TYPES, PropertyType.NAME, InternalValue.create(v.getFrozenNode().getFrozenMixinTypes()));
-                    state.setPropertyValues(VersionManager.PROPNAME_VERSION_LABELS, PropertyType.STRING, InternalValue.create(v.getLabels()));
+                    //state.setPropertyValue(VersionManager.PROPNAME_FROZEN_UUID, InternalValue.create(v.getFrozenNode().getFrozenUUID()));
+                    //state.setPropertyValue(VersionManager.PROPNAME_FROZEN_PRIMARY_TYPE, InternalValue.create(v.getFrozenNode().getFrozenPrimaryType()));
+                    //state.setPropertyValues(VersionManager.PROPNAME_FROZEN_MIXIN_TYPES, PropertyType.NAME, InternalValue.create(v.getFrozenNode().getFrozenMixinTypes()));
+                    //state.setPropertyValues(VersionManager.PROPNAME_VERSION_LABELS, PropertyType.STRING, InternalValue.create(v.getLabels()));
+                    boolean mimicFrozen = !(parent instanceof VersionNodeState);
-                            fn.getFrozenPrimaryType());
-                    mapFrozenNode(state, fn);
+                            mimicFrozen ? fn.getFrozenPrimaryType() :
+                            NodeTypeRegistry.NT_FROZEN_NODE);
+                    mapFrozenNode(state, fn, mimicFrozen);
-                            NodeTypeRegistry.NT_FROZEN_VERSIONABLE_CHILD);
-                    state.setPropertyValue(VersionManager.PROPNAME_BASE_VERSION, InternalValue.create(UUID.fromString(fn.getBaseVersionId())));
-                    state.setPropertyValue(VersionManager.PROPNAME_VERSION_HISTORY, InternalValue.create(UUID.fromString(fn.getVersionHistoryId())));
+                            NodeTypeRegistry.NT_VERSIONED_CHILD);
+                    // IMO, this should be exposed aswell
+                    // state.setPropertyValue(VersionManager.PROPNAME_BASE_VERSION, InternalValue.create(UUID.fromString(fn.getBaseVersionId())));
+                    state.setPropertyValue(VersionManager.PROPNAME_CHILD, InternalValue.create(UUID.fromString(fn.getVersionHistoryId())));
-                                           InternalFrozenNode node)
+                                           InternalFrozenNode node,
+                                           boolean mimicFrozen)
-        // map native stuff
-        state.setMixinNodeTypes(node.getFrozenMixinTypes());
-        if (node.getFrozenUUID() != null) {
-            state.setPropertyValue(ItemImpl.PROPNAME_UUID, InternalValue.create(node.getFrozenUUID()));
+        if (mimicFrozen) {
+            if (node.getFrozenUUID() != null) {
+                state.setPropertyValue(ItemImpl.PROPNAME_UUID, InternalValue.create(node.getFrozenUUID()));
+            }
+            state.setPropertyValues(ItemImpl.PROPNAME_MIXINTYPES, PropertyType.NAME, InternalValue.create(node.getFrozenMixinTypes()));
+        } else {
+            state.setPropertyValue(ItemImpl.PROPNAME_UUID, InternalValue.create(node.getId()));
+            if (node.getFrozenUUID() != null) {
+                state.setPropertyValue(VersionManager.PROPNAME_FROZEN_UUID, InternalValue.create(node.getFrozenUUID()));
+            }
+            state.setPropertyValue(VersionManager.PROPNAME_FROZEN_PRIMARY_TYPE, InternalValue.create(node.getFrozenPrimaryType()));
+            state.setPropertyValues(VersionManager.PROPNAME_FROZEN_MIXIN_TYPES, PropertyType.NAME, InternalValue.create(node.getFrozenMixinTypes()));
