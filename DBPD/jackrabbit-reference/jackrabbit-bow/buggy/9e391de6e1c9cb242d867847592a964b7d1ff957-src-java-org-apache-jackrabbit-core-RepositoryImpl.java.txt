versioning implementation is now stores directly in persistence state.

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@53784 13f79535-47bb-0310-9956-ffa450edef68

+    private static final String VERSION_WORKSPACE_NAME = "default";
+
-        // FIXME version manager should not operate on default workspace
+
-        vMgr = new VersionManager(sysSession);
+        // todo: as soon as dynamic workspaces are available, base on system ws
+        SessionImpl verSession = getSystemSession(VERSION_WORKSPACE_NAME);
+        NodeImpl vRootNode = (NodeImpl) verSession.getRootNode();
+        try {
+            if (!vRootNode.hasNode(SYSTEM_ROOT_NAME)) {
+                verSession.getWorkspace().clone(DEFAULT_WORKSPACE_NAME,
+                        SYSTEM_ROOT_NAME.toJCRName(verSession.getNamespaceResolver()),
+                        SYSTEM_ROOT_NAME.toJCRName(verSession.getNamespaceResolver()));
+            }
+        } catch (NoPrefixDeclaredException e) {
+            throw new RepositoryException("Error: " + e.toString());
+        }
+        vMgr = new VersionManager(verSession);
-
