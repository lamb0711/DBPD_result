improving startup time: all workspaces (except the default workspace) are initialized lazily, i.e. on demand

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@367338 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.config.FileSystemConfig;
+         * file system (instantiated on init)
+         */
+        private FileSystem fs;
+
+        /**
-         * Returns the workspace file system.
-         *
-         * @return the workspace file system
-         */
-        FileSystem getFileSystem() {
-            return config.getFileSystem();
-        }
-
-        /**
+         * Returns the workspace file system.
+         *
+         * @return the workspace file system
+         */
+        synchronized FileSystem getFileSystem() {
+            if (!initialized) {
+                throw new IllegalStateException("not initialized");
+            }
+
+            return fs;
+        }
+
+        /**
-        synchronized PersistenceManager getPersistenceManager(PersistenceManagerConfig pmConfig)
+        synchronized PersistenceManager getPersistenceManager()
-                lockMgr = new LockManagerImpl(getSystemSession(), config.getFileSystem());
+                lockMgr = new LockManagerImpl(getSystemSession(), fs);
+         * <li>file system</li>
+            FileSystemConfig fsConfig = config.getFileSystemConfig();
+            fsConfig.init();
+            fs = fsConfig.getFileSystem();
+
-                    config.getFileSystem(),
+                    fs,
-            try {
-                // close workspace file system
-                config.getFileSystem().close();
-            } catch (FileSystemException e) {
-                log.error("error while closing filesystem of workspace "
-                        + config.getName(), e);
-            }
+            FileSystemConfig fsConfig = config.getFileSystemConfig();
+            fsConfig.dispose();
+            fs = null;
