JCR-2800: Implement search facility for users and groups
implemented limits, bounds and offsets
work in progress

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1033124 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.security.user.XPathQueryBuilder.Condition;
+import org.apache.jackrabbit.api.security.user.QueryBuilder.Direction;
-        XPathQueryBuilder.Condition condition = builder.getCondition();
+        Value bound = builder.getBound();
+        long offset = builder.getOffset();
+        if (bound != null && offset > 0) {
+            log.warn("Found bound {} and offset {} in limit. Discarding offset.", bound, offset);
+            offset = 0;
+        }
+
+        Condition condition = builder.getCondition();
+        String sortCol = builder.getSortProperty();
+        Direction sortDir = builder.getSortDirection();
+        if (bound != null) {
+            if (sortCol == null) {
+                log.warn("Ignoring bound {} since no sort order is specified");
+            }
+            else {
+                Condition boundCondition = builder.property(sortCol, sortDir.getRelOp(), bound);
+                condition = condition == null 
+                        ? boundCondition
+                        : builder.and(condition, boundCondition);
+            }
+        }
+
-        String sortCol = builder.getSortProperty();
-                 .append(builder.getSortDirection().getDirection());
+                 .append(sortDir.getDirection());
-        int count = builder.getMaxCount();
-        if (count == 0) {
+        long maxCount = builder.getMaxCount();
+        if (maxCount == 0) {
-        if (count > 0) {
-            query.setLimit(count);
+        if (maxCount > 0) {
+            query.setLimit(maxCount);
+        }
+
+        if (offset > 0) {
+            query.setOffset(offset);
-        for (XPathQueryBuilder.Condition c : condition) {
+        for (Condition c : condition) {
-        for (XPathQueryBuilder.Condition c : condition) {
+        for (Condition c : condition) {
