JCR-3809 don't swallow SQLException when binary streams can't be reset after sql execution failed

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1625277 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.util.db.Oracle10R1ConnectionHelper;
-import org.apache.jackrabbit.core.util.db.ResultSetWrapper;
-        try {
-        	stmt.execute();
-        } catch (SQLException e) {
-        	//Reset Stream for retry ...
-            for (int i = 0; params != null && i < params.length; i++) {
-                Object p = params[i];
-                if (p instanceof StreamWrapper) {
-                    StreamWrapper wrapper = (StreamWrapper) p;
-                    if(!wrapper.resetStream()) {
-                    	wrapper.cleanupResources();
-                    	throw new RuntimeException("Unable to reset the Stream.");
-                    }
-                }
-            }
-        	throw e;
-        }
+        stmt.execute();
+                    if (!resetParamResources()) {
+                        break; // don't try again if streams cannot be reset
+                    }
+
+        protected boolean resetParamResources() {
+            for (int i = 0; params != null && i < params.length; i++) {
+                Object p = params[i];
+                if (p instanceof StreamWrapper) {
+                    StreamWrapper wrapper = (StreamWrapper) p;
+                    if(!wrapper.resetStream()) {
+                        wrapper.cleanupResources();
+                        return false;
+                    }
+                }
+            }
+            return true;
+        }
