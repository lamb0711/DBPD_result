JCR-2886 : Add SessionImpl#isAdminOrSystem

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1072095 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.SessionImpl;
-import org.apache.jackrabbit.core.security.principal.AdminPrincipal;
+import javax.jcr.Session;
- * <li>the Session's Subject contains a {@link SystemPrincipal} <i>or</i>
- * an {@link AdminPrincipal}</li>
+ * <li>the Session's represents a system session or a session associated with
+ * the repository's administrator</li>
-        wspAccess = new WorkspaceAccess(wspAccessManager, isSystemOrAdmin(subject));
+        wspAccess = new WorkspaceAccess(wspAccessManager, isSystemOrAdmin(amContext.getSession()));
-     * @param subject The subject associated with the session.
+     * @param s the session
-    private static boolean isSystemOrAdmin(Subject subject) {
-        if (subject == null) {
+    private static boolean isSystemOrAdmin(Session s) {
+        if (s == null || !(s instanceof SessionImpl)) {
-            return !(subject.getPrincipals(SystemPrincipal.class).isEmpty() &&
-                     subject.getPrincipals(AdminPrincipal.class).isEmpty());
+            SessionImpl sImpl = (SessionImpl) s;
+            return sImpl.isSystem() || sImpl.isAdmin();
-        private final boolean isAdmin;
+        private final boolean alwaysAllowed;
-                                boolean isAdmin) {
+                                boolean alwaysAllowed) {
-            this.isAdmin = isAdmin;
-            if (!isAdmin) {
+            this.alwaysAllowed = alwaysAllowed;
+            if (!alwaysAllowed) {
-            if (isAdmin || wspAccessManager == null || allowed.contains(workspaceName)) {
+            if (alwaysAllowed || wspAccessManager == null || allowed.contains(workspaceName)) {
