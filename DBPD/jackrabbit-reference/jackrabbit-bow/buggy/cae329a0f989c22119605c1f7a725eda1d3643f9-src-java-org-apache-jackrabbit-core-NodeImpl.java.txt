reworked transaction support, contributed by dominique

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@151380 13f79535-47bb-0310-9956-ffa450edef68

-    protected void makePersistent(UpdateOperation update) {
+    protected void makePersistent() {
-            persistentState = update.createNew(transientState.getUUID(),
+            persistentState = stateMgr.createNew(transientState.getUUID(),
-        update.store(persistentState);
+        stateMgr.store(persistentState);
-            NodeReferences refs = stateMgr.getNodeReferences((NodeId) id);
+            NodeReferencesId targetId = new NodeReferencesId(((NodeId) id).getUUID());
+            NodeReferences refs = stateMgr.getNodeReferences(targetId);
