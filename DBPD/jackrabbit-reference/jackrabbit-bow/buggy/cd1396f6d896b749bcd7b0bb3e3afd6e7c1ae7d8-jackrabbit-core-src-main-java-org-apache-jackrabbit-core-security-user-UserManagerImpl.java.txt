JCR-2199 - Improvements to user management
- Allow subclasses of UserManagerImpl/UserImpl for custom implementations


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@792467 13f79535-47bb-0310-9956-ffa450edef68

-            throw new IllegalArgumentException("Cannot create user: Principal may not be null and must have a valid name.");            
+            throw new IllegalArgumentException("Cannot create user: Principal may not be null and must have a valid name.");
-        User user = UserImpl.create(userNode, this);
+        if (userNode == null || !userNode.isNodeType(NT_REP_USER)) {
+            throw new IllegalArgumentException();
+        }
+        if (!Text.isDescendant(USERS_PATH, userNode.getPath())) {
+            throw new IllegalArgumentException("User has to be within the User Path");
+        }
+        User user = doCreateUser(userNode);
+     * Build the user object from the given user node. May be overridden to
+     * return a custom implementation.
+     *
+     * @param node user node
+     * @return user object
+     * @throws RepositoryException if an error occurs
+     */
+    protected User doCreateUser(NodeImpl node) throws RepositoryException {
+        return new UserImpl(node, this);
+    }
+
+
+    /**
-    
+
-     * @see SessionListener#loggedOut(org.apache.jackrabbit.core.SessionImpl) 
+     * @see SessionListener#loggedOut(org.apache.jackrabbit.core.SessionImpl)
