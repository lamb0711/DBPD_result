JCR-623 Clustering


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@471760 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.cluster.UpdateEventChannel;
+import org.apache.jackrabbit.core.cluster.UpdateEventListener;
-public class VersionManagerImpl extends AbstractVersionManager implements ItemStateListener {
+public class VersionManagerImpl extends AbstractVersionManager implements ItemStateListener, UpdateEventListener {
+     * Set an event channel to inform about updates.
+     *
+     * @param eventChannel event channel
+     */
+    public void setEventChannel(UpdateEventChannel eventChannel) {
+        sharedStateMgr.setEventChannel(eventChannel);
+        eventChannel.setListener(this);
+    }
+
+    /**
+    //--------------------------------------------------< UpdateEventListener >
+
+    /**
+     * {@inheritDoc}
+     */
+    public void externalUpdate(ChangeLog changes, List events) throws RepositoryException {
+        EventStateCollection esc = getEscFactory().createEventStateCollection();
+        esc.addAll(events);
+
+        sharedStateMgr.externalUpdate(changes, esc);
+    }
+
