fixing concurrency issue that could lead to inconsistent repository content

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@240263 13f79535-47bb-0310-9956-ffa450edef68

-        super.copy(state);
+        synchronized (state) {
+            super.copy(state);
-        NodeState nodeState = (NodeState) state;
-        nodeTypeName = nodeState.getNodeTypeName();
-        mixinTypeNames = new HashSet(nodeState.getMixinTypeNames());
-        defId = nodeState.getDefinitionId();
-        uuid = nodeState.getUUID();
-        propertyNames = new HashSet(nodeState.getPropertyNames());
-        childNodeEntries = new ChildNodeEntries();
-        childNodeEntries.addAll(nodeState.getChildNodeEntries());
+            NodeState nodeState = (NodeState) state;
+            nodeTypeName = nodeState.getNodeTypeName();
+            mixinTypeNames = new HashSet(nodeState.getMixinTypeNames());
+            defId = nodeState.getDefinitionId();
+            uuid = nodeState.getUUID();
+            propertyNames = new HashSet(nodeState.getPropertyNames());
+            childNodeEntries = new ChildNodeEntries();
+            childNodeEntries.addAll(nodeState.getChildNodeEntries());
+        }
