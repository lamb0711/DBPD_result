JCR-2144 InternalValue refactoring

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@784058 13f79535-47bb-0310-9956-ffa450edef68

-                    if (value instanceof QValueValue) {
-                        QValueValue qvv = (QValueValue) value;
-                        QValue qv = qvv.getQValue();
-                        if (qv instanceof InternalValue) {
-                            InternalValue iv = (InternalValue) qv;
-
-                            iv.getBLOBFileValue();
-                        }
-                    }
-    public static InternalValue create(URI value) {
+    static InternalValue create(URI value) {
-     * @param values
-     * @return the created value
-     */
-    public static InternalValue[] create(String[] values) {
-        InternalValue[] ret = new InternalValue[values.length];
-        for (int i = 0; i < values.length; i++) {
-            ret[i] = new InternalValue(values[i]);
-        }
-        return ret;
-    }
-
-    /**
-    public BLOBFileValue getBLOBFileValue() {
+    BLOBFileValue getBLOBFileValue() {
-    public void store(DataStore dataStore) throws RepositoryException, IOException {
+    public void store(DataStore dataStore) throws RepositoryException {
-        } else if (v instanceof BLOBInMemory) {
-            if (v.getLength() < dataStore.getMinRecordLength()) {
-                // in memory and does not make sense to store, OK
-                return;
-            }
-        // store the temp file to the data store, or (theoretically) load it in memory
-        val = getBLOBFileValue(dataStore, v.getStream(), false);
+        // store it in the data store
+        val = BLOBInDataStore.getInstance(dataStore, getStream());
-            return ((BLOBFileValue) val).getLength();
+            return ((BLOBFileValue) val).getSize();
+
+    /**
+     * Delete persistent binary objects. This method does not delete objects in
+     * the data store.
+     */
+    public void deleteBinaryResource() {
+        if (type == PropertyType.BINARY) {
+            BLOBFileValue bfv = (BLOBFileValue) val;
+            bfv.delete(true);
+        }
+    }
+
