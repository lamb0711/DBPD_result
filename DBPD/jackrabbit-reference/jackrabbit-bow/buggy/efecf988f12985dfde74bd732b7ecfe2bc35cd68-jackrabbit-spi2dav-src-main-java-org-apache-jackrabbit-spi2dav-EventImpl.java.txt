JCR-2541: spi2dav : EventJournal not implemented

Add Atom Feed based Event Journal implementation.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1213890 13f79535-47bb-0310-9956-ffa450edef68

-    public EventImpl(ItemId eventId, Path eventPath, NodeId parentId,
-            int eventType, Element eventElement, NamePathResolver resolver,
-            QValueFactory qvFactory) throws NamespaceException,
+    public EventImpl(ItemId eventId, Path eventPath, NodeId parentId, int eventType, String userId,
+            Element eventElement, NamePathResolver resolver, QValueFactory qvFactory) throws NamespaceException,
-        super(getSpiEventType(eventType), eventPath, eventId, parentId,
-                resolver.getQName(DomUtil.getChildTextTrim(eventElement,
-                        XML_EVENTPRIMARNODETYPE, NAMESPACE)), getNames(
-                        DomUtil.getChildren(eventElement,
-                                XML_EVENTMIXINNODETYPE, NAMESPACE), resolver),
-                DomUtil.getChildTextTrim(eventElement, XML_EVENTUSERID,
-                        NAMESPACE), DomUtil.getChildTextTrim(eventElement,
-                        XML_EVENTUSERDATA, NAMESPACE), Long.parseLong(DomUtil
-                        .getChildTextTrim(eventElement, XML_EVENTDATE,
-                                NAMESPACE)), getEventInfo(
-                        DomUtil.getChildElement(eventElement, XML_EVENTINFO,
-                                NAMESPACE), resolver, qvFactory));
+        super(getSpiEventType(eventType), eventPath, eventId, parentId, getNameSafe(
+                DomUtil.getChildTextTrim(eventElement, XML_EVENTPRIMARNODETYPE, NAMESPACE), resolver), getNames(
+                DomUtil.getChildren(eventElement, XML_EVENTMIXINNODETYPE, NAMESPACE), resolver), userId, DomUtil
+                .getChildTextTrim(eventElement, XML_EVENTUSERDATA, NAMESPACE), Long.parseLong(DomUtil.getChildTextTrim(
+                eventElement, XML_EVENTDATE, NAMESPACE)), getEventInfo(
+                DomUtil.getChildElement(eventElement, XML_EVENTINFO, NAMESPACE), resolver, qvFactory));
+    private static Name getNameSafe(String name, NamePathResolver resolver) throws IllegalNameException, NamespaceException {
+        if (name == null) {
+            return null;
+        }
+        else {
+            return resolver.getQName(name);
+        }
+    }
+
