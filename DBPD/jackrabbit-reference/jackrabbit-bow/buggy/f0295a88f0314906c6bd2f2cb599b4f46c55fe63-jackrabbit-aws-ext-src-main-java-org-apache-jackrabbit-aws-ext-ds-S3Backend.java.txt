JCR-3748 - Allow configuring S3Backend programatically

As CachingDataStore invokes init directly its not possible to use the other init method. Added another way where clients can provide the required properties while creating S3DataStore

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1577481 13f79535-47bb-0310-9956-ffa450edef68

-    private Properties prop;
+    private Properties properties;
-        if (config == null) {
+        Properties initProps = null;
+        //Check is configuration is already provided. That takes precedence
+        //over config provided via file based config
+        if(this.properties != null){
+            initProps = this.properties;
+        } else if (config == null) {
+            try{
+                initProps = Utils.readConfig(config);
+            }catch(IOException e){
+                throw new DataStoreException("Could not initialize S3 from "
+                        + config, e);
+            }
+            this.properties = initProps;
-        Properties properties = null;
-        try{
-            properties = Utils.readConfig(config);
-        }catch(IOException e){
-            throw new DataStoreException("Could not initialize S3 from "
-                    + config, e);
-        }
-        init(store, homeDir, properties);
+        init(store, homeDir, initProps);
-            this.prop = prop;
+    /**
+     * Properties used to configure the backend. If provided explicitly
+     * before init is invoked then these take precedence
+     *
+     * @param properties  to configure S3Backend
+     */
+    public void setProperties(Properties properties) {
+        this.properties = properties;
+    }
+
-            int nThreads = Integer.parseInt(prop.getProperty("maxConnections"));
+            int nThreads = Integer.parseInt(properties.getProperty("maxConnections"));
