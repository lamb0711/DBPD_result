JCR-2219: Improved background text extraction

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@799610 13f79535-47bb-0310-9956-ffa450edef68

+     * Waits until all pending text extraction tasks have been processed
+     * and the updated index has been flushed to disk.
+     *
+     * @throws RepositoryException if the index update can not be written
+     */
+    public void flush() throws RepositoryException {
+        try {
+            index.getIndexingQueue().waitUntilEmpty();
+            index.flush();
+        } catch (IOException e) {
+            throw new RepositoryException("Failed to flush the index", e);
+        }
+    }
+
+    /**
