- VersionItemStateProvider speedup

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@111706 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.commons.collections.ReferenceMap;
+import java.util.Map;
+    /**
+     * the version histories. key=ItemId, value=ItemState
+     */
+    private Map items = new ReferenceMap(ReferenceMap.HARD, ReferenceMap.SOFT);
+
+
+    public boolean isVirtualRoot(ItemId id) {
+        return id.equals(root.getId());
+    }
+
+    public NodeId getVirtualRootId() {
+        return (NodeId) root.getId();
+    }
+
-        if (id instanceof NodeId) {
-            return getNodeState((NodeId) id);
-        } else {
-            return getPropertyState((PropertyId) id);
+
+        ItemState state = (ItemState) items.get(id);
+        if (state==null) {
+            if (id instanceof NodeId) {
+                state = getNodeState((NodeId) id);
+            } else {
+                state = getPropertyState((PropertyId) id);
+            }
+            // add state to cache
+            items.put(id, state);
+        return state;
+
-        if (id instanceof NodeId) {
+
+        // check cache
+        if (items.containsKey(id)) {
+            return true;
+        } else if (id instanceof NodeId) {
