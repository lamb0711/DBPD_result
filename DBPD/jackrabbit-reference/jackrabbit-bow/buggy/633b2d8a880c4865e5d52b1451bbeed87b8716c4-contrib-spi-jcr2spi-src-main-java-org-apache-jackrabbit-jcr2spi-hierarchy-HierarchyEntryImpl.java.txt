fixed: move, reorder (work in progress)
fixed: locktoken transfer
fixed: recursive transient removal of invalidated tree fails (restoreTests)
improve: simplify usage of workspace operations
fixed: store original itemId with transient operations in order to properly reflect the changelog upon batch creation
fixed: workspace import doesn't invalidate
fixed: session import uuid handling




git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@513279 13f79535-47bb-0310-9956-ffa450edef68

-        } else {
-            state.checkIsSessionState();
-            if (!state.isValid()) {
-                throw new ItemStateException("Cannot remove an invalid ItemState");
+        }
+
+        state.checkIsSessionState();
+        // if during recursive removal an invalidated entry is found, reload
+        // it in order to determine the current status.
+        if (state.getStatus() == Status.INVALIDATED) {
+            reload(false, false);
+            // check if upon reload the item has been removed -> nothing to do
+            if (Status.isTerminal(state.getStatus())) {
+                return;
-            int oldStatus = state.getStatus();
-            if (oldStatus == Status.NEW) {
+        }
+
+        switch (state.getStatus()) {
+            case Status.NEW:
-            } else {
+                break;
+            case Status.EXISTING:
+            case Status.EXISTING_MODIFIED:
-            }
+                break;
+            default:
+                throw new ItemStateException("Cannot transiently remove an ItemState with status " + Status.getName(state.getStatus()));
