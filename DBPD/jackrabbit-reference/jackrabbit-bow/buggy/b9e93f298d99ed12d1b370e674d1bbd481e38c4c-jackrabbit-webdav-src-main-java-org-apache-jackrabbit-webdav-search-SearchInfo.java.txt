JCR-2107: JSR 283 Query (work in progress)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@783005 13f79535-47bb-0310-9956-ffa450edef68

+    public static final long NRESULTS_UNDEFINED = -1;
+    public static final long OFFSET_UNDEFINED = -1;
+
+    private static final String LIMIT = "limit";
+    private static final String NRESULTS = "nresults";
+    private static final String OFFSET = "offset";
+
+    private long nresults = NRESULTS_UNDEFINED;
+    private long offset = OFFSET_UNDEFINED;
+
+     * Returns the maximal number of search results that should be returned.
+     *
+     * @return the maximal number of search results that should be returned.
+     */
+    public long getNumberResults() {
+        return nresults;
+    }
+
+    /**
+     * Sets the maximal number of search results that should be returned.
+     *
+     * @param nresults The maximal number of search results
+     */
+    public void setNumberResults(long nresults) {
+        this.nresults = nresults;
+    }
+
+    /**
+     * Returns the desired offset in the total result set.
+     *
+     * @return the desired offset in the total result set.
+     */
+    public long getOffset() {
+        return offset;
+    }
+
+    /**
+     * Sets the desired offset in the total result set.
+     *
+     * @param offset The desired offset in the total result set.
+     */
+    public void setOffset(long offset) {
+        this.offset = offset;
+    }
+
+    /**
+        if (nresults != NRESULTS_UNDEFINED|| offset != OFFSET_UNDEFINED) {
+            Element limitE = DomUtil.addChildElement(sRequestElem, LIMIT, NAMESPACE);
+            if (nresults != NRESULTS_UNDEFINED) {
+                DomUtil.addChildElement(limitE, NRESULTS, NAMESPACE, nresults + "");
+            }
+            if (offset != OFFSET_UNDEFINED) {
+                // TODO define reasonable namespace...
+                DomUtil.addChildElement(limitE, OFFSET, Namespace.EMPTY_NAMESPACE, offset + "");
+            }
+        }
+        SearchInfo sInfo;
-            return new SearchInfo(first.getLocalName(), DomUtil.getNamespace(first), DomUtil.getText(first), namespaces);
+            sInfo = new SearchInfo(first.getLocalName(), DomUtil.getNamespace(first), DomUtil.getText(first), namespaces);
+
+        Element limit = DomUtil.getChildElement(searchRequest, LIMIT, NAMESPACE);
+        if (limit != null) {
+            // try to get the value DAV:nresults element
+            String nresults = DomUtil.getChildTextTrim(limit, NRESULTS, NAMESPACE);
+            if (nresults != null) {
+                try {
+                    sInfo.setNumberResults(Long.valueOf(nresults));
+                } catch (NumberFormatException e) {
+                    log.error("DAV:nresults cannot be parsed into a long -> ignore.");
+                }
+            }
+            // try of an offset is defined within the DAV:limit element.
+            String offset = DomUtil.getChildTextTrim(limit, OFFSET, Namespace.EMPTY_NAMESPACE);
+            if (offset != null) {
+                try {
+                    sInfo.setOffset(Long.valueOf(offset));
+                } catch (NumberFormatException e) {
+                    log.error("'offset' cannot be parsed into a long -> ignore.");
+                }
+            }
+        }
+        return sInfo;
