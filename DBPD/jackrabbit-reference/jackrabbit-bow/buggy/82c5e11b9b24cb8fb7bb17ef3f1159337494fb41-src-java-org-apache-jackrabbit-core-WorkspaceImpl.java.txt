forgot to close temporary session on other workspace

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@157330 13f79535-47bb-0310-9956-ffa450edef68

-        // create session on other workspace for current subject
-        // (may throw NoSuchWorkspaceException and AccessDeniedException)
-        SessionImpl srcSession =
-                rep.createSession(session.getSubject(), srcWorkspace);
-        WorkspaceImpl srcWsp = (WorkspaceImpl) srcSession.getWorkspace();
+        SessionImpl srcSession = null;
+        try {
+            // create session on other workspace for current subject
+            // (may throw NoSuchWorkspaceException and AccessDeniedException)
+            srcSession = rep.createSession(session.getSubject(), srcWorkspace);
+            WorkspaceImpl srcWsp = (WorkspaceImpl) srcSession.getWorkspace();
-        // do cross-workspace copy
-        internalCopy(srcAbsPath, srcWsp, destAbsPath, true);
+            // do cross-workspace copy
+            internalCopy(srcAbsPath, srcWsp, destAbsPath, true);
+        } finally {
+            if (srcSession != null) {
+                // we don't need the other session anymore, logout
+                srcSession.logout();
+            }
+        }
-        // create session on other workspace for current subject
-        // (may throw NoSuchWorkspaceException and AccessDeniedException)
-        SessionImpl srcSession =
-                rep.createSession(session.getSubject(), srcWorkspace);
-        WorkspaceImpl srcWsp = (WorkspaceImpl) srcSession.getWorkspace();
+        SessionImpl srcSession = null;
+        try {
+            // create session on other workspace for current subject
+            // (may throw NoSuchWorkspaceException and AccessDeniedException)
+            srcSession = rep.createSession(session.getSubject(), srcWorkspace);
+            WorkspaceImpl srcWsp = (WorkspaceImpl) srcSession.getWorkspace();
-        // do cross-workspace copy
-        internalCopy(srcAbsPath, srcWsp, destAbsPath, false);
+            // do cross-workspace copy
+            internalCopy(srcAbsPath, srcWsp, destAbsPath, false);
+        } finally {
+            if (srcSession != null) {
+                // we don't need the other session anymore, logout
+                srcSession.logout();
+            }
+        }
