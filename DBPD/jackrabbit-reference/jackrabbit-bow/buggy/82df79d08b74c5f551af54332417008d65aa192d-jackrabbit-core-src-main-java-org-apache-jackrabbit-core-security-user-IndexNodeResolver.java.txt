- resolving TODOs (retrieve group by ID)
- improved NodeResolver (replacing SessionImpl by Session/NamePathResolver pair)

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@641898 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.core.SessionImpl;
+import org.apache.jackrabbit.spi.commons.conversion.NamePathResolver;
+import javax.jcr.Session;
-    IndexNodeResolver(SessionImpl session)
-            throws RepositoryException {
-        super(session);
+    IndexNodeResolver(Session session, NamePathResolver resolver) throws RepositoryException {
+        super(session, resolver);
+    public Node findNode(Name nodeName, Name ntName) throws RepositoryException {
+        Query query = buildQuery(nodeName, ntName);
+        NodeIterator res = query.execute().getNodes();
+        if (res.hasNext()) {
+            return res.nextNode();
+        }
+        return null;
+    }
+    
+    /**
+     * @inheritDoc
+     */
+    private Query buildQuery(Name nodeName, Name ntName)
+            throws RepositoryException {
+        StringBuffer stmt = new StringBuffer("/jcr:root");
+        stmt.append(getSearchRoot(ntName));
+        stmt.append("//element(");
+        stmt.append(getNamePathResolver().getJCRName(nodeName));
+        stmt.append(",");
+        stmt.append(getNamePathResolver().getJCRName(ntName));
+        stmt.append(")");
+        return queryManager.createQuery(stmt.toString(), Query.XPATH);
+    }
+
+    /**
+     *
+     * @param value
+     * @param props
+     * @param ntName
+     * @param exact
+     * @param maxSize Currently ignored!
+     * @return
+     * @throws RepositoryException
+     */
-        stmt.append(getSession().getJCRName(ntName));
+        stmt.append(getNamePathResolver().getJCRName(ntName));
-            String pName = getSession().getJCRName((Name) itr.next());
+            String pName = getNamePathResolver().getJCRName((Name) itr.next());
