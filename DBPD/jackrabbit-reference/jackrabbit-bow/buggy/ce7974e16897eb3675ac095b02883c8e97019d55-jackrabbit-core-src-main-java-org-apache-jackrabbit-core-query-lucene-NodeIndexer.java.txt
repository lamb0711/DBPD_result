JCR-1730: Background text extraction not possible when supportHighlighting is set true

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@694164 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.commons.io.IOUtils;
+import org.apache.lucene.document.Fieldable;
-import java.io.IOException;
-            doc.add((Field) it.next());
+            doc.add((Fieldable) it.next());
-    protected Field createFulltextField(Reader value) {
+    protected Fieldable createFulltextField(Reader value) {
-            // need to create a string value
-            StringBuffer textExtract = new StringBuffer();
-            char[] buffer = new char[1024];
-            int len;
-            try {
-                while ((len = value.read(buffer)) > -1) {
-                    textExtract.append(buffer, 0, len);
-                }
-            } catch (IOException e) {
-                log.warn("Exception reading value for fulltext field: "
-                        + e.getMessage());
-                log.debug("Dump:", e);
-            } finally {
-                IOUtils.closeQuietly(value);
-            }
-            return createFulltextField(textExtract.toString(), true, true);
+            return new LazyTextExtractorField(FieldNames.FULLTEXT, value, true, true);
-            return new Field(FieldNames.FULLTEXT, value);
+            return new LazyTextExtractorField(FieldNames.FULLTEXT, value, false, false);
