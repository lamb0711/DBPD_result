JCR-255 Workspace operations (copy/clone) do not handle references correctly

consolidated code that maintains/enforces referential integrity (RI):
SharedItemStateManager.store(ChangeLog) is now the only place where
RI is maintained and enforced

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@326916 13f79535-47bb-0310-9956-ffa450edef68

+import javax.jcr.ReferentialIntegrityException;
-    public void store(NodeReferences refs) throws IllegalStateException {
-        if (!editMode) {
-            throw new IllegalStateException("Not in edit mode");
-        }
-        changeLog.modified(refs);
-    }
-
-    /**
-     * {@inheritDoc}
-     */
-            throws StaleItemStateException, ItemStateException,
-            IllegalStateException {
+            throws ReferentialIntegrityException, StaleItemStateException,
+            ItemStateException, IllegalStateException {
-     * @throws StaleItemStateException if at least one of the affected item
-     *                                 states has become stale in the meantime
-     * @throws ItemStateException if an error occurs
+     * @throws ReferentialIntegrityException if a new or modified REFERENCE
+     *                                       property refers to a non-existent
+     *                                       target or if a removed node is still
+     *                                       being referenced
+     * @throws StaleItemStateException       if at least one of the affected item
+     *                                       states has become stale in the meantime
+     * @throws ItemStateException            if an error occurs
-            throws StaleItemStateException, ItemStateException {
+            throws ReferentialIntegrityException, StaleItemStateException,
+            ItemStateException {
