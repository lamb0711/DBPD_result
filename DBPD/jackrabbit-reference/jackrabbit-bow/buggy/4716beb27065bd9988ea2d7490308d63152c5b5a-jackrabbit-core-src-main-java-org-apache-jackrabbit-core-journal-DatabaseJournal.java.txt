JCR-773 - Under heavy load, database journal may contain empty update records.


git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@513340 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.File;
-import java.io.BufferedInputStream;
-import java.io.FileInputStream;
-    protected long append(String producerId, File file) throws JournalException {
-        try {
-            InputStream in = new BufferedInputStream(new FileInputStream(file));
+    protected long append(String producerId, InputStream in, int length)
+            throws JournalException {
+        try {
-                insertRevisionStmt.setBinaryStream(4, in, (int) file.length());
+                insertRevisionStmt.setBinaryStream(4, in, length);
-                close(in);
-
-        } catch (IOException e) {
-            String msg = "Unable to open journal log '" + file + "'.";
-            throw new JournalException(msg, e);
