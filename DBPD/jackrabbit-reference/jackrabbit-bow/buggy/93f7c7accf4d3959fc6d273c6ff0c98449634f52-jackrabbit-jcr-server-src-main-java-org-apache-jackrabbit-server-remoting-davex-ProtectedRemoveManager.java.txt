JCR-3874 : XML Configuration for ProtectedItemRemoveHandler implementations (credits to Alfusainey Jallow, who reported the issue and provided the patch. Thanks Alfu for your contribution.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1695294 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.FileNotFoundException;
-import java.util.Enumeration;
-import java.util.Properties;
-public class ProtectedRemoveManager {
+class ProtectedRemoveManager {
-    public ProtectedRemoveManager(String config) throws IOException {
+    ProtectedRemoveManager(String config) throws IOException {
-        		 InputStream inStream = new FileInputStream(file);
-                 Properties props = new Properties();
-        		 props.load(inStream);             
-        		 for (Enumeration<?> en = props.propertyNames(); en.hasMoreElements();) {             
-        			 String key = en.nextElement().toString();                 
-        			 String className = props.getProperty(key);                 
-        			 if (!className.isEmpty()) {                 
-        				 ProtectedItemRemoveHandler irHandler = createHandler(className);                     
-        				 if (irHandler != null) {                     
-        					 handlers.add(irHandler);                        
-        				 }                    
-        			 }                
-        		 }            
+ 				try {
+                    InputStream fis = new FileInputStream(file);
+ 					ProtectedRemoveConfig prConfig = new ProtectedRemoveConfig(this);
+ 					prConfig.parse(fis);
+ 				} catch (FileNotFoundException e) {
+ 					throw new IOException(e.getMessage(), e);
+ 				}            
-        			 ProtectedItemRemoveHandler irHandler = createHandler(config);        	         
-        			 if (irHandler != null) {        	         
-        				 handlers.add(irHandler);        	            
-        			 }        	    	
+        			 ProtectedItemRemoveHandler handler = createHandler(config); 					
+        			 addHandler(handler);        	    	
-    public boolean remove(Session session, String itemPath) throws RepositoryException {
+    boolean remove(Session session, String itemPath) throws RepositoryException {
-    private static ProtectedItemRemoveHandler createHandler(String className) {
+    ProtectedItemRemoveHandler createHandler(String className) {
+    	ProtectedItemRemoveHandler irHandler = null;
-            Class<?> irHandlerClass = Class.forName(className);
-            if (ProtectedItemRemoveHandler.class.isAssignableFrom(irHandlerClass)) {
-                ProtectedItemRemoveHandler irHandler = (ProtectedItemRemoveHandler) irHandlerClass.newInstance();
-                return irHandler;
-            }
+        	if (!className.isEmpty()) {
+				Class<?> irHandlerClass = Class.forName(className);
+				if (ProtectedItemRemoveHandler.class.isAssignableFrom(irHandlerClass)) {
+					irHandler = (ProtectedItemRemoveHandler) irHandlerClass.newInstance();
+				}
+			}
-        return null;
+        return irHandler;
+    
+    void addHandler(ProtectedItemRemoveHandler instance) {
+		if (instance != null) {
+			handlers.add(instance);
+		}
+	}
