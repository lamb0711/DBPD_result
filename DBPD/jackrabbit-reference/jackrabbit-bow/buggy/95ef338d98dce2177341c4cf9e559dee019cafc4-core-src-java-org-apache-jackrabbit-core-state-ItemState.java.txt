fixing concurrency issue that could lead to inconsistent repository content

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@240263 13f79535-47bb-0310-9956-ffa450edef68

-    protected void copy(ItemState state) {
-        parentUUID = state.getParentUUID();
-        id = state.getId();
+    protected synchronized void copy(ItemState state) {
+        synchronized (state) {
+            parentUUID = state.getParentUUID();
+            id = state.getId();
+        }
-            // this instance represents existing state, update it
-            pull();
-            notifyStateUpdated();
+            synchronized (this) {
+                // this instance represents existing state, update it
+                pull();
+                notifyStateUpdated();
+            }
