- Redesigned observation to also include workspace modifications
- Extended observation tests and moved them into the api.observation package

git-svn-id: https://svn.apache.org/repos/asf/incubator/jackrabbit/trunk@155583 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.jackrabbit.core.observation.ObservationManagerImpl;
+import org.apache.jackrabbit.core.observation.EventStateCollection;
-     * by this state manager.
+     * by this state manager.<p/>
+     * After successfully storing the states the observation manager is informed
+     * about the changes, if an observation manager is passed to this method.
+     * @param obsMgr the observation manager to inform, or <code>null</code> if
+     *  no observation manager should be informed.
-    public synchronized void store(ChangeLog local) throws ItemStateException {
+    public synchronized void store(ChangeLog local, ObservationManagerImpl obsMgr) throws ItemStateException {
+        /* prepare the events */
+        EventStateCollection events = null;
+        if (obsMgr != null) {
+            events = obsMgr.createEventStateCollection();
+            events.createEventStates(local, this);
+            events.prepare();
+        }
+
+
+        /* dispatch the events */
+        if (events != null) {
+            events.dispatch();
+        }
