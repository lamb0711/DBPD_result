JCR-1588: Access Control

- use valuefactory from session rather that ValueFactoryImpl

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@758265 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.jackrabbit.value.ValueFactoryImpl;
-    private static final ValueFactory V_FACTORY = ValueFactoryImpl.getInstance();
-
+    private final ValueFactory valueFactory;
+
-    ACLTemplate(Principal principal, String path, NamePathResolver resolver) throws RepositoryException {
-        this(principal, path, null, resolver);
+    ACLTemplate(Principal principal, String path, NamePathResolver resolver, ValueFactory vf) throws RepositoryException {
+        this(principal, path, null, resolver, vf);
-        this(principal, acNode.getPath(), acNode, (SessionImpl) acNode.getSession());
+        this(principal, acNode.getPath(), acNode, (SessionImpl) acNode.getSession(), acNode.getSession().getValueFactory());
-    private ACLTemplate(Principal principal, String path, NodeImpl acNode, NamePathResolver resolver)
+    private ACLTemplate(Principal principal, String path, NodeImpl acNode,
+                        NamePathResolver resolver, ValueFactory vf)
+        this.valueFactory = vf;
-            v = V_FACTORY.createValue(v.getString(), PropertyType.PATH);
+            v = valueFactory.createValue(v.getString(), PropertyType.PATH);
-            v = V_FACTORY.createValue(v.getString(), PropertyType.STRING);
+            v = valueFactory.createValue(v.getString(), PropertyType.STRING);
-                    V_FACTORY.createValue(getPath(), PropertyType.PATH));
+                    valueFactory.createValue(getPath(), PropertyType.PATH));
-            super(principal, privileges, allow, restrictions);
+            super(principal, privileges, allow, restrictions, valueFactory);
