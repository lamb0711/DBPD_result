JCR-890: concurrent read-only access to a session

Leverage SessionContext in more places.

git-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@957141 13f79535-47bb-0310-9956-ffa450edef68

-    private final NodeId rootNodeId;
-     * The data store of this repository, or <code>null</code>
-     */
-    private final DataStore dataStore;
-
-    /**
-     * @param rootNodeId  the id of the root node
-     * @param dataStore   the data store of this repository, or <code>null</code>
-            SessionContext sessionContext, NodeDefinitionImpl rootNodeDef,
-            NodeId rootNodeId, DataStore dataStore) {
+            SessionContext sessionContext, NodeDefinitionImpl rootNodeDef) {
-        this.rootNodeId = rootNodeId;
-        this.dataStore = dataStore;
-     * Creates a new per-session instance <code>ItemManager</code> instance.
-     *
-     * @param sessionContext component context of the associated session
-     * @param rootNodeDef       the definition of the root node
-     * @param rootNodeId        the id of the root node
-     * @param dataStore   the data store of this repository, or <code>null</code>
-     * @return the item manager instance.
-     */
-    public static ItemManager createInstance(
-            SessionContext sessionContext,
-            NodeDefinitionImpl rootNodeDef,
-            NodeId rootNodeId,
-            DataStore dataStore) {
-        ItemManager mgr = new ItemManager(
-                sessionContext, rootNodeDef, rootNodeId, dataStore);
-        sessionContext.getItemStateManager().addListener(mgr);
-        return mgr;
-    }
-
-    /**
-        if (state.getId().equals(rootNodeId)) {
+        if (state.getId().equals(sessionContext.getRootNodeId())) {
-        return (NodeImpl) getItem(rootNodeId);
+        return (NodeImpl) getItem(sessionContext.getRootNodeId());
-        return new PropertyImpl(this, sessionContext, data, dataStore);
+        return new PropertyImpl(this, sessionContext, data);
