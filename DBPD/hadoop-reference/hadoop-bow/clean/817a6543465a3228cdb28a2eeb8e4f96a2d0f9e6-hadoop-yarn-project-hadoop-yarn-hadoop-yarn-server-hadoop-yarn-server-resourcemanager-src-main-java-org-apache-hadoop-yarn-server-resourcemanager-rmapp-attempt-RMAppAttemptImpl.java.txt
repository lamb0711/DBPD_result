YARN-945. Removed setting of AMRMToken's service from ResourceManager and changed client libraries do it all the time and correctly. Contributed by Vinod Kumar Vavilapalli.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1508232 13f79535-47bb-0310-9956-ffa450edef68

-import java.net.InetSocketAddress;
-import org.apache.hadoop.security.SecurityUtil;
-import org.apache.hadoop.yarn.security.AMRMTokenSelector;
-    InetSocketAddress serviceAddr =
-        conf.getSocketAddr(YarnConfiguration.RM_SCHEDULER_ADDRESS,
-          YarnConfiguration.DEFAULT_RM_SCHEDULER_ADDRESS,
-          YarnConfiguration.DEFAULT_RM_SCHEDULER_PORT);
-    AMRMTokenSelector appTokenSelector = new AMRMTokenSelector();
+    // Only one AMRMToken is stored per-attempt, so this should be fine. Can't
+    // use TokenSelector as service may change - think fail-over.
-        appTokenSelector.selectToken(
-          SecurityUtil.buildTokenService(serviceAddr),
-          appAttemptTokens.getAllTokens());
+        (Token<AMRMTokenIdentifier>) appAttemptTokens
+          .getToken(RMStateStore.AM_RM_TOKEN_SERVICE);
-      Token<AMRMTokenIdentifier> amRmToken =
+      appAttempt.amrmToken =
-      InetSocketAddress serviceAddr =
-          appAttempt.conf.getSocketAddr(YarnConfiguration.RM_SCHEDULER_ADDRESS,
-            YarnConfiguration.DEFAULT_RM_SCHEDULER_ADDRESS,
-            YarnConfiguration.DEFAULT_RM_SCHEDULER_PORT);
-      // normally the client should set the service after acquiring the
-      // token, but this token is directly provided to the AMs
-      SecurityUtil.setTokenService(amRmToken, serviceAddr);
-
-      appAttempt.amrmToken = amRmToken;
