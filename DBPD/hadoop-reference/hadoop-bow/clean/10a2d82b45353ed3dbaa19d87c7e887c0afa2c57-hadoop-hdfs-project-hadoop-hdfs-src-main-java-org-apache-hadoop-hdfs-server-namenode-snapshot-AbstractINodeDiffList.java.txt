HDFS-4719. Remove AbstractINodeDiff.Factory and move its methods to AbstractINodeDiffList.  Contributed by Arpit Agarwal


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1470759 13f79535-47bb-0310-9956-ffa450edef68

-  private AbstractINodeDiff.Factory<N, D> factory;
-
-  void setFactory(AbstractINodeDiff.Factory<N, D> factory) {
-    this.factory = factory;
-  }
-
+  /** @return an {@link AbstractINodeDiff}. */
+  abstract D createDiff(Snapshot snapshot, N currentINode);
+
+  /** @return a snapshot copy of the current inode. */  
+  abstract N createSnapshotCopy(N currentINode);
+
-    return addLast(factory.createDiff(latest, currentINode));
+    return addLast(createDiff(latest, currentINode));
-      checkAndAddLatestSnapshotDiff(latest, currentINode).saveSnapshotCopy(
-          snapshotCopy, factory, currentINode);
+      D diff = checkAndAddLatestSnapshotDiff(latest, currentINode);
+      if (diff.snapshotINode == null) {
+        if (snapshotCopy == null) {
+          snapshotCopy = createSnapshotCopy(currentINode);
+        }
+        diff.saveSnapshotCopy(snapshotCopy, currentINode);
+      }
