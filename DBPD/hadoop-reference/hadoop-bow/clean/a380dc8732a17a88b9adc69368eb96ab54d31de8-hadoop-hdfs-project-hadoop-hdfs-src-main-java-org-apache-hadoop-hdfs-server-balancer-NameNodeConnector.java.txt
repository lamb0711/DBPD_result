HDFS-2592. Balancer support for HA namenodes. Contributed by Uma Maheswara Rao G.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1232531 13f79535-47bb-0310-9956-ffa450edef68

+import java.net.URI;
-import java.util.HashMap;
-import java.util.Map;
-import java.util.concurrent.TimeUnit;
+import org.apache.hadoop.hdfs.HAUtil;
-import org.apache.hadoop.hdfs.protocolPB.NamenodeProtocolPB;
-import org.apache.hadoop.hdfs.protocolPB.NamenodeProtocolTranslatorPB;
-import org.apache.hadoop.io.retry.RetryPolicies;
-import org.apache.hadoop.io.retry.RetryPolicy;
-import org.apache.hadoop.io.retry.RetryProxy;
-import org.apache.hadoop.ipc.ProtobufRpcEngine;
-import org.apache.hadoop.ipc.RPC;
-import org.apache.hadoop.net.NetUtils;
-    InetSocketAddress nn = Lists.newArrayList(haNNs).get(0);
-    // TODO(HA): need to deal with connecting to HA NN pair here
-    this.namenodeAddress = nn;
-    this.namenode = DFSUtil.createNNProxyWithNamenodeProtocol(nn, conf,
-        UserGroupInformation.getCurrentUser());
-    this.client = DFSUtil.createNamenode(conf);
-    this.fs = FileSystem.get(NameNode.getUri(nn), conf);
+    this.namenodeAddress = Lists.newArrayList(haNNs).get(0);
+    URI nameNodeUri = NameNode.getUri(this.namenodeAddress);
+    NamenodeProtocol failoverNamenode = (NamenodeProtocol) HAUtil
+        .createFailoverProxy(conf, nameNodeUri, NamenodeProtocol.class);
+    if (null != failoverNamenode) {
+      this.namenode = failoverNamenode;
+    } else {
+      this.namenode = DFSUtil.createNNProxyWithNamenodeProtocol(
+          this.namenodeAddress, conf, UserGroupInformation.getCurrentUser());
+    }
+    ClientProtocol failOverClient = (ClientProtocol) HAUtil
+        .createFailoverProxy(conf, nameNodeUri, ClientProtocol.class);
+    if (null != failOverClient) {
+      this.client = failOverClient;
+    } else {
+      this.client = DFSUtil.createNamenode(conf);
+    }
+    this.fs = FileSystem.get(nameNodeUri, conf);
