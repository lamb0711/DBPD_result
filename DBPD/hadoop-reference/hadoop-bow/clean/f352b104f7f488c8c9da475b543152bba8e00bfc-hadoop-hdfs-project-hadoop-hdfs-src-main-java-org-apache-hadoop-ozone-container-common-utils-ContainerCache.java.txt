HDFS-12337. Ozone: Concurrent RocksDB open calls fail because of "No locks available". Contributed by Mukul Kumar Singh.

-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
+import org.apache.hadoop.utils.MetadataStoreBuilder;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+import java.io.File;
-  static final Log LOG = LogFactory.getLog(ContainerCache.class);
+  private static final Logger LOG =
+      LoggerFactory.getLogger(ContainerCache.class);
-   * Returns a DB handle if available, null otherwise.
+   * Returns a DB handle if available, create the handler otherwise.
-  public MetadataStore getDB(String containerName) {
+  public MetadataStore getDB(String containerName, String containerDBPath)
+      throws IOException {
-      return (MetadataStore) this.get(containerName);
+      MetadataStore db = (MetadataStore) this.get(containerName);
+
+      if (db == null) {
+        db = MetadataStoreBuilder.newBuilder()
+            .setDbFile(new File(containerDBPath))
+            .setCreateIfMissing(false)
+            .build();
+        this.put(containerName, db);
+      }
+      return db;
+    } catch (Exception e) {
+      LOG.error("Error opening DB. Container:{} ContainerPath:{}",
+          containerName, containerDBPath, e);
+      throw e;
-      MetadataStore db = this.getDB(containerName);
+      MetadataStore db = (MetadataStore)this.get(containerName);
-
-  /**
-   * Add a new DB to the cache.
-   *
-   * @param containerName - Name of the container
-   * @param db            - DB handle
-   */
-  public void putDB(String containerName, MetadataStore db) {
-    Preconditions.checkNotNull(containerName);
-    Preconditions.checkState(!containerName.isEmpty());
-    lock.lock();
-    try {
-      this.put(containerName, db);
-    } finally {
-      lock.unlock();
-    }
-  }
