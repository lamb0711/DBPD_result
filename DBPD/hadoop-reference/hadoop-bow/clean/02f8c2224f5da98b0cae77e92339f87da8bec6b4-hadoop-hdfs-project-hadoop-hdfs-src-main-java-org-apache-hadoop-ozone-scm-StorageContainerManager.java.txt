HDFS-11888. Ozone: SCM: use state machine for open containers allocated for key/blocks. Contributed by Xiaoyu Yao.

+import org.apache.hadoop.ozone.protocol.proto.StorageContainerLocationProtocolProtos.NotifyObjectCreationStageRequestProto;
+import org.apache.hadoop.scm.container.common.helpers.ContainerInfo;
-    return scmContainerManager.getContainer(containerName);
+    return scmContainerManager.getContainer(containerName).getPipeline();
+   * Notify from client when begin/finish creating container/pipeline objects
+   * on datanodes.
+   * @param type
+   * @param name
+   * @param stage
+   */
+  @Override
+  public void notifyObjectCreationStage(
+      NotifyObjectCreationStageRequestProto.Type type, String name,
+      NotifyObjectCreationStageRequestProto.Stage stage) throws IOException {
+
+    if (type == NotifyObjectCreationStageRequestProto.Type.container) {
+      ContainerInfo info = scmContainerManager.getContainer(name);
+      LOG.info("Container {} current state {} new stage {}", name,
+          info.getState(), stage);
+      if (stage == NotifyObjectCreationStageRequestProto.Stage.begin) {
+        scmContainerManager.updateContainerState(name,
+            OzoneProtos.LifeCycleEvent.BEGIN_CREATE);
+      } else {
+        scmContainerManager.updateContainerState(name,
+            OzoneProtos.LifeCycleEvent.COMPLETE_CREATE);
+      }
+    } else if (type == NotifyObjectCreationStageRequestProto.Type.pipeline) {
+      // TODO: pipeline state update will be addressed in future patch.
+    }
+  }
+
+  /**
-   * @return Pipeline.
+   * @return pipeline
-        replicationFactor, containerName);
+        replicationFactor, containerName).getPipeline();
