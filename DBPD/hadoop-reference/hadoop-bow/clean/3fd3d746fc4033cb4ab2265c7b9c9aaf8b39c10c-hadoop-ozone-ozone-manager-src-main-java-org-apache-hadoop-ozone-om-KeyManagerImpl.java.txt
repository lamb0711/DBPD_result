HDDS-2161. Create RepeatedKeyInfo structure to be saved in deletedTable

Signed-off-by: Anu Engineer <aengineer@apache.org>

+import org.apache.hadoop.ozone.om.helpers.RepeatedOmKeyInfo;
-      metadataManager.getStore().move(objectKey,
-          metadataManager.getKeyTable(),
-          metadataManager.getDeletedTable());
+      //Check if key with same keyName exists in deletedTable and then
+      // insert/update accordingly.
+      RepeatedOmKeyInfo repeatedOmKeyInfo =
+          metadataManager.getDeletedTable().get(objectKey);
+      if(repeatedOmKeyInfo == null) {
+        repeatedOmKeyInfo = new RepeatedOmKeyInfo(keyInfo);
+      } else {
+        repeatedOmKeyInfo.addOmKeyInfo(keyInfo);
+      }
+      metadataManager.getKeyTable().delete(objectKey);
+      metadataManager.getDeletedTable().put(objectKey, repeatedOmKeyInfo);
-        metadataManager.getDeletedTable().put(partName, keyInfo);
+        RepeatedOmKeyInfo repeatedOmKeyInfo =
+            metadataManager.getDeletedTable().get(partName);
+        if(repeatedOmKeyInfo == null) {
+          repeatedOmKeyInfo = new RepeatedOmKeyInfo(keyInfo);
+        } else {
+          repeatedOmKeyInfo.addOmKeyInfo(keyInfo);
+        }
+        metadataManager.getDeletedTable().put(partName, repeatedOmKeyInfo);
+            RepeatedOmKeyInfo repeatedOmKeyInfo = metadataManager.
+                getDeletedTable().get(oldPartKeyInfo.getPartName());
+            if(repeatedOmKeyInfo == null) {
+              repeatedOmKeyInfo = new RepeatedOmKeyInfo(
+                  OmKeyInfo.getFromProtobuf(oldPartKeyInfo.getPartKeyInfo()));
+            } else {
+              repeatedOmKeyInfo.addOmKeyInfo(
+                  OmKeyInfo.getFromProtobuf(oldPartKeyInfo.getPartKeyInfo()));
+            }
+            metadataManager.getDeletedTable().put(partName, repeatedOmKeyInfo);
-                OmKeyInfo.getFromProtobuf(oldPartKeyInfo.getPartKeyInfo()));
+                repeatedOmKeyInfo);
+
+            RepeatedOmKeyInfo repeatedOmKeyInfo = metadataManager.
+                getDeletedTable().get(partKeyInfo.getPartName());
+            if(repeatedOmKeyInfo == null) {
+              repeatedOmKeyInfo = new RepeatedOmKeyInfo(currentKeyPartInfo);
+            } else {
+              repeatedOmKeyInfo.addOmKeyInfo(currentKeyPartInfo);
+            }
+
-                partKeyInfo.getPartName(), currentKeyPartInfo);
+                partKeyInfo.getPartName(), repeatedOmKeyInfo);
