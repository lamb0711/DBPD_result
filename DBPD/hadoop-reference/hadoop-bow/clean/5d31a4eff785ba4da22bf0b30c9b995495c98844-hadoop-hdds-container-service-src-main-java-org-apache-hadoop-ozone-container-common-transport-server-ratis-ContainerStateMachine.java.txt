HDDS-1753. Datanode unable to find chunk while replication data using ratis. (#1318)


+import com.google.common.annotations.VisibleForTesting;
-      ContainerCommandRequestProto requestProto, long term, long index) {
+      ContainerCommandRequestProto requestProto, long term, long index)
+      throws IOException {
-            .setCmdType(Type.ReadChunk)
-            .setReadChunk(readChunkRequestProto)
+            .setCmdType(Type.ReadChunk).setReadChunk(readChunkRequestProto)
-        new DispatcherContext.Builder()
-            .setTerm(term)
-            .setLogIndex(index)
-            .setReadFromTmpFile(true)
-            .build();
+        new DispatcherContext.Builder().setTerm(term).setLogIndex(index)
+            .setReadFromTmpFile(true).build();
+    if (response.getResult() != ContainerProtos.Result.SUCCESS) {
+      StorageContainerException sce =
+          new StorageContainerException(response.getMessage(),
+              response.getResult());
+      LOG.error("gid {} : ReadStateMachine failed. cmd {} logIndex {} msg : "
+              + "{} Container Result: {}", gid, response.getCmdType(), index,
+          response.getMessage(), response.getResult());
+      throw sce;
+    }
+
-  private void evictStateMachineCache() {
+  @VisibleForTesting
+  public void evictStateMachineCache() {
