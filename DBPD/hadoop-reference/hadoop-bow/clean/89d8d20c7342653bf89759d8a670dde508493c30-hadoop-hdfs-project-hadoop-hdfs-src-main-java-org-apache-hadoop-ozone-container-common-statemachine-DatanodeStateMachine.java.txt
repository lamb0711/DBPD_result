HDFS-12246. Ozone: potential thread leaks. Contributed by Weiwei Yang.

+  private Thread stateMachineThread = null;
+  private Thread cmdProcessThread = null;
+      } catch (InterruptedException e) {
+        // Ignore this exception.
+    if (stateMachineThread != null) {
+      stateMachineThread.interrupt();
+    }
+    if (cmdProcessThread != null) {
+      cmdProcessThread.interrupt();
+    }
-    for (EndpointStateMachine endPoint : connectionManager.getValues()) {
-      endPoint.close();
+    if (connectionManager != null) {
+      connectionManager.close();
-    Thread thread =  new ThreadFactoryBuilder()
+    stateMachineThread =  new ThreadFactoryBuilder()
-    thread.start();
+    stateMachineThread.start();
-    Thread cmdProcessThread = new Thread(processCommandQueue);
+    cmdProcessThread = new Thread(processCommandQueue);
