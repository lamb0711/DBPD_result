Merge trunk into HA branch.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1215367 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.mapreduce.TaskAttemptID;
+import org.apache.hadoop.tools.rumen.datatypes.NodeName;
-  String attemptID;
+  TaskAttemptID attemptID;
-  String hostName;
+  NodeName hostName;
-  @SuppressWarnings("unused")
-                 
+
-                 
+
-                 
+
-                 
+
-  public String getAttemptID() {
+  public TaskAttemptID getAttemptID() {
-    this.attemptID = attemptID;
+    this.attemptID = TaskAttemptID.forName(attemptID);
-  public String getHostName() {
+  public NodeName getHostName() {
+  // This is needed for JSON deserialization
-    this.hostName = hostName;
+    this.hostName = hostName == null ? null : new NodeName(hostName);
-  
-  // hostName is saved in the format rackName/NodeName
+
+  // In job-history, hostName is saved in the format rackName/NodeName
+  //TODO this is a hack! The '/' handling needs fixing.
+  private void compare1(NodeName c1, NodeName c2, TreePath loc, String eltname)
+  throws DeepInequalityException {
+    if (c1 == null && c2 == null) {
+      return;
+    }
+
+    if (c1 == null || c2 == null) {
+      throw new DeepInequalityException(eltname + " miscompared", new TreePath(
+          loc, eltname));
+    }
+
+    compare1(c1.getValue(), c2.getValue(), new TreePath(loc, eltname), "value");
+  }
+
-    compare1(attemptID, other.attemptID, loc, "attemptID");
+    compare1(attemptID.toString(), other.attemptID.toString(), loc, "attemptID");
-}
+}
