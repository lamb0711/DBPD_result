HDFS-8498. Blocks can be committed with wrong size. Contributed by Jing Zhao.

-    coordinator.offerEndBlock(index, block);
+    coordinator.offerEndBlock(index, block.getCurrentBlock());
-    block = lb.getBlock();
+    block.setCurrentBlock(lb.getBlock());
-      block = null;
+      block.setCurrentBlock(null);
-          block = newBlock(block, newGS);
+          updateBlockGS(newGS);
