HDFS-14777. RBF: Set ReadOnly is failing for mount Table but actually readonly succeed to set. Contributed by Ranith Sardar.

+
+import org.apache.hadoop.hdfs.server.federation.resolver.MountTableResolver;
-    UpdateMountTableEntryResponse response =
-        getMountTableStore().updateMountTableEntry(request);
+
+    UpdateMountTableEntryResponse response = getMountTableStore()
+        .updateMountTableEntry(request);
-      if (mountTable != null && router.isQuotaEnabled()) {
+      if (mountTable != null && router.isQuotaEnabled()
+          && isQuotaUpdated(request, mountTable)) {
-          request.getEntry().toString(), e.getMessage());
+          request.getEntry(), e.getMessage());
+  private boolean isQuotaUpdated(UpdateMountTableEntryRequest request,
+      MountTable mountTable) throws IOException {
+    long nsQuota = -1;
+    long ssQuota = -1;
+
+    String path = request.getEntry().getSourcePath();
+    if (this.router.getSubclusterResolver() instanceof MountTableResolver) {
+      MountTableResolver mResolver = (MountTableResolver) this.router
+          .getSubclusterResolver();
+      MountTable entry = mResolver.getMountPoint(path);
+      if (entry != null) {
+        RouterQuotaUsage preQuota = entry.getQuota();
+        nsQuota = preQuota.getQuota();
+        ssQuota = preQuota.getSpaceQuota();
+      }
+    }
+    RouterQuotaUsage mountQuota = mountTable.getQuota();
+    if (nsQuota != mountQuota.getQuota()
+        || ssQuota != mountQuota.getSpaceQuota()) {
+      return true;
+    }
+
+    return false;
+  }
+
