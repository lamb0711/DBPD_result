HDDS-1927. Consolidate add/remove Acl into OzoneAclUtil class. Contributed by Xiaoyu Yao.

Signed-off-by: Anu Engineer <aengineer@apache.org>

-import java.util.BitSet;
+import org.apache.hadoop.ozone.om.helpers.OzoneAclUtil;
-import org.apache.hadoop.ozone.web.utils.OzoneUtils;
-import static org.apache.hadoop.ozone.OzoneAcl.ZERO_BITSET;
-import static org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos.OzoneAclInfo.OzoneAclScope.*;
+    boolean changed = false;
-      // Case 1: When we are adding more rights to existing user/group.
-      boolean addToExistingAcl = false;
-      for(OzoneAcl a: bucketInfo.getAcls()) {
-        if(a.getName().equals(acl.getName()) &&
-            a.getType().equals(acl.getType())) {
-          BitSet bits = (BitSet) acl.getAclBitSet().clone();
-          bits.or(a.getAclBitSet());
-
-          if (bits.equals(a.getAclBitSet())) {
-            return false;
-          }
-          a.getAclBitSet().or(acl.getAclBitSet());
-          addToExistingAcl = true;
-          break;
-        }
+      changed = bucketInfo.addAcl(acl);
+      if (changed) {
+        metadataManager.getBucketTable().put(dbBucketKey, bucketInfo);
-
-      // Case 2: When a completely new acl is added.
-      if(!addToExistingAcl) {
-        List<OzoneAcl> newAcls = bucketInfo.getAcls();
-        if(newAcls == null) {
-          newAcls = new ArrayList<>();
-        }
-        newAcls.add(acl);
-        bucketInfo = OmBucketInfo.newBuilder()
-            .setVolumeName(bucketInfo.getVolumeName())
-            .setBucketName(bucketInfo.getBucketName())
-            .setStorageType(bucketInfo.getStorageType())
-            .setIsVersionEnabled(bucketInfo.getIsVersionEnabled())
-            .setCreationTime(bucketInfo.getCreationTime())
-            .setBucketEncryptionKey(bucketInfo.getEncryptionKeyInfo())
-            .addAllMetadata(bucketInfo.getMetadata())
-            .setAcls(newAcls)
-            .build();
-      }
-
-      metadataManager.getBucketTable().put(dbBucketKey, bucketInfo);
-    return true;
+    return changed;
+    boolean removed = false;
-
-      boolean removed = false;
-      // When we are removing subset of rights from existing acl.
-      for(OzoneAcl a: bucketInfo.getAcls()) {
-        if(a.getName().equals(acl.getName()) &&
-            a.getType().equals(acl.getType())) {
-          BitSet bits = (BitSet) acl.getAclBitSet().clone();
-          bits.and(a.getAclBitSet());
-
-          if (bits.equals(ZERO_BITSET)) {
-            return false;
-          }
-
-          a.getAclBitSet().xor(bits);
-
-          if(a.getAclBitSet().equals(ZERO_BITSET)) {
-            bucketInfo.getAcls().remove(a);
-          }
-          removed = true;
-          break;
-        }
-      }
-
+      removed = bucketInfo.removeAcl(acl);
-      return removed;
+    return removed;
-      OmBucketInfo updatedBucket = OmBucketInfo.newBuilder()
-          .setVolumeName(bucketInfo.getVolumeName())
-          .setBucketName(bucketInfo.getBucketName())
-          .setStorageType(bucketInfo.getStorageType())
-          .setIsVersionEnabled(bucketInfo.getIsVersionEnabled())
-          .setCreationTime(bucketInfo.getCreationTime())
-          .setBucketEncryptionKey(bucketInfo.getEncryptionKeyInfo())
-          .addAllMetadata(bucketInfo.getMetadata())
-          .setAcls(acls)
-          .build();
-
-      metadataManager.getBucketTable().put(dbBucketKey, updatedBucket);
+      bucketInfo.setAcls(acls);
+      metadataManager.getBucketTable().put(dbBucketKey, bucketInfo);
-
-      boolean hasAccess = OzoneUtils.checkAclRights(bucketInfo.getAcls(),
+      boolean hasAccess = OzoneAclUtil.checkAclRights(bucketInfo.getAcls(),
