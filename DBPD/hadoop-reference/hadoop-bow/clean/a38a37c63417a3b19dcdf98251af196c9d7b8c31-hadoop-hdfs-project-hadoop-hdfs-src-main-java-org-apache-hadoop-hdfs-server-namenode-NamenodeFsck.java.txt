HDFS-7912. Erasure Coding: track BlockInfo instead of Block in UnderReplicatedBlocks and PendingReplicationBlocks. Contributed by Jing Zhao.

-  
+
-  
+
-  /** 
+  /**
-  /** 
+  /**
-      NetworkTopology networktopology, 
+      NetworkTopology networktopology,
-    
+
-      NumberReplicas numberReplicas= bm.countNodes(block);
+      NumberReplicas numberReplicas= bm.countNodes(blockInfo);
-        
+
-        // string might break testcases. Also note this must be the last line 
+        // string might break testcases. Also note this must be the last line
-  
+
-    FSNamesystem fsn = namenode.getNamesystem();
+    final FSNamesystem fsn = namenode.getNamesystem();
+      final BlockInfo storedBlock = bm.getStoredBlock(
+          block.getLocalBlock());
-      NumberReplicas numberReplicas = bm.countNodes(block.getLocalBlock());
+      NumberReplicas numberReplicas = bm.countNodes(storedBlock);
-        out.println(" Replica placement policy is violated for " + 
+        out.println(" Replica placement policy is violated for " +
-  
+
-        
+
-        LOG.info("Fsck: copied the remains of the corrupted file " + 
+        LOG.info("Fsck: copied the remains of the corrupted file " +
-      
+
-    BlockReader blockReader = null; 
-    ExtendedBlock block = lblock.getBlock(); 
+    BlockReader blockReader = null;
+    ExtendedBlock block = lblock.getBlock();
-      
+
-        throw new IOException("Recorded block size is " + block.getNumBytes() + 
+        throw new IOException("Recorded block size is " + block.getNumBytes() +
-  
+
-      
+
-    
+
-      this.replication = (short)conf.getInt(DFSConfigKeys.DFS_REPLICATION_KEY, 
+      this.replication = (short)conf.getInt(DFSConfigKeys.DFS_REPLICATION_KEY,
-    
+
-    
+
-    
+
