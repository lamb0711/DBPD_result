Merging trunk to HDFS-1623 branch.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1179484 13f79535-47bb-0310-9956-ffa450edef68

-      long offset = out.size();
+      long offset = out.getPos();
-        int prevCount = out.size();
+        long prevCount = out.getPos();
-        int currCount = out.size();
+        long currCount = out.getPos();
-      long offset = out.size();
+      long offset = out.getPos();
-        int prevLen = out.size();
+        long prevLen = out.getPos();
-        int currLen = out.size();
+        long currLen = out.getPos();
