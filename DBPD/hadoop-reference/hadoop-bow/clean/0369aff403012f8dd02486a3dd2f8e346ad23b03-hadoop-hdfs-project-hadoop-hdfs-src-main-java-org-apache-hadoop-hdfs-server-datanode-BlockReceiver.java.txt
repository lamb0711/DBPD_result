HDFS-5868. Make hsync implementation pluggable. (Contributed by Buddy Taylor)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1569978 13f79535-47bb-0310-9956-ffa450edef68

-  private OutputStream cout = null; // output stream for cehcksum file
-      this.cout = streams.getChecksumOut();
-          cout, HdfsConstants.SMALL_BUFFER_SIZE));
+          streams.getChecksumOut(), HdfsConstants.SMALL_BUFFER_SIZE));
-        if (syncOnClose && (cout instanceof FileOutputStream)) {
+        if (syncOnClose) {
-          ((FileOutputStream)cout).getChannel().force(true);
+          streams.syncChecksumOut();
-        if (syncOnClose && (out instanceof FileOutputStream)) {
+        if (syncOnClose) {
-          ((FileOutputStream)out).getChannel().force(true);
+          streams.syncDataOut();
-      if (isSync && (cout instanceof FileOutputStream)) {
+      if (isSync) {
-        ((FileOutputStream)cout).getChannel().force(true);
+        streams.syncChecksumOut();
-      if (isSync && (out instanceof FileOutputStream)) {
+      if (isSync) {
-        ((FileOutputStream)out).getChannel().force(true);
+        streams.syncDataOut();
