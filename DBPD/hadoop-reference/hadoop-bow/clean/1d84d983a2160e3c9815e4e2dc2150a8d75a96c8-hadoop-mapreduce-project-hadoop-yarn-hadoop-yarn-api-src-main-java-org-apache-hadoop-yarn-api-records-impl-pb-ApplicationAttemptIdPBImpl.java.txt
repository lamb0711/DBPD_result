MAPREDUCE-2954. Fixed a deadlock in NM caused due to wrong synchronization in protocol buffer records. Contributed by Siddharth Seth.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1167061 13f79535-47bb-0310-9956-ffa450edef68

-
-import java.text.NumberFormat;
-
-import org.apache.hadoop.yarn.api.records.ProtoBase;
-public class ApplicationAttemptIdPBImpl extends ProtoBase<ApplicationAttemptIdProto> implements ApplicationAttemptId {
+public class ApplicationAttemptIdPBImpl extends ApplicationAttemptId {
-  protected static final NumberFormat idFormat = NumberFormat.getInstance();
-  static {
-    idFormat.setGroupingUsed(false);
-    idFormat.setMinimumIntegerDigits(4);
-  }
-  
-  protected static final NumberFormat counterFormat = NumberFormat.getInstance();
-  static {
-    counterFormat.setGroupingUsed(false);
-    counterFormat.setMinimumIntegerDigits(6);
-  }
-  
-  
+
-  private synchronized ApplicationIdPBImpl convertFromProtoFormat(ApplicationIdProto p) {
+  private ApplicationIdPBImpl convertFromProtoFormat(ApplicationIdProto p) {
-  private synchronized ApplicationIdProto convertToProtoFormat(ApplicationId t) {
+  private ApplicationIdProto convertToProtoFormat(ApplicationId t) {
-
-  @Override
-  public synchronized int hashCode() {
-    return getProto().hashCode();
-  }
-
-  @Override
-  public synchronized boolean equals(Object other) {
-    if (other == null) return false;
-    if (other.getClass().isAssignableFrom(this.getClass())) {
-      return this.getProto().equals(this.getClass().cast(other).getProto());
-    }
-    return false;
-  }
-
-  @Override
-  public synchronized int compareTo(ApplicationAttemptId other) {
-    int compareAppIds = this.getApplicationId().compareTo(
-        other.getApplicationId());
-    if (compareAppIds == 0) {
-      return this.getAttemptId() - other.getAttemptId();
-    } else {
-      return compareAppIds;
-    }
-    
-  }
-  
-  @Override
-  public synchronized String toString() {
-    String id = (this.getApplicationId() != null) ? this.getApplicationId().getClusterTimestamp() + "_" +
-        idFormat.format(this.getApplicationId().getId()): "none";
-    return "appattempt_" + id + "_" + counterFormat.format(getAttemptId());
-  }
