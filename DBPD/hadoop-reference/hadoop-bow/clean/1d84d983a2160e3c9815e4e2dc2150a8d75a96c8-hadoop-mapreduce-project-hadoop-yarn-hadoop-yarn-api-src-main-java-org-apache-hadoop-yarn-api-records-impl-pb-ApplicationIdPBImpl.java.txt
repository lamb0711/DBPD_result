MAPREDUCE-2954. Fixed a deadlock in NM caused due to wrong synchronization in protocol buffer records. Contributed by Siddharth Seth.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1167061 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.yarn.api.records.ProtoBase;
-public class ApplicationIdPBImpl extends ProtoBase<ApplicationIdProto> implements ApplicationId {
+public class ApplicationIdPBImpl extends ApplicationId {
-  public ApplicationIdProto getProto() {
+  public synchronized ApplicationIdProto getProto() {
-  private void maybeInitBuilder() {
+  private synchronized void maybeInitBuilder() {
-  public int getId() {
+  public synchronized int getId() {
-  public void setId(int id) {
+  public synchronized void setId(int id) {
-  public long getClusterTimestamp() {
+  public synchronized long getClusterTimestamp() {
-  public void setClusterTimestamp(long clusterTimestamp) {
+  public synchronized void setClusterTimestamp(long clusterTimestamp) {
-
-  @Override
-  public int compareTo(ApplicationId other) {
-    if (this.getId() - other.getId() == 0) {
-      return this.getClusterTimestamp() > other.getClusterTimestamp() ? 1 : 
-        this.getClusterTimestamp() < other.getClusterTimestamp() ? -1 : 0;
-    } else {
-      return this.getId() - other.getId();
-    }
-  }
-
-  @Override
-  public String toString() {
-    return "application_" + this.getClusterTimestamp() + "_" + this.getId();
-  }
-}  
+}
