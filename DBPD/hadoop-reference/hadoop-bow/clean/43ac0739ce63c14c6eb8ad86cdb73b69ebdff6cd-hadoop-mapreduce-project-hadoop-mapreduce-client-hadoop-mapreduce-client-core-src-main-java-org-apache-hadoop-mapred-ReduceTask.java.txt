svn merge -c -1476006 . for reverting the previous trunk merge.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1476008 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.io.IOUtils;
-    RecordWriter<OUTKEY, OUTVALUE> out = new OldTrackingRecordWriter<OUTKEY, OUTVALUE>(
+    final RecordWriter<OUTKEY, OUTVALUE> out = new OldTrackingRecordWriter<OUTKEY, OUTVALUE>(
-    final RecordWriter<OUTKEY, OUTVALUE> finalOut = out;
-    
+
-          finalOut.write(key, value);
+          out.write(key, value);
+      //Clean up: repeated in catch block below
-      reducer = null;
-      
-      out = null;
-    } finally {
-      IOUtils.cleanup(LOG, reducer);
-      closeQuietly(out, reporter);
+      //End of clean up.
+    } catch (IOException ioe) {
+      try {
+        reducer.close();
+      } catch (IOException ignored) {}
+        
+      try {
+        out.close(reporter);
+      } catch (IOException ignored) {}
+      
+      throw ioe;
-    try {
-      reducer.run(reducerContext);
-    } finally {
-      trackedRW.close(reducerContext);
-    }
-  }
-  
-  private <OUTKEY, OUTVALUE>
-  void closeQuietly(RecordWriter<OUTKEY, OUTVALUE> c, Reporter r) {
-    if (c != null) {
-      try {
-        c.close(r);
-      } catch (Exception e) {
-        LOG.info("Exception in closing " + c, e);
-      }
-    }
+    reducer.run(reducerContext);
+    trackedRW.close(reducerContext);
