HADOOP-16266. Add more fine-grained processing time metrics to the RPC layer. Contributed by Christopher Gregorian.

-        long startTime = Time.now();
-        int qTime = (int) (startTime - receiveTime);
-        Exception exception = null;
-        boolean isDeferred = false;
+        Call currentCall = Server.getCurCall().get();
+          currentCall.setDetailedMetricsName(methodName);
-            Server.getCurCall().get().deferResponse();
-            isDeferred = true;
+            currentCall.deferResponse();
-          exception = (Exception) e.getCause();
+          Exception exception = (Exception) e.getCause();
+          currentCall.setDetailedMetricsName(
+              exception.getClass().getSimpleName());
-          exception = e;
+          currentCall.setDetailedMetricsName(e.getClass().getSimpleName());
-          int processingTime = (int) (Time.now() - startTime);
-          if (LOG.isDebugEnabled()) {
-            String msg =
-                "Served: " + methodName + (isDeferred ? ", deferred" : "") +
-                    ", queueTime= " + qTime +
-                    " procesingTime= " + processingTime;
-            if (exception != null) {
-              msg += " exception= " + exception.getClass().getSimpleName();
-            }
-            LOG.debug(msg);
-          }
-          String detailedMetricsName = (exception == null) ?
-              methodName :
-              exception.getClass().getSimpleName();
-          server.updateMetrics(detailedMetricsName, qTime, processingTime,
-              isDeferred);
