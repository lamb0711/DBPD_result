HDFS-14508. RBF: Clean-up and refactor UI components. Contributed by Takanobu Asanuma.

+import org.apache.hadoop.hdfs.server.federation.router.RouterServiceState;
-public class FederationMetrics implements FederationMBean {
+public class RBFMetrics implements RouterMBean, FederationMBean {
-      LoggerFactory.getLogger(FederationMetrics.class);
+      LoggerFactory.getLogger(RBFMetrics.class);
-  private ObjectName beanName;
+  private ObjectName routerBeanName;
+  private ObjectName federationBeanName;
-  public FederationMetrics(Router router) throws IOException {
+  public RBFMetrics(Router router) throws IOException {
-      StandardMBean bean = new StandardMBean(this, FederationMBean.class);
-      this.beanName = MBeans.register("Router", "FederationState", bean);
-      LOG.info("Registered Router MBean: {}", this.beanName);
+      StandardMBean bean = new StandardMBean(this, RouterMBean.class);
+      this.routerBeanName = MBeans.register("Router", "Router", bean);
+      LOG.info("Registered Router MBean: {}", this.routerBeanName);
+    try {
+      StandardMBean bean = new StandardMBean(this, FederationMBean.class);
+      this.federationBeanName = MBeans.register("Router", "FederationState",
+          bean);
+      LOG.info("Registered FederationState MBean: {}", this.federationBeanName);
+    } catch (NotCompliantMBeanException e) {
+      throw new RuntimeException("Bad FederationState MBean setup", e);
+    }
+
-    if (this.beanName != null) {
-      MBeans.unregister(beanName);
+    if (this.routerBeanName != null) {
+      MBeans.unregister(routerBeanName);
+    }
+    if (this.federationBeanName != null) {
+      MBeans.unregister(federationBeanName);
+  @Override
+  @Override
+  public String getSafemode() {
+    if (this.router.isRouterState(RouterServiceState.SAFEMODE)) {
+      return "Safe mode is ON. " + this.getSafeModeTip();
+    } else {
+      return "";
+    }
+  }
+
+  private String getSafeModeTip() {
+    String cmd = "Use \"hdfs dfsrouteradmin -safemode leave\" "
+        + "to turn safe mode off.";
+    if (this.router.isRouterState(RouterServiceState.INITIALIZING)
+        || this.router.isRouterState(RouterServiceState.UNINITIALIZED)) {
+      return "Router is in" + this.router.getRouterState()
+          + "mode, the router will immediately return to "
+          + "normal mode after some time. " + cmd;
+    } else if (this.router.isRouterState(RouterServiceState.SAFEMODE)) {
+      return "It was turned on manually. " + cmd;
+    }
+    return "";
+  }
+
