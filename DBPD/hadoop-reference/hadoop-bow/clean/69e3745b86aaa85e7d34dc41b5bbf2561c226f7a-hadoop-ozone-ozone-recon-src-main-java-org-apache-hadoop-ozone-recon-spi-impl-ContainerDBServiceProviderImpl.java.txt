HDDS-1340. Add List Containers API for Recon (#648)



+import java.util.LinkedHashMap;
+import org.apache.hadoop.ozone.recon.api.types.ContainerMetadata;
-      //The prefix seek only guarantees that the iterator's head will be
+      // The prefix seek only guarantees that the iterator's head will be
+  /**
+   * Iterate the DB to construct a Map of containerID -> containerMetadata.
+   *
+   * @return Map of containerID -> containerMetadata.
+   * @throws IOException
+   */
+  @Override
+  public Map<Long, ContainerMetadata> getContainers() throws IOException {
+    Map<Long, ContainerMetadata> containers = new LinkedHashMap<>();
+    TableIterator<ContainerKeyPrefix, ? extends KeyValue<ContainerKeyPrefix,
+        Integer>> containerIterator = containerKeyTable.iterator();
+    while (containerIterator.hasNext()) {
+      KeyValue<ContainerKeyPrefix, Integer> keyValue = containerIterator.next();
+      Long containerID = keyValue.getKey().getContainerId();
+      Integer numberOfKeys = keyValue.getValue();
+
+      // initialize containerMetadata with 0 as number of keys.
+      containers.computeIfAbsent(containerID, ContainerMetadata::new);
+      // increment number of keys for the containerID
+      ContainerMetadata containerMetadata = containers.get(containerID);
+      containerMetadata.setNumberOfKeys(containerMetadata.getNumberOfKeys() +
+          numberOfKeys);
+      containers.put(containerID, containerMetadata);
+    }
+    return containers;
+  }
