HDDS-1600. Add userName and IPAddress as part of OMRequest. (#857)



-import org.apache.hadoop.ozone.om.request.OMClientRequest;
+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos;
+import org.apache.hadoop.ozone.security.acl.IAccessAuthorizer;
+import org.apache.hadoop.ozone.security.acl.OzoneObj;
+import org.apache.hadoop.ozone.om.request.OMClientRequest;
-import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos;
+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos
+    .DeleteBucketResponse;
-import org.apache.hadoop.ozone.om.ratis.utils.OzoneManagerRatisUtils;
-  public OMRequest preExecute(OzoneManager ozoneManager) throws IOException {
-    // For Delete Bucket there are no preExecute steps
-    return getOmRequest();
-  }
-
-  @Override
-    // acquire lock
-    omMetadataManager.getLock().acquireBucketLock(volumeName, bucketName);
-
+      // check Acl
+      if (ozoneManager.getAclsEnabled()) {
+        checkAcls(ozoneManager, OzoneObj.ResourceType.BUCKET,
+            OzoneObj.StoreType.OZONE, IAccessAuthorizer.ACLType.WRITE,
+            volumeName, bucketName, null);
+      }
+    } catch (IOException ex) {
+      omMetrics.incNumBucketDeleteFails();
+      LOG.error("Delete bucket failed for bucket:{} in volume:{}", bucketName,
+          volumeName, ex);
+      return new OMBucketDeleteResponse(volumeName, bucketName,
+          createErrorOMResponse(omResponse, ex));
+    }
+
+    // acquire lock
+    omMetadataManager.getLock().acquireBucketLock(volumeName, bucketName);
+    try {
-      // TODO: check acls.
+
+      // return response.
+      omResponse.setDeleteBucketResponse(
+          DeleteBucketResponse.newBuilder().build());
+      return new OMBucketDeleteResponse(volumeName, bucketName,
+          omResponse.build());
+
-      omResponse.setSuccess(false).setMessage(ex.getMessage())
-          .setStatus(OzoneManagerRatisUtils.exceptionToResponseStatus(ex));
+      return new OMBucketDeleteResponse(volumeName, bucketName,
+          createErrorOMResponse(omResponse, ex));
-    return new OMBucketDeleteResponse(volumeName, bucketName,
-        omResponse.build());
