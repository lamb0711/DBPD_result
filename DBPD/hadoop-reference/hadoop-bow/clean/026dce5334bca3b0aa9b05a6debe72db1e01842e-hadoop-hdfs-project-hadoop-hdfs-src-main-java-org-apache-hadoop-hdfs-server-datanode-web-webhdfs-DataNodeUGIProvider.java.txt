HDFS-15465. Support WebHDFS accesses to the data stored in secure Datanode through insecure Namenode. (#2135)


-      if (UserGroupInformation.isSecurityEnabled()) {
-        final Token<DelegationTokenIdentifier> token = params.delegationToken();
+      final Token<DelegationTokenIdentifier> token = params.delegationToken();
+      // Create nonTokenUGI when token is null regardless of security.
+      // This makes it possible to access the data stored in secure DataNode
+      // through insecure Namenode.
+      if (UserGroupInformation.isSecurityEnabled() && token != null) {
-  private UserGroupInformation nonTokenUGI(String usernameFromQuery,
+  @VisibleForTesting
+  UserGroupInformation nonTokenUGI(String usernameFromQuery,
