HADOOP-10870. Failed to load OpenSSL cipher error logs on systems with old openssl versions (cmccabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/fs-encryption@1612440 13f79535-47bb-0310-9956-ffa450edef68

-  private static boolean nativeCipherLoaded = false;
+  private static final String loadingFailureReason;
+
-    if (NativeCodeLoader.isNativeCodeLoaded() &&
-        NativeCodeLoader.buildSupportsOpenssl()) {
-      try {
+    String loadingFailure = null;
+    try {
+      if (!NativeCodeLoader.buildSupportsOpenssl()) {
+        loadingFailure = "build does not support openssl.";
+      } else {
-        nativeCipherLoaded = true;
-      } catch (Throwable t) {
-        LOG.error("Failed to load OpenSSL Cipher.", t);
+    } catch (Throwable t) {
+      loadingFailure = t.getMessage();
+      LOG.debug("Failed to load OpenSSL Cipher.", t);
+    } finally {
+      loadingFailureReason = loadingFailure;
-  public static boolean isNativeCodeLoaded() {
-    return nativeCipherLoaded;
+  public static String getLoadingFailureReason() {
+    return loadingFailureReason;
