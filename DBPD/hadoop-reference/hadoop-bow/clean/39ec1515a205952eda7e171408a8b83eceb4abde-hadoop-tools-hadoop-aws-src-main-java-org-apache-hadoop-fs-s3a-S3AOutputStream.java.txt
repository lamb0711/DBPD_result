HADOOP-13130. s3a failures can surface as RTEs, not IOEs. (Steve Loughran)

+import com.amazonaws.AmazonClientException;
+import java.io.InterruptedIOException;
+import static org.apache.hadoop.fs.s3a.S3AUtils.*;
-    backupFile = lDirAlloc.createTmpFileForWrite("output-", LocalDirAllocator.SIZE_UNKNOWN, conf);
+    backupFile = lDirAlloc.createTmpFileForWrite("output-",
+        LocalDirAllocator.SIZE_UNKNOWN, conf);
-    this.backupStream = new BufferedOutputStream(new FileOutputStream(backupFile));
+    this.backupStream = new BufferedOutputStream(
+        new FileOutputStream(backupFile));
-      PutObjectRequest putObjectRequest = new PutObjectRequest(bucket, key, backupFile);
+      PutObjectRequest putObjectRequest =
+          new PutObjectRequest(bucket, key, backupFile);
-      long delta = upload.getProgress().getBytesTransferred() - listener.getLastBytesTransferred();
+      long delta = upload.getProgress().getBytesTransferred() -
+          listener.getLastBytesTransferred();
-        if (LOG.isDebugEnabled()) {
-          LOG.debug("S3A write delta changed after finished: " + delta + " bytes");
-        }
+        LOG.debug("S3A write delta changed after finished: {} bytes", delta);
-      throw new IOException(e);
+      throw (InterruptedIOException) new InterruptedIOException(e.toString())
+          .initCause(e);
+    } catch (AmazonClientException e) {
+      throw translateException("saving output", key , e);
-    if (LOG.isDebugEnabled()) {
-      LOG.debug("OutputStream for key '" + key + "' upload complete");
-    }
+    LOG.debug("OutputStream for key '{}' upload complete", key);
