HDFS-4079. Add SnapshotManager which maintains a list for all the snapshottable directories and supports snapshot methods such as setting a directory to snapshottable and creating a snapshot.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1400728 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.IOException;
+import java.util.ArrayList;
+import java.util.List;
+
+import org.apache.hadoop.hdfs.server.namenode.INode;
+import org.apache.hadoop.util.Time;
+  /** Cast INode to INodeDirectorySnapshottable. */
+  static public INodeDirectorySnapshottable valueOf(
+      INode inode, String src) throws IOException {
+    final INodeDirectory dir = INodeDirectory.valueOf(inode, src);
+    if (!dir.isSnapshottable()) {
+      throw new SnapshotException(src + " is not a snapshottable directory.");
+    }
+    return (INodeDirectorySnapshottable)dir;
+  }
+
+  /** A list of snapshots of this directory. */
+  private final List<INodeDirectorySnapshotRoot> snapshots
+      = new ArrayList<INodeDirectorySnapshotRoot>();
+
+
+  /** Add a snapshot root under this directory. */
+  INodeDirectorySnapshotRoot addSnapshotRoot(final String name) {
+    final INodeDirectorySnapshotRoot r = new INodeDirectorySnapshotRoot(name, this);
+    snapshots.add(r);
+
+    //set modification time
+    final long timestamp = Time.now();
+    r.setModificationTime(timestamp);
+    setModificationTime(timestamp);
+    return r;
+  }
