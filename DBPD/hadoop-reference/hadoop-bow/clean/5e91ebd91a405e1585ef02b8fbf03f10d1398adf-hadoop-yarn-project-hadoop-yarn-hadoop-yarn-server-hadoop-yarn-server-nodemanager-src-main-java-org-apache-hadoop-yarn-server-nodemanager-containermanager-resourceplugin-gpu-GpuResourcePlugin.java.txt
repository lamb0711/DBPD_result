YARN-9121. Replace GpuDiscoverer.getInstance() to a readable object for easy access control. Contributed by Szilard Nemeth.

-import org.apache.hadoop.yarn.api.records.ContainerId;
-import java.util.Map;
+  private final GpuNodeResourceUpdateHandler resourceDiscoverHandler;
+  private final GpuDiscoverer gpuDiscoverer;
-  private GpuNodeResourceUpdateHandler resourceDiscoverHandler = null;
+  public GpuResourcePlugin(GpuNodeResourceUpdateHandler resourceDiscoverHandler,
+      GpuDiscoverer gpuDiscoverer) {
+    this.resourceDiscoverHandler = resourceDiscoverHandler;
+    this.gpuDiscoverer = gpuDiscoverer;
+  }
+
-    resourceDiscoverHandler = new GpuNodeResourceUpdateHandler();
-    GpuDiscoverer.getInstance().initialize(context.getConf());
-    dockerCommandPlugin =
+    this.gpuDiscoverer.initialize(context.getConf());
+    this.dockerCommandPlugin =
-          privilegedOperationExecutor);
+          privilegedOperationExecutor, gpuDiscoverer);
-  public NMResourceInfo getNMResourceInfo() throws YarnException {
+  public synchronized NMResourceInfo getNMResourceInfo() throws YarnException {
-        GpuDiscoverer.getInstance().getGpuDeviceInformation();
+        gpuDiscoverer.getGpuDeviceInformation();
