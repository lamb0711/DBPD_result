HDFS-6995. Block should be placed in the client's 'rack-local' node if 'client-local' node is not available (vinayakumarb)

+import org.apache.hadoop.net.NodeBase;
-    DatanodeDescriptor clientNode = null;
+    Node clientNode = null;
+    String clientMachine = null;
+      clientMachine = pendingFile.getFileUnderConstructionFeature()
+          .getClientMachine();
-              pendingFile.getFileUnderConstructionFeature().getClientMachine());
+          clientMachine);
+    if (clientNode == null) {
+      clientNode = getClientNode(clientMachine);
+    }
+
+  /*
+   * Resolve clientmachine address to get a network location path
+   */
+  private Node getClientNode(String clientMachine) {
+    List<String> hosts = new ArrayList<String>(1);
+    hosts.add(clientMachine);
+    List<String> rName = getBlockManager().getDatanodeManager()
+        .resolveNetworkLocation(hosts);
+    Node clientNode = null;
+    if (rName != null) {
+      // Able to resolve clientMachine mapping.
+      // Create a temp node to findout the rack local nodes
+      clientNode = new NodeBase(rName.get(0) + NodeBase.PATH_SEPARATOR_STR
+          + clientMachine);
+    }
+    return clientNode;
+  }
+
-    final DatanodeDescriptor clientnode;
+    Node clientnode = null;
+    String clientMachine;
-      String clientMachine = file.getFileUnderConstructionFeature()
-              .getClientMachine();
+      clientMachine = file.getFileUnderConstructionFeature().getClientMachine();
+    if (clientnode == null) {
+      clientnode = getClientNode(clientMachine);
+    }
+
