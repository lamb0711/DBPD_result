YARN-1866. Fixed an issue with renewal of RM-delegation tokens on restart or fail-over. Contributed by Jian He.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1581448 13f79535-47bb-0310-9956-ffa450edef68

+
+    setLocalSecretManagerAndServiceAddr();
+  // enable RM to short-circuit token operations directly to itself
+  private void setLocalSecretManagerAndServiceAddr() {
+    RMDelegationTokenIdentifier.Renewer.setSecretManager(rmContext
+      .getRMDelegationTokenSecretManager(), rmContext.getClientRMService()
+      .getBindAddress());
+  }
+
-    // enable RM to short-circuit token operations directly to itself
-    RMDelegationTokenIdentifier.Renewer.setSecretManager(
-        rmContext.getRMDelegationTokenSecretManager(),
-        rmContext.getClientRMService().getBindAddress());
+
+    setLocalSecretManagerAndServiceAddr();
