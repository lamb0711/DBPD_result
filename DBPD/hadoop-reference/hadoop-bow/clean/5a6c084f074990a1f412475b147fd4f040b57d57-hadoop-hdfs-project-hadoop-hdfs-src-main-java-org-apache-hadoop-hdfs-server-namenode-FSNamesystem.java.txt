HDFS-7638: Small fix and few refinements for FSN#truncate. (yliu)

+    BlocksMapUpdateInfo toRemoveBlocks = new BlocksMapUpdateInfo();
-                             clientMachine, mtime, pc);
-      stat = FSDirStatAndListingOp.getFileInfo(dir, src, false,
-          FSDirectory.isReservedRawName(src), true);
+          clientMachine, mtime, pc, toRemoveBlocks);
+      stat = dir.getAuditFileInfo(dir.getINodesInPath4Write(src, false));
+    if (!toRemoveBlocks.getToDeleteList().isEmpty()) {
+      removeBlocks(toRemoveBlocks);
+      toRemoveBlocks.clear();
+    }
-                           long mtime, FSPermissionChecker pc)
+                           long mtime, FSPermissionChecker pc,
+                           BlocksMapUpdateInfo toRemoveBlocks)
-    INodeFile file = iip.getLastINode().asFile();
+    INodeFile file = INodeFile.valueOf(iip.getLastINode(), src);
-    file = INodeFile.valueOf(iip.getLastINode(), src);
-    BlocksMapUpdateInfo collectedBlocks = new BlocksMapUpdateInfo();
-                                           collectedBlocks, mtime);
+        toRemoveBlocks, mtime);
-    removeBlocks(collectedBlocks);
