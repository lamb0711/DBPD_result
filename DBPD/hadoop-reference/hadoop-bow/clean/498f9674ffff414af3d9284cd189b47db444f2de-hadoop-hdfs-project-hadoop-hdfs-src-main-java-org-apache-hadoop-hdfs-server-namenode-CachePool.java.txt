Merge r1550130 through r1555020 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1555021 13f79535-47bb-0310-9956-ffa450edef68

-  public static final int DEFAULT_WEIGHT = 100;
-  
-  private int weight;
+  /**
+   * Maximum number of bytes that can be cached in this pool.
+   */
+  private long limit;
+
+  /**
+   * Maximum duration that a CacheDirective in this pool remains valid,
+   * in milliseconds.
+   */
+  private long maxRelativeExpiryMs;
-    Integer weight = (info.getWeight() == null) ?
-        DEFAULT_WEIGHT : info.getWeight();
+    long limit = info.getLimit() == null ?
+        CachePoolInfo.DEFAULT_LIMIT : info.getLimit();
+    long maxRelativeExpiry = info.getMaxRelativeExpiryMs() == null ?
+        CachePoolInfo.DEFAULT_MAX_RELATIVE_EXPIRY :
+        info.getMaxRelativeExpiryMs();
-        ownerName, groupName, mode, weight);
+        ownerName, groupName, mode, limit, maxRelativeExpiry);
-        info.getMode(), info.getWeight());
+        info.getMode(), info.getLimit(), info.getMaxRelativeExpiryMs());
-      FsPermission mode, int weight) {
+      FsPermission mode, long limit, long maxRelativeExpiry) {
-    this.weight = weight;
+    this.limit = limit;
+    this.maxRelativeExpiryMs = maxRelativeExpiry;
-  
-  public int getWeight() {
-    return weight;
+
+  public long getLimit() {
+    return limit;
-  public CachePool setWeight(int weight) {
-    this.weight = weight;
+  public CachePool setLimit(long bytes) {
+    this.limit = bytes;
-  
+
+  public long getMaxRelativeExpiryMs() {
+    return maxRelativeExpiryMs;
+  }
+
+  public CachePool setMaxRelativeExpiryMs(long expiry) {
+    this.maxRelativeExpiryMs = expiry;
+    return this;
+  }
+
-        setWeight(weight);
+        setLimit(limit).
+        setMaxRelativeExpiryMs(maxRelativeExpiryMs);
+  public long getBytesOverlimit() {
+    return Math.max(bytesNeeded-limit, 0);
+  }
+
+        setBytesOverlimit(getBytesOverlimit()).
-        append(", weight:").append(weight).
+        append(", limit:").append(limit).
+        append(", maxRelativeExpiryMs:").append(maxRelativeExpiryMs).
