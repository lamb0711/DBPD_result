Merge r1432789 through r1437840 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1437843 13f79535-47bb-0310-9956-ffa450edef68

-      return Resources.none();
+      return FairScheduler.CONTAINER_RESERVED;
+        if (app.getTotalRequiredResources(priority) <= 0) {
+          continue;
+        }
+        
+
+        ResourceRequest rackLocalRequest = app.getResourceRequest(priority,
+            node.getRackName());
+        ResourceRequest localRequest = app.getResourceRequest(priority,
+            node.getHostName());
+        
-
-        ResourceRequest localRequest = app.getResourceRequest(priority,
-            node.getHostName());
-        if (localRequest != null && localRequest.getNumContainers() != 0) {
+        
+        if (rackLocalRequest != null && rackLocalRequest.getNumContainers() != 0
+            && localRequest != null && localRequest.getNumContainers() != 0) {
-        ResourceRequest rackLocalRequest = app.getResourceRequest(priority,
-            node.getRackName());
