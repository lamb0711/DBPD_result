HDFS-13300. Ozone: Remove DatanodeID dependency from HDSL and Ozone.
Contributed by Nanda kumar.

-import org.apache.hadoop.hdfs.protocol.DatanodeID;
+import org.apache.hadoop.conf.Configuration;
+import org.apache.hadoop.hdsl.protocol.DatanodeDetails;
+import org.apache.hadoop.ozone.HdslDatanodeService;
+import org.apache.hadoop.util.ServicePlugin;
+  private final boolean isOzoneEnabled;
+
+  private Configuration conf;
-
-  private volatile int restServicePort = -1;
-
-    OzoneConfiguration.activate();
+      OzoneConfiguration.activate();
+      this.conf = new OzoneConfiguration();
+      this.isOzoneEnabled = OzoneUtils.isOzoneEnabled(conf);
-    if (OzoneUtils.isOzoneEnabled(dataNode.getConf())) {
+    if (isOzoneEnabled) {
+        getDatanodeDetails(dataNode).setOzoneRestPort(
+            objectStoreRestHttpServer.getHttpAddress().getPort());
-      synchronized (this) {
-        try {
-          restServicePort =
-              objectStoreRestHttpServer.getHttpAddress().getPort();
-        } finally {
-          //in case fo waiting for the port information: we can continue.
-          this.notify();
-        }
+    }
+  }
+
+  public static DatanodeDetails getDatanodeDetails(DataNode dataNode) {
+    for (ServicePlugin plugin : dataNode.getPlugins()) {
+      if (plugin instanceof HdslDatanodeService) {
+        return ((HdslDatanodeService) plugin).getDatanodeDetails();
+    throw new RuntimeException("Not able to find HdslDatanodeService in the" +
+        " list of plugins loaded by DataNode.");
-  @Override
-  public void onDatanodeIdCreation(DatanodeID dataNodeId) {
-    synchronized (this) {
-      if (restServicePort == -1) {
-        try {
-          this.wait();
-        } catch (InterruptedException e) {
-          LOG.error("Wait for starting up http server is interrupted.");
-        }
-      }
-    }
-    dataNodeId.setOzoneRestPort(restServicePort);
-  }
