Merge branch 'HDFS-12943' into trunk

+  // TODO: consider implementing a ObserverState instead of using the flag.
+  private final boolean isObserver;
+
-    super(HAServiceState.STANDBY);
+    this(false);
+  }
+
+  public StandbyState(boolean isObserver) {
+    super(isObserver ? HAServiceState.OBSERVER : HAServiceState.STANDBY);
+    this.isObserver = isObserver;
-    if (s == NameNode.ACTIVE_STATE) {
+    if (s == NameNode.ACTIVE_STATE ||
+        (!isObserver && s == NameNode.OBSERVER_STATE) ||
+        (isObserver && s == NameNode.STANDBY_STATE)) {
+
+  @Override
+  public String toString() {
+    return isObserver ? "observer" : "standby";
+  }
