MAPREDUCE-6761. Regression when handling providers - invalid configuration ServiceConfiguration causes Cluster initialization failure. Contributed by Peter Vary

+import java.util.ServiceConfigurationError;
+import com.google.common.annotations.VisibleForTesting;
-  
+
-  private static ServiceLoader<ClientProtocolProvider> frameworkLoader =
+  @VisibleForTesting
+  static Iterable<ClientProtocolProvider> frameworkLoader =
-          for (ClientProtocolProvider provider : frameworkLoader) {
-            localProviderList.add(provider);
+          try {
+            for (ClientProtocolProvider provider : frameworkLoader) {
+              localProviderList.add(provider);
+            }
+          } catch(ServiceConfigurationError e) {
+            LOG.info("Failed to instantiate ClientProtocolProvider, please "
+                         + "check the /META-INF/services/org.apache."
+                         + "hadoop.mapreduce.protocol.ClientProtocolProvider "
+                         + "files on the classpath", e);
