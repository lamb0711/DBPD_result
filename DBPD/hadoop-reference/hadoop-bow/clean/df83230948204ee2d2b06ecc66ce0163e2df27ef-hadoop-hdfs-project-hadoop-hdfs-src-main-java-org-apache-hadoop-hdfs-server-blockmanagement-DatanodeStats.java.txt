HDFS-9034. StorageTypeStats Metric should not count failed storage. Contributed by Surendra Singh Lilhore.

+import org.apache.hadoop.hdfs.server.protocol.DatanodeStorage;
-      statsMap.addStorage(storageInfo, node);
-      storageTypes.add(storageInfo.getStorageType());
+      if (storageInfo.getState() != DatanodeStorage.State.FAILED) {
+        statsMap.addStorage(storageInfo, node);
+        storageTypes.add(storageInfo.getStorageType());
+      }
-      statsMap.subtractStorage(storageInfo, node);
-      storageTypes.add(storageInfo.getStorageType());
+      if (storageInfo.getState() != DatanodeStorage.State.FAILED) {
+        statsMap.subtractStorage(storageInfo, node);
+        storageTypes.add(storageInfo.getStorageType());
+      }
-      StorageTypeStats storageTypeStats =
-          storageTypeStatsMap.get(storageType);
+      StorageTypeStats storageTypeStats = storageTypeStatsMap.get(storageType);
+        if (storageTypeStats.getNodesInService() == 0) {
+          storageTypeStatsMap.remove(storageType);
+        }
