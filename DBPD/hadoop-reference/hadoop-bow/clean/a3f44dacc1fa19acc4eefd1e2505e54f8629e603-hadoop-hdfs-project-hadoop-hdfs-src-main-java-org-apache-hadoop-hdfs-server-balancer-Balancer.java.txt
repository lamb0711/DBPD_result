HDFS-13183. Standby NameNode process getBlocks request to reduce Active load. Contributed by Xiaoqiao He.

Signed-off-by: Wei-Chiu Chuang <weichiu@apache.org>

+import org.apache.hadoop.hdfs.DFSUtilClient;
-      final BalancerParameters p, Configuration conf)
+      Collection<String> nsIds, final BalancerParameters p, Configuration conf)
-    try {
-      connectors = NameNodeConnector.newNameNodeConnectors(namenodes, 
-              Balancer.class.getSimpleName(), BALANCER_ID_PATH, conf,
-              p.getMaxIdleIteration());
-
-      boolean done = false;
-      for(int iteration = 0; !done; iteration++) {
+    boolean done = false;
+    for(int iteration = 0; !done; iteration++) {
+      try {
+        connectors = NameNodeConnector.newNameNodeConnectors(namenodes, nsIds,
+            Balancer.class.getSimpleName(), BALANCER_ID_PATH, conf,
+            p.getMaxIdleIteration());
-      }
-    } finally {
-      for(NameNodeConnector nnc : connectors) {
-        IOUtils.cleanupWithLogger(LOG, nnc);
+      } finally {
+        for(NameNodeConnector nnc : connectors) {
+          IOUtils.cleanupWithLogger(LOG, nnc);
+        }
-      Configuration conf) throws IOException, InterruptedException {
+                 Configuration conf) throws IOException, InterruptedException {
+    return run(namenodes, null, p, conf);
+  }
+
+  static int run(Collection<URI> namenodes, Collection<String> nsIds,
+      final BalancerParameters p, Configuration conf)
+      throws IOException, InterruptedException {
-      return doBalance(namenodes, p, conf);
+      return doBalance(namenodes, nsIds, p, conf);
-        int retCode = doBalance(namenodes, p, conf);
+        int retCode = doBalance(namenodes, nsIds, p, conf);
-        return Balancer.run(namenodes, parse(args), conf);
+        final Collection<String> nsIds = DFSUtilClient.getNameServiceIds(conf);
+        return Balancer.run(namenodes, nsIds, parse(args), conf);
