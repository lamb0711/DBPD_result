HDFS-6622. Rename and AddBlock may race and produce invalid edits (kihwal via cmccabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1609384 13f79535-47bb-0310-9956-ffa450edef68

-      final INodeFile pendingFile = analyzeFileState(
+      FileState fileState = analyzeFileState(
-      src = pendingFile.getFullPathName();
+      final INodeFile pendingFile = fileState.inode;
+      src = fileState.path;
-      final INodeFile pendingFile =
+      FileState fileState = 
+      final INodeFile pendingFile = fileState.inode;
+      src = fileState.path;
-  INodeFile analyzeFileState(String src,
+  static class FileState {
+    public final INodeFile inode;
+    public final String path;
+
+    public FileState(INodeFile inode, String fullPath) {
+      this.inode = inode;
+      this.path = fullPath;
+    }
+  }
+
+  FileState analyzeFileState(String src,
-        return pendingFile;
+        return new FileState(pendingFile, src);
-    return pendingFile;
+    return new FileState(pendingFile, src);
