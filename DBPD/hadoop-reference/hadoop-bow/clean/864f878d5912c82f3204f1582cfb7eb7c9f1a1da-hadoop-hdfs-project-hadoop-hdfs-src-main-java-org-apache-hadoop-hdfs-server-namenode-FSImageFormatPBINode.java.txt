HDFS-10763. Open files can leak permanently due to inconsistent lease update. Contributed by Kihwal Lee.

+      // Leases are added when the inode section is loaded. This section is
+      // still read in for compatibility reasons.
-        // update the lease manager
-        INodeFile file = dir.getInode(entry.getInodeId()).asFile();
-        FileUnderConstructionFeature uc = file.getFileUnderConstructionFeature();
-        Preconditions.checkState(uc != null); // file must be under-construction
-        fsn.leaseManager.addLease(uc.getClientName(),
-                entry.getInodeId());
+        // update the lease manager
+        fsn.leaseManager.addLease(uc.getClientName(), file.getId());
