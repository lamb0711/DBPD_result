Fixing MR intermediate spills. Contributed by Arun Suresh.

-import java.io.FileNotFoundException;
-import java.net.UnknownHostException;
-import org.apache.hadoop.fs.FileUtil;
-import org.apache.hadoop.mapreduce.filecache.ClientDistributedCacheManager;
-         
-          int keyLen = CryptoUtils.isShuffleEncrypted(conf) 
-              ? conf.getInt(MRJobConfig.MR_ENCRYPTED_INTERMEDIATE_DATA_KEY_SIZE_BITS, 
-                  MRJobConfig.DEFAULT_MR_ENCRYPTED_INTERMEDIATE_DATA_KEY_SIZE_BITS)
-              : SHUFFLE_KEY_LENGTH;
-          keyGen.init(keyLen);
+          keyGen.init(SHUFFLE_KEY_LENGTH);
+      if (CryptoUtils.isEncryptedSpillEnabled(conf)) {
+        conf.setInt(MRJobConfig.MR_AM_MAX_ATTEMPTS, 1);
+        LOG.warn("Max job attempts set to 1 since encrypted intermediate" +
+                "data spill is enabled");
+      }
