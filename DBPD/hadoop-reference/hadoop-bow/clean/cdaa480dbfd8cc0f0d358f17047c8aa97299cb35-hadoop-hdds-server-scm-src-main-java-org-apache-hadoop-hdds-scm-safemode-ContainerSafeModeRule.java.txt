HDDS-2198. SCM should not consider containers in CLOSING state to come out of safemode. (#1540)


+import java.util.Optional;
-    if(containers != null) {
-      containers.forEach(c -> {
-        // TODO: There can be containers in OPEN state which were never
-        // created by the client. We are not considering these containers for
-        // now. These containers can be handled by tracking pipelines.
-        if (c != null && c.getState() != null &&
-            !c.getState().equals(HddsProtos.LifeCycleState.OPEN)) {
-          containerMap.put(c.getContainerID(), c);
-        }
-      });
-      maxContainer = containerMap.size();
-    }
+    containers.forEach(container -> {
+      // There can be containers in OPEN/CLOSING state which were never
+      // created by the client. We are not considering these containers for
+      // now. These containers can be handled by tracking pipelines.
+      Optional.ofNullable(container.getState())
+          .filter(state -> state != HddsProtos.LifeCycleState.OPEN)
+          .filter(state -> state != HddsProtos.LifeCycleState.CLOSING)
+          .ifPresent(s -> containerMap.put(container.getContainerID(),
+              container));
+    });
+    maxContainer = containerMap.size();
