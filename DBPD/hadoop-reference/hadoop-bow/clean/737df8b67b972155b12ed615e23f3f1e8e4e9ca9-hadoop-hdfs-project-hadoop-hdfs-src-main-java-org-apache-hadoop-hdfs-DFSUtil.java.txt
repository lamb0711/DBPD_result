HDFS-2716. Configuration needs to allow different dfs.http.addresses for each HA NN. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1226020 13f79535-47bb-0310-9956-ffa450edef68

-  static Collection<String> getNameNodeIds(Configuration conf, String nsId) {
+  public static Collection<String> getNameNodeIds(Configuration conf, String nsId) {
+      
+    String suffixes[];
-      String nameServiceId = DFSUtil.getNameServiceIdFromAddress(
-          conf, namenodeAddr,
+      suffixes = getSuffixIDs(conf, namenodeAddr,
+    } else {
+      suffixes = new String[2];
+    }
-      if (nameServiceId != null) {
-        httpAddress = conf.get(DFSUtil.addKeySuffixes(
-            httpAddressKey, nameServiceId));
-      }
+    return getSuffixedConf(conf, httpAddressKey, httpAddressDefault, suffixes);
+  }
+  
+  private static String getSuffixedConf(Configuration conf,
+      String key, String defaultVal, String[] suffixes) {
+    String ret = conf.get(DFSUtil.addKeySuffixes(key, suffixes));
+    if (ret != null) {
+      return ret;
-    // else - Use non-federation style configuration
-    if (httpAddress == null) {
-      httpAddress = conf.get(httpAddressKey, httpAddressDefault);
-    }
-    return httpAddress;
+    return conf.get(key, defaultVal);
