MAPREDUCE-4162. Correctly set token service (Daryn Sharp via bobby)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1335567 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.io.Text;
+import org.apache.hadoop.security.SecurityUtil;
-    String serviceAddr = null;
+    InetSocketAddress serviceAddr = null;
-          serviceAddr = application.getHost() + ":" + application.getRpcPort();
+          serviceAddr = NetUtils.createSocketAddrForHost(
+              application.getHost(), application.getRpcPort());
-            InetSocketAddress addr = NetUtils.createSocketAddr(application
-                .getHost(), application.getRpcPort());
-            clientToken.setService(new Text(addr.getAddress().getHostAddress()
-                + ":" + addr.getPort()));
+            SecurityUtil.setTokenService(clientToken, serviceAddr);
-          final String tempStr = serviceAddr;
+          final InetSocketAddress finalServiceAddr = serviceAddr;
-              return instantiateAMProxy(tempStr);
+              return instantiateAMProxy(finalServiceAddr);
-  MRClientProtocol instantiateAMProxy(final String serviceAddr)
+  MRClientProtocol instantiateAMProxy(final InetSocketAddress serviceAddr)
-            NetUtils.createSocketAddr(serviceAddr), conf);
+            serviceAddr, conf);
