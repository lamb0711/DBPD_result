Merge trunk into HDFS-3042 branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3042@1306587 13f79535-47bb-0310-9956-ffa450edef68

-  /** the replica to read from */
-  private final Replica replica;
-  /** The visible length of a replica. */
-  private final long replicaVisibleLength;
+      final Replica replica;
+      final long replicaVisibleLength;
-        this.replica = getReplica(block, datanode);
-        this.replicaVisibleLength = replica.getVisibleLength();
+        replica = getReplica(block, datanode);
+        replicaVisibleLength = replica.getVisibleLength();
-        long minEndOffset = startOffset + length;
-        waitForMinLength((ReplicaBeingWritten)replica, minEndOffset);
-        ReplicaInPipeline rip = (ReplicaInPipeline) replica;
-        chunkChecksum = rip.getLastChecksumAndDataLen();
+        final ReplicaBeingWritten rbw = (ReplicaBeingWritten)replica;
+        waitForMinLength(rbw, startOffset + length);
+        chunkChecksum = rbw.getLastChecksumAndDataLen();
