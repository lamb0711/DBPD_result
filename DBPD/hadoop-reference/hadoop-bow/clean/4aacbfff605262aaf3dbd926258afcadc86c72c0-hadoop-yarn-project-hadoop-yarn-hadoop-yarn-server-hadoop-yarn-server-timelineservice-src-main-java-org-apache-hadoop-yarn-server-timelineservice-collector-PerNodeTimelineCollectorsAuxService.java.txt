YARN-8679. [ATSv2] If HBase cluster is down for long time, high chances that NM ContainerManager dispatcher get blocked. Contributed by Wangda Tan.

-  public boolean addApplication(ApplicationId appId, String user) {
+  public boolean addApplicationIfAbsent(ApplicationId appId, String user) {
-      synchronized (appIdToContainerId) {
+      synchronized (appIdToContainerId){
-        addApplication(appId, context.getUser());
+      addApplicationIfAbsent(appId, context.getUser());
+        boolean shouldRemoveApplication = false;
-            removeApplication(appId);
+            shouldRemoveApplication = true;
+
+        if (shouldRemoveApplication) {
+          removeApplication(appId);
+        }
