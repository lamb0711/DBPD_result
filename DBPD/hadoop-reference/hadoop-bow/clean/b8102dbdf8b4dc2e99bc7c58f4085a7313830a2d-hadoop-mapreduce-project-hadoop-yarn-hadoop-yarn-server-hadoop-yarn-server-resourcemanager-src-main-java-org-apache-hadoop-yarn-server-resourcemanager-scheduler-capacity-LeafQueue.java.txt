MAPREDUCE-2794. [MR-279] Incorrect metrics value for AvailableGB per queue per user. (John George via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1179936 13f79535-47bb-0310-9956-ffa450edef68

-                application.getUser(), assignedResource);
+                application, assignedResource);
-    metrics.setAvailableResourcesToUser(application.getUser(), resourceLimit);
+    metrics.setAvailableResourcesToUser(application.getUser(), application.getHeadroom());
-            application.getUser(), container.getResource());
+            application, container.getResource());
-      String userName, Resource resource) {
+      SchedulerApp application, Resource resource) {
+    String userName = application.getUser();
-    
+    metrics.setAvailableResourcesToUser(userName, application.getHeadroom());
-      String userName, Resource resource) {
+      SchedulerApp application, Resource resource) {
+    String userName = application.getUser();
-    
+    metrics.setAvailableResourcesToUser(userName, application.getHeadroom());
+      
-      Resources.createResource((int)queueLimit);
+      Resources.createResource(roundUp((int)queueLimit));
-        Resources.subtractFrom(resourceLimit, usedResources));
+      Resources.subtractFrom(resourceLimit, usedResources));
-      allocateResource(clusterResource, application.getUser(), container.getResource());
+      allocateResource(clusterResource, application, container.getResource());
