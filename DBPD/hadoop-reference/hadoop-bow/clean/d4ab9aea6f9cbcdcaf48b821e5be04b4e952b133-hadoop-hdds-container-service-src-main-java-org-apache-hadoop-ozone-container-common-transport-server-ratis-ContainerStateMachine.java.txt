HDDS-1816: ContainerStateMachine should limit number of pending apply transactions. Adds a config, uses snapshot threshold default value. (#1150)


+import org.apache.hadoop.hdds.scm.ScmConfigKeys;
+import java.util.concurrent.Semaphore;
+
+  private final Semaphore applyTransactionSemaphore;
+    int maxPendingApplyTransactions = conf.getInt(
+        ScmConfigKeys.
+            DFS_CONTAINER_RATIS_STATEMACHINE_MAX_PENDING_APPLY_TRANSACTIONS,
+        ScmConfigKeys.
+            DFS_CONTAINER_RATIS_STATEMACHINE_MAX_PENDING_APPLY_TRANSACTIONS_DEFAULT);
+    applyTransactionSemaphore = new Semaphore(maxPendingApplyTransactions);
+      applyTransactionSemaphore.acquire();
-      });
+      }).whenComplete((r, t) -> applyTransactionSemaphore.release());
-    } catch (IOException e) {
+    } catch (IOException | InterruptedException e) {
