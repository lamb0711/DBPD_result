HDFS-14313. Get hdfs used space from FsDatasetImpl#volumeMap#ReplicaInfo in memory instead of df/du. Contributed by Lisheng Sun.

-import java.util.concurrent.TimeUnit;
-  final class Builder {
+  class Builder {
-    static final String CLASSNAME_KEY = "fs.getspaceused.classname";
-    static final String JITTER_KEY = "fs.getspaceused.jitterMillis";
-    static final long DEFAULT_JITTER = TimeUnit.MINUTES.toMillis(1);
-
-
+    private Constructor<? extends GetSpaceUsed> cons;
-      return conf.getClass(CLASSNAME_KEY, result, GetSpaceUsed.class);
+      return conf.getClass(CommonConfigurationKeys.FS_GETSPACEUSED_CLASSNAME,
+          result, GetSpaceUsed.class);
-          return DEFAULT_JITTER;
+          return CommonConfigurationKeys.FS_GETSPACEUSED_JITTER_DEFAULT;
-        return configuration.getLong(JITTER_KEY, DEFAULT_JITTER);
+        return configuration.getLong(CommonConfigurationKeys.FS_GETSPACEUSED_JITTER_KEY,
+                CommonConfigurationKeys.FS_GETSPACEUSED_JITTER_DEFAULT);
+    public Constructor<? extends GetSpaceUsed> getCons() {
+      return cons;
+    }
+
+    public void setCons(Constructor<? extends GetSpaceUsed> cons) {
+      this.cons = cons;
+    }
+
-        Constructor<? extends GetSpaceUsed> cons =
-            getKlass().getConstructor(Builder.class);
+        if (cons == null) {
+          cons = getKlass().getConstructor(Builder.class);
+        }
+
