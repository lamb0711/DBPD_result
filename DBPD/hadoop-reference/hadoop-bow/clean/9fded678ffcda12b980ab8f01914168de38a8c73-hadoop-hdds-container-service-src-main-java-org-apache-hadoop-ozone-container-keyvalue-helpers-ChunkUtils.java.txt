HDDS-1621. writeData in ChunkUtils should not use AsynchronousFileChannel. Contributed by Supratim Deka (#917)


+import java.nio.channels.FileChannel;
-    AsynchronousFileChannel file = null;
+    FileChannel file = null;
-      file = sync ?
-          AsynchronousFileChannel.open(chunkFile.toPath(),
-              StandardOpenOption.CREATE,
-              StandardOpenOption.WRITE,
-              StandardOpenOption.SPARSE,
-              StandardOpenOption.SYNC) :
-          AsynchronousFileChannel.open(chunkFile.toPath(),
+
+      // skip SYNC and DSYNC to reduce contention on file.lock
+      file = FileChannel.open(chunkFile.toPath(),
-      lock = file.lock().get();
-      int size = file.write(data, chunkInfo.getOffset()).get();
+
+      lock = file.lock();
+      int size = file.write(data, chunkInfo.getOffset());
+          if (sync) {
+            // ensure data and metadata is persisted. Outside the lock
+            file.force(true);
+          }
