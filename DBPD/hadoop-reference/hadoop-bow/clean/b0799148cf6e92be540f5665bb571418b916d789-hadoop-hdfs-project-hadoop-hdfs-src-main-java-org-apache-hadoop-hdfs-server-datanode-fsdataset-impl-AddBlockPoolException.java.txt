HDFS-14459. ClosedChannelException silently ignored in FsVolumeList.addBlockPool(). Contributed by Stephen O'Donnell.

Signed-off-by: Wei-Chiu Chuang <weichiu@apache.org>

+import java.util.concurrent.ConcurrentHashMap;
+  public AddBlockPoolException() {
+    this.unhealthyDataDirs = new ConcurrentHashMap<FsVolumeSpi, IOException>();
+  }
+
+  public void mergeException(AddBlockPoolException e) {
+    if (e == null) {
+      return;
+    }
+    for(FsVolumeSpi v : e.unhealthyDataDirs.keySet()) {
+      // If there is already an exception for this volume, keep the original
+      // exception and discard the new one. It is likely the first
+      // exception caused the second or they were both due to the disk issue
+      if (!unhealthyDataDirs.containsKey(v)) {
+        unhealthyDataDirs.put(v, e.unhealthyDataDirs.get(v));
+      }
+    }
+  }
+
+  public boolean hasExceptions() {
+    return !unhealthyDataDirs.isEmpty();
+  }
+
