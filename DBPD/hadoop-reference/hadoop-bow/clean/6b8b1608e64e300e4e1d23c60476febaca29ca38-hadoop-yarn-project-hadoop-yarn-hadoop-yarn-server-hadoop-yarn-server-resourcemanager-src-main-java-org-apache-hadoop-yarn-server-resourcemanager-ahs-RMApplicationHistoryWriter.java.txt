YARN-2033. Merging generic-history into the Timeline Store (Contributed by Zhijie Shen)

-    writer = createApplicationHistoryStore(conf);
-    addIfService(writer);
-
-    dispatcher = createDispatcher(conf);
-    dispatcher.register(WritingHistoryEventType.class,
-      new ForwardingEventHandler());
-    addIfService(dispatcher);
+    // Only create the services when the history service is enabled, preventing
+    // wasting the system resources.
+    if (historyServiceEnabled) {
+      writer = createApplicationHistoryStore(conf);
+      addIfService(writer);
+  
+      dispatcher = createDispatcher(conf);
+      dispatcher.register(WritingHistoryEventType.class,
+        new ForwardingEventHandler());
+      addIfService(dispatcher);
+    }
