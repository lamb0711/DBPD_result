HDDS-1317. KeyOutputStream#write throws ArrayIndexOutOfBoundsException when running RandomWrite MR examples. Contributed by Shashikant Banerjee.

-  public ByteBuffer getBuffer() {
+  public ByteBuffer getCurrentBuffer() {
-    ByteBuffer buffer = getBuffer();
+    ByteBuffer buffer = getCurrentBuffer();
-  public void releaseBuffer() {
+  public void releaseBuffer(ByteBuffer byteBuffer) {
+    // Ensure the buffer to be removed is always at the head of the list.
+    Preconditions.checkArgument(buffer.equals(byteBuffer));
+    Preconditions.checkArgument(currentBufferIndex >= 0);
+
-  ByteBuffer getBuffer(int index) {
+  public ByteBuffer getBuffer(int index) {
+  int getCurrentBufferIndex() {
+    return currentBufferIndex;
+  }
+
