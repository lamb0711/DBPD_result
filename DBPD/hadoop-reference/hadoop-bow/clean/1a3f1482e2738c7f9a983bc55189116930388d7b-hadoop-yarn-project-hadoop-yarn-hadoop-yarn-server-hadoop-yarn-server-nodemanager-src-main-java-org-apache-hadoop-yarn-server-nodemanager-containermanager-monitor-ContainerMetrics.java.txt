YARN-4795. ContainerMetrics drops records. (Daniel Templeton via kasha)

-  private long flushPeriodMs;
+  private final long flushPeriodMs;
+  private final long unregisterDelayMs;
-  private boolean unregister = false; // unregister
-  private long unregisterDelayMs;
-    if (unregister) {
-      return;
-    }
-
-    if (finished) {
-      this.unregister = true;
-    } else if (flushOnPeriod) {
+    if (!finished && flushOnPeriod) {
+
+
