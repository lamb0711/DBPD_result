HDFS-14327. Using FQDN instead of IP to access servers with DNS resolving. Contributed by Fengnan Li.

-import java.net.InetAddress;
-      addressesOfNns = getResolvedAddressesIfNecessary(addressesOfNns, uri);
+      addressesOfNns = getResolvedHostsIfNecessary(addressesOfNns, uri);
-  Collection<InetSocketAddress> getResolvedAddressesIfNecessary(
+  Collection<InetSocketAddress> getResolvedHostsIfNecessary(
+    // decide whether to access server by IP or by host name
+    String useFQDNKeyWithHost =
+        HdfsClientConfigKeys.Failover.RESOLVE_ADDRESS_TO_FQDN + "." + host;
+    boolean requireFQDN = conf.getBoolean(useFQDNKeyWithHost,
+        HdfsClientConfigKeys.Failover.RESOLVE_ADDRESS_TO_FQDN_DEFAULT);
-      InetAddress[] resolvedAddresses = dnr.getAllByDomainName(
-          address.getHostName());
+      String[] resolvedHostNames = dnr.getAllResolvedHostnameByDomainName(
+          address.getHostName(), requireFQDN);
-      for (InetAddress raddress : resolvedAddresses) {
+      for (String hostname : resolvedHostNames) {
-            raddress, port);
+            hostname, port);
