HDFS-4727. Update inodeMap after deleting files/directories/snapshots.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1470756 13f79535-47bb-0310-9956-ffa450edef68

+    List<INode> removedINodes = new ArrayList<INode>();
-      if (!dir.delete(src, collectedBlocks)) {
+      if (!dir.delete(src, collectedBlocks, removedINodes)) {
+    dir.removeFromInodeMap(removedINodes);
+    removedINodes.clear();
-   * Remove leases and blocks related to a given path
+   * Remove leases, inodes and blocks related to a given path
+   * @param removedINodes Containing the list of inodes to be removed from 
+   *                      inodesMap
-  void removePathAndBlocks(String src, BlocksMapUpdateInfo blocks) {
+  void removePathAndBlocks(String src, BlocksMapUpdateInfo blocks,
+      List<INode> removedINodes) {
+    // remove inodes from inodesMap
+    if (removedINodes != null) {
+      dir.removeFromInodeMap(removedINodes);
+      removedINodes.clear();
+    }
+      List<INode> removedINodes = new ArrayList<INode>();
-            collectedBlocks);
+            collectedBlocks, removedINodes);
+        dir.removeFromInodeMap(removedINodes);
+      removedINodes.clear();
