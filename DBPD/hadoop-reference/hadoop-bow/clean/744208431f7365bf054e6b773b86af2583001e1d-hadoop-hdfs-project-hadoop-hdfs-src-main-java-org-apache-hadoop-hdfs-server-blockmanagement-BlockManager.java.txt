HDFS-10940. Reduce performance penalty of block caching when not used. Contributed by Daryn Sharp.

+import org.apache.hadoop.hdfs.server.namenode.CacheManager;
-      return new LocatedBlocks(fileSizeExcludeBlocksUnderConstruction,
+      LocatedBlocks locations = new LocatedBlocks(
+          fileSizeExcludeBlocksUnderConstruction,
+      // Set caching information for the located blocks.
+      CacheManager cm = namesystem.getCacheManager();
+      if (cm != null) {
+        cm.setCachedLocations(locations);
+      }
+      return locations;
