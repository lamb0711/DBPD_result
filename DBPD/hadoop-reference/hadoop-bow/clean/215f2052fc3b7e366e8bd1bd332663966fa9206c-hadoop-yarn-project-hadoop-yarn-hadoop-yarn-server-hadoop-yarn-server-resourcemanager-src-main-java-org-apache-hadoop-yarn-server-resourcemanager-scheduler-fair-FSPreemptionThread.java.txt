YARN-9984. FSPreemptionThread can cause NullPointerException while app is unregistered with containers running on a node. Contributed by Wilfred Spiegelenburg.

-              LOG.info("Preempting container " + container +
-                      " from queue " + app.getQueueName());
-              app.trackContainerForPreemption(container);
+              LOG.info("Preempting container " + container + " from queue: "
+                  + (app != null ? app.getQueueName() : "unknown"));
+              // If the app has unregistered while building the container list
+              // the app might be null, skip notifying the app
+              if (app != null) {
+                app.trackContainerForPreemption(container);
+              }
+      // If the app has unregistered while building the container list the app
+      // might be null, just skip this container: it should be cleaned up soon
+      if (app == null) {
+        LOG.info("Found container " + container + " on node "
+            + node.getNodeName() + "without app, skipping preemption");
+        continue;
+      }
