Merge branch 'trunk' into HDDS-1535
+import java.io.FileInputStream;
+import org.apache.hadoop.hdds.protocol.proto.HddsProtos;
+  private static final Logger LOG =
+      LoggerFactory.getLogger(ContainerUtils.class);
+
-      if(!path.getParentFile().exists() &&
+      if (!path.getParentFile().exists() &&
-      throw new IOException("Failed to parse DatanodeDetails from "
-          + path.getAbsolutePath(), e);
+      LOG.warn("Error loading DatanodeDetails yaml from " +
+          path.getAbsolutePath(), e);
+      // Try to load as protobuf before giving up
+      try (FileInputStream in = new FileInputStream(path)) {
+        return DatanodeDetails.getFromProtoBuf(
+            HddsProtos.DatanodeDetailsProto.parseFrom(in));
+      } catch (IOException io) {
+        throw new IOException("Failed to parse DatanodeDetails from "
+            + path.getAbsolutePath(), io);
+      }
