Revert HDFS-3058


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1342493 13f79535-47bb-0310-9956-ffa450edef68

-      maxTxId.store(txId);
-          long id = currentLedger.getId();
-          bkc.deleteLedger(id);
-        count += (lastTxId - l.getFirstTxId()) + 1;
-        expectedStart = lastTxId + 1;
+        count += (l.getLastTxId() - l.getFirstTxId()) + 1;
+        expectedStart = l.getLastTxId() + 1;
-          long endTxId = recoverLastTxId(l, true);
+          long endTxId = recoverLastTxId(l);
-  private long recoverLastTxId(EditLogLedgerMetadata l, boolean fence)
-      throws IOException {
+  private long recoverLastTxId(EditLogLedgerMetadata l) throws IOException {
-      LedgerHandle lh = null;
-      if (fence) {
-        lh = bkc.openLedger(l.getLedgerId(),
-                            BookKeeper.DigestType.MAC,
-                            digestpw.getBytes());
-      } else {
-        lh = bkc.openLedgerNoRecovery(l.getLedgerId(),
-                                      BookKeeper.DigestType.MAC,
-                                      digestpw.getBytes());
-      }
+      LedgerHandle lh = bkc.openLedger(l.getLedgerId(),
+                                       BookKeeper.DigestType.MAC,
+                                       digestpw.getBytes());
