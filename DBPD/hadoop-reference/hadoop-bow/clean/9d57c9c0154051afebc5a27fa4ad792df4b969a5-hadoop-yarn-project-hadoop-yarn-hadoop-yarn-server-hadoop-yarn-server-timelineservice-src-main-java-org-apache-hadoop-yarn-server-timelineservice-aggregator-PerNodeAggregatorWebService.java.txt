YARN-3087. Made the REST server of per-node aggregator work alone in NM daemon. Conntributed by Li Lu.

(cherry picked from commit 41a08ad404d4278fe598d6c222b2ae0e84bae0df)

+import javax.servlet.ServletContext;
-import com.google.inject.Inject;
-import java.net.URI;
-
-  private final AppLevelServiceManager serviceManager;
-
-  @Inject
-  public PerNodeAggregatorWebService(AppLevelServiceManager serviceManager) {
-    this.serviceManager = serviceManager;
-  }
+  private @Context ServletContext context;
-      AppLevelAggregatorService service = serviceManager.getService(appId);
+      AppLevelAggregatorService service = getAggregatorService(req, appId);
+  private AppLevelAggregatorService
+      getAggregatorService(HttpServletRequest req, String appIdToParse) {
+    String appIdString = parseApplicationId(appIdToParse);
+    final AppLevelServiceManager serviceManager =
+        (AppLevelServiceManager) context.getAttribute(
+            PerNodeAggregatorServer.AGGREGATOR_COLLECTION_ATTR_KEY);
+    return serviceManager.getService(appIdString);
+  }
+
