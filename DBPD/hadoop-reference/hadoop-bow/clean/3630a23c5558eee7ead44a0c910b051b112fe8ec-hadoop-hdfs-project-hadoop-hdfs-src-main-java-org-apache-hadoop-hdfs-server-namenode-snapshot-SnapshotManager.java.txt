HDFS-4978. Make disallowSnapshot idempotent. Contributed by Jing Zhao.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1502400 13f79535-47bb-0310-9956-ffa450edef68

-import com.google.common.base.Preconditions;
-
-    final INodeDirectorySnapshottable removed = snapshottables.remove(s.getId());
-    Preconditions.checkState(s == removed);
+    snapshottables.remove(s.getId());
-    final INodeDirectorySnapshottable s = INodeDirectorySnapshottable.valueOf(
-        iip.getLastINode(), path);
+    final INodeDirectory d = INodeDirectory.valueOf(iip.getLastINode(), path);
+    if (!d.isSnapshottable()) {
+      // the directory is already non-snapshottable
+      return;
+    }
+    final INodeDirectorySnapshottable s = (INodeDirectorySnapshottable) d;
-      if (s.getSnapshotQuota() == 0) {
-        throw new SnapshotException("Root is not a snapshottable directory");
-      }
