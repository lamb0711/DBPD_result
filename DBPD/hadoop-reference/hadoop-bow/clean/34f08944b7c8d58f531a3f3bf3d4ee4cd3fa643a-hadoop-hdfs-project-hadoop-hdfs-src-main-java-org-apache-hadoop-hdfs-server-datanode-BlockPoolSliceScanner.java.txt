merge trunk to branch HDFS-4949

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-4949@1532952 13f79535-47bb-0310-9956-ffa450edef68

+  private boolean isNewPeriod = true;
-        return l < r? -1: l > r? 1: 0; 
+        // compare blocks itself if scantimes are same to avoid.
+        // because TreeMap uses comparator if available to check existence of
+        // the object. 
+        return l < r? -1: l > r? 1: left.compareTo(right); 
-      } else if (that == null || !(that instanceof BlockScanInfo)) {
-        return false;
-                  updateBytesLeft(-info.getNumBytes());
+                  if (isNewPeriod) {
+                    updateBytesLeft(-info.getNumBytes());
+                  }
-                if (logIterator.isPrevious()) {
+                if (logIterator.isLastReadFromPrevious()) {
+      isNewPeriod = false;
+    isNewPeriod = true;
