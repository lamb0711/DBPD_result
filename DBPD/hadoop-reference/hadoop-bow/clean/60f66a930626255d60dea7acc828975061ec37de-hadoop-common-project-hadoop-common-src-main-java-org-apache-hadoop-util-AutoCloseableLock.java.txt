Merge branch 'trunk' into HADOOP-12756

+import java.util.concurrent.locks.Lock;
+import java.util.concurrent.locks.Condition;
+import com.google.common.annotations.VisibleForTesting;
+
-  private final ReentrantLock lock;
+  private final Lock lock;
-   * the underlying {@code ReentrantLock} object.
+   * the underlying lock instance with a new {@code ReentrantLock}.
-    this.lock = new ReentrantLock();
+    this(new ReentrantLock());
+  }
+
+  /**
+   * Wrap provided Lock instance.
+   * @param lock Lock instance to wrap in AutoCloseable API.
+   */
+  public AutoCloseableLock(Lock lock) {
+    this.lock = lock;
-   * the underlying {@code ReentrantLock} object.
+   * the underlying {@code Lock} object.
-  public boolean isLocked() {
-    return lock.isLocked();
+  @VisibleForTesting
+  boolean isLocked() {
+    if (lock instanceof ReentrantLock) {
+      return ((ReentrantLock)lock).isLocked();
+    }
+    throw new UnsupportedOperationException();
+  }
+
+  /**
+   * See {@link ReentrantLock#newCondition()}.
+   * @return the Condition object
+   */
+  public Condition newCondition() {
+    return lock.newCondition();
