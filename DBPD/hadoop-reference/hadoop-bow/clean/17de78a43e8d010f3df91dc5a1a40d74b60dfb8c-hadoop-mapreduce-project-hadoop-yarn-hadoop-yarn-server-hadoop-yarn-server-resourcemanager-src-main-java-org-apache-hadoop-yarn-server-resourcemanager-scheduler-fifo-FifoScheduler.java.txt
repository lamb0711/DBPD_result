MAPREDUCE-4299. Terasort hangs with MR2 FifoScheduler (Tom White via bobby)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1361397 13f79535-47bb-0310-9956-ffa450edef68

-      application.setHeadroom(clusterResource);
-      
-        return;
+        break;
+
+    // Update the applications' headroom to correctly take into
+    // account the containers assigned in this update.
+    for (SchedulerApp application : applications.values()) {
+      application.setHeadroom(Resources.subtract(clusterResource, usedResource));
+    }
