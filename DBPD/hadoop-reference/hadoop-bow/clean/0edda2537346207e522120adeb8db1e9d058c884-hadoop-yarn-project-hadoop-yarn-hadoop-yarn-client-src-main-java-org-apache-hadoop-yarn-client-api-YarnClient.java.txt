YARN-1764. Modified YarnClient to correctly handle failover of ResourceManager after the submitApplication call goes through. Contributed by Xuan Gong.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1576160 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.api.ApplicationClientProtocol;
+import org.apache.hadoop.yarn.api.protocolrecords.GetApplicationReportRequest;
+import org.apache.hadoop.yarn.api.protocolrecords.SubmitApplicationRequest;
-import org.apache.hadoop.yarn.exceptions.ContainerNotFoundException;
+import org.apache.hadoop.yarn.exceptions.ApplicationNotFoundException;
-   * Submit a new application to <code>YARN.</code> It is a blocking call, such
-   * that it will not return {@link ApplicationId} until the submitted
-   * application has been submitted and accepted by the ResourceManager.
+   * Submit a new application to <code>YARN.</code> It is a blocking call - it
+   * will not return {@link ApplicationId} until the submitted application is
+   * submitted successfully and accepted by the ResourceManager.
-   * Should provide an {@link ApplicationId} when submits a new application,
-   * otherwise, it will throw the {@link ApplicationIdNotProvidedException}
+   * Users should provide an {@link ApplicationId} as part of the parameter
+   * {@link ApplicationSubmissionContext} when submitting a new application,
+   * otherwise it will throw the {@link ApplicationIdNotProvidedException}.
+   * <p>This internally calls {@link ApplicationClientProtocol#submitApplication
+   * (SubmitApplicationRequest)}, and after that, it internally invokes
+   * {@link ApplicationClientProtocol#getApplicationReport
+   * (GetApplicationReportRequest)} and waits till it can make sure that the
+   * application gets properly submitted. If RM fails over or RM restart
+   * happens before ResourceManager saves the application's state,
+   * {@link ApplicationClientProtocol
+   * #getApplicationReport(GetApplicationReportRequest)} will throw
+   * the {@link ApplicationNotFoundException}. This API automatically resubmits
+   * the application with the same {@link ApplicationSubmissionContext} when it
+   * catches the {@link ApplicationNotFoundException}</p>
+   *
-  public abstract ApplicationId submitApplication(ApplicationSubmissionContext appContext)
-      throws YarnException, IOException;
+  public abstract ApplicationId submitApplication(
+      ApplicationSubmissionContext appContext) throws YarnException,
+      IOException;
