HDFS-6229. Race condition in failover can cause RetryCache fail to work. Contributed by Jing Zhao.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1586714 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.concurrent.locks.ReentrantLock;
+  private final ReentrantLock lock = new ReentrantLock();
+
+  public void lock() {
+    this.lock.lock();
+  }
+
+  public void unlock() {
+    this.lock.unlock();
+  }
-    synchronized (this) {
+    lock.lock();
+    try {
+    } finally {
+      lock.unlock();
-    synchronized(this) {
+    lock.lock();
+    try {
+    } finally {
+      lock.unlock();
-    synchronized(this) {
+    lock.lock();
+    try {
+    } finally {
+      lock.unlock();
