HDDS-1464. Client should have different retry policies for different exceptions. (#785)



-import org.apache.hadoop.hdds.protocol.datanode.proto.ContainerProtos
-    .ChecksumType;
+import org.apache.hadoop.hdds.protocol.datanode.proto.ContainerProtos.ChecksumType;
+import java.util.Map;
+import java.util.function.Function;
+import java.util.stream.Collectors;
-  private final RetryPolicy retryPolicy;
+  private final Map<Class<? extends Throwable>, RetryPolicy> retryPolicyMap;
-    this.retryPolicy = RetryPolicies.TRY_ONCE_THEN_FAIL;
+    this.retryPolicyMap = OzoneClientUtils.getExceptionList()
+        .stream()
+        .collect(Collectors.toMap(Function.identity(),
+            e -> RetryPolicies.TRY_ONCE_THEN_FAIL));
-    this.retryPolicy = OzoneClientUtils.createRetryPolicy(maxRetryCount,
-        retryInterval);
+    this.retryPolicyMap = OzoneClientUtils.getRetryPolicyByException(
+        maxRetryCount, retryInterval);
+    RetryPolicy retryPolicy =
+        retryPolicyMap.get(checkForException(exception).getClass());
+    if (retryPolicy == null) {
+      retryPolicy = retryPolicyMap.get(Exception.class);
+    }
-      action = retryPolicy
-          .shouldRetry(exception, retryCount, 0, true);
+      action = retryPolicy.shouldRetry(exception, retryCount, 0, true);
