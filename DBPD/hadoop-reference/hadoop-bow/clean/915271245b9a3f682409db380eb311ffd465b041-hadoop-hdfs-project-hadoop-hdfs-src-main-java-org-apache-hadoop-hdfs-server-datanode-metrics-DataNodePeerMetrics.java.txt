Make DataNodePeerMetrics#minOutlierDetectionSamples configurable (#1314). Contributed by Lisheng Sun.

Signed-off-by: sunlisheng <sunlisheng@xiaomi.com>
-import com.google.common.annotations.VisibleForTesting;
+import org.apache.hadoop.conf.Configuration;
+import static org.apache.hadoop.hdfs.DFSConfigKeys.DFS_DATANODE_PEER_METRICS_MIN_OUTLIER_DETECTION_SAMPLES_DEFAULT;
+import static org.apache.hadoop.hdfs.DFSConfigKeys.DFS_DATANODE_PEER_METRICS_MIN_OUTLIER_DETECTION_SAMPLES_KEY;
+
-  @VisibleForTesting
-  static final long MIN_OUTLIER_DETECTION_SAMPLES = 1000;
+  private final long minOutlierDetectionSamples;
-  public DataNodePeerMetrics(final String name) {
+  public DataNodePeerMetrics(final String name, Configuration conf) {
+    minOutlierDetectionSamples = conf.getLong(
+        DFS_DATANODE_PEER_METRICS_MIN_OUTLIER_DETECTION_SAMPLES_KEY,
+        DFS_DATANODE_PEER_METRICS_MIN_OUTLIER_DETECTION_SAMPLES_DEFAULT);
+  long getMinOutlierDetectionSamples() {
+    return minOutlierDetectionSamples;
+  }
+
-  public static DataNodePeerMetrics create(String dnName) {
+  public static DataNodePeerMetrics create(String dnName, Configuration conf) {
-    return new DataNodePeerMetrics(name);
+    return new DataNodePeerMetrics(name, conf);
-            MIN_OUTLIER_DETECTION_SAMPLES);
+            minOutlierDetectionSamples);
