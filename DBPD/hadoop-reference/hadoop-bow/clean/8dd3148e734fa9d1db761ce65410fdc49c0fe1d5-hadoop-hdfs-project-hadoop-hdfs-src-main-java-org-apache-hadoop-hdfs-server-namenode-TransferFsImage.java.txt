HDFS-3190. Simple refactors in existing NN code to assist QuorumJournalManager extension. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1356525 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.common.StorageErrorReporter;
+import org.apache.hadoop.hdfs.server.common.Storage;
-      String fsName, long imageTxId, NNStorage dstStorage, boolean needDigest)
+      String fsName, long imageTxId, Storage dstStorage, boolean needDigest)
-      NNStorage storage, long txid) throws IOException {
+      Storage storage, long txid) throws IOException {
-      NNStorage dstStorage, boolean getChecksum) throws IOException {
-    byte[] buf = new byte[HdfsConstants.IO_FILE_BUFFER_SIZE];
+      Storage dstStorage, boolean getChecksum) throws IOException {
-    long startTime = Util.monotonicNow();
-
+    return doGetUrl(url, localPaths, dstStorage, getChecksum);
+  }
+  
+  public static MD5Hash doGetUrl(URL url, List<File> localPaths,
+      Storage dstStorage, boolean getChecksum) throws IOException {
+    long startTime = Util.monotonicNow();
-                            "by the namenode when trying to fetch " + str);
+                            "by the namenode when trying to fetch " + url);
-                  + " with file downloaded from " + str);
+                  + " with file downloaded from " + url);
-            if (dstStorage != null) {
-              dstStorage.reportErrorOnFile(f);
+            if (dstStorage != null &&
+                (dstStorage instanceof StorageErrorReporter)) {
+              ((StorageErrorReporter)dstStorage).reportErrorOnFile(f);
+      byte[] buf = new byte[HdfsConstants.IO_FILE_BUFFER_SIZE];
-        throw new IOException("File " + str + " received length " + received +
+        throw new IOException("File " + url + " received length " + received +
-        throw new IOException("File " + str + " computed digest " +
+        throw new IOException("File " + url + " computed digest " +
