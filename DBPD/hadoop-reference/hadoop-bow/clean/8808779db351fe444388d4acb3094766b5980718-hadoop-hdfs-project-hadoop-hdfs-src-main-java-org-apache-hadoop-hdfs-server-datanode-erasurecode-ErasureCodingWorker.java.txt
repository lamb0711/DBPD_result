HDFS-9734. Refactoring of checksum failure report related codes. Contributed by Kai Zheng.

Change-Id: Ie69a77e3498a360959f8e213c51fb2b17c28b64a

-import java.util.HashSet;
-import java.util.Set;
+import org.apache.hadoop.hdfs.DFSUtilClient.CorruptedBlocks;
-          Map<ExtendedBlock, Set<DatanodeInfo>> corruptionMap = new HashMap<>();
+          CorruptedBlocks corruptedBlocks = new CorruptedBlocks();
-                toReconstruct, corruptionMap);
+                toReconstruct, corruptedBlocks);
-            reportCorruptedBlocks(corruptionMap);
+            datanode.reportCorruptedBlocks(corruptedBlocks);
-        int reconstructLength,
-        Map<ExtendedBlock, Set<DatanodeInfo>> corruptionMap)
+        int reconstructLength, CorruptedBlocks corruptedBlocks)
-              toRead, corruptionMap);
+              toRead, corruptedBlocks);
-                corruptionMap);
+                corruptedBlocks);
-                corruptionMap);
+                corruptedBlocks);
-        Map<ExtendedBlock, Set<DatanodeInfo>> corruptionMap) {
+                                CorruptedBlocks corruptedBlocks) {
-            toRead, corruptionMap);
+            toRead, corruptedBlocks);
-        final Map<ExtendedBlock, Set<DatanodeInfo>> corruptionMap) {
+        final CorruptedBlocks corruptedBlocks) {
-            addCorruptedBlock(reader.block, reader.source, corruptionMap);
+            corruptedBlocks.addCorruptedBlock(reader.block, reader.source);
-    private void reportCorruptedBlocks(
-        Map<ExtendedBlock, Set<DatanodeInfo>> corruptionMap) throws IOException {
-      if (!corruptionMap.isEmpty()) {
-        for (Map.Entry<ExtendedBlock, Set<DatanodeInfo>> entry :
-            corruptionMap.entrySet()) {
-          for (DatanodeInfo dnInfo : entry.getValue()) {
-            datanode.reportRemoteBadBlock(dnInfo, entry.getKey());
-          }
-        }
-      }
-    }
-
-    private void addCorruptedBlock(ExtendedBlock blk, DatanodeInfo node,
-        Map<ExtendedBlock, Set<DatanodeInfo>> corruptionMap) {
-      Set<DatanodeInfo> dnSet = corruptionMap.get(blk);
-      if (dnSet == null) {
-        dnSet = new HashSet<>();
-        corruptionMap.put(blk, dnSet);
-      }
-      if (!dnSet.contains(node)) {
-        dnSet.add(node);
-      }
-    }
-
