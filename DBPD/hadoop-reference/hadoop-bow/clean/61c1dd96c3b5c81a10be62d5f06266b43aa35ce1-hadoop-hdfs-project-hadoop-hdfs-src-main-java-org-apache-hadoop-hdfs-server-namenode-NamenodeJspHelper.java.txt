HDFS-5317. Go back to DFS Home link does not work on datanode webUI. Contributed by Haohui Mai

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1530114 13f79535-47bb-0310-9956-ffa450edef68

+import java.net.InetAddress;
+import org.apache.hadoop.http.HttpConfig;
-        String suffix, boolean alive, int nnHttpPort, String nnaddr, String scheme)
+        String suffix, boolean alive, int nnInfoPort, String nnaddr, String scheme)
-          + "/browseDirectory.jsp?namenodeInfoPort=" + nnHttpPort + "&dir="
+          + "/browseDirectory.jsp?namenodeInfoPort=" + nnInfoPort + "&dir="
-        String suffix, boolean alive, int nnHttpPort, String nnaddr, String scheme)
+        String suffix, boolean alive, int nnInfoPort, String nnaddr, String scheme)
-      generateNodeDataHeader(out, d, suffix, alive, nnHttpPort, nnaddr, scheme);
+      generateNodeDataHeader(out, d, suffix, alive, nnInfoPort, nnaddr, scheme);
-        boolean alive, int nnHttpPort, String nnaddr, String scheme) throws IOException {
+        boolean alive, int nnInfoPort, String nnaddr, String scheme) throws IOException {
-      generateNodeDataHeader(out, d, suffix, alive, nnHttpPort, nnaddr, scheme);
+      generateNodeDataHeader(out, d, suffix, alive, nnInfoPort, nnaddr, scheme);
-      InetSocketAddress nnSocketAddress =
-          (InetSocketAddress)context.getAttribute(
-              NameNodeHttpServer.NAMENODE_ADDRESS_ATTRIBUTE_KEY);
-      String nnaddr = nnSocketAddress.getAddress().getHostAddress() + ":"
-          + nnSocketAddress.getPort();
+      String nnaddr = nn.getServiceRpcAddress().getAddress().getHostName() + ":"
+          + nn.getServiceRpcAddress().getPort();
-      try {
-        Thread.sleep(1000);
-      } catch (InterruptedException e) {
-      }
-
-        int nnHttpPort = nn.getHttpAddress().getPort();
+        int nnInfoPort = request.getServerPort();
-              generateNodeData(out, live.get(i), port_suffix, true, nnHttpPort,
+              generateNodeData(out, live.get(i), port_suffix, true, nnInfoPort,
-                  nnHttpPort, nnaddr, request.getScheme());
+                  nnInfoPort, nnaddr, request.getScheme());
-                  port_suffix, true, nnHttpPort, nnaddr, request.getScheme());
+                  port_suffix, true, nnInfoPort, nnaddr, request.getScheme());
