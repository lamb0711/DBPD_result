YARN-8864. NM incorrectly logs container user as the user who sent a start/stop container request in its audit log. (Contributed by Wilfred Spiegelenburg)

+    String remoteUser = remoteUgi.getUserName();
-          startContainerInternal(containerTokenIdentifier, request);
+          startContainerInternal(containerTokenIdentifier, request,
+              remoteUser);
-      StartContainerRequest request) throws YarnException, IOException {
+      StartContainerRequest request, String remoteUser)
+      throws YarnException, IOException {
-    LOG.info("Start request for " + containerIdStr + " by user " + user);
+    LOG.info("Start request for " + containerIdStr + " by user " + remoteUser);
-        throw new YarnException(
-            "Null resource URL for local resource " + rsrc.getKey() + " : " + rsrc.getValue());
+        throw new YarnException("Null resource URL for local resource "
+            + rsrc.getKey() + " : " + rsrc.getValue());
-        throw new YarnException(
-            "Null resource type for local resource " + rsrc.getKey() + " : " + rsrc.getValue());
+        throw new YarnException("Null resource type for local resource "
+            + rsrc.getKey() + " : " + rsrc.getValue());
-        throw new YarnException(
-            "Null resource visibility for local resource " + rsrc.getKey() + " : " + rsrc.getValue());
+        throw new YarnException("Null resource visibility for local resource "
+            + rsrc.getKey() + " : " + rsrc.getValue());
-      NMAuditLogger.logFailure(user, AuditConstants.START_CONTAINER,
+      NMAuditLogger.logFailure(remoteUser, AuditConstants.START_CONTAINER,
-        NMAuditLogger.logSuccess(user, AuditConstants.START_CONTAINER,
+        NMAuditLogger.logSuccess(remoteUser, AuditConstants.START_CONTAINER,
+    String remoteUser = remoteUgi.getUserName();
-        authorizeGetAndStopContainerRequest(id, container, true, identifier);
-        stopContainerInternal(id);
+        authorizeGetAndStopContainerRequest(id, container, true, identifier,
+            remoteUser);
+        stopContainerInternal(id, remoteUser);
-  protected void stopContainerInternal(ContainerId containerID)
+  protected void stopContainerInternal(ContainerId containerID,
+      String remoteUser)
-      NMAuditLogger.logSuccess(container.getUser(),    
-        AuditConstants.STOP_CONTAINER, "ContainerManageImpl", containerID
-          .getApplicationAttemptId().getApplicationId(), containerID);
+      NMAuditLogger.logSuccess(remoteUser, AuditConstants.STOP_CONTAINER,
+          "ContainerManageImpl",
+          containerID.getApplicationAttemptId().getApplicationId(),
+          containerID);
+    String remoteUser = remoteUgi.getUserName();
-        ContainerStatus status = getContainerStatusInternal(id, identifier);
+        ContainerStatus status = getContainerStatusInternal(id, identifier,
+            remoteUser);
-      NMTokenIdentifier nmTokenIdentifier) throws YarnException {
+      NMTokenIdentifier nmTokenIdentifier, String remoteUser)
+      throws YarnException {
-      nmTokenIdentifier);
+        nmTokenIdentifier, remoteUser);
-      Container container, boolean stopRequest, NMTokenIdentifier identifier)
+      Container container, boolean stopRequest, NMTokenIdentifier identifier,
+      String remoteUser)
-        NMAuditLogger.logFailure("UnknownUser", AuditConstants.STOP_CONTAINER,
+        NMAuditLogger.logFailure(remoteUser, AuditConstants.STOP_CONTAINER,
