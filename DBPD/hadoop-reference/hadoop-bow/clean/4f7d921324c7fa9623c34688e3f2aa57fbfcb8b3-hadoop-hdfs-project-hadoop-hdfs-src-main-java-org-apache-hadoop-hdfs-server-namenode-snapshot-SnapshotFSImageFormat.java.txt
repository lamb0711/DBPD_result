HDFS-4446. Support file snapshots with diff lists.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1443825 13f79535-47bb-0310-9956-ffa450edef68

-    INode rootNode = loader.loadINode(in);
-    rootNode.setLocalName(snapshotName);
-    rootNode.setParent(parent);
-    return new Snapshot(snapshotId, (INodeDirectory) rootNode);
+    final INodeDirectory rootNode = (INodeDirectory)loader.loadINode(in);
+    return new Snapshot(snapshotId, snapshotName, rootNode, parent);
-      parentWithSnapshot.getDiffs().insert(diff);
+      parentWithSnapshot.getDiffs().addFirst(diff);
-    DirectoryDiff sdiff = parent.new DirectoryDiff(snapshot, snapshotINode,
+    DirectoryDiff sdiff = new DirectoryDiff(snapshot, snapshotINode,
