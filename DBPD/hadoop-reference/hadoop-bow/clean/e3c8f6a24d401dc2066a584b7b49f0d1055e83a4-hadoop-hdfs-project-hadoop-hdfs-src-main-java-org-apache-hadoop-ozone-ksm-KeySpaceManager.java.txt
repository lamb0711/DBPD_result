HDFS-11780. Ozone: KSM: Add putKey. Contributed by Chen Liang.

+import org.apache.hadoop.ipc.Client;
+import org.apache.hadoop.ksm.helpers.KsmKeyArgs;
+import org.apache.hadoop.ksm.helpers.KsmKeyInfo;
+import org.apache.hadoop.net.NetUtils;
+import org.apache.hadoop.scm.protocol.ScmBlockLocationProtocol;
+import org.apache.hadoop.scm.protocolPB.ScmBlockLocationProtocolClientSideTranslatorPB;
+import org.apache.hadoop.scm.protocolPB.ScmBlockLocationProtocolPB;
+import org.apache.hadoop.security.UserGroupInformation;
+  private final KeyManager keyManager;
+    keyManager = new KeyManagerImpl(getScmBlockClient(conf), metadataManager);
+  }
+
+  /**
+   * Create a scm block client, used by putKey() and getKey().
+   *
+   * @param conf
+   * @return
+   * @throws IOException
+   */
+  private ScmBlockLocationProtocol getScmBlockClient(OzoneConfiguration conf)
+      throws IOException {
+    RPC.setProtocolEngine(conf, ScmBlockLocationProtocolPB.class,
+        ProtobufRpcEngine.class);
+    long scmVersion =
+        RPC.getProtocolVersion(ScmBlockLocationProtocolPB.class);
+    InetSocketAddress scmBlockAddress =
+        OzoneClientUtils.getScmAddressForBlockClients(conf);
+    ScmBlockLocationProtocolClientSideTranslatorPB scmBlockLocationClient =
+        new ScmBlockLocationProtocolClientSideTranslatorPB(
+            RPC.getProxy(ScmBlockLocationProtocolPB.class, scmVersion,
+                scmBlockAddress, UserGroupInformation.getCurrentUser(), conf,
+                NetUtils.getDefaultSocketFactory(conf),
+                Client.getRpcTimeout(conf)));
+    return scmBlockLocationClient;
+  /**
+   * Allocate a key block.
+   * @param args - attributes of the key.
+   * @return
+   * @throws IOException
+   */
+  @Override
+  public KsmKeyInfo allocateKey(KsmKeyArgs args) throws IOException {
+    try {
+      metrics.incNumKeyBlockAllocates();
+      return keyManager.allocateKey(args);
+    } catch (Exception ex) {
+      metrics.incNumKeyBlockAllocateFails();
+      throw ex;
+    }
+  }
