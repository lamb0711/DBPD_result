Revert "HADOOP-12672. RPC timeout should not override IPC ping interval (iwasakims)"

This reverts commit 682adc6ba9db3bed94fd4ea3d83761db6abfe695.

-    private final int rpcTimeout;
+    private int rpcTimeout;
-    private final boolean doPing; //do we need to send ping message
-    private final int pingInterval; // how often sends ping to the server
-    private final int soTimeout; // used by ipc ping and rpc timeout
+    private boolean doPing; //do we need to send ping message
+    private int pingInterval; // how often sends ping to the server in msecs
-      this.soTimeout =
-          (rpcTimeout == 0 || (doPing && pingInterval < rpcTimeout))?
-              this.pingInterval : this.rpcTimeout;
-       * the RPC is not timed out yet, send a ping.
+       * is not configured to have a RPC timeout, send a ping.
+       * (if rpcTimeout is not set to be 0, then RPC should timeout.
+       * otherwise, throw the timeout exception.
-      private void handleTimeout(SocketTimeoutException e, int waiting)
-          throws IOException {
-        if (shouldCloseConnection.get() || !running.get() ||
-            (0 < rpcTimeout && rpcTimeout <= waiting)) {
+      private void handleTimeout(SocketTimeoutException e) throws IOException {
+        if (shouldCloseConnection.get() || !running.get() || rpcTimeout > 0) {
-        int waiting = 0;
-            waiting += soTimeout;
-            handleTimeout(e, waiting);
+            handleTimeout(e);
-        int waiting = 0;
-            waiting += soTimeout;
-            handleTimeout(e, waiting);
+            handleTimeout(e);
-          this.socket.setSoTimeout(soTimeout);
+          if (rpcTimeout > 0) {
+            pingInterval = rpcTimeout;  // rpcTimeout overwrites pingInterval
+          }
+          this.socket.setSoTimeout(pingInterval);
