HDFS-13983. TestOfflineImageViewer crashes in windows. Contributed by Vinayakumar B.

+import org.apache.hadoop.util.ExitUtil;
-    System.exit(status);
+    ExitUtil.terminate(status);
-    try (PrintStream out = outputFile.equals("-") ?
-        System.out : new PrintStream(outputFile, "UTF-8")) {
+    PrintStream out = null;
+    try {
+      out = outputFile.equals("-") || "REVERSEXML".equalsIgnoreCase(processor) ?
+        System.out : new PrintStream(outputFile, "UTF-8");
-        new FileDistributionCalculator(conf, maxSize, step, formatOutput, out)
-            .visit(new RandomAccessFile(inputFile, "r"));
+        try (RandomAccessFile r = new RandomAccessFile(inputFile, "r")) {
+          new FileDistributionCalculator(conf, maxSize, step, formatOutput, out)
+            .visit(r);
+        }
-        new PBImageXmlWriter(conf, out).visit(new RandomAccessFile(inputFile,
-            "r"));
+        try (RandomAccessFile r = new RandomAccessFile(inputFile, "r")) {
+          new PBImageXmlWriter(conf, out).visit(r);
+        }
-          System.exit(1);
+          ExitUtil.terminate(1);
-            new PBImageDelimitedTextWriter(out, delimiter, tempPath)) {
-          writer.visit(new RandomAccessFile(inputFile, "r"));
+            new PBImageDelimitedTextWriter(out, delimiter, tempPath);
+            RandomAccessFile r = new RandomAccessFile(inputFile, "r")) {
+          writer.visit(r);
+    } finally {
+      if (out != null && out != System.out) {
+        out.close();
+      }
