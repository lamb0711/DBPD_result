HDFS-15003. RBF: Make Router support storage type quota. Contributed by Jinglun.

+import org.apache.hadoop.fs.StorageType;
+import org.apache.hadoop.hdfs.protocol.proto.HdfsProtos;
+import org.apache.hadoop.hdfs.protocol.proto.HdfsProtos.StorageTypeQuotaInfosProto;
+import org.apache.hadoop.hdfs.protocol.proto.HdfsProtos.StorageTypeQuotaInfoProto;
+import static org.apache.hadoop.hdfs.server.federation.router.Quota.eachByStorageType;
+    long[] typeQuota = new long[StorageType.values().length];
+    long[] typeConsume = new long[StorageType.values().length];
+    eachByStorageType(t -> typeQuota[t.ordinal()] = HdfsConstants.QUOTA_RESET);
+    eachByStorageType(t -> typeConsume[t.ordinal()] =
+        RouterQuotaUsage.QUOTA_USAGE_COUNT_DEFAULT);
+      if (quotaProto.hasTypeQuotaInfos()) {
+        StorageTypeQuotaInfosProto typeInfo = quotaProto.getTypeQuotaInfos();
+        for (StorageTypeQuotaInfoProto tp : typeInfo.getTypeQuotaInfoList()) {
+          typeQuota[StorageType.parseStorageType(tp.getType().name())
+              .ordinal()] = tp.getQuota();
+          typeConsume[StorageType.parseStorageType(tp.getType().name())
+              .ordinal()] = tp.getConsumed();
+        }
+      }
-        .spaceConsumed(ssCount);
+        .spaceConsumed(ssCount).typeQuota(typeQuota).typeConsumed(typeConsume);
-      QuotaUsageProto quotaUsage = QuotaUsageProto.newBuilder()
-          .setFileAndDirectoryCount(quota.getFileAndDirectoryCount())
+      QuotaUsageProto.Builder quotaBuilder = QuotaUsageProto.newBuilder();
+      quotaBuilder.setFileAndDirectoryCount(quota.getFileAndDirectoryCount())
-          .setSpaceQuota(quota.getSpaceQuota()).build();
+          .setSpaceQuota(quota.getSpaceQuota());
+      if (quota.isTypeQuotaSet()) {
+        StorageTypeQuotaInfosProto.Builder infoBuilder =
+            StorageTypeQuotaInfosProto.newBuilder();
+        eachByStorageType(t -> infoBuilder.addTypeQuotaInfo(
+            StorageTypeQuotaInfoProto.newBuilder()
+                .setType(HdfsProtos.StorageTypeProto.valueOf(t.name()))
+                .setQuota(quota.getTypeQuota(t))
+                .setConsumed(quota.getTypeConsumed(t)).build()));
+        quotaBuilder.setTypeQuotaInfos(infoBuilder.build());
+      }
+      QuotaUsageProto quotaUsage = quotaBuilder.build();
