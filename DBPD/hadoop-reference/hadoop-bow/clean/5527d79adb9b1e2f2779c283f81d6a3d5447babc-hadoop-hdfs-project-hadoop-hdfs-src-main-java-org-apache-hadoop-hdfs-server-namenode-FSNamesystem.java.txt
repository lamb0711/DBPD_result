HDFS-14810. Review FSNameSystem editlog sync. Contributed by Xiaoqiao He.

-    } finally {
-      getEditLog().logSync();
+    getEditLog().logSync();
-      logAuditEvent(success, operationName, src, dst, ret.auditStat);
+      logAuditEvent(true, operationName, src, dst, ret.auditStat);
+    boolean success = false;
-        return FSDirStatAndListingOp.isFileClosed(dir, pc, src);
+        success = FSDirStatAndListingOp.isFileClosed(dir, pc, src);
+    if (success) {
+      logAuditEvent(true, operationName, src);
+    }
+    return success;
-    } finally {
-      getEditLog().logSync();
+    getEditLog().logSync();
-    final boolean success;
-      success = true;
-    logAuditEvent(success, operationName, tokenId);
+    logAuditEvent(true, operationName, tokenId);
-    boolean success = false;
-      success = true;
-    logAuditEvent(success, operationName, path, null, null);
+    logAuditEvent(true, operationName, path, null, null);
-      logAuditEvent(false, operationName, snapshotRoot,
-          snapshotPath, null);
+      logAuditEvent(false, operationName, snapshotRoot);
-      logAuditEvent(false, operationName, null,
-          null, null);
+      logAuditEvent(false, operationName, null);
-    } finally {
-      getEditLog().logSync();
+    getEditLog().logSync();
-    logAuditEvent(true, operationName, effectiveDirectiveStr,
-        null, null);
+    logAuditEvent(true, operationName, effectiveDirectiveStr);
-    } finally {
-      getEditLog().logSync();
+    getEditLog().logSync();
-    logAuditEvent(true, operationName, idStr, null, null);
+    logAuditEvent(true, operationName, idStr, null, null);
-      logAuditEvent(false, operationName, filter.toString(), null,
-          null);
+      logAuditEvent(false, operationName, filter.toString());
-    logAuditEvent(true, operationName, filter.toString(), null,
-        null);
+    logAuditEvent(true, operationName, filter.toString());
-      logAuditEvent(false, operationName, poolInfoStr, null, null);
+      logAuditEvent(false, operationName, poolInfoStr);
-    logAuditEvent(true, operationName, poolInfoStr, null, null);
+    logAuditEvent(true, operationName, poolInfoStr);
+    getEditLog().logSync();
-
-    getEditLog().logSync();
-      logAuditEvent(false, operationName, poolNameStr, null, null);
+      logAuditEvent(false, operationName, poolNameStr);
-    logAuditEvent(true, operationName, poolNameStr, null, null);
+    logAuditEvent(true, operationName, poolNameStr);
-      logAuditEvent(false, operationName, null, null, null);
+      logAuditEvent(false, operationName, null);
-    logAuditEvent(true, operationName, null, null, null);
+    logAuditEvent(true, operationName, null);
+    final FileStatus resultingStat;
-      final FileStatus resultingStat;
-
-      getEditLog().logSync();
-      logAuditEvent(true, operationName, src, null, resultingStat);
+    getEditLog().logSync();
+    logAuditEvent(true, operationName, src, null, resultingStat);
-    boolean success = false;
-      success = true;
+    } catch (AccessControlException ace) {
+      logAuditEvent(false, operationName, srcArg);
+      throw ace;
-      if (success) {
-        getEditLog().logSync();
-      }
-      logAuditEvent(success, operationName, srcArg, null, resultingStat);
+    getEditLog().logSync();
+    logAuditEvent(true, operationName, srcArg, null, resultingStat);
-    boolean success = false;
-      success = true;
-      return responses.toArray(new AddErasureCodingPolicyResponse[0]);
-      if (success) {
-        getEditLog().logSync();
-      }
-      logAuditEvent(success, operationName, addECPolicyNames.toString(),
-          null, null);
+    getEditLog().logSync();
+    logAuditEvent(true, operationName, addECPolicyNames.toString());
+    return responses.toArray(new AddErasureCodingPolicyResponse[0]);
-    boolean success = false;
-      success = true;
-      if (success) {
-        getEditLog().logSync();
-      }
-      logAuditEvent(success, operationName, ecPolicyName, null, null);
+    getEditLog().logSync();
+    logAuditEvent(true, operationName, ecPolicyName, null, null);
-      logAuditEvent(false, operationName, ecPolicyName, null, null);
-    } finally {
-      if (success) {
-        getEditLog().logSync();
-        logAuditEvent(success, operationName, ecPolicyName, null, null);
-      }
+      logAuditEvent(false, operationName, ecPolicyName);
+      throw ace;
+    }
+    if (success) {
+      getEditLog().logSync();
+      logAuditEvent(true, operationName, ecPolicyName);
-      logAuditEvent(false, operationName, ecPolicyName, null, null);
-    } finally {
-      if (success) {
-        getEditLog().logSync();
-        logAuditEvent(success, operationName, ecPolicyName, null, null);
-      }
+      logAuditEvent(false, operationName, ecPolicyName);
+      throw ace;
+    }
+    if (success) {
+      getEditLog().logSync();
+      logAuditEvent(true, operationName, ecPolicyName);
-    boolean success = false;
-      success = true;
-      if (success) {
-        getEditLog().logSync();
-      }
-      logAuditEvent(success, operationName, srcArg, null, resultingStat);
+    getEditLog().logSync();
+    logAuditEvent(true, operationName, srcArg, null, resultingStat);
+    logAuditEvent(true, operationName, src);
