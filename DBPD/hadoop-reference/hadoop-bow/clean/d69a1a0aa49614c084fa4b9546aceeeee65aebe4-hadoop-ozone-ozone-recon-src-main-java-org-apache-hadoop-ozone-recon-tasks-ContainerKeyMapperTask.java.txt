HDDS-1105 : Add mechanism in Recon to obtain DB snapshot 'delta' updates from Ozone Manager (#1259)


+import static org.apache.hadoop.ozone.om.OmMetadataManagerImpl.KEY_TABLE;
+
-import java.util.ArrayList;
+import java.util.Collections;
+import com.google.inject.Inject;
+
-public class ContainerKeyMapperTask extends ReconDBUpdateTask {
+public class ContainerKeyMapperTask implements ReconDBUpdateTask {
-  private Collection<String> tables = new ArrayList<>();
+  @Inject
-                                    containerDBServiceProvider,
-                                OMMetadataManager omMetadataManager) {
-    super("ContainerKeyMapperTask");
+                                    containerDBServiceProvider) {
-    try {
-      tables.add(omMetadataManager.getKeyTable().getName());
-    } catch (IOException ioEx) {
-      LOG.error("Unable to listen on Key Table updates ", ioEx);
-    }
-  protected Collection<String> getTaskTables() {
-    return tables;
+  public String getTaskName() {
+    return "ContainerKeyMapperTask";
-  Pair<String, Boolean> process(OMUpdateEventBatch events) {
+  public Collection<String> getTaskTables() {
+    return Collections.singletonList(KEY_TABLE);
+  }
+
+  @Override
+  public Pair<String, Boolean> process(OMUpdateEventBatch events) {
+    int eventCount = 0;
+        eventCount++;
+    LOG.info("{} successfully processed {} OM DB update event(s).",
+        getTaskName(), eventCount);
