Revert MAPREDUCE-5475 and YARN-707


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1517097 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.mapreduce.JobACL;
-import org.apache.hadoop.security.AccessControlException;
-import org.apache.hadoop.security.UserGroupInformation;
-    private Job verifyAndGetJob(JobId jobID,
-        JobACL accessType) throws IOException {
+    private Job verifyAndGetJob(JobId jobID, 
+        boolean modifyAccess) throws IOException {
-      UserGroupInformation ugi = UserGroupInformation.getCurrentUser();
-      if (!job.checkAccess(ugi, accessType)) {
-        throw new AccessControlException("User " + ugi.getShortUserName()
-            + " cannot perform operation " + accessType.name() + " on "
-            + jobID);
-      }
-        JobACL accessType) throws IOException {
+        boolean modifyAccess) throws IOException {
-          accessType).getTask(taskID);
+          modifyAccess).getTask(taskID);
-        JobACL accessType) throws IOException {
+        boolean modifyAccess) throws IOException {
-          accessType).getAttempt(attemptID);
+          modifyAccess).getAttempt(attemptID);
-      Job job = verifyAndGetJob(jobId, JobACL.VIEW_JOB);
+      Job job = verifyAndGetJob(jobId, false);
-      Job job = verifyAndGetJob(jobId, JobACL.VIEW_JOB);
+      Job job = verifyAndGetJob(jobId, false);
-          verifyAndGetAttempt(taskAttemptId, JobACL.VIEW_JOB).getReport());
+          verifyAndGetAttempt(taskAttemptId, false).getReport());
-      response.setTaskReport(
-          verifyAndGetTask(taskId, JobACL.VIEW_JOB).getReport());
+      response.setTaskReport(verifyAndGetTask(taskId, false).getReport());
-      Job job = verifyAndGetJob(jobId, JobACL.VIEW_JOB);
+      Job job = verifyAndGetJob(jobId, false);
-      UserGroupInformation callerUGI = UserGroupInformation.getCurrentUser();
-      String message = "Kill job " + jobId + " received from " + callerUGI
-          + " at " + Server.getRemoteAddress();
+      String message = "Kill Job received from client " + jobId;
-      verifyAndGetJob(jobId, JobACL.MODIFY_JOB);
+  	  verifyAndGetJob(jobId, true);
-      UserGroupInformation callerUGI = UserGroupInformation.getCurrentUser();
-      String message = "Kill task " + taskId + " received from " + callerUGI
-          + " at " + Server.getRemoteAddress();
+      String message = "Kill task received from client " + taskId;
-      verifyAndGetTask(taskId, JobACL.MODIFY_JOB);
+      verifyAndGetTask(taskId, true);
-      UserGroupInformation callerUGI = UserGroupInformation.getCurrentUser();
-      String message = "Kill task attempt " + taskAttemptId
-          + " received from " + callerUGI + " at "
-          + Server.getRemoteAddress();
+      String message = "Kill task attempt received from client " + taskAttemptId;
-      verifyAndGetAttempt(taskAttemptId, JobACL.MODIFY_JOB);
+      verifyAndGetAttempt(taskAttemptId, true);
-      response.addAllDiagnostics(verifyAndGetAttempt(taskAttemptId,
-          JobACL.VIEW_JOB).getDiagnostics());
+      response.addAllDiagnostics(
+          verifyAndGetAttempt(taskAttemptId, false).getDiagnostics());
-      UserGroupInformation callerUGI = UserGroupInformation.getCurrentUser();
-      String message = "Fail task attempt " + taskAttemptId
-          + " received from " + callerUGI + " at "
-          + Server.getRemoteAddress();
+      String message = "Fail task attempt received from client " + taskAttemptId;
-      verifyAndGetAttempt(taskAttemptId, JobACL.MODIFY_JOB);
+      verifyAndGetAttempt(taskAttemptId, true);
-      Job job = verifyAndGetJob(jobId, JobACL.VIEW_JOB);
+      Job job = verifyAndGetJob(jobId, false);
