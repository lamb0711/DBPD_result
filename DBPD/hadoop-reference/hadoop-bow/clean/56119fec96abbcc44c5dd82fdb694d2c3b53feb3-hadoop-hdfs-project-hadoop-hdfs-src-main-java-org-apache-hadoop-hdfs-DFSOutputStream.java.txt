HDFS-6880. Adding tracing to DataNode data transfer protocol (iwasakims via cmccabe)

+import org.htrace.Span;
+import org.htrace.Trace;
+import org.htrace.TraceScope;
+
+    private final Span traceSpan;
+
+      this(null);
+    }
+
+    /**
+     * construction with tracing info
+     */
+    private DataStreamer(Span span) {
+      traceSpan = span;
-        int bytesPerChecksum) throws IOException {
+        int bytesPerChecksum, Span span) throws IOException {
+      traceSpan = span;
+      TraceScope traceScope = null;
+      if (traceSpan != null) {
+        traceScope = Trace.continueSpan(traceSpan);
+      }
+      if (traceScope != null) {
+        traceScope.close();
+      }
-    streamer = new DataStreamer();
+    Span traceSpan = null;
+    if (Trace.isTracing()) {
+      traceSpan = Trace.startSpan(this.getClass().getSimpleName()).detach();
+    }
+    streamer = new DataStreamer(traceSpan);
+    Span traceSpan = null;
+    if (Trace.isTracing()) {
+      traceSpan = Trace.startSpan(this.getClass().getSimpleName()).detach();
+    }
+
-      streamer = new DataStreamer(lastBlock, stat, checksum.getBytesPerChecksum());
+      streamer = new DataStreamer(lastBlock, stat,
+          checksum.getBytesPerChecksum(), traceSpan);
-      streamer = new DataStreamer();
+      streamer = new DataStreamer(traceSpan);
