HDDS-2282. scmcli pipeline list command throws NullPointerException. Contributed by Xiaoyu Yao. (#1642)


+import org.apache.hadoop.hdds.protocol.SCMSecurityProtocol;
+import org.apache.hadoop.hdds.security.x509.SecurityConfig;
+import org.apache.hadoop.ozone.OzoneSecurityUtil;
+import static org.apache.hadoop.hdds.HddsUtils.getScmSecurityClient;
-    return new ContainerOperationClient(
-        client, new XceiverClientManager(ozoneConf));
+
+    XceiverClientManager xceiverClientManager = null;
+    if (OzoneSecurityUtil.isSecurityEnabled(ozoneConf)) {
+      SecurityConfig securityConfig = new SecurityConfig(ozoneConf);
+      SCMSecurityProtocol scmSecurityProtocolClient = getScmSecurityClient(
+          (OzoneConfiguration) securityConfig.getConfiguration());
+      String caCertificate =
+          scmSecurityProtocolClient.getCACertificate();
+      xceiverClientManager = new XceiverClientManager(ozoneConf,
+          OzoneConfiguration.of(ozoneConf).getObject(XceiverClientManager
+              .ScmClientConfig.class), caCertificate);
+    } else {
+      xceiverClientManager = new XceiverClientManager(ozoneConf);
+    }
+    return new ContainerOperationClient(client, xceiverClientManager);
