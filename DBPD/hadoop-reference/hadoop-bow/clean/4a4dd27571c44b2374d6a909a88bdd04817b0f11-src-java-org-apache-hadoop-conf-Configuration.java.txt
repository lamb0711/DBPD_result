HADOOP-6243. Fix a NullPointerException in processing deprecated keys. Contributed by Sreekanth Ramakrishnan.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@812455 13f79535-47bb-0310-9956-ffa450edef68

+    //Add code for managing deprecated key mapping
+    //for example
+    //addDeprecation("oldKey1",new String[]{"newkey1","newkey2"});
+    //adds deprecation for oldKey1 to two new keys(newkey1, newkey2).
+    //so get or set of oldKey1 will correctly populate/access values of 
+    //newkey1 and newkey2
-    processDeprecation();
-  }
-  
-  /**
-   * Flag to ensure that the classes mentioned in the value of the property
-   * <code>hadoop.conf.extra.classes</code> are loaded only once for
-   * all instances of <code>Configuration</code>
-   */
-  private static AtomicBoolean loadedDeprecation = new AtomicBoolean(false);
-  
-  private static final String extraConfKey = "hadoop.conf.extra.classes";
-
-  /**
-   * adds all the deprecations to the deprecatedKeyMap and updates the values of
-   * the appropriate keys
-   */
-  private void processDeprecation() {
-    populateDeprecationMapping();
-  
-  /**
-   * Loads all the classes in mapred and hdfs that extend Configuration and that
-   * have deprecations to be added into deprecatedKeyMap
-   */
-  private synchronized void populateDeprecationMapping() {
-    if (!loadedDeprecation.get()) {
-      // load classes from mapred and hdfs which extend Configuration and have 
-      // deprecations added in their static blocks
-      String classnames = substituteVars(properties.getProperty(extraConfKey));
-      if (classnames == null) {
-        return;
-      }
-      String[] classes = StringUtils.getStrings(classnames);
-      for (String className : classes) {
-        try {
-          Class.forName(className);
-        } catch (ClassNotFoundException e) {
-          LOG.warn(className + " is not in the classpath");
-        }
-      }
-      // make deprecatedKeyMap unmodifiable in order to prevent changes to 
-      // it in user's code.
-      deprecatedKeyMap = Collections.unmodifiableMap(deprecatedKeyMap);
-      // ensure that deprecation processing is done only once for all 
-      // instances of this object
-      loadedDeprecation.set(true);
-    }
-  }
-
