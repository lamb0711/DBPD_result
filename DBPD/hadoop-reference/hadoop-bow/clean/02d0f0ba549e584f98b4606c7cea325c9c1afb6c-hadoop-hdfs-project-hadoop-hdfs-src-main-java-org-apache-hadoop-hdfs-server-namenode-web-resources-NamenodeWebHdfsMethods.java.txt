HDFS-6218. Audit log should use true client IP for proxied webhdfs operations. Contributed by Daryn Sharp.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1590640 13f79535-47bb-0310-9956-ffa450edef68

+    
+    // set the remote address, if coming in via a trust proxy server then
+    // the address with be that of the proxied client
+    REMOTE_ADDRESS.set(JspHelper.getRemoteAddr(request));
+  private void reset() {
+    REMOTE_ADDRESS.set(null);
+  }
+  
-        REMOTE_ADDRESS.set(request.getRemoteAddr());
-          REMOTE_ADDRESS.set(null);
+          reset();
-        REMOTE_ADDRESS.set(request.getRemoteAddr());
-          REMOTE_ADDRESS.set(null);
+          reset();
-        REMOTE_ADDRESS.set(request.getRemoteAddr());
-          REMOTE_ADDRESS.set(null);
+          reset();
-        REMOTE_ADDRESS.set(request.getRemoteAddr());
-          REMOTE_ADDRESS.set(null);
+          reset();
