HDFS-7383. DataNode.requestShortCircuitFdsForRead may throw NullPointerException. Contributed by Tsz Wo Nicholas Sze.

+import java.io.FileInputStream;
+import java.io.FileNotFoundException;
+import org.apache.hadoop.hdfs.protocol.ExtendedBlock;
+import org.apache.hadoop.hdfs.server.datanode.fsdataset.FsDatasetSpi;
+import org.apache.hadoop.hdfs.server.datanode.fsdataset.LengthInputStream;
+
+  /**
+   * @return the FileInputStream for the meta data of the given block.
+   * @throws FileNotFoundException
+   *           if the file not found.
+   * @throws ClassCastException
+   *           if the underlying input stream is not a FileInputStream.
+   */
+  public static FileInputStream getMetaDataInputStream(
+      ExtendedBlock b, FsDatasetSpi<?> data) throws IOException {
+    final LengthInputStream lin = data.getMetaDataInputStream(b);
+    if (lin == null) {
+      throw new FileNotFoundException("Meta file for " + b + " not found.");
+    }
+    return (FileInputStream)lin.getWrappedStream();
+  }
