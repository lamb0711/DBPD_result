HDDS-1105 : Add mechanism in Recon to obtain DB snapshot 'delta' updates from Ozone Manager (#1259)


+import java.io.IOException;
+
+import org.apache.hadoop.ozone.om.OMMetadataManager;
+import org.apache.hadoop.ozone.om.protocol.OzoneManagerProtocol;
+import org.apache.hadoop.ozone.om.protocolPB.OzoneManagerProtocolClientSideTranslatorPB;
+import org.apache.hadoop.ozone.recon.tasks.ContainerKeyMapperTask;
+import org.apache.hadoop.ozone.recon.tasks.FileSizeCountTask;
+import org.apache.hadoop.security.UserGroupInformation;
+import org.apache.ratis.protocol.ClientId;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+  private static final Logger LOG =
+      LoggerFactory.getLogger(ReconControllerModule.class);
+
+    bind(OMMetadataManager.class).to(ReconOmMetadataManagerImpl.class)
+        .in(Singleton.class);
-
+    bind(ReconUtils.class).in(Singleton.class);
+    bind(ContainerKeyMapperTask.class);
+    bind(FileSizeCountTask.class);
+  }
+
+  @Provides
+  OzoneManagerProtocol getOzoneManagerProtocol(
+      final OzoneConfiguration ozoneConfiguration) {
+    OzoneManagerProtocol ozoneManagerClient = null;
+    try {
+      ClientId clientId = ClientId.randomId();
+      UserGroupInformation ugi = UserGroupInformation.getCurrentUser();
+      ozoneManagerClient = new
+          OzoneManagerProtocolClientSideTranslatorPB(
+          ozoneConfiguration, clientId.toString(), ugi);
+    } catch (IOException ioEx) {
+      LOG.error("Error in provisioning OzoneManagerProtocol ", ioEx);
+    }
+    return ozoneManagerClient;
