HDFS-3828. Block Scanner rescans blocks too frequently. Contributed by Andy Isaacson


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1381472 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.annotations.VisibleForTesting;
+
+  static final int SLEEP_PERIOD_MS = 5 * 1000;
+
-      //Sleep everytime except in the first interation.
+      //Sleep everytime except in the first iteration.
-          Thread.sleep(5000);
+          Thread.sleep(SLEEP_PERIOD_MS);
-        Thread.sleep(5000);
+        Thread.sleep(SLEEP_PERIOD_MS);
-  // This method is used for testing
+  @VisibleForTesting
+  @VisibleForTesting
+  long getTotalScans(String bpid) throws IOException {
+    BlockPoolSliceScanner bpScanner = getBPScanner(bpid);
+    if (bpScanner == null) {
+      throw new IOException("Block Pool: "+bpid+" is not running");
+    } else {
+      return bpScanner.getTotalScans();
+    }
+  }
+
