Fix potential FSImage corruption. Contributed by Daryn Sharp.

+import org.apache.hadoop.hdfs.server.namenode.SerialNumberManager;
-  private final String[] stringTable;
+  private final SerialNumberManager.StringTable stringTable;
-  private FSImageLoader(String[] stringTable, byte[][] inodes,
-                        Map<Long, long[]> dirmap) {
+  private FSImageLoader(SerialNumberManager.StringTable stringTable,
+                        byte[][] inodes, Map<Long, long[]> dirmap) {
-      String[] stringTable = null;
+      SerialNumberManager.StringTable stringTable = null;
-  static String[] loadStringTable(InputStream in) throws
-  IOException {
+  static SerialNumberManager.StringTable loadStringTable(InputStream in)
+        throws IOException {
-    String[] stringTable = new String[s.getNumEntry() + 1];
+    SerialNumberManager.StringTable stringTable =
+        SerialNumberManager.newStringTable(s.getNumEntry(), s.getMaskBits());
-      stringTable[e.getId()] = e.getStr();
+      stringTable.put(e.getId(), e.getStr());
