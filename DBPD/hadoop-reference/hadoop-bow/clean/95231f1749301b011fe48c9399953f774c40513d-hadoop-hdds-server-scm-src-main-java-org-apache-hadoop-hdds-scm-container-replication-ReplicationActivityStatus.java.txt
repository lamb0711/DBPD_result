HDDS-362. Modify functions impacted by SCM chill mode in ScmBlockLocationProtocol. Contributed by Ajay Kumar.

-
-public class ReplicationActivityStatus
-    implements EventHandler<Boolean>, ReplicationActivityStatusMXBean,
-    Closeable {
+public class ReplicationActivityStatus implements
+    ReplicationActivityStatusMXBean, Closeable {
-
+  private AtomicBoolean replicationStatusSetExternally = new AtomicBoolean();
+  private ReplicationStatusListener replicationStatusListener;
+  private ChillModeStatusListener chillModeStatusListener;
+
+  public ReplicationActivityStatus(){
+    replicationStatusListener = new ReplicationStatusListener();
+    chillModeStatusListener = new ChillModeStatusListener();
+  }
-  /**
-   * The replication status could be set by async events.
-   */
-  @Override
-  public void onMessage(Boolean enabled, EventPublisher publisher) {
-    replicationEnabled.set(enabled);
-  }
+
+  /**
+   * Replication status listener.
+   */
+  class ReplicationStatusListener implements EventHandler<Boolean> {
+    @Override
+    public void onMessage(Boolean status, EventPublisher publisher) {
+      replicationStatusSetExternally.set(true);
+      replicationEnabled.set(status);
+    }
+  }
+
+  /**
+   * Replication status is influenced by Chill mode status as well.
+   */
+  class ChillModeStatusListener implements EventHandler<Boolean> {
+
+    @Override
+    public void onMessage(Boolean inChillMode, EventPublisher publisher) {
+      if (!replicationStatusSetExternally.get()) {
+        replicationEnabled.set(!inChillMode);
+      }
+    }
+  }
+
+  public ReplicationStatusListener getReplicationStatusListener() {
+    return replicationStatusListener;
+  }
+
+  public ChillModeStatusListener getChillModeStatusListener() {
+    return chillModeStatusListener;
+  }
+
