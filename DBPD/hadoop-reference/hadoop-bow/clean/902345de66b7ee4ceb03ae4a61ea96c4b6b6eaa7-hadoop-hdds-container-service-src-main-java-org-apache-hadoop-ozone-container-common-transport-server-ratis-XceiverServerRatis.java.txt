HDDS-728. Datanodes should use different ContainerStateMachine for each pipeline.
Contributed by Mukul Kumar Singh.

+import java.util.concurrent.ExecutorService;
+import java.util.concurrent.Executors;
+  private final List<ExecutorService> executors;
+  private final ContainerDispatcher dispatcher;
-  private ContainerStateMachine stateMachine;
-    stateMachine = new ContainerStateMachine(dispatcher, chunkExecutor, this,
-        numContainerOpExecutors);
+    this.executors = new ArrayList<>();
+    this.dispatcher = dispatcher;
+    for (int i = 0; i < numContainerOpExecutors; i++) {
+      executors.add(Executors.newSingleThreadExecutor());
+    }
+
-        .setStateMachine(stateMachine)
+        .setStateMachineRegistry(this::getStateMachine)
-  @VisibleForTesting
-  public ContainerStateMachine getStateMachine() {
-    return stateMachine;
+  private ContainerStateMachine getStateMachine(RaftGroupId gid) {
+    return new ContainerStateMachine(gid, dispatcher, chunkExecutor,
+            this, Collections.unmodifiableList(executors));
-      chunkExecutor.shutdown();
+      // shutdown server before the executors as while shutting down,
+      // some of the tasks would be executed using the executors.
+      chunkExecutor.shutdown();
+      executors.forEach(ExecutorService::shutdown);
