HDFS-4990. Change BlockPlacementPolicy to choose storages instead of datanodes.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1524444 13f79535-47bb-0310-9956-ffa450edef68

-  void increment(Block block, DatanodeDescriptor[] targets) {
+  void increment(Block block, DatanodeStorageInfo[] targets) {
-  void decrement(Block block, DatanodeDescriptor dn) {
+  void decrement(Block block, DatanodeDescriptor dn, String storageID) {
-        found.decrementReplicas(dn);
+        found.decrementReplicas(dn.getStorageInfo(storageID));
-    private final List<DatanodeDescriptor> targets;
+    private final List<DatanodeStorageInfo> targets;
-    PendingBlockInfo(DatanodeDescriptor[] targets) {
+    PendingBlockInfo(DatanodeStorageInfo[] targets) {
-      this.targets = targets == null ? new ArrayList<DatanodeDescriptor>()
-          : new ArrayList<DatanodeDescriptor>(Arrays.asList(targets));
+      this.targets = targets == null ? new ArrayList<DatanodeStorageInfo>()
+          : new ArrayList<DatanodeStorageInfo>(Arrays.asList(targets));
-    void incrementReplicas(DatanodeDescriptor... newTargets) {
+    void incrementReplicas(DatanodeStorageInfo... newTargets) {
-        for (DatanodeDescriptor dn : newTargets) {
+        for (DatanodeStorageInfo dn : newTargets) {
-    void decrementReplicas(DatanodeDescriptor dn) {
-      targets.remove(dn);
+    void decrementReplicas(DatanodeStorageInfo storage) {
+      targets.remove(storage);
