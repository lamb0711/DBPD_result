YARN-7586. Application Placement should be done before ACL checks in ResourceManager. Contributed by Suma Shivaprasad.

-import org.apache.hadoop.yarn.exceptions.YarnException;
-import org.apache.hadoop.yarn.server.resourcemanager.placement.ApplicationPlacementContext;
-import org.apache.hadoop.yarn.server.resourcemanager.placement.PlacementManager;
+
+import org.apache.hadoop.yarn.server.resourcemanager.placement
+    .ApplicationPlacementContext;
+  private ApplicationPlacementContext placementContext;
+
-      amReqs, -1);
+      amReqs, null, -1);
-      List<ResourceRequest> amReqs, long startTime) {
+      List<ResourceRequest> amReqs, ApplicationPlacementContext
+      placementContext, long startTime) {
+    this.placementContext = placementContext;
+
-      ApplicationPlacementContext placementContext = null;
-      try {
-        placementContext = placeApplication(app.rmContext,
-            app.submissionContext, app.user);
-      } catch (Exception e) {
-        String msg = "Failed to place application to queue :" + e.getMessage();
-        app.diagnostics.append(msg);
-        LOG.error(msg, e);
-      }
-
-                app.applicationPriority, placementContext));
+                app.applicationPriority, app.placementContext));
-              app.applicationPriority, placementContext));
+              app.applicationPriority, app.placementContext));
-      ApplicationPlacementContext placementContext = null;
-      try {
-        placementContext = placeApplication(app.rmContext,
-            app.submissionContext, app.user);
-        replaceQueueFromPlacementContext(placementContext,
-            app.submissionContext);
-      } catch (YarnException e) {
-        String msg = "Failed to place application to queue :" + e.getMessage();
-        app.diagnostics.append(msg);
-        LOG.error(msg, e);
-      }
-              app.applicationPriority, placementContext));
+              app.applicationPriority, app.placementContext));
+  @Override
+  public ApplicationPlacementContext getApplicationPlacementContext() {
+    return placementContext;
+  }
+
-
-  @VisibleForTesting
-  static ApplicationPlacementContext placeApplication(RMContext rmContext,
-      ApplicationSubmissionContext context, String user) throws YarnException {
-
-    ApplicationPlacementContext placementContext = null;
-    PlacementManager placementManager = rmContext.getQueuePlacementManager();
-
-    if (placementManager != null) {
-      placementContext = placementManager.placeApplication(context, user);
-    } else{
-      LOG.error(
-          "Queue Placement Manager is null. Cannot place application :" + " "
-              + context.getApplicationId() + " to queue ");
-    }
-
-    return placementContext;
-  }
-
-  static void replaceQueueFromPlacementContext(
-      ApplicationPlacementContext placementContext,
-      ApplicationSubmissionContext context) {
-    // Set it to ApplicationSubmissionContext
-    //apply queue mapping only to new application submissions
-    if (placementContext != null && !StringUtils.equals(context.getQueue(),
-        placementContext.getQueue())) {
-      LOG.info("Placed application=" + context.getApplicationId() + " to queue="
-          + placementContext.getQueue() + ", original queue=" + context
-          .getQueue());
-      context.setQueue(placementContext.getQueue());
-    }
-  }
-
