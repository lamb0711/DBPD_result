HDFS-13283. Percentage based Reserved Space Calculation for DataNode. Contributed by Lukas Majercak.

+import com.google.common.annotations.VisibleForTesting;
+import org.apache.hadoop.fs.DF;
+  private DF usage;
+    usage = null;
+  @VisibleForTesting
+  FsVolumeImplBuilder setUsage(DF newUsage) {
+    this.usage = newUsage;
+    return this;
+  }
+
+    if (null == usage) {
+      // set usage unless overridden by unit tests
+      usage = new DF(sd.getCurrentDir().getParentFile(), conf);
+    }
-            new FileIoProvider(null, null), conf);
+            new FileIoProvider(null, null), conf, usage);
