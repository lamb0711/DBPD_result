HDFS-2863. Failures observed if dfs.edits.dir and shared.edits.dir have same directories. Contributed by Bikas Saha.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1240267 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.base.Joiner;
+    Set<URI> uniqueEditsDirs = new HashSet<URI>();
+    uniqueEditsDirs.addAll(editsDirs);
+    if (uniqueEditsDirs.size() != editsDirs.size()) {
+      // clearing and re-initializing editsDirs to preserve Collection semantics
+      // assigning finalEditsDirs to editsDirs would leak Set semantics in the 
+      // return value and cause unexpected results downstream. eg future addAll
+      // calls. Perf is not an issue since these are small lists.
+      editsDirs.clear();
+      editsDirs.addAll(uniqueEditsDirs);
+      LOG.warn("Overlapping entries in " + DFS_NAMENODE_EDITS_DIR_KEY 
+          + " and/or " + DFS_NAMENODE_SHARED_EDITS_DIR_KEY
+          + ". Using the following entries: " + Joiner.on(',').join(editsDirs));
+    }
