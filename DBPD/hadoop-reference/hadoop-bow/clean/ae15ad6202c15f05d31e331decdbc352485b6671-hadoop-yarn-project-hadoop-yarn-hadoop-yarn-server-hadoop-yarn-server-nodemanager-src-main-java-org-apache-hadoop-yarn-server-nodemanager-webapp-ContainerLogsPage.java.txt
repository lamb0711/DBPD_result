YARN-163. Retrieving container log via NM webapp can hang with multibyte characters in log (jlowe via bobby)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1400189 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.FileReader;
+import java.io.FileInputStream;
+import org.apache.commons.io.IOUtils;
+import org.apache.hadoop.yarn.webapp.hamlet.Hamlet;
+import org.apache.hadoop.yarn.webapp.hamlet.Hamlet.PRE;
-          InputStreamReader reader = null;
+          FileInputStream logByteStream = null;
-            reader = new FileReader(logFile);
+            logByteStream = new FileInputStream(logFile);
+            IOUtils.skipFully(logByteStream, start);
+
+            InputStreamReader reader = new InputStreamReader(logByteStream);
-            long skipped = 0;
-            long totalSkipped = 0;
-            while (totalSkipped < start) {
-              skipped = reader.skip(start - totalSkipped);
-              totalSkipped += skipped;
-            }
-
-            writer().write("<pre>");
+            PRE<Hamlet> pre = html.pre();
-              writer().write(cbuf, 0, len); // TODO: HTMl Quoting?
+              pre._(new String(cbuf, 0, len));
+            pre._();
-            writer().write("</pre>");
-            if (reader != null) {
+            if (logByteStream != null) {
-                reader.close();
+                logByteStream.close();
