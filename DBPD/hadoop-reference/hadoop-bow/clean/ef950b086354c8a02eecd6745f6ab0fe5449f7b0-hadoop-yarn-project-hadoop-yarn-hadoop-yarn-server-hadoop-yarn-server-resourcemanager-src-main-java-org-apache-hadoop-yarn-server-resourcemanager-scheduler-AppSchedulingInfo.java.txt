YARN-9290. Invalid SchedulingRequest not rejected in Scheduler PlacementConstraintsHandler. Contributed by Prabhu Joseph

+import java.util.stream.Collectors;
+import org.apache.hadoop.yarn.api.records.RejectionReason;
+import org.apache.hadoop.yarn.api.records.RejectedSchedulingRequest;
+import org.apache.hadoop.yarn.conf.YarnConfiguration;
+  private final int retryAttempts;
+    this.retryAttempts = rmContext.getYarnConfiguration().getInt(
+         YarnConfiguration.RM_PLACEMENT_CONSTRAINTS_RETRY_ATTEMPTS,
+         YarnConfiguration.DEFAULT_RM_PLACEMENT_CONSTRAINTS_RETRY_ATTEMPTS);
+  public List<RejectedSchedulingRequest> getRejectedRequest() {
+    this.readLock.lock();
+    try {
+      return schedulerKeyToAppPlacementAllocator.values().stream()
+          .filter(ap -> ap.getPlacementAttempt() >= retryAttempts)
+          .map(ap -> RejectedSchedulingRequest.newInstance(
+              RejectionReason.COULD_NOT_SCHEDULE_ON_NODE,
+              ap.getSchedulingRequest()))
+          .collect(Collectors.toList());
+    } finally {
+      this.readLock.unlock();
+    }
+  }
+
-      return (ap != null) && ap.precheckNode(schedulerNode,
-          schedulingMode, dcOpt);
+      return (ap != null) && (ap.getPlacementAttempt() < retryAttempts) &&
+          ap.precheckNode(schedulerNode, schedulingMode, dcOpt);
