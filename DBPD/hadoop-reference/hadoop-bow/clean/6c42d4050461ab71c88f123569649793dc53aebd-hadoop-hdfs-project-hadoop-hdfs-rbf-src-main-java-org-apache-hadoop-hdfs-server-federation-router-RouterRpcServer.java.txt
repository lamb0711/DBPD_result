HDFS-14316. RBF: Support unavailable subclusters for mount points with multiple destinations. Contributed by Inigo Goiri.

+import java.net.ConnectException;
+import org.apache.hadoop.ipc.RetriableException;
-        IOException.class);
+        IOException.class,
+        ConnectException.class,
+        RetriableException.class);
-      throw new IOException("No namespace availaible.");
+      throw new IOException("No namespace available.");
+
-  RemoteLocation getCreateLocation(final String src)
+  RemoteLocation getCreateLocation(final String src) throws IOException {
+    final List<RemoteLocation> locations = getLocationsForPath(src, true);
+    return getCreateLocation(src, locations);
+  }
+
+  /**
+   * Get the location to create a file. It checks if the file already existed
+   * in one of the locations.
+   *
+   * @param src Path of the file to check.
+   * @param locations Prefetched locations for the file.
+   * @return The remote location for this file.
+   * @throws IOException If the file has no creation location.
+   */
+  RemoteLocation getCreateLocation(
+      final String src, final List<RemoteLocation> locations)
-    final List<RemoteLocation> locations = getLocationsForPath(src, true);
+   * Check if a path supports failed subclusters.
+   *
+   * @param path Path to check.
+   * @return If a path should support failed subclusters.
+   */
+  boolean isPathFaultTolerant(final String path) {
+    if (subclusterResolver instanceof MountTableResolver) {
+      try {
+        MountTableResolver mountTable = (MountTableResolver) subclusterResolver;
+        MountTable entry = mountTable.getMountPoint(path);
+        if (entry != null) {
+          return entry.isFaultTolerant();
+        }
+      } catch (IOException e) {
+        LOG.error("Cannot get mount point", e);
+      }
+    }
+    return false;
+  }
+
+  /**
