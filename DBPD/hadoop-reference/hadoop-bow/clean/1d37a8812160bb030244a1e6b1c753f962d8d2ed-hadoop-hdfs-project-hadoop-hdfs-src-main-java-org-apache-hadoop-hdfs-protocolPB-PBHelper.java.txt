HDFS-8854. Erasure coding: add ECPolicy to replace schema+cellSize in hadoop-hdfs. Contributed by Walter Su.

+import org.apache.hadoop.hdfs.protocol.ErasureCodingPolicy;
+import org.apache.hadoop.hdfs.protocol.proto.HdfsProtos.ErasureCodingPolicyProto;
-        lb.hasECSchema() ? convertECSchema(lb.getECSchema()) : null,
-        lb.hasStripeCellSize() ? lb.getStripeCellSize() : 0);
+        lb.hasEcPolicy() ? convertErasureCodingPolicy(lb.getEcPolicy()) : null);
-    if (lb.getECSchema() != null) {
-      builder.setECSchema(convertECSchema(lb.getECSchema()));
-    }
-    if (lb.getStripeCellSize() != 0) {
-      builder.setStripeCellSize(lb.getStripeCellSize());
+    if (lb.getErasureCodingPolicy() != null) {
+      builder.setEcPolicy(convertErasureCodingPolicy(lb.getErasureCodingPolicy()));
-        fs.hasEcSchema() ? PBHelper.convertECSchema(fs.getEcSchema()) : null,
-        fs.hasStripeCellSize() ? fs.getStripeCellSize() : 0);
+        fs.hasEcPolicy() ? PBHelper.convertErasureCodingPolicy(fs.getEcPolicy()) : null);
-    if(fs.getECSchema() != null) {
-      builder.setEcSchema(PBHelper.convertECSchema(fs.getECSchema()));
+    if(fs.getErasureCodingPolicy() != null) {
+      builder.setEcPolicy(PBHelper.convertErasureCodingPolicy(fs.getErasureCodingPolicy()));
-    builder.setStripeCellSize(fs.getStripeCellSize());
-    return new ECSchema(schema.getSchemaName(), schema.getCodecName(),
-        schema.getDataUnits(), schema.getParityUnits(), options);
+    return new ECSchema(schema.getCodecName(), schema.getDataUnits(),
+        schema.getParityUnits(), options);
-        .setSchemaName(schema.getSchemaName())
+  public static ErasureCodingPolicy convertErasureCodingPolicy(
+      ErasureCodingPolicyProto policy) {
+    return new ErasureCodingPolicy(policy.getName(),
+        convertECSchema(policy.getSchema()),
+        policy.getCellSize());
+  }
+
+  public static ErasureCodingPolicyProto convertErasureCodingPolicy(
+      ErasureCodingPolicy policy) {
+    ErasureCodingPolicyProto.Builder builder = ErasureCodingPolicyProto
+        .newBuilder()
+        .setName(policy.getName())
+        .setSchema(convertECSchema(policy.getSchema()))
+        .setCellSize(policy.getCellSize());
+    return builder.build();
+  }
+
-        .setSchema(convertECSchema(ecZone.getSchema()))
-        .setCellSize(ecZone.getCellSize()).build();
+        .setEcPolicy(convertErasureCodingPolicy(ecZone.getErasureCodingPolicy()))
+        .build();
-        convertECSchema(ecZoneProto.getSchema()), ecZoneProto.getCellSize());
+        convertErasureCodingPolicy(ecZoneProto.getEcPolicy()));
-    ECSchema ecSchema = convertECSchema(blockEcRecoveryInfoProto.getEcSchema());
-    int cellSize = blockEcRecoveryInfoProto.getCellSize();
+    ErasureCodingPolicy ecPolicy =
+        convertErasureCodingPolicy(blockEcRecoveryInfoProto.getEcPolicy());
-        targetStorageUuids, convertStorageTypes, liveBlkIndices, ecSchema,
-        cellSize);
+        targetStorageUuids, convertStorageTypes, liveBlkIndices, ecPolicy);
-    builder.setEcSchema(convertECSchema(blockEcRecoveryInfo.getECSchema()));
-    builder.setCellSize(blockEcRecoveryInfo.getCellSize());
+    builder.setEcPolicy(convertErasureCodingPolicy(blockEcRecoveryInfo
+        .getErasureCodingPolicy()));
