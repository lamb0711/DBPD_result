HDFS-7095. Archival Storage: TestStorageMover often fails in Jenkins. Contributed by Jing Zhao.

-      targets.put(target);
-      getTargetStorages(target.getStorageType()).add(target);
+      if (target != null) {
+        targets.put(target);
+        getTargetStorages(target.getStorageType()).add(target);
+      }
+        final Source source = dn.addSource(t, Long.MAX_VALUE, dispatcher);
-        if (maxRemaining > 0L) {
-          final Source source = dn.addSource(t, Long.MAX_VALUE, dispatcher); 
-          final StorageGroup target = dn.addTarget(t, maxRemaining);
-          storages.add(source, target);
-        }
+        final StorageGroup target = maxRemaining > 0L ? dn.addTarget(t,
+            maxRemaining) : null;
+        storages.add(source, target);
-      db.addLocation(storages.getTarget(ml));
+      StorageGroup source = storages.getSource(ml);
+      if (source != null) {
+        db.addLocation(source);
+      }
-          if (ml.storageType == t) {
+          if (ml.storageType == t && source != null) {
-      return scheduleMoveReplica(db, storages.getSource(ml), targetTypes);
+      final Source source = storages.getSource(ml);
+      return source == null ? false : scheduleMoveReplica(db,
+          storages.getSource(ml), targetTypes);
