MAPREDUCE-2596. [Gridmix] Summarize Gridmix runs. (amarrk)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1144403 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.tools.rumen.ResourceUsageMetrics;
+  protected int numJobsInTrace = 0;
+  // gets the next job from the trace and does some bookkeeping for the same
+  private JobStory getNextJobFromTrace() throws IOException {
+    JobStory story = jobProducer.getNextJob();
+    if (story != null) {
+      ++numJobsInTrace;
+    }
+    return story;
+  }
+  
-    JobStory job;
-    do {
-      job = jobProducer.getNextJob();
-    } while (job != null &&
+    JobStory job = getNextJobFromTrace();
+    while (job != null &&
-        job.getSubmissionTime() < 0));
+        job.getSubmissionTime() < 0)) {
+      if (LOG.isDebugEnabled()) {
+        String reason = null;
+        if (job.getOutcome() != Pre21JobHistoryConstants.Values.SUCCESS) {
+          reason = "STATE (" + job.getOutcome().name() + ") ";
+        }
+        if (job.getSubmissionTime() < 0) {
+          reason += "SUBMISSION-TIME (" + job.getSubmissionTime() + ")";
+        }
+        LOG.debug("Ignoring job " + job.getJobID() + " from the input trace."
+                  + " Reason: " + reason == null ? "N/A" : reason);
+      }
+      job = getNextJobFromTrace();
+    }
