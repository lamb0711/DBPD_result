HDFS-2507. Allow saveNamespace operations to be canceled. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1190060 13f79535-47bb-0310-9956-ffa450edef68

+    private final SaveNamespaceContext context;
+    
+
+    Saver(SaveNamespaceContext context) {
+      this.context = context;
+    }
-              long txid,
-              FSNamesystem sourceNamesystem,
+      final FSNamesystem sourceNamesystem = context.getSourceNamesystem();
-        out.writeLong(txid);
+        out.writeLong(context.getTxId());
+        context.checkCancelled();
-
+        context.checkCancelled();
+        context.checkCancelled();
-    private static void saveImage(ByteBuffer currentDirName,
+    private void saveImage(ByteBuffer currentDirName,
+      context.checkCancelled();
