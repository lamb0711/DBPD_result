YARN-7454. RMAppAttemptMetrics#getAggregateResourceUsage can NPE due to double lookup. Contributed by Jason Lowe.

-      RMAppAttempt currentAttempt = rmContext.getRMApps().get(attemptId.getApplicationId()).getCurrentAppAttempt();
-      if (currentAttempt.getAppAttemptId().equals(attemptId)) {
+      RMAppAttempt currentAttempt = rmApp.getCurrentAppAttempt();
+      if (currentAttempt != null
+          && currentAttempt.getAppAttemptId().equals(attemptId)) {
-            if (resourcesUsed.containsKey(entry.getKey())) {
-              Long value = resourcesUsed.get(entry.getKey());
+            Long value = resourcesUsed.get(entry.getKey());
+            if (value != null) {
-              resourcesUsed.put(entry.getKey(), value);
-            } else{
-              resourcesUsed.put(entry.getKey(), entry.getValue());
+            } else {
+              value = entry.getValue();
+            resourcesUsed.put(entry.getKey(), value);
