HDFS-11843. Ozone: XceiverClientRatis should implement XceiverClientSpi.connect().

+import java.util.Objects;
+import java.util.concurrent.atomic.AtomicReference;
-  private final RaftClient client;
+  private final RpcType rpcType;
+  private final AtomicReference<RaftClient> client = new AtomicReference<>();
-  XceiverClientRatis(Pipeline pipeline, RpcType rpcType) {
+  private XceiverClientRatis(Pipeline pipeline, RpcType rpcType) {
+    this.rpcType = rpcType;
+  }
+
+  static RaftClient newRaftClient(Pipeline pipeline, RpcType rpcType) {
-    client = RaftClient.newBuilder()
+    return RaftClient.newBuilder()
-    // do nothing.
+    if (!client.compareAndSet(null, newRaftClient(pipeline, rpcType))) {
+      throw new IllegalStateException("Client is already connected.");
+    }
-    try {
-      client.close();
-    } catch (IOException e) {
-      throw new IllegalStateException(e);
+    final RaftClient c = client.getAndSet(null);
+    if (c != null) {
+      try {
+        c.close();
+      } catch (IOException e) {
+        throw new IllegalStateException(e);
+      }
+  private RaftClient getClient() {
+    return Objects.requireNonNull(client.get(), "client is null");
+  }
+
-    final RaftClientReply reply = client.send(
+    final RaftClientReply reply = getClient().send(
