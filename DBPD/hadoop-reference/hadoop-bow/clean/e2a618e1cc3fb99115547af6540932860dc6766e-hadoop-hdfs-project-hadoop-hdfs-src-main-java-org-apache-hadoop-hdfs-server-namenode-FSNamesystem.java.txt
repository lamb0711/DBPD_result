HDFS-4523. Fix INodeFile replacement, TestQuota and javac errors from trunk merge.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1450477 13f79535-47bb-0310-9956-ffa450edef68

-      if(repl != srcInode.getFileReplication()) {
+      if(repl != srcInode.getBlockReplication()) {
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(path);
+      checkOwner(pc, path);
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(path);
+      checkOwner(pc, path);
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(snapshotRoot);
+      checkOwner(pc, snapshotRoot);
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(path);
+      checkOwner(pc, path);
-      status = snapshotManager
-          .getSnapshottableDirListing(checker.isSuper ? null : checker.user);
+      final String user = checker.isSuperUser()? null : checker.getUser();
+      status = snapshotManager.getSnapshottableDirListing(user);
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(snapshotRoot);
+      checkOwner(pc, snapshotRoot);
