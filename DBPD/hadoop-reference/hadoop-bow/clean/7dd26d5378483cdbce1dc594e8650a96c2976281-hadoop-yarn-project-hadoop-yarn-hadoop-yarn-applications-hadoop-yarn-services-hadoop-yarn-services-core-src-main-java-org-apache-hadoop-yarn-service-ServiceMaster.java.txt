YARN-8308.  Fixed YARN Service AM failure with HDFS token renewal.
            Contributed by Gour Saha

+  public static final String SERVICE_NAME_OPTION = "service_name";
+  public static final String KEYTAB_OPTION = "keytab";
+  public static final String PRINCIPAL_NAME_OPTION = "principal_name";
-  private static String serviceDefPath;
+  private String serviceDefPath;
+  private String serviceName;
+  private String serviceKeytab;
+  private String servicePrincipalName;
-    SliderFileSystem fs = new SliderFileSystem(conf);
-    context.fs = fs;
-    fs.setAppDir(appDir);
-    loadApplicationJson(context, fs);
-
+    Credentials credentials = null;
+      credentials = UserGroupInformation.getCurrentUser().getCredentials();
+    SliderFileSystem fs = new SliderFileSystem(conf);
+    fs.setAppDir(appDir);
+    context.fs = fs;
+    loadApplicationJson(context, fs);
+    if (UserGroupInformation.isSecurityEnabled()) {
+      // add back the credentials
+      if (credentials != null) {
+        UserGroupInformation.getCurrentUser().addCredentials(credentials);
+      }
+      removeHdfsDelegationToken(UserGroupInformation.getLoginUser());
+    }
+
-    File keytab = new File(String.format(KEYTAB_LOCATION,
-        context.service.getName()));
+    File keytab = new File(String.format(KEYTAB_LOCATION, getServiceName()));
-      String preInstalledKeytab = context.service.getKerberosPrincipal()
-          .getKeytab();
+      String preInstalledKeytab = context.service == null ? this.serviceKeytab
+          : context.service.getKerberosPrincipal().getKeytab();
-    String principal = context.service.getKerberosPrincipal()
-        .getPrincipalName();
+    String principal = context.service == null ? this.servicePrincipalName
+        : context.service.getKerberosPrincipal().getPrincipalName();
-    Credentials credentials = UserGroupInformation.getCurrentUser()
-        .getCredentials();
-    // add back the credentials
-    UserGroupInformation.getCurrentUser().addCredentials(credentials);
-    removeHdfsDelegationToken(UserGroupInformation.getLoginUser());
+  protected String getServiceName() {
+    return serviceName;
+  }
+
+      opts.addOption(SERVICE_NAME_OPTION, true, "Service name");
+      opts.getOption(SERVICE_NAME_OPTION).setRequired(true);
+      opts.addOption(KEYTAB_OPTION, true, "Service AM keytab");
+      opts.addOption(PRINCIPAL_NAME_OPTION, true,
+          "Service AM keytab principal");
+      serviceMaster.serviceName = cmdLine.getOptionValue(SERVICE_NAME_OPTION);
+      serviceMaster.serviceKeytab = cmdLine.getOptionValue(KEYTAB_OPTION);
+      serviceMaster.servicePrincipalName = cmdLine
+          .getOptionValue(PRINCIPAL_NAME_OPTION);
