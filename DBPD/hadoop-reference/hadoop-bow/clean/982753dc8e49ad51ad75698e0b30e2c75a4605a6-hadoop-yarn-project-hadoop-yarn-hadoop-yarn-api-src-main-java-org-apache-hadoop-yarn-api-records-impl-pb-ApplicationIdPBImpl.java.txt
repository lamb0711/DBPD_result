YARN-716. Making ApplicationID immutable. Contributed by Siddharth Seth.
MAPREDUCE-5282. Updating MR App to use immutable ApplicationID after YARN-716. Contributed by Siddharth Seth.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1487994 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.yarn.proto.YarnProtos.ApplicationIdProtoOrBuilder;
+
+import com.google.common.base.Preconditions;
-    
-  ApplicationIdProto proto = ApplicationIdProto.getDefaultInstance();
+  ApplicationIdProto proto = null;
-  boolean viaProto = false;
-  
+
-    viaProto = true;
-  public synchronized ApplicationIdProto getProto() {
-    proto = viaProto ? proto : builder.build();
-    viaProto = true;
+  public ApplicationIdProto getProto() {
-  private synchronized void maybeInitBuilder() {
-    if (viaProto || builder == null) {
-      builder = ApplicationIdProto.newBuilder(proto);
-    }
-    viaProto = false;
-  }
-    
-  
-  public synchronized int getId() {
-    ApplicationIdProtoOrBuilder p = viaProto ? proto : builder;
-    return (p.getId());
+  public int getId() {
+    Preconditions.checkNotNull(proto);
+    return proto.getId();
-  public synchronized void setId(int id) {
-    maybeInitBuilder();
-    builder.setId((id));
+  protected void setId(int id) {
+    builder.setId(id);
-  public synchronized long getClusterTimestamp() {
-    ApplicationIdProtoOrBuilder p = viaProto ? proto : builder;
-    return (p.getClusterTimestamp());
+  public long getClusterTimestamp() {
+    Preconditions.checkNotNull(proto);
+    return proto.getClusterTimestamp();
-  public synchronized void setClusterTimestamp(long clusterTimestamp) {
-    maybeInitBuilder();
+  protected void setClusterTimestamp(long clusterTimestamp) {
+
+  @Override
+  protected void build() {
+    proto = builder.build();
+  }
