YARN-7363. ContainerLocalizer don't have a valid log4j config in case of Linux container executor. (Contributed by Yufei Gu)

+import org.apache.hadoop.yarn.exceptions.YarnRuntimeException;
+import org.apache.hadoop.yarn.api.ApplicationConstants;
-      InetSocketAddress nmAddr, List<String> localDirs) {
-    
+      InetSocketAddress nmAddr, List<String> localDirs, Configuration conf) {
+
+    String logLevel = conf.get(YarnConfiguration.
+            NM_CONTAINER_LOCALIZER_LOG_LEVEL,
+        YarnConfiguration.NM_CONTAINER_LOCALIZER_LOG_LEVEL_DEFAULT);
+    addLog4jSystemProperties(logLevel, command);
+  private static void addLog4jSystemProperties(
+      String logLevel, List<String> command) {
+    command.add("-Dlog4j.configuration=container-log4j.properties");
+    command.add("-D" + YarnConfiguration.YARN_APP_CONTAINER_LOG_DIR + "=" +
+        ApplicationConstants.LOG_DIR_EXPANSION_VAR);
+    command.add("-D" + YarnConfiguration.YARN_APP_CONTAINER_LOG_SIZE + "=0");
+    command.add("-Dhadoop.root.logger=" + logLevel + ",CLA");
+    command.add("-Dhadoop.root.logfile=container-localizer-syslog");
+  }
+
+      createLogDir();
+  /**
+   * Create the log directory, if the directory exists, make sure its permission
+   * is 750.
+   */
+  private static void createLogDir() {
+    FileContext localFs;
+    try {
+      localFs = FileContext.getLocalFSFileContext(new Configuration());
+
+      String logDir = System.getProperty(
+          YarnConfiguration.YARN_APP_CONTAINER_LOG_DIR);
+
+      if (logDir != null && !logDir.trim().isEmpty()) {
+        Path containerLogPath = new Path(logDir);
+        FsPermission containerLogDirPerm= new FsPermission((short)0750);
+        localFs.mkdir(containerLogPath, containerLogDirPerm, true);
+        // set permission again to make sure the permission is correct
+        // in case the directory is already there.
+        localFs.setPermission(containerLogPath, containerLogDirPerm);
+      }
+    } catch (IOException e) {
+      throw new YarnRuntimeException("Unable to create the log dir", e);
+    }
+  }
+
