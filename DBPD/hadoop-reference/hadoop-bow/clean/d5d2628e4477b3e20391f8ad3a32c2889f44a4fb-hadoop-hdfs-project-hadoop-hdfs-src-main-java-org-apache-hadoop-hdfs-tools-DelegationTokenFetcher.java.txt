Merge r1360400 through r1399945 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1399950 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.hdfs.DFSConfigKeys;
-import org.apache.hadoop.hdfs.web.URLUtils;
-import org.apache.hadoop.io.Text;
+  private static final String HELP = "help";
+  private static final String HELP_SHORT = "h";
-  private static void printUsage(PrintStream err) throws IOException {
+  private static void printUsage(PrintStream err) {
+    fetcherOptions.addOption(HELP_SHORT, HELP, false, "print out help information");
+    final boolean help = cmd.hasOption(HELP);
+    if (help) {
+      printUsage(System.out);
+      System.exit(0);
+    }
-                Token<?> token = fs.getDelegationToken(renewer);
-                cred.addToken(token.getService(), token);
+                Token<?> tokens[] = fs.addDelegationTokens(renewer, cred);
-                  LOG.debug("Fetched token for " + token.getService()
-                      + " into " + tokenFile);
+                  for (Token<?> token : tokens) {
+                    LOG.debug("Fetched token for " + token.getService()
+                        + " into " + tokenFile);
+                  }
-      connection = (HttpURLConnection)URLUtils.openConnection(url);
