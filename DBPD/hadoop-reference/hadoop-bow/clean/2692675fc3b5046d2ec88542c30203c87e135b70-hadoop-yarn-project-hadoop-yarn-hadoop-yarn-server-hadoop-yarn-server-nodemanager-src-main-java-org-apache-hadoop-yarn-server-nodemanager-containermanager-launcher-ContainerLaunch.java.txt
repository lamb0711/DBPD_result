YARN-684. ContainerManager.startContainer should use ContainerTokenIdentifier instead of the entire Container. Contributed by Vinod Kumar Vavilapalli.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1488085 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.IOException;
+import java.io.IOException;
-import org.apache.hadoop.yarn.security.ContainerTokenIdentifier;
-import org.apache.hadoop.yarn.server.nodemanager.LocalDirsHandlerService;
+import org.apache.hadoop.yarn.server.nodemanager.Context;
+import org.apache.hadoop.yarn.server.nodemanager.LocalDirsHandlerService;
-import org.apache.hadoop.yarn.util.BuilderUtils;
+  private final Context context;
-  public ContainerLaunch(Configuration configuration, Dispatcher dispatcher,
-      ContainerExecutor exec, Application app, Container container,
-      LocalDirsHandlerService dirsHandler) {
+  public ContainerLaunch(Context context, Configuration configuration,
+      Dispatcher dispatcher, ContainerExecutor exec, Application app,
+      Container container, LocalDirsHandlerService dirsHandler) {
+    this.context = context;
-    ContainerId containerID = container.getContainer().getId();
+    ContainerId containerID = container.getContainerId();
-    ContainerId containerId = container.getContainer().getId();
+    ContainerId containerId = container.getContainerId();
-        ConverterUtils.toString(container.getContainer().getId());
+        ConverterUtils.toString(container.getContainerId());
-        .getContainer().getId().toString());
+        .getContainerId().toString());
-        String.valueOf(container.getContainer().getNodeId().getPort()));
+      String.valueOf(this.context.getNodeId().getPort()));
-    environment.put(Environment.NM_HOST.name(), container.getContainer()
-        .getNodeId().getHost());
+    environment.put(Environment.NM_HOST.name(), this.context.getNodeId()
+      .getHost());
-    environment.put(Environment.NM_HTTP_PORT.name(), container.getContainer()
-        .getNodeHttpAddress().split(":")[1]);
+    environment.put(Environment.NM_HTTP_PORT.name(),
+      String.valueOf(this.context.getHttpPort()));
