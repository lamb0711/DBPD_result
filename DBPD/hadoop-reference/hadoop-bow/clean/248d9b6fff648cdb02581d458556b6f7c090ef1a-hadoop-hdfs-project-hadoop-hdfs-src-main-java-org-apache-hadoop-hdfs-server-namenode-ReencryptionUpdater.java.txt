HDFS-12518. Re-encryption should handle task cancellation and progress better.

+    void reset() {
+      submissionDone = false;
+      tasks.clear();
+      numCheckpointed = 0;
+      numFutureDone = 0;
+    }
+
-    if (tracker != null) {
+    if (tracker != null && !tracker.getTasks().isEmpty()) {
-      handler.addDummyTracker(zoneId);
+      handler.addDummyTracker(zoneId, tracker);
+      final int batchSize = task.batch.size();
-              + " starting:{}.", task.numFilesUpdated, task.batch.size(),
+              + " starting:{}.", task.numFilesUpdated, batchSize,
+      if (curr.isCancelled()) {
+        break;
+      }
-    ReencryptionTask task = completed.get();
-      LOG.debug("Skipped canceled re-encryption task for zone {}, last: {}",
-          task.zoneId, task.lastFile);
+      // Ignore canceled zones. The cancellation is edit-logged by the handler.
+      LOG.debug("Skipped a canceled re-encryption task");
+    final ReencryptionTask task = completed.get();
-      Preconditions.checkNotNull(tracker, "zone tracker not found " + zonePath);
+      if (tracker == null) {
+        // re-encryption canceled.
+        LOG.info("Re-encryption was canceled.");
+        return;
+      }
