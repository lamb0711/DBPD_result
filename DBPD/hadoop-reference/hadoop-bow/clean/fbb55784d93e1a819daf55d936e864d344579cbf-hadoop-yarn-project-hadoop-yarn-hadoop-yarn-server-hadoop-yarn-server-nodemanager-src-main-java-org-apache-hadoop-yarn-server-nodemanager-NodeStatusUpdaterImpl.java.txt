YARN-562. Modified NM to reject any containers allocated by a previous ResourceManager. Contributed by Jian He.
MAPREDUCE-5167. Update MR App after YARN-562 to use the new builder API for the container. Contributed by Jian He.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1476034 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.server.api.ResourceManagerConstants;
+import org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl;
+  private long rmIdentifier = ResourceManagerConstants.RM_INVALID_IDENTIFIER;
+        this.rmIdentifier = regNMResponse.getRMIdentifier();
-
+    LOG.info("Notifying ContainerManager to unblock new container-requests");
+    ((ContainerManagerImpl) this.context.getContainerManager())
+      .setBlockNewContainerRequests(false);
+  @Override
+  @Override
+  public long getRMIdentifier() {
+    return this.rmIdentifier;
+  }
+
+              // Invalidate the RMIdentifier while resync
+              NodeStatusUpdaterImpl.this.rmIdentifier =
+                  ResourceManagerConstants.RM_INVALID_IDENTIFIER;
