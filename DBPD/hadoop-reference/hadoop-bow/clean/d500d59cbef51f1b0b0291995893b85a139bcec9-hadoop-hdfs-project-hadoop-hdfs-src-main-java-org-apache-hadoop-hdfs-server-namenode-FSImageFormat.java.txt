Merging trunk to HDFS-2802 branch.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1416603 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.namenode.INodeDirectory.INodesInPath;
-    fsDir.rootDir.setModificationTime(root.getModificationTime());
+    fsDir.rootDir.cloneModificationTime(root);
-    if (!parent.addChild(child, false)) {
+    if (!parent.addChild(child, false, null)) {
-        INodeFile oldnode = INodeFile.valueOf(fsDir.getINode(path), path);
-        fsDir.replaceNode(path, oldnode, cons);
+        final INodesInPath inodesInPath = fsDir.getINodesInPath(path);
+        INodeFile oldnode = INodeFile.valueOf(inodesInPath.getINode(0), path);
+        fsDir.replaceNode(path, oldnode, cons, inodesInPath.getLatestSnapshot());
