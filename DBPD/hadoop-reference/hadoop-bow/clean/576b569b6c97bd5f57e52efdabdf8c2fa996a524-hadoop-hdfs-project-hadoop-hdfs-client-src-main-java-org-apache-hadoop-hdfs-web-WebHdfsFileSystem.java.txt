Revert "HDFS-9525. hadoop utilities need to support provided delegation tokens (HeeSoo Kim via aw)"

This reverts commit 832b3cbde1c2f77b04c93188e3a94420974090cf.

-    if (delegationToken == null) {
+    if (canRefreshDelegationToken && delegationToken == null) {
-        if (canRefreshDelegationToken) {
-          token = getDelegationToken(null);
-          if (token != null) {
-            LOG.debug("Fetched new token: {}", token);
-          } else { // security is disabled
-            canRefreshDelegationToken = false;
-          }
+        token = getDelegationToken(null);
+        if (token != null) {
+          LOG.debug("Fetched new token: {}", token);
+        } else { // security is disabled
+          canRefreshDelegationToken = false;
-      this.delegationToken = null;
-      FileStatus[] decodeResponse(Map<?, ?> json) {
+      FileStatus[] decodeResponse(Map<?,?> json) {
-  public synchronized Token<DelegationTokenIdentifier> getDelegationToken(
+  public Token<DelegationTokenIdentifier> getDelegationToken(
-    Token<DelegationTokenIdentifier> token = null;
-
-    if (delegationToken == null) {
-      token =
-          new FsPathResponseRunner<Token<DelegationTokenIdentifier>>(
-              op, null, new RenewerParam(renewer)) {
+    Token<DelegationTokenIdentifier> token =
+        new FsPathResponseRunner<Token<DelegationTokenIdentifier>>(
+            op, null, new RenewerParam(renewer)) {
-          Token<DelegationTokenIdentifier> decodeResponse(Map<?, ?> json)
+          Token<DelegationTokenIdentifier> decodeResponse(Map<?,?> json)
-    } else {
-      token =
-          new FsPathResponseRunner<Token<DelegationTokenIdentifier>>(
-              op, null, new RenewerParam(renewer),
-              new DelegationParam(delegationToken.encodeToUrlString())) {
-          @Override
-          Token<DelegationTokenIdentifier> decodeResponse(Map<?, ?> json)
-              throws IOException {
-            return JsonUtilClient.toDelegationToken(json);
-          }
-        }.run();
-    }
-
-
-    if (delegationToken == null) {
-      return new FsPathResponseRunner<Long>(op, null,
-          new TokenArgumentParam(token.encodeToUrlString())) {
-        @Override
-        Long decodeResponse(Map<?, ?> json) throws IOException {
-          return ((Number) json.get("long")).longValue();
-        }
-      }.run();
-    } else {
-      return new FsPathResponseRunner<Long>(op, null,
-          new TokenArgumentParam(token.encodeToUrlString()),
-          new DelegationParam(delegationToken.encodeToUrlString())) {
-        @Override
-        Long decodeResponse(Map<?, ?> json) throws IOException {
-          return ((Number) json.get("long")).longValue();
-        }
-      }.run();
-    }
-
+    return new FsPathResponseRunner<Long>(op, null,
+        new TokenArgumentParam(token.encodeToUrlString())) {
+      @Override
+      Long decodeResponse(Map<?,?> json) throws IOException {
+        return ((Number) json.get("long")).longValue();
+      }
+    }.run();
