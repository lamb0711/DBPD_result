HDFS-6830. Revert accidental checkin

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1616884 13f79535-47bb-0310-9956-ffa450edef68

+    boolean added = true;
+    int idx = findDatanode(storage.getDatanodeDescriptor());
+    if(idx >= 0) {
+      if (getStorageInfo(idx) == storage) { // the storage is already there
+        return false;
+      } else {
+        // The block is on the DN but belongs to a different storage.
+        // Update our state.
+        removeStorage(getStorageInfo(idx));
+        added = false;      // Just updating storage. Return false.
+      }
+    }
-    return true;
+    return added;
-  boolean findDatanode(DatanodeDescriptor dn) {
+  int findDatanode(DatanodeDescriptor dn) {
-      if(cur == dn) {
-        return true;
-      }
-      if(cur == null) {
+      if(cur == dn)
+        return idx;
+      if(cur == null)
-      }
-    return false;
+    return -1;
