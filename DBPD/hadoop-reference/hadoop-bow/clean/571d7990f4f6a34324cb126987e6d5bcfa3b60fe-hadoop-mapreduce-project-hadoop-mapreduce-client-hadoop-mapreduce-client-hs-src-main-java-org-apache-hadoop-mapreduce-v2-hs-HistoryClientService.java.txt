Merge trunk into HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1196458 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.avro.ipc.Server;
+import org.apache.hadoop.ipc.Server;
+import org.apache.hadoop.fs.CommonConfigurationKeysPublic;
+import org.apache.hadoop.mapreduce.v2.app.security.authorize.MRAMPolicyProvider;
-import org.apache.hadoop.mapreduce.v2.security.client.ClientHSSecurityInfo;
-import org.apache.hadoop.security.SecurityInfo;
-import org.apache.hadoop.yarn.conf.YarnConfiguration;
-    InetSocketAddress address = NetUtils.createSocketAddr(serviceAddr);
+    InetSocketAddress address = NetUtils.createSocketAddr(serviceAddr,
+      JHAdminConfig.DEFAULT_MR_HISTORY_PORT,
+      JHAdminConfig.DEFAULT_MR_HISTORY_ADDRESS);
+    
+    // Enable service authorization?
+    if (conf.getBoolean(
+        CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHORIZATION, 
+        false)) {
+      server.refreshServiceAcl(conf, new MRAMPolicyProvider());
+    }
+    
-    WebApps.$for("jobhistory", this).at(bindAddress).start(webApp); 
+    WebApps.$for("jobhistory", this).with(conf).at(bindAddress).start(webApp); 
-      server.close();
+      server.stop();
