HDFS-7833. DataNode reconfiguration does not recalculate valid volumes required, based on configured failed volumes tolerated. Contributed by Lei (Eddy) Xu.

-  private final int validVolsRequired;
+  private final int volFailuresTolerated;
-    final int volFailuresTolerated =
+    volFailuresTolerated =
-    this.validVolsRequired = volsConfigured - volFailuresTolerated;
-    return volumes.getVolumes().size() >= validVolsRequired;
+    return getNumFailedVolumes() <= volFailuresTolerated;
