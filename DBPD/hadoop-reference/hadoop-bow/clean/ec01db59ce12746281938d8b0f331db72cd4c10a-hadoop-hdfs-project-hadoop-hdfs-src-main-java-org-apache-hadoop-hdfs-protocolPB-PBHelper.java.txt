HDFS-5417. Fix storage IDs in PBHelper and UpgradeUtilities.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1535791 13f79535-47bb-0310-9956-ffa450edef68

-    builder.addAllStorageIDs(Arrays.asList(b.getStorageIDs()));
+    final String[] storageIDs = b.getStorageIDs();
+    if (storageIDs != null) {
+      builder.addAllStorageIDs(Arrays.asList(b.getStorageIDs()));
+    }
+    final int storageIDsCount = proto.getStorageIDsCount();
+    final String[] storageIDs = storageIDsCount == 0? null
+        : proto.getStorageIDsList().toArray(new String[storageIDsCount]);
-        proto.getStorageIDsList().toArray(new String[proto.getStorageIDsCount()]),
-        storageTypes, proto.getOffset(), proto.getCorrupt());
+        storageIDs, storageTypes, proto.getOffset(), proto.getCorrupt());
