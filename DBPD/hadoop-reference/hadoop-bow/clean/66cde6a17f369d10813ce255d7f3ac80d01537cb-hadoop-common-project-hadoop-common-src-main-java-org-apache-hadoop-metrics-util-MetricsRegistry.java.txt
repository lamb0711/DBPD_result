HADOOP-10337 ConcurrentModificationException from MetricsDynamicMBeanBase.createMBeanInfo() (Liang Xie via stack)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1576187 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.HashMap;
-import java.util.Map;
+import java.util.concurrent.ConcurrentHashMap;
-  private Map<String, MetricsBase> metricsList = new HashMap<String, MetricsBase>();
+  private ConcurrentHashMap<String, MetricsBase> metricsList =
+      new ConcurrentHashMap<String, MetricsBase>();
-  public synchronized void add(final String metricsName, final MetricsBase theMetricsObj) {
-    if (metricsList.containsKey(metricsName)) {
-      throw new IllegalArgumentException("Duplicate metricsName:" + metricsName);
+  public void add(final String metricsName, final MetricsBase theMetricsObj) {
+    if (metricsList.putIfAbsent(metricsName, theMetricsObj) != null) {
+      throw new IllegalArgumentException("Duplicate metricsName:" +
+          metricsName);
-    metricsList.put(metricsName, theMetricsObj);
-  public synchronized MetricsBase get(final String metricsName) {
+  public MetricsBase get(final String metricsName) {
-  public synchronized Collection<String> getKeyList() {
+  public Collection<String> getKeyList() {
-  public synchronized Collection<MetricsBase> getMetricsList() {
+  public Collection<MetricsBase> getMetricsList() {
