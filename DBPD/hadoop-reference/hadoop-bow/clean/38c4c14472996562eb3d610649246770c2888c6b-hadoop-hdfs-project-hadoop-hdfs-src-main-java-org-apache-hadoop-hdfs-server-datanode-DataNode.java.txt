HDFS-9574. Reduce client failures during datanode restart. Contributed by Kihwal Lee.

+    DataNodeFaultInjector.get().noRegistration();
-    checkBlockToken(blk, token, BlockTokenIdentifier.AccessMode.READ);
+    // Make sure this node has registered for the block pool.
+    try {
+      getDNRegistrationForBP(block.getBlockPoolId());
+    } catch (IOException e) {
+      // if it has not registered with the NN, throw an exception back.
+      throw new org.apache.hadoop.ipc.RetriableException(
+          "Datanode not registered. Try again later.");
+    }
+
