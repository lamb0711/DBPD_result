HADOOP-8784. Improve IPC.Client's token use (daryn)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1397634 13f79535-47bb-0310-9956-ffa450edef68

-    private boolean useSasl;
-      this.useSasl = UserGroupInformation.isSecurityEnabled();
-      if (useSasl && protocol != null) {
+      if (protocol != null) {
-      if (!useSasl) {
-        authMethod = AuthMethod.SIMPLE;
-      } else if (token != null) {
+      if (token != null) {
-      } else {
+      } else if (UserGroupInformation.isSecurityEnabled()) {
+      } else {
+        authMethod = AuthMethod.SIMPLE;
-          if (useSasl) {
+          if (authMethod != AuthMethod.SIMPLE) {
-            if (authMethod == AuthMethod.KERBEROS) {
-              if (ticket.getRealUser() != null) {
-                ticket = ticket.getRealUser();
-              }
+            if (ticket.getRealUser() != null) {
+              ticket = ticket.getRealUser();
-              useSasl = false;
-        return call.rpcResponse;
+        return call.getRpcResult();
