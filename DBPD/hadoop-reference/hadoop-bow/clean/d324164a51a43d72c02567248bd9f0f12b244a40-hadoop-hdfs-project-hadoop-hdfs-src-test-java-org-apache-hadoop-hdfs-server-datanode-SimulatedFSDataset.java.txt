HDFS-7435. PB encoding of block reports is very inefficient. Contributed by Daryn Sharp.

-import org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsVolumeImpl;
-      return null;
+      return finalized ? ReplicaState.FINALIZED : ReplicaState.RBW;
-      Iterable<Block> injectBlocks) throws IOException {
+      Iterable<? extends Block> injectBlocks) throws IOException {
-    final List<Replica> blocks = new ArrayList<Replica>();
+    BlockListAsLongs.Builder report = BlockListAsLongs.builder();
-          blocks.add(b);
+          report.add(b);
-    return new BlockListAsLongs(blocks, null);
+    return report.build();
