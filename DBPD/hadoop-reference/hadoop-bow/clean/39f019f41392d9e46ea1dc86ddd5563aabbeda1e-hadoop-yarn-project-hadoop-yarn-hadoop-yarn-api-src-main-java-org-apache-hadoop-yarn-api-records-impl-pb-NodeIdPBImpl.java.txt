YARN-735. Make ApplicationAttemptId, ContainerId and NodeId immutable. Contributed by Jian He.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1488439 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.yarn.proto.YarnProtos.NodeIdProtoOrBuilder;
+
+import com.google.common.base.Preconditions;
-  NodeIdProto proto = NodeIdProto.getDefaultInstance();
+  NodeIdProto proto = null;
-  boolean viaProto = false;
-    viaProto = true;
-  
-  public synchronized NodeIdProto getProto() {
-    proto = viaProto ? proto : builder.build();
-    viaProto = true;
+
+  public NodeIdProto getProto() {
-  private synchronized void maybeInitBuilder() {
-    if (viaProto || builder == null) {
-      builder = NodeIdProto.newBuilder(proto);
-    }
-    viaProto = false;
-  }
-    
-  public synchronized String getHost() {
-    NodeIdProtoOrBuilder p = viaProto ? proto : builder;
-    return (p.getHost());
+  public String getHost() {
+    Preconditions.checkNotNull(proto);
+    return proto.getHost();
-  public synchronized void setHost(String host) {
-    maybeInitBuilder();
-    builder.setHost((host));
+  protected void setHost(String host) {
+    Preconditions.checkNotNull(builder);
+    builder.setHost(host);
-  public synchronized int getPort() {
-    NodeIdProtoOrBuilder p = viaProto ? proto : builder;
-    return (p.getPort());
+  public int getPort() {
+    Preconditions.checkNotNull(proto);
+    return proto.getPort();
-  public synchronized void setPort(int port) {
-    maybeInitBuilder();
-    builder.setPort((port));
+  protected void setPort(int port) {
+    Preconditions.checkNotNull(builder);
+    builder.setPort(port);
+  }
+
+  @Override
+  protected void build() {
+    proto = builder.build();
+    builder = null;
