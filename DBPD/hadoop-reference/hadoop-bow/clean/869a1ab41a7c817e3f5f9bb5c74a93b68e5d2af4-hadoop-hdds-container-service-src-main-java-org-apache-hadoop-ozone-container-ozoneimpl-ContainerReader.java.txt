HDDS-1535. Space tracking for Open Containers : Handle Node Startup. Contributed by Supratim Deka

+import org.apache.hadoop.ozone.container.common.helpers.BlockData;
+import org.apache.hadoop.ozone.container.common.helpers.ChunkInfo;
+import org.apache.hadoop.ozone.container.keyvalue.KeyValueBlockIterator;
+import java.util.List;
+        if (kvContainer.getContainerState()
+            == ContainerProtos.ContainerDataProto.State.OPEN) {
+          // commitSpace for Open Containers relies on usedBytes
+          initializeUsedBytes(kvContainer);
+        }
+
+  private void initializeUsedBytes(KeyValueContainer container) throws IOException {
+    KeyValueBlockIterator blockIter = new KeyValueBlockIterator(
+        container.getContainerData().getContainerID(),
+        new File(container.getContainerData().getContainerPath()));
+    long usedBytes = 0;
+
+    while (blockIter.hasNext()) {
+      BlockData block = blockIter.nextBlock();
+      long blockLen = 0;
+
+      List<ContainerProtos.ChunkInfo> chunkInfoList = block.getChunks();
+      for (ContainerProtos.ChunkInfo chunk : chunkInfoList) {
+        ChunkInfo info = ChunkInfo.getFromProtoBuf(chunk);
+        blockLen += info.getLen();
+      }
+
+      usedBytes += blockLen;
+    }
+
+    container.getContainerData().setBytesUsed(usedBytes);
+  }
