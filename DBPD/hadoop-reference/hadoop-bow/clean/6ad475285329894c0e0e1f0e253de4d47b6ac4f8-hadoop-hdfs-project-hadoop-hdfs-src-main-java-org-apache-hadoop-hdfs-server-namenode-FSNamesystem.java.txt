Merge r1414455 through r1415803 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1415809 13f79535-47bb-0310-9956-ffa450edef68

+   * @param lastBlockLength The length of the last block 
+   *                        under construction reported from client.
-  void fsync(String src, String clientName) 
+  void fsync(String src, String clientName, long lastBlockLength) 
+      if (lastBlockLength > 0) {
+        pendingFile.updateLengthOfLastBlock(lastBlockLength);
+      }
