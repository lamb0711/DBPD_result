YARN-6314. Potential infinite redirection on YARN log redirection web service. Contributed by Xuan Gong.

(cherry picked from commit 5a9dda796f0e73060ada794ad5752cc6a237ab2e)

+import javax.ws.rs.DefaultValue;
+   * @param redirected_from_node
+   *    Whether this is a redirected request from NM
-      @QueryParam(YarnWebServiceParams.NM_ID) String nmId) {
+      @QueryParam(YarnWebServiceParams.NM_ID) String nmId,
+      @QueryParam(YarnWebServiceParams.REDIRECTED_FROM_NODE)
+      @DefaultValue("false") boolean redirected_from_node) {
+
-        if (nodeHttpAddress == null || nodeHttpAddress.isEmpty()) {
+        if (nodeHttpAddress == null || nodeHttpAddress.isEmpty()
+            || redirected_from_node) {
+          // If this is the redirect request from NM, we should not
+          // re-direct the request back. Simply output the aggregated log meta.
+   * @param redirected_from_node
+   *    Whether this is the redirect request from NM
-      @QueryParam(YarnWebServiceParams.NM_ID) String nmId) {
+      @QueryParam(YarnWebServiceParams.NM_ID) String nmId,
+      @QueryParam(YarnWebServiceParams.REDIRECTED_FROM_NODE)
+      boolean redirected_from_node) {
-        size, nmId);
+        size, nmId, redirected_from_node);
-      @QueryParam(YarnWebServiceParams.NM_ID) String nmId) {
+      @QueryParam(YarnWebServiceParams.NM_ID) String nmId,
+      @QueryParam(YarnWebServiceParams.REDIRECTED_FROM_NODE)
+      @DefaultValue("false") boolean redirected_from_node) {
-        // request
-        if (nodeHttpAddress == null || nodeHttpAddress.isEmpty()) {
+        // request.
+        // If this is the redirect request from NM, we should not re-direct the
+        // request back. Simply output the aggregated logs.
+        if (nodeHttpAddress == null || nodeHttpAddress.isEmpty()
+            || redirected_from_node) {
