Merge trunk into HA branch.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1292838 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.mapred.gridmix.Statistics.JobStats;
+  private final int queueDepth;
+    this.queueDepth = queueDepth;
+      JobStats stats = 
+        Statistics.generateJobStats(job.getJob(), job.getJobDesc());
+          long start = System.currentTimeMillis();
+          long end = System.currentTimeMillis();
+          LOG.info("[JobSubmitter] Time taken to build splits for job " 
+                   + job.getJob().getJobID() + ": " + (end - start) + " ms.");
-          monitor.submissionFailed(job.getJob());
+          monitor.submissionFailed(stats);
-          monitor.submissionFailed(job.getJob());
+          monitor.submissionFailed(stats);
-          monitor.add(job.call());
-          statistics.addJobStats(job.getJob(), job.getJobDesc());
-          LOG.debug("SUBMIT " + job + "@" + System.currentTimeMillis() +
-              " (" + job.getJob().getJobID() + ")");
+          long start = System.currentTimeMillis();
+          job.call();
+          long end = System.currentTimeMillis();
+          LOG.info("[JobSubmitter] Time taken to submit the job " 
+                   + job.getJob().getJobID() + ": " + (end - start) + " ms.");
+          
+          // mark it as submitted
+          job.setSubmitted();
+          
+          // add to the monitor
+          monitor.add(stats);
+          
+          // add to the statistics
+          statistics.addJobStats(stats);
+          if (LOG.isDebugEnabled()) {
+            String jobID = 
+              job.getJob().getConfiguration().get(Gridmix.ORIGINAL_JOB_ID);
+            LOG.debug("Original job '" + jobID + "' is being simulated as '" 
+                      + job.getJob().getJobID() + "'");
+            LOG.debug("SUBMIT " + job + "@" + System.currentTimeMillis() 
+                      + " (" + job.getJob().getJobID() + ")");
+          }
-          monitor.submissionFailed(job.getJob());
+          monitor.submissionFailed(stats);
-          monitor.submissionFailed(job.getJob());
+          monitor.submissionFailed(stats);
-        monitor.submissionFailed(job.getJob());
+        monitor.submissionFailed(stats);
-        monitor.submissionFailed(job.getJob());
+        monitor.submissionFailed(stats);
+      LOG.info("Total number of queued jobs: " 
+               + (queueDepth - sem.availablePermits()));
