HDFS-13017. Block Storage: implement simple iscsi discovery in jscsi server. Contributed by Elek, Marton.

+import org.apache.hadoop.cblock.meta.VolumeInfo;
+import org.apache.hadoop.cblock.protocol.proto.CBlockServiceProtocolProtos;
+import java.util.stream.Collectors;
+
+  @Override
+  public CBlockClientServerProtocolProtos.ListVolumesResponseProto listVolumes(
+      RpcController controller,
+      CBlockClientServerProtocolProtos.ListVolumesRequestProto request)
+      throws ServiceException {
+    try {
+      CBlockClientServerProtocolProtos.ListVolumesResponseProto.Builder resp =
+          CBlockClientServerProtocolProtos.ListVolumesResponseProto
+              .newBuilder();
+      List<VolumeInfo> volumeInfos = impl.listVolumes();
+      List<CBlockServiceProtocolProtos.VolumeInfoProto> convertedInfos =
+          volumeInfos.stream().map(
+              volumeInfo -> CBlockServiceProtocolProtos.VolumeInfoProto
+                  .newBuilder().setUserName(volumeInfo.getUserName())
+                  .setBlockSize(volumeInfo.getBlockSize())
+                  .setVolumeName(volumeInfo.getVolumeName())
+                  .setVolumeSize(volumeInfo.getVolumeSize())
+                  .setUsage(volumeInfo.getUsage()).build())
+              .collect(Collectors.toList());
+      resp.addAllVolumeEntry(convertedInfos);
+      return resp.build();
+    } catch (IOException e) {
+      throw new ServiceException(e);
+    }
+  }
+
