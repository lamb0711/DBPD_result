HADOOP-17079. Optimize UGI#getGroups by adding UGI#getGroupsSet. (#2085)


-import java.util.LinkedList;
+import java.util.ArrayList;
+import java.util.Collections;
+import java.util.LinkedHashSet;
+import java.util.Set;
-  private static final List<String> EMPTY_GROUPS = new LinkedList<>();
+  private static final Set<String> EMPTY_GROUPS_SET = Collections.emptySet();
-    return getUnixGroups(userName);
+    return new ArrayList(getUnixGroups(userName));
+  @Override
+  public Set<String> getGroupsSet(String userName) throws IOException {
+    return getUnixGroups(userName);
+  }
+
-  private List<String> getUnixGroups(String user) throws IOException {
+  private Set<String> getUnixGroups(String user) throws IOException {
-    List<String> groups;
+    Set<String> groups;
-        return EMPTY_GROUPS;
+        return EMPTY_GROUPS_SET;
-          return EMPTY_GROUPS;
+          return EMPTY_GROUPS_SET;
-        return EMPTY_GROUPS;
+        return EMPTY_GROUPS_SET;
-
-    // remove duplicated primary group
-    if (!Shell.WINDOWS) {
-      for (int i = 1; i < groups.size(); i++) {
-        if (groups.get(i).equals(groups.get(0))) {
-          groups.remove(i);
-          break;
-        }
-      }
-    }
-
-  private List<String> parsePartialGroupNames(String groupNames,
+  private Set<String> parsePartialGroupNames(String groupNames,
-    List<String> groups = new LinkedList<String>();
+    Set<String> groups = new LinkedHashSet<>();
-   * @return a list of resolved group names
+   * @return a set of resolved group names
-  private List<String> resolvePartialGroupNames(String userName,
+  private Set<String> resolvePartialGroupNames(String userName,
-   * Split group names into a linked list.
+   * Split group names into a set.
-   * @return a linked list of group names
+   * @return a set of group names
-  protected List<String> resolveFullGroupNames(String groupNames) {
+  protected Set<String> resolveFullGroupNames(String groupNames) {
-    List<String> groups = new LinkedList<String>();
+    Set<String> groups = new LinkedHashSet<>();
