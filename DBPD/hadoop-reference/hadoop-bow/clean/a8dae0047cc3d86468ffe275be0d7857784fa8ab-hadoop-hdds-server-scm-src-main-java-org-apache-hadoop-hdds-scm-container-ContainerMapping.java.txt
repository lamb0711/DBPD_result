HDDS-308. SCM should identify a container with pending deletes using container reports. Contributed by Lokesh Jain.

+import org.apache.hadoop.hdds.scm.block.PendingDeleteStatusList;
+import org.apache.hadoop.hdds.scm.events.SCMEvents;
+import org.apache.hadoop.utils.BatchOperation;
+  private final EventPublisher eventPublisher;
+    LOG.trace("Container State Manager created.");
-    LOG.trace("Container State Manager created.");
+    this.eventPublisher = eventPublisher;
+    if (deleteTransactionMap == null) {
+      return;
+    }
+
+      BatchOperation batch = new BatchOperation();
-        containerStore.put(dbKey, containerInfo.getProtobuf().toByteArray());
-        containerStateManager
-            .updateDeleteTransactionId(containerID, entry.getValue());
+        batch.put(dbKey, containerInfo.getProtobuf().toByteArray());
+      containerStore.writeBatch(batch);
+      containerStateManager
+          .updateDeleteTransactionId(deleteTransactionMap);
-
+    PendingDeleteStatusList pendingDeleteStatusList =
+        new PendingDeleteStatusList(datanodeDetails);
+          if (knownState.getDeleteTransactionId() > datanodeState
+              .getDeleteTransactionId()) {
+            pendingDeleteStatusList
+                .addPendingDeleteStatus(datanodeState.getDeleteTransactionId(),
+                    knownState.getDeleteTransactionId(),
+                    knownState.getContainerID());
+          }
+
+    if (pendingDeleteStatusList.getNumPendingDeletes() > 0) {
+      eventPublisher.fireEvent(SCMEvents.PENDING_DELETE_STATUS,
+          pendingDeleteStatusList);
+    }
+
