YARN-4888. Changes in scheduler to identify resource-requests explicitly by allocation-id. (Subru Krishnan via wangda)

-
-  public static final SchedulerRequestKey UNDEFINED =
-      new SchedulerRequestKey(Priority.UNDEFINED);
+  private final long allocationRequestId;
-    return new SchedulerRequestKey(req.getPriority());
+    return new SchedulerRequestKey(req.getPriority(),
+        req.getAllocationRequestId());
-    return new SchedulerRequestKey(container.getPriority());
+    return new SchedulerRequestKey(container.getPriority(),
+        container.getAllocationRequestId());
-  private SchedulerRequestKey(Priority priority) {
+  private SchedulerRequestKey(Priority priority, long allocationRequestId) {
+    this.allocationRequestId = allocationRequestId;
+  /**
+   * Get the Id of the associated {@link ResourceRequest}.
+   *
+   * @return the Id of the associated {@link ResourceRequest}
+   */
+  public long getAllocationRequestId() {
+    return allocationRequestId;
+  }
+
-    return o.getPriority().compareTo(priority);
+    int priorityCompare = o.getPriority().compareTo(priority);
+    // we first sort by priority and then by allocationRequestId
+    if (priorityCompare != 0) {
+      return priorityCompare;
+    }
+    return Long.compare(allocationRequestId, o.getAllocationRequestId());
-    return getPriority().equals(that.getPriority());
+    if (getAllocationRequestId() != that.getAllocationRequestId()) {
+      return false;
+    }
+    return getPriority() != null ?
+        getPriority().equals(that.getPriority()) :
+        that.getPriority() == null;
-    return getPriority().hashCode();
+    int result = getPriority() != null ? getPriority().hashCode() : 0;
+    result = 31 * result + (int) (getAllocationRequestId() ^ (
+        getAllocationRequestId() >>> 32));
+    return result;
