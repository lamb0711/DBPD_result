YARN-1774. FS: Submitting to non-leaf queue throws NPE. (Anubhav Dhoot and Karthik Kambatla via kasha)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1575415 13f79535-47bb-0310-9956-ffa450edef68

-      rmContext.getDispatcher().getEventHandler().handle(
-          new RMAppRejectedEvent(applicationId,
-              "Application rejected by queue placement policy"));
-  
+
+  /**
+   * Helper method that attempts to assign the app to a queue. The method is
+   * responsible to call the appropriate event-handler if the app is rejected.
+   */
+    String appRejectMsg = null;
+
-        return null;
+        appRejectMsg = "Application rejected by queue placement policy";
+      } else {
+        queue = queueMgr.getLeafQueue(queueName, true);
+        if (queue == null) {
+          appRejectMsg = queueName + " is not a leaf queue";
+        }
-      queue = queueMgr.getLeafQueue(queueName, true);
-    } catch (IOException ex) {
-      LOG.error("Error assigning app to queue, rejecting", ex);
+    } catch (IOException ioe) {
+      appRejectMsg = "Error assigning app to queue " + queueName;
-    
+
+    if (appRejectMsg != null && rmApp != null) {
+      LOG.error(appRejectMsg);
+      rmContext.getDispatcher().getEventHandler().handle(
+          new RMAppRejectedEvent(rmApp.getApplicationId(), appRejectMsg));
+      return null;
+    }
+
-      LOG.warn("Couldn't find RM app to set queue name on");
+      LOG.error("Couldn't find RM app to set queue name on");
-    
