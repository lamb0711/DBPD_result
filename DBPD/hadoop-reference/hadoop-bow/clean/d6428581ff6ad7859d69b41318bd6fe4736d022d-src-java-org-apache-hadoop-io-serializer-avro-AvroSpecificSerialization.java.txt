HADOOP-6165. Add metadata to Serializations.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@810756 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Map;
+
+import org.apache.avro.generic.GenericDatumReader;
-  public boolean accept(Class<?> c) {
-    return SpecificRecord.class.isAssignableFrom(c);
+  @Override
+  public boolean accept(Map<String, String> metadata) {
+    if (getClass().getName().equals(metadata.get(SERIALIZATION_KEY))) {
+      return true;
+    }
+    Class<?> c = getClassFromMetadata(metadata);
+    return c == null ? false : SpecificRecord.class.isAssignableFrom(c);
-  protected DatumReader getReader(Class<SpecificRecord> clazz) {
+  @Override
+  protected DatumReader getReader(Map<String, String> metadata) {
+      Class<SpecificRecord> clazz = (Class<SpecificRecord>)
+        getClassFromMetadata(metadata);
-  protected Schema getSchema(SpecificRecord t) {
+  @Override
+  protected Schema getSchema(SpecificRecord t, Map<String, String> metadata) {
-  protected DatumWriter getWriter(Class<SpecificRecord> clazz) {
+  @Override
+  protected DatumWriter getWriter(Map<String, String> metadata) {
