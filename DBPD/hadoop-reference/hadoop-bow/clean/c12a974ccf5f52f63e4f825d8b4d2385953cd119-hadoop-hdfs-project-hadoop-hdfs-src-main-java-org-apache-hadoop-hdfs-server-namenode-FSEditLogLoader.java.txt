HDFS-8580. Erasure coding: Persist cellSize in BlockInfoStriped and StripedBlocksFeature. Contributed by Walter Su.

+import org.apache.hadoop.hdfs.protocol.ErasureCodingZone;
-      ECSchema ecSchema = FSDirErasureCodingOp.getErasureCodingSchema(
+      ErasureCodingZone ecZone = FSDirErasureCodingOp.getErasureCodingZone(
-      updateBlocks(fsDir, addCloseOp, iip, newFile, ecSchema);
+      updateBlocks(fsDir, addCloseOp, iip, newFile, ecZone);
-      ECSchema ecSchema = FSDirErasureCodingOp.getErasureCodingSchema(
+      ErasureCodingZone ecZone = FSDirErasureCodingOp.getErasureCodingZone(
-      updateBlocks(fsDir, addCloseOp, iip, file, ecSchema);
+      updateBlocks(fsDir, addCloseOp, iip, file, ecZone);
-      ECSchema ecSchema = FSDirErasureCodingOp.getErasureCodingSchema(
+      ErasureCodingZone ecZone = FSDirErasureCodingOp.getErasureCodingZone(
-      updateBlocks(fsDir, updateOp, iip, oldFile, ecSchema);
+      updateBlocks(fsDir, updateOp, iip, oldFile, ecZone);
-      ECSchema ecSchema = FSDirErasureCodingOp.getErasureCodingSchema(
+      ErasureCodingZone ecZone = FSDirErasureCodingOp.getErasureCodingZone(
-      addNewBlock(addBlockOp, oldFile, ecSchema);
+      addNewBlock(addBlockOp, oldFile, ecZone);
-  private void addNewBlock(AddBlockOp op, INodeFile file, ECSchema ecSchema)
-      throws IOException {
+  private void addNewBlock(AddBlockOp op, INodeFile file,
+      ErasureCodingZone ecZone) throws IOException {
-    boolean isStriped = ecSchema != null;
+    boolean isStriped = ecZone != null;
-      newBlockInfo = new BlockInfoStripedUnderConstruction(newBlock, ecSchema);
+      newBlockInfo = new BlockInfoStripedUnderConstruction(newBlock,
+          ecZone.getSchema(), ecZone.getCellSize());
-      INodesInPath iip, INodeFile file, ECSchema ecSchema) throws IOException {
+      INodesInPath iip, INodeFile file, ErasureCodingZone ecZone)
+      throws IOException {
-      final boolean isStriped = ecSchema != null;
+      final boolean isStriped = ecZone != null;
-            newBI = new BlockInfoStripedUnderConstruction(newBlock, ecSchema);
+            newBI = new BlockInfoStripedUnderConstruction(newBlock,
+                ecZone.getSchema(), ecZone.getCellSize());
-          newBI = isStriped ? new BlockInfoStriped(newBlock,
-              ErasureCodingSchemaManager.getSystemDefaultSchema()) :
-              new BlockInfoContiguous(newBlock, file.getPreferredBlockReplication());
+          if (isStriped) {
+            newBI = new BlockInfoStriped(newBlock,
+                ErasureCodingSchemaManager.getSystemDefaultSchema(),
+                ecZone.getCellSize());
+          } else {
+            newBI = new BlockInfoContiguous(newBlock,
+                file.getPreferredBlockReplication());
+          }
