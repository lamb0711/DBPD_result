HDFS-4611. Update FSImage for INodeReference.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1463332 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.PrintStream;
-//import org.apache.hadoop.hdfs.util.EnumCounters;
-  public String getObjectString() {
+  public final String getObjectString() {
+  /** @return a string description of the parent. */
-  public String toStringWithObjectType() {
-    return toString() + "(" + getObjectString() + ")";
+  public final String getParentString() {
+    final INodeReference parentRef = getParentReference();
+    if (parentRef != null) {
+      return "parentRef=" + parentRef.getLocalName() + "->";
+    } else {
+      final INodeDirectory parentDir = getParent();
+      if (parentDir != null) {
+        return "parentDir=" + parentDir.getLocalName() + "/";
+      } else {
+        return "parent=null";
+      }
+    }
-    final INodeDirectory p = getParent();
-    return toStringWithObjectType()
-        + ", parent=" + (p == null? null: p.toStringWithObjectType());
+    return toString() + "(" + getObjectString() + "), " + getParentString();
+  @VisibleForTesting
+  public final void dumpTreeRecursively(PrintStream out) {
+    dumpTreeRecursively(new PrintWriter(out, true), new StringBuilder(), null);
+  }
+
-    out.print("), parent=");
-
-    final INodeDirectory p = getParent();
-    out.print(p == null? null: p.getLocalName() + "/");
+    out.print("), ");
+    out.print(getParentString());
