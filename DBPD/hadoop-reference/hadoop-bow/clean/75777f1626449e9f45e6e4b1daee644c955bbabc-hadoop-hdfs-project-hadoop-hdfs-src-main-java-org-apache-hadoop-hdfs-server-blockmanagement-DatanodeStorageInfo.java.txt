HDFS-5470. Add back trunk's reportDiff algorithm to the branch.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1539504 13f79535-47bb-0310-9956-ffa450edef68

-  static class BlockIterator implements Iterator<BlockInfo> {
+  class BlockIterator implements Iterator<BlockInfo> {
-    private DatanodeStorageInfo node;
-    BlockIterator(BlockInfo head, DatanodeStorageInfo dn) {
+    BlockIterator(BlockInfo head) {
-      this.node = dn;
-      current = current.getNext(current.findStorageInfo(node));
+      current = current.getNext(current.findStorageInfo(DatanodeStorageInfo.this));
-    return new BlockIterator(this.blockList, this);
+    return new BlockIterator(blockList);
+
+  }
+
+  /**
+   * Move block to the head of the list of blocks belonging to the data-node.
+   * @return the index of the head of the blockList
+   */
+  int moveBlockToHead(BlockInfo b, int curIndex, int headIndex) {
+    blockList = b.moveBlockToHead(blockList, this, curIndex, headIndex);
+    return curIndex;
+  }
+
+  /**
+   * Used for testing only
+   * @return the head of the blockList
+   */
+  @VisibleForTesting
+  protected BlockInfo getHead(){
+    return blockList;
