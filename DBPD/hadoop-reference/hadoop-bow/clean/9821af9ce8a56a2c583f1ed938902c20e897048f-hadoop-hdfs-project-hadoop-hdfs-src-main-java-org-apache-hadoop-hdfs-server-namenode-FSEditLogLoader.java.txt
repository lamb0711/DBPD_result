Reverting the previous merge r1416603 which committed some extra changes

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1416712 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.protocol.HdfsFileStatus;
-import org.apache.hadoop.hdfs.server.namenode.INodeDirectory.INodesInPath;
-      final INodesInPath inodesInPath = fsDir.getINodesInPath(addCloseOp.path);
-      INodeFile oldFile = toINodeFile(inodesInPath.getINode(0), addCloseOp.path);
+      INodeFile oldFile = getINodeFile(fsDir, addCloseOp.path);
-              false, inodesInPath.getLatestSnapshot());
+              false);
-      newFile.setModificationTime(addCloseOp.mtime);
+      newFile.setModificationTimeForce(addCloseOp.mtime);
-      final INodesInPath inodesInPath = fsDir.getINodesInPath(addCloseOp.path);
-      INodeFile oldFile = toINodeFile(inodesInPath.getINode(0), addCloseOp.path);
+      INodeFile oldFile = getINodeFile(fsDir, addCloseOp.path);
-      oldFile.setModificationTime(addCloseOp.mtime);
+      oldFile.setModificationTimeForce(addCloseOp.mtime);
-        fsDir.replaceNode(addCloseOp.path, ucFile, newFile,
-            inodesInPath.getLatestSnapshot());
+        fsDir.replaceNode(addCloseOp.path, ucFile, newFile);
+      HdfsFileStatus dinfo = fsDir.getFileInfo(renameOp.dst, false);
+      fsNamesys.unprotectedChangeLease(renameOp.src, renameOp.dst, dinfo);
+
+      HdfsFileStatus dinfo = fsDir.getFileInfo(renameOp.dst, false);
+      fsNamesys.unprotectedChangeLease(renameOp.src, renameOp.dst, dinfo);
-    return toINodeFile(fsDir.getINode(path), path);
-  }
-
-  private static INodeFile toINodeFile(INode inode, String path)
-      throws IOException {
+    INode inode = fsDir.getINode(path);
