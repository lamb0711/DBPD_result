 HDDS-1501 : Create a Recon task interface to update internal DB on updates from OM. (#819)


+import java.io.IOException;
-                .packages("org.apache.hadoop.ozone.recon.api");
+              .packages("org.apache.hadoop.ozone.recon.api");
-    // Schedule the task to read OM DB and write the reverse mapping to Recon
-    // container DB.
-    ContainerKeyMapperTask containerKeyMapperTask = new ContainerKeyMapperTask(
-        ozoneManagerServiceProvider, containerDBServiceProvider);
-    scheduler.scheduleWithFixedDelay(containerKeyMapperTask, initialDelay,
-        interval, TimeUnit.MILLISECONDS);
+
+    scheduler.scheduleWithFixedDelay(() -> {
+      try {
+        ozoneManagerServiceProvider.updateReconOmDBWithNewSnapshot();
+        // Schedule the task to read OM DB and write the reverse mapping to
+        // Recon container DB.
+        ContainerKeyMapperTask containerKeyMapperTask =
+            new ContainerKeyMapperTask(containerDBServiceProvider,
+                ozoneManagerServiceProvider.getOMMetadataManagerInstance());
+        containerKeyMapperTask.reprocess(
+            ozoneManagerServiceProvider.getOMMetadataManagerInstance());
+      } catch (IOException e) {
+        LOG.error("Unable to get OM " +
+            "Snapshot", e);
+      }
+    }, initialDelay, interval, TimeUnit.MILLISECONDS);
