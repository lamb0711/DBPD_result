Minor update to HADOOP-7429.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1141415 13f79535-47bb-0310-9956-ffa450edef68

+   * @param close whether to close the streams
-  public static void copyBytes(InputStream in, OutputStream out, long count)
-      throws IOException {
+  public static void copyBytes(InputStream in, OutputStream out, long count,
+      boolean close) throws IOException {
-    while (bytesRemaining > 0) {
-      int bytesToRead = (int)
-        (bytesRemaining < buf.length ? bytesRemaining : buf.length);
+    try {
+      while (bytesRemaining > 0) {
+        int bytesToRead = (int)
+          (bytesRemaining < buf.length ? bytesRemaining : buf.length);
-      bytesRead = in.read(buf, 0, bytesToRead);
-      if (bytesRead == -1)
-        break;
+        bytesRead = in.read(buf, 0, bytesToRead);
+        if (bytesRead == -1)
+          break;
-      out.write(buf, 0, bytesRead);
-      bytesRemaining -= bytesRead;
+        out.write(buf, 0, bytesRead);
+        bytesRemaining -= bytesRead;
+      }
+    } finally {
+      if (close) {
+        closeStream(out);
+        closeStream(in);
+      }
