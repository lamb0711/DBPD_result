HDDS-1948. S3 MPU can't be created with octet-stream content-type  (#1266)


+import javax.ws.rs.Consumes;
+import org.apache.hadoop.ozone.s3.HeaderPreprocessor;
+  /**
+   * Initialize MultiPartUpload request.
+   * <p>
+   * Note: the specific content type is set by the HeaderPreprocessor.
+   */
-  public Response multipartUpload(
+  @Consumes(HeaderPreprocessor.MULTIPART_UPLOAD_MARKER)
+  public Response initializeMultipartUpload(
-      @PathParam("path") String key,
-      @QueryParam("uploads") String uploads,
-      @QueryParam("uploadId") @DefaultValue("") String uploadID,
-      CompleteMultipartUploadRequest request) throws IOException, OS3Exception {
-    if (!uploadID.equals("")) {
-      //Complete Multipart upload request.
-      return completeMultipartUpload(bucket, key, uploadID, request);
-    } else {
-      // Initiate Multipart upload request.
-      return initiateMultipartUpload(bucket, key);
-    }
-  }
-
-  /**
-   * Initiate Multipart upload request.
-   * @param bucket
-   * @param key
-   * @return Response
-   * @throws IOException
-   * @throws OS3Exception
-   */
-  private Response initiateMultipartUpload(String bucket, String key) throws
-      IOException, OS3Exception {
+      @PathParam("path") String key
+  )
+      throws IOException, OS3Exception {
-
-   * Complete Multipart upload request.
-   * @param bucket
-   * @param key
-   * @param uploadID
-   * @param multipartUploadRequest
-   * @return Response
-   * @throws IOException
-   * @throws OS3Exception
+   * Complete a multipart upload.
-  private Response completeMultipartUpload(String bucket, String key, String
-      uploadID, CompleteMultipartUploadRequest multipartUploadRequest) throws
-      IOException, OS3Exception {
+  @POST
+  @Produces(MediaType.APPLICATION_XML)
+  public Response completeMultipartUpload(@PathParam("bucket") String bucket,
+      @PathParam("path") String key,
+      @QueryParam("uploadId") @DefaultValue("") String uploadID,
+      CompleteMultipartUploadRequest multipartUploadRequest)
+      throws IOException, OS3Exception {
