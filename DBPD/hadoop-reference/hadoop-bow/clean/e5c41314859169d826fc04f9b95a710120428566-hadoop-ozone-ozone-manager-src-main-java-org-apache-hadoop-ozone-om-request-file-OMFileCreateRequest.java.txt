HDDS-1856. Make required changes for Non-HA to use new HA code in OM. (#1174)


+import org.apache.hadoop.ozone.om.ratis.utils.OzoneManagerDoubleBufferHelper;
-      long transactionLogIndex) {
+      long transactionLogIndex,
+      OzoneManagerDoubleBufferHelper ozoneManagerDoubleBufferHelper) {
-
+    OMClientResponse omClientResponse = null;
+      omClientResponse =  prepareCreateKeyResponse(keyArgs, omKeyInfo,
+          locations, encryptionInfo.orNull(), exception,
+          createFileRequest.getClientID(), transactionLogIndex, volumeName,
+          bucketName, keyName, ozoneManager,
+          OMAction.CREATE_FILE);
+      omClientResponse =  prepareCreateKeyResponse(keyArgs, omKeyInfo,
+          locations, encryptionInfo.orNull(), exception,
+          createFileRequest.getClientID(), transactionLogIndex,
+          volumeName, bucketName, keyName, ozoneManager,
+          OMAction.CREATE_FILE);
+      if (omClientResponse != null) {
+        omClientResponse.setFlushFuture(
+            ozoneManagerDoubleBufferHelper.add(omClientResponse,
+                transactionLogIndex));
+      }
-    return prepareCreateKeyResponse(keyArgs, omKeyInfo, locations,
-        encryptionInfo.orNull(), exception, createFileRequest.getClientID(),
-        transactionLogIndex, volumeName, bucketName, keyName, ozoneManager,
-        OMAction.CREATE_FILE);
+    return omClientResponse;
