YARN-6775. CapacityScheduler: Improvements to assignContainers, avoid unnecessary canAssignToUser/Queue calls. (Nathan Roberts via wangda)

Change-Id: I84ccd54200ccbaae23018ef320028e42b4c3509a

-      recordActivity(activitiesManager, node, application.getQueueName(),
-          application.getApplicationId().toString(), priority,
-          ActivityState.REJECTED, diagnostic, type);
+      if (activitiesManager == null) {
+        return;
+      }
+      if (activitiesManager.shouldRecordThisNode(node.getNodeID())) {
+        recordActivity(activitiesManager, node, application.getQueueName(),
+            application.getApplicationId().toString(), priority,
+            ActivityState.REJECTED, diagnostic, type);
+      }
-      recordActivity(activitiesManager, node, parentQueueName, queueName, null,
-          state, diagnostic, null);
+      if (activitiesManager == null) {
+        return;
+      }
+      if (activitiesManager.shouldRecordThisNode(node.getNodeID())) {
+        recordActivity(activitiesManager, node, parentQueueName, queueName,
+            null, state, diagnostic, null);
+      }
-    if (activitiesManager == null) {
-      return;
-    }
-    if (activitiesManager.shouldRecordThisNode(node.getNodeID())) {
-      activitiesManager.addSchedulingActivityForNode(node.getNodeID(),
-          parentName, childName, priority != null ? priority.toString() : null,
-          state, diagnostic, type);
-    }
+
+    activitiesManager.addSchedulingActivityForNode(node.getNodeID(), parentName,
+        childName, priority != null ? priority.toString() : null, state,
+        diagnostic, type);
+
