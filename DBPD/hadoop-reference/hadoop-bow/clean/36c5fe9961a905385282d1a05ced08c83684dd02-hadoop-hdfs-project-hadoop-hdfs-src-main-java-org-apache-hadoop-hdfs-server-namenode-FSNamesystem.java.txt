HDFS-4346. Add SequentialNumber as a base class for INodeId and GenerationStamp.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1428167 13f79535-47bb-0310-9956-ffa450edef68

-   * Set the last allocated inode id when fsimage is loaded or editlog is
-   * applied. 
-   * @throws IOException
+   * Set the last allocated inode id when fsimage or editlog is loaded. 
-    inodeId.resetLastInodeId(newValue);
+    try {
+      inodeId.skipTo(newValue);
+    } catch(IllegalStateException ise) {
+      throw new IOException(ise);
+    }
-    inodeId.resetLastInodeIdWithoutChecking(newValue);
+    inodeId.setCurrentValue(newValue);
+  /** @return the last inode ID. */
-    return inodeId.getLastInodeId();
+    return inodeId.getCurrentValue();
+  /** Allocate a new inode ID. */
-    return inodeId.allocateNewInodeId();
+    return inodeId.nextValue();
-    generationStamp.setStamp(GenerationStamp.FIRST_VALID_STAMP);
+    generationStamp.setCurrentValue(GenerationStamp.LAST_RESERVED_STAMP);
-    inodeId.resetLastInodeIdWithoutChecking(INodeId.LAST_RESERVED_ID);
+    inodeId.setCurrentValue(INodeId.LAST_RESERVED_ID);
-    nextGenerationStamp();
-    b.setGenerationStamp(getGenerationStamp());
+    b.setGenerationStamp(nextGenerationStamp());
-    generationStamp.setStamp(stamp);
+    generationStamp.setCurrentValue(stamp);
-    return generationStamp.getStamp();
+    return generationStamp.getCurrentValue();
-    long gs = generationStamp.nextStamp();
+    final long gs = generationStamp.nextValue();
