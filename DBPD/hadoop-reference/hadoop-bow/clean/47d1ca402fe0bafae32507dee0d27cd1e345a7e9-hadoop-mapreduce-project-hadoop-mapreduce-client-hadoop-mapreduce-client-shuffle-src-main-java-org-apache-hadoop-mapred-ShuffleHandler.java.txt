MAPREDUCE-5208. Modified ShuffleHandler to use SecureIOUtils for reading local files. Contributed by Omkar Vinit Joshi.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1481657 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.io.SecureIOUtils;
-import org.apache.hadoop.security.ssl.SSLFactory;
+import org.apache.hadoop.security.ssl.SSLFactory;
-          LOG.error("Shuffle error ", e);
-          sendError(ctx, e.getMessage(), INTERNAL_SERVER_ERROR);
+          LOG.error("Shuffle error :", e);
+          StringBuffer sb = new StringBuffer(e.getMessage());
+          Throwable t = e;
+          while (t.getCause() != null) {
+            sb.append(t.getCause().getMessage());
+            t = t.getCause();
+          }
+          sendError(ctx,sb.toString() , INTERNAL_SERVER_ERROR);
-        spill = new RandomAccessFile(spillfile, "r");
+        spill = SecureIOUtils.openForRandomRead(spillfile, "r", user, null);
