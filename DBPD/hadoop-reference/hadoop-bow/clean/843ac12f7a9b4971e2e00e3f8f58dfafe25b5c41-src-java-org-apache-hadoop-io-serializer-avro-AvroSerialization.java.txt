HADOOP-6323. Add comparators to the serialization API.  Contributed by Aaron Kimball.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@889877 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.io.RawComparator;
-  protected abstract Schema getSchema(T t, Map<String, String> metadata);
+  protected abstract Schema getSchema(Map<String, String> metadata);
+    private Schema schema;
-      writer = getWriter(metadata);
+      this.writer = getWriter(metadata);
+      this.schema = getSchema(this.metadata);
+      writer.setSchema(this.schema);
-      writer.setSchema(getSchema(t, metadata));
+  @Override
+  @SuppressWarnings("unchecked")
+  /**
+   * Provides a raw comparator for Avro-encoded serialized data.
+   * Requires that {@link AvroSerialization#AVRO_SCHEMA_KEY} be provided
+   * in the metadata argument.
+   * @param metadata the Avro-serialization-specific parameters being
+   * provided that detail the schema for the data to deserialize and compare.
+   * @return a RawComparator parameterized for the specified Avro schema.
+   */
+  public RawComparator<T> getRawComparator(Map<String, String> metadata) {
+    Schema schema = Schema.parse(metadata.get(AVRO_SCHEMA_KEY));
+    return new AvroComparator(schema);
+  }
+
