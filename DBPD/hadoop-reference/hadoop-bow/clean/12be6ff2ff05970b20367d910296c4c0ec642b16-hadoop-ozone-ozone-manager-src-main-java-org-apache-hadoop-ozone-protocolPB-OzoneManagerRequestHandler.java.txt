HDDS-1539. Implement addAcl,removeAcl,setAcl,getAcl for Volume. Contributed Ajay Kumar. (#847)



+import org.apache.hadoop.ozone.OzoneAcl;
-import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos;
+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos.AddAclResponse;
+import org.apache.hadoop.ozone.security.acl.OzoneObjInfo;
+import static org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos.*;
+
-        OzoneManagerProtocolProtos.CreateFileResponse createFileResponse =
+        CreateFileResponse createFileResponse =
-        OzoneManagerProtocolProtos.LookupFileResponse lookupFileResponse =
+        LookupFileResponse lookupFileResponse =
-        OzoneManagerProtocolProtos.ListStatusResponse listStatusResponse =
+        ListStatusResponse listStatusResponse =
+      case AddAcl:
+        AddAclResponse addAclResponse =
+            addAcl(request.getAddAclRequest());
+        responseBuilder.setAddAclResponse(addAclResponse);
+        break;
+      case RemoveAcl:
+        RemoveAclResponse removeAclResponse =
+            removeAcl(request.getRemoveAclRequest());
+        responseBuilder.setRemoveAclResponse(removeAclResponse);
+        break;
+      case SetAcl:
+        SetAclResponse setAclResponse =
+            setAcl(request.getSetAclRequest());
+        responseBuilder.setSetAclResponse(setAclResponse);
+        break;
+      case GetAcl:
+        GetAclResponse getAclResponse =
+            getAcl(request.getGetAclRequest());
+        responseBuilder.setGetAclResponse(getAclResponse);
+        break;
+  private GetAclResponse getAcl(GetAclRequest req) throws IOException {
+    List<OzoneAclInfo> acls = new ArrayList<>();
+
+    List<OzoneAcl> aclList =
+        impl.getAcl(OzoneObjInfo.fromProtobuf(req.getObj()));
+    aclList.parallelStream().forEach(a -> acls.add(OzoneAcl.toProtobuf(a)));
+    return GetAclResponse.newBuilder().addAllAcls(acls).build();
+  }
+
+  private RemoveAclResponse removeAcl(RemoveAclRequest req)
+      throws IOException {
+    boolean response = impl.removeAcl(OzoneObjInfo.fromProtobuf(req.getObj()),
+        OzoneAcl.fromProtobuf(req.getAcl()));
+    return RemoveAclResponse.newBuilder().setResponse(response).build();
+  }
+
+  private SetAclResponse setAcl(SetAclRequest req) throws IOException {
+    List<OzoneAcl> ozoneAcl = new ArrayList<>();
+    req.getAclList().parallelStream().forEach(a ->
+        ozoneAcl.add(OzoneAcl.fromProtobuf(a)));
+    boolean response = impl.setAcl(OzoneObjInfo.fromProtobuf(req.getObj()),
+        ozoneAcl);
+    return SetAclResponse.newBuilder().setResponse(response).build();
+  }
+
+  private AddAclResponse addAcl(AddAclRequest req) throws IOException {
+    boolean response = impl.addAcl(OzoneObjInfo.fromProtobuf(req.getObj()),
+        OzoneAcl.fromProtobuf(req.getAcl()));
+    return AddAclResponse.newBuilder().setResponse(response).build();
+  }
+
-    List<OzoneManagerProtocolProtos.PartInfo> partInfoList =
+    List<PartInfo> partInfoList =
-  private OzoneManagerProtocolProtos.GetS3SecretResponse getS3Secret(
-      OzoneManagerProtocolProtos.GetS3SecretRequest request)
+  private GetS3SecretResponse getS3Secret(
+      GetS3SecretRequest request)
-    OzoneManagerProtocolProtos.GetS3SecretResponse.Builder rb =
-        OzoneManagerProtocolProtos.GetS3SecretResponse.newBuilder();
+    GetS3SecretResponse.Builder rb =
+        GetS3SecretResponse.newBuilder();
-  private OzoneManagerProtocolProtos.CreateFileResponse createFile(
-      OzoneManagerProtocolProtos.CreateFileRequest request) throws IOException {
+  private CreateFileResponse createFile(
+      CreateFileRequest request) throws IOException {
-    return OzoneManagerProtocolProtos.CreateFileResponse.newBuilder()
+    return CreateFileResponse.newBuilder()
-  private OzoneManagerProtocolProtos.LookupFileResponse lookupFile(
-      OzoneManagerProtocolProtos.LookupFileRequest request)
+  private LookupFileResponse lookupFile(
+      LookupFileRequest request)
-    return OzoneManagerProtocolProtos.LookupFileResponse.newBuilder()
+    return LookupFileResponse.newBuilder()
-  private OzoneManagerProtocolProtos.ListStatusResponse listStatus(
-      OzoneManagerProtocolProtos.ListStatusRequest request) throws IOException {
+  private ListStatusResponse listStatus(
+      ListStatusRequest request) throws IOException {
-    OzoneManagerProtocolProtos.ListStatusResponse.Builder
+    ListStatusResponse.Builder
-        OzoneManagerProtocolProtos.ListStatusResponse.newBuilder();
+        ListStatusResponse.newBuilder();
