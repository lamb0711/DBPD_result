HDFS-11575. Supporting HDFS NFS gateway with Federated HDFS. Contributed by Mukul Kumar Singh.

+  private int namenodeId = -1;
-   * Handle is a 32 bytes number. For HDFS, the last 8 bytes is fileId.
+   * Handle is a 32 bytes number. For HDFS, the last 8 bytes is fileId
+   * For ViewFs, last 8 byte is fileId while 4 bytes before that is namenodeId
+   * @param n namenode id
-  public FileHandle(long v) {
+  public FileHandle(long v, int n) {
+    namenodeId = n;
-    for (int i = 8; i < HANDLE_LEN; i++) {
+
+    handle[8] = (byte) (n >>> 24);
+    handle[9] = (byte) (n >>> 16);
+    handle[10] = (byte) (n >>> 8);
+    handle[11] = (byte) (n >>> 0);
+    for (int i = 12; i < HANDLE_LEN; i++) {
-  
+
+  public FileHandle(long v) {
+    this(v, 0);
+  }
+
-  private long bytesToLong(byte[] data) {
+  private long bytesToLong(byte[] data, int offset) {
-      buffer.put(data[i]);
+      buffer.put(data[i + offset]);
-    buffer.flip();// need flip
+    buffer.flip(); // need flip
-  
+
+  private int bytesToInt(byte[] data, int offset) {
+    ByteBuffer buffer = ByteBuffer.allocate(4);
+    for (int i = 0; i < 4; i++) {
+      buffer.put(data[i + offset]);
+    }
+    buffer.flip(); // need flip
+    return buffer.getInt();
+  }
+
-    fileId = bytesToLong(handle);
+    fileId = bytesToLong(handle, 0);
+    namenodeId = bytesToInt(handle, 8);
+
+  public int getNamenodeId() {
+    return namenodeId;
+  }
-  
+
+
+  public String dumpFileHandle() {
+    return "fileId: " + fileId + " namenodeId: " + namenodeId;
+  }
