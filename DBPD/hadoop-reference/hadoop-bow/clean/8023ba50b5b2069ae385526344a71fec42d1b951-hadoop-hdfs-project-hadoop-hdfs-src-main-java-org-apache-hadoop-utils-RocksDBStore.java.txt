HDFS-12807. Ozone: Expose RockDB stats via JMX for Ozone metadata stores. Contributed by Elek, Marton.

+import org.apache.hadoop.metrics2.util.MBeans;
+import org.apache.ratis.shaded.com.google.common.annotations.VisibleForTesting;
+import org.rocksdb.DBOptions;
+import org.rocksdb.Statistics;
+import org.rocksdb.StatsLevel;
+import javax.management.ObjectName;
+import java.util.HashMap;
+  private ObjectName statMBeanName;
-  public RocksDBStore(File dbFile, Options options) throws IOException {
+  public RocksDBStore(File dbFile, Options options)
+      throws IOException {
+
+      if (dbOptions.statistics() != null) {
+
+        Map<String, String> jmxProperties = new HashMap<String, String>();
+        jmxProperties.put("dbName", dbFile.getName());
+        statMBeanName = MBeans.register("Ozone", "RocksDbStore", jmxProperties,
+            new RocksDBStoreMBean(dbOptions.statistics()));
+      }
-      throw new IOException("Failed init RocksDB, db path : "
-          + dbFile.getAbsolutePath(), e);
+      throw new IOException(
+          "Failed init RocksDB, db path : " + dbFile.getAbsolutePath(), e);
+    if (statMBeanName != null) {
+      MBeans.unregister(statMBeanName);
+    }
+
+
+  @VisibleForTesting
+  protected ObjectName getStatMBeanName() {
+    return statMBeanName;
+  }
+
