HDFS-11541. Call RawErasureEncoder and RawErasureDecoder release() methods. Contributed by SammiChen.

-    while (requestedLen > 0 && getPositionInBlock() < maxTargetLength) {
-      long remaining = maxTargetLength - getPositionInBlock();
-      final int toReconstructLen = (int) Math
-          .min(getStripedReader().getBufferSize(), remaining);
-      // step1: read from minimum source DNs required for reconstruction.
-      // The returned success list is the source DNs we do real read from
-      getStripedReader().readMinimumSources(toReconstructLen);
+    try {
+      while (requestedLen > 0 && getPositionInBlock() < maxTargetLength) {
+        long remaining = maxTargetLength - getPositionInBlock();
+        final int toReconstructLen = (int) Math
+            .min(getStripedReader().getBufferSize(), remaining);
+        // step1: read from minimum source DNs required for reconstruction.
+        // The returned success list is the source DNs we do real read from
+        getStripedReader().readMinimumSources(toReconstructLen);
-      // step2: decode to reconstruct targets
-      reconstructTargets(toReconstructLen);
+        // step2: decode to reconstruct targets
+        reconstructTargets(toReconstructLen);
-      // step3: calculate checksum
-      checksumDataLen += checksumWithTargetOutput(targetBuffer.array(),
-          toReconstructLen, digester);
+        // step3: calculate checksum
+        checksumDataLen += checksumWithTargetOutput(targetBuffer.array(),
+            toReconstructLen, digester);
-      updatePositionInBlock(toReconstructLen);
-      requestedLen -= toReconstructLen;
-      clearBuffers();
+        updatePositionInBlock(toReconstructLen);
+        requestedLen -= toReconstructLen;
+        clearBuffers();
+      }
+
+      byte[] digest = digester.digest();
+      md5 = new MD5Hash(digest);
+      md5.write(checksumWriter);
+    } finally {
+      cleanup();
-
-    byte[] digest = digester.digest();
-    md5 = new MD5Hash(digest);
-    md5.write(checksumWriter);
