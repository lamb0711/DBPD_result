YARN-1761. Modified RMAdmin CLI to check whether HA is enabled or not before it executes any of the HA admin related commands. Contributed by Xuan Gong.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1574661 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.conf.Configured;
-import org.apache.hadoop.util.Tool;
+    boolean isHACommand = false;
+      isHACommand = true;
+    if (isHACommand) {
+      builder.append(cmd + " can only be used when RM HA is enabled");
+    }
-  private static void buildUsageMsg(StringBuilder builder) {
+  private static void buildUsageMsg(StringBuilder builder,
+      boolean isHAEnabled) {
-    for (String cmdKey : USAGE.keySet()) {
-      if (!cmdKey.equals("-help")) {
-        UsageInfo usageInfo = USAGE.get(cmdKey);
-        builder.append("   " + cmdKey + " " + usageInfo.args + "\n");
+    if (isHAEnabled) {
+      for (String cmdKey : USAGE.keySet()) {
+        if (!cmdKey.equals("-help")) {
+          UsageInfo usageInfo = USAGE.get(cmdKey);
+          builder.append("   " + cmdKey + " " + usageInfo.args + "\n");
+        }
-  private static void printHelp(String cmd) {
+  private static void printHelp(String cmd, boolean isHAEnabled) {
-    appendHAUsage(summary);
+    if (isHAEnabled) {
+      appendHAUsage(summary);
+    }
-    for (String cmdKey : USAGE.keySet()) {
-      if (!cmdKey.equals("-help")) {
-        buildHelpMsg(cmdKey, helpBuilder);
-        helpBuilder.append("\n");
+    if (isHAEnabled) {
+      for (String cmdKey : USAGE.keySet()) {
+        if (!cmdKey.equals("-help")) {
+          buildHelpMsg(cmdKey, helpBuilder);
+          helpBuilder.append("\n");
+        }
-  private static void printUsage(String cmd) {
+  private static void printUsage(String cmd, boolean isHAEnabled) {
-      buildUsageMsg(usageBuilder);
+      buildUsageMsg(usageBuilder, isHAEnabled);
+    YarnConfiguration yarnConf =
+        getConf() == null ? new YarnConfiguration() : new YarnConfiguration(
+            getConf());
+    boolean isHAEnabled =
+        yarnConf.getBoolean(YarnConfiguration.RM_HA_ENABLED,
+            YarnConfiguration.DEFAULT_RM_HA_ENABLED);
+
-      printUsage("");
+      printUsage("", isHAEnabled);
-        printUsage(args[i]);
+        printUsage(args[i], isHAEnabled);
-        printHelp("");
+        printHelp("", isHAEnabled);
-      return super.run(args);
+      if (isHAEnabled) {
+        return super.run(args);
+      }
+      System.out.println("Cannot run " + cmd
+          + " when ResourceManager HA is not enabled");
+      return -1;
-        printUsage(cmd);
+        printUsage(cmd, isHAEnabled);
-        printUsage("");
-        printUsage("");
+        printUsage("", isHAEnabled);
-      printUsage(cmd);
+      printUsage(cmd, isHAEnabled);
