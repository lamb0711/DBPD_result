HDFS-4611. Update FSImage for INodeReference.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1463332 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.DataOutputStream;
+import java.io.DataOutput;
-import org.apache.hadoop.hdfs.server.namenode.FSImageSerialization;
-import org.apache.hadoop.hdfs.server.namenode.Quota;
+import org.apache.hadoop.hdfs.server.namenode.Quota;
+import org.apache.hadoop.hdfs.server.namenode.snapshot.SnapshotFSImageFormat.ReferenceMap;
-  void writeSnapshotPath(DataOutputStream out) throws IOException {
-    // Assume the snapshot is recorded before.
-    // The root path is sufficient for looking up the Snapshot object.
-    FSImageSerialization.writeString(snapshot.getRoot().getFullPathName(), out);
+  void writeSnapshot(DataOutput out) throws IOException {
+    // Assume the snapshot is recorded before, write id only.
+    out.writeInt(snapshot.getId());
-  abstract void write(DataOutputStream out) throws IOException;
+  abstract void write(DataOutput out, ReferenceMap referenceMap
+      ) throws IOException;
