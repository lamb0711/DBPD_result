HDDS-1561: Mark OPEN containers as QUASI_CLOSED as part of Ratis groupRemove (#1401)



+import org.apache.hadoop.ozone.container.ozoneimpl.ContainerController;
+  private final ContainerController containerController;
-      ThreadPoolExecutor chunkExecutor, XceiverServerRatis ratisServer,
-      long expiryInterval, boolean isBlockTokenEnabled,
-      TokenVerifier tokenVerifier, Configuration conf) {
+      ContainerController containerController, ThreadPoolExecutor chunkExecutor,
+      XceiverServerRatis ratisServer, long expiryInterval,
+      boolean isBlockTokenEnabled, TokenVerifier tokenVerifier,
+      Configuration conf) {
+    this.containerController = containerController;
+    ratisServer.notifyGroupAdd(gid);
+  public void notifyGroupRemove() {
+    ratisServer.notifyGroupRemove(gid);
+    // Make best effort to quasi-close all the containers on group removal.
+    // Containers already in terminal state like CLOSED or UNHEALTHY will not
+    // be affected.
+    for (Long cid : createContainerSet) {
+      try {
+        containerController.markContainerForClose(cid);
+        containerController.quasiCloseContainer(cid);
+      } catch (IOException e) {
+      }
+    }
+  }
+
+  @Override
