YARN-8696. [AMRMProxy] FederationInterceptor upgrade: home sub-cluster heartbeat async. Contributed by Botong Huang.

+  // For unit test draining
+  private volatile boolean isThreadWaiting;
+
+    this.isThreadWaiting = false;
-        requestInfo = requestQueue.take();
+        this.isThreadWaiting = true;
+        requestInfo = this.requestQueue.take();
+        this.isThreadWaiting = false;
+
-        if (!keepRunning) {
+        if (!this.keepRunning) {
-          LOG.debug("Sending Heartbeat to Unmanaged AM. AskList:"
+          LOG.debug("Sending Heartbeat to RM. AskList:"
+  public void drainHeartbeatThread() {
+    while (!this.isThreadWaiting || this.requestQueue.size() > 0) {
+      try {
+        Thread.sleep(10);
+      } catch (InterruptedException e) {
+      }
+    }
+  }
+
+  @VisibleForTesting
