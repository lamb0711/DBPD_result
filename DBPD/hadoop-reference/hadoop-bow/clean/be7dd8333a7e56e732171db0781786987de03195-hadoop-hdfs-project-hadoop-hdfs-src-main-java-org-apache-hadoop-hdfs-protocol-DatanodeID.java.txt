HDFS-3144. Refactor DatanodeID#getName by use. Contributed by Eli Collins


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1308205 13f79535-47bb-0310-9956-ffa450edef68

+ *
+ * {@link DatanodeInfo#getName()} should be used to get the network
+ * location (for topology) of a datanode, instead of using
+ * {@link DatanodeID#getXferAddr()} here. Helpers are defined below
+ * for each context in which a DatanodeID is used.
-  protected String name;       // IP:port (data transfer port)
+  protected String ipAddr;     // IP address
+  protected int xferPort;      // data streaming port
-  /** Equivalent to DatanodeID(nodeName, "", -1, -1). */
-  public DatanodeID(String nodeName) {this(nodeName, "", "", -1, -1);}
+  /** Equivalent to DatanodeID(ipAddr, "", -1, -1, -1). */
+  public DatanodeID(String ipAddr) {this(ipAddr, "", "", -1, -1, -1);}
+
+  /** Equivalent to DatanodeID(ipAddr, "", xferPort, -1, -1). */
+  public DatanodeID(String ipAddr, int xferPort) {this(ipAddr, "", "", xferPort, -1, -1);}
-    this(from.getName(),
+    this(from.getIpAddr(),
+        from.getXferPort(),
-   * @param node IP:port
+   * @param ipAddr IP
+   * @param xferPort data transfer port
-  public DatanodeID(String name, String hostName,
-      String storageID, int infoPort, int ipcPort) {
-    this.name = name;
+  public DatanodeID(String ipAddr, String hostName, String storageID,
+      int xferPort, int infoPort, int ipcPort) {
+    this.ipAddr = ipAddr;
+    this.xferPort = xferPort;
-  public void setName(String name) {
-    this.name = name;
+  public void setIpAddr(String ipAddr) {
+    this.ipAddr = ipAddr;
+  public void setXferPort(int xferPort) {
+    this.xferPort = xferPort;
+  }
+
-  
+
+  public void setStorageID(String storageID) {
+    this.storageID = storageID;
+  }
+
-   * @return hostname:portNumber.
+   * @return ipAddr;
-  public String getName() {
-    return name;
+  public String getIpAddr() {
+    return ipAddr;
-    return (hostName == null || hostName.length() == 0) ? getHost() : hostName;
+    return hostName;
+  }
+
+  /**
+   * @return IP:xferPort string
+   */
+  public String getXferAddr() {
+    return ipAddr + ":" + xferPort;
+  }
+
+  /**
+   * @return IP:ipcPort string
+   */
+  public String getIpcAddr() {
+    return ipAddr + ":" + ipcPort;
+  }
+
+  /**
+   * @return IP:infoPort string
+   */
+  public String getInfoAddr() {
+    return ipAddr + ":" + infoPort;
+  }
+
+  /**
+   * @return hostname:xferPort
+   */
+  public String getXferAddrWithHostname() {
+    return hostName + ":" + xferPort;
-    return this.storageID;
+    return storageID;
+  }
+
+  /**
+   * @return xferPort (the port for data streaming)
+   */
+  public int getXferPort() {
+    return xferPort;
-  /**
-   * sets the data storage ID.
-   */
-  public void setStorageID(String storageID) {
-    this.storageID = storageID;
-  }
-
-  /**
-   * @return hostname and no :portNumber.
-   */
-  public String getHost() {
-    int colon = name.indexOf(":");
-    if (colon < 0) {
-      return name;
-    } else {
-      return name.substring(0, colon);
-    }
-  }
-  
-  public int getPort() {
-    int colon = name.indexOf(":");
-    if (colon < 0) {
-      return 50010; // default port.
-    }
-    return Integer.parseInt(name.substring(colon+1));
-  }
-
-    return (name.equals(((DatanodeID)to).getName()) &&
+    return (getXferAddr().equals(((DatanodeID)to).getXferAddr()) &&
-    return name.hashCode()^ storageID.hashCode();
+    return getXferAddr().hashCode()^ storageID.hashCode();
-    return name;
+    return getXferAddr();
-    name = nodeReg.getName();
+    ipAddr = nodeReg.getIpAddr();
+    xferPort = nodeReg.getXferPort();
-  /** Comparable.
-   * Basis of compare is the String name (host:portNumber) only.
+  /**
+   * Compare based on data transfer address.
+   *
-   * @return as specified by Comparable.
+   * @return as specified by Comparable
-    return name.compareTo(that.getName());
+    return getXferAddr().compareTo(that.getXferAddr());
-  /////////////////////////////////////////////////
-  // Writable
-  /////////////////////////////////////////////////
-    Text.writeString(out, name);
+    Text.writeString(out, ipAddr);
+    out.writeShort(xferPort);
-    name = Text.readString(in);
+    ipAddr = Text.readString(in);
-    this.infoPort = in.readShort() & 0x0000ffff;
-    this.ipcPort = in.readShort() & 0x0000ffff;
+    xferPort = in.readShort() & 0x0000ffff;
+    infoPort = in.readShort() & 0x0000ffff;
+    ipcPort = in.readShort() & 0x0000ffff;
