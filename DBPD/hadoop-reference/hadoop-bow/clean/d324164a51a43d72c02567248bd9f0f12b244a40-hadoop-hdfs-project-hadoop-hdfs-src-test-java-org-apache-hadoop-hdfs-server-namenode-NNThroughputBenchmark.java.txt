HDFS-7435. PB encoding of block reports is very inefficient. Contributed by Daryn Sharp.

+
+import org.apache.hadoop.hdfs.protocol.BlockListAsLongs.BlockReportReplica;
-    final ArrayList<Block> blocks;
+    final ArrayList<BlockReportReplica> blocks;
-    long[] blockReportList;
+    BlockListAsLongs blockReportList;
-      this.blocks = new ArrayList<Block>(blockCapacity);
+      this.blocks = new ArrayList<BlockReportReplica>(blockCapacity);
-          new StorageBlockReport(storage,
-              new BlockListAsLongs(null, null).getBlockListAsLongs())
+          new StorageBlockReport(storage, BlockListAsLongs.EMPTY)
-      blocks.set(nrBlocks, blk);
+      blocks.set(nrBlocks, new BlockReportReplica(blk));
-      for(int idx = blocks.size()-1; idx >= nrBlocks; idx--)
-        blocks.set(idx, new Block(blocks.size() - idx, 0, 0));
-      blockReportList = new BlockListAsLongs(blocks).getBlockListAsLongs();
+      for (int idx = blocks.size()-1; idx >= nrBlocks; idx--) {
+        Block block = new Block(blocks.size() - idx, 0, 0);
+        blocks.set(idx, new BlockReportReplica(block));
+      }
+      blockReportList = BlockListAsLongs.EMPTY;
-    long[] getBlockReportList() {
+    BlockListAsLongs getBlockReportList() {
