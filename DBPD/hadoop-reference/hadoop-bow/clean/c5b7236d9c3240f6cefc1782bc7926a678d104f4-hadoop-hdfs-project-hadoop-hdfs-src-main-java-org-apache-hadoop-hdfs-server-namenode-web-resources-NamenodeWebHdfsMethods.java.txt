merge from trunk r1602933

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/fs-encryption@1602947 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.collect.Lists;
-          final XAttrNameParam xattrName,
+          final List<XAttrNameParam> xattrNames,
-        renewer, bufferSize, xattrName, xattrEncoding);
+        renewer, bufferSize, xattrNames, xattrEncoding);
-          final XAttrNameParam xattrName,
+          final List<XAttrNameParam> xattrNames,
-        renewer, bufferSize, xattrName, xattrEncoding);
+        renewer, bufferSize, xattrEncoding);
-              xattrName, xattrEncoding);
+              xattrNames, xattrEncoding);
-      final XAttrNameParam xattrName,
+      final List<XAttrNameParam> xattrNames,
-    case GETXATTR: {
-      XAttr xAttr = XAttrHelper.getFirstXAttr(np.getXAttrs(fullpath,
-          XAttrHelper.buildXAttrAsList(xattrName.getXAttrName())));
-      final String js = JsonUtil.toJsonString(xAttr,
+    case GETXATTRS: {
+      List<String> names = null;
+      if (xattrNames != null) {
+        names = Lists.newArrayListWithCapacity(xattrNames.size());
+        for (XAttrNameParam xattrName : xattrNames) {
+          if (xattrName.getXAttrName() != null) {
+            names.add(xattrName.getXAttrName());
+          }
+        }
+      }
+      List<XAttr> xAttrs = np.getXAttrs(fullpath, (names != null && 
+          !names.isEmpty()) ? XAttrHelper.buildXAttrs(names) : null);
+      final String js = JsonUtil.toJsonString(xAttrs,
-    case GETXATTRS: {
-      List<XAttr> xAttrs = np.getXAttrs(fullpath, null);
-      final String js = JsonUtil.toJsonString(xAttrs,
-          xattrEncoding.getEncoding());
+    case LISTXATTRS: {
+      final List<XAttr> xAttrs = np.listXAttrs(fullpath);
+      final String js = JsonUtil.toJsonString(xAttrs);
