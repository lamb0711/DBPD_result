Merge trunk to HDFS-4685.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-4685@1566100 13f79535-47bb-0310-9956-ffa450edef68

-  private volatile boolean success;
-      result = appMaster.run();
-      appMaster.finish();
+      appMaster.run();
+      result = appMaster.finish();
-  public boolean run() throws YarnException, IOException {
+  public void run() throws YarnException, IOException {
-    return success;
-  protected void finish() {
+  @VisibleForTesting
+  protected boolean finish() {
-    success = true;
+    boolean success = true;
+
+    return success;
