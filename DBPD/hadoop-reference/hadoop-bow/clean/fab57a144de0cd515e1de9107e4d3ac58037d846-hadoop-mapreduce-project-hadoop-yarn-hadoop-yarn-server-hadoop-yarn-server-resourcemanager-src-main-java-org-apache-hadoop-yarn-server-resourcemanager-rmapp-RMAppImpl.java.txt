MAPREDUCE-3792. Fix "bin/mapred job -list" to display all jobs instead of only the jobs owned by the user. Contributed by Jason Lowe.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1296721 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.server.resourcemanager.resource.Resources;
+  private static final String UNAVAILABLE = "N/A";
+  private static final ApplicationResourceUsageReport
+    DUMMY_APPLICATION_RESOURCE_USAGE_REPORT =
+      BuilderUtils.newApplicationResourceUsageReport(-1, -1,
+          Resources.createResource(-1), Resources.createResource(-1),
+          Resources.createResource(-1));
+
-  public ApplicationReport createAndGetApplicationReport() {
+  public ApplicationReport createAndGetApplicationReport(boolean allowAccess) {
-      String clientToken = "N/A";
-      String trackingUrl = "N/A";
-      String host = "N/A";
-      String origTrackingUrl = "N/A";
+      String clientToken = UNAVAILABLE;
+      String trackingUrl = UNAVAILABLE;
+      String host = UNAVAILABLE;
+      String origTrackingUrl = UNAVAILABLE;
-      if (this.currentAttempt != null) {
-        trackingUrl = this.currentAttempt.getTrackingUrl();
-        origTrackingUrl = this.currentAttempt.getOriginalTrackingUrl();
-        clientToken = this.currentAttempt.getClientToken();
-        host = this.currentAttempt.getHost();
-        rpcPort = this.currentAttempt.getRpcPort();
-        appUsageReport = currentAttempt.getApplicationResourceUsageReport();
+      String diags = UNAVAILABLE;
+      if (allowAccess) {
+        if (this.currentAttempt != null) {
+          trackingUrl = this.currentAttempt.getTrackingUrl();
+          origTrackingUrl = this.currentAttempt.getOriginalTrackingUrl();
+          clientToken = this.currentAttempt.getClientToken();
+          host = this.currentAttempt.getHost();
+          rpcPort = this.currentAttempt.getRpcPort();
+          appUsageReport = currentAttempt.getApplicationResourceUsageReport();
+        }
+        diags = this.diagnostics.toString();
+      } else {
+        appUsageReport = DUMMY_APPLICATION_RESOURCE_USAGE_REPORT;
-          this.diagnostics.toString(), trackingUrl,
+          diags, trackingUrl,
