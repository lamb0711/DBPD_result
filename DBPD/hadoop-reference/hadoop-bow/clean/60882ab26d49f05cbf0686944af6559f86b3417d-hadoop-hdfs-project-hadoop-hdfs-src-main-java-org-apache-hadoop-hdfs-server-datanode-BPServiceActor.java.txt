HDFS-7990. IBR delete ack should not be delayed. Contributed by Daryn Sharp.

-  // lastBlockReport, lastDeletedReport and lastHeartbeat may be assigned/read
+  // lastBlockReport and lastHeartbeat may be assigned/read
-  volatile long lastDeletedReport = 0;
-      lastDeletedReport = 0;
+      sendImmediateIBR = true;
-      while (lastDeletedReport == 0) {
+      while (sendImmediateIBR) {
-    lastDeletedReport = startTime;
-        + " DELETEREPORT_INTERVAL of " + dnConf.deleteReportInterval + " msec "
-        if (startTime - lastHeartbeat >= dnConf.heartBeatInterval) {
+        boolean sendHeartbeat =
+            startTime - lastHeartbeat >= dnConf.heartBeatInterval;
+        if (sendHeartbeat) {
-        if (sendImmediateIBR ||
-            (startTime - lastDeletedReport > dnConf.deleteReportInterval)) {
+        if (sendImmediateIBR || sendHeartbeat) {
-          lastDeletedReport = startTime;
