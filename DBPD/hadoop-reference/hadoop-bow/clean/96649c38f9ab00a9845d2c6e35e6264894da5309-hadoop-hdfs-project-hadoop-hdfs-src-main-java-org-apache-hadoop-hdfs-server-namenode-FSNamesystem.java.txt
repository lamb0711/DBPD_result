HDFS-8035. Move checkBlocksProperlyReplicated() in FSNamesystem to BlockManager. Contributed by Haohui Mai.

-  BlockInfoContiguous saveAllocatedBlock(String src, INodesInPath inodesInPath,
+  private void saveAllocatedBlock(String src, INodesInPath inodesInPath,
-          throws IOException {
+      throws IOException {
-    return b;
-  Block createNewBlock() throws IOException {
+  private Block createNewBlock() throws IOException {
-        // check all blocks of the file.
-        for (BlockInfoContiguous block: v.getBlocks()) {
-          if (!isCompleteBlock(src, block, blockManager.minReplication)) {
-            return false;
-          }
-        }
+        return blockManager.checkBlocksProperlyReplicated(src, v
+            .getBlocks());
-        if (b != null
-            && !isCompleteBlock(src, b, blockManager.minReplication)) {
-          return false;
-        }
+        return b == null ||
+            blockManager.checkBlocksProperlyReplicated(
+                src, new BlockInfoContiguous[] { b });
-      return true;
-  private static boolean isCompleteBlock(String src, BlockInfoContiguous b, int minRepl) {
-    if (!b.isComplete()) {
-      final BlockInfoContiguousUnderConstruction uc = (BlockInfoContiguousUnderConstruction)b;
-      final int numNodes = b.numNodes();
-      LOG.info("BLOCK* " + b + " is not COMPLETE (ucState = "
-          + uc.getBlockUCState() + ", replication# = " + numNodes
-          + (numNodes < minRepl? " < ": " >= ")
-          + " minimum = " + minRepl + ") in file " + src);
-      return false;
-    }
-    return true;
-  }
-
-  ////////////////////////////////////////////////////////////////
-  // Here's how to handle block-copy failure during client write:
-  // -- As usual, the client's write should result in a streaming
-  // backup write to a k-machine sequence.
-  // -- If one of the backup machines fails, no worries.  Fail silently.
-  // -- Before client is allowed to close and finalize file, make sure
-  // that the blocks are backed up.  Namenode may have to issue specific backup
-  // commands to make up for earlier datanode failures.  Once all copies
-  // are made, edit namespace and return to client.
-  ////////////////////////////////////////////////////////////////
-
-  /** 
+  /**
