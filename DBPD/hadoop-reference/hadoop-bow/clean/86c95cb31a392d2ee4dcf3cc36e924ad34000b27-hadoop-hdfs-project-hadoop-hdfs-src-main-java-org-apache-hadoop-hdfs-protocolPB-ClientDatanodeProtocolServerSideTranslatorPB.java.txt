HDFS-9414. Refactor reconfiguration of ClientDatanodeProtocol for reusability. (Contributed by Xiaobing Zhou)

-import java.util.Map;
-import com.google.common.base.Optional;
-import org.apache.hadoop.conf.ReconfigurationTaskStatus;
-import org.apache.hadoop.conf.ReconfigurationUtil.PropertyChange;
-import org.apache.hadoop.hdfs.protocol.proto.ClientDatanodeProtocolProtos.GetReconfigurationStatusConfigChangeProto;
-import org.apache.hadoop.hdfs.protocol.proto.ClientDatanodeProtocolProtos.GetReconfigurationStatusRequestProto;
-import org.apache.hadoop.hdfs.protocol.proto.ClientDatanodeProtocolProtos.GetReconfigurationStatusResponseProto;
+import org.apache.hadoop.hdfs.protocol.proto.ReconfigurationProtocolProtos.GetReconfigurationStatusRequestProto;
+import org.apache.hadoop.hdfs.protocol.proto.ReconfigurationProtocolProtos.GetReconfigurationStatusResponseProto;
-import org.apache.hadoop.hdfs.protocol.proto.ClientDatanodeProtocolProtos.ListReconfigurablePropertiesRequestProto;
-import org.apache.hadoop.hdfs.protocol.proto.ClientDatanodeProtocolProtos.ListReconfigurablePropertiesResponseProto;
+import org.apache.hadoop.hdfs.protocol.proto.ReconfigurationProtocolProtos.ListReconfigurablePropertiesRequestProto;
+import org.apache.hadoop.hdfs.protocol.proto.ReconfigurationProtocolProtos.ListReconfigurablePropertiesResponseProto;
-import org.apache.hadoop.hdfs.protocol.proto.ClientDatanodeProtocolProtos.StartReconfigurationRequestProto;
-import org.apache.hadoop.hdfs.protocol.proto.ClientDatanodeProtocolProtos.StartReconfigurationResponseProto;
+import org.apache.hadoop.hdfs.protocol.proto.ReconfigurationProtocolProtos.StartReconfigurationRequestProto;
+import org.apache.hadoop.hdfs.protocol.proto.ReconfigurationProtocolProtos.StartReconfigurationResponseProto;
-    throws ServiceException {
+      throws ServiceException {
-        RpcController controller,
-        ListReconfigurablePropertiesRequestProto request)
+      RpcController controller,
+      ListReconfigurablePropertiesRequestProto request)
-    ListReconfigurablePropertiesResponseProto.Builder builder =
-        ListReconfigurablePropertiesResponseProto.newBuilder();
-      for (String name : impl.listReconfigurableProperties()) {
-        builder.addName(name);
-      }
+      return ReconfigurationProtocolServerSideUtils
+          .listReconfigurableProperties(impl.listReconfigurableProperties());
-    return builder.build();
-    GetReconfigurationStatusResponseProto.Builder builder =
-        GetReconfigurationStatusResponseProto.newBuilder();
-      ReconfigurationTaskStatus status = impl.getReconfigurationStatus();
-      builder.setStartTime(status.getStartTime());
-      if (status.stopped()) {
-        builder.setEndTime(status.getEndTime());
-        assert status.getStatus() != null;
-        for (Map.Entry<PropertyChange, Optional<String>> result :
-            status.getStatus().entrySet()) {
-          GetReconfigurationStatusConfigChangeProto.Builder changeBuilder =
-              GetReconfigurationStatusConfigChangeProto.newBuilder();
-          PropertyChange change = result.getKey();
-          changeBuilder.setName(change.prop);
-          changeBuilder.setOldValue(change.oldVal != null ? change.oldVal : "");
-          if (change.newVal != null) {
-            changeBuilder.setNewValue(change.newVal);
-          }
-          if (result.getValue().isPresent()) {
-            // Get full stack trace.
-            changeBuilder.setErrorMessage(result.getValue().get());
-          }
-          builder.addChanges(changeBuilder);
-        }
-      }
+      return ReconfigurationProtocolServerSideUtils
+          .getReconfigurationStatus(impl.getReconfigurationStatus());
-    return builder.build();
