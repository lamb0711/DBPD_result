HDDS-868. Handle quasi closed container replicas in SCM.
Contributed by Nanda kumar.

+import java.io.IOException;
+
+        ReportHandlerHelper.processContainerReplica(containerManager,
+            containerID, replicaProto, datanodeDetails, publisher, LOG);
+
-        updateContainerState(datanodeDetails, containerInfo,
-            replicaProto, publisher);
+
-        LOG.error("Received container report for an unknown container {}",
-            replicaProto.getContainerID());
+        LOG.error("Received container report for an unknown container {} from" +
+                " datanode {}", replicaProto.getContainerID(), datanodeDetails);
+      } catch (IOException e) {
+        LOG.error("Exception while processing container report for container" +
+                " {} from datanode {}",
+            replicaProto.getContainerID(), datanodeDetails);
-  private void updateContainerState(final DatanodeDetails datanodeDetails,
-      final ContainerInfo containerInfo,
-      final ContainerReplicaProto replicaProto,
-      final EventPublisher publisher)
-      throws ContainerNotFoundException {
-
-    final ContainerID id = containerInfo.containerID();
-    final ContainerReplica datanodeContainerReplica = ContainerReplica
-        .newBuilder()
-        .setContainerID(id)
-        .setContainerState(replicaProto.getState())
-        .setDatanodeDetails(datanodeDetails)
-        .build();
-    // TODO: Add bcsid and origin datanode to replica.
-
-    final ContainerReplica scmContainerReplica = containerManager
-        .getContainerReplicas(id)
-        .stream()
-        .filter(replica ->
-            replica.getDatanodeDetails().equals(datanodeDetails))
-        .findFirst().orElse(null);
-
-    // This is an in-memory update.
-    containerManager.updateContainerReplica(id, datanodeContainerReplica);
-    containerInfo.setUsedBytes(replicaProto.getUsed());
-    containerInfo.setNumberOfKeys(replicaProto.getKeyCount());
-
-    // Check if there is state change in container replica.
-    if (scmContainerReplica == null ||
-        scmContainerReplica.getState() != datanodeContainerReplica.getState()) {
-      //TODO: Handler replica state change.
-    }
-  }
-
