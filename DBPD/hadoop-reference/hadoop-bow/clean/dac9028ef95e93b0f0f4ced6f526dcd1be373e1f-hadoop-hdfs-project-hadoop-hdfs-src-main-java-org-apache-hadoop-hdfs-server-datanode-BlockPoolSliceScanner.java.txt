HDFS-6355. Fix divide-by-zero, improper use of wall-clock time in BlockPoolSliceScanner (cmccabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1594338 13f79535-47bb-0310-9956-ffa450edef68

-  private long currentPeriodStart = Time.now();
+  private long currentPeriodStart = Time.monotonicNow();
-    return Time.now() - scanPeriod + 
+    return Time.monotonicNow() - scanPeriod +
-    long now = Time.now();
+    long now = Time.monotonicNow();
-    long timeLeft = currentPeriodStart+scanPeriod - Time.now();
-    long bw = Math.max(bytesLeft*1000/timeLeft, MIN_SCAN_RATE);
+    long timeLeft = Math.max(1L,
+        currentPeriodStart + scanPeriod - Time.monotonicNow());
+    long bw = Math.max((bytesLeft * 1000) / timeLeft, MIN_SCAN_RATE);
-      long now = Time.now();
+      long now = Time.monotonicNow();
-      long lastScanTime = Time.now() - scanPeriod;
+      long lastScanTime = Time.monotonicNow() - scanPeriod;
-    currentPeriodStart = Time.now();
+    currentPeriodStart = Time.monotonicNow();
-    if (bytesLeft <= 0 && Time.now() < currentPeriodStart + scanPeriod) {
+    if (bytesLeft <= 0 && Time.monotonicNow() < currentPeriodStart + scanPeriod) {
-                  Time.now() + " " + blockPoolId);
+                  Time.monotonicNow() + " " + blockPoolId);
-      lastScanTime.set(Time.now());
+      lastScanTime.set(Time.monotonicNow());
-        long now = Time.now();
+        long now = Time.monotonicNow();
-    long now = Time.now();
+    long now = Time.monotonicNow();
