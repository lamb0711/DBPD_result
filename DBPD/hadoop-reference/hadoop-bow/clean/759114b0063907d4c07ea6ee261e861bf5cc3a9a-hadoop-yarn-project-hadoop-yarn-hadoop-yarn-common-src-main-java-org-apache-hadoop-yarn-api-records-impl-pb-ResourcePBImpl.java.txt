YARN-4830. Add support for resource types in the nodemanager. Contributed by Varun Vasudev.

-
+import org.apache.commons.logging.Log;
+import org.apache.commons.logging.LogFactory;
+  private static final Log LOG = LogFactory.getLog(ResourcePBImpl.class);
+
-    initResourcesMap();
+    initResources();
-    return UnitsConversionUtil.convert(ri.getUnits(), "Mi", ri.getValue());
+    return UnitsConversionUtil
+        .convert(ri.getUnits(), ResourceInformation.MEMORY_MB.getUnits(),
+            ri.getValue());
-    initResourcesMap();
+    initResources();
-    try {
-      setResourceValue(ResourceInformation.VCORES.getName(),
-          Long.valueOf(vCores));
-    } catch (ResourceNotFoundException re) {
-      this.setResourceInformation(ResourceInformation.VCORES.getName(),
-          ResourceInformation.newInstance(ResourceInformation.VCORES.getName(),
-              (long) vCores));
-    }
+    setResourceInformation(ResourceInformation.VCORES.getName(),
+        ResourceInformation.newInstance(ResourceInformation.VCORES.getName(),
+            ResourceInformation.VCORES.getUnits(), (long) vCores));
-      resources.put(ri.getName(), ri);
+      if (resources.containsKey(ri.getName())) {
+        resources.get(ri.getName()).setResourceType(ri.getResourceType());
+        resources.get(ri.getName()).setUnits(ri.getUnits());
+        resources.get(ri.getName()).setValue(value);
+      } else {
+        LOG.warn("Got unknown resource type: " + ri.getName() + "; skipping");
+      }
-    if(this.getMemory() != p.getMemory()) {
-      setMemorySize(p.getMemory());
-    }
-    if(this.getVirtualCores() != p.getVirtualCores()) {
-      setVirtualCores(p.getVirtualCores());
-    }
+    this.setMemorySize(p.getMemory());
+    this.setVirtualCores(p.getVirtualCores());
-    initResourcesMap();
+    initResources();
+    initResources();
-    ResourceInformation ri = resources.get(resource);
-    ri.setValue(value);
-    resources.put(resource, ri);
+    resources.get(resource).setValue(value);
-      for (Map.Entry<String, ResourceInformation> entry : resources.entrySet()) {
-        ResourceInformationProto.Builder e = ResourceInformationProto.newBuilder();
+      for (Map.Entry<String, ResourceInformation> entry :
+          resources.entrySet()) {
+        ResourceInformationProto.Builder e =
+            ResourceInformationProto.newBuilder();
