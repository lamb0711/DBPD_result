HDFS-4248. Renaming directories may incorrectly remove the paths in leases under the tree.  Contributed by daryn


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1416064 13f79535-47bb-0310-9956-ffa450edef68

+      //NOTE: yes, this is bad!  it's assuming much lower level behavior
+      //      of rewriting the dst
-    HdfsFileStatus dinfo = dir.getFileInfo(dst, false);
-      unprotectedChangeLease(src, dst, dinfo);     // update lease with new filename
-    HdfsFileStatus dinfo = dir.getFileInfo(dst, false);
-    unprotectedChangeLease(src, dst, dinfo); // update lease with new filename
-  void unprotectedChangeLease(String src, String dst, HdfsFileStatus dinfo) {
-    String overwrite;
-    String replaceBy;
+  void unprotectedChangeLease(String src, String dst) {
-
-    boolean destinationExisted = true;
-    if (dinfo == null) {
-      destinationExisted = false;
-    }
-
-    if (destinationExisted && dinfo.isDir()) {
-      Path spath = new Path(src);
-      Path parent = spath.getParent();
-      if (parent.isRoot()) {
-        overwrite = parent.toString();
-      } else {
-        overwrite = parent.toString() + Path.SEPARATOR;
-      }
-      replaceBy = dst + Path.SEPARATOR;
-    } else {
-      overwrite = src;
-      replaceBy = dst;
-    }
-
-    leaseManager.changeLease(src, dst, overwrite, replaceBy);
+    leaseManager.changeLease(src, dst);
