YARN-4358. Reservation System: Improve relationship between SharingPolicy and ReservationAgent. (Carlo Curino via asuresh)

-import java.util.Set;
+import java.util.Map.Entry;
-        computeJobAllocation(plan, reservationId, adjustedContract);
+        computeJobAllocation(plan, reservationId, adjustedContract, user);
-            findEarliestTime(mapAllocations.keySet()), // Earliest start time
-            findLatestTime(mapAllocations.keySet()), // Latest end time
+            findEarliestTime(mapAllocations), // Earliest start time
+            findLatestTime(mapAllocations), // Latest end time
-    long earliestStart = findEarliestTime(mapAllocations.keySet());
+    long earliestStart = findEarliestTime(mapAllocations);
-    long latestEnd = findLatestTime(mapAllocations.keySet());
+    long latestEnd = findLatestTime(mapAllocations);
-      ReservationId reservationId, ReservationDefinition reservation)
-      throws PlanningException, ContractValidationException;
+      ReservationId reservationId, ReservationDefinition reservation,
+      String user) throws PlanningException, ContractValidationException;
-  protected static long findEarliestTime(Set<ReservationInterval> sesInt) {
+  protected static long findEarliestTime(
+      Map<ReservationInterval, Resource> sesInt) {
-    for (ReservationInterval s : sesInt) {
-      if (s.getStartTime() < ret) {
-        ret = s.getStartTime();
+    for (Entry<ReservationInterval, Resource> s : sesInt.entrySet()) {
+      if (s.getKey().getStartTime() < ret && s.getValue() != null) {
+        ret = s.getKey().getStartTime();
-  protected static long findLatestTime(Set<ReservationInterval> sesInt) {
+  protected static long findLatestTime(Map<ReservationInterval,
+      Resource> sesInt) {
-    for (ReservationInterval s : sesInt) {
-      if (s.getEndTime() > ret) {
-        ret = s.getEndTime();
+    for (Entry<ReservationInterval, Resource> s : sesInt.entrySet()) {
+      if (s.getKey().getEndTime() > ret && s.getValue() != null) {
+        ret = s.getKey().getEndTime();
