Merge trunk into HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1196458 13f79535-47bb-0310-9956-ffa450edef68

+import javax.servlet.http.HttpServletResponse;
+import javax.ws.rs.core.Context;
+import com.sun.jersey.api.ParamException;
+
+  private @Context HttpServletResponse response;
+
-  public Response toResponse(final Exception e) {
+  public Response toResponse(Exception e) {
+    //clear content type
+    response.setContentType(null);
+
+    //Convert exception
+    if (e instanceof ParamException) {
+      final ParamException paramexception = (ParamException)e;
+      e = new IllegalArgumentException("Invalid value for webhdfs parameter \""
+          + paramexception.getParameterName() + "\": "
+          + e.getCause().getMessage(), e);
+    } 
+
+    //Map response status
+    } else if (e instanceof IllegalArgumentException) {
+      s = Response.Status.BAD_REQUEST;
+      LOG.warn("INTERNAL_SERVER_ERROR", e);
