MAPREDUCE-3787. [Gridmix] Optimize job monitoring and STRESS mode for faster job submission. (amarrk)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1292736 13f79535-47bb-0310-9956-ffa450edef68

+  private int totalLostJobs;
-  private void processJobState(JobStats stats) throws Exception {
+  private void processJobState(JobStats stats) {
-    if (job.isSuccessful()) {
-      ++totalSuccessfulJobs;
-    } else {
-      ++totalFailedJobs;
+    try {
+      if (job.isSuccessful()) {
+        ++totalSuccessfulJobs;
+      } else {
+        ++totalFailedJobs;
+      }
+    } catch (Exception e) {
+      // this behavior is consistent with job-monitor which marks the job as 
+      // complete (lost) if the status polling bails out
+      ++totalLostJobs; 
-  private void processJobTasks(JobStats stats) throws Exception {
+  private void processJobTasks(JobStats stats) {
-    Job job = stats.getJob();
-    totalReduceTasksLaunched += job.getNumReduceTasks();
+    totalReduceTasksLaunched += stats.getNoOfReds();
-    try {
-      // process the job run state
-      processJobState(stats);
-      
-      // process the tasks information
-      processJobTasks(stats);
-    } catch (Exception e) {
-      LOG.info("Error in processing job " + stats.getJob().getJobID() + ".");
-    }
+    // process the job run state
+    processJobState(stats);
+
+    // process the tasks information
+    processJobTasks(stats);
+    builder.append("\nTotal number of lost jobs: ")
+           .append(getNumLostJobs());
+  protected int getNumLostJobs() {
+    return totalLostJobs;
+  }
+  
-    return totalSuccessfulJobs + totalFailedJobs;
+    return totalSuccessfulJobs + totalFailedJobs + totalLostJobs;
