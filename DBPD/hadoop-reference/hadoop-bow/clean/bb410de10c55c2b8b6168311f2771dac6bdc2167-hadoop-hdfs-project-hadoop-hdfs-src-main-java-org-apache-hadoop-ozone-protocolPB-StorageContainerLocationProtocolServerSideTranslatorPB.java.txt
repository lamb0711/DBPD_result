HDFS-11184. Ozone: SCM: Make SCM use container protocol. Contributed by Anu Engineer.

- *     http://www.apache.org/licenses/LICENSE-2.0
+ * http://www.apache.org/licenses/LICENSE-2.0
-import org.apache.hadoop.ozone.protocol.proto.StorageContainerLocationProtocolProtos.GetStorageContainerLocationsRequestProto;
-import org.apache.hadoop.ozone.protocol.proto.StorageContainerLocationProtocolProtos.GetStorageContainerLocationsResponseProto;
-import org.apache.hadoop.ozone.protocol.proto.StorageContainerLocationProtocolProtos.LocatedContainerProto;
-import org.apache.hadoop.ozone.protocol.proto.StorageContainerLocationProtocolProtos.ContainerResponseProto;
+import org.apache.hadoop.ozone.protocol.proto
+    .StorageContainerLocationProtocolProtos
+    .GetStorageContainerLocationsRequestProto;
+import org.apache.hadoop.ozone.protocol.proto
+    .StorageContainerLocationProtocolProtos
+    .GetStorageContainerLocationsResponseProto;
+import org.apache.hadoop.ozone.protocol.proto
+    .StorageContainerLocationProtocolProtos.LocatedContainerProto;
+import org.apache.hadoop.ozone.protocol.proto
+    .StorageContainerLocationProtocolProtos.ContainerResponseProto;
+
+import org.apache.hadoop.scm.container.common.helpers.Pipeline;
-    for (String key: req.getKeysList()) {
+    for (String key : req.getKeysList()) {
-    for (LocatedContainer locatedContainer: locatedContainers) {
+    for (LocatedContainer locatedContainer : locatedContainers) {
-          .setKey(locatedContainer.getKey())
-          .setMatchedKeyPrefix(locatedContainer.getMatchedKeyPrefix())
-          .setContainerName(locatedContainer.getContainerName());
-      for (DatanodeInfo location: locatedContainer.getLocations()) {
+              .setKey(locatedContainer.getKey())
+              .setMatchedKeyPrefix(locatedContainer.getMatchedKeyPrefix())
+              .setContainerName(locatedContainer.getContainerName());
+      for (DatanodeInfo location : locatedContainer.getLocations()) {
-    return null;
+    try {
+      Pipeline pipeline = impl.allocateContainer(request.getContainerName());
+      return ContainerResponseProto.newBuilder()
+          .setPipeline(pipeline.getProtobufMessage())
+          .setErrorCode(ContainerResponseProto.Error.success)
+          .build();
+
+    } catch (IOException e) {
+      throw new ServiceException(e);
+    }
