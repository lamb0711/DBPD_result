YARN-9147. Rmove auxiliary services when manifest file is removed.
           Contributed by Billie Rinaldi

+import com.google.common.annotations.VisibleForTesting;
+      LOG.info("Removing aux service " + sName);
-  private synchronized void loadManifest(Configuration conf, boolean
+  @VisibleForTesting
+  protected synchronized void loadManifest(Configuration conf, boolean
+    if (manifest == null) {
+      return;
+    }
+    if (!manifestFS.exists(manifest)) {
+      if (serviceMap.isEmpty()) {
+        return;
+      }
+      LOG.info("Manifest file " + manifest + " doesn't exist, stopping " +
+          "auxiliary services");
+      Set<String> servicesToRemove = new HashSet<>(serviceMap.keySet());
+      for (String sName : servicesToRemove) {
+        maybeRemoveAuxService(sName);
+      }
+      return;
+    }
-    List<String> servicesToRemove = new ArrayList<>();
-    for (String sName : serviceMap.keySet()) {
-      if (!loadedAuxServices.contains(sName)) {
-        foundChanges = true;
-        servicesToRemove.add(sName);
-      }
-    }
+    Set<String> servicesToRemove = new HashSet<>(serviceMap.keySet());
+    servicesToRemove.removeAll(loadedAuxServices);
-      LOG.info("Removing aux service " + sName);
+      foundChanges = true;
