HDFS-5042. Completed files lost after power failure. Contributed by Vinayakumar B.

+  private volatile boolean dirSyncOnFinalize;
+      // sync directory for finalize irrespective of syncOnClose config since
+      // sync is requested.
+      this.dirSyncOnFinalize = true;
+    dirSyncOnFinalize = syncOnClose;
-            datanode.data.finalizeBlock(block);
+            datanode.data.finalizeBlock(block, dirSyncOnFinalize);
-        datanode.data.finalizeBlock(block);
+        datanode.data.finalizeBlock(block, dirSyncOnFinalize);
