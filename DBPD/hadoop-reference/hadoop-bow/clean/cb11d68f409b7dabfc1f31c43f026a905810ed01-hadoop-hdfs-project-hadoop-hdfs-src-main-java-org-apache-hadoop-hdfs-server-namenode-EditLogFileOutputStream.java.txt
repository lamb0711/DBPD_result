HDFS-4677. Editlog should support synchronous writes. Contributed by Ivan Mitic.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1491096 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.conf.Configuration;
+import org.apache.hadoop.hdfs.DFSConfigKeys;
+  private boolean shouldSyncWritesAndSkipFsync = false;
+   * @param conf
+   *          Configuration object
-  public EditLogFileOutputStream(File name, int size) throws IOException {
+  public EditLogFileOutputStream(Configuration conf, File name, int size)
+      throws IOException {
+    shouldSyncWritesAndSkipFsync = conf.getBoolean(
+            DFSConfigKeys.DFS_NAMENODE_EDITS_NOEDITLOGCHANNELFLUSH,
+            DFSConfigKeys.DFS_NAMENODE_EDITS_NOEDITLOGCHANNELFLUSH_DEFAULT);
+
-    RandomAccessFile rp = new RandomAccessFile(name, "rw");
+    RandomAccessFile rp;
+    if (shouldSyncWritesAndSkipFsync) {
+      rp = new RandomAccessFile(name, "rws");
+    } else {
+      rp = new RandomAccessFile(name, "rw");
+    }
-    preallocate(); // preallocate file if necessay
+    preallocate(); // preallocate file if necessary
-    if (durable && !shouldSkipFsyncForTests) {
+    if (durable && !shouldSkipFsyncForTests && !shouldSyncWritesAndSkipFsync) {
