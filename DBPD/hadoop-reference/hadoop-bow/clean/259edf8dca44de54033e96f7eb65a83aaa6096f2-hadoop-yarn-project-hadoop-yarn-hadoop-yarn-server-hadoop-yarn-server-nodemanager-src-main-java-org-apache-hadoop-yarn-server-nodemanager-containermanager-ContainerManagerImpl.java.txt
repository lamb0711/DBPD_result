YARN-571. Remove user from ContainerLaunchContext. Contributed by Omkar Vinit Joshi.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1485928 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.ByteArrayInputStream;
-import java.io.DataInputStream;
+import org.apache.hadoop.yarn.util.BuilderUtils;
-import com.google.protobuf.RpcUtil;
-      ContainerToken containerToken = container.getContainerToken();
-      Token<ContainerTokenIdentifier> token =
-          new Token<ContainerTokenIdentifier>(containerToken.getIdentifier()
-            .array(), containerToken.getPassword().array(), new Text(
-            containerToken.getKind()), new Text(containerToken.getService()));
-        return token.decodeIdentifier();
+        return BuilderUtils.newContainerTokenIdentifier(container
+          .getContainerToken());
-
-        // Is the container coming in with correct user-name?
-        if (!launchContext.getUser().equals(tokenId.getApplicationSubmitter())) {
-          unauthorized = true;
-          messageBuilder.append("\n Expected user-name "
-              + tokenId.getApplicationSubmitter() + " but found "
-              + launchContext.getUser());
-        }
-
-        + launchContext.getUser());
+        + tokenId.getApplicationSubmitter());
+    String user = tokenId.getApplicationSubmitter();
-        launchContext, lauchContainer, credentials, metrics);
+        launchContext, lauchContainer, credentials, metrics, tokenId);
-      NMAuditLogger.logFailure(launchContext.getUser(), 
+      NMAuditLogger.logFailure(user, 
-          launchContext.getUser(), applicationID, credentials, context);
+          user, applicationID, credentials,
+          context);
-    NMAuditLogger.logSuccess(launchContext.getUser(), 
+    NMAuditLogger.logSuccess(user, 
