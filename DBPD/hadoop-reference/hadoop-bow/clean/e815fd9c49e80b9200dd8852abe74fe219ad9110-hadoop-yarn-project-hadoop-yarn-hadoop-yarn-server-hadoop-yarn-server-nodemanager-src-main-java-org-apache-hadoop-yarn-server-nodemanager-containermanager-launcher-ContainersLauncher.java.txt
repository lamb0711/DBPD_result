YARN-9126.  Fix container clean up for reinitialization.
            Contributed by Chandni Singh

-import org.apache.hadoop.yarn.server.nodemanager.containermanager.container.Container;
+        cleanup(event, containerId, true);
+        break;
-        ContainerLaunch existingLaunch = running.remove(containerId);
-        if (existingLaunch == null) {
-          // Container not launched.
-          // triggering KILLING to CONTAINER_CLEANEDUP_AFTER_KILL transition.
-          dispatcher.getEventHandler().handle(
-              new ContainerExitEvent(containerId,
-                  ContainerEventType.CONTAINER_KILLED_ON_REQUEST,
-                  Shell.WINDOWS ? ContainerExecutor.ExitCode.FORCE_KILLED.getExitCode() :
-                  ContainerExecutor.ExitCode.TERMINATED.getExitCode(),
-                  "Container terminated before launch."));
-          return;
-        }
-
-        // Cleanup a container whether it is running/killed/completed, so that
-        // no sub-processes are alive.
-        ContainerCleanup cleanup = new ContainerCleanup(context, getConfig(),
-            dispatcher, exec, event.getContainer(), existingLaunch);
-        containerLauncher.submit(cleanup);
+        cleanup(event, containerId, false);
+
+  @VisibleForTesting
+  void cleanup(ContainersLauncherEvent event, ContainerId containerId,
+      boolean async) {
+    ContainerLaunch existingLaunch = running.remove(containerId);
+    if (existingLaunch == null) {
+      // Container not launched.
+      // triggering KILLING to CONTAINER_CLEANEDUP_AFTER_KILL transition.
+      dispatcher.getEventHandler().handle(
+          new ContainerExitEvent(containerId,
+              ContainerEventType.CONTAINER_KILLED_ON_REQUEST,
+              Shell.WINDOWS ?
+                  ContainerExecutor.ExitCode.FORCE_KILLED.getExitCode() :
+                  ContainerExecutor.ExitCode.TERMINATED.getExitCode(),
+              "Container terminated before launch."));
+      return;
+    }
+
+    // Cleanup a container whether it is running/killed/completed, so that
+    // no sub-processes are alive.
+    ContainerCleanup cleanup = new ContainerCleanup(context, getConfig(),
+        dispatcher, exec, event.getContainer(), existingLaunch);
+    if (async) {
+      containerLauncher.submit(cleanup);
+    } else {
+      cleanup.run();
+    }
+  }
