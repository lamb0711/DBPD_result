HDFS-12620. Backporting HDFS-10467 to branch-2. Contributed by Inigo Goiri.

-    for (String key : this.locations.keySet()) {
+    // We go from the leaves to the root
+    List<String> keys = new ArrayList<>(this.locations.keySet());
+    Collections.sort(keys, Collections.reverseOrder());
+    for (String key : keys) {
