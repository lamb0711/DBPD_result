HDDS-996. Incorrect data length gets updated in OM by client in case it hits exception in multiple successive block writes. Contributed by Shashikant Banerjee.

-      // write API of chunkOutputStream. Length can be in long range if it comes
+      // write API of blockOutputStream. Length can be in long range if it comes
-          writeLen = (int) (current.getWrittenDataLength() - currentPos);
+
+          // In the retryPath, the total data to be written will always be equal
+          // to or less than the max length of the buffer allocated.
+          // The len specified here is the combined sum of the data length of
+          // the buffers
+          Preconditions.checkState(!retry || len <= streamBufferMaxSize);
+          writeLen = retry ? (int) len :
+              (int) (current.getWrittenDataLength() - currentPos);
