HDFS-4988. Datanode must support all the volumes as individual storages.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1526969 13f79535-47bb-0310-9956-ffa450edef68

+    if (datanodeUuid == null) {
+      return null;
+    }
+
-      DatanodeDescriptor nodeS = datanodeMap.get(nodeReg.getDatanodeUuid());
+      DatanodeDescriptor nodeS = getDatanode(nodeReg.getDatanodeUuid());
-      } 
-  
-      // this is a new datanode serving a new data storage
-      if ("".equals(nodeReg.getDatanodeUuid())) {
-        // this data storage has never been registered
-        // it is either empty or was created by pre-storageID version of DFS
-        nodeReg.setDatanodeUuid(DatanodeStorage.newStorageID());
+      }
+
+      // This is a new datanode.
+      if (nodeReg.getDatanodeUuid() == null ||
+          nodeReg.getDatanodeUuid().isEmpty()) {
+        // this data node has never been registered
+        nodeReg.generateNewDatanodeUuid();
