HDFS-12975. [SBN read] Changes to the NameNode to support reads from standby. Contributed by Chao Sun.
+  public static final HAState OBSERVER_STATE = new StandbyState(true);
-    if (!haEnabled || startOpt == StartupOption.UPGRADE 
+    if (!haEnabled || startOpt == StartupOption.UPGRADE
+    } else if (startOpt == StartupOption.OBSERVER) {
+      return OBSERVER_STATE;
+      } else if (StartupOption.OBSERVER.getName().equalsIgnoreCase(cmd)) {
+        startOpt = StartupOption.OBSERVER;
+    if (state == OBSERVER_STATE) {
+      // TODO: we may need to remove this when enabling failover for observer
+      throw new ServiceFailedException(
+          "Cannot transition from Observer to Active");
+    }
+    if (state == OBSERVER_STATE) {
+      // TODO: we may need to remove this when enabling failover for observer
+      throw new ServiceFailedException(
+          "Cannot transition from Observer to Standby");
+    }
+    // TODO: maybe we should return a different result for observer namenode?
-        namesystem.startStandbyServices(getConf());
+        namesystem.startStandbyServices(getConf(),
+            state == NameNode.OBSERVER_STATE);
+      if (state == OBSERVER_STATE) {
+        return true;
+      }
+  public boolean isObserverState() {
+    return state.equals(OBSERVER_STATE);
+  }
+
