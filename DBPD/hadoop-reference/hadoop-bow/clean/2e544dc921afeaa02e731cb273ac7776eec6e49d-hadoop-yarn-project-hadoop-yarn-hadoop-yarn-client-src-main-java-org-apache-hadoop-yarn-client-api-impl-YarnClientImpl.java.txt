YARN-9129. Ensure flush after printing to log plus additional cleanup. Contributed by Eric Yang

-        // Wait for Connect
-        // Send a message
-        session.getRemote().sendString("stty -echo");
-        session.getRemote().sendString("\r");
-        session.getRemote().flush();
-        socket.run();
+        if (session.isOpen()) {
+          socket.run();
+        }
