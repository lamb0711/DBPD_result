HDFS-2634. Standby needs to ingest latest edit logs before transitioning to active. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1212187 13f79535-47bb-0310-9956-ffa450edef68

-      if (!dir.fsImage.editLog.isOpenForWrite()) {
+      FSEditLog editLog = dir.fsImage.getEditLog();
+      
+      if (!editLog.isSegmentOpen()) {
-        dir.fsImage.editLog.initJournalsForWrite();
+        editLog.initJournalsForWrite();
-        dir.fsImage.editLog.recoverUnclosedStreams();
+        editLog.recoverUnclosedStreams();
+        
+        LOG.info("Catching up to latest edits from old active before " +
+            "taking over writer role in edits logs.");
+        editLogTailer.catchupDuringFailover();
+        
+        long nextTxId = dir.fsImage.getLastAppliedTxId() + 1;
+        LOG.info("Will take over writing edit logs at txnid " + 
+            nextTxId);
+        editLog.setNextTxId(nextTxId);
+
