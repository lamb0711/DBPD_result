HADOOP-8204. TestHealthMonitor fails occasionally. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1305199 13f79535-47bb-0310-9956-ffa450edef68

-  HAServiceState state;
+  volatile HAServiceState state;
+  boolean isHealthy = true;
+  boolean actUnreachable = false;
+        checkUnreachable();
+        if (!isHealthy) {
+          throw new HealthCheckFailedException("not healthy");
+        }
+        checkUnreachable();
+        checkUnreachable();
+        checkUnreachable();
+
+      private void checkUnreachable() throws IOException {
+        if (actUnreachable) {
+          throw new IOException("Connection refused (fake)");
+        }
+      }
