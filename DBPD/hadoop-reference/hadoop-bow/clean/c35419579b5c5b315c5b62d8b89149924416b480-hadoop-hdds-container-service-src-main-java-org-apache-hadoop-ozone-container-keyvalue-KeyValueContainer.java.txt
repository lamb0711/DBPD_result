HDDS-1016. Allow marking containers as unhealthy. Contributed by Arpit Agarwal.

+import static org.apache.hadoop.hdds.protocol.datanode.proto.ContainerProtos.Result.CONTAINER_NOT_OPEN;
+
-    volumeSet.readLock();
+    volumeSet.readLock();
-    updateContainerData(() ->
-        containerData.setState(ContainerDataProto.State.CLOSING));
+    writeLock();
+    try {
+      if (getContainerState() != ContainerDataProto.State.OPEN) {
+        throw new StorageContainerException(
+            "Attempting to close a " + getContainerState() + " container.",
+            CONTAINER_NOT_OPEN);
+      }
+      updateContainerData(() ->
+          containerData.setState(ContainerDataProto.State.CLOSING));
+    } finally {
+      writeUnlock();
+    }
+  }
+
+  @Override
+  public void markContainerUnhealthy() throws StorageContainerException {
+    writeLock();
+    try {
+      updateContainerData(() ->
+          containerData.setState(ContainerDataProto.State.UNHEALTHY));
+    } finally {
+      writeUnlock();
+    }
-    updateContainerData(containerData::quasiCloseContainer);
+    writeLock();
+    try {
+      updateContainerData(containerData::quasiCloseContainer);
+    } finally {
+      writeUnlock();
+    }
-    updateContainerData(containerData::closeContainer);
+    writeLock();
+    try {
+      updateContainerData(containerData::closeContainer);
+    } finally {
+      writeUnlock();
+    }
+
+  /**
+   *
+   * Must be invoked with the writeLock held.
+   *
+   * @param update
+   * @throws StorageContainerException
+   */
+    Preconditions.checkState(hasWriteLock());
-      writeLock();
-    } finally {
-      writeUnlock();
-  private void compactDB() throws StorageContainerException {
+  void compactDB() throws StorageContainerException {
-  public void update(Map<String, String> metadata, boolean forceUpdate)
+  public void update(
+      Map<String, String> metadata, boolean forceUpdate)
