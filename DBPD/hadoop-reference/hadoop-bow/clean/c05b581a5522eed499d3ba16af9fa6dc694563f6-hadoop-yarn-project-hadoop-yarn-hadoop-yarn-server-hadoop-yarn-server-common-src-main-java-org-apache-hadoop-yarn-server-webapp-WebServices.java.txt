YARN-2591. Fixed AHSWebServices to return FORBIDDEN(403) if the request user doesn't have access to the history data. Contributed by Zhijie Shen

+import java.lang.reflect.UndeclaredThrowableException;
+import org.apache.hadoop.security.authorize.AuthorizationException;
+import org.apache.hadoop.yarn.webapp.ForbiddenException;
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
+  private static void rewrapAndThrowException(Exception e) {
+    if (e instanceof UndeclaredThrowableException) {
+      if (e.getCause() instanceof AuthorizationException) {
+        throw new ForbiddenException(e.getCause());
+      } else {
+        throw new WebApplicationException(e.getCause());
+      }
+    } else {
+      if (e instanceof AuthorizationException) {
+        throw new ForbiddenException(e);
+      } else {
+        throw new WebApplicationException(e);
+      }
+    }
+  }
+
