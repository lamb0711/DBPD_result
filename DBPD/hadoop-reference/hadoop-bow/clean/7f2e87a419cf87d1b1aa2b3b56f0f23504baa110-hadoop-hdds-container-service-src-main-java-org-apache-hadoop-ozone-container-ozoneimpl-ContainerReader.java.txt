HDDS-1604. ContainerReader#initializeUsedBytes leaks DB reference. Coâ€¦ (#866)


-import org.apache.hadoop.ozone.container.common.utils.ContainerCache.ReferenceCountedDB;
+import org.apache.hadoop.ozone.container.common.utils.ReferenceCountedDB;
-    KeyValueBlockIterator blockIter = new KeyValueBlockIterator(
+    try (KeyValueBlockIterator blockIter = new KeyValueBlockIterator(
-        new File(container.getContainerData().getContainerPath()));
-    long usedBytes = 0;
+        new File(container.getContainerData().getContainerPath()))) {
+      long usedBytes = 0;
-    while (blockIter.hasNext()) {
-      BlockData block = blockIter.nextBlock();
-      long blockLen = 0;
+      while (blockIter.hasNext()) {
+        BlockData block = blockIter.nextBlock();
+        long blockLen = 0;
-      List<ContainerProtos.ChunkInfo> chunkInfoList = block.getChunks();
-      for (ContainerProtos.ChunkInfo chunk : chunkInfoList) {
-        ChunkInfo info = ChunkInfo.getFromProtoBuf(chunk);
-        blockLen += info.getLen();
+        List<ContainerProtos.ChunkInfo> chunkInfoList = block.getChunks();
+        for (ContainerProtos.ChunkInfo chunk : chunkInfoList) {
+          ChunkInfo info = ChunkInfo.getFromProtoBuf(chunk);
+          blockLen += info.getLen();
+        }
+
+        usedBytes += blockLen;
-      usedBytes += blockLen;
+      container.getContainerData().setBytesUsed(usedBytes);
-
-    container.getContainerData().setBytesUsed(usedBytes);
