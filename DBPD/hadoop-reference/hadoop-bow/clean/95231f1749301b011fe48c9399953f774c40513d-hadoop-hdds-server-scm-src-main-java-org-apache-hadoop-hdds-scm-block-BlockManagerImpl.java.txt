HDDS-362. Modify functions impacted by SCM chill mode in ScmBlockLocationProtocol. Contributed by Ajay Kumar.

+import org.apache.hadoop.hdds.protocol.proto.HddsProtos.ScmOps;
+import org.apache.hadoop.hdds.scm.server.ChillModePrecheck;
+import org.apache.hadoop.hdds.scm.server.Precheck;
+import org.apache.hadoop.hdds.server.events.EventHandler;
-public class BlockManagerImpl implements BlockManager, BlockmanagerMXBean {
+public class BlockManagerImpl implements EventHandler<Boolean>,
+    BlockManager, BlockmanagerMXBean {
+  private ChillModePrecheck chillModePrecheck;
+    chillModePrecheck = new ChillModePrecheck();
-
+    preCheck(ScmOps.allocateBlock, chillModePrecheck);
-    if (!nodeManager.isOutOfChillMode()) {
-      LOG.warn("Not out of Chill mode.");
-      throw new SCMException("Unable to create block while in chill mode",
-          CHILL_MODE_EXCEPTION);
-    }
-
+
+  /**
+   * Perform all prechecks for given operations.
+   *
+   * @param operation
+   * @param preChecks prechecks to be performed
+   */
+  public void preCheck(ScmOps operation, Precheck... preChecks)
+      throws SCMException {
+    for (Precheck preCheck : preChecks) {
+      preCheck.check(operation);
+    }
+  }
+
+  @Override
+  public void onMessage(Boolean inChillMode, EventPublisher publisher) {
+    this.chillModePrecheck.setInChillMode(inChillMode);
+  }
+
+  /**
+   * Returns status of scm chill mode determined by CHILL_MODE_STATUS event.
+   * */
+  public boolean isScmInChillMode() {
+    return this.chillModePrecheck.isInChillMode();
+  }
+
+  /**
+   * Get class logger.
+   * */
+  public static Logger getLogger() {
+    return LOG;
+  }
