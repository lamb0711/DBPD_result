HDFS-4692. Use timestamp as default snapshot names.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1467706 13f79535-47bb-0310-9956-ffa450edef68

-  public SnapshotManager getSnapshotManager() {
+  SnapshotManager getSnapshotManager() {
-  public void allowSnapshot(String path) throws SafeModeException, IOException {
+  void allowSnapshot(String path) throws SafeModeException, IOException {
-  public void disallowSnapshot(String path)
-      throws SafeModeException, IOException {
+  void disallowSnapshot(String path) throws SafeModeException, IOException {
-  public void createSnapshot(String snapshotRoot, String snapshotName)
+  String createSnapshot(String snapshotRoot, String snapshotName)
+    final String snapshotPath;
+      if (snapshotName == null || snapshotName.isEmpty()) {
+        snapshotName = Snapshot.generateDefaultSnapshotName();
+      }
+      dir.verifyMaxComponentLength(snapshotName, snapshotRoot, 0);
-        snapshotManager.createSnapshot(snapshotRoot, snapshotName);
+        snapshotPath = snapshotManager.createSnapshot(snapshotRoot, snapshotName);
-      Path rootPath = new Path(snapshotRoot, HdfsConstants.DOT_SNAPSHOT_DIR
-          + Path.SEPARATOR + snapshotName);
-      logAuditEvent(true, "createSnapshot", snapshotRoot, rootPath.toString(),
-          null);
+      logAuditEvent(true, "createSnapshot", snapshotRoot, snapshotPath, null);
+    return snapshotPath;
-  public void renameSnapshot(String path, String snapshotOldName,
+  void renameSnapshot(String path, String snapshotOldName,
-      // TODO: check if the new name is valid. May also need this for
-      // creationSnapshot
+      dir.verifyMaxComponentLength(snapshotNewName, path, 0);
-  public SnapshotDiffReport getSnapshotDiffReport(String path,
+  SnapshotDiffReport getSnapshotDiffReport(String path,
-  public void deleteSnapshot(String snapshotRoot, String snapshotName)
+  void deleteSnapshot(String snapshotRoot, String snapshotName)
