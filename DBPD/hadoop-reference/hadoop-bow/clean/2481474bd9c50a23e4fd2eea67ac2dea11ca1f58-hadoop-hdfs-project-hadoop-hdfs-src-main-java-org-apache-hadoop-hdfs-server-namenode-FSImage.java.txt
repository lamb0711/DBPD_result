HDFS-2634. Standby needs to ingest latest edit logs before transitioning to active. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1212187 13f79535-47bb-0310-9956-ffa450edef68

-        assert !editLog.isOpenForWrite() : "Edits log must not be open.";
+        assert !editLog.isSegmentOpen() : "Edits log must not be open.";
-    Preconditions.checkState(!editLog.isOpenForWrite(),
-        "edit log should not yet be open");
-    // TODO(HA): We shouldn't run this when coming up in standby state
-    editLog.recoverUnclosedStreams();
+    if (editLog.isOpenForWrite()) {
+      // We only want to recover streams if we're going into Active mode.
+      editLog.recoverUnclosedStreams();
+    }
-                                               inspector.getMaxSeenTxId());
+                                               inspector.getMaxSeenTxId(),
+                                               false);
-    boolean editLogWasOpen = editLog.isOpenForWrite();
+    boolean editLogWasOpen = editLog.isSegmentOpen();
