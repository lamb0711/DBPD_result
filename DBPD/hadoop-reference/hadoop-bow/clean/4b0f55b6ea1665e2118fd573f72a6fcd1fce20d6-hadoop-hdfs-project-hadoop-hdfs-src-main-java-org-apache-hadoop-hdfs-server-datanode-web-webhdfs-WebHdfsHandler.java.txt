HDFS-7766. Add a flag to WebHDFS op=CREATE to not respond with a 307 redirect (Ravi Prakash via aw)

+import static io.netty.handler.codec.http.HttpHeaderNames.ACCEPT;
+import static io.netty.handler.codec.http.HttpHeaderNames.ACCESS_CONTROL_ALLOW_HEADERS;
+import static io.netty.handler.codec.http.HttpHeaderNames.ACCESS_CONTROL_MAX_AGE;
+import static io.netty.handler.codec.http.HttpHeaderValues.KEEP_ALIVE;
+import static io.netty.handler.codec.http.HttpMethod.OPTIONS;
-import org.apache.hadoop.fs.ParentNotDirectoryException;
+    } else if(PutOpParam.Op.CREATE.name().equalsIgnoreCase(op)
+        && method == OPTIONS) {
+      allowCORSOnCreate(ctx);
+    resp.headers().set(ACCESS_CONTROL_ALLOW_ORIGIN, "*");
+
+  //Accept preflighted CORS requests
+  private void allowCORSOnCreate(ChannelHandlerContext ctx)
+    throws IOException, URISyntaxException {
+    DefaultHttpResponse response = new DefaultHttpResponse(HTTP_1_1, OK);
+    HttpHeaders headers = response.headers();
+    headers.set(ACCESS_CONTROL_ALLOW_ORIGIN, "*");
+    headers.set(ACCESS_CONTROL_ALLOW_HEADERS, ACCEPT);
+    headers.set(ACCESS_CONTROL_ALLOW_METHODS, PUT);
+    headers.set(ACCESS_CONTROL_MAX_AGE, 1728000);
+    headers.set(CONTENT_LENGTH, 0);
+    headers.set(CONNECTION, KEEP_ALIVE);
+
+    ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);
+  }
+
