HDFS-13596. NN restart fails after RollingUpgrade from 2.x to 3.x. Contributed by Fei Hui.

+          checkErasureCodingSupported("createWithEC");
+    checkErasureCodingSupported(operationName);
+    checkErasureCodingSupported(operationName);
+    checkErasureCodingSupported(operationName);
+    checkErasureCodingSupported(operationName);
+    checkErasureCodingSupported(operationName);
+    checkErasureCodingSupported(operationName);
+    checkErasureCodingSupported(operationName);
+    checkErasureCodingSupported(operationName);
+    checkErasureCodingSupported(operationName);
+
+  /**
+   * Check whether operation is supported.
+   * @param operationName the name of operation.
+   * @throws UnsupportedActionException throws UAE if not supported.
+   */
+  public void checkErasureCodingSupported(String operationName)
+      throws UnsupportedActionException {
+    if (!NameNodeLayoutVersion.supports(
+        NameNodeLayoutVersion.Feature.ERASURE_CODING,
+        getEffectiveLayoutVersion())) {
+      throw new UnsupportedActionException(operationName + " not supported.");
+    }
+  }
