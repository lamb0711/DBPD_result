HDFS-5009. Include storage information in the LocatedBlock.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1519691 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.blockmanagement.DatanodeStorageInfo;
+  /** Storage ID for each replica */
+  private String[] storageIDs;
-    this(b, locs, null, startOffset, corrupt);
+    this(b, locs, null, null, startOffset, corrupt);
-  public LocatedBlock(ExtendedBlock b, DatanodeInfo[] locs,
+  public static LocatedBlock createLocatedBlock(ExtendedBlock b,
+      DatanodeStorageInfo[] storages, long startOffset, boolean corrupt) {
+    final DatanodeInfo[] locs = new DatanodeInfo[storages.length];
+    final String[] storageIDs = new String[storages.length];
+    final StorageType[] storageType = new StorageType[storages.length];
+    for(int i = 0; i < storages.length; i++) {
+      locs[i] = storages[i].getDatanodeDescriptor();
+      storageIDs[i] = storages[i].getStorageID();
+      storageType[i] = storages[i].getStorageType();
+    }
+    return new LocatedBlock(b, locs, storageIDs, storageType, startOffset, corrupt);
+  }
+  public LocatedBlock(ExtendedBlock b, DatanodeInfo[] locs, String[] storageIDs,
+    this.storageIDs = storageIDs;
+  public String[] getStorageIDs() {
+    return storageIDs;
+  }
+
