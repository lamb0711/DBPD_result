HADOOP-14556. S3A to support Delegation Tokens.

Contributed by Steve Loughran.

+import com.google.common.annotations.VisibleForTesting;
+import org.apache.hadoop.fs.s3a.auth.NoAwsCredentialsException;
-import org.apache.hadoop.security.ProviderUtils;
-import static org.apache.hadoop.fs.s3a.Constants.ACCESS_KEY;
-import static org.apache.hadoop.fs.s3a.Constants.SECRET_KEY;
-  private String accessKey;
-  private String secretKey;
+  private final String accessKey;
+  private final String secretKey;
-  public SimpleAWSCredentialsProvider(URI uri, Configuration conf)
+  /**
+   * Build the credentials from a filesystem URI and configuration.
+   * @param uri FS URI
+   * @param conf configuration containing secrets/references to.
+   * @throws IOException failure
+   */
+  public SimpleAWSCredentialsProvider(final URI uri, final Configuration conf)
+      this(getAWSAccessKeys(uri, conf));
+  }
-      S3xLoginHelper.Login login = getAWSAccessKeys(uri, conf);
+  /**
+   * Instantiate from a login tuple.
+   * For testing, hence package-scoped.
+   * @param login login secrets
+   * @throws IOException failure
+   */
+  @VisibleForTesting
+  SimpleAWSCredentialsProvider(final S3xLoginHelper.Login login)
+      throws IOException {
-    throw new CredentialInitializationException(
-        "Access key or secret key is unset");
+    throw new NoAwsCredentialsException("SimpleAWSCredentialsProvider",
+        "No AWS credentials in the Hadoop configuration");
