HDDS-1490. Support configurable container placement policy through 'oâ€¦ (#903)


+import org.apache.commons.io.FilenameUtils;
+import java.io.FileNotFoundException;
+import java.net.URISyntaxException;
+import java.net.URL;
-   * Load user defined network layer schemas from a XML configuration file.
+   * Load user defined network layer schemas from a XML/YAML configuration file.
-  public NodeSchemaLoadResult loadSchemaFromXml(String schemaFilePath)
-      throws IllegalArgumentException {
+  public NodeSchemaLoadResult loadSchemaFromFile(String schemaFilePath)
+      throws IllegalArgumentException, FileNotFoundException {
-        String msg = "Network topology layer schema file " + schemaFilePath +
-            " is not found.";
-        LOG.warn(msg);
-        throw new IllegalArgumentException(msg);
+        // try to load with classloader
+        ClassLoader classloader =
+            Thread.currentThread().getContextClassLoader();
+        if (classloader == null) {
+          classloader = NodeSchemaLoader.class.getClassLoader();
+        }
+        if (classloader != null) {
+          URL url = classloader.getResource(schemaFilePath);
+          if (url != null) {
+            schemaFile = new File(url.toURI());
+          }
+        }
-      return loadSchema(schemaFile);
-    } catch (ParserConfigurationException | IOException | SAXException e) {
-      throw new IllegalArgumentException("Fail to load network topology node"
+
+      if (!schemaFile.exists()) {
+        String msg = "Network topology layer schema file " +
+            schemaFilePath + "[" + schemaFile.getAbsolutePath() +
+            "] is not found.";
+        LOG.warn(msg);
+        throw new FileNotFoundException(msg);
+      }
+
+      LOG.info("Load network topology schema file " +
+          schemaFile.getCanonicalPath());
+      if (FilenameUtils.getExtension(schemaFilePath).toLowerCase()
+          .compareTo("yaml") == 0) {
+        return loadSchemaFromYaml(schemaFile);
+      } else {
+        return loadSchema(schemaFile);
+      }
+    } catch (FileNotFoundException e) {
+      throw e;
+    } catch (ParserConfigurationException | IOException | SAXException |
+        URISyntaxException e) {
+      throw new IllegalArgumentException("Failed to load network topology node"
-   * Load user defined network layer schemas from a YAML configuration file.
-   * @param schemaFilePath path of schema file
-   * @return all valid node schemas defined in schema file
-   */
-  public NodeSchemaLoadResult loadSchemaFromYaml(String schemaFilePath)
-          throws IllegalArgumentException {
-    try {
-      File schemaFile = new File(schemaFilePath);
-      if (!schemaFile.exists()) {
-        String msg = "Network topology layer schema file " + schemaFilePath +
-                " is not found.";
-        LOG.warn(msg);
-        throw new IllegalArgumentException(msg);
-      }
-      return loadSchemaFromYaml(schemaFile);
-    } catch (Exception e) {
-      throw new IllegalArgumentException("Fail to load network topology node"
-              + " schema file: " + schemaFilePath + " , error:"
-              + e.getMessage());
-    }
-  }
-
-  /**
