HDFS-11774. Ozone: KSM: add deleteVolume. Contributed by Mukul Kumar Singh.

-    List<Map.Entry<byte[], byte[]>> putbatch = new LinkedList<>();
-    List<byte[]> deletebatch = new LinkedList<>();
+    List<Map.Entry<byte[], byte[]>> putBatch = new LinkedList<>();
+    List<byte[]> deleteBatch = new LinkedList<>();
-          putbatch, deletebatch);
-      addVolumeToOwnerList(volume, owner, putbatch);
+          putBatch, deleteBatch);
+      addVolumeToOwnerList(volume, owner, putBatch);
-      putbatch.add(batchEntry(dbVolumeKey, newVolumeInfo.toByteArray()));
+      putBatch.add(batchEntry(dbVolumeKey, newVolumeInfo.toByteArray()));
-      metadataManager.batchPutDelete(putbatch, deletebatch);
+      metadataManager.batchPutDelete(putBatch, deleteBatch);
+
+  /**
+   * Deletes an existing empty volume.
+   *
+   * @param volume - Name of the volume.
+   * @throws IOException
+   */
+  @Override
+  public void deleteVolume(String volume) throws IOException {
+    Preconditions.checkNotNull(volume);
+    metadataManager.writeLock().lock();
+    try {
+      List<Map.Entry<byte[], byte[]>> putBatch = new LinkedList<>();
+      List<byte[]> deleteBatch = new LinkedList<>();
+      byte[] dbVolumeKey = metadataManager.getVolumeKey(volume);
+      byte[] volInfo = metadataManager.get(dbVolumeKey);
+      if (volInfo == null) {
+        throw new KSMException(ResultCodes.FAILED_VOLUME_NOT_FOUND);
+      }
+
+      if (!metadataManager.isVolumeEmpty(volume)) {
+        throw new KSMException(ResultCodes.FAILED_VOLUME_NOT_EMPTY);
+      }
+
+      VolumeInfo volumeInfo = VolumeInfo.parseFrom(volInfo);
+      Preconditions.checkState(volume.equalsIgnoreCase(volumeInfo.getVolume()));
+      // delete the volume from the owner list
+      // as well as delete the volume entry
+      delVolumeFromOwnerList(volume, volumeInfo.getOwnerName(),
+          putBatch, deleteBatch);
+      deleteBatch.add(dbVolumeKey);
+      metadataManager.batchPutDelete(putBatch, deleteBatch);
+    } catch (IOException ex) {
+      LOG.error("Delete volume failed for volume:{}", volume, ex);
+      throw ex;
+    } finally {
+      metadataManager.writeLock().unlock();
+    }
+  }
