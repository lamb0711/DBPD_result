HDDS-1401. Static ContainerCache in Datanodes can result in overwrite of container db. Contributed by Mukul Kumar Singh. (#708)


-   * @param containerID - ID of the container to be closed.
+   * @param containerPath - path of the container db to be closed.
-  private void closeDB(long containerID, MetadataStore db) {
+  private void closeDB(String containerPath, MetadataStore db) {
-      } catch (IOException e) {
-        LOG.error("Error closing DB. Container: " + containerID, e);
+      } catch (Exception e) {
+        LOG.error("Error closing DB. Container: " + containerPath, e);
-        closeDB(((Number)iterator.getKey()).longValue(), db);
+        closeDB((String)iterator.getKey(), db);
+    MetadataStore db = (MetadataStore) entry.getValue();
+    String dbFile = (String)entry.getKey();
-      MetadataStore db = (MetadataStore) entry.getValue();
-      closeDB(((Number)entry.getKey()).longValue(), db);
+      closeDB(dbFile, db);
+      return true;
+    } catch (Exception e) {
+      LOG.error("Eviction for db:{} failed", dbFile, e);
+      return false;
-    return true;
-      MetadataStore db = (MetadataStore) this.get(containerID);
+      MetadataStore db = (MetadataStore) this.get(containerDBPath);
-        this.put(containerID, db);
+        this.put(containerDBPath, db);
-   * @param containerID - ID of the container.
+   * @param containerPath - path of the container db file.
-  public void removeDB(long containerID) {
-    Preconditions.checkState(containerID >= 0,
-        "Container ID cannot be negative.");
+  public void removeDB(String containerPath) {
-      MetadataStore db = (MetadataStore)this.get(containerID);
-      closeDB(containerID, db);
-      this.remove(containerID);
+      MetadataStore db = (MetadataStore)this.get(containerPath);
+      closeDB(containerPath, db);
+      this.remove(containerPath);
