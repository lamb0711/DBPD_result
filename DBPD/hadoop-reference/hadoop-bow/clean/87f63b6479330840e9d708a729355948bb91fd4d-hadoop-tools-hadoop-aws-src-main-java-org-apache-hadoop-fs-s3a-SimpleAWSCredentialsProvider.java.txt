HADOOP-14833. Remove s3a user:secret authentication. Contributed by Steve Loughran

+
+import org.apache.hadoop.fs.s3native.S3xLoginHelper;
+import static org.apache.hadoop.fs.s3a.S3AUtils.getAWSAccessKeys;
- * Keys generated in URLs are not supported.
-  private IOException lookupIOE;
-  public SimpleAWSCredentialsProvider(URI uri, Configuration conf) {
-    try {
-      String bucket = uri != null ? uri.getHost() : "";
-      Configuration c = ProviderUtils.excludeIncompatibleCredentialProviders(
-          conf, S3AFileSystem.class);
-      this.accessKey = S3AUtils.lookupPassword(bucket, c, ACCESS_KEY, null);
-      this.secretKey = S3AUtils.lookupPassword(bucket, c, SECRET_KEY, null);
-    } catch (IOException e) {
-      lookupIOE = e;
-    }
+  public SimpleAWSCredentialsProvider(URI uri, Configuration conf)
+      throws IOException {
+
+      S3xLoginHelper.Login login = getAWSAccessKeys(uri, conf);
+      this.accessKey = login.getUser();
+      this.secretKey = login.getPassword();
+  @Override
-    if (lookupIOE != null) {
-      // propagate any initialization problem
-      throw new CredentialInitializationException(lookupIOE.toString(),
-          lookupIOE);
-    }
