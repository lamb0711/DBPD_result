HADOOP-6991.  Fix SequenceFile::Reader to honor file lengths and call
openFile (cdouglas via omalley)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1028473 13f79535-47bb-0310-9956-ffa450edef68

-        out = fs.create(p, false, bufferSize, replication, blockSize, progress);
+        out = fs.create(p, true, bufferSize, replication, blockSize, progress);
-      long len = lenOpt == null ? Long.MAX_VALUE : lenOpt.getValue();      
+      final long len;
-        file = fs.open(filename, bufSize);
-        len = fs.getFileStatus(filename).getLen();
+        len = null == lenOpt
+          ? fs.getFileStatus(filename).getLen()
+          : lenOpt.getValue();
+        file = openFile(fs, filename, bufSize, len);
+        len = null == lenOpt ? Long.MAX_VALUE : lenOpt.getValue();
-      initialize(file,
-                 fs.open(file, getBufferSize(conf)), 
-                 0L, fs.getFileStatus(file).getLen(), conf, false);
+      this(conf, file(file.makeQualified(fs)));
-      initialize(null, in, start, length, conf, false);
+      this(conf, stream(in), start(start), length(length));
