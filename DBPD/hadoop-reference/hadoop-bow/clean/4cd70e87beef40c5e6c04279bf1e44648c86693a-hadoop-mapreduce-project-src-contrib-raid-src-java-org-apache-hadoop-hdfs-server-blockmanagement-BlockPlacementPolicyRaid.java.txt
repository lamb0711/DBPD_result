Merge trunk into auto-HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3042@1337645 13f79535-47bb-0310-9956-ffa450edef68

-  public DatanodeDescriptor chooseReplicaToDelete(FSInodeInfo inode,
+  public DatanodeDescriptor chooseReplicaToDelete(BlockCollection bc,
-      String path = cachedFullPathNames.get(inode);
+      String path = cachedFullPathNames.get(bc);
-            inode, block, replicationFactor, first, second);
+            bc, block, replicationFactor, first, second);
-            inode, block, replicationFactor, first, second);
+            bc, block, replicationFactor, first, second);
-          inode, block, replicationFactor, first, second);
+          bc, block, replicationFactor, first, second);
-          inode, block, replicationFactor, first, second);
+          bc, block, replicationFactor, first, second);
-   * Cache results for FSInodeInfo.getFullPathName()
+   * Cache results for getFullPathName()
-      FSInodeInfo inode;
-      INodeWithHashCode(FSInodeInfo inode) {
-        this.inode = inode;
+      BlockCollection bc;
+      INodeWithHashCode(BlockCollection bc) {
+        this.bc= bc;
-        return inode == obj;
+        return bc== obj;
-        return System.identityHashCode(inode);
+        return System.identityHashCode(bc);
-        return inode.getFullPathName();
+        return bc.getName();
-    public String get(FSInodeInfo inode) throws IOException {
-      return cacheInternal.get(new INodeWithHashCode(inode));
+    public String get(BlockCollection bc) throws IOException {
+      return cacheInternal.get(new INodeWithHashCode(bc));
