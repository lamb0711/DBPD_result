YARN-4983. JVM and UGI metrics disappear after RM transitioned to standby mode

+import org.apache.hadoop.metrics2.MetricsSystem;
-  private JvmPauseMonitor pauseMonitor;
+  private JvmMetrics jvmMetrics;
-    createAndInitActiveServices();
+    createAndInitActiveServices(false);
+    private boolean fromActive = false;
-      DefaultMetricsSystem.initialize("ResourceManager");
-      JvmMetrics jm = JvmMetrics.initSingleton("ResourceManager", null);
-      pauseMonitor = new JvmPauseMonitor();
+      MetricsSystem ms = DefaultMetricsSystem.initialize("ResourceManager");
+      if (fromActive) {
+        JvmMetrics.reattach(ms, jvmMetrics);
+        UserGroupInformation.reattachMetrics();
+      } else {
+        jvmMetrics = JvmMetrics.initSingleton("ResourceManager", null);
+      }
+
+      JvmPauseMonitor pauseMonitor = new JvmPauseMonitor();
-      jm.setPauseMonitor(pauseMonitor);
+      jvmMetrics.setPauseMonitor(pauseMonitor);
+   *
+   * @param fromActive Indicates if the call is from the active state transition
+   *                   or the RM initialization.
-  protected void createAndInitActiveServices() {
+  protected void createAndInitActiveServices(boolean fromActive) {
+    activeServices.fromActive = fromActive;
-      createAndInitActiveServices();
+      createAndInitActiveServices(true);
