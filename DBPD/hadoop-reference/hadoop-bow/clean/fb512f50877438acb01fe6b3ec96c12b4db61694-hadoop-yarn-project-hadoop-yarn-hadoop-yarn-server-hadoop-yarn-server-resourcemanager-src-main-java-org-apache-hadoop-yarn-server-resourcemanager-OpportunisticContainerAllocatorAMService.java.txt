YARN-9697. Efficient allocation of Opportunistic containers. Contributed by Abhishek Modi.

-import org.apache.hadoop.yarn.server.scheduler.DistributedOpportunisticContainerAllocator;
+import org.apache.hadoop.yarn.server.resourcemanager.scheduler.distributed.CentralizedOpportunisticContainerAllocator;
-    this.oppContainerAllocator =
-        new DistributedOpportunisticContainerAllocator(
-            rmContext.getContainerTokenSecretManager(),
-            maxAllocationsPerAMHeartbeat);
-        new NodeQueueLoadMonitor(nodeSortInterval, comparator);
+        new NodeQueueLoadMonitor(nodeSortInterval, comparator, numNodes);
+    this.oppContainerAllocator =
+        new CentralizedOpportunisticContainerAllocator(
+            rmContext.getContainerTokenSecretManager(),
+            maxAllocationsPerAMHeartbeat, nodeMonitor);
+  protected void serviceStop() throws Exception {
+    if (nodeMonitor != null) {
+      nodeMonitor.stop();
+    }
+    super.serviceStop();
+  }
+
+  @Override
