HDFS-8580. Erasure coding: Persist cellSize in BlockInfoStriped and StripedBlocksFeature. Contributed by Walter Su.

-        for (BlockProto b : bp) {
-          stripeFeature.addBlock(new BlockInfoStriped(PBHelper.convert(b), schema));
+        if (bp.size() > 0) {
+          // if a striped file has block, the cellSize must exist in proto
+          final int cellSize = f.getStripedBlocks().getCellSize();
+          for (BlockProto b : bp) {
+            stripeFeature.addBlock(new BlockInfoStriped(PBHelper.convert(b),
+                schema, cellSize));
+          }
-                striped.getSchema());
+                striped.getSchema(), striped.getCellSize());
-        BlockInfoStriped[] sblocks = sb.getBlocks();
-        if (sblocks != null) {
-          for (BlockInfoStriped sblk : sblocks) {
-            b.addBlocks(PBHelper.convert(sblk));
-          }
-        }
+        BlockInfoStriped[] sblocks = sb.getBlocks();
+        if (sblocks != null && sblocks.length > 0) {
+          final int cellSize = sblocks[0].getCellSize();
+          for (BlockInfoStriped sblk : sblocks) {
+            assert cellSize == sblk.getCellSize();
+            b.addBlocks(PBHelper.convert(sblk));
+          }
+          builder.setCellSize(cellSize);
+        }
