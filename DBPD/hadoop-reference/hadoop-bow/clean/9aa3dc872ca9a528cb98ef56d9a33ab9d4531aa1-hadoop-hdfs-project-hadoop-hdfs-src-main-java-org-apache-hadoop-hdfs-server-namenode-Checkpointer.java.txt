HDFS-14158. Checkpointer ignores configured time period > 5 minutes

This closes #449

Signed-off-by: Akira Ajisaka <aajisaka@apache.org>

+import com.google.common.math.LongMath;
- * 
+ *
-    // Check the size of the edit log once every 5 minutes.
-    long periodMSec = 5 * 60;   // 5 minutes
-    if(checkpointConf.getPeriod() < periodMSec) {
-      periodMSec = checkpointConf.getPeriod();
-    }
-    periodMSec *= 1000;
+    // How often to check the size of the edit log (min of checkpointCheckPeriod and checkpointPeriod)
+    long periodMSec = checkpointConf.getCheckPeriod() * 1000;
+    // How often to checkpoint regardless of number of txns
+    long checkpointPeriodMSec = checkpointConf.getPeriod() * 1000;
+    long lastEditLogCheckTime =0;
-        if(now >= lastCheckpointTime + periodMSec) {
+        if(now >= lastCheckpointTime + checkpointPeriodMSec) {
-        } else {
+        } else if(now >= lastEditLogCheckTime + periodMSec) {
+          lastEditLogCheckTime = now;
+          lastEditLogCheckTime = now;
-        Thread.sleep(periodMSec);
+        Thread.sleep(LongMath.gcd(periodMSec, checkpointPeriodMSec));
