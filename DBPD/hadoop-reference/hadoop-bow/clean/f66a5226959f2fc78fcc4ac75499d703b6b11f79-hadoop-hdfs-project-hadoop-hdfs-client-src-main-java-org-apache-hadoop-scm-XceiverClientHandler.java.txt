HDFS-12268. Ozone: Add metrics for pending storage container requests. Contributed by Yiqun Lin.

+import com.sun.tools.javac.util.Pair;
+
+import org.apache.hadoop.util.Time;
-
-      CompletableFuture<ContainerCommandResponseProto>> responses =
+      Pair<CompletableFuture<ContainerCommandResponseProto>, Long>> responses =
+  private XceiverClientMetrics metrics;
+
+    this.metrics = XceiverClientManager.getXceiverClientMetrics();
+    metrics.decrPendingContainerOpsMetrics(msg.getCmdType());
+
-    CompletableFuture<ContainerCommandResponseProto> future =
+    Pair<CompletableFuture<ContainerCommandResponseProto>, Long> future =
+
-      future.complete(msg);
+      future.fst.complete(msg);
+
+      long requestTime = future.snd;
+      metrics.addContainerOpsLatency(msg.getCmdType(),
+          Time.monotonicNowNanos() - requestTime);
+    metrics.incrPendingContainerOpsMetrics(request.getCmdType());
-    CompletableFuture<ContainerCommandResponseProto> response =
-        new CompletableFuture<>();
-
-    CompletableFuture<ContainerCommandResponseProto> previous =
+    CompletableFuture<ContainerCommandResponseProto> future
+        = new CompletableFuture<>();
+    Pair<CompletableFuture<ContainerCommandResponseProto>, Long> response =
+        new Pair<CompletableFuture<ContainerCommandResponseProto>,
+        Long>(future, Time.monotonicNowNanos());
+    Pair<CompletableFuture<ContainerCommandResponseProto>, Long> previous =
-    return response;
+    return response.fst;
