HDFS-4563. Update namespace/diskspace usage after deleting snapshots.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1455396 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.annotations.VisibleForTesting;
+
-    if (useCache) {
+    if (useCache && isQuotaSet()) {
-  public final void addNamespaceConsumed(final int delta)
-      throws NSQuotaExceededException {
+  public final void addSpaceConsumed(final long nsDelta, final long dsDelta)
+      throws QuotaExceededException {
-      verifyNamespaceQuota(delta);
+      verifyQuota(nsDelta, dsDelta);
-      super.addNamespaceConsumed(delta);
+      super.addSpaceConsumed(nsDelta, dsDelta);
-      namespace += delta;
+      addSpaceConsumed2Cache(nsDelta, dsDelta);
-      super.addNamespaceConsumed(delta);
+      super.addSpaceConsumed(nsDelta, dsDelta);
-
+  
-  void addSpaceConsumed(long nsDelta, long dsDelta) {
+  protected void addSpaceConsumed2Cache(long nsDelta, long dsDelta) {
+  
+  @VisibleForTesting
+  public long getNamespace() {
+    return this.namespace;
+  }
+  
+  @VisibleForTesting
+  public long getDiskspace() {
+    return this.diskspace;
+  }
