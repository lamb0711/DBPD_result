Merge remote-tracking branch 'apache/trunk' into HDFS-7285

+    FSNamesystem fsn = fsd.getFSNamesystem();
-        fsd.getFSNamesystem().removeSnapshottableDirs(snapshottableDirs);
+        fsd.updateReplicationFactor(context.collectedBlocks()
+                                        .toUpdateReplicationInfo());
+        fsn.removeSnapshottableDirs(snapshottableDirs);
