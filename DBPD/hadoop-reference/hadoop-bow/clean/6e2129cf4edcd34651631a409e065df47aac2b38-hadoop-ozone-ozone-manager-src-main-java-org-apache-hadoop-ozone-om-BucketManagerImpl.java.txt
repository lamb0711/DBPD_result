HDDS-428. OzoneManager lock optimization.
Contributed by Nanda Kumar.

-    metadataManager.writeLock().lock();
+    metadataManager.getLock().acquireVolumeLock(volumeName);
+    metadataManager.getLock().acquireBucketLock(volumeName, bucketName);
-      metadataManager.writeLock().unlock();
+      metadataManager.getLock().releaseBucketLock(volumeName, bucketName);
+      metadataManager.getLock().releaseVolumeLock(volumeName);
-    metadataManager.readLock().lock();
+    metadataManager.getLock().acquireBucketLock(volumeName, bucketName);
-      metadataManager.readLock().unlock();
+      metadataManager.getLock().releaseBucketLock(volumeName, bucketName);
-    metadataManager.writeLock().lock();
+    metadataManager.getLock().acquireBucketLock(volumeName, bucketName);
-      //Check if volume exists
-      if (metadataManager.getVolumeTable()
-          .get(metadataManager.getVolumeKey(volumeName)) == null) {
-        LOG.debug("volume: {} not found ", volumeName);
-        throw new OMException("Volume doesn't exist",
-            OMException.ResultCodes.FAILED_VOLUME_NOT_FOUND);
-      }
-      metadataManager.writeLock().unlock();
+      metadataManager.getLock().releaseBucketLock(volumeName, bucketName);
-    metadataManager.writeLock().lock();
+    metadataManager.getLock().acquireBucketLock(volumeName, bucketName);
-      //Check if volume exists
-      if (metadataManager.getVolumeTable()
-          .get(metadataManager.getVolumeKey(volumeName)) == null) {
-        LOG.debug("volume: {} not found ", volumeName);
-        throw new OMException("Volume doesn't exist",
-            OMException.ResultCodes.FAILED_VOLUME_NOT_FOUND);
-      }
-
-      metadataManager.writeLock().unlock();
+      metadataManager.getLock().releaseBucketLock(volumeName, bucketName);
-    metadataManager.readLock().lock();
-    try {
-      return metadataManager.listBuckets(
-          volumeName, startBucket, bucketPrefix, maxNumOfBuckets);
-    } finally {
-      metadataManager.readLock().unlock();
-    }
+    return metadataManager.listBuckets(
+        volumeName, startBucket, bucketPrefix, maxNumOfBuckets);
+
