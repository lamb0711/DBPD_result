HDFS-5506. Use URLConnectionFactory in DelegationTokenFetcher. Contributed by Haohui Mai.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1542011 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.security.authentication.client.AuthenticationException;
-            c = DelegationTokenFetcher.getDTfromRemote(nnHttpUrl, renewer);
+            c = DelegationTokenFetcher.getDTfromRemote(connectionFactory, nnUri, renewer);
-    return
-      DelegationTokenFetcher.renewDelegationToken
-      (DFSUtil.createUri(getUnderlyingProtocol(), serviceAddr).toString(),
-       (Token<DelegationTokenIdentifier>) token);
+    try {
+      return DelegationTokenFetcher.renewDelegationToken(connectionFactory,
+          DFSUtil.createUri(getUnderlyingProtocol(), serviceAddr),
+          (Token<DelegationTokenIdentifier>) token);
+    } catch (AuthenticationException e) {
+      throw new IOException(e);
+    }
-    DelegationTokenFetcher.cancelDelegationToken
-      (DFSUtil.createUri(getUnderlyingProtocol(), serviceAddr).toString(),
-       (Token<DelegationTokenIdentifier>) token);
+    try {
+      DelegationTokenFetcher.cancelDelegationToken(connectionFactory, DFSUtil
+          .createUri(getUnderlyingProtocol(), serviceAddr),
+          (Token<DelegationTokenIdentifier>) token);
+    } catch (AuthenticationException e) {
+      throw new IOException(e);
+    }
