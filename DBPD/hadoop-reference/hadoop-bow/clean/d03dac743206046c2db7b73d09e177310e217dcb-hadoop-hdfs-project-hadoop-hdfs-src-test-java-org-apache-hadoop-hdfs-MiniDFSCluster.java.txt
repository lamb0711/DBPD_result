HDFS-2974. MiniDFSCluster does not delete standby NN name dirs during format. Contributed by Aaron T. Myers.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1291126 13f79535-47bb-0310-9956-ffa450edef68

+        Collection<URI> namespaceDirs = FSNamesystem.getNamespaceDirs(conf);
+        if (format) {
+          for (URI nameDirUri : namespaceDirs) {
+            File nameDir = new File(nameDirUri);
+            if (nameDir.exists() && !FileUtil.fullyDelete(nameDir)) {
+              throw new IOException("Could not fully delete " + nameDir);
+            }
+          }
+        }
-          copyNameDirs(prevNNDirs, FSNamesystem.getNamespaceDirs(conf), conf);
+          copyNameDirs(prevNNDirs, namespaceDirs, conf);
-        prevNNDirs = FSNamesystem.getNamespaceDirs(conf);
+        prevNNDirs = namespaceDirs;
