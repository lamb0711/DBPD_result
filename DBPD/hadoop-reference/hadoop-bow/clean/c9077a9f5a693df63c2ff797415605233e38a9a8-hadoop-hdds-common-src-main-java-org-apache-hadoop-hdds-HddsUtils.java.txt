HDDS-707. Allow registering MBeans without additional jmx properties.
Contributed by Arpit Agarwal.

+import org.apache.hadoop.classification.InterfaceAudience;
+import org.apache.hadoop.classification.InterfaceStability;
+import org.apache.hadoop.metrics2.util.MBeans;
+import javax.management.ObjectName;
+import java.lang.reflect.InvocationTargetException;
+import java.lang.reflect.Method;
+import java.util.Map;
+@InterfaceAudience.Private
+@InterfaceStability.Stable
+  /**
+   * Register the provided MBean with additional JMX ObjectName properties.
+   * If additional properties are not supported then fallback to registering
+   * without properties.
+   *
+   * @param serviceName - see {@link MBeans#register}
+   * @param mBeanName - see {@link MBeans#register}
+   * @param jmxProperties - additional JMX ObjectName properties.
+   * @param mBean - the MBean to register.
+   * @return the named used to register the MBean.
+   */
+  public static ObjectName registerWithJmxProperties(
+      String serviceName, String mBeanName, Map<String, String> jmxProperties,
+      Object mBean) {
+    try {
+
+      // Check support for registering with additional properties.
+      final Method registerMethod = MBeans.class.getMethod(
+          "register", String.class, String.class,
+          Map.class, Object.class);
+
+      return (ObjectName) registerMethod.invoke(
+          null, serviceName, mBeanName, jmxProperties, mBean);
+
+    } catch (NoSuchMethodException | IllegalAccessException |
+        InvocationTargetException e) {
+
+      // Fallback
+      LOG.trace("Registering MBean {} without additional properties {}",
+          mBeanName, jmxProperties);
+      return MBeans.register(serviceName, mBeanName, mBean);
+    }
+  }
+
