HDDS-1830 OzoneManagerDoubleBuffer#stop should wait for daemon thread to die (#1156)


+import java.util.concurrent.atomic.AtomicBoolean;
-  private volatile boolean isRunning;
+  private final AtomicBoolean isRunning = new AtomicBoolean(false);
-    isRunning = true;
+    isRunning.set(true);
-    while(isRunning) {
+    while (isRunning.get()) {
-        if (isRunning) {
+        if (isRunning.get()) {
-  public synchronized void stop() {
-    if (isRunning) {
+  public void stop() {
+    if (isRunning.compareAndSet(true, false)) {
-      isRunning = false;
+      try {
+        // Wait for daemon thread to exit
+        daemon.join();
+      } catch (InterruptedException e) {
+        LOG.error("Interrupted while waiting for daemon to exit.");
+      }
