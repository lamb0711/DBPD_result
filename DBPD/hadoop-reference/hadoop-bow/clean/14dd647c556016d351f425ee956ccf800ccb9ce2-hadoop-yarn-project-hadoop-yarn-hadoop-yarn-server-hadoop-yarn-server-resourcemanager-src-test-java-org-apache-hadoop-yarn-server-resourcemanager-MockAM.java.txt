YARN-3265. Fixed a deadlock in CapacityScheduler by always passing a queue's available resource-limit from the parent queue. Contributed by Wangda Tan.

-import org.junit.Assert;
-import org.apache.hadoop.yarn.api.protocolrecords.FinishApplicationMasterResponse;
+import org.junit.Assert;
+  private volatile AllocateResponse lastResponse;
-    return doAllocateAs(ugi, allocateRequest);
+    lastResponse = doAllocateAs(ugi, allocateRequest);
+    return lastResponse;
+  
+  public AllocateResponse doHeartbeat() throws Exception {
+    return allocate(null, null);
+  }
