YARN-134. Fixes ClientToAMSecretManager creates keys without checking for validity of the appID. (Contributed by Vinod Kumar Vavilapalli)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1395841 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.util.BuilderUtils;
-  private Text appId;
+  private ApplicationId applicationId;
-  public ClientTokenIdentifier(ApplicationId id) {
-    this.appId = new Text(Integer.toString(id.getId()));
-  }
-
-    this.appId = new Text();
-  public Text getApplicationID() {
-    return appId;
+  public ClientTokenIdentifier(ApplicationId id) {
+    this();
+    this.applicationId = id;
+  }
+
+  public ApplicationId getApplicationID() {
+    return this.applicationId;
-    appId.write(out);
+    out.writeLong(this.applicationId.getClusterTimestamp());
+    out.writeInt(this.applicationId.getId());
-    appId.readFields(in);
+    this.applicationId =
+        BuilderUtils.newApplicationId(in.readLong(), in.readInt());
-    if (appId == null || "".equals(appId.toString())) {
+    if (this.applicationId == null) {
-    return UserGroupInformation.createRemoteUser(appId.toString());
+    return UserGroupInformation.createRemoteUser(this.applicationId.toString());
