Merge trunk into HDFS-6581

Conflicts:
	hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
	hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeLayoutVersion.java

+import org.apache.hadoop.yarn.server.timeline.webapp.CrossOriginFilterInitializer;
-    boolean modifiedInitialiers = false;
+    boolean modifiedInitializers = false;
+    if (!initializers.contains(CrossOriginFilterInitializer.class.getName())) {
+      if(conf.getBoolean(YarnConfiguration
+          .TIMELINE_SERVICE_HTTP_CROSS_ORIGIN_ENABLED, YarnConfiguration
+              .TIMELINE_SERVICE_HTTP_CROSS_ORIGIN_ENABLED_DEFAULT)) {
+        initializers = CrossOriginFilterInitializer.class.getName() + ","
+            + initializers;
+        modifiedInitializers = true;
+      }
+    }
+
-      modifiedInitialiers = true;
+      modifiedInitializers = true;
-        modifiedInitialiers = true;
+        modifiedInitializers = true;
-    if (modifiedInitialiers) {
+    if (modifiedInitializers) {
