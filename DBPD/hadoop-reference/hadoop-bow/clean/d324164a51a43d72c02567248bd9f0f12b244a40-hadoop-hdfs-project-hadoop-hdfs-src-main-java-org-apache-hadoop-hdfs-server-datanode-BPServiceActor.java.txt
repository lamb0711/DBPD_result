HDFS-7435. PB encoding of block reports is very inefficient. Contributed by Daryn Sharp.

-    register();
+    register(nsInfo);
-      reports[i++] = new StorageBlockReport(
-          kvPair.getKey(), blockList.getBlockListAsLongs());
+      reports[i++] = new StorageBlockReport(kvPair.getKey(), blockList);
+   * @param nsInfo current NamespaceInfo
-  void register() throws IOException {
+  void register(NamespaceInfo nsInfo) throws IOException {
+        bpRegistration.setNamespaceInfo(nsInfo);
-      retrieveNamespaceInfo();
+      NamespaceInfo nsInfo = retrieveNamespaceInfo();
-      register();
+      register(nsInfo);
