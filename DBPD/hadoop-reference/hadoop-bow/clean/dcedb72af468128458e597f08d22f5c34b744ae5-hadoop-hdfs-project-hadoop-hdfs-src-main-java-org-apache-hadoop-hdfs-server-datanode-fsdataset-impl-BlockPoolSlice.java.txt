Revert "HADOOP-10930. Refactor: Wrap Datanode IO related operations. Contributed by Xiaoyu Yao."

This reverts commit aeecfa24f4fb6af289920cbf8830c394e66bd78e.

-import org.apache.hadoop.hdfs.server.datanode.LocalReplica;
-import org.apache.hadoop.hdfs.server.datanode.fsdataset.ReplicaInputStreams;
-
+import org.apache.hadoop.io.nativeio.NativeIO;
-      DataStorage.fullyDelete(tmpDir);
+      FileUtil.fullyDelete(tmpDir);
-            LocalReplica.rename(metaFile, targetMetaFile);
+            NativeIO.renameTo(metaFile, targetMetaFile);
-            LocalReplica.rename(blockFile, targetBlockFile);
+            NativeIO.renameTo(blockFile, targetBlockFile);
-    ReplicaInputStreams ris = null;
+      IOUtils.skipFully(checksumIn, (numChunks-1)*checksumSize);
-      ris = new ReplicaInputStreams(blockIn, checksumIn,
-          volume.obtainReference());
-      ris.skipChecksumFully((numChunks-1)*checksumSize);
-      ris.skipDataFully(lastChunkStartPos);
+      IOUtils.skipFully(blockIn, lastChunkStartPos);
-      ris.readChecksumFully(buf, lastChunkSize, checksumSize);
-      ris.readDataFully(buf, 0, lastChunkSize);
+      checksumIn.readFully(buf, lastChunkSize, checksumSize);
+      IOUtils.readFully(blockIn, buf, 0, lastChunkSize);
+
-      } else { // last chunk is corrupt
+      } else { // last chunck is corrupt
-      if (ris != null) {
-        ris.close();
-      } else {
-        IOUtils.closeStream(checksumIn);
-        IOUtils.closeStream(blockIn);
-      }
+      IOUtils.closeStream(checksumIn);
+      IOUtils.closeStream(blockIn);
