HDFS-13101. Yet another fsimage corruption related to snapshot. Contributed by Shashikant Banerjee.

-            // we only check the node originally in prior's created list
-            for (INode cNode : priorDiff.diff.getCreatedUnmodifiable()) {
-              if (priorCreated.containsKey(cNode)) {
-                cNode.cleanSubtree(reclaimContext, snapshot, NO_SNAPSHOT_ID);
+            if (currentINode.isLastReference()) {
+              // if this is the last reference, the created list can be
+              // destroyed.
+              priorDiff.getChildrenDiff().destroyCreatedList(
+                  reclaimContext, currentINode);
+            } else {
+              // we only check the node originally in prior's created list
+              for (INode cNode : priorDiff.diff.getCreatedUnmodifiable()) {
+                if (priorCreated.containsKey(cNode)) {
+                  cNode.cleanSubtree(reclaimContext, snapshot, NO_SNAPSHOT_ID);
+                }
-          
+
+  @Override
+  public String toString() {
+    return "" + diffs;
+  }
