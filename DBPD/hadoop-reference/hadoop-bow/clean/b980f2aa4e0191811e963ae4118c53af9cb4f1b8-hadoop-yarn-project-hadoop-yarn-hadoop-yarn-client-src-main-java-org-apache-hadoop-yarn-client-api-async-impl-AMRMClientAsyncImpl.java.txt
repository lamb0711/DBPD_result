YARN-763. AMRMClientAsync should stop heartbeating after receiving shutdown from RM (Xuan Gong via bikas)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1502914 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.api.records.AMCommand;
+    handlerThread.setDaemon(true);
-   * terminate.  Calling this method from the callback handler thread would cause
-   * deadlock, and thus should be avoided.
+   * terminate.
-    if (Thread.currentThread() == handlerThread) {
-      throw new YarnRuntimeException("Cannot call stop from callback handler thread!");
-    }
+    heartbeatThread.interrupt();
-    try {
-      handlerThread.interrupt();
-      handlerThread.join();
-    } catch (InterruptedException ex) {
-      LOG.error("Error joining with hander thread", ex);
-    }
+    handlerThread.interrupt();
+              if (response.getAMCommand() == AMCommand.AM_RESYNC
+                  || response.getAMCommand() == AMCommand.AM_SHUTDOWN) {
+                return;
+              }
-          boolean stop = false;
-            stop = true;
-            break;
+            return;
-          if(stop) {
-            // should probably stop heartbeating also YARN-763
-            break;
-          }
