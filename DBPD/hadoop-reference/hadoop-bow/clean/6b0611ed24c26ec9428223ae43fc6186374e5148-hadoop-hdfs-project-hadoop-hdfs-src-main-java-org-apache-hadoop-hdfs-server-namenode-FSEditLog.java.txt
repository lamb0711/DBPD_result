Merging r1539737 through r1539896 from trunk to branch HDFS-2832

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1539898 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.hdfs.protocol.PathBasedCacheEntry;
+import org.apache.hadoop.hdfs.server.namenode.FSEditLogOp.ModifyPathBasedCacheDirectiveOp;
-import org.apache.hadoop.hdfs.server.namenode.FSEditLogOp.RemovePathBasedCacheDescriptorOp;
+import org.apache.hadoop.hdfs.server.namenode.FSEditLogOp.RemovePathBasedCacheDirectiveOp;
-    AddPathBasedCacheDirectiveOp op = AddPathBasedCacheDirectiveOp.getInstance(
-        cache.get())
-        .setPath(directive.getPath().toUri().getPath())
-        .setReplication(directive.getReplication())
-        .setPool(directive.getPool());
+    AddPathBasedCacheDirectiveOp op =
+        AddPathBasedCacheDirectiveOp.getInstance(cache.get())
+            .setDirective(directive);
-  void logRemovePathBasedCacheDescriptor(Long id, boolean toLogRpcIds) {
-    RemovePathBasedCacheDescriptorOp op =
-        RemovePathBasedCacheDescriptorOp.getInstance(cache.get()).setId(id);
+  void logModifyPathBasedCacheDirective(
+      PathBasedCacheDirective directive, boolean toLogRpcIds) {
+    ModifyPathBasedCacheDirectiveOp op =
+        ModifyPathBasedCacheDirectiveOp.getInstance(
+            cache.get()).setDirective(directive);
+    logRpcIds(op, toLogRpcIds);
+    logEdit(op);
+  }
+
+  void logRemovePathBasedCacheDirective(Long id, boolean toLogRpcIds) {
+    RemovePathBasedCacheDirectiveOp op =
+        RemovePathBasedCacheDirectiveOp.getInstance(cache.get()).setId(id);
