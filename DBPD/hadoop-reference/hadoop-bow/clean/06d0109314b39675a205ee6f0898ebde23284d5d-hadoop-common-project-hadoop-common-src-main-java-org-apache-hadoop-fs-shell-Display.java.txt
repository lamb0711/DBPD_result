HADOOP-8449. hadoop fs -text fails with compressed sequence files with the codec file extension. (harsh)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1355636 13f79535-47bb-0310-9956-ffa450edef68

-      
-      // check codecs
-      CompressionCodecFactory cf = new CompressionCodecFactory(getConf());
-      CompressionCodec codec = cf.getCodec(item.path);
-      if (codec != null) {
-        return codec.createInputStream(i);
-      }
+      // Check type of stream first
+          // Must be gzip
+          // Might be a SequenceFile
+        }
+        default: {
+          // Check the type of compression instead, depending on Codec class's
+          // own detection methods, based on the provided path.
+          CompressionCodecFactory cf = new CompressionCodecFactory(getConf());
+          CompressionCodec codec = cf.getCodec(item.path);
+          if (codec != null) {
+            return codec.createInputStream(i);
+          }
+
+      // File is non-compressed, or not a file container we know.
-    }    
+    }
