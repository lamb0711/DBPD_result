Merge all changes from trunk to branch HDFS-2832

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1517030 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.service.AbstractService;
-public abstract class RMStateStore {
+public abstract class RMStateStore extends AbstractService {
+
+  public RMStateStore() {
+    super(RMStateStore.class.getName());
+  }
+
-  public void setDispatcher(Dispatcher dispatcher) {
+  public void setRMDispatcher(Dispatcher dispatcher) {
-  public synchronized void init(Configuration conf) throws Exception{    
+  public synchronized void serviceInit(Configuration conf) throws Exception{    
-    dispatcher.start();
-    
+  
+  protected synchronized void serviceStart() throws Exception {
+    dispatcher.start();
+    startInternal();
+  }
-   * The base class is initialized and the event dispatcher is ready to use at
-   * this point
-  
-  public synchronized void close() throws Exception {
+
+  /**
+   * Derived classes start themselves using this method.
+   * The base class is started and the event dispatcher is ready to use at
+   * this point
+   */
+  protected abstract void startInternal() throws Exception;
+
+  public synchronized void serviceStop() throws Exception {
