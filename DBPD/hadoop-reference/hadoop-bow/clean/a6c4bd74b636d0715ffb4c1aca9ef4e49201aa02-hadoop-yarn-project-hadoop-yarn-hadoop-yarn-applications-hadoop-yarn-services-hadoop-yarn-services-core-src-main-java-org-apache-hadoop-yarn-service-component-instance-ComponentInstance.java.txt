YARN-6394. Support specifying YARN related params in the service REST API. Contributed by Jian He

-
+      compInstance.component.incRunningContainers();
+      if (compInstance.timelineServiceEnabled) {
+        compInstance.serviceTimelinePublisher
+            .componentInstanceBecomeReady(compInstance.containerSpec);
+      }
+      if (compInstance.getState().equals(READY)) {
+        compInstance.component.decContainersReady();
+      }
+      compInstance.component.decRunningContainers();
-          compInstance.serviceTimelinePublisher
-              .componentInstanceFinished(compInstance,
-                  event.getStatus().getExitStatus(), event.getStatus().getState(),
-                  containerDiag);
+          compInstance.serviceTimelinePublisher.componentInstanceFinished
+              (compInstance, event.getStatus().getExitStatus(), containerDiag);
-        serviceTimelinePublisher.componentInstanceUpdated(container);
+        serviceTimelinePublisher.componentInstanceIPHostUpdated(container);
-  // Release the container , cleanup registry, hdfs dir, and record in ATS
+  // Called when user flexed down the container and ContainerStoppedTransition
+  // is not executed in this case.
+  // Release the container, dec running,
+  // cleanup registry, hdfs dir, and send record to ATS
+    // update metrics
+    if (getState() == STARTED) {
+      component.decRunningContainers();
+    }
+    if (getState() == READY) {
+      component.decContainersReady();
+      component.decRunningContainers();
+    }
+
-      serviceTimelinePublisher
-          .componentInstanceFinished(this, KILLED_BY_APPMASTER, COMPLETE,
-              diagnostics.toString());
+      serviceTimelinePublisher.componentInstanceFinished(this,
+          KILLED_BY_APPMASTER, diagnostics.toString());
