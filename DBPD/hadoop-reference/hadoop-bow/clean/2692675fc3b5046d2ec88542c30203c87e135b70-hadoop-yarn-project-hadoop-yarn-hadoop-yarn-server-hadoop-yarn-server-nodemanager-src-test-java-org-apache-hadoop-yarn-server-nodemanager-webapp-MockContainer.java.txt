YARN-684. ContainerManager.startContainer should use ContainerTokenIdentifier instead of the entire Container. Contributed by Vinod Kumar Vavilapalli.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1488085 13f79535-47bb-0310-9956-ffa450edef68

-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.when;
-
-import org.apache.hadoop.yarn.api.records.ContainerToken;
+import org.apache.hadoop.yarn.api.records.Resource;
+import org.apache.hadoop.yarn.security.ContainerTokenIdentifier;
-  private org.apache.hadoop.yarn.api.records.Container mockContainer;
+  private final ContainerTokenIdentifier containerTokenIdentifier;
-    ContainerToken containerToken =
-        BuilderUtils.newContainerToken(id, "127.0.0.1", 1234, user,
-          BuilderUtils.newResource(1024, 1), currentTime + 10000, 123,
-          "password".getBytes(), currentTime);
+    this.containerTokenIdentifier =
+        BuilderUtils.newContainerTokenIdentifier(BuilderUtils
+          .newContainerToken(id, "127.0.0.1", 1234, user,
+            BuilderUtils.newResource(1024, 1), currentTime + 10000, 123,
+            "password".getBytes(), currentTime));
-
-    mockContainer = mock(org.apache.hadoop.yarn.api.records.Container.class);
-    when(mockContainer.getContainerToken()).thenReturn(containerToken);
-    when(mockContainer.getId()).thenReturn(id);
-  public org.apache.hadoop.yarn.api.records.Container getContainer() {
-    return this.mockContainer;
+  public ContainerId getContainerId() {
+    return this.id;
+  }
+
+  @Override
+  public Resource getResource() {
+    return this.containerTokenIdentifier.getResource();
+  }
+
+  @Override
+  public ContainerTokenIdentifier getContainerTokenIdentifier() {
+    return this.containerTokenIdentifier;
