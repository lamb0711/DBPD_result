HDFS-13768. Adding replicas to volume map makes DataNode start slowly. Contributed by Surendra Singh Lilhore.

+   * Add a replica's meta information into the map, if already exist
+   * return the old replicaInfo.
+   */
+  ReplicaInfo addAndGet(String bpid, ReplicaInfo replicaInfo) {
+    checkBlockPool(bpid);
+    checkBlock(replicaInfo);
+    try (AutoCloseableLock l = lock.acquire()) {
+      FoldedTreeSet<ReplicaInfo> set = map.get(bpid);
+      if (set == null) {
+        // Add an entry for block pool if it does not exist already
+        set = new FoldedTreeSet<>();
+        map.put(bpid, set);
+      }
+      ReplicaInfo oldReplicaInfo = set.get(replicaInfo.getBlockId(),
+          LONG_AND_BLOCK_COMPARATOR);
+      if (oldReplicaInfo != null) {
+        return oldReplicaInfo;
+      } else {
+        set.add(replicaInfo);
+      }
+      return replicaInfo;
+    }
+  }
+
+  /**
