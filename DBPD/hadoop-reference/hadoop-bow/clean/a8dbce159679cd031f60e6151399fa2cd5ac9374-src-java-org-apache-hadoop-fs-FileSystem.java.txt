HADOOP-7223. FileContext createFlag combinations are not clearly defined. Contributed by Suresh Srinivas.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1092565 13f79535-47bb-0310-9956-ffa450edef68

+
+    boolean pathExists = exists(f);
+    CreateFlag.validate(f, pathExists, flag);
-    if (exists(f)) {
-      if (flag.contains(CreateFlag.APPEND)) {
-        return append(f, bufferSize, progress);
-      } else if (!flag.contains(CreateFlag.OVERWRITE)) {
-        throw new IOException("File already exists: " + f);
-      }
-    } else {
-      if (flag.contains(CreateFlag.APPEND) && !flag.contains(CreateFlag.CREATE))
-        throw new IOException("File already exists: " + f.toString());
+    if (pathExists && flag.contains(CreateFlag.APPEND)) {
+      return append(f, bufferSize, progress);
-    return this.create(f, absolutePermission, flag.contains(CreateFlag.OVERWRITE), bufferSize, replication,
+    return this.create(f, absolutePermission,
+        flag.contains(CreateFlag.OVERWRITE), bufferSize, replication,
