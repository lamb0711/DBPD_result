HADOOP-16565. Region must be provided when requesting session credentials or SdkClientException will be thrown (#1454). Contributed by Gabor Bota.


+import com.amazonaws.SdkClientException;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+  private static final Logger LOG =
+      LoggerFactory.getLogger(MarshalledCredentialBinding.class);
+
-    final AWSSecurityTokenService tokenService =
-        STSClientFactory.builder(parentCredentials,
-            awsConf,
-            stsEndpoint.isEmpty() ? null : stsEndpoint,
-            stsRegion)
-            .build();
-    return fromSTSCredentials(
-        STSClientFactory.createClientConnection(tokenService, invoker)
-            .requestSessionCredentials(duration, TimeUnit.SECONDS));
+    try {
+      final AWSSecurityTokenService tokenService =
+          STSClientFactory.builder(parentCredentials,
+              awsConf,
+              stsEndpoint.isEmpty() ? null : stsEndpoint,
+              stsRegion)
+              .build();
+      return fromSTSCredentials(
+          STSClientFactory.createClientConnection(tokenService, invoker)
+              .requestSessionCredentials(duration, TimeUnit.SECONDS));
+    } catch (SdkClientException e) {
+      if (stsRegion.isEmpty()) {
+        LOG.error("Region must be provided when requesting session credentials.",
+            e);
+      }
+      throw e;
+    }
