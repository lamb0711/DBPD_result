Reverting the previous trunk merge since it added other unintended changes in addition


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1177127 13f79535-47bb-0310-9956-ffa450edef68

-        new ExitedWithFailureTransition(true))
+        new ExitedWithFailureTransition())
-       // TODO race: Can lead to a CONTAINER_LAUNCHED event at state KILLING, 
-       // and a container which will never be killed by the NM.
-        new ExitedWithSuccessTransition(true))
+        new ExitedWithSuccessTransition())
-        new ExitedWithFailureTransition(true))
+        new ExitedWithFailureTransition())
-    .addTransition(ContainerState.RUNNING, ContainerState.EXITED_WITH_FAILURE,
-        ContainerEventType.CONTAINER_KILLED_ON_REQUEST,
-        new KilledExternallyTransition()) 
-        new ExitedWithSuccessTransition(false))
+        new ExitedWithSuccessTransition())
-        new ExitedWithFailureTransition(false))
+        new ExitedWithFailureTransition())
-  @SuppressWarnings("unchecked")  // dispatcher not typed
-
-    boolean clCleanupRequired;
-
-    public ExitedWithSuccessTransition(boolean clCleanupRequired) {
-      this.clCleanupRequired = clCleanupRequired;
-    }
-
-      // Set exit code to 0 on success    	
-      container.exitCode = 0;
-    	
-      if (clCleanupRequired) {
-        container.dispatcher.getEventHandler().handle(
-            new ContainersLauncherEvent(container,
-                ContainersLauncherEventType.CLEANUP_CONTAINER));
-      }
-
+      // Inform the localizer to decrement reference counts and cleanup
+      // resources.
-  @SuppressWarnings("unchecked")  // dispatcher not typed
-
-    boolean clCleanupRequired;
-
-    public ExitedWithFailureTransition(boolean clCleanupRequired) {
-      this.clCleanupRequired = clCleanupRequired;
-    }
-
-      if (clCleanupRequired) {
-        container.dispatcher.getEventHandler().handle(
-            new ContainersLauncherEvent(container,
-                ContainersLauncherEventType.CLEANUP_CONTAINER));
-      }
-
+      // Inform the localizer to decrement reference counts and cleanup
+      // resources.
-  static class KilledExternallyTransition extends ExitedWithFailureTransition {
-    KilledExternallyTransition() {
-      super(true);
-    }
-
-    @Override
-    public void transition(ContainerImpl container, ContainerEvent event) {
-      super.transition(container, event);
-      container.diagnostics.append("Killed by external signal\n");
-    }
-  }
-
