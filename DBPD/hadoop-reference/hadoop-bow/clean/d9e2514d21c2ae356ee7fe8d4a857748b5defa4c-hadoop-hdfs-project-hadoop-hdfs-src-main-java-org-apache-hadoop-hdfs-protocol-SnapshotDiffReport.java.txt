HDFS-4487. Fix snapshot diff report for HDFS-4446.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1446385 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Arrays;
+import org.apache.hadoop.fs.Path;
+import org.apache.hadoop.hdfs.DFSUtil;
-    /** The full path of the file/directory where changes have happened */
-    private final String fullPath;
+    /**
+     * The relative path (related to the snapshot root) of the file/directory
+     * where changes have happened
+     */
+    private final byte[] relativePath;
-    public DiffReportEntry(DiffType type, String fullPath) {
+    public DiffReportEntry(DiffType type, byte[] path) {
-      this.fullPath = fullPath;
+      this.relativePath = path;
+    }
+    
+    public DiffReportEntry(DiffType type, byte[][] pathComponents) {
+      this.type = type;
+      this.relativePath = DFSUtil.byteArray2bytes(pathComponents);
-      return type.getLabel() + "\t" + fullPath;
+      return type.getLabel() + "\t" + getRelativePathString();
-    public String getFullPath() {
-      return fullPath;
+    public String getRelativePathString() {
+      String path = DFSUtil.bytes2String(relativePath);
+      if (path.isEmpty()) {
+        return ".";
+      } else {
+        return "." + Path.SEPARATOR + path;
+      }
+    public byte[] getRelativePath() {
+      return relativePath;
+    }
+    
-            && fullPath.equals(entry.getFullPath());
+            && Arrays.equals(relativePath, entry.getRelativePath());
-      return fullPath.hashCode();
+      return Arrays.hashCode(relativePath);
