HDFS-15305. Extend ViewFS and provide ViewFileSystemOverloadScheme implementation with scheme configurable. Contributed by Uma Maheswara Rao G.


-import static org.apache.hadoop.fs.viewfs.Constants.PERMISSION_555;
+import static org.apache.hadoop.fs.viewfs.Constants.PERMISSION_555;
+import java.util.Map.Entry;
-import java.util.Map.Entry;
+   * File system instance getter.
+   */
+  static class FsGetter {
+
+    /**
+     * Gets new file system instance of given uri.
+     */
+    public FileSystem getNewInstance(URI uri, Configuration conf)
+        throws IOException {
+      return FileSystem.newInstance(uri, conf);
+    }
+
+    /**
+     * Gets file system instance of given uri.
+     */
+    public FileSystem get(URI uri, Configuration conf) throws IOException {
+      return FileSystem.get(uri, conf);
+    }
+  }
+
+  /**
+   * Gets file system creator instance.
+   */
+  protected FsGetter fsGetter() {
+    return new FsGetter();
+  }
+
+  /**
+    private FsGetter fsCreator;
+
+    InnerCache(FsGetter fsCreator) {
+      this.fsCreator = fsCreator;
+    }
-        FileSystem fs = FileSystem.newInstance(uri, config);
+        FileSystem fs = fsCreator.getNewInstance(uri, config);
-  URI myUri;
+  private URI myUri;
-    final InnerCache innerCache = new InnerCache();
+    FsGetter fsGetter = fsGetter();
+    final InnerCache innerCache = new InnerCache(fsGetter);
-      myUri = new URI(FsConstants.VIEWFS_SCHEME, authority, "/", null, null);
+      myUri = new URI(getScheme(), authority, "/", null, null);
-
-              fs = FileSystem.get(uri, config);
+              fs = fsGetter.get(uri, config);
