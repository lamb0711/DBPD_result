Merge trunk into HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1170378 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.fs.CommonConfigurationKeysPublic;
-  private final RecordFactory recordFactory = RecordFactoryProvider.getRecordFactory(null);
+  private final RecordFactory recordFactory = 
+      RecordFactoryProvider.getRecordFactory(null);
-  @SuppressWarnings("unchecked")
-      AMLauncherEventType eventType,ApplicationTokenSecretManager applicationTokenSecretManager,
+      AMLauncherEventType eventType,
+      ApplicationTokenSecretManager applicationTokenSecretManager,
-        getContainerMgrProxy(masterContainerID.getAppId());
+        getContainerMgrProxy(
+            masterContainerID.getApplicationAttemptId().getApplicationId());
-    container.addAllCommands(applicationMasterContext.getCommandList());
+    container.setCommands(applicationMasterContext.getCommandList());
-    for (String str : container.getCommandList()) {
+    for (String str : container.getCommands()) {
-    container.clearCommands();
-    container.addAllCommands(commandList);
+    container.setCommands(commandList);
-    container.addAllEnv(applicationMasterContext.getAllEnvironment());
-
-    container.addAllEnv(setupTokensInEnv(applicationMasterContext));
+    Map<String, String> environment = 
+        applicationMasterContext.getAllEnvironment();
+    environment.putAll(setupTokensInEnv(applicationMasterContext));
+    container.setEnv(environment);
-    container.addAllLocalResources(applicationMasterContext.getAllResourcesTodo());
+    container.setLocalResources(applicationMasterContext.getAllResourcesTodo());
-          this.conf.get(YarnConfiguration.SCHEDULER_ADDRESS,
-              YarnConfiguration.DEFAULT_SCHEDULER_BIND_ADDRESS);
+          this.conf.get(YarnConfiguration.RM_SCHEDULER_ADDRESS,
+              YarnConfiguration.DEFAULT_RM_SCHEDULER_ADDRESS);
