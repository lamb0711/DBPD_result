HDFS-2582. Scope dfs.ha.namenodes config by nameservice. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1207738 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Map.Entry;
+import org.apache.hadoop.hdfs.DFSUtil.ConfiguredNNAddress;
+import com.google.common.collect.Lists;
+import com.google.common.collect.Sets;
-      List<InetSocketAddress> isas = DFSUtil.getNNServiceRpcAddresses(conf);
-      for(InetSocketAddress isa : isas) {
+      Map<String, Map<String, InetSocketAddress>> map =
+        DFSUtil.getNNServiceRpcAddresses(conf);
+      for (Entry<String, Map<String, InetSocketAddress>> entry :
+           map.entrySet()) {
+        List<InetSocketAddress> nnList = Lists.newArrayList(entry.getValue().values());
+        // TODO(HA) when HDFS-1971 (dual BRs) is done, pass all of the NNs
+        // to BPOS
+        InetSocketAddress isa = nnList.get(0);
-      List<InetSocketAddress> newAddresses = 
+      
+      // TODO(HA): need to update this for multiple NNs per nameservice
+      // For now, just list all of the NNs into this set
+      Map<String, Map<String, InetSocketAddress>> newAddressMap = 
+      Set<InetSocketAddress> newAddresses = Sets.newHashSet();
+      for (ConfiguredNNAddress cnn : DFSUtil.flattenAddressMap(newAddressMap)) {
+        newAddresses.add(cnn.getAddress());
+      }
+      
