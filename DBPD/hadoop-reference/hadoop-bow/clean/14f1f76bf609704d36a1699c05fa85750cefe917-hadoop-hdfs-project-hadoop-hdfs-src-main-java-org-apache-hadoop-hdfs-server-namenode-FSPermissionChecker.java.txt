HDFS-5614. NameNode: implement handling of ACLs in combination with snapshots. Contributed by Chris Nauroth.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-4685@1563304 13f79535-47bb-0310-9956-ffa450edef68

-      // TODO: handling of INodeReference?
-      AclFeature aclFeature = inode instanceof INodeWithAdditionalFields ?
-        ((INodeWithAdditionalFields)inode).getAclFeature() : null;
-      if (aclFeature != null) {
-        List<AclEntry> featureEntries = aclFeature.getEntries();
-        // It's possible that the inode has a default ACL but no access ACL.
-        if (featureEntries.get(0).getScope() == AclEntryScope.ACCESS) {
-          checkAccessAcl(inode, snapshotId, access, mode, featureEntries);
-          return;
-        }
+      AclFeature aclFeature = inode.getAclFeature(snapshotId);
+      assert aclFeature != null;
+      List<AclEntry> featureEntries = aclFeature.getEntries();
+      // It's possible that the inode has a default ACL but no access ACL.
+      if (featureEntries.get(0).getScope() == AclEntryScope.ACCESS) {
+        checkAccessAcl(inode, snapshotId, access, mode, featureEntries);
+        return;
