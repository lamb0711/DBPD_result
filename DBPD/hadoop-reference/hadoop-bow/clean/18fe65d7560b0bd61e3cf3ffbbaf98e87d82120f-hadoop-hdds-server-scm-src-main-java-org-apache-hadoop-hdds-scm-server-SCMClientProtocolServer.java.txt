HDDS-576. Move ContainerWithPipeline creation to RPC endpoint.
Contributed by Nanda kumar.

+import org.apache.hadoop.hdds.scm.container.ContainerReplica;
+import java.util.stream.Collectors;
-    String remoteUser = getRpcRemoteUsername();
-    getScm().checkAdminAccess(remoteUser);
+    getScm().checkAdminAccess(getRpcRemoteUsername());
-    return scm.getContainerManager()
+    final ContainerInfo container = scm.getContainerManager()
+    final Pipeline pipeline = scm.getPipelineManager()
+        .getPipeline(container.getPipelineID());
+    return new ContainerWithPipeline(container, pipeline);
-    return scm.getContainerManager()
-        .getContainerWithPipeline(ContainerID.valueof(containerID));
+
+    final ContainerID id = ContainerID.valueof(containerID);
+    final ContainerInfo container = scm.getContainerManager().getContainer(id);
+    final Pipeline pipeline;
+
+    if (container.isOpen()) {
+      // Ratis pipeline
+      pipeline = scm.getPipelineManager()
+          .getPipeline(container.getPipelineID());
+    } else {
+      pipeline = scm.getPipelineManager().createPipeline(
+          HddsProtos.ReplicationType.STAND_ALONE,
+          container.getReplicationFactor(),
+          scm.getContainerManager()
+              .getContainerReplicas(id).stream()
+              .map(ContainerReplica::getDatanodeDetails)
+              .collect(Collectors.toList()));
+    }
+
+    return new ContainerWithPipeline(container, pipeline);
