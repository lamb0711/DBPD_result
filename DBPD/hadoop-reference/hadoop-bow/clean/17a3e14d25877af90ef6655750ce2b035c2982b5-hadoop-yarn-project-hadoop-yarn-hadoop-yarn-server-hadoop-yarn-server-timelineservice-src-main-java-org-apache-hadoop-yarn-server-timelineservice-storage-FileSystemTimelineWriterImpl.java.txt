YARN-9338 Timeline related testcases are failing. Contributed by Abhishek Modi.

+import org.apache.hadoop.fs.FSDataInputStream;
+  private Configuration config;
-    Path clusterIdPath = new Path(entitiesPath, clusterId);
-    Path userIdPath = new Path(clusterIdPath, userId);
-    Path flowNamePath = new Path(userIdPath, escape(flowName));
-    Path flowVersionPath = new Path(flowNamePath, escape(flowVersion));
-    Path flowRunPath = new Path(flowVersionPath, String.valueOf(flowRun));
-    Path appIdPath = new Path(flowRunPath, appId);
-    Path entityTypePath = new Path(appIdPath, entity.getType());
+    String entityTypePathStr = clusterId + File.separator + userId +
+        File.separator + escape(flowName) + File.separator +
+        escape(flowVersion) + File.separator + flowRun + File.separator + appId
+        + File.separator + entity.getType();
+    Path entityTypePath = new Path(entitiesPath, entityTypePathStr);
-      mkdirs(rootPath, entitiesPath, clusterIdPath, userIdPath,
-              flowNamePath, flowVersionPath, flowRunPath, appIdPath,
-              entityTypePath);
+      mkdirs(entityTypePath);
-    fs = rootPath.getFileSystem(getConfig());
+    config = conf;
+    fs = rootPath.getFileSystem(config);
+      FSDataInputStream fsIn = fs.open(outputPath);
+      IOUtils.copyBytes(fsIn, fsOut, config, false);
+      fsIn.close();
+      fs.delete(outputPath, false);
-      fsOut = null;
-    } finally {
-      IOUtils.cleanupWithLogger(LOG, fsOut);
+    } catch (IOException ie) {
+      LOG.error("Got an exception while writing file", ie);
