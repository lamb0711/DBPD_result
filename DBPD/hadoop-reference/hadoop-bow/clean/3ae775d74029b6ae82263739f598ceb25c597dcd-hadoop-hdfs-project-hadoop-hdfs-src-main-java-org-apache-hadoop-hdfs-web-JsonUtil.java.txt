HDFS-14034. Support getQuotaUsage API in WebHDFS. Contributed by Chao Sun.

Signed-off-by: Wei-Chiu Chuang <weichiu@apache.org>

+import org.apache.hadoop.fs.QuotaUsage;
-    m.put("quota", contentsummary.getQuota());
-    m.put("spaceConsumed", contentsummary.getSpaceConsumed());
-    m.put("spaceQuota", contentsummary.getSpaceQuota());
-    final Map<String, Map<String, Long>> typeQuota =
-        new TreeMap<String, Map<String, Long>>();
+    // For ContentSummary we don't need this since we already have
+    // separate count for file and directory.
+    m.putAll(toJsonMap(contentsummary, false));
+    return toJsonString(ContentSummary.class, m);
+  }
+
+  /** Convert a QuotaUsage to a JSON string. */
+  public static String toJsonString(final QuotaUsage quotaUsage) {
+    if (quotaUsage == null) {
+      return null;
+    }
+    return toJsonString(QuotaUsage.class, toJsonMap(quotaUsage, true));
+  }
+
+  private static Map<String, Object> toJsonMap(
+      final QuotaUsage quotaUsage, boolean includeFileAndDirectoryCount) {
+    final Map<String, Object> m = new TreeMap<>();
+    if (includeFileAndDirectoryCount) {
+      m.put("fileAndDirectoryCount", quotaUsage.getFileAndDirectoryCount());
+    }
+    m.put("quota", quotaUsage.getQuota());
+    m.put("spaceConsumed", quotaUsage.getSpaceConsumed());
+    m.put("spaceQuota", quotaUsage.getSpaceQuota());
+    final Map<String, Map<String, Long>> typeQuota = new TreeMap<>();
-      long tQuota = contentsummary.getTypeQuota(t);
+      long tQuota = quotaUsage.getTypeQuota(t);
-          type = new TreeMap<String, Long>();
+          type = new TreeMap<>();
-        type.put("quota", contentsummary.getTypeQuota(t));
-        type.put("consumed", contentsummary.getTypeConsumed(t));
+        type.put("quota", quotaUsage.getTypeQuota(t));
+        type.put("consumed", quotaUsage.getTypeConsumed(t));
-    return toJsonString(ContentSummary.class, m);
+    return m;
