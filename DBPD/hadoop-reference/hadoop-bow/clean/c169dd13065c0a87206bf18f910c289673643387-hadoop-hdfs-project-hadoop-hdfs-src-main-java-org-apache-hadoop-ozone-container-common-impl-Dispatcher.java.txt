HDFS-11463. Ozone: Add metrics for container operations and export over JMX. Contributed by Mukul Kumar Singh.

+import org.apache.hadoop.conf.Configuration;
+import org.apache.hadoop.ozone.container.common.helpers.ContainerMetrics;
-
+  private ContainerMetrics metrics;
+  private Configuration conf;
-  public Dispatcher(ContainerManager containerManager) {
+  public Dispatcher(ContainerManager containerManager, Configuration config) {
+    this.metrics = null;
+    this.conf = config;
+  }
+
+  @Override
+  public void init() {
+    this.metrics = ContainerMetrics.create(conf);
+  }
+
+  @Override
+  public void shutdown() {
+    long startNanos = System.nanoTime();
+    ContainerCommandResponseProto resp = null;
+    metrics.incContainerOpcMetrics(cmdType);
-      return containerProcessHandler(msg);
+      resp = containerProcessHandler(msg);
-      return keyProcessHandler(msg);
+      resp = keyProcessHandler(msg);
-      return chunkProcessHandler(msg);
+      resp = chunkProcessHandler(msg);
-      return smallFileHandler(msg);
+      resp = smallFileHandler(msg);
+    }
+
+    if (resp != null) {
+      metrics.incContainerOpsLatencies(cmdType,
+                            System.nanoTime() - startNanos);
+      return resp;
+  public ContainerMetrics getContainerMetrics() {
+    return metrics;
+  }
+    metrics.incContainerBytesStats(Type.WriteChunk, data.length);
+    metrics.incContainerBytesStats(Type.ReadChunk, data.length);
+    long numBytes = keyData.getProtoBufMessage().toByteArray().length;
+    metrics.incContainerBytesStats(Type.PutKey, numBytes);
+    long numBytes = responseData.getProtoBufMessage().toByteArray().length;
+    metrics.incContainerBytesStats(Type.GetKey, numBytes);
+    metrics.incContainerBytesStats(Type.PutSmallFile, data.length);
+    long bytes = 0;
+      bytes += chunk.getSerializedSize();
-
+    metrics.incContainerBytesStats(Type.GetSmallFile,  bytes);
