YARN-4957. Add getNewReservation in ApplicationClientProtocol (Sean Po via curino)

+import org.apache.hadoop.yarn.api.protocolrecords.GetNewReservationRequest;
+import org.apache.hadoop.yarn.api.protocolrecords.GetNewReservationResponse;
+  public GetNewReservationResponse getNewReservation(
+      GetNewReservationRequest request) throws YarnException, IOException {
+    checkReservationSytem(AuditConstants.CREATE_NEW_RESERVATION_REQUEST);
+    GetNewReservationResponse response =
+        recordFactory.newRecordInstance(GetNewReservationResponse.class);
+
+    ReservationId reservationId = reservationSystem.getNewReservationId();
+    response.setReservationId(reservationId);
+    // Create a new Reservation Id
+    return response;
+  }
+
+  @Override
-    // Create a new Reservation Id
-    ReservationId reservationId = reservationSystem.getNewReservationId();
+    ReservationId reservationId = request.getReservationId();
+
+    ReservationAllocation allocation = plan.getReservationById(reservationId);
+
+    if (allocation != null) {
+      boolean isNewDefinition = !allocation.getReservationDefinition().equals(
+          request.getReservationDefinition());
+      if (isNewDefinition) {
+        String message = "Reservation allocation already exists with the " +
+            "reservation id " + reservationId.toString() + ", but a different" +
+            " reservation definition was provided. Please try again with a " +
+            "new reservation id, or consider updating the reservation instead.";
+        throw RPCUtil.getRemoteException(message);
+      } else {
+        return response;
+      }
+    }
+
-        response.setReservationId(reservationId);
