HDFS-4116. Add auditlog for some snapshot operations. Contributed by Jing Zhao.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1404860 13f79535-47bb-0310-9956-ffa450edef68

-        throw new SafeModeException("Cannot allow snapshot for " + path, safeMode);
+        throw new SafeModeException("Cannot allow snapshot for " + path,
+            safeMode);
-    //TODO: audit log
+    if (auditLog.isInfoEnabled() && isExternalInvocation()) {
+      logAuditEvent(UserGroupInformation.getCurrentUser(), getRemoteIp(),
+          "allowSnapshot", path, null, null);
+    }
+    
+    if (auditLog.isInfoEnabled() && isExternalInvocation()) {
+      logAuditEvent(UserGroupInformation.getCurrentUser(), getRemoteIp(),
+          "disallowSnapshot", snapshotRoot, null, null);
+    }
-        throw new SafeModeException("Cannot create snapshot for " + path, safeMode);
+        throw new SafeModeException("Cannot create snapshot for " + path,
+            safeMode);
-    //TODO: audit log
+    if (auditLog.isInfoEnabled() && isExternalInvocation()) {
+      Path snapshotRoot = new Path(path, ".snapshot/" + snapshotName);
+      logAuditEvent(UserGroupInformation.getCurrentUser(), getRemoteIp(),
+          "createSnapshot", path, snapshotRoot.toString(), null);
+    }
