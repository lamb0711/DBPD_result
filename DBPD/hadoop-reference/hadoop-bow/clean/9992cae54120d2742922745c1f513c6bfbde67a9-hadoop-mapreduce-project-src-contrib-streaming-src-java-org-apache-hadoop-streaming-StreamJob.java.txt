Reverting the previous trunk merge since it added other unintended changes in addition


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1177127 13f79535-47bb-0310-9956-ffa450edef68

-import java.net.URISyntaxException;
-import java.util.Arrays;
-import org.apache.hadoop.fs.FileSystem;
-
-        String fileList = null;
+        StringBuilder unpackRegex = new StringBuilder(
+          config_.getPattern(MRJobConfig.JAR_UNPACK_PATTERN,
+                             JobConf.UNPACK_JAR_PATTERN_DEFAULT).pattern());
-          try {
-            URI pathURI = new URI(file);
-            Path path = new Path(pathURI);
-            FileSystem localFs = FileSystem.getLocal(config_);
-            String finalPath = path.makeQualified(localFs).toString();
-            fileList = fileList == null ? finalPath : fileList + "," + finalPath;
-          } catch (Exception e) {
-            throw new IllegalArgumentException(e);
-          }
+          String fname = new File(file).getName();
+          unpackRegex.append("|(?:").append(Pattern.quote(fname)).append(")");
-        config_.set("tmpfiles", config_.get("tmpfiles", "") +
-                                  (fileList == null ? "" : fileList));
+        config_.setPattern(MRJobConfig.JAR_UNPACK_PATTERN,
+                           Pattern.compile(unpackRegex.toString()));
-
+         
