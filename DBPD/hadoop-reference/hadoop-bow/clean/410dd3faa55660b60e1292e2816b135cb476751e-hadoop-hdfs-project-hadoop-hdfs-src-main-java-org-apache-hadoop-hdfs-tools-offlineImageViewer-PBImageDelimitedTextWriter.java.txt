HDFS-13744. OIV tool should better handle control characters present in file or directory names. Contributed by Zsolt Venczel.

+import org.apache.commons.lang3.StringUtils;
+import org.apache.commons.text.StringEscapeUtils;
+  static final String CRLF = StringUtils.CR + StringUtils.LF;
+
-    buffer.append(field);
+
+    String escapedField = StringEscapeUtils.escapeCsv(field);
+    if (escapedField.contains(CRLF)) {
+      escapedField = escapedField.replace(CRLF, "%x0D%x0A");
+    } else if (escapedField.contains(StringUtils.LF)) {
+      escapedField = escapedField.replace(StringUtils.LF, "%x0A");
+    }
+
+    buffer.append(escapedField);
-    buffer.append(path.toString());
+    append(buffer, path.toString());
-    return buffer.toString();
+    return buffer.substring(1);
