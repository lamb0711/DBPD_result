Merge changes from trunk

+import org.apache.hadoop.yarn.proto.YarnProtos.ResourceOptionProtoOrBuilder;
-  ResourceOptionProto proto = null;
+  ResourceOptionProto proto = ResourceOptionProto.getDefaultInstance();
-  private Resource resource = null;
+  boolean viaProto = false;
-    this.resource = convertFromProtoFormat(proto.getResource());
+    viaProto = true;
+    proto = viaProto ? proto : builder.build();
+    viaProto = true;
-    return this.resource;
+    ResourceOptionProtoOrBuilder p = viaProto ? proto : builder;
+    return convertFromProtoFormat(p.getResource());
-    if (resource != null) {
-      Preconditions.checkNotNull(builder);
-      builder.setResource(convertToProtoFormat(resource));
-    }
-    this.resource = resource;
+    maybeInitBuilder();
+    builder.setResource(convertToProtoFormat(resource));
-    Preconditions.checkNotNull(proto);
-    return proto.getOverCommitTimeout();
+    ResourceOptionProtoOrBuilder p = viaProto ? proto : builder;
+    return p.getOverCommitTimeout();
-    Preconditions.checkNotNull(builder);
+    maybeInitBuilder();
+  private void maybeInitBuilder() {
+    if (viaProto || builder == null) {
+      builder = ResourceOptionProto.newBuilder(proto);
+    }
+    viaProto = false;
+  }
+  
+    viaProto = true;
