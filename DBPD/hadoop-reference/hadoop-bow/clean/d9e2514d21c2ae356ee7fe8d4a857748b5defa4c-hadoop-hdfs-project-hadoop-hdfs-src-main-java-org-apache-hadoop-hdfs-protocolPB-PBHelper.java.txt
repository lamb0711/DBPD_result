HDFS-4487. Fix snapshot diff report for HDFS-4446.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1446385 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.DFSUtil;
-    ByteString keyBytes = ByteString.copyFrom(encodedKey == null ? new byte[0]
-        : encodedKey);
+    ByteString keyBytes = ByteString.copyFrom(encodedKey == null ? 
+        DFSUtil.EMPTY_BYTES : encodedKey);
-    ByteString parentFullPathBytes = ByteString
-        .copyFrom(parentFullPath == null ? new byte[0] : parentFullPath);
+    ByteString parentFullPathBytes = ByteString.copyFrom(
+        parentFullPath == null ? DFSUtil.EMPTY_BYTES : parentFullPath);
-    return type != null ? new DiffReportEntry(type, entry.getFullpath())
-        : null;
+    return type == null ? null : 
+      new DiffReportEntry(type, entry.getFullpath().toByteArray());
-    String fullPath = entry.getFullPath();
+    byte[] fullPath = entry.getRelativePath();
+    ByteString fullPathString = ByteString
+        .copyFrom(fullPath == null ? DFSUtil.EMPTY_BYTES : fullPath);
+    
-        .newBuilder().setFullpath(fullPath).setModificationLabel(modification)
-        .build();
+        .newBuilder().setFullpath(fullPathString)
+        .setModificationLabel(modification).build();
