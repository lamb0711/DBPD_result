HDDS-2174. Delete GDPR Encryption Key from metadata when a Key is deleted

Signed-off-by: Anu Engineer <aengineer@apache.org>

+import org.apache.hadoop.ozone.OmUtils;
-
-      if(repeatedOmKeyInfo == null) {
-        repeatedOmKeyInfo = new RepeatedOmKeyInfo(deletePartKeyInfo);
-      } else {
-        repeatedOmKeyInfo.addOmKeyInfo(deletePartKeyInfo);
-      }
+
+      repeatedOmKeyInfo = OmUtils.prepareKeyForDelete(
+          deletePartKeyInfo, repeatedOmKeyInfo);
+
+
+      //   0. Strip GDPR related metadata from multipart info
-        RepeatedOmKeyInfo repeatedOmKeyInfo = omMetadataManager.
-            getDeletedTable().get(oldMultipartKeyInfo.getPartName());
-        if(repeatedOmKeyInfo == null) {
-          repeatedOmKeyInfo = new RepeatedOmKeyInfo(
-              OmKeyInfo.getFromProtobuf(oldMultipartKeyInfo.getPartKeyInfo()));
-        } else {
-          repeatedOmKeyInfo.addOmKeyInfo(
-              OmKeyInfo.getFromProtobuf(oldMultipartKeyInfo.getPartKeyInfo()));
-        }
+        OmKeyInfo partKey =
+            OmKeyInfo.getFromProtobuf(oldMultipartKeyInfo.getPartKeyInfo());
+
+        RepeatedOmKeyInfo repeatedOmKeyInfo =
+            omMetadataManager.getDeletedTable()
+                .get(oldMultipartKeyInfo.getPartName());
+
+        repeatedOmKeyInfo = OmUtils.prepareKeyForDelete(partKey,
+            repeatedOmKeyInfo);
-
-
-
