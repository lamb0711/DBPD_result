HDDS-1638.  Implement Key Write Requests to use Cache and DoubleBuffer. (#956)



+import java.util.HashMap;
+import java.util.LinkedHashMap;
+import org.apache.hadoop.ozone.OzoneConsts;
-import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos;
+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos
+    .KeyArgs;
+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos
+    .UserInfo;
-      Map<String, String> auditMap, Throwable throwable,
-      OzoneManagerProtocolProtos.UserInfo userInfo);
+      Map<String, String> auditMap, Throwable throwable, UserInfo userInfo);
+
+  /**
+   * Build auditMap for KeyArgs.
+   * @param keyArgs
+   */
+  default Map<String, String> buildKeyArgsAuditMap(KeyArgs keyArgs) {
+
+    if (keyArgs == null) {
+      return new HashMap<>(0);
+    } else {
+      Map< String, String > auditMap = new LinkedHashMap<>();
+      auditMap.put(OzoneConsts.VOLUME, keyArgs.getVolumeName());
+      auditMap.put(OzoneConsts.BUCKET, keyArgs.getBucketName());
+      auditMap.put(OzoneConsts.KEY, keyArgs.getKeyName());
+      auditMap.put(OzoneConsts.DATA_SIZE,
+          String.valueOf(keyArgs.getDataSize()));
+      auditMap.put(OzoneConsts.REPLICATION_TYPE,
+          (keyArgs.getType() != null) ? keyArgs.getType().name() : null);
+      auditMap.put(OzoneConsts.REPLICATION_FACTOR,
+          (keyArgs.getFactor() != null) ? keyArgs.getFactor().name() : null);
+      auditMap.put(OzoneConsts.KEY_LOCATION_INFO,
+          (keyArgs.getKeyLocationsList() != null) ?
+              keyArgs.getKeyLocationsList().toString() : null);
+      return auditMap;
+    }
+  }
