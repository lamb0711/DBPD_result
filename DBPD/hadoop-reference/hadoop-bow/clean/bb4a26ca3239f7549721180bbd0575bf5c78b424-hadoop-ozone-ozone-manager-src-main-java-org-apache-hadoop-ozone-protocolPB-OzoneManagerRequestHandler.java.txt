HDDS-8. Add OzoneManager Delegation Token support. Contributed by Ajay Kumar.

+
+import org.apache.hadoop.io.Text;
+import org.apache.hadoop.ozone.security.OzoneTokenIdentifier;
+import org.apache.hadoop.security.proto.SecurityProtos.CancelDelegationTokenRequestProto;
+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos.CancelDelegationTokenResponseProto;
+import org.apache.hadoop.security.proto.SecurityProtos.GetDelegationTokenRequestProto;
+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos.GetDelegationTokenResponseProto;
+import org.apache.hadoop.security.proto.SecurityProtos.RenewDelegationTokenRequestProto;
+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos.RenewDelegationTokenResponseProto;
+import org.apache.hadoop.security.token.Token;
+
+    case GetDelegationToken:
+      GetDelegationTokenResponseProto getDtResp = getDelegationToken(
+          request.getGetDelegationTokenRequest());
+      responseBuilder.setGetDelegationTokenResponse(getDtResp);
+      break;
+    case RenewDelegationToken:
+      RenewDelegationTokenResponseProto renewDtResp = renewDelegationToken(
+          request.getRenewDelegationTokenRequest());
+      responseBuilder.setRenewDelegationTokenResponse(renewDtResp);
+      break;
+    case CancelDelegationToken:
+      CancelDelegationTokenResponseProto cancelDtResp = cancelDelegationToken(
+          request.getCancelDelegationTokenRequest());
+      responseBuilder.setCancelDelegationTokenResponse(cancelDtResp);
+      break;
+
+  private GetDelegationTokenResponseProto getDelegationToken(
+      GetDelegationTokenRequestProto request){
+    GetDelegationTokenResponseProto.Builder rb =
+        GetDelegationTokenResponseProto.newBuilder();
+    try {
+      Token<OzoneTokenIdentifier> token = impl
+          .getDelegationToken(new Text(request.getRenewer()));
+      if (token != null) {
+        rb.setResponse(org.apache.hadoop.security.proto.SecurityProtos
+            .GetDelegationTokenResponseProto.newBuilder().setToken(OMPBHelper
+                .convertToTokenProto(token)).build());
+      }
+      rb.setStatus(Status.OK);
+      } catch (IOException ex) {
+      rb.setStatus(exceptionToResponseStatus(ex));
+    }
+    return rb.build();
+  }
+
+  private RenewDelegationTokenResponseProto renewDelegationToken(
+      RenewDelegationTokenRequestProto request) {
+    RenewDelegationTokenResponseProto.Builder rb =
+        RenewDelegationTokenResponseProto.newBuilder();
+    try {
+      if(request.hasToken()) {
+        long expiryTime = impl
+            .renewDelegationToken(
+                OMPBHelper.convertToDelegationToken(request.getToken()));
+        rb.setResponse(org.apache.hadoop.security.proto.SecurityProtos
+            .RenewDelegationTokenResponseProto.newBuilder()
+            .setNewExpiryTime(expiryTime).build());
+      }
+      rb.setStatus(Status.OK);
+    } catch (IOException ex) {
+      rb.setStatus(exceptionToResponseStatus(ex));
+    }
+    return rb.build();
+  }
+
+  private CancelDelegationTokenResponseProto cancelDelegationToken(
+      CancelDelegationTokenRequestProto req) {
+    CancelDelegationTokenResponseProto.Builder rb =
+        CancelDelegationTokenResponseProto.newBuilder();
+    try {
+      if(req.hasToken()) {
+        impl.cancelDelegationToken(
+            OMPBHelper.convertToDelegationToken(req.getToken()));
+      }
+      rb.setResponse(org.apache.hadoop.security.proto.SecurityProtos
+          .CancelDelegationTokenResponseProto.getDefaultInstance());
+      rb.setStatus(Status.OK);
+    } catch (IOException ex) {
+      rb.setStatus(exceptionToResponseStatus(ex));
+    }
+    return rb.build();
+  }
