Merge HDFS-8394 from trunk: Move getAdditionalBlock() and related functionalities into a separate class.

-  public final short getReplication(int lastSnapshotId) {
-    if (lastSnapshotId != CURRENT_STATE_ID) {
-      return getFileReplication(lastSnapshotId);
-    } else {
-      return getBlockReplication();
-    }
-  }
-
