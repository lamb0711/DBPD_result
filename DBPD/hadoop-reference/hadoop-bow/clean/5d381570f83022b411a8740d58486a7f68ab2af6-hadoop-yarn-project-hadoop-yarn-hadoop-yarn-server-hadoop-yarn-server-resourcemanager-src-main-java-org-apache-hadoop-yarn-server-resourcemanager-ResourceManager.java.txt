YARN-8062. yarn rmadmin -getGroups returns group from which the user has been removed. (Sunil G via wangda)

Change-Id: I80ed63846502bf7751b890b6c6c6a7c0679e2b4a

-    // Do refreshUserToGroupsMappings with loaded core-site.xml
-    Groups.getUserToGroupsMappingServiceWithLoadedConfiguration(this.conf)
-        .refresh();
+    // Refresh user to group mappings during init.
+    refreshUserToGroupMappingsWithConf();
+  private void refreshUserToGroupMappingsWithConf()
+      throws YarnException, IOException {
+    Configuration newConf = new Configuration(false);
+    InputStream confFileInputStream =
+        configurationProvider
+        .getConfigurationInputStream(newConf, YarnConfiguration.CORE_SITE_CONFIGURATION_FILE);
+    if (confFileInputStream != null) {
+      newConf.addResource(confFileInputStream);
+    }
+
+    // Do refreshUserToGroupsMappings with loaded core-site.xml
+    Groups.getUserToGroupsMappingServiceWithLoadedConfiguration(newConf)
+        .refresh();
+  }
+
