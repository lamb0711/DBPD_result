HDDS-1856. Make required changes for Non-HA to use new HA code in OM. (#1174)


+import org.apache.hadoop.ozone.om.ratis.utils.OzoneManagerDoubleBufferHelper;
-      long transactionLogIndex) {
+      long transactionLogIndex,
+      OzoneManagerDoubleBufferHelper ozoneManagerDoubleBufferHelper) {
-    OmKeyInfo dirKeyInfo = null;
-
+    OMClientResponse omClientResponse = null;
-
+      OmKeyInfo dirKeyInfo = null;
+      omResponse.setCreateDirectoryResponse(
+          CreateDirectoryResponse.newBuilder());
+      omClientResponse = new OMDirectoryCreateResponse(dirKeyInfo,
+          omResponse.build());
+
+      omClientResponse = new OMDirectoryCreateResponse(null,
+          createErrorOMResponse(omResponse, exception));
+      if (omClientResponse != null) {
+        omClientResponse.setFlushFuture(
+            ozoneManagerDoubleBufferHelper.add(omClientResponse,
+                transactionLogIndex));
+      }
-      omResponse.setCreateDirectoryResponse(
-          CreateDirectoryResponse.newBuilder());
-      return new OMDirectoryCreateResponse(dirKeyInfo,
-          omResponse.build());
+      return omClientResponse;
-      return new OMDirectoryCreateResponse(null,
-          createErrorOMResponse(omResponse, exception));
+      return omClientResponse;
