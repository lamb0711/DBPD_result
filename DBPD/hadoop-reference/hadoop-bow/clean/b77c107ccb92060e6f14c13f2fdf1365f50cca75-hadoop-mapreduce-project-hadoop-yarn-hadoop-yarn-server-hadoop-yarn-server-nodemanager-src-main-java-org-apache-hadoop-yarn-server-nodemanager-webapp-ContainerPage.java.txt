Committing rest of merge from trunk (accidentally only committed the HDFS portion before)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1214546 13f79535-47bb-0310-9956-ffa450edef68

-import static org.apache.hadoop.yarn.util.StringHelper.ujoin;
-import org.apache.hadoop.yarn.api.records.ContainerStatus;
-import org.apache.hadoop.yarn.conf.YarnConfiguration;
+import org.apache.hadoop.yarn.server.nodemanager.webapp.dao.ContainerInfo;
-import org.apache.hadoop.yarn.webapp.YarnWebParams;
+import org.apache.hadoop.yarn.webapp.YarnWebParams;
-      ContainerStatus containerData = container.cloneAndGetContainerStatus();
-      int exitCode = containerData.getExitStatus();
-      String exiStatus = 
-          (exitCode == YarnConfiguration.INVALID_CONTAINER_EXIT_STATUS) ? 
-              "N/A" : String.valueOf(exitCode);
+      ContainerInfo info = new ContainerInfo(this.nmContext, container);
+
-        ._("ContainerID", $(CONTAINER_ID))
-        ._("ContainerState", container.getContainerState())
-        ._("ExitStatus", exiStatus)
-        ._("Diagnostics", containerData.getDiagnostics())
-        ._("User", container.getUser())
-        ._("TotalMemoryNeeded",
-            container.getLaunchContext().getResource().getMemory())
-        ._("logs", ujoin("containerlogs", $(CONTAINER_ID), container.getUser()),
-            "Link to logs");
+        ._("ContainerID", info.getId())
+        ._("ContainerState", info.getState())
+        ._("ExitStatus", info.getExitStatus())
+        ._("Diagnostics", info.getDiagnostics())
+        ._("User", info.getUser())
+        ._("TotalMemoryNeeded", info.getMemoryNeeded())
+        ._("logs", info.getShortLogLink(), "Link to logs");
