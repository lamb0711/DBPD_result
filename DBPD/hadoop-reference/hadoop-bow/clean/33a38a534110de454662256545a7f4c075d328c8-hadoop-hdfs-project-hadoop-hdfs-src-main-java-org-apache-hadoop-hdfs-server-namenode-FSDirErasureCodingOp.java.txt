HDFS-11314. Enforce set of enabled EC policies on the NameNode.

-import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.stream.Collectors;
+import org.apache.hadoop.hdfs.DFSConfigKeys;
-          .getPolicyByName(ecPolicyName);
+          .getEnabledPolicyByName(ecPolicyName);
-        throw new HadoopIllegalArgumentException("Policy '" +
-            ecPolicyName + "' does not match any supported erasure coding " +
-            "policies.");
+        final String sysPolicies =
+            Arrays.asList(
+                fsn.getErasureCodingPolicyManager().getEnabledPolicies())
+                .stream()
+                .map(ErasureCodingPolicy::getName)
+                .collect(Collectors.joining(", "));
+        final String message = String.format("Policy '%s' does not match any " +
+            "enabled erasure" +
+            " coding policies: [%s]. The set of enabled erasure coding " +
+            "policies can be configured at '%s'.",
+            ecPolicyName,
+            sysPolicies,
+            DFSConfigKeys.DFS_NAMENODE_EC_POLICIES_ENABLED_KEY
+            );
+        throw new HadoopIllegalArgumentException(message);
-    // Check that the EC policy is one of the active policies.
-    boolean validPolicy = false;
-    ErasureCodingPolicy[] activePolicies =
-        FSDirErasureCodingOp.getErasureCodingPolicies(fsd.getFSNamesystem());
-    for (ErasureCodingPolicy activePolicy : activePolicies) {
-      if (activePolicy.equals(ecPolicy)) {
-        validPolicy = true;
-        break;
-      }
-    }
-    if (!validPolicy) {
-      List<String> ecPolicyNames = new ArrayList<String>();
-      for (ErasureCodingPolicy activePolicy : activePolicies) {
-        ecPolicyNames.add(activePolicy.getName());
-      }
-      throw new HadoopIllegalArgumentException("Policy [ " +
-          ecPolicy.getName() + " ] does not match any of the " +
-          "supported policies. Please select any one of " + ecPolicyNames);
-    }
-
-    return fsn.getErasureCodingPolicyManager().getPolicies();
+    return fsn.getErasureCodingPolicyManager().getEnabledPolicies();
-          return id < 0 ? null : fsd.getFSNamesystem().
-              getErasureCodingPolicyManager().getPolicyByID(id);
+          return id < 0 ? null :
+              ErasureCodingPolicyManager.getPolicyByID(id);
-            return fsd.getFSNamesystem().getErasureCodingPolicyManager().
-                getPolicyByName(ecPolicyName);
+            return ErasureCodingPolicyManager
+                .getPolicyByName(ecPolicyName);
