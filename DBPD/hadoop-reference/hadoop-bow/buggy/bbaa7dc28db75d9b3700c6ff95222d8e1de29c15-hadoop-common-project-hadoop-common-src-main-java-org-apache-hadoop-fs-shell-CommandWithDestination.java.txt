HDFS-6928. 'hdfs put' command should accept lazyPersist flag for testing. (Arpit Agarwal)

+import org.apache.hadoop.fs.CreateFlag;
+import static org.apache.hadoop.fs.CreateFlag.CREATE;
+import static org.apache.hadoop.fs.CreateFlag.LAZY_PERSIST;
+
+  private boolean lazyPersist = false;
+  protected void setLazyPersist(boolean flag) {
+    lazyPersist = flag;
+  }
+
-      targetFs.writeStreamToFile(in, tempTarget);
+      targetFs.writeStreamToFile(in, tempTarget, lazyPersist);
-    void writeStreamToFile(InputStream in, PathData target) throws IOException {
+    void writeStreamToFile(InputStream in, PathData target,
+                           boolean lazyPersist) throws IOException {
-        out = create(target);
+        out = create(target, lazyPersist);
-    FSDataOutputStream create(PathData item) throws IOException {
+    FSDataOutputStream create(PathData item, boolean lazyPersist)
+        throws IOException {
-        return create(item.path, true);
+        EnumSet<CreateFlag> createFlags = EnumSet.of(CREATE);
+        if (lazyPersist) {
+          createFlags.add(LAZY_PERSIST);
+        }
+        return create(item.path,
+                      null,
+                      createFlags,
+                      getConf().getInt("io.file.buffer.size", 4096),
+                      lazyPersist ? 1 : getDefaultReplication(item.path),
+                      getDefaultBlockSize(),
+                      null,
+                      null);
