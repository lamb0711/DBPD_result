Revert "HADOOP-14556. S3A to support Delegation Tokens."

This reverts commit d7152332b32a575c3a92e3f4c44b95e58462528d.

-import javax.annotation.Nullable;
-import java.util.Arrays;
+import com.amazonaws.AmazonClientException;
-import com.amazonaws.auth.EnvironmentVariableCredentialsProvider;
-import com.google.common.collect.Sets;
-import org.apache.hadoop.fs.s3a.CredentialInitializationException;
-import org.apache.hadoop.fs.s3a.Retries;
-import static org.apache.hadoop.fs.s3a.S3AUtils.buildAWSProviderList;
+import static org.apache.hadoop.fs.s3a.S3AUtils.createAWSCredentialProvider;
+import static org.apache.hadoop.fs.s3a.S3AUtils.loadAWSProviderClasses;
+  static final String E_FORBIDDEN_PROVIDER =
+      "AssumedRoleCredentialProvider cannot be in "
+          + ASSUMED_ROLE_CREDENTIALS_PROVIDER;
+
-   * @param fsUri possibly null URI of the filesystem.
+   * @param fsUri URI of the filesystem.
-  public AssumedRoleCredentialProvider(@Nullable URI fsUri, Configuration conf)
+  public AssumedRoleCredentialProvider(URI fsUri, Configuration conf)
-    credentialsToSTS = buildAWSProviderList(fsUri, conf,
+    Class<?>[] awsClasses = loadAWSProviderClasses(conf,
-        Arrays.asList(
-            SimpleAWSCredentialsProvider.class,
-            EnvironmentVariableCredentialsProvider.class),
-        Sets.newHashSet(this.getClass()));
+        SimpleAWSCredentialsProvider.class);
+    credentialsToSTS = new AWSCredentialProviderList();
+    for (Class<?> aClass : awsClasses) {
+      if (this.getClass().equals(aClass)) {
+        throw new IOException(E_FORBIDDEN_PROVIDER);
+      }
+      credentialsToSTS.add(createAWSCredentialProvider(conf, aClass, fsUri));
+    }
-    String endpoint = conf.getTrimmed(ASSUMED_ROLE_STS_ENDPOINT, "");
-    String region = conf.getTrimmed(ASSUMED_ROLE_STS_ENDPOINT_REGION,
+    String endpoint = conf.get(ASSUMED_ROLE_STS_ENDPOINT, "");
+    String region = conf.get(ASSUMED_ROLE_STS_ENDPOINT_REGION,
-          fsUri != null ?  fsUri.getHost() : "",
+          fsUri.getHost(),
-  @Retries.RetryRaw
-      throw new CredentialInitializationException(
+      throw new AmazonClientException(
