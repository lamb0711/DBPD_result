HADOOP-13660. Upgrade commons-configuration version. Contributed by Sean Mackrory.

-import java.io.PrintStream;
+import java.io.PrintWriter;
-import java.util.Locale;
-import org.apache.commons.configuration.Configuration;
-import org.apache.commons.configuration.ConfigurationException;
-import org.apache.commons.configuration.PropertiesConfiguration;
-import org.apache.commons.configuration.SubsetConfiguration;
+import org.apache.commons.configuration2.Configuration;
+import org.apache.commons.configuration2.PropertiesConfiguration;
+import org.apache.commons.configuration2.SubsetConfiguration;
+import org.apache.commons.configuration2.builder.fluent.Configurations;
+import org.apache.commons.configuration2.builder.fluent.Parameters;
+import org.apache.commons.configuration2.convert.DefaultListDelimiterHandler;
+import org.apache.commons.configuration2.ex.ConfigurationException;
-        Configuration cf = new PropertiesConfiguration(fname)
-            .interpolatedConfiguration();
+        Configuration cf = new Configurations().propertiesBuilder(fname)
+            .configure(new Parameters().properties()
+                .setFileName(fname)
+                .setListDelimiterHandler(new DefaultListDelimiterHandler(',')))
+              .getConfiguration()
+              .interpolatedConfiguration();
-        if (e.getMessage().startsWith("Cannot locate configuration")) {
+        // Commons Configuration defines the message text when file not found
+        if (e.getMessage().startsWith("Could not locate")) {
-  public Object getProperty(String key) {
-    Object value = super.getProperty(key);
+  public Object getPropertyInternal(String key) {
+    Object value = super.getPropertyInternal(key);
-  @Override public void clear() {
-    super.clear();
-    // pluginLoader.close(); // jdk7 is saner
-  }
-
-      PrintStream ps = new PrintStream(buffer, false, "UTF-8");
+      PrintWriter pw = new PrintWriter(buffer, false);
-      tmp.save(ps);
+      tmp.write(pw);
