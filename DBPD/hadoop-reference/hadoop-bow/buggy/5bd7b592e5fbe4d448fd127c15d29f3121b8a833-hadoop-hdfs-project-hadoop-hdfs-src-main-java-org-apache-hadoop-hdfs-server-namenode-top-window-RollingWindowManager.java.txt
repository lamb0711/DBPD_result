HADOOP-12985. Support MetricsSource interface for DecayRpcScheduler Metrics. Contributed by Xiaoyu Yao.

-import java.util.PriorityQueue;
-import com.google.common.primitives.Ints;
+import org.apache.hadoop.metrics2.util.Metrics2Util.NameValuePair;
+import org.apache.hadoop.metrics2.util.Metrics2Util.TopN;
-        User user = new User(userEntry.name, userEntry.value);
+        User user = new User(userEntry.getName(), userEntry.getValue());
-
-  /**
-   * A pair of a name and its corresponding value. Defines a custom 
-   * comparator so the TopN PriorityQueue sorts based on the count.
-   */
-  static private class NameValuePair implements Comparable<NameValuePair> {
-    String name;
-    long value;
-
-    public NameValuePair(String metricName, long value) {
-      this.name = metricName;
-      this.value = value;
-    }
-
-    @Override
-    public int compareTo(NameValuePair other) {
-      return (int) (value - other.value);
-    }
-
-    @Override
-    public boolean equals(Object other) {
-      if (other instanceof NameValuePair) {
-        return compareTo((NameValuePair)other) == 0;
-      }
-      return false;
-    }
-
-    @Override
-    public int hashCode() {
-      return Long.valueOf(value).hashCode();
-    }
-  }
-
-  /**
-   * A fixed-size priority queue, used to retrieve top-n of offered entries.
-   */
-  static private class TopN extends PriorityQueue<NameValuePair> {
-    private static final long serialVersionUID = 5134028249611535803L;
-    int n; // > 0
-    private long total = 0;
-
-    TopN(int n) {
-      super(n);
-      this.n = n;
-    }
-
-    @Override
-    public boolean offer(NameValuePair entry) {
-      updateTotal(entry.value);
-      if (size() == n) {
-        NameValuePair smallest = peek();
-        if (smallest.value >= entry.value) {
-          return false;
-        }
-        poll(); // remove smallest
-      }
-      return super.offer(entry);
-    }
-
-    private void updateTotal(long value) {
-      total += value;
-    }
-
-    public long getTotal() {
-      return total;
-    }
-  }
