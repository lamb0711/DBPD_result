HADOOP-8922. Provide alternate JSONP output for JMXJsonServlet to allow javascript in browser dashboard (Damien Hardy via bobby)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1398904 13f79535-47bb-0310-9956-ffa450edef68

+ *
+ *  Optional paramater "callback" should be used to deliver JSONP response.
+ *  
+  private static final String CALLBACK_PARAM = "callback";
+
+      String jsonpcb = null;
+      PrintWriter writer = null;
-        response.setContentType("application/json; charset=utf8");
+        writer = response.getWriter();
+ 
+        // "callback" parameter implies JSONP outpout
+        jsonpcb = request.getParameter(CALLBACK_PARAM);
+        if (jsonpcb != null) {
+          response.setContentType("application/javascript; charset=utf8");
+          writer.write(jsonpcb + "(");
+        } else {
+          response.setContentType("application/json; charset=utf8");
+        }
-        PrintWriter writer = response.getWriter();
+        jg.disable(JsonGenerator.Feature.AUTO_CLOSE_TARGET);
+        if (jsonpcb != null) {
+           writer.write(");");
+        }
+        if (writer != null) {
+          writer.close();
+        }
