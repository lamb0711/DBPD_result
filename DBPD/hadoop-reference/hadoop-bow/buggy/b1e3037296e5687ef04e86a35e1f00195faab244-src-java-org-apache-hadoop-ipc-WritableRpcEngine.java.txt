HADOOP-6904. Support method based RPC compatiblity. Contributed by Hairong Kuang.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1064919 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.security.authorize.ServiceAuthorizationManager;
-   * talking to a server at the named address. */
-  public Object getProxy(Class<?> protocol, long clientVersion,
+   * talking to a server at the named address. 
+   * @param <T>*/
+  @Override
+  @SuppressWarnings("unchecked")
+  public <T> ProtocolProxy<T> getProxy(Class<T> protocol, long clientVersion,
-    Object proxy = Proxy.newProxyInstance
+    T proxy = (T)Proxy.newProxyInstance
+    int[] serverMethods = null;
-      long serverVersion = ((VersionedProtocol)proxy)
-        .getProtocolVersion(protocol.getName(), clientVersion);
+      ProtocolSignature serverInfo = ((VersionedProtocol)proxy)
+        .getProtocolSignature(protocol.getName(), clientVersion,
+            ProtocolSignature.getFingerprint(protocol.getMethods()));
+      long serverVersion = serverInfo.getVersion();
+      serverMethods = serverInfo.getMethods();
-    return proxy;
+    return new ProtocolProxy<T>(protocol, proxy, serverMethods);
