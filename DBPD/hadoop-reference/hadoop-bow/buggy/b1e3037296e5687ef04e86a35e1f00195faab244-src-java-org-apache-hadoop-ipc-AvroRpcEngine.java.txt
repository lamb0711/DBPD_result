HADOOP-6904. Support method based RPC compatiblity. Contributed by Hairong Kuang.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1064919 13f79535-47bb-0310-9956-ffa450edef68

-      this.tunnel =
-        (TunnelProtocol)ENGINE.getProxy(TunnelProtocol.class, VERSION,
+      this.tunnel = ENGINE.getProxy(TunnelProtocol.class, VERSION,
-                                        rpcTimeout);
+                                        rpcTimeout).getProxy();
-   * talking to a server at the named address. */
-  public Object getProxy(Class<?> protocol, long clientVersion,
+   * talking to a server at the named address. 
+   * @param <T>*/
+  @SuppressWarnings("unchecked")
+  public <T> ProtocolProxy<T> getProxy(Class<T> protocol, long clientVersion,
-    return Proxy.newProxyInstance
-      (protocol.getClassLoader(),
-       new Class[] { protocol },
-       new Invoker(protocol, addr, ticket, conf, factory, rpcTimeout));
+    return new ProtocolProxy<T>(protocol,
+       (T)Proxy.newProxyInstance(
+         protocol.getClassLoader(),
+         new Class[] { protocol },
+         new Invoker(protocol, addr, ticket, conf, factory, rpcTimeout)),
+       null);
+    @Override
-      throws IOException {
+    throws IOException {
+    @Override
+    public ProtocolSignature getProtocolSignature(
+        String protocol, long version, int clientMethodsHashCode)
+      throws IOException {
+      return new ProtocolSignature(VERSION, null);
+    }
+
