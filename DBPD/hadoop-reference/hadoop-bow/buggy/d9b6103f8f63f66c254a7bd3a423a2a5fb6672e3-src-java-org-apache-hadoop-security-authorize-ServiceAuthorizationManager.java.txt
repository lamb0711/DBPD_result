HADOOP-6600. mechanism for authorization check for inter-server protocols

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@944012 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.security.KerberosInfo;
-                               Class<?> protocol
+                               Class<?> protocol,
+                               Configuration conf
-    if (!acl.isUserAllowed(user)) {
+    
+    // get client principal key to verify (if available)
+    KerberosInfo krbInfo = protocol.getAnnotation(KerberosInfo.class);
+    String clientPrincipal = null; 
+    if (krbInfo != null) {
+      String clientKey = krbInfo.clientPrincipal();
+      if (clientKey != null && !clientKey.equals("")) {
+        clientPrincipal = conf.get(clientKey);
+      }
+    }
+    if((clientPrincipal != null && !clientPrincipal.equals(user.getUserName())) || 
+        !acl.isUserAllowed(user)) {
-                                       " is not authorized for protocol " + 
-                                       protocol);
+          " is not authorized for protocol " + 
+          protocol);
