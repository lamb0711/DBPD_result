HDFS-2941. Add an administrative command to download a copy of the fsimage from the NN. Contributed by Aaron T. Myers.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1305447 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.fs.FileSystem;
+import org.apache.hadoop.fs.Path;
+import org.apache.hadoop.ipc.RPC;
+
+  /**
+   * Get the internet address of the currently-active NN. This should rarely be
+   * used, since callers of this method who connect directly to the NN using the
+   * resulting InetSocketAddress will not be able to connect to the active NN if
+   * a failover were to occur after this method has been called.
+   * 
+   * @param fs the file system to get the active address of.
+   * @return the internet address of the currently-active NN.
+   * @throws IOException if an error occurs while resolving the active NN.
+   */
+  @SuppressWarnings("deprecation")
+  public static InetSocketAddress getAddressOfActive(FileSystem fs)
+      throws IOException {
+    if (!(fs instanceof DistributedFileSystem)) {
+      throw new IllegalArgumentException("FileSystem " + fs + " is not a DFS.");
+    }
+    // force client address resolution.
+    fs.exists(new Path("/"));
+    DistributedFileSystem dfs = (DistributedFileSystem) fs;
+    DFSClient dfsClient = dfs.getClient();
+    return RPC.getServerAddress(dfsClient.getNamenode());
+  }
