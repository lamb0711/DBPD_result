HADOOP-8193. Refactor FailoverController/HAAdmin code to add an abstract class for "target" services. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1305195 13f79535-47bb-0310-9956-ffa450edef68

-import java.net.InetSocketAddress;
-   * @param toSvc service to make active
-   * @param toSvcName name of service to make active
+   * @param target service to make active
-  private static void preFailoverChecks(HAServiceProtocol toSvc,
-                                        InetSocketAddress toSvcAddr,
+  private static void preFailoverChecks(HAServiceTarget target,
+    HAServiceProtocol toSvc;
+      toSvc = target.getProxy();
-      String msg = "Unable to get service state for " + toSvcAddr;
+      String msg = "Unable to get service state for " + target;
-            toSvcAddr + " is not ready to become active: " +
+            target + " is not ready to become active: " +
-   * @param fromSvcAddr addr of the currently active service
-   * @param toSvcAddr addr of the service to make active
-   * @param fencer for fencing fromSvc
-  public static void failover(HAServiceProtocol fromSvc,
-                              InetSocketAddress fromSvcAddr,
-                              HAServiceProtocol toSvc,
-                              InetSocketAddress toSvcAddr,
-                              NodeFencer fencer,
+  public static void failover(HAServiceTarget fromSvc,
+                              HAServiceTarget toSvc,
-    Preconditions.checkArgument(fencer != null, "failover requires a fencer");
-    preFailoverChecks(toSvc, toSvcAddr, forceActive);
+    Preconditions.checkArgument(fromSvc.getFencer() != null,
+        "failover requires a fencer");
+    preFailoverChecks(toSvc, forceActive);
-      HAServiceProtocolHelper.transitionToStandby(fromSvc);
+      HAServiceProtocolHelper.transitionToStandby(fromSvc.getProxy());
-      LOG.warn("Unable to make " + fromSvcAddr + " standby (" +
+      LOG.warn("Unable to make " + fromSvc + " standby (" +
-      LOG.warn("Unable to make " + fromSvcAddr +
+      LOG.warn("Unable to make " + fromSvc +
-      if (!fencer.fence(fromSvcAddr)) {
+      if (!fromSvc.getFencer().fence(fromSvc)) {
-            fromSvcAddr + ". Fencing failed.");
+            fromSvc + ". Fencing failed.");
-      HAServiceProtocolHelper.transitionToActive(toSvc);
+      HAServiceProtocolHelper.transitionToActive(toSvc.getProxy());
-      LOG.error("Unable to make " + toSvcAddr + " active (" +
+      LOG.error("Unable to make " + toSvc + " active (" +
-      LOG.error("Unable to make " + toSvcAddr +
+      LOG.error("Unable to make " + toSvc +
-      String msg = "Unable to failover to " + toSvcAddr;
+      String msg = "Unable to failover to " + toSvc;
-          failover(toSvc, toSvcAddr, fromSvc, fromSvcAddr, fencer, true, true);
+          failover(toSvc, fromSvc, true, true);
-          msg += ". Failback to " + fromSvcAddr +
+          msg += ". Failback to " + fromSvc +
