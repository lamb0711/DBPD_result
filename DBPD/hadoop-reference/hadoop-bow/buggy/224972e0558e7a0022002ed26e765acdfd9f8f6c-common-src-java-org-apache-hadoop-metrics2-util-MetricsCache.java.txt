HADOOP-7324. Ganglia plugins for metrics v2. (Priyo Mustafi via llu)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1145525 13f79535-47bb-0310-9956-ffa450edef68

-import com.google.common.base.Objects;
-import com.google.common.collect.Maps;
-
+import com.google.common.base.Objects;
+import com.google.common.collect.Maps;
+
-    final Map<String, Number> metrics = Maps.newHashMap();
+    final Map<String, AbstractMetric> metrics = Maps.newHashMap();
+      AbstractMetric metric = metrics.get(key);
+      return metric != null ? metric.value() : null;
+    }
+
+    /**
+     * Lookup a metric instance
+     * @param key name of the metric
+     * @return the metric instance
+     */
+    public AbstractMetric getMetricInstance(String key) {
-     * @return entry set of the metrics of the record
+     * @deprecated use metricsEntrySet() instead
+     * @return entry set of metrics
+    @Deprecated
+      Map<String, Number> map = new LinkedHashMap<String, Number>(
+          metrics.size());
+      for (Map.Entry<String, AbstractMetric> mapEntry : metrics.entrySet()) {
+        map.put(mapEntry.getKey(), mapEntry.getValue().value());
+      }
+      return map.entrySet();
+    }
+
+    /**
+     * @return entry set of metrics
+     */
+    public Set<Map.Entry<String, AbstractMetric>> metricsEntrySet() {
-      record.metrics.put(m.name(), m.value());
+      record.metrics.put(m.name(), m);
