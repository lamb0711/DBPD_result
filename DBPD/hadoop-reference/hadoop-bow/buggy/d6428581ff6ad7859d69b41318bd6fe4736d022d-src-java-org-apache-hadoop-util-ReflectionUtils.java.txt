HADOOP-6165. Add metadata to Serializations.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@810756 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.ByteArrayOutputStream;
+import java.io.IOException;
+import java.io.PrintWriter;
+import java.lang.management.ManagementFactory;
+import java.lang.management.ThreadInfo;
+import java.lang.management.ThreadMXBean;
-import java.io.*;
-import java.lang.management.*;
-import org.apache.hadoop.conf.*;
+import org.apache.hadoop.conf.Configurable;
+import org.apache.hadoop.conf.Configuration;
-import org.apache.hadoop.io.serializer.Deserializer;
+import org.apache.hadoop.io.serializer.DeserializerBase;
+import org.apache.hadoop.io.serializer.SerializationBase;
-import org.apache.hadoop.io.serializer.Serializer;
+import org.apache.hadoop.io.serializer.SerializerBase;
-    Serializer<T> serializer = factory.getSerializer(cls);
+    Map<String, String> metadata = SerializationBase.getMetadataFromClass(cls);
+    SerializerBase<T> serializer = factory.getSerializer(metadata);
-    Deserializer<T> deserializer = factory.getDeserializer(cls);
+    DeserializerBase<T> deserializer = factory.getDeserializer(metadata);
