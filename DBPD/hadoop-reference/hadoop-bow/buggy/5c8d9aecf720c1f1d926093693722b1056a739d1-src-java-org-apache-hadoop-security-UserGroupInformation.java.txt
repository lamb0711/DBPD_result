HADOOP-6913. Circular initialization between UserGroupInformation and KerberosName

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@991038 13f79535-47bb-0310-9956-ffa450edef68

-   * Set the configuration values for UGI.
+   * Initialize UGI and related classes.
+    initUGI(conf);
+    // give the configuration on how to translate Kerberos names
+    try {
+      KerberosName.setConfiguration(conf);
+    } catch (IOException ioe) {
+      throw new RuntimeException("Problem with Kerberos auth_to_local name " +
+          "configuration", ioe);
+    }
+  }
+  
+  /**
+   * Set the configuration values for UGI.
+   * @param conf the configuration to use
+   */
+  private static synchronized void initUGI(Configuration conf) {
-    // give the configuration on how to translate Kerberos names
-    try {
-      KerberosName.setConfiguration(conf);
-    } catch (IOException ioe) {
-      throw new RuntimeException("Problem with Kerberos auth_to_local name " +
-          "configuration", ioe);
-    }
