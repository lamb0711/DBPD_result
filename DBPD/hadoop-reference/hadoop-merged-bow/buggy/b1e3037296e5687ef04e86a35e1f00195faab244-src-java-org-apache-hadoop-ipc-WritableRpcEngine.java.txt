HADOOP-6904. Support method based RPC compatiblity. Contributed by Hairong Kuang.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1064919 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.security.authorize.ServiceAuthorizationManager;
-   * talking to a server at the named address. */
-  public Object getProxy(Class<?> protocol, long clientVersion,
+   * talking to a server at the named address. 
+   * @param <T>*/
+  @Override
+  @SuppressWarnings("unchecked")
+  public <T> ProtocolProxy<T> getProxy(Class<T> protocol, long clientVersion,
-    Object proxy = Proxy.newProxyInstance
+    T proxy = (T)Proxy.newProxyInstance
+    int[] serverMethods = null;
-      long serverVersion = ((VersionedProtocol)proxy)
-        .getProtocolVersion(protocol.getName(), clientVersion);
+      ProtocolSignature serverInfo = ((VersionedProtocol)proxy)
+        .getProtocolSignature(protocol.getName(), clientVersion,
+            ProtocolSignature.getFingerprint(protocol.getMethods()));
+      long serverVersion = serverInfo.getVersion();
+      serverMethods = serverInfo.getMethods();
-    return proxy;
+    return new ProtocolProxy<T>(protocol, proxy, serverMethods);

INS78 INS79 INS73 INS74 INS65 INS42 INS42 INS45 INS42 INS43 INS43 UPD74 INS60 INS66 UPD42 MOV42 INS42 INS43 UPD43 INS5 INS59 INS14 INS42 UPD42 INS11 INS39 INS85 INS42 INS33 INS60 INS21 INS74 INS42 INS42 INS42 INS43 MOV32 INS43 INS39 INS59 INS7 INS43 INS43 INS42 INS42 UPD42 INS42 INS32 INS42 INS32 INS42 INS42 UPD42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 DEL40 DEL26 DEL43 DEL76 DEL39 DEL42