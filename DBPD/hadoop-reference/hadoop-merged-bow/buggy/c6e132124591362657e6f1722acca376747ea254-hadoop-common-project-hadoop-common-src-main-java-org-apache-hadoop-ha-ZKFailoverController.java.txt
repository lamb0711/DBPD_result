HADOOP-8306. ZKFC: improve error message when ZK is not running. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3042@1329960 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.zookeeper.KeeperException;
+  /** Cannot connect to ZooKeeper */
+  static final int ERR_CODE_NO_ZK = 6;
+  private String zkQuorum;
-    if (!elector.parentZNodeExists()) {
-      LOG.fatal("Unable to start failover controller. " +
-          "Parent znode does not exist.\n" +
-          "Run with -formatZK flag to initialize ZooKeeper.");
-      return ERR_CODE_NO_PARENT_ZNODE;
+    try {
+      if (!elector.parentZNodeExists()) {
+        LOG.fatal("Unable to start failover controller. " +
+            "Parent znode does not exist.\n" +
+            "Run with -formatZK flag to initialize ZooKeeper.");
+        return ERR_CODE_NO_PARENT_ZNODE;
+      }
+    } catch (IOException ioe) {
+      if (ioe.getCause() instanceof KeeperException.ConnectionLossException) {
+        LOG.fatal("Unable to start failover controller. Unable to connect " +
+            "to ZooKeeper quorum at " + zkQuorum + ". Please check the " +
+            "configured value for " + ZK_QUORUM_KEY + " and ensure that " +
+            "ZooKeeper is running.");
+        return ERR_CODE_NO_ZK;
+      } else {
+        throw ioe;
+      }
-    String zkQuorum = conf.get(ZK_QUORUM_KEY);
+    zkQuorum = conf.get(ZK_QUORUM_KEY);

INS26 INS40 INS23 INS23 INS29 INS83 INS83 INS39 INS59 INS83 MOV43 INS59 INS65 INS42 INS34 INS42 INS54 INS21 INS66 INS8 INS12 INS7 MOV25 INS44 INS8 INS42 MOV32 INS43 INS42 INS25 INS42 INS62 INS8 INS8 INS32 INS43 INS21 INS41 INS53 INS42 INS42 INS40 INS32 INS42 INS42 INS42 INS42 INS27 INS27 INS42 INS45 INS45 INS42 INS45 INS45 INS45 INS45 DEL42 DEL59 DEL60