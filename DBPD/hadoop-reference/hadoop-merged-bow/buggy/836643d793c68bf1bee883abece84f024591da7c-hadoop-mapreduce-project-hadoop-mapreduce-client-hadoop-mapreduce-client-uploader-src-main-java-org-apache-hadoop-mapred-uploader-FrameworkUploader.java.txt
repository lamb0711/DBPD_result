MAPREDUCE-6995. Uploader tool for Distributed Cache Deploy documentation (miklos.szegedi@cloudera.com via rkanter)

+import static org.apache.hadoop.fs.FileSystem.FS_DEFAULT_NAME_KEY;
+
+  private Configuration conf = new Configuration();
+  @VisibleForTesting
+  void setConf(Configuration configuration) {
+    conf = configuration;
+  }
+
-      FileSystem fileSystem = targetPath.getFileSystem(new Configuration());
+      FileSystem fileSystem = targetPath.getFileSystem(conf);
-    FileSystem fileSystem = targetPath.getFileSystem(new Configuration());
+    FileSystem fileSystem = targetPath.getFileSystem(conf);
-          location.getOffset(), (key, value) -> value + replicas);
+          location.getOffset(),
+          (key, value) -> value == null ? 0 : value + replicas);
-    FileSystem fileSystem = targetPath.getFileSystem(new Configuration());
+    FileSystem fileSystem = targetPath.getFileSystem(conf);
-        .withDescription("Input class path")
+        .withDescription("Input class path. Defaults to the default classpath.")
-    if (fs == null) {
-      LOG.error("Target file system not specified");
-      printHelp(opts);
-      return false;
-    }
-        "mr-framework.tar.gz#mr-framework");
-    if (path == null) {
+        "/usr/lib/mr-framework.tar.gz#mr-framework");
+    boolean isFullPath =
+        path.startsWith("hdfs://") ||
+        path.startsWith("file://");
+
+    if (fs == null) {
+      fs = conf.get(FS_DEFAULT_NAME_KEY);
+      if (fs == null && !isFullPath) {
+        LOG.error("No filesystem specified in either fs or target.");
+        printHelp(opts);
+        return false;
+      } else {
+        LOG.info(String.format(
+            "Target file system not specified. Using default %s", fs));
+      }
+    }
+    if (path.isEmpty()) {
-    StringBuilder absolutePath = new StringBuilder(fs);
-    absolutePath = absolutePath.append(path.startsWith("/") ? "" : "/");
+    StringBuilder absolutePath = new StringBuilder();
+    if (!isFullPath) {
+      absolutePath.append(fs);
+      absolutePath.append(path.startsWith("/") ? "" : "/");
+    }

INS26 INS40 INS23 INS31 INS83 INS43 MOV59 INS78 INS39 INS42 INS44 INS8 INS42 UPD42 MOV14 INS42 INS43 INS42 INS21 INS60 INS25 INS25 INS42 INS7 INS39 INS59 MOV27 INS8 INS32 MOV43 INS38 INS8 INS42 INS42 INS42 INS27 INS21 MOV25 INS42 INS42 INS42 INS21 MOV21 INS59 INS42 INS42 UPD45 INS32 INS32 INS7 INS27 INS8 MOV43 INS32 MOV32 INS42 INS32 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS32 INS27 INS38 INS21 INS42 INS42 INS42 INS42 INS42 INS42 INS16 UPD45 INS42 INS42 INS42 INS42 INS33 INS42 INS32 INS27 INS34 MOV27 UPD45 INS42 INS42 INS32 INS42 INS33 INS42 INS42 INS45 INS42 DEL42 DEL42 DEL32 DEL42 DEL43 DEL14 DEL42 DEL43 DEL14 DEL42 DEL33 DEL27 DEL42 DEL42 DEL7