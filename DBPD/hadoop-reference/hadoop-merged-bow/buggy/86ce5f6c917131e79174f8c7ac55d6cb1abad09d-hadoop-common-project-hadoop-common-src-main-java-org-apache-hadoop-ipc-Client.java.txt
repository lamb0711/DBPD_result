HADOOP-9035. Generalize setup of LoginContext (daryn via bobby)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1410018 13f79535-47bb-0310-9956-ffa450edef68

+      AuthenticationMethod authentication;
-        authMethod = AuthenticationMethod.TOKEN.getAuthMethod();
-      } else if (UserGroupInformation.isSecurityEnabled()) {
-        // eventually just use the ticket's authMethod
-        authMethod = AuthMethod.KERBEROS;
-      } else {
-        authMethod = AuthMethod.SIMPLE;
+        authentication = AuthenticationMethod.TOKEN;
+      } else if (ticket != null) {
+        authentication = ticket.getRealAuthenticationMethod();
+      } else { // this only happens in lazy tests
+        authentication = AuthenticationMethod.SIMPLE;
+      authMethod = authentication.getAuthMethod();

INS60 INS21 INS43 INS59 INS7 INS42 INS42 INS27 INS42 INS32 INS42 INS33 INS42 INS42 UPD42 INS40 INS42 INS32 UPD42 UPD40 INS42 INS42 DEL40 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL40