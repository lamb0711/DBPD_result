HADOOP-6632. Adds support for using different keytabs for different servers in a Hadoop cluster. In the earier implementation, all servers of a certain type \(like TaskTracker\), would have the same keytab and the same principal. Now the principal name is a pattern that has _HOST in it. Contributed by Kan Zhang & Jitendra Pandey.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@965696 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.security.SecurityUtil;
+   * @param conf configuration to use
+   * @param hostname fully qualified domain name of the client
-                               Configuration conf
+                               Configuration conf,
+                               String hostname
-        clientPrincipal = conf.get(clientKey);
+        if (hostname == null) {
+          throw new AuthorizationException(
+              "Can't authorize client when client hostname is null");
+        }
+        try {
+          clientPrincipal = SecurityUtil.getServerPrincipal(
+              conf.get(clientKey), hostname);
+        } catch (IOException e) {
+          throw (AuthorizationException) new AuthorizationException(
+              "Can't figure out Kerberos principal name for connection from "
+                  + hostname + " for user=" + user + " protocol=" + protocol)
+              .initCause(e);
+        }

INS26 INS40 INS44 INS65 INS65 INS43 INS42 INS42 INS66 INS42 INS66 INS42 INS8 INS25 INS54 INS27 INS8 MOV8 INS12 INS42 INS33 INS53 INS44 INS8 INS14 INS43 INS42 INS53 INS43 INS45 INS32 INS42 INS11 INS42 INS42 INS42 MOV32 INS42 INS43 INS32 INS42 INS14 INS42 INS42 INS43 INS27 INS42 INS45 INS42 INS45 INS42 INS45 INS42