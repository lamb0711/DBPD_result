HADOOP-12059. S3Credentials should support use of CredentialProvider. Contributed by Sean Busbey.

+import java.net.URISyntaxException;
+import org.apache.hadoop.security.alias.JavaKeyStoreProvider;
+import org.apache.hadoop.security.alias.LocalJavaKeyStoreProvider;
+
+  /**
+   * Mangle given local java keystore file URI to allow use as a
+   * LocalJavaKeyStoreProvider.
+   * @param localFile absolute URI with file scheme and no authority component.
+   *                  i.e. return of File.toURI,
+   *                  e.g. file:///home/larry/creds.jceks
+   * @return URI of the form localjceks://file/home/larry/creds.jceks
+   * @throws IllegalArgumentException if localFile isn't not a file uri or if it
+   *                                  has an authority component.
+   * @throws URISyntaxException if the wrapping process violates RFC 2396
+   */
+  public static URI nestURIForLocalJavaKeyStoreProvider(final URI localFile)
+      throws URISyntaxException {
+    if (!("file".equals(localFile.getScheme()))) {
+      throw new IllegalArgumentException("passed URI had a scheme other than " +
+          "file.");
+    }
+    if (localFile.getAuthority() != null) {
+      throw new IllegalArgumentException("passed URI must not have an " +
+          "authority component. For non-local keystores, please use " +
+          JavaKeyStoreProvider.class.getName());
+    }
+    return new URI(LocalJavaKeyStoreProvider.SCHEME_NAME,
+        "//file" + localFile.getSchemeSpecificPart(), localFile.getFragment());
+  }
+

INS26 INS26 INS26 INS40 INS40 INS40 INS31 INS29 INS83 INS83 INS43 INS42 INS44 INS43 INS8 INS65 INS65 INS65 INS65 INS65 INS42 INS83 INS43 INS42 INS42 INS25 INS25 INS41 INS66 INS66 INS42 INS66 INS66 INS66 INS66 INS42 INS66 INS66 INS42 INS66 INS42 INS38 INS8 INS27 INS8 INS14 INS36 INS53 INS32 INS33 INS53 INS43 INS40 INS27 INS32 INS32 INS14 INS42 INS42 INS14 INS42 INS45 INS32 INS42 INS42 INS45 INS42 INS32 INS43 INS27 INS43 INS27 INS42 INS42 INS42 INS42 INS42 INS45 INS45 INS42 INS45 INS45 INS32 INS57 INS42 INS43 INS42