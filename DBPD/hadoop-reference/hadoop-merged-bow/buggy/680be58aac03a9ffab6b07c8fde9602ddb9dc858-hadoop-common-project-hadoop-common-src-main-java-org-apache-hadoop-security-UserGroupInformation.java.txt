HADOOP-13558. UserGroupInformation created from a Subject incorrectly tries to renew the Kerberos ticket. Contributed by Xiao Chen.

+    this(subject, false);
+  }
+
+  /**
+   * Create a UGI from the given subject.
+   * @param subject the subject
+   * @param externalKeyTab if the subject's keytab is managed by the user.
+   *                       Setting this to true will prevent UGI from attempting
+   *                       to login the keytab, or to renew it.
+   */
+  private UserGroupInformation(Subject subject, final boolean externalKeyTab) {
-    this.isKeytab = KerberosUtil.hasKerberosKeyTab(subject);
+    if (externalKeyTab) {
+      this.isKeytab = false;
+    } else {
+      this.isKeytab = KerberosUtil.hasKerberosKeyTab(subject);
+    }
-      UserGroupInformation realUser = new UserGroupInformation(subject);
+      LOG.debug("Assuming keytab is managed externally since logged in from"
+          + " subject.");
+      UserGroupInformation realUser = new UserGroupInformation(subject, true);
-      realUser = new UserGroupInformation(login.getSubject());

INS31 MOV29 INS42 INS44 INS8 INS29 INS83 INS44 INS43 INS42 INS17 INS65 INS65 INS65 INS83 INS39 INS42 INS25 INS42 INS42 INS9 INS66 INS42 INS66 INS42 INS66 INS66 INS66 INS42 INS8 INS8 MOV21 INS21 MOV21 INS7 INS32 INS22 INS9 UPD42 MOV42 UPD42 MOV42 INS27 MOV42 INS52 INS42 INS45 INS45 INS9 DEL42 DEL32 DEL14 DEL7