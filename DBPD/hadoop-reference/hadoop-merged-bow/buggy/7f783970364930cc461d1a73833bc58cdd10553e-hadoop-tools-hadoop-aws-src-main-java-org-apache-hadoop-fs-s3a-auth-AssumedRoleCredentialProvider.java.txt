Revert "HADOOP-14556. S3A to support Delegation Tokens."

This reverts commit d7152332b32a575c3a92e3f4c44b95e58462528d.

-import javax.annotation.Nullable;
-import java.util.Arrays;
+import com.amazonaws.AmazonClientException;
-import com.amazonaws.auth.EnvironmentVariableCredentialsProvider;
-import com.google.common.collect.Sets;
-import org.apache.hadoop.fs.s3a.CredentialInitializationException;
-import org.apache.hadoop.fs.s3a.Retries;
-import static org.apache.hadoop.fs.s3a.S3AUtils.buildAWSProviderList;
+import static org.apache.hadoop.fs.s3a.S3AUtils.createAWSCredentialProvider;
+import static org.apache.hadoop.fs.s3a.S3AUtils.loadAWSProviderClasses;
+  static final String E_FORBIDDEN_PROVIDER =
+      "AssumedRoleCredentialProvider cannot be in "
+          + ASSUMED_ROLE_CREDENTIALS_PROVIDER;
+
-   * @param fsUri possibly null URI of the filesystem.
+   * @param fsUri URI of the filesystem.
-  public AssumedRoleCredentialProvider(@Nullable URI fsUri, Configuration conf)
+  public AssumedRoleCredentialProvider(URI fsUri, Configuration conf)
-    credentialsToSTS = buildAWSProviderList(fsUri, conf,
+    Class<?>[] awsClasses = loadAWSProviderClasses(conf,
-        Arrays.asList(
-            SimpleAWSCredentialsProvider.class,
-            EnvironmentVariableCredentialsProvider.class),
-        Sets.newHashSet(this.getClass()));
+        SimpleAWSCredentialsProvider.class);
+    credentialsToSTS = new AWSCredentialProviderList();
+    for (Class<?> aClass : awsClasses) {
+      if (this.getClass().equals(aClass)) {
+        throw new IOException(E_FORBIDDEN_PROVIDER);
+      }
+      credentialsToSTS.add(createAWSCredentialProvider(conf, aClass, fsUri));
+    }
-    String endpoint = conf.getTrimmed(ASSUMED_ROLE_STS_ENDPOINT, "");
-    String region = conf.getTrimmed(ASSUMED_ROLE_STS_ENDPOINT_REGION,
+    String endpoint = conf.get(ASSUMED_ROLE_STS_ENDPOINT, "");
+    String region = conf.get(ASSUMED_ROLE_STS_ENDPOINT_REGION,
-          fsUri != null ?  fsUri.getHost() : "",
+          fsUri.getHost(),
-  @Retries.RetryRaw
-      throw new CredentialInitializationException(
+      throw new AmazonClientException(

MOV26 MOV26 UPD40 UPD40 UPD40 INS23 INS83 INS83 INS43 INS59 INS42 INS42 INS27 INS60 INS21 INS70 INS45 INS42 UPD66 INS5 INS59 INS7 INS44 INS42 INS8 MOV43 MOV43 INS74 INS85 INS42 INS32 INS42 INS14 INS74 INS42 INS25 INS21 INS43 INS76 UPD42 MOV42 MOV42 MOV42 MOV57 INS43 INS43 INS76 MOV32 MOV32 INS8 INS32 UPD42 UPD42 MOV32 INS42 INS42 INS42 UPD42 UPD42 INS53 UPD42 MOV42 UPD42 MOV42 INS32 INS14 INS42 INS42 INS42 INS42 UPD43 INS43 INS42 UPD42 INS42 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL42 DEL78 DEL42 DEL42 DEL42 DEL43 DEL57 DEL32 DEL32 DEL7 DEL21 DEL42 DEL33 DEL27 DEL45 DEL16 DEL40 DEL78