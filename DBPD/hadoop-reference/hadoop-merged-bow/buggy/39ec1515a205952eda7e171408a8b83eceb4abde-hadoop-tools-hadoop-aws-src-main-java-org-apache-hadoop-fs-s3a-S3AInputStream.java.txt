HADOOP-13130. s3a failures can surface as RTEs, not IOEs. (Steve Loughran)

+import com.amazonaws.AmazonClientException;
+
+import static org.apache.hadoop.fs.s3a.S3AUtils.*;
+
-   * @throws IOException
+   * @throws IOException on any failure to open the object
-    GetObjectRequest request = new GetObjectRequest(bucket, key)
-        .withRange(targetPos, requestedStreamLen);
-    wrappedStream = client.getObject(request).getObjectContent();
+    try {
+      GetObjectRequest request = new GetObjectRequest(bucket, key)
+          .withRange(targetPos, requestedStreamLen);
+      wrappedStream = client.getObject(request).getObjectContent();
-    if (wrappedStream == null) {
-      throw new IOException("Null IO stream from reopen of (" + reason +  ") "
-          + uri);
+      if (wrappedStream == null) {
+        throw new IOException("Null IO stream from reopen of (" + reason +  ") "
+            + uri);
+      }
+    } catch (AmazonClientException e) {
+      throw translateException("Reopen at position " + targetPos, uri, e);
-    lazySeek(nextReadPos, 1);
+      lazySeek(nextReadPos, 1);
-    lazySeek(nextReadPos, len);
-    streamStatistics.readOperationStarted(nextReadPos, len);
+    try {
+      lazySeek(nextReadPos, len);
+    } catch (EOFException e) {
+      // the end of the file has moved
+      return -1;
+    }
+      streamStatistics.readOperationStarted(nextReadPos, len);

INS26 INS26 INS40 INS40 INS54 INS54 INS66 INS8 INS12 INS8 INS12 MOV60 MOV21 MOV25 INS44 INS8 MOV21 MOV21 INS44 INS8 MOV21 INS43 INS42 INS53 INS43 INS42 INS41 INS42 INS32 INS42 INS38 INS42 INS27 INS42 INS42 INS34 INS45 INS42