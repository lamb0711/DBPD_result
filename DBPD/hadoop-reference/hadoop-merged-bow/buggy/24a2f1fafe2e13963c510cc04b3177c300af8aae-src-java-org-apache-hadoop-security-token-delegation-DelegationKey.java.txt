HADOOP-6581. Add authenticated TokenIdentifiers to UGI so that they can be used for authorization. Kan Zhang and Jitendra Pandey via jghoman.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@948573 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.avro.reflect.Nullable;
-  private SecretKey key;
+  @Nullable
+  private byte[] keyBytes = null;
-    this.key = key;
+    if (key!=null) {
+      this.keyBytes = key.getEncoded();
+    }
-    return key;
+    if (keyBytes == null || keyBytes.length == 0) {
+      return null;
+    } else {
+      SecretKey key = AbstractDelegationTokenSecretManager.createSecretKey(keyBytes);
+      return key;
+    }
-    byte[] keyBytes = key.getEncoded();
-    WritableUtils.writeVInt(out, keyBytes.length);
-    out.write(keyBytes);
+    if (keyBytes == null) {
+      WritableUtils.writeVInt(out, -1);
+    } else {
+      WritableUtils.writeVInt(out, keyBytes.length);
+      out.write(keyBytes);
+    }
-    byte[] keyBytes = new byte[len];
-    in.readFully(keyBytes);
-    key = AbstractDelegationTokenSecretManager.createSecretKey(keyBytes);
+    if (len == -1) {
+      keyBytes = null;
+    } else {
+      keyBytes = new byte[len];
+      in.readFully(keyBytes);
+    }

INS26 INS40 INS78 MOV5 INS8 INS42 UPD42 INS33 INS25 INS25 INS25 INS25 INS27 INS8 INS27 INS8 INS8 INS27 INS8 INS8 INS27 INS8 INS8 INS42 INS33 MOV21 INS27 INS27 INS41 INS60 MOV41 INS42 INS33 INS21 MOV21 MOV21 INS42 INS38 INS21 MOV21 MOV21 INS42 INS33 INS40 INS34 INS33 MOV43 INS59 INS32 INS34 INS7 MOV32 INS42 MOV32 UPD42 MOV42 UPD42 MOV42 INS42 INS38 INS42 INS33 UPD42 MOV3 UPD42 INS42 INS42 INS34 DEL42 DEL8 DEL42 DEL59 DEL60 DEL39 DEL85 DEL5 DEL42 DEL59 DEL60