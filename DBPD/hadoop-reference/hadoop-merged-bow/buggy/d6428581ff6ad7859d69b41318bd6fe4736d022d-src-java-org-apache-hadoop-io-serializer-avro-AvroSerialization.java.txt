HADOOP-6165. Add metadata to Serializations.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@810756 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Map;
-import org.apache.hadoop.conf.Configured;
-import org.apache.hadoop.io.serializer.Deserializer;
-import org.apache.hadoop.io.serializer.Serialization;
-import org.apache.hadoop.io.serializer.Serializer;
+import org.apache.hadoop.io.serializer.DeserializerBase;
+import org.apache.hadoop.io.serializer.SerializationBase;
+import org.apache.hadoop.io.serializer.SerializerBase;
-public abstract class AvroSerialization<T> extends Configured 
-                                        implements Serialization<T>{
+public abstract class AvroSerialization<T> extends SerializationBase<T> {
+  
+  public static final String AVRO_SCHEMA_KEY = "Avro-Schema";
-  public Deserializer<T> getDeserializer(Class<T> c) {
-    return new AvroDeserializer(c);
+  public DeserializerBase<T> getDeserializer(Map<String, String> metadata) {
+    return new AvroDeserializer(metadata);
-  public Serializer<T> getSerializer(Class<T> c) {
-    return new AvroSerializer(c);
+  public SerializerBase<T> getSerializer(Map<String, String> metadata) {
+    return new AvroSerializer(metadata);
-   * Return an Avro Schema instance for the given class.
+   * Return an Avro Schema instance for the given class and metadata.
-  protected abstract Schema getSchema(T t);
+  protected abstract Schema getSchema(T t, Map<String, String> metadata);
-   * Create and return Avro DatumWriter for the given class.
+   * Create and return Avro DatumWriter for the given metadata.
-  protected abstract DatumWriter<T> getWriter(Class<T> clazz);
+  protected abstract DatumWriter<T> getWriter(Map<String, String> metadata);
-   * Create and return Avro DatumReader for the given class.
+   * Create and return Avro DatumReader for the given metadata.
-  protected abstract DatumReader<T> getReader(Class<T> clazz);
+  protected abstract DatumReader<T> getReader(Map<String, String> metadata);
-  class AvroSerializer implements Serializer<T> {
+  class AvroSerializer extends SerializerBase<T> {
+    private Map<String, String> metadata;
-    protected Class<T> clazz;
-    AvroSerializer(Class<T> clazz) {
-      writer = getWriter(clazz);
+    AvroSerializer(Map<String, String> metadata) {
+      this.metadata = metadata;
+      writer = getWriter(metadata);
+    @Override
+    @Override
+    @Override
-      writer.setSchema(getSchema(t));
+      writer.setSchema(getSchema(t, metadata));
+    @Override
+    public Map<String, String> getMetadata() throws IOException {
+      return metadata;
+    }
+
-  class AvroDeserializer implements Deserializer<T> {
+  class AvroDeserializer extends DeserializerBase<T> {
-    AvroDeserializer(Class<T> clazz) {
-      this.reader = getReader(clazz);
+    AvroDeserializer(Map<String, String> metadata) {
+      this.reader = getReader(metadata);
+    @Override
+    @Override
+    @Override

MOV26 UPD40 UPD40 UPD40 UPD40 UPD74 INS23 UPD43 INS83 INS83 INS83 INS43 INS59 UPD74 MOV74 INS42 INS44 UPD74 MOV74 INS42 INS44 INS44 UPD74 MOV74 INS23 INS31 UPD74 MOV74 UPD42 UPD42 MOV42 INS42 INS45 UPD43 INS74 INS42 UPD43 INS74 INS42 INS74 INS42 UPD74 UPD42 UPD74 UPD42 UPD43 INS83 INS74 MOV59 INS78 INS78 INS78 INS78 INS83 INS74 INS42 INS43 INS8 UPD43 INS78 INS78 INS78 UPD42 UPD43 MOV43 UPD43 MOV43 INS43 UPD42 INS43 UPD43 MOV43 UPD43 MOV43 UPD66 INS43 INS43 INS43 UPD66 UPD43 UPD43 INS43 UPD66 UPD43 UPD43 INS43 UPD42 INS43 UPD43 MOV43 UPD43 MOV43 UPD42 UPD74 UPD42 INS21 INS42 INS42 INS42 INS42 INS43 INS43 INS43 INS42 INS41 UPD42 INS74 INS42 INS42 INS42 INS42 UPD42 UPD42 INS42 UPD42 INS42 UPD42 UPD42 UPD42 INS42 INS42 INS42 UPD42 UPD42 INS42 UPD42 UPD42 INS42 INS42 UPD42 UPD42 UPD43 UPD43 INS43 INS7 INS42 INS42 INS42 INS42 INS43 INS43 INS43 UPD42 UPD42 INS42 INS22 INS42 INS42 INS42 INS42 INS52 INS42 UPD42 INS42 UPD42 DEL43 DEL74 DEL42 DEL42 DEL44 DEL74 DEL42 DEL42 DEL44 DEL74 DEL83 DEL23 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42