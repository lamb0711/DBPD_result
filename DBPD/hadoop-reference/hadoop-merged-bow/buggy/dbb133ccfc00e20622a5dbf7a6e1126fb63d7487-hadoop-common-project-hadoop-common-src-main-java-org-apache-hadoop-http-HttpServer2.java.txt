HADOOP-13707. If kerberos is enabled while HTTP SPNEGO is not configured, some links cannot be accessed. Contributed by Yuanbo Liu.

+import static org.apache.hadoop.fs.CommonConfigurationKeys.DEFAULT_HADOOP_HTTP_STATIC_USER;
+import static org.apache.hadoop.fs.CommonConfigurationKeys.HADOOP_HTTP_STATIC_USER;
+
+   * check whether user is static and unauthenticated, if the
+   * answer is TRUE, that means http sever is in non-security
+   * environment.
+   * @param servletContext the servlet context.
+   * @param request the servlet request.
+   * @return TRUE/FALSE based on the logic described above.
+   */
+  public static boolean isStaticUserAndNoneAuthType(
+      ServletContext servletContext, HttpServletRequest request) {
+    Configuration conf =
+        (Configuration) servletContext.getAttribute(CONF_CONTEXT_ATTRIBUTE);
+    final String authType = request.getAuthType();
+    final String staticUser = conf.get(HADOOP_HTTP_STATIC_USER,
+        DEFAULT_HADOOP_HTTP_STATIC_USER);
+    return authType == null && staticUser.equals(request.getRemoteUser());
+  }
+
+  /**
-      throws ServletException, IOException {
-      if (!HttpServer2.isInstrumentationAccessAllowed(getServletContext(),
-                                                      request, response)) {
+        throws ServletException, IOException {
+      // If user is a static user and auth Type is null, that means
+      // there is a non-security environment and no need authorization,
+      // otherwise, do the authorization.
+      final ServletContext servletContext = getServletContext();
+      if (!HttpServer2.isStaticUserAndNoneAuthType(servletContext, request) &&
+          !HttpServer2.isInstrumentationAccessAllowed(servletContext,
+              request, response)) {

INS26 INS26 INS40 INS40 INS31 INS29 INS83 INS83 INS39 INS42 INS44 INS44 INS8 INS65 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS60 INS60 INS60 INS41 INS66 INS66 INS66 INS42 INS66 INS42 INS66 INS66 INS42 INS42 INS43 INS59 INS83 INS43 INS59 INS83 INS43 INS59 INS27 INS60 INS42 INS42 INS11 INS42 INS42 INS32 INS42 INS42 INS32 INS27 INS32 INS83 INS43 INS59 INS27 INS43 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS33 INS42 INS42 INS32 INS42 INS42 MOV32 INS38 INS38 INS42 INS42 INS42 INS42 INS42 INS42 INS32 MOV32 INS42 INS42 INS42 INS42 INS42 DEL38