HADOOP-9416.  Add new symlink resolution methods in FileSystem and FileSystemLinkResolver.  (awang via cmccabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1499602 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.security.AccessControlException;
+  protected static FileSystem getFSofPath(final Path absOrFqPath,
+      final Configuration conf)
+      throws UnsupportedFileSystemException, IOException {
+    absOrFqPath.checkNotSchemeWithRelative();
+    absOrFqPath.checkNotRelative();
+
+    // Uses the default file system if not fully qualified
+    return get(absOrFqPath.toUri(), conf);
+  }
+
-                  getConf().getInt("io.file.buffer.size", 4096),
+                  getConf().getInt(
+                      CommonConfigurationKeysPublic.IO_FILE_BUFFER_SIZE_KEY,
+                      CommonConfigurationKeysPublic.IO_FILE_BUFFER_SIZE_DEFAULT),
-    final FileStatus srcStatus = getFileStatus(src);
+    final FileStatus srcStatus = getFileLinkStatus(src);
-      dstStatus = getFileStatus(dst);
+      dstStatus = getFileLinkStatus(dst);
+   * See {@link FileContext#fixRelativePart}
+   */
+  protected Path fixRelativePart(Path p) {
+    if (p.isUriPathAbsolute()) {
+      return p;
+    } else {
+      return new Path(getWorkingDirectory(), p);
+    }
+  }
+
+  /**
+   * See {@link FileContext#createSymlink(Path, Path, boolean)}
+   */
+  public void createSymlink(final Path target, final Path link,
+      final boolean createParent) throws AccessControlException,
+      FileAlreadyExistsException, FileNotFoundException,
+      ParentNotDirectoryException, UnsupportedFileSystemException, 
+      IOException {
+    // Supporting filesystems should override this method
+    throw new UnsupportedOperationException(
+        "Filesystem does not support symlinks!");
+  }
+
+  /**
+   * See {@link FileContext#getFileLinkStatus(Path)}
+   */
+  public FileStatus getFileLinkStatus(final Path f)
+      throws AccessControlException, FileNotFoundException,
+      UnsupportedFileSystemException, IOException {
+    // Supporting filesystems should override this method
+    return getFileStatus(f);
+  }
+
+  /**
+   * See {@link AbstractFileSystem#supportsSymlinks()}
+   */
+  public boolean supportsSymlinks() {
+    return false;
+  }
+
+  /**
+   * See {@link FileContext#getLinkTarget(Path)}
+   */
+  public Path getLinkTarget(Path f) throws IOException {
+    // Supporting filesystems should override this method
+    throw new UnsupportedOperationException(
+        "Filesystem does not support symlinks!");
+  }
+
+  /**
+   * See {@link AbstractFileSystem#getLinkTarget(Path)}
+   */
+  protected Path resolveLink(Path f) throws IOException {
+    // Supporting filesystems should override this method
+    throw new UnsupportedOperationException(
+        "Filesystem does not support symlinks!");
+  }
+
+  /**

INS26 INS40 INS31 INS31 INS31 INS31 INS31 INS31 INS31 INS83 INS83 INS43 INS42 INS44 INS44 INS43 INS43 INS8 INS29 INS83 INS43 INS42 INS44 INS8 INS29 INS83 INS39 INS42 INS44 INS44 INS44 INS43 INS43 INS43 INS43 INS43 INS43 INS8 INS29 INS83 INS43 INS42 INS44 INS43 INS43 INS43 INS43 INS8 INS29 INS83 INS39 INS42 INS8 INS29 INS83 INS43 INS42 INS44 INS43 INS8 INS29 INS83 INS43 INS42 INS44 INS43 INS8 INS42 INS83 INS43 INS42 INS83 INS43 INS42 INS42 INS42 INS21 INS21 INS41 INS65 INS42 INS43 INS42 INS25 INS65 INS83 INS43 INS42 INS83 INS43 INS42 INS83 INS39 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS53 INS65 INS42 INS83 INS43 INS42 INS42 INS42 INS42 INS42 INS41 INS65 INS41 INS65 INS42 INS43 INS42 INS42 INS53 INS65 INS42 INS43 INS42 INS42 INS53 INS42 INS42 INS32 INS32 INS32 INS66 INS65 INS42 INS32 INS8 INS8 INS66 INS65 INS42 INS42 INS14 INS66 INS65 INS42 INS32 INS66 INS65 INS9 INS66 INS65 INS42 INS14 INS66 INS65 INS42 INS14 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS67 INS42 INS42 INS41 INS41 INS68 INS43 INS45 INS68 INS42 INS42 INS68 INS68 INS43 INS45 INS68 INS43 INS45 INS42 INS42 INS40 INS40 UPD42 INS42 INS42 INS42 INS14 INS42 INS42 INS69 INS69 INS69 INS42 INS42 INS42 INS69 INS42 INS42 INS42 INS42 INS69 INS42 INS42 INS42 INS69 INS42 INS43 INS32 INS42 INS43 INS43 INS39 INS43 INS43 INS43 UPD42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL45 DEL34