HADOOP-10870. Failed to load OpenSSL cipher error logs on systems with old openssl versions (cmccabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/fs-encryption@1612440 13f79535-47bb-0310-9956-ffa450edef68

-  private static boolean nativeCipherLoaded = false;
+  private static final String loadingFailureReason;
+
-    if (NativeCodeLoader.isNativeCodeLoaded() &&
-        NativeCodeLoader.buildSupportsOpenssl()) {
-      try {
+    String loadingFailure = null;
+    try {
+      if (!NativeCodeLoader.buildSupportsOpenssl()) {
+        loadingFailure = "build does not support openssl.";
+      } else {
-        nativeCipherLoaded = true;
-      } catch (Throwable t) {
-        LOG.error("Failed to load OpenSSL Cipher.", t);
+    } catch (Throwable t) {
+      loadingFailure = t.getMessage();
+      LOG.debug("Failed to load OpenSSL Cipher.", t);
+    } finally {
+      loadingFailureReason = loadingFailure;
-  public static boolean isNativeCodeLoaded() {
-    return nativeCipherLoaded;
+  public static String getLoadingFailureReason() {
+    return loadingFailureReason;

INS83 INS43 INS43 UPD42 INS42 UPD42 INS60 MOV54 INS42 INS43 INS59 INS8 INS8 UPD42 INS42 INS42 INS33 INS25 INS21 INS38 INS8 MOV8 INS21 INS7 MOV32 INS21 INS7 INS42 INS42 INS7 INS42 INS32 UPD42 INS42 INS45 INS42 INS42 DEL39 DEL9 DEL42 DEL9 DEL7 DEL21 DEL42 DEL42 DEL32 DEL27 DEL8 DEL25 DEL39