HDFS-2617. Replaced Kerberized SSL for image transfer and fsck with SPNEGO-based solution. Contributed by Jakob Homan, Alejandro Abdelnur, and Aaron T. Myers


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1334216 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.security.Krb5AndCertsSslSocketConnector;
-import org.apache.hadoop.security.Krb5AndCertsSslSocketConnector.MODE;
+  public static final String SPNEGO_FILTER = "SpnegoFilter";
-    
-    defineFilter(webAppContext, "krb5Filter", 
-        Krb5AndCertsSslSocketConnector.Krb5SslFilter.class.getName(), 
-        null, null);
-    
+        
-   * servlets added using this method, filters (except internal Kerberized
+   +   * servlets added using this method, filters (except internal Kerberos
+   * @param requireAuth Require Kerberos authenticate to access servlet
-       LOG.info("Adding Kerberos filter to " + name);
+       LOG.info("Adding Kerberos (SPNEGO) filter to " + name);
-       fmap.setFilterName("krb5Filter");
+       fmap.setFilterName(SPNEGO_FILTER);
-   * @param needClientAuth whether client authentication is required
-   */
-  public void addSslListener(InetSocketAddress addr, Configuration sslConf,
-      boolean needClientAuth) throws IOException {
-    addSslListener(addr, sslConf, needClientAuth, false);
-  }
-
-  /**
-   * Configure an ssl listener on the server.
-   * @param addr address to listen on
-   * @param sslConf conf to retrieve ssl options
-   * @param needKrbAuth whether to allow kerberos auth
-      boolean needCertsAuth, boolean needKrbAuth) throws IOException {
+      boolean needCertsAuth) throws IOException {
-    Krb5AndCertsSslSocketConnector.MODE mode;
-    if(needCertsAuth && needKrbAuth)
-      mode = MODE.BOTH;
-    else if (!needCertsAuth && needKrbAuth)
-      mode = MODE.KRB;
-    else // Default to certificates
-      mode = MODE.CERTS;
-
-    SslSocketConnector sslListener = new Krb5AndCertsSslSocketConnector(mode);
+    SslSocketConnector sslListener = new SslSocketConnector();

INS23 INS83 INS83 INS83 INS43 INS59 UPD42 MOV42 INS42 INS45 INS65 INS60 UPD66 INS42 INS66 UPD43 MOV43 MOV59 INS42 MOV43 INS42 UPD45 DEL40 DEL26 DEL40 DEL26 DEL42 DEL42 DEL45 DEL40 DEL43 DEL57 DEL42 DEL32 DEL33 DEL33 DEL32 DEL21 DEL45 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL29 DEL83 DEL39 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL39 DEL42 DEL44 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL9 DEL32 DEL21 DEL8 DEL31 DEL42 DEL66 DEL65 DEL39 DEL42 DEL44 DEL40 DEL42 DEL43 DEL42 DEL42 DEL59 DEL60 DEL42 DEL42 DEL27 DEL42 DEL40 DEL7 DEL21 DEL42 DEL38 DEL42 DEL27 DEL42 DEL40 DEL7 DEL21 DEL42 DEL40 DEL7 DEL21 DEL25 DEL25 DEL60