HADOOP-12437. Allow SecurityUtil to lookup alternate hostnames. (Contributed by Arpit Agarwal)

-      name = DNS.getDefaultHost(
-          config.get(DFS_DATANODE_DNS_INTERFACE_KEY,
-                     DFS_DATANODE_DNS_INTERFACE_DEFAULT),
-          config.get(DFS_DATANODE_DNS_NAMESERVER_KEY,
-                     DFS_DATANODE_DNS_NAMESERVER_DEFAULT));
+      String dnsInterface = config.get(
+          CommonConfigurationKeys.HADOOP_SECURITY_DNS_INTERFACE_KEY);
+      String nameServer = config.get(
+          CommonConfigurationKeys.HADOOP_SECURITY_DNS_NAMESERVER_KEY);
+      boolean fallbackToHosts = false;
+
+      if (dnsInterface == null) {
+        // Try the legacy configuration keys.
+        dnsInterface = config.get(DFS_DATANODE_DNS_INTERFACE_KEY);
+        nameServer = config.get(DFS_DATANODE_DNS_NAMESERVER_KEY);
+      } else {
+        // If HADOOP_SECURITY_DNS_* is set then also attempt hosts file
+        // resolution if DNS fails. We will not use hosts file resolution
+        // by default to avoid breaking existing clusters.
+        fallbackToHosts = true;
+      }
+
+      name = DNS.getDefaultHost(dnsInterface, nameServer, fallbackToHosts);
-        DFS_DATANODE_KERBEROS_PRINCIPAL_KEY);
+        DFS_DATANODE_KERBEROS_PRINCIPAL_KEY, getHostName(conf));

INS60 INS60 INS60 INS25 INS21 INS32 INS43 INS59 INS43 INS59 INS39 INS59 INS27 INS8 INS8 INS7 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS9 INS42 INS33 INS21 INS21 INS21 INS42 INS32 INS42 INS42 INS40 UPD42 MOV42 UPD42 MOV42 INS40 INS7 INS7 INS7 UPD42 MOV42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS9 MOV42 MOV42 MOV42 MOV42 MOV42 MOV42 DEL42 DEL42 DEL32 DEL32 DEL32 DEL7 DEL21