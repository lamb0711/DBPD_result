HADOOP-9872. Improve protoc version handling and detection. (tucu)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1514068 13f79535-47bb-0310-9956-ffa450edef68

-  @Parameter(defaultValue="protoc")
+  @Parameter
+      if (protocCommand == null || protocCommand.trim().isEmpty()) {
+        protocCommand = "protoc";
+      }
-      if (exec.run(command, out) != 0) {
-        getLog().error("protoc, could not get version");
-        for (String s : out) {
-          getLog().error(s);
-        }
+      if (exec.run(command, out) == 127) {
+        getLog().error("protoc, not found at: " + protocCommand);
-        if (out.size() == 0) {
+        if (out.isEmpty()) {
+          getLog().error("stdout: " + out);
-              "'protoc -version' did not return a version");
+              "'protoc --version' did not return a version");

INS78 INS42 INS25 INS27 INS8 UPD27 INS27 INS32 INS21 UPD34 INS42 INS33 INS32 INS42 INS7 INS32 INS42 INS42 INS42 INS45 MOV32 INS27 MOV42 UPD42 MOV42 INS21 INS45 INS42 INS32 MOV32 INS42 INS27 UPD45 INS45 INS42 DEL42 DEL42 DEL45 DEL80 DEL77 DEL45 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL70 DEL32 DEL34 DEL27