YARN-6840. Implement zookeeper based store for scheduler configuration updates. (Jonathan Hung via wangda)

Change-Id: I9debea674fe8c7e4109d4ca136965a1ea4c48bcc

+import org.apache.hadoop.yarn.server.resourcemanager.scheduler.MutableConfigurationProvider;
-  public Response updateSchedulerConfiguration(SchedConfUpdateInfo
+  public synchronized Response updateSchedulerConfiguration(SchedConfUpdateInfo
-    if (scheduler instanceof MutableConfScheduler) {
+    if (scheduler instanceof MutableConfScheduler && ((MutableConfScheduler)
+        scheduler).isConfigurationMutable()) {
-          public Void run() throws IOException, YarnException {
-            ((MutableConfScheduler) scheduler).updateConfiguration(callerUGI,
-                mutationInfo);
+          public Void run() throws Exception {
+            MutableConfigurationProvider provider = ((MutableConfScheduler)
+                scheduler).getMutableConfProvider();
+            if (!provider.getAclMutationPolicy().isMutationAllowed(callerUGI,
+                mutationInfo)) {
+              throw new org.apache.hadoop.security.AccessControlException("User"
+                  + " is not admin of all modified queues.");
+            }
+            provider.logAndApplyMutation(callerUGI, mutationInfo);
+            try {
+              rm.getRMContext().getRMAdminService().refreshQueues();
+            } catch (IOException | YarnException e) {
+              provider.confirmPendingMutation(false);
+              throw e;
+            }
+            provider.confirmPendingMutation(true);
+        LOG.error("Exception thrown when modifying configuration.", e);

INS26 INS40 INS83 INS27 MOV62 INS32 INS36 INS42 INS11 INS43 INS42 INS21 INS42 INS32 INS42 INS42 INS45 INS42 INS43 INS8 INS42 INS60 INS25 INS21 INS54 INS21 MOV41 INS43 INS59 INS38 INS8 INS32 INS8 INS12 INS32 INS42 INS42 MOV32 INS32 INS53 INS42 INS42 INS42 INS42 MOV21 INS44 INS8 INS42 INS42 INS9 UPD42 INS32 INS42 INS42 INS42 INS14 INS32 INS84 INS42 INS21 INS53 INS42 INS42 INS43 INS27 INS32 INS42 MOV43 MOV43 INS32 INS42 INS40 INS45 INS45 INS32 INS42 INS42 INS42 INS9 INS42 INS42 DEL42 DEL42 DEL8