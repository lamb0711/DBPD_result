HADOOP-8561. Introduce HADOOP_PROXY_USER for secure impersonation in child hadoop client processes. (Yu Gao via llu)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1422429 13f79535-47bb-0310-9956-ffa450edef68

+  static final String HADOOP_PROXY_USER = "HADOOP_PROXY_USER";
-        loginUser = new UserGroupInformation(subject);
-        loginUser.setLogin(login);
-        loginUser.setAuthenticationMethod(authenticationMethod);
-        loginUser = new UserGroupInformation(login.getSubject());
+        UserGroupInformation realUser = new UserGroupInformation(subject);
+        realUser.setLogin(login);
+        realUser.setAuthenticationMethod(authenticationMethod);
+        realUser = new UserGroupInformation(login.getSubject());
+        // If the HADOOP_PROXY_USER environment variable or property
+        // is specified, create a proxy user as the logged in user.
+        String proxyUser = System.getenv(HADOOP_PROXY_USER);
+        if (proxyUser == null) {
+          proxyUser = System.getProperty(HADOOP_PROXY_USER);
+        }
+        loginUser = proxyUser == null ? realUser : createProxyUser(proxyUser, realUser);
+

INS23 INS83 INS83 INS43 INS59 INS42 INS42 INS45 INS60 INS60 INS25 INS21 INS43 INS59 INS43 INS59 INS27 INS8 INS7 INS42 INS42 MOV14 UPD42 UPD42 UPD42 INS42 INS42 INS32 INS42 INS33 INS21 INS42 INS16 INS42 INS42 INS42 INS7 INS27 INS42 INS32 INS42 INS32 INS42 INS33 INS42 INS42 INS42 INS42 INS42 INS42 DEL42 DEL7 DEL21