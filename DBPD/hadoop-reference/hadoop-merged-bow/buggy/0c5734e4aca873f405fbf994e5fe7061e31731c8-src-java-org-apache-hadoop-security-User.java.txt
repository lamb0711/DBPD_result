HADOOP-6299. Reimplement the UserGroupInformation to use the OS
specific and Kerberos JAAS login. (omalley)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@903560 13f79535-47bb-0310-9956-ffa450edef68

- * The username of a user.
+ * Save the full and short name of the user as a principal. This allows us to
+ * have a single type that we always look for when picking up user names.
-public class User implements Principal {
-  final String user;
+class User implements Principal {
+  private final String fullName;
+  private final String shortName;
+
+  public User(String name) {
+    fullName = name;
+    int atIdx = name.indexOf('@');
+    if (atIdx == -1) {
+      shortName = name;
+    } else {
+      int slashIdx = name.indexOf('/');
+      if (slashIdx == -1 || atIdx < slashIdx) {
+        shortName = name.substring(0, atIdx);
+      } else {
+        shortName = name.substring(0, slashIdx);
+      }
+    }
+  }
-   * Create a new <code>User</code> with the given username.
-   * @param user user name
+   * Get the full name of the user.
-  public User(String user) {
-    this.user = user;
+  @Override
+  public String getName() {
+    return fullName;
+  }
+  
+  /**
+   * Get the user name up to the first '/' or '@'
+   * @return the leading part of the user name
+   */
+  public String getShortName() {
+    return shortName;
-  public String getName() {
-    return user;
+  public boolean equals(Object o) {
+    if (this == o) {
+      return true;
+    } else if (o == null || getClass() != o.getClass()) {
+      return false;
+    } else {
+      return fullName.equals(((User) o).fullName);
+    }
-
-  @Override
-  public String toString() {
-    return user;
-  }
-
+  
-    final int prime = 31;
-    int result = 1;
-    result = prime * result + ((user == null) ? 0 : user.hashCode());
-    return result;
+    return fullName.hashCode();
-
+  
-  public boolean equals(Object obj) {
-    if (this == obj)
-      return true;
-    if (obj == null)
-      return false;
-    if (getClass() != obj.getClass())
-      return false;
-    User other = (User) obj;
-    if (user == null) {
-      if (other.user != null)
-        return false;
-    } else if (!user.equals(other.user))
-      return false;
-    return true;
+  public String toString() {
+    return fullName;

INS23 INS31 INS31 INS31 INS31 INS31 INS31 INS83 MOV43 INS83 INS83 MOV43 INS59 MOV83 MOV42 MOV44 INS8 INS29 MOV78 INS83 INS43 INS42 INS8 INS29 MOV83 MOV43 INS42 INS8 MOV78 INS83 MOV39 MOV42 MOV44 INS8 MOV78 INS83 INS39 INS42 INS8 MOV78 INS83 INS43 INS42 INS8 UPD66 INS66 UPD42 INS42 UPD42 MOV21 INS60 INS25 INS65 INS42 MOV41 INS65 INS65 INS41 UPD42 INS25 INS41 INS42 INS41 INS39 INS59 INS27 INS8 INS8 INS66 UPD42 INS66 INS66 INS42 MOV27 INS8 INS25 INS32 INS42 INS42 UPD42 INS42 INS32 INS42 INS38 INS21 MOV60 INS25 UPD42 MOV41 INS27 MOV8 INS8 INS42 INS42 INS42 INS42 INS13 INS34 INS7 INS27 INS8 INS8 INS27 INS27 MOV41 INS41 INS42 INS42 INS42 INS32 INS27 INS27 INS21 MOV21 UPD42 MOV42 MOV33 MOV32 MOV32 INS32 INS42 INS42 INS13 INS42 INS38 INS42 INS42 INS7 UPD42 INS42 INS42 INS22 INS34 INS42 INS32 UPD42 INS32 INS36 INS42 INS42 INS42 INS34 INS42 INS42 INS42 INS34 UPD42 MOV42 MOV11 UPD42 DEL83 DEL52 DEL42 DEL22 DEL83 DEL42 DEL34 DEL42 DEL42 DEL27 DEL42 DEL33 DEL27 DEL36 DEL34 DEL42 DEL32 DEL16 DEL36 DEL27 DEL40 DEL33 DEL27 DEL25 DEL66 DEL65 DEL42 DEL66 DEL65 DEL29 DEL8 DEL31 DEL83 DEL42 DEL42 DEL41 DEL8 DEL31 DEL83 DEL42 DEL42 DEL41 DEL8 DEL31 DEL83 DEL39 DEL42 DEL39 DEL42 DEL34 DEL59 DEL60 DEL8 DEL31 DEL25 DEL27 DEL9 DEL41 DEL25 DEL27 DEL9 DEL41 DEL25 DEL42 DEL43 DEL42 DEL59 DEL60 DEL42 DEL33 DEL27 DEL42 DEL42 DEL40 DEL32 DEL38 DEL9 DEL41 DEL25 DEL25 DEL9 DEL41 DEL8 DEL31