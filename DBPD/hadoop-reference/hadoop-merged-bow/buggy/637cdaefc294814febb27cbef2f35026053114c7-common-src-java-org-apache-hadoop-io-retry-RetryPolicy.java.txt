HADOOP-7380. Add client failover functionality to o.a.h.io.(ipc|retry). Contributed by Aaron T. Myers


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1144043 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.classification.InterfaceStability;
+
+
+@InterfaceStability.Evolving
+  
+  /**
+   * Returned by {@link RetryPolicy#shouldRetry(Exception, int, int, boolean)}.
+   */
+  @InterfaceStability.Evolving
+  public enum RetryAction {
+    FAIL,
+    RETRY,
+    FAILOVER_AND_RETRY
+  }
+  
-   * @param e The exception that caused the method to fail.
-   * @param retries The number of times the method has been retried.
+   * @param e The exception that caused the method to fail
+   * @param retries The number of times the method has been retried
+   * @param failovers The number of times the method has failed over to a
+   *   different backend implementation
+   * @param isMethodIdempotent <code>true</code> if the method is idempotent
+   *   and so can reasonably be retried on failover when we don't know if the
+   *   previous attempt reached the server or not
-   *   but shouldn't fail with an exception (only for void methods).
+   *   but shouldn't fail with an exception (only for void methods)
-   *   that the method failed and should not be retried further. 
+   *   that the method failed and should not be retried further
-  public boolean shouldRetry(Exception e, int retries) throws Exception;
+  public RetryAction shouldRetry(Exception e, int retries, int failovers,
+      boolean isMethodIdempotent) throws Exception;

INS26 INS40 INS78 INS71 INS40 INS29 INS78 INS83 INS42 INS72 INS72 INS72 INS43 INS42 INS44 INS44 INS65 INS40 INS42 INS42 INS42 INS65 INS65 INS42 INS39 INS42 INS39 INS42 INS66 INS65 INS66 UPD66 UPD66 INS42 INS66 INS66 INS42 INS66 INS66 INS66 UPD66 UPD66 INS68 INS42 INS42 INS69 INS69 INS69 INS69 INS43 INS39 INS39 INS39 INS42 DEL39 DEL42