HADOOP-14741. Refactor curator based ZooKeeper communication into common library. (Íñigo Goiri via Subru).

+import org.apache.hadoop.util.curator.ZKCuratorManager;
-import org.apache.hadoop.yarn.server.resourcemanager.RMZKUtils;
-  @VisibleForTesting
-  protected CuratorFramework curatorFramework;
+  /** Manager for the ZooKeeper connection. */
+  private ZKCuratorManager zkManager;
-    zkAcl = RMZKUtils.getZKAcls(conf);
+    zkAcl = ZKCuratorManager.getZKAcls(conf);
-
-    curatorFramework = resourceManager.getCurator();
-
-    if (curatorFramework == null) {
-      curatorFramework = resourceManager.createAndStartCurator(conf);
+    zkManager = resourceManager.getZKManager();
+    if (zkManager == null) {
+      zkManager = resourceManager.createAndStartZKManager(conf);
+    CuratorFramework curatorFramework = zkManager.getCurator();
+      CuratorFramework curatorFramework = zkManager.getCurator();
+      CuratorFramework curatorFramework = zkManager.getCurator();
-    return curatorFramework.getData().forPath(path);
+    return zkManager.getData(path);
-    return curatorFramework.getACL().forPath(path);
+    return zkManager.getACL(path);
-    return curatorFramework.getChildren().forPath(path);
+    return zkManager.getChildren(path);
-    return curatorFramework.checkExists().forPath(path) != null;
+    return zkManager.exists(path);
-    if (!exists(path)) {
-      curatorFramework.create()
-          .withMode(CreateMode.PERSISTENT).withACL(zkAcl)
-          .forPath(path, null);
-    }
+    zkManager.create(path, zkAcl);
-    if (exists(path)) {
-      curatorFramework.delete().deletingChildrenIfNeeded().forPath(path);
-    }
+    zkManager.delete(path);
+      CuratorFramework curatorFramework = zkManager.getCurator();

MOV26 MOV31 UPD40 INS29 UPD83 INS43 UPD39 INS42 INS8 UPD39 UPD42 INS8 INS65 INS42 UPD42 INS60 INS41 INS21 MOV21 INS66 MOV43 INS59 INS32 INS32 INS60 UPD42 UPD42 INS42 INS32 INS60 INS60 UPD42 MOV42 MOV42 UPD42 MOV42 MOV42 UPD42 MOV42 MOV42 UPD42 MOV42 UPD42 MOV42 MOV42 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 MOV42 INS43 INS59 UPD42 UPD42 INS42 INS42 INS43 INS59 INS43 INS59 INS42 INS42 INS32 UPD42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 UPD42 INS42 INS42 INS42 INS42 DEL42 DEL78 DEL32 DEL42 DEL32 DEL42 DEL32 DEL42 DEL42 DEL42 DEL42 DEL32 DEL38 DEL42 DEL42 DEL32 DEL42 DEL40 DEL32 DEL42 DEL32 DEL33 DEL32 DEL21 DEL8 DEL25 DEL8 DEL32 DEL32 DEL33 DEL27 DEL41 DEL32 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL8 DEL25 DEL8