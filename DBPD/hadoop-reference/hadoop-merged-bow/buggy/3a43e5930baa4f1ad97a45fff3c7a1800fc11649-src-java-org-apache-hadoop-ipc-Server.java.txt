HADOOP-6764. Add number of reader threads and queue length as configuration parameters in RPC.getServer. Contributed by Dmytro Molkov.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1038918 13f79535-47bb-0310-9956-ffa450edef68

-    this(bindAddress, port, paramClass, handlerCount,  conf, Integer.toString(port), null);
+    this(bindAddress, port, paramClass, handlerCount, -1, -1, conf, Integer.toString(port), null);
+  
-   * 
+   * If queueSizePerHandler or numReaders are not -1 they will be used instead of parameters
+   * from configuration. Otherwise the configuration will be picked up.
-                  Class<? extends Writable> paramClass, int handlerCount, 
+                  Class<? extends Writable> paramClass, int handlerCount, int numReaders, int queueSizePerHandler,
-    this.maxQueueSize = handlerCount * conf.getInt(
-        CommonConfigurationKeys.IPC_SERVER_HANDLER_QUEUE_SIZE_KEY,
-        CommonConfigurationKeys.IPC_SERVER_HANDLER_QUEUE_SIZE_DEFAULT);
+    if (queueSizePerHandler != -1) {
+      this.maxQueueSize = queueSizePerHandler;
+    } else {
+      this.maxQueueSize = handlerCount * conf.getInt(
+          CommonConfigurationKeys.IPC_SERVER_HANDLER_QUEUE_SIZE_KEY,
+          CommonConfigurationKeys.IPC_SERVER_HANDLER_QUEUE_SIZE_DEFAULT);      
+    }
-    this.readThreads = conf.getInt(
-        CommonConfigurationKeys.IPC_SERVER_RPC_READ_THREADS_KEY,
-        CommonConfigurationKeys.IPC_SERVER_RPC_READ_THREADS_DEFAULT);
+    if (numReaders != -1) {
+      this.readThreads = numReaders;
+    } else {
+      this.readThreads = conf.getInt(
+          CommonConfigurationKeys.IPC_SERVER_RPC_READ_THREADS_KEY,
+          CommonConfigurationKeys.IPC_SERVER_RPC_READ_THREADS_DEFAULT);      
+    }
-  
+  /**
+   * The maximum size of the rpc call queue of this server.
+   * @return The maximum size of the rpc call queue.
+   */
+  public int getMaxQueueSize() {
+    return maxQueueSize;
+  }
+
+  /**
+   * The number of reader threads for this server.
+   * @return The number of reader threads.
+   */
+  public int getNumReaders() {
+    return readThreads;
+  }
+

INS31 INS31 INS44 INS44 INS29 INS83 INS39 INS42 INS8 INS29 INS83 INS39 INS42 INS8 INS39 INS42 INS39 INS42 INS25 INS25 INS65 INS65 INS41 INS65 INS65 INS41 INS38 INS38 INS66 INS66 INS27 INS8 INS8 INS27 INS8 INS8 INS66 INS66 INS42 INS66 INS66 INS42 INS34 INS34 INS42 INS38 INS21 MOV21 INS42 INS38 INS21 MOV21 INS34 INS7 INS34 INS7 INS22 INS42 INS22 INS42 INS52 INS42 INS52 INS42