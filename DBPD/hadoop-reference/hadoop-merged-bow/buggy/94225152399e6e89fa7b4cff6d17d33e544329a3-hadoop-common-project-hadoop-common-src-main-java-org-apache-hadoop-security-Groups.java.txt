HADOOP-13442. Optimize UGI group lookups. Contributed by Daryn Sharp.

+import java.util.ArrayList;
+import java.util.LinkedHashSet;
+import java.util.concurrent.atomic.AtomicReference;
-  private final Map<String, List<String>> staticUserToGroupsMap =
-      new HashMap<String, List<String>>();
+  private final AtomicReference<Map<String, List<String>>> staticMapRef =
+      new AtomicReference<>();
+    Map<String, List<String>> staticUserToGroupsMap =
+        new HashMap<String, List<String>>();
+    staticMapRef.set(
+        staticUserToGroupsMap.isEmpty() ? null : staticUserToGroupsMap);
-    List<String> staticMapping = staticUserToGroupsMap.get(user);
-    if (staticMapping != null) {
-      return staticMapping;
+    Map<String, List<String>> staticUserToGroupsMap = staticMapRef.get();
+    if (staticUserToGroupsMap != null) {
+      List<String> staticMapping = staticUserToGroupsMap.get(user);
+      if (staticMapping != null) {
+        return staticMapping;
+      }
-      return groups;
+      // return immutable de-duped list
+      return Collections.unmodifiableList(
+          new ArrayList<>(new LinkedHashSet<>(groups)));

INS26 INS26 INS26 INS40 INS40 INS40 INS74 INS59 INS43 INS74 INS42 INS14 INS60 INS21 INS60 INS25 INS42 INS43 INS43 INS74 INS74 MOV74 MOV59 INS32 INS74 INS59 INS27 INS8 INS42 INS42 INS43 INS43 INS43 INS42 INS42 INS16 INS43 INS43 INS74 INS42 INS32 INS42 INS33 MOV60 MOV25 INS32 INS42 INS42 INS42 INS32 INS33 INS42 INS42 INS42 INS43 INS43 INS42 INS42 INS42 INS42 INS14 INS42 INS42 INS42 INS42 INS74 INS14 INS43 INS74 INS42 INS42 INS43 INS42 DEL42