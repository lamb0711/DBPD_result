HDFS-5889. When starting rolling upgrade, create a fs image for rollback so that the standby namenode can create checkpoints during upgrade.  Contributed by szetszwo & jing9


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1567861 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.namenode.NNStorage.NameNodeFile;
-      getFSImage().saveNamespace(this);
+      getFSImage().saveNamespace(this, NameNodeFile.IMAGE_ROLLBACK, null);
-      getEditLog().logUpgradeMarker(rollingUpgradeInfo.getStartTime());
+      getEditLog().logStartRollingUpgrade(rollingUpgradeInfo.getStartTime());
-  boolean isRollingUpgrade() {
+  public boolean isRollingUpgrade() {
-      getFSImage().saveNamespace(this);
+      getFSImage().purgeCheckpoints(NameNodeFile.IMAGE_ROLLBACK);
+      getEditLog().logFinalizeRollingUpgrade(returnInfo.getFinalizeTime());
+    getEditLog().logSync();

INS26 INS40 INS83 INS21 INS32 INS21 INS32 INS42 INS32 INS42 INS40 INS33 UPD42 UPD42 INS40 INS32 INS42 INS32 INS42 INS42 INS42 DEL52