HADOOP-6835. Add support for concatenated gzip input. Contributed by Greg Roelofs


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@961532 13f79535-47bb-0310-9956-ffa450edef68

-    // Consume remanining compressed data?
+    // Consume remaining compressed data?
-    // Check if 'zlib' says its 'finished' and
+    // Check if 'zlib' says it's 'finished' and
-    // Get atmost 'len' bytes
+    // Get at most 'len' bytes
-   * Returns the total number of compressed bytes output so far.
+   * Returns the total number of uncompressed bytes output so far.
-   * @return the total (non-negative) number of compressed bytes output so far
+   * @return the total (non-negative) number of uncompressed bytes output so far
-   * Returns the total number of uncompressed bytes input so far.</p>
+   * Returns the total number of compressed bytes input so far.</p>
-   * @return the total (non-negative) number of uncompressed bytes input so far
+   * @return the total (non-negative) number of compressed bytes input so far
+  /**
+   * Returns the number of bytes remaining in the input buffers; normally
+   * called when finished() is true to determine amount of post-gzip-stream
+   * data.</p>
+   *
+   * @return the total (non-negative) number of unprocessed bytes in input
+   */
+  public synchronized int getRemaining() {
+    checkStream();
+    return userBufLen + getRemaining(stream);  // userBuf + compressedDirectBuf
+  }
+
+  /**
+   * Resets everything including the input buffers (user and direct).</p>
+   */
+  private native static int getRemaining(long strm);

INS31 INS31 INS29 INS83 INS83 INS39 INS42 INS8 INS29 INS83 INS83 INS83 INS39 INS42 INS44 INS65 INS65 INS21 INS41 INS65 INS39 INS42 UPD66 UPD66 UPD66 UPD66 INS66 INS66 INS66 INS66 INS32 INS27 INS66 INS42 INS42 INS32 INS42 INS42