HADOOP-9299.  kerberos name resolution is kicking in even when kerberos is not configured (daryn)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1457763 13f79535-47bb-0310-9956-ffa450edef68

+import static org.apache.hadoop.fs.CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTH_TO_LOCAL;
+
-import org.apache.hadoop.fs.CommonConfigurationKeysPublic;
-  static {
-    try {
-      KerberosUtil.getDefaultRealm();
-    } catch (Exception ke) {
-      if(UserGroupInformation.isSecurityEnabled())
-        throw new IllegalArgumentException("Can't get Kerberos configuration",ke);
-    }
-  }
-
-    String ruleString = conf.get(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTH_TO_LOCAL, "DEFAULT");
+    final String defaultRule;
+    switch (SecurityUtil.getAuthenticationMethod(conf)) {
+      case KERBEROS:
+      case KERBEROS_SSL:
+        try {
+          KerberosUtil.getDefaultRealm();
+        } catch (Exception ke) {
+          throw new IllegalArgumentException("Can't get Kerberos realm", ke);
+        }
+        defaultRule = "DEFAULT";
+        break;
+      default:
+        // just extract the simple user name
+        defaultRule = "RULE:[1:$1] RULE:[2:$1]";
+        break; 
+    }
+    String ruleString = conf.get(HADOOP_SECURITY_AUTH_TO_LOCAL, defaultRule);

MOV26 UPD40 INS60 INS50 INS83 INS43 INS59 INS32 INS49 INS49 MOV54 INS21 INS10 INS49 INS21 INS10 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS7 INS7 INS42 INS45 INS42 INS45 INS42 INS42 MOV53 UPD45 DEL83 DEL8 DEL28 DEL42 DEL42 DEL32 DEL25 DEL40 DEL45