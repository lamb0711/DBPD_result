HDFS-13166: [SPS]: Implement caching mechanism to keep LIVE datanodes to minimize costly getLiveDatanodeStorageReport() calls. Contributed by Rakesh R.

+import java.util.List;
-import org.apache.hadoop.fs.StorageType;
-import org.apache.hadoop.hdfs.protocol.DatanodeInfo;
+import org.apache.hadoop.hdfs.server.namenode.sps.StoragePolicySatisfier.DatanodeMap;
+import org.apache.hadoop.hdfs.server.namenode.sps.StoragePolicySatisfier.DatanodeWithStorage;
-  public NetworkTopology getNetworkTopology() {
-    return NetworkTopology.getInstance(service.getConf());
+  public NetworkTopology getNetworkTopology(DatanodeMap datanodeMap) {
+    // create network topology.
+    NetworkTopology cluster = NetworkTopology.getInstance(service.getConf());
+    List<DatanodeWithStorage> targets = datanodeMap.getTargets();
+    for (DatanodeWithStorage node : targets) {
+      cluster.add(node.getDatanodeInfo());
+    }
+    return cluster;
-  public boolean checkDNSpaceForScheduling(DatanodeInfo dn, StorageType type,
-      long estimatedSize) {
-    // TODO: Instead of calling namenode for checking the available space, it
-    // can be optimized by maintaining local cache of datanode storage report
-    // and do the computations. This local cache can be refreshed per file or
-    // periodic fashion.
-    try {
-      return nnc.getNNProtocolConnection().checkDNSpaceForScheduling(dn, type,
-          estimatedSize);
-    } catch (IOException e) {
-      LOG.warn("Verify the given datanode:{} is good and has "
-          + "estimated space in it.", dn, e);
-      return false;
-    }
-  }
-
-  @Override

MOV26 MOV26 INS26 INS40 UPD40 UPD40 INS31 MOV78 MOV83 INS43 INS42 MOV44 INS8 INS42 UPD43 UPD42 INS60 INS60 INS70 MOV41 UPD42 MOV43 INS59 INS74 INS59 INS44 INS42 INS8 INS42 INS42 MOV32 INS43 INS43 INS42 INS32 UPD43 MOV43 UPD42 MOV42 MOV21 UPD42 MOV42 INS42 UPD42 MOV42 UPD42 MOV42 UPD42 UPD42 UPD42 INS32 UPD42 MOV42 UPD42 MOV42 DEL45 DEL45 DEL27 DEL9 DEL42 DEL41 DEL8 DEL31 DEL42 DEL78 DEL83 DEL39 DEL42 DEL43 DEL42 DEL44 DEL39 DEL42 DEL44 DEL32 DEL42 DEL42 DEL42 DEL42 DEL32 DEL41 DEL8 DEL44 DEL8 DEL12 DEL54 DEL8 DEL31