HDFS-6677. Change INodeFile and FSImage to support storage policy ID.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-6584@1610525 13f79535-47bb-0310-9956-ffa450edef68

-  /** Format: [16 bits for replication][48 bits for PreferredBlockSize] */
+  /** 
+   * Bit format:
+   * [4-bit storagePolicyID][12-bit replication][48-bit preferredBlockSize]
+   */
-    REPLICATION(PREFERRED_BLOCK_SIZE.BITS, 16, 1);
+    REPLICATION(PREFERRED_BLOCK_SIZE.BITS, 12, 1),
+    STORAGE_POLICY_ID(REPLICATION.BITS, 4, 0);
-    static long toLong(long preferredBlockSize, short replication) {
+    static byte getStoragePolicyID(long header) {
+      return (byte)STORAGE_POLICY_ID.BITS.retrieve(header);
+    }
+
+    static long toLong(long preferredBlockSize, short replication,
+        byte storagePolicyID) {
+      h = STORAGE_POLICY_ID.BITS.combine(storagePolicyID, h);
-      long preferredBlockSize) {
+      long preferredBlockSize, byte storagePolicyID) {
-    header = HeaderFormat.toLong(preferredBlockSize, replication);
+    header = HeaderFormat.toLong(preferredBlockSize, replication,
+        storagePolicyID);
+  public byte getStoragePolicyID() {
+    return HeaderFormat.getStoragePolicyID(header);
+  }
+
+  @Override

INS31 INS72 INS31 INS44 INS78 INS83 INS39 INS42 INS8 UPD34 INS42 INS40 INS34 INS34 INS83 INS39 INS42 INS44 INS8 INS44 INS39 INS42 INS42 INS41 INS66 UPD66 INS39 INS42 INS41 INS39 INS42 INS21 INS32 INS11 INS7 INS42 INS42 INS42 INS39 INS32 INS42 INS32 INS42 INS40 INS42 INS42 INS40 INS42 INS42 INS42