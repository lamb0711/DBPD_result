HDFS-13209. DistributedFileSystem.create should allow an option to provide StoragePolicy. Contributed by Ayush Saxena.

+   * The third addition is storagePolicyName. A non-null storage Policy
+   * specifies an explicit storage policy for this file, overriding the
+   * inherited policy.
-      final InetSocketAddress[] favoredNodes, final String ecPolicyName)
+      final InetSocketAddress[] favoredNodes, final String ecPolicyName,
+      final String storagePolicy)
-            checksumOpt, favoredNodes, ecPolicyName);
+            checksumOpt, favoredNodes, ecPolicyName, storagePolicy);
-              blockSize, progress, checksumOpt, favoredNodes, ecPolicyName);
+              blockSize, progress, checksumOpt, favoredNodes, ecPolicyName,
+              storagePolicy);
-   * additional parameters, i.e., favoredNodes and ecPolicyName.
+   * additional parameters, i.e., favoredNodes, ecPolicyName and
+   * storagePolicyName.
-      final InetSocketAddress[] favoredNodes, final String ecPolicyName)
-      throws IOException {
+      final InetSocketAddress[] favoredNodes, final String ecPolicyName,
+      final String storagePolicyName) throws IOException {
-            checksumOpt, favoredNodes, ecPolicyName);
+            checksumOpt, favoredNodes, ecPolicyName, storagePolicyName);
-              ecPolicyName);
+              ecPolicyName, storagePolicyName);
+    private String storagePolicyName = null;
+    String getStoragePolicyName() {
+      return storagePolicyName;
+    }
+
+    /**
+     * Enforce a file to follow the specified storage policy irrespective of the
+     * storage policy of its parent directory.
+     */
+    public HdfsDataOutputStreamBuilder storagePolicyName(
+        @Nonnull final String policyName) {
+      Preconditions.checkNotNull(policyName);
+      storagePolicyName = policyName;
+      return this;
+    }
+
+    @VisibleForTesting
-              getEcPolicyName());
+              getEcPolicyName(), getStoragePolicyName());
-              getChecksumOpt(), getFavoredNodes(), getEcPolicyName());
+              getChecksumOpt(), getFavoredNodes(), getEcPolicyName(),
+              getStoragePolicyName());

INS44 INS44 INS23 INS31 INS31 INS83 INS43 INS42 INS83 INS43 INS42 INS83 INS43 INS59 INS78 INS43 INS42 INS8 INS29 INS83 INS43 INS42 INS44 INS8 INS66 INS66 INS66 INS42 UPD66 INS66 INS42 INS42 INS42 INS33 INS42 INS42 INS41 INS65 INS42 INS78 INS83 INS43 INS42 INS21 INS21 INS41 INS42 INS66 INS66 INS42 INS42 INS32 INS7 INS52 INS42 INS42 INS42 INS42 INS42 MOV8 UPD42 INS32 UPD42 INS32 INS42 INS42 INS42 INS42 INS42 INS42