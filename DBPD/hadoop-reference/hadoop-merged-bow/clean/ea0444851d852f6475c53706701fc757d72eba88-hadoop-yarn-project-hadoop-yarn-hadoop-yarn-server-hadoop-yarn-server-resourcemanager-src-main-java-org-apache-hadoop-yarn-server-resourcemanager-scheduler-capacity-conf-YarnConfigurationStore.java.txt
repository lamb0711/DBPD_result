YARN.10003. YarnConfigurationStore#checkVersion throws exception that belongs to RMStateStore. Contributed by Benjamin Teke

-import org.apache.hadoop.yarn.server.resourcemanager.recovery.RMStateVersionIncompatibleException;
+   *
-    // TODO this was taken from RMStateStore. Should probably refactor
-    LOG.info("Loaded configuration store version info " + loadedVersion);
-    if (loadedVersion != null && loadedVersion.equals(getCurrentVersion())) {
+    Version currentVersion = getCurrentVersion();
+    LOG.info("Loaded configuration store version info {}", loadedVersion);
+
+    // when hard-coded schema version (currentVersion) is null the version check
+    // is unnecessary
+    if (currentVersion == null || currentVersion.equals(loadedVersion)) {
-    if (loadedVersion == null) {
-      loadedVersion = getCurrentVersion();
-    }
-    if (loadedVersion.isCompatibleTo(getCurrentVersion())) {
-      LOG.info("Storing configuration store version info "
-          + getCurrentVersion());
+    if (loadedVersion == null || loadedVersion.isCompatibleTo(currentVersion)) {
+      LOG.info("Storing configuration store version info {}", currentVersion);
-      throw new RMStateVersionIncompatibleException(
-          "Expecting configuration store version " + getCurrentVersion()
+      throw new YarnConfStoreVersionIncompatibleException(
+          "Expecting configuration store version " + currentVersion

INS60 INS43 INS59 UPD27 INS27 INS42 INS42 MOV32 INS45 INS42 UPD27 MOV27 INS32 UPD42 UPD42 UPD42 MOV42 MOV42 MOV42 UPD42 MOV42 INS45 UPD42 MOV42 UPD43 UPD42 INS42 DEL40 DEL26 DEL45 DEL42 DEL27 DEL32 DEL42 DEL7 DEL21 DEL8 DEL25 DEL32 DEL32 DEL45 DEL32 DEL27 DEL42 DEL32