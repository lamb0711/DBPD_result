YARN-8242. YARN NM: OOM error while reading back the state store on recovery. Contributed by Pradeep Ambati and Kanwaljeet Sachdev

+import org.apache.hadoop.yarn.server.nodemanager.recovery.RecoveryIterator;
-      for (ContainerManagerApplicationProto proto :
-           appsState.getApplications()) {
-        if (LOG.isDebugEnabled()) {
-          LOG.debug("Recovering application with state: " + proto.toString());
+      try (RecoveryIterator<ContainerManagerApplicationProto> rasIterator =
+               appsState.getIterator()) {
+        while (rasIterator.hasNext()) {
+          ContainerManagerApplicationProto proto = rasIterator.next();
+          if (LOG.isDebugEnabled()) {
+            LOG.debug("Recovering application with state: " + proto.toString());
+          }
+          recoverApplication(proto);
-        recoverApplication(proto);
-      for (RecoveredContainerState rcs : stateStore.loadContainersState()) {
-        if (LOG.isDebugEnabled()) {
-          LOG.debug("Recovering container with state: " + rcs);
+      try (RecoveryIterator<RecoveredContainerState> rcsIterator =
+               stateStore.getContainerStateIterator()) {
+        while (rcsIterator.hasNext()) {
+          RecoveredContainerState rcs = rcsIterator.next();
+          if (LOG.isDebugEnabled()) {
+            LOG.debug("Recovering container with state: " + rcs);
+          }
+          recoverContainer(rcs);
-        recoverContainer(rcs);

INS26 INS40 INS54 INS54 INS58 INS8 INS58 INS8 INS74 INS59 INS61 INS74 INS59 INS61 INS43 INS43 INS42 INS32 INS32 MOV8 INS43 INS43 INS42 INS32 INS32 MOV8 INS42 INS42 MOV42 UPD42 MOV42 INS42 INS42 INS60 INS42 INS42 MOV42 UPD42 MOV42 INS42 INS42 INS60 MOV43 INS59 MOV43 INS59 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS42 DEL42 DEL44 DEL32 DEL70 DEL42 DEL44 DEL32 DEL70