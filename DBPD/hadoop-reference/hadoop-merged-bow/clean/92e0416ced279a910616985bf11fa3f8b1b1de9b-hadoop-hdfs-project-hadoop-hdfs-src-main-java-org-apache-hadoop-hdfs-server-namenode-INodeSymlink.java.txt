HDFS-4727. Update inodeMap after deleting files/directories/snapshots.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1470756 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.List;
-      final BlocksMapUpdateInfo collectedBlocks) {
+      final BlocksMapUpdateInfo collectedBlocks, final List<INode> removedINodes) {
+    if (snapshot == null && prior == null) {
+      destroyAndCollectBlocks(collectedBlocks, removedINodes);
+    }
-  public void destroyAndCollectBlocks(
-      final BlocksMapUpdateInfo collectedBlocks) {
-    // do nothing
+  public void destroyAndCollectBlocks(final BlocksMapUpdateInfo collectedBlocks,
+      final List<INode> removedINodes) {
+    removedINodes.add(this);

INS26 INS40 INS44 INS44 INS83 INS74 INS42 INS25 INS83 INS74 INS42 INS21 INS43 INS43 INS27 INS8 INS43 INS43 INS32 INS42 INS42 INS27 INS27 INS21 INS42 INS42 INS42 INS42 INS52 INS42 INS33 INS42 INS33 INS32 INS42 INS42 INS42