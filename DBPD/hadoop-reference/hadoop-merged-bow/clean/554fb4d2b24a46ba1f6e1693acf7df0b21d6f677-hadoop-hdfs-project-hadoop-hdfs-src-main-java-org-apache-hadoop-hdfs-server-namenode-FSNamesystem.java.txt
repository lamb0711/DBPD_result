Merge r1404624 through r1405251 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1405253 13f79535-47bb-0310-9956-ffa450edef68

-    if(trgInode.blocks.length == 0) {
+    if(trgInode.numBlocks() == 0) {
-    if(blockSize != trgInode.blocks[trgInode.blocks.length-1].getNumBytes()) {
+    final BlockInfo last = trgInode.getLastBlock();
+    if(blockSize != last.getNumBytes()) {
-          + " is not full; last block size = "
-          + trgInode.blocks[trgInode.blocks.length-1].getNumBytes()
+          + " is not full; last block size = " + last.getNumBytes()
-          || srcInode.blocks.length == 0) {
+          || srcInode.numBlocks() == 0) {
-      int idx = srcInode.blocks.length-1;
+      final BlockInfo[] srcBlocks = srcInode.getBlocks();
+      int idx = srcBlocks.length-1;
-        idx = srcInode.blocks.length-2; // end block of endSrc is OK not to be full
-      if(idx >= 0 && srcInode.blocks[idx].getNumBytes() != blockSize) {
+        idx = srcBlocks.length-2; // end block of endSrc is OK not to be full
+      if(idx >= 0 && srcBlocks[idx].getNumBytes() != blockSize) {
-            + srcInode.blocks[idx].getNumBytes());
+            + srcBlocks[idx].getNumBytes());
-      } else if (!parentNode.isDirectory() && !parentNode.isLink()) {
+      } else if (!parentNode.isDirectory() && !parentNode.isSymlink()) {

INS60 INS83 INS43 INS59 INS32 INS42 INS42 INS32 INS60 INS42 INS42 INS42 INS42 INS42 INS83 INS5 INS59 INS43 INS85 INS42 INS32 INS32 INS42 INS42 INS42 UPD40 INS42 INS42 INS42 UPD40 INS42 UPD42 INS42 DEL40 DEL40 DEL40 DEL34 DEL27 DEL2 DEL40 DEL40 DEL34 DEL27 DEL2 DEL40 DEL40 DEL40