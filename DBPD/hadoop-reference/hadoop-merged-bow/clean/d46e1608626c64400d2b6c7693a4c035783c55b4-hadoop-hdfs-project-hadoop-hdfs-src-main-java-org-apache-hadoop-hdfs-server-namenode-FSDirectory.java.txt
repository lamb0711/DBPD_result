HDFS-4877. Snapshot: fix the scenario where a directory is renamed under its prior descendant. Contributed by Jing Zhao.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1490421 13f79535-47bb-0310-9956-ffa450edef68

-              newSrcCounts.get(Quota.DISKSPACE), false, Snapshot.INVALID_ID);
+              newSrcCounts.get(Quota.DISKSPACE), false);
-              dstIIP.getLatestSnapshot(), collectedBlocks, removedINodes).get(
-              Quota.NAMESPACE);
+              dstIIP.getLatestSnapshot(), collectedBlocks, removedINodes, true)
+              .get(Quota.NAMESPACE);
-              newSrcCounts.get(Quota.DISKSPACE), false, Snapshot.INVALID_ID);
+              newSrcCounts.get(Quota.DISKSPACE), false);
-          collectedBlocks, removedINodes);
+          collectedBlocks, removedINodes, true);
-          -counts.get(Quota.DISKSPACE), true, Snapshot.INVALID_ID);
+          -counts.get(Quota.DISKSPACE), true);
-        INodeDirectoryWithQuota node =(INodeDirectoryWithQuota)inodes[i]; 
+        INodeDirectoryWithQuota node = (INodeDirectoryWithQuota) inodes[i]
+            .asDirectory(); 
-          ((INodeDirectoryWithQuota)inodes[i]).verifyQuota(nsDelta, dsDelta);
+          ((INodeDirectoryWithQuota) inodes[i].asDirectory()).verifyQuota(
+              nsDelta, dsDelta);

INS9 INS32 MOV2 INS42 INS9 INS32 MOV2 INS42 DEL40 DEL40 DEL40