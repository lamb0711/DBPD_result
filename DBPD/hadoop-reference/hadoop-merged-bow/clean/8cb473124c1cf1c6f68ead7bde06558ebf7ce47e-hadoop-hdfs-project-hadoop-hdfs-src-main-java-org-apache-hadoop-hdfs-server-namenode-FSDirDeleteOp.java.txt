HDFS-6651. Deletion failure can leak inodes permanently. Contributed by Jing Zhao.

-import org.apache.hadoop.hdfs.protocol.QuotaExceededException;
-      List<INode> removedINodes, long mtime) throws QuotaExceededException {
+      List<INode> removedINodes, long mtime) {
-          latestSnapshot, collectedBlocks, removedINodes, true);
+          latestSnapshot, collectedBlocks, removedINodes);
-      // TODO: quota verification may fail the deletion here. We should not
-      // count the snapshot diff into quota usage in the future.
-      fsd.updateCount(iip, -counts.get(Quota.NAMESPACE),
-          -counts.get(Quota.DISKSPACE), true);
+      fsd.updateCountNoQuotaCheck(iip, iip.length() - 1,
+          -counts.get(Quota.NAMESPACE), -counts.get(Quota.DISKSPACE));

UPD42 INS27 INS32 INS34 INS42 INS42 DEL40 DEL26 DEL42 DEL43 DEL9 DEL9