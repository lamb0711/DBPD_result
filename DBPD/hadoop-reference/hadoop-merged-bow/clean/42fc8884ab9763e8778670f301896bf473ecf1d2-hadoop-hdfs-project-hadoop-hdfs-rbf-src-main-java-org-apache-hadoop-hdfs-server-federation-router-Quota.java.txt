HDFS-14815. RBF: Update the quota in MountTable when calling setQuota on a MountTable src. Contributed by Jinglun.

+import org.apache.hadoop.security.AccessControlException;
-   * @throws IOException If the quota system is disabled.
+   * @param checkMountEntry whether to check the path is a mount entry.
+   * @throws AccessControlException If the quota system is disabled or if
+   * checkMountEntry is true and the path is a mount entry.
-  public void setQuota(String path, long namespaceQuota,
-      long storagespaceQuota, StorageType type) throws IOException {
+  public void setQuota(String path, long namespaceQuota, long storagespaceQuota,
+      StorageType type, boolean checkMountEntry) throws IOException {
+    if (checkMountEntry && isMountEntry(path)) {
+      throw new AccessControlException(
+          "Permission denied: " + RouterRpcServer.getRemoteUser()
+              + " is not allowed to change quota of " + path);
+    }
+   * Is the path a mount entry.
+   *
+   * @param path the path to be checked.
+   * @return {@code true} if path is a mount entry; {@code false} otherwise.
+   */
+  private boolean isMountEntry(String path) {
+    return router.getQuotaManager().isMountEntry(path);
+  }
+
+  /**

INS26 INS40 INS31 INS44 INS29 INS83 INS39 INS42 INS44 INS8 INS65 INS39 INS42 INS25 INS65 INS65 INS65 INS43 INS42 INS41 INS42 INS66 UPD42 UPD66 INS66 INS27 INS8 INS66 INS42 INS66 INS66 INS65 INS66 INS65 INS66 INS42 INS32 INS42 INS32 INS53 INS66 INS66 INS32 INS42 INS42 INS42 INS42 INS14 INS42 INS42 INS43 INS27 INS42 INS45 INS32 INS45 INS42 INS42 INS42