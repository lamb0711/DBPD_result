YARN-8215. ATS v2 returns invalid YARN_CONTAINER_ALLOCATED_HOST_HTTP_ADDRESS from NM. Contributed by Rohith Sharma K S.

+
+import org.apache.hadoop.yarn.webapp.util.WebAppUtils;
+  private String httpPort;
+
+    String webAppURLWithoutScheme =
+        WebAppUtils.getNMWebAppURLWithoutScheme(conf);
+    if (webAppURLWithoutScheme.contains(":")) {
+      httpPort = webAppURLWithoutScheme.split(":")[1];
+    }
+    this.httpAddress = nodeId.getHost() + ":" + httpPort;
-    if (this.httpAddress == null) {
-      // update httpAddress for first time. When this service started,
-      // web server will not be started.
-      this.httpAddress = nodeId.getHost() + ":" + context.getHttpPort();
-    }

INS26 INS40 INS23 INS83 INS43 INS59 INS42 INS42 INS60 INS25 INS21 INS43 INS59 INS32 INS8 INS7 INS42 INS42 INS32 INS42 INS42 INS45 INS21 MOV22 INS27 INS42 INS42 INS42 INS7 MOV32 INS45 INS42 INS42 INS2 INS32 INS34 INS42 INS42 INS45 DEL52 DEL42 DEL22 DEL33 DEL27 DEL45 DEL42 DEL42 DEL32 DEL27 DEL7 DEL21 DEL8 DEL25