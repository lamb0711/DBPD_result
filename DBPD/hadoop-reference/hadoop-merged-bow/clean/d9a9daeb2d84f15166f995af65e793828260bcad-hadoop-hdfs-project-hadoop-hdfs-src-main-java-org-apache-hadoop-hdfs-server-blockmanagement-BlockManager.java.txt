Merge r1399946 through r1400349 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1400351 13f79535-47bb-0310-9956-ffa450edef68

-      final Configuration conf) throws IOException {
+      final Configuration conf) {
-          pendingReplications.add(block, targets.length);
+          pendingReplications.increment(block, targets.length);
-   * @throws IOException if the number of targets < minimum replication.
-   * @see BlockPlacementPolicy#chooseTarget(String, int, DatanodeDescriptor, HashMap, long)
+   * 
+   * @throws IOException
+   *           if the number of targets < minimum replication.
+   * @see BlockPlacementPolicy#chooseTarget(String, int, DatanodeDescriptor,
+   *      List, boolean, HashMap, long)
-   * standby node. {@see PendingDataNodeMessages}.
+   * standby node. @see PendingDataNodeMessages.
-   * Faster version of {@link addStoredBlock()}, intended for use with 
-   * initial block report at startup.  If not in startup safe mode, will
-   * call standard addStoredBlock().
-   * Assumes this method is called "immediately" so there is no need to
-   * refresh the storedBlock from blocksMap.
-   * Doesn't handle underReplication/overReplication, or worry about
+   * Faster version of
+   * {@link #addStoredBlock(BlockInfo, DatanodeDescriptor, DatanodeDescriptor, boolean)}
+   * , intended for use with initial block report at startup. If not in startup
+   * safe mode, will call standard addStoredBlock(). Assumes this method is
+   * called "immediately" so there is no need to refresh the storedBlock from
+   * blocksMap. Doesn't handle underReplication/overReplication, or worry about
+   * 
-    pendingReplications.remove(block);
+    pendingReplications.decrement(block);
-   * Simpler, faster form of {@link countNodes()} that only returns the number
+   * Simpler, faster form of {@link #countNodes(Block)} that only returns the number
+    // Remove the block from pendingReplications
+    pendingReplications.remove(block);

INS21 MOV21 UPD66 UPD66 MOV66 UPD66 UPD66 UPD66 UPD66 UPD66 INS32 INS69 INS69 INS68 INS42 INS42 INS42 INS68 INS43 INS39 INS42 INS69 INS69 INS69 INS69 INS42 INS69 INS42 INS43 INS43 INS43 INS39 INS43 INS42 INS42 INS42 INS42 UPD42 DEL42 DEL43 DEL66 DEL65 DEL66 DEL66 DEL66 DEL66 DEL66