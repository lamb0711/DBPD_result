HDFS-8652. Track BlockInfo instead of Block in CorruptReplicasMap. Contributed by Jing Zhao.

-import java.util.ArrayList;
-    for (int i = 0; i < replicas.size(); i++) {
+    for (ReplicaUnderConstruction replica : replicas) {
-      if (replicas.get(i).isAlive()) {
-        allLiveReplicasTriedAsPrimary =
-            (allLiveReplicasTriedAsPrimary &&
-                replicas.get(i).getChosenAsPrimary());
+      if (replica.isAlive()) {
+        allLiveReplicasTriedAsPrimary = allLiveReplicasTriedAsPrimary
+            && replica.getChosenAsPrimary();
-      for (int i = 0; i < replicas.size(); i++) {
-        replicas.get(i).setChosenAsPrimary(false);
+      for (ReplicaUnderConstruction replica : replicas) {
+        replica.setChosenAsPrimary(false);
-   * @throws IOException
-   *           if the state of the block (the generation stamp and the length)
-   *           has not been committed by the client or it does not have at
-   *           least a minimal number of replicas reported from data-nodes.
-    sb.append("{UCState=").append(blockUCState)
-      .append(", truncateBlock=" + truncateBlock)
+    sb.append("{UCState=").append(blockUCState).append(", truncateBlock=")
+      .append(truncateBlock)

INS70 INS44 INS42 INS8 INS32 INS43 INS42 MOV25 INS70 MOV32 INS42 INS45 INS42 INS44 INS42 INS8 INS42 UPD42 MOV42 INS43 INS42 MOV21 INS45 INS42 INS42 INS27 UPD42 MOV42 INS45 MOV42 MOV32 UPD42 MOV42 DEL40 DEL26 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL27 DEL36 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL42 DEL42 DEL32 DEL27 DEL42 DEL37 DEL8 DEL24 DEL42 DEL42 DEL32 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL42 DEL42 DEL32 DEL27 DEL42 DEL37 DEL8 DEL24 DEL42 DEL66 DEL66 DEL66 DEL65 DEL45 DEL42 DEL27 DEL45 DEL42 DEL45