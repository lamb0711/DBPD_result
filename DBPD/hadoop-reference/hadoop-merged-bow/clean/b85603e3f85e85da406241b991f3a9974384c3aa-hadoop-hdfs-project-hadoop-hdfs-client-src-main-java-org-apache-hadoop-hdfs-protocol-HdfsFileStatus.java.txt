HDFS-12681. Fold HdfsLocatedFileStatus into HdfsFileStatus.

+import org.apache.hadoop.fs.LocatedFileStatus;
-/** Interface that represents the over the wire information for a file.
+/**
+ * HDFS metadata for an entity in the filesystem.
-public class HdfsFileStatus extends FileStatus {
+public final class HdfsFileStatus extends LocatedFileStatus {
+  // BlockLocations[] is the user-facing type
+  private transient LocatedBlocks hdfsloc;
+
-  /**
-   * Set of features potentially active on an instance.
-   */
+  /** Set of features potentially active on an instance. */
-  protected HdfsFileStatus(long length, boolean isdir, int replication,
+  private HdfsFileStatus(long length, boolean isdir, int replication,
-                         byte storagePolicy, ErasureCodingPolicy ecPolicy) {
+                         byte storagePolicy, ErasureCodingPolicy ecPolicy,
+                         LocatedBlocks hdfsloc) {
-        flags.contains(Flags.HAS_EC));
+        flags.contains(Flags.HAS_EC), null);
+    this.hdfsloc = hdfsloc;
-  public final boolean isEmptyLocalName() {
+  public boolean isEmptyLocalName() {
-  public final String getLocalName() {
+  public String getLocalName() {
-  public final byte[] getLocalNameInBytes() {
+  public byte[] getLocalNameInBytes() {
-  public final String getFullName(final String parent) {
+  public String getFullName(String parent) {
-  public final Path getFullPath(final Path parent) {
+  public Path getFullPath(Path parent) {
-  public final byte[] getSymlinkInBytes() {
+  public byte[] getSymlinkInBytes() {
-  public final long getFileId() {
+  public long getFileId() {
-  public final FileEncryptionInfo getFileEncryptionInfo() {
+  public FileEncryptionInfo getFileEncryptionInfo() {
-  public final int getChildrenNum() {
+  public int getChildrenNum() {
-  public final byte getStoragePolicy() {
+  public byte getStoragePolicy() {
+  public LocatedBlocks getLocatedBlocks() {
+    return hdfsloc;
+  }
+
-  public final FileStatus makeQualified(URI defaultUri, Path parent) {
+  public FileStatus makeQualified(URI defaultUri, Path parent) {
+  }
+  /**
+   * This function is used to transform the underlying HDFS LocatedBlocks to
+   * BlockLocations. This method must be invoked before
+   * {@link #getBlockLocations()}.
+   *
+   * The returned BlockLocation will have different formats for replicated
+   * and erasure coded file.
+   * Please refer to
+   * {@link org.apache.hadoop.fs.FileSystem#getFileBlockLocations
+   * (FileStatus, long, long)}
+   * for examples.
+   */
+  public LocatedFileStatus makeQualifiedLocated(URI defaultUri,
+                                                      Path path) {
+    makeQualified(defaultUri, path);
+    setBlockLocations(
+        DFSUtilClient.locatedBlocks2Locations(getLocatedBlocks()));
+    return this;
+    private LocatedBlocks locations        = null;
+     * Set the block locations for this entity (default = null).
+     * @param locations HDFS locations
+     *                  (see {@link #makeQualifiedLocated(URI, Path)})
+     * @return This Builder instance
+     */
+    public Builder locations(LocatedBlocks locations) {
+      this.locations = locations;
+      return this;
+    }
+
+    /**
-          childrenNum, feInfo, storagePolicy, ecPolicy);
+          childrenNum, feInfo, storagePolicy, ecPolicy, locations);

INS26 INS40 INS83 INS43 INS23 INS31 INS31 INS42 INS83 INS83 INS43 INS59 UPD83 INS44 INS44 INS83 INS43 INS42 INS8 INS29 INS83 INS43 INS42 INS44 MOV44 INS8 INS23 INS31 UPD66 INS42 INS42 INS43 INS42 INS21 INS43 INS42 INS42 INS41 INS65 INS42 INS43 INS42 UPD42 INS21 INS21 INS41 INS83 INS43 INS59 INS29 INS83 INS43 INS42 INS44 INS8 UPD66 INS42 INS33 INS7 INS42 INS42 INS66 INS66 INS65 INS66 INS66 INS66 INS66 INS65 INS66 INS42 INS32 INS32 INS52 INS42 INS42 INS33 INS65 INS65 INS65 INS42 INS43 INS42 INS21 INS41 INS22 INS42 INS68 INS68 INS42 INS42 INS42 INS42 INS32 INS66 INS42 INS66 INS66 INS65 INS66 INS66 INS42 INS7 INS52 INS52 INS42 INS42 INS40 INS42 INS69 INS69 INS69 INS42 INS42 INS32 INS68 INS22 INS42 INS42 MOV43 INS39 INS39 INS42 INS42 INS69 INS69 INS52 INS42 INS43 INS43 INS42 INS42 DEL83 DEL83 DEL83 DEL83 DEL83 DEL83 DEL83 DEL83 DEL83 DEL83 DEL83 DEL83 DEL83