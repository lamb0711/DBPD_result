HDFS-2361. hftp is broken, fixed username checks in JspHelper.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1176729 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.security.authentication.util.KerberosName;
-        checkUsername(ugi.getUserName(), user);
+        checkUsername(ugi.getShortUserName(), usernameFromQuery);
+        checkUsername(ugi.getShortUserName(), user);
+        checkUsername(ugi.getShortUserName(), usernameFromQuery);
-
-      checkUsername(user, usernameFromQuery);
-
+  /**
+   * Expected user name should be a short name.
+   */
-    if (name != null && !name.equals(expected)) {
-      throw new IOException("Usernames not matched: name=" + name
+    if (name == null) {
+      return;
+    }
+    KerberosName u = new KerberosName(name);
+    String shortName = u.getShortName();
+    if (!shortName.equals(expected)) {
+      throw new IOException("Usernames not matched: name=" + shortName

INS26 INS40 INS29 INS65 INS25 INS60 INS60 INS25 INS66 INS27 INS8 INS43 INS59 INS43 INS59 INS38 MOV8 MOV42 MOV33 INS41 INS42 INS42 INS14 INS42 INS42 INS32 MOV32 INS43 INS42 INS42 INS42 UPD42 INS21 INS21 INS42 INS32 INS32 UPD42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 UPD42 INS42 INS42 DEL42 DEL42 DEL42 DEL32 DEL21 DEL27 DEL38 DEL27 DEL25