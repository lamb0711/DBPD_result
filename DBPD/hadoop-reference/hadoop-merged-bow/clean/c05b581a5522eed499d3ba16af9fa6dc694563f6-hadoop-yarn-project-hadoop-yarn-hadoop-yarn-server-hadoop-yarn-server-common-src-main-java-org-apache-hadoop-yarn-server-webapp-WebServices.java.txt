YARN-2591. Fixed AHSWebServices to return FORBIDDEN(403) if the request user doesn't have access to the history data. Contributed by Zhijie Shen

+import java.lang.reflect.UndeclaredThrowableException;
+import org.apache.hadoop.security.authorize.AuthorizationException;
+import org.apache.hadoop.yarn.webapp.ForbiddenException;
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
-      throw new WebApplicationException(e);
+      rewrapAndThrowException(e);
+  private static void rewrapAndThrowException(Exception e) {
+    if (e instanceof UndeclaredThrowableException) {
+      if (e.getCause() instanceof AuthorizationException) {
+        throw new ForbiddenException(e.getCause());
+      } else {
+        throw new WebApplicationException(e.getCause());
+      }
+    } else {
+      if (e instanceof AuthorizationException) {
+        throw new ForbiddenException(e);
+      } else {
+        throw new WebApplicationException(e);
+      }
+    }
+  }
+

INS26 INS26 INS26 INS40 INS40 INS40 INS31 INS83 INS83 INS39 INS42 INS44 INS8 INS43 INS42 INS25 INS42 INS62 INS8 INS8 INS8 INS42 INS43 INS25 INS25 INS21 INS21 INS21 INS21 INS21 INS21 INS42 INS62 INS8 INS8 INS62 INS8 MOV8 INS32 INS32 INS32 INS32 INS32 INS32 INS32 INS43 INS53 INS53 INS42 INS43 INS53 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS14 INS14 INS42 INS14 INS43 INS32 INS43 INS32 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL42 DEL43 DEL42 DEL14 DEL53 DEL42 DEL43 DEL42 DEL14 DEL53 DEL42 DEL43 DEL42 DEL14 DEL53 DEL42 DEL43 DEL42 DEL14 DEL53 DEL42 DEL43 DEL42 DEL14 DEL53