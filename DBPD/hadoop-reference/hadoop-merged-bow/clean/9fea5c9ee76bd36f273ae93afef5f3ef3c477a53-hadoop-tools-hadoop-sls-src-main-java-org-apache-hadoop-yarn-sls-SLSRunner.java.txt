YARN-8175. Add support for Node Labels in SLS. Contributed by Abhishek Modi.

+import org.apache.hadoop.yarn.api.records.NodeLabel;
-    Map<String, Resource> nodeResourceMap = new HashMap<>();
-    Set<? extends  String> nodeSet;
+    Set<NodeDetails> nodeSet = null;
-          for (String node : nodeSet) {
-            nodeResourceMap.put(node, null);
-          }
-          for (String node : nodeSet) {
-            nodeResourceMap.put(node, null);
-          }
-          for (String node : nodeSet) {
-            nodeResourceMap.put(node, null);
-          }
-      nodeResourceMap = SLSUtils.parseNodesFromNodeFile(nodeFile,
+      nodeSet = SLSUtils.parseNodesFromNodeFile(nodeFile,
-    if (nodeResourceMap.size() == 0) {
+    if (nodeSet == null || nodeSet.isEmpty()) {
-    for (Map.Entry<String, Resource> entry : nodeResourceMap.entrySet()) {
+    for (NodeDetails nodeDetails : nodeSet) {
-            String hostName = entry.getKey();
-            if (entry.getValue() != null) {
-              nmResource = entry.getValue();
+            String hostName = nodeDetails.getHostname();
+            if (nodeDetails.getNodeResource() != null) {
+              nmResource = nodeDetails.getNodeResource();
+            Set<NodeLabel> nodeLabels = nodeDetails.getLabels();
-                heartbeatInterval, rm, resourceUtilizationRatio);
+                heartbeatInterval, rm, resourceUtilizationRatio, nodeLabels);
+    String jobLabelExpr = null;
+    if (jsonJob.containsKey(SLSConfiguration.JOB_LABEL_EXPR)) {
+      jobLabelExpr = jsonJob.get(SLSConfiguration.JOB_LABEL_EXPR).toString();
+    }
+
-          getTaskContainers(jsonJob), getAMContainerResource(jsonJob));
+          getTaskContainers(jsonJob), getAMContainerResource(jsonJob),
+          jobLabelExpr);
-          job.getDeadline(), getAMContainerResource(null),
+          job.getDeadline(), getAMContainerResource(null), null,
-        amContainerResource, null);
+        amContainerResource, null, null);
-      ReservationId reservationId, long deadline, Resource amContainerResource,
-      Map<String, String> params) {
+      Resource amContainerResource, String labelExpr) {
+    runNewAM(jobType, user, jobQueue, oldJobId, jobStartTimeMS,
+        jobFinishTimeMS, containerList, null,  -1,
+        amContainerResource, labelExpr, null);
+  }
+  @SuppressWarnings("checkstyle:parameternumber")
+  private void runNewAM(String jobType, String user,
+      String jobQueue, String oldJobId, long jobStartTimeMS,
+      long jobFinishTimeMS, List<ContainerSimulator> containerList,
+      ReservationId reservationId, long deadline, Resource amContainerResource,
+      String labelExpr, Map<String, String> params) {
-          runner.getStartTimeMS(), amContainerResource, params);
+          runner.getStartTimeMS(), amContainerResource, labelExpr, params);
+  /**
+   * Class to encapsulate all details about the node.
+   */
+  @Private
+  @Unstable
+  public static class NodeDetails {
+    private String hostname;
+    private Resource nodeResource;
+    private Set<NodeLabel> labels;
+
+    public NodeDetails(String nodeHostname) {
+      this.hostname = nodeHostname;
+    }
+
+    public String getHostname() {
+      return hostname;
+    }
+
+    public void setHostname(String hostname) {
+      this.hostname = hostname;
+    }
+
+    public Resource getNodeResource() {
+      return nodeResource;
+    }
+
+    public void setNodeResource(Resource nodeResource) {
+      this.nodeResource = nodeResource;
+    }
+
+    public Set<NodeLabel> getLabels() {
+      return labels;
+    }
+
+    public void setLabels(Set<NodeLabel> labels) {
+      this.labels = labels;
+    }
+  }

INS26 INS40 INS31 INS55 INS83 INS39 INS42 INS44 INS44 INS44 INS44 INS44 INS44 INS44 INS44 MOV44 INS8 INS79 MOV44 INS29 INS78 INS78 INS83 INS83 INS42 INS23 INS23 INS23 INS31 INS31 INS31 INS31 INS31 INS31 INS31 INS60 INS25 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS39 INS42 INS39 INS42 INS74 INS42 INS43 INS42 UPD42 INS21 INS42 INS45 UPD42 INS65 INS42 INS42 INS83 MOV43 INS59 INS83 MOV43 INS59 INS83 INS74 INS59 INS83 INS42 INS44 INS8 INS83 MOV43 INS42 INS8 INS83 INS39 INS42 INS44 INS8 INS83 MOV43 INS42 INS8 INS83 INS39 INS42 INS44 INS8 INS83 INS74 INS42 INS8 INS83 INS39 INS42 INS44 INS8 UPD74 UPD27 INS42 MOV43 INS59 INS32 INS8 INS42 INS42 INS42 INS42 INS43 INS43 INS42 INS32 INS66 INS42 INS42 INS43 INS43 INS42 MOV43 INS42 INS21 INS41 INS43 INS42 INS21 INS41 INS43 INS42 INS21 INS43 INS43 INS41 INS74 INS42 INS21 MOV43 UPD43 UPD42 INS33 INS27 INS43 UPD42 INS42 INS33 INS42 INS42 INS40 INS21 INS33 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS33 INS38 INS42 INS42 INS33 INS42 INS42 INS7 INS42 INS42 INS7 INS42 INS42 INS7 INS42 INS42 INS42 INS43 INS43 INS7 UPD42 INS42 INS33 UPD42 UPD42 INS42 INS7 INS34 INS22 INS42 INS22 INS42 INS22 INS42 INS42 INS42 INS22 INS42 UPD42 INS42 INS32 INS42 INS33 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS32 INS42 INS42 INS42 INS40 INS60 INS74 INS59 INS43 INS43 INS42 INS32 INS42 UPD42 UPD42 UPD42 UPD42 INS42 INS42 INS42 INS42 UPD42 UPD42 DEL42 DEL43 DEL74 DEL14 DEL76 DEL74 DEL42 DEL59 DEL60 DEL42 DEL42 DEL42 DEL42 DEL33 DEL32 DEL21 DEL8 DEL70 DEL42 DEL42 DEL42 DEL42 DEL33 DEL32 DEL21 DEL8 DEL70 DEL42 DEL44 DEL42 DEL42 DEL42 DEL42 DEL33 DEL32 DEL21 DEL8 DEL70 DEL34 DEL40 DEL43 DEL74 DEL42 DEL42 DEL32