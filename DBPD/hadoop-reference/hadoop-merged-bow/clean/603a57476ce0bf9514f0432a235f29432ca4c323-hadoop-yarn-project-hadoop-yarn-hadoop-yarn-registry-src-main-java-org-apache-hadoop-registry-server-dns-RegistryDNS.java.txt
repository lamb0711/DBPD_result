YARN-8600. RegistryDNS hang when remote lookup does not reply. Contributed by Eric Yang

+import java.util.concurrent.ExecutionException;
+import java.util.concurrent.Executors;
+import java.util.concurrent.Future;
+import java.util.concurrent.TimeoutException;
-  private void serveNIOUDP(DatagramChannel channel,
+  private synchronized void serveNIOUDP(DatagramChannel channel,
+    Record[] result = null;
+    ExecutorService executor = Executors.newSingleThreadExecutor();
+    Future<Record[]> future = executor.submit(new LookupTask(name, type));
-      return new Lookup(name, type).run();
-    } catch (NullPointerException |
+      result = future.get(1500, TimeUnit.MILLISECONDS);
+      return result;
+    } catch (InterruptedException | ExecutionException |
+        TimeoutException | NullPointerException |
-      LOG.error("Fail to lookup: " + name, e);
+      LOG.warn("Failed to lookup: {} type: {}", name, Type.string(type), e);
+      return result;
+    } finally {
+      executor.shutdown();
-    return null;

INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS83 INS60 INS60 INS60 INS54 INS5 INS59 INS43 INS59 INS74 INS59 INS8 MOV12 INS8 INS43 INS85 INS42 INS33 INS42 INS42 INS32 INS43 INS5 INS42 INS32 INS21 INS41 INS21 INS42 INS42 INS42 INS42 INS43 INS85 INS42 INS42 MOV14 INS7 INS42 UPD84 INS41 INS32 INS42 UPD43 INS42 INS32 INS43 INS43 INS43 INS42 INS42 INS42 UPD42 INS42 INS42 INS34 INS40 INS42 INS42 INS42 UPD42 INS45 INS42 INS32 INS42 INS42 INS42 DEL45 DEL42 DEL27 DEL42 DEL32 DEL41 DEL8 DEL54 DEL33 DEL41