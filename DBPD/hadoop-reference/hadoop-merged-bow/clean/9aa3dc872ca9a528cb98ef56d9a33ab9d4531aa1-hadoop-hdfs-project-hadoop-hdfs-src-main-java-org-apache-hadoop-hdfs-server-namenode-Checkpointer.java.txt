HDFS-14158. Checkpointer ignores configured time period > 5 minutes

This closes #449

Signed-off-by: Akira Ajisaka <aajisaka@apache.org>

+import com.google.common.math.LongMath;
- * 
+ *
-    // Check the size of the edit log once every 5 minutes.
-    long periodMSec = 5 * 60;   // 5 minutes
-    if(checkpointConf.getPeriod() < periodMSec) {
-      periodMSec = checkpointConf.getPeriod();
-    }
-    periodMSec *= 1000;
+    // How often to check the size of the edit log (min of checkpointCheckPeriod and checkpointPeriod)
+    long periodMSec = checkpointConf.getCheckPeriod() * 1000;
+    // How often to checkpoint regardless of number of txns
+    long checkpointPeriodMSec = checkpointConf.getPeriod() * 1000;
+    long lastEditLogCheckTime =0;
-        if(now >= lastCheckpointTime + periodMSec) {
+        if(now >= lastCheckpointTime + checkpointPeriodMSec) {
-        } else {
+        } else if(now >= lastEditLogCheckTime + periodMSec) {
+          lastEditLogCheckTime = now;
+          lastEditLogCheckTime = now;
-        Thread.sleep(periodMSec);
+        Thread.sleep(LongMath.gcd(periodMSec, checkpointPeriodMSec));

INS26 INS40 INS60 INS60 INS39 INS59 INS39 INS59 INS42 UPD27 MOV27 INS42 INS34 INS32 UPD34 INS34 INS42 INS42 INS25 INS27 MOV8 INS21 INS32 UPD42 INS42 INS27 INS21 INS7 INS42 INS42 MOV42 INS42 INS42 INS42 INS7 INS42 INS42 INS42 INS42 DEL34 DEL42 DEL42 DEL42 DEL42 DEL32 DEL7 DEL21 DEL8 DEL25 DEL42 DEL34 DEL7 DEL21