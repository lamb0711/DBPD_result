HDFS-8999. Allow a file to be closed with COMMITTED but not yet COMPLETE blocks.

+import org.apache.hadoop.hdfs.server.common.HdfsServerConstants.BlockUCState;
+import org.apache.hadoop.ipc.RetriableException;
-      if (lastBlock != null && lastBlock.isComplete()
+      if (lastBlock != null) {
+        if (lastBlock.getBlockUCState() == BlockUCState.COMMITTED) {
+          throw new RetriableException(
+              new NotReplicatedYetException("append: lastBlock="
+                  + lastBlock + " of src=" + path
+                  + " is COMMITTED but not yet COMPLETE."));
+        } else if (lastBlock.isComplete()
-        throw new IOException("append: lastBlock=" + lastBlock + " of src="
-            + path + " is not sufficiently replicated yet.");
+          throw new IOException("append: lastBlock=" + lastBlock + " of src="
+              + path + " is not sufficiently replicated yet.");
+        }

INS26 INS26 INS40 INS40 INS25 MOV27 INS8 INS25 INS27 INS8 MOV25 INS32 INS40 INS53 INS42 INS42 INS14 MOV32 INS43 INS14 INS42 INS43 INS27 INS42 INS45 INS42 INS45 INS42 INS45 DEL27