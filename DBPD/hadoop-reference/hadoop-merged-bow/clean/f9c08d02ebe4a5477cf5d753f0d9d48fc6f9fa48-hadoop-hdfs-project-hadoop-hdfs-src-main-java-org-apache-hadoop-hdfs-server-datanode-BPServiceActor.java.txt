HDFS-5378. In CacheReport, don't send genstamp and length on the wire (Contributed by Colin Patrick McCabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-4949@1534334 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.List;
-import org.apache.hadoop.hdfs.server.protocol.CacheReport;
-    if (dn.getFSDataset().getCacheCapacity() == 0) {
+    if (dn.getFSDataset().getDnCacheCapacity() == 0) {
-      BlockListAsLongs blocks = dn.getFSDataset().getCacheReport(bpid);
+      List<Long> blockIds = dn.getFSDataset().getCacheReport(bpid);
-      cmd = bpNamenode.cacheReport(bpRegistration, bpid,
-          blocks.getBlockListAsLongs());
+      cmd = bpNamenode.cacheReport(bpRegistration, bpid, blockIds);
-      LOG.info("CacheReport of " + blocks.getNumberOfBlocks()
+      LOG.info("CacheReport of " + blockIds.size()
-    CacheReport[] cacheReport = { new CacheReport(
-        dn.getFSDataset().getCacheCapacity(),
-        dn.getFSDataset().getCacheUsed()) };
-    return bpNamenode.sendHeartbeat(bpRegistration, report, cacheReport,
+    return bpNamenode.sendHeartbeat(bpRegistration, report,
+        dn.getFSDataset().getDnCacheCapacity(),
+        dn.getFSDataset().getDnCacheUsed(),

MOV26 UPD40 MOV32 MOV32 UPD42 INS74 UPD42 UPD42 INS43 INS43 UPD42 UPD42 MOV42 INS42 UPD42 MOV42 UPD42 UPD42 DEL43 DEL42 DEL32 DEL42 DEL43 DEL85 DEL5 DEL42 DEL42 DEL43 DEL14 DEL4 DEL59 DEL60 DEL42