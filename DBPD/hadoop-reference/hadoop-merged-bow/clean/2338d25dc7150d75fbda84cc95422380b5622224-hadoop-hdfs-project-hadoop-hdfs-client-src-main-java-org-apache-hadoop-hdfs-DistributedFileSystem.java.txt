HDFS-15052. WebHDFS getTrashRoot leads to OOM due to FileSystem object creation. (#1758)



-    return makeQualified(DFSUtilClient.getHomeDirectory(getConf(), dfs.ugi));
+    return makeQualified(
+        new Path(DFSUtilClient.getHomeDirectory(getConf(), dfs.ugi)));
-            new Path(new Path(ez.getPath(), FileSystem.TRASH_PREFIX),
-                dfs.ugi.getShortUserName()));
+            new Path(DFSUtilClient.getEZTrashRoot(ez, dfs.ugi)));
-        Path ezTrashRoot = new Path(it.next().getPath(),
+        EncryptionZone ez = it.next();
+        Path ezTrashRoot = new Path(ez.getPath(),
-          Path userTrash = new Path(ezTrashRoot, dfs.ugi.getShortUserName());
+          Path userTrash = new Path(DFSUtilClient.getEZTrashRoot(ez, dfs.ugi));

MOV43 INS14 MOV43 MOV32 INS60 UPD43 MOV43 INS59 UPD42 UPD42 MOV32 INS42 MOV14 INS43 MOV43 INS42 INS42 INS42 INS42 MOV43 INS32 INS42 INS42 INS42 MOV40 DEL42 DEL42 DEL32 DEL40 DEL14 DEL42 DEL42 DEL32