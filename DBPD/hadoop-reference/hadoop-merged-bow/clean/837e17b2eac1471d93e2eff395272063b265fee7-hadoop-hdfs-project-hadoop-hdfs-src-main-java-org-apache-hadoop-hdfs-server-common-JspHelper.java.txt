svn merge -c -1430507 . for reverting HDFS-4353. Encapsulate connections to peers in Peer and PeerServer classes


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1430662 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.hdfs.net.TcpPeerServer;
-import org.apache.hadoop.hdfs.protocol.DatanodeID;
-          setPeer(TcpPeerServer.peerFromSocketAndKey(s, encryptionKey)).
+          setSocket(s).
+          setEncryptionKey(encryptionKey).
-          setBlock(new ExtendedBlock(poolId, blockId, 0, genStamp)).
-          setDatanodeID(new DatanodeID(addr.getAddress().toString(), 
-              addr.getHostName(), poolId, addr.getPort(), 0, 0)));
-    
+          setBlock(new ExtendedBlock(poolId, blockId, 0, genStamp)));
-    blockReader.close(null);
+    blockReader = null;
+    s.close();

INS21 INS7 MOV32 MOV32 INS42 INS33 UPD42 UPD42 UPD42 MOV42 INS32 MOV32 INS42 INS42 UPD42 MOV42 DEL40 DEL26 DEL40 DEL26 DEL42 DEL42 DEL42 DEL32 DEL42 DEL43 DEL42 DEL32 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL34 DEL34 DEL14 DEL42 DEL42 DEL32 DEL33