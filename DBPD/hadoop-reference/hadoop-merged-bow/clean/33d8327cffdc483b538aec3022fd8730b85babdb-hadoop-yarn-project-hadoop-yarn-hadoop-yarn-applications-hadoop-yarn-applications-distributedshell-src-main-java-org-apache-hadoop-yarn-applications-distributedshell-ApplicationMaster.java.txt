YARN-8715. Make allocation tags in the placement spec optional for node-attributes. Contributed by Weiwei Yang.

+import com.google.common.base.Strings;
-      parsePlacementSpecs(decodedSpec);
+      int globalNumOfContainers = Integer
+          .parseInt(cliParser.getOptionValue("num_containers", "0"));
+      parsePlacementSpecs(decodedSpec, globalNumOfContainers);
-  private void parsePlacementSpecs(String decodedSpec) {
+  private void parsePlacementSpecs(String decodedSpec,
+      int globalNumOfContainers) {
+      // Use global num of containers when the spec doesn't specify
+      // source tags. This is allowed when using node-attribute constraints.
+      if (Strings.isNullOrEmpty(pSpec.sourceTag)
+          && pSpec.getNumContainers() == 0
+          && globalNumOfContainers > 0) {
+        pSpec.setNumContainers(globalNumOfContainers);
+      }
-          placementConstraintMap.put(
-              Collections.singleton(spec.sourceTag), spec.constraint);
+          Set<String> allocationTags = Strings.isNullOrEmpty(spec.sourceTag) ?
+              Collections.emptySet() : Collections.singleton(spec.sourceTag);
+          placementConstraintMap.put(allocationTags, spec.constraint);

INS26 INS40 INS44 INS39 INS42 INS60 INS25 INS39 INS59 INS27 INS8 INS42 INS32 INS42 INS27 INS27 INS21 INS42 INS42 INS32 INS32 INS27 INS42 INS34 INS32 INS42 INS42 INS45 INS45 INS42 INS42 INS40 INS32 INS34 INS42 INS42 INS42 INS60 INS42 INS42 INS74 INS59 INS43 INS43 INS42 INS16 INS42 INS42 INS42 INS32 INS32 MOV32 INS42 INS42 INS40 INS42 INS42