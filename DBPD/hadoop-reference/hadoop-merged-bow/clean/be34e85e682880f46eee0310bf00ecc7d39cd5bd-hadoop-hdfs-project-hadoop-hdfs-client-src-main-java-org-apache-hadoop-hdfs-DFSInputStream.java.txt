HDFS-10468. HDFS read ends up ignoring an interrupt. Contributed by Jing Zhao

+import java.io.InterruptedIOException;
+import java.nio.channels.ClosedByInterruptException;
-      throw new IOException(
+      throw new InterruptedIOException(
+        checkInterrupted(ioe);
-          throw new IOException("Interrupted while getting the length.");
+          throw new InterruptedIOException(
+              "Interrupted while getting the length.");
+        checkInterrupted(ex);
+  private void checkInterrupted(IOException e) throws IOException {
+    if (Thread.currentThread().isInterrupted() &&
+        (e instanceof ClosedByInterruptException ||
+            e instanceof InterruptedIOException)) {
+      DFSClient.LOG.debug("The reading thread has been interrupted.", e);
+      throw e;
+    }
+  }
+
+          checkInterrupted(e);
-          DFSClient.LOG.warn("DFS chooseDataNode: got # " + (failures + 1) + " IOException, will wait for " + waitTime + " msec.");
+          DFSClient.LOG.warn("DFS chooseDataNode: got # " + (failures + 1) +
+              " IOException, will wait for " + waitTime + " msec.");
-        } catch (InterruptedException ignored) {
+        } catch (InterruptedException e) {
+          throw new InterruptedIOException(
+              "Interrupted while choosing DataNode for read.");
-        // Ignore. Already processed inside the function.
+        checkInterrupted(e); // check if the read has been interrupted
+        // Ignore other IOException. Already processed inside the function.
+        checkInterrupted(e);
-        } catch (InterruptedException | ExecutionException e) {
+        } catch (ExecutionException e) {
+        } catch (InterruptedException e) {
+          throw new InterruptedIOException(
+              "Interrupted while waiting for reading task");
+          checkInterrupted(e);

INS26 INS26 INS40 INS40 INS31 INS83 INS39 INS42 INS44 MOV43 INS8 INS43 INS42 INS25 INS42 INS27 INS8 INS32 INS36 INS21 INS53 INS32 INS42 INS27 INS32 INS42 INS42 INS42 INS62 INS62 INS40 INS42 INS45 INS42 UPD43 INS21 INS21 INS42 INS43 INS42 INS43 INS21 INS21 INS12 UPD42 INS32 INS32 INS42 INS42 INS32 INS32 INS44 INS8 INS42 INS42 INS42 INS42 INS21 UPD42 INS53 INS42 INS42 INS42 INS42 MOV43 INS42 INS43 INS53 INS21 INS32 INS14 MOV42 INS14 INS32 INS43 INS42 INS42 INS43 INS45 INS43 INS45 INS42 INS42 INS42 INS42 INS42 DEL43 DEL84