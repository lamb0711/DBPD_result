HDFS-7034. Archival Storage: Fix TestBlockPlacement and TestStorageMover. Contributed by Jing Zhao.

+import com.google.common.annotations.VisibleForTesting;
+import org.apache.hadoop.fs.FSDataOutputStream;
+import org.apache.hadoop.hdfs.DFSConfigKeys;
+  private static boolean createIdFile = true;
+  @VisibleForTesting
+  public static void setCreateIdFile(boolean create) {
+    createIdFile = create;
+  }
+
-    // Exit if there is another one running.
-    out = checkAndMarkRunning(); 
-    if (out == null) {
+    // if it is for test, we do not create the id file
+    out = createIdFile ? checkAndMarkRunning() : null;
+    if (createIdFile && out == null) {
+      // Exit if there is another one running.
-      final DataOutputStream out = fs.create(idPath);
+      final FSDataOutputStream out = fs.create(idPath);
-      out.flush();
+      out.hflush();

INS26 INS26 INS26 INS40 INS40 INS40 INS23 INS31 INS83 INS83 INS39 INS59 INS78 INS83 INS83 INS39 INS42 INS44 INS8 INS42 INS9 INS42 INS39 INS42 INS21 INS7 INS27 INS42 INS42 INS16 INS42 MOV27 INS42 MOV32 INS33 UPD43 UPD42 UPD42