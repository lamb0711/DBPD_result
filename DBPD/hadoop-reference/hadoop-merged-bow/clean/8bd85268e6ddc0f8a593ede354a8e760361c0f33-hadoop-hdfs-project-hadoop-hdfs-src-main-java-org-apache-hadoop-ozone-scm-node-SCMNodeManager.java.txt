HDFS-11081. Ozone:SCM: Add support for registerNode in datanode. Contributed by Anu Engineer.

-import org.apache.hadoop.ozone.protocol.proto.StorageContainerDatanodeProtocolProtos.RegisteredCmdResponseProto.ErrorCode;
-import org.apache.hadoop.ozone.protocol.proto.StorageContainerDatanodeProtocolProtos.SCMVersionRequestProto;
+import org.apache.hadoop.ozone.protocol.proto
+    .StorageContainerDatanodeProtocolProtos.SCMRegisteredCmdResponseProto
+    .ErrorCode;
+import org.apache.hadoop.ozone.protocol.proto
+    .StorageContainerDatanodeProtocolProtos.SCMVersionRequestProto;
-import java.util.UUID;
-    SCMCommand errorCode = verifyDatanodeUUID(datanodeID);
-    if (errorCode != null) {
-      return errorCode;
+    SCMCommand responseCommand = verifyDatanodeUUID(datanodeID);
+    if (responseCommand != null) {
+      return responseCommand;
-    DatanodeID newDatanodeID = new DatanodeID(UUID.randomUUID().toString(),
-        datanodeID);
-    nodes.put(newDatanodeID.getDatanodeUuid(), newDatanodeID);
+
+    nodes.put(datanodeID.getDatanodeUuid(), datanodeID);
-    healthyNodes.put(newDatanodeID.getDatanodeUuid(), monotonicNow());
+    healthyNodes.put(datanodeID.getDatanodeUuid(), monotonicNow());
-        newDatanodeID.getDatanodeUuid());
+        datanodeID.getDatanodeUuid());
-        .setDatanodeUUID(newDatanodeID.getDatanodeUuid())
+        .setDatanodeUUID(datanodeID.getDatanodeUuid())
-    // Make sure that we return the right error code, so that
-    // data node can log the correct error. if it is already registered then
-    // datanode should move to heartbeat state. It implies that somehow we
-    // have an error where the data node is trying to re-register.
-    //
-    // We are going to let the datanode know that there is an error but allow it
-    // to recover by sending it the right info that is needed for recovery.
-
-      LOG.error("Datanode is already registered. Datanode: {}",
+      LOG.trace("Datanode is already registered. Datanode: {}",
-          .setErrorCode(ErrorCode.errorNodeAlreadyRegistered)
+          .setErrorCode(ErrorCode.success)

UPD40 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD40 DEL40 DEL26 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL42 DEL32 DEL42 DEL32 DEL42 DEL14 DEL59 DEL60