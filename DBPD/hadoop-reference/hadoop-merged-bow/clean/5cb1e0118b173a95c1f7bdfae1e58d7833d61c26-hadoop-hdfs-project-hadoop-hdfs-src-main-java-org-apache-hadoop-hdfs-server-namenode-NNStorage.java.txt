HDFS-9533. seen_txid in the shared edits directory is modified during bootstrapping. Contributed by Kihwal Lee.

+    writeTransactionIdFileToStorage(txid, null);
+  }
+
+  /**
+   * Write a small file in all available storage directories that
+   * indicates that the namespace has reached some given transaction ID.
+   *
+   * This is used when the image is loaded to avoid accidental rollbacks
+   * in the case where an edit log is fully deleted but there is no
+   * checkpoint. See TestNameEditsConfigs.testNameEditsConfigsFailure()
+   * @param txid the txid that has been reached
+   * @param type the type of directory
+   */
+  public void writeTransactionIdFileToStorage(long txid,
+      NameNodeDirType type) {
-    for (StorageDirectory sd : storageDirs) {
+    for (Iterator<StorageDirectory> it = dirIterator(type); it.hasNext();) {
+      StorageDirectory sd = it.next();

INS31 MOV29 INS83 INS39 INS42 INS44 INS8 INS29 INS44 INS39 INS42 INS21 INS65 INS65 INS65 INS43 INS42 INS24 INS32 INS66 INS66 INS66 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS58 INS32 MOV8 INS42 INS42 INS33 INS74 INS59 INS42 INS42 INS60 INS43 INS43 INS42 INS32 MOV43 INS59 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 DEL42 DEL44 DEL42 DEL70