HDFS-6995. Block should be placed in the client's 'rack-local' node if 'client-local' node is not available (vinayakumarb)

-      
-    if (!clusterMap.contains(writer)) {
-      writer = null;
-    }
-      
+
-    return getPipeline((writer==null)?localNode:writer,
-                       results.toArray(new DatanodeStorageInfo[results.size()]));
+    return getPipeline(
+        (writer != null && writer instanceof DatanodeDescriptor) ? writer
+            : localNode,
+        results.toArray(new DatanodeStorageInfo[results.size()]));
-      return writer;
+      return (writer instanceof DatanodeDescriptor) ? writer : null;

INS36 INS42 INS16 INS27 INS36 INS42 INS33 INS27 INS62 INS62 MOV42 MOV33 INS42 INS43 INS42 INS43 INS42 INS42 DEL42 DEL42 DEL42 DEL32 DEL38 DEL42 DEL33 DEL7 DEL21 DEL8 DEL25 DEL27 DEL36 DEL42 DEL42