Merge trunk into HDFS-3077 branch.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3077@1377092 13f79535-47bb-0310-9956-ffa450edef68

-    while (len > 0) {
-      long ret = in.skip(len);
-      if (ret < 0) {
-        throw new IOException( "Premature EOF from inputStream");
+    long amt = len;
+    while (amt > 0) {
+      long ret = in.skip(amt);
+      if (ret == 0) {
+        // skip may return 0 even if we're not at EOF.  Luckily, we can 
+        // use the read() method to figure out if we're at the end.
+        int b = in.read();
+        if (b == -1) {
+          throw new EOFException( "Premature EOF from inputStream after " +
+              "skipping " + (len - amt) + " byte(s).");
+        }
+        ret = 1;
-      len -= ret;
+      amt -= ret;

INS60 INS39 INS59 INS42 INS42 UPD42 UPD27 INS8 INS60 INS25 INS21 UPD42 UPD42 INS39 INS59 INS27 MOV8 INS7 INS42 INS32 INS42 INS38 INS42 INS34 INS42 INS42 INS34 UPD43 INS27 UPD42 INS27 INS36 INS45 INS45 INS45 INS27 INS42 INS42 DEL45