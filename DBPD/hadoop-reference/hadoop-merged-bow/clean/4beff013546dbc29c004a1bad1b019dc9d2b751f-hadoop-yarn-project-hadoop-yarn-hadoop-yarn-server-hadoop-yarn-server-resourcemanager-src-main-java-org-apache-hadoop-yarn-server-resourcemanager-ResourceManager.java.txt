YARN-4983. JVM and UGI metrics disappear after RM transitioned to standby mode

+import org.apache.hadoop.metrics2.MetricsSystem;
-  private JvmPauseMonitor pauseMonitor;
+  private JvmMetrics jvmMetrics;
-    createAndInitActiveServices();
+    createAndInitActiveServices(false);
+    private boolean fromActive = false;
-      DefaultMetricsSystem.initialize("ResourceManager");
-      JvmMetrics jm = JvmMetrics.initSingleton("ResourceManager", null);
-      pauseMonitor = new JvmPauseMonitor();
+      MetricsSystem ms = DefaultMetricsSystem.initialize("ResourceManager");
+      if (fromActive) {
+        JvmMetrics.reattach(ms, jvmMetrics);
+        UserGroupInformation.reattachMetrics();
+      } else {
+        jvmMetrics = JvmMetrics.initSingleton("ResourceManager", null);
+      }
+
+      JvmPauseMonitor pauseMonitor = new JvmPauseMonitor();
-      jm.setPauseMonitor(pauseMonitor);
+      jvmMetrics.setPauseMonitor(pauseMonitor);
+   *
+   * @param fromActive Indicates if the call is from the active state transition
+   *                   or the RM initialization.
-  protected void createAndInitActiveServices() {
+  protected void createAndInitActiveServices(boolean fromActive) {
+    activeServices.fromActive = fromActive;
-      createAndInitActiveServices();
+      createAndInitActiveServices(true);

INS26 INS40 MOV43 INS23 INS44 UPD42 INS83 INS39 INS59 INS65 INS39 INS42 INS21 INS42 INS9 INS25 INS60 INS42 INS66 INS66 INS7 INS9 INS43 INS42 INS8 INS8 MOV43 INS59 INS40 INS42 INS42 UPD42 MOV32 INS21 INS21 MOV21 INS42 MOV14 UPD42 INS32 INS32 INS9 INS42 INS42 INS42 INS42 INS42 INS42 UPD42 MOV32 DEL21