HDFS-11550. Ozone: Add a check to prevent removing a container that has keys in it. Contributed by Weiwei Yang.

+import org.apache.hadoop.conf.Configuration;
-   * Returns a file handle to LevelDB.
+   * Get a DB handler for a given container.
+   * If the handler doesn't exist in cache yet, first create one and
+   * add into cache. This function is called with containerManager
+   * ReadLock held.
-   * @param dbPath - DbPath.
-   * @return LevelDB
-   */
-  public static LevelDBStore getDB(String dbPath) throws IOException {
-    Preconditions.checkNotNull(dbPath);
-    Preconditions.checkState(!dbPath.isEmpty());
-    return new LevelDBStore(new File(dbPath), false);
-  }
-
-  /**
-   * This function is called with  containerManager ReadLock held.
-   *
-   * @param container - container.
-   * @param cache     - cache
+   * @param container container.
+   * @param conf configuration.
-                                   ContainerCache cache)
-      throws StorageContainerException {
+      Configuration conf) throws StorageContainerException {
+    ContainerCache cache = ContainerCache.getInstance(conf);
-        db = getDB(container.getDBPath());
+        db = new LevelDBStore(
+            new File(container.getDBPath()),
+            false);
+   * Remove a DB handler from cache.
+   *
+   * @param container - Container data.
+   * @param conf - Configuration.
+   */
+  public static void removeDB(ContainerData container,
+      Configuration conf) {
+    Preconditions.checkNotNull(container);
+    ContainerCache cache = ContainerCache.getInstance(conf);
+    Preconditions.checkNotNull(cache);
+    cache.removeDB(container.getContainerName());
+  }
+  /**

INS26 MOV31 INS40 INS39 INS42 INS44 INS8 INS43 UPD42 INS60 UPD65 INS43 INS42 UPD43 UPD42 INS21 INS60 MOV21 MOV21 INS66 INS66 UPD66 INS66 UPD66 UPD42 UPD66 INS42 MOV43 INS59 UPD66 UPD42 UPD66 INS42 UPD66 UPD42 MOV42 UPD42 INS32 INS43 INS59 INS42 INS32 INS42 INS42 INS42 UPD42 MOV42 INS42 INS32 UPD42 UPD42 UPD42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 UPD42 MOV42 UPD42 MOV42 MOV14 MOV32 DEL42 DEL42 DEL32 DEL43 DEL42 DEL32 DEL38 DEL43 DEL41 DEL8