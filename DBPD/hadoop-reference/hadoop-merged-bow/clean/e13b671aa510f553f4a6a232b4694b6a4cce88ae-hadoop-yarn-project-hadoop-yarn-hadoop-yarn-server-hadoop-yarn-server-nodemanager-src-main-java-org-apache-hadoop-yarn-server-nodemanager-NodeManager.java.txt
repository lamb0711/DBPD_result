YARN-3585. NodeManager cannot exit on SHUTDOWN event triggered and NM recovery is enabled. Contributed by Rohith Sharmaks

+import org.apache.hadoop.util.ExitUtil;
+  private boolean shouldExitOnShutdownEvent = false;
-        NodeManager.this.stop();
+        try {
+          NodeManager.this.stop();
+        } catch (Throwable t) {
+          LOG.error("Error while shutting down NodeManager", t);
+        } finally {
+          if (shouldExitOnShutdownEvent
+              && !ShutdownHookManager.get().isShutdownInProgress()) {
+            ExitUtil.terminate(-1);
+          }
+        }
-
+      // System exit should be called only when NodeManager is instantiated from
+      // main() funtion
+      this.shouldExitOnShutdownEvent = true;

INS26 INS40 INS23 INS83 INS39 INS59 INS42 INS9 INS21 INS7 INS22 INS9 INS8 INS52 INS42 INS54 MOV8 INS12 INS8 INS44 INS8 INS25 INS43 INS42 INS21 INS27 INS8 INS42 INS32 INS42 INS38 INS21 INS42 INS42 INS45 INS42 INS32 INS32 INS32 INS42 INS42 INS42 INS38 INS42 INS42 INS34