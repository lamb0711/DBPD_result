HDFS-9412. getBlocks occupies FSLock and takes too long to complete. Contributed by He Tianyi.

+
+  /**
+   * Minimum size that a block can be sent to Balancer through getBlocks.
+   * And after HDFS-8824, the small blocks are unused anyway, so there's no
+   * point to send them to balancer.
+   */
+  private long getBlocksMinBlockSize = -1;
+
+    this.getBlocksMinBlockSize = conf.getLongBytes(
+        DFSConfigKeys.DFS_BALANCER_GETBLOCKS_MIN_BLOCK_SIZE_KEY,
+        DFSConfigKeys.DFS_BALANCER_GETBLOCKS_MIN_BLOCK_SIZE_DEFAULT);
+      if (curBlock.getNumBytes() < getBlocksMinBlockSize) {
+        continue;
+      }
+        if (curBlock.getNumBytes() < getBlocksMinBlockSize) {
+          continue;
+        }

INS23 INS29 INS83 INS39 INS59 INS65 INS42 INS38 INS21 INS66 INS66 INS66 INS34 INS7 INS22 INS32 INS25 MOV21 INS52 INS42 INS42 INS42 INS40 INS40 INS27 INS8 INS32 INS42 INS18 INS25 MOV21 INS42 INS42 INS42 INS42 INS27 INS8 INS32 INS42 INS18 MOV42 UPD42 MOV42