YARN-9147. Rmove auxiliary services when manifest file is removed.
           Contributed by Billie Rinaldi

+import com.google.common.annotations.VisibleForTesting;
+      LOG.info("Removing aux service " + sName);
-  private synchronized void loadManifest(Configuration conf, boolean
+  @VisibleForTesting
+  protected synchronized void loadManifest(Configuration conf, boolean
+    if (manifest == null) {
+      return;
+    }
+    if (!manifestFS.exists(manifest)) {
+      if (serviceMap.isEmpty()) {
+        return;
+      }
+      LOG.info("Manifest file " + manifest + " doesn't exist, stopping " +
+          "auxiliary services");
+      Set<String> servicesToRemove = new HashSet<>(serviceMap.keySet());
+      for (String sName : servicesToRemove) {
+        maybeRemoveAuxService(sName);
+      }
+      return;
+    }
-    List<String> servicesToRemove = new ArrayList<>();
-    for (String sName : serviceMap.keySet()) {
-      if (!loadedAuxServices.contains(sName)) {
-        foundChanges = true;
-        servicesToRemove.add(sName);
-      }
-    }
+    Set<String> servicesToRemove = new HashSet<>(serviceMap.keySet());
+    servicesToRemove.removeAll(loadedAuxServices);
-      LOG.info("Removing aux service " + sName);
+      foundChanges = true;

INS26 INS40 INS78 UPD83 INS42 INS25 INS25 INS60 INS21 INS27 INS8 INS38 INS8 UPD74 MOV74 INS59 INS32 INS42 MOV8 INS21 INS42 INS33 INS41 INS32 INS25 MOV21 INS60 INS70 INS41 UPD43 INS42 INS14 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS8 INS74 INS59 MOV44 INS42 INS8 UPD42 INS74 MOV32 INS42 INS42 INS27 INS42 INS42 INS41 INS43 INS43 INS42 INS14 MOV21 INS43 UPD42 INS45 INS42 UPD45 UPD42 INS45 INS45 INS42 INS42 INS74 INS32 INS42 INS43 INS42 INS42 INS42 DEL42 DEL42 DEL43 DEL74 DEL14 DEL59 DEL60 DEL42 DEL42 DEL42 DEL42 DEL32 DEL38 DEL25 DEL8 DEL42 DEL8 DEL70