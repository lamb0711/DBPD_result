HADOOP-7806. Support binding to sub-interfaces. Contributed by Eli Collins


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1298700 13f79535-47bb-0310-9956-ffa450edef68

+   * @return NetworkInterface for the given subinterface name (eg eth0:0)
+   *    or null if no interface with the given name can be found  
+   */
+  private static NetworkInterface getSubinterface(String strInterface)
+      throws SocketException {
+    Enumeration<NetworkInterface> nifs = 
+      NetworkInterface.getNetworkInterfaces();
+      
+    while (nifs.hasMoreElements()) {
+      Enumeration<NetworkInterface> subNifs = 
+        nifs.nextElement().getSubInterfaces();
+
+      while (subNifs.hasMoreElements()) {
+        NetworkInterface nif = subNifs.nextElement();
+        if (nif.getName().equals(strInterface)) {
+          return nif;
+        }
+      }
+    }
+    return null;
+  }
+
+  /**
-   *            The name of the network interface to query (e.g. eth0)
-   *            or the string "default"
+   *            The name of the network interface or sub-interface to query
+   *            (eg eth0 or eth0:0) or the string "default"
-    NetworkInterface netIF;
+    NetworkInterface netIf;
-      netIF = NetworkInterface.getByName(strInterface);
+      netIf = NetworkInterface.getByName(strInterface);
+      if (netIf == null) {
+        netIf = getSubinterface(strInterface);
+      }
-    if (netIF == null) {
+    if (netIf == null) {
-    Enumeration<InetAddress> e = netIF.getInetAddresses();
-    while (e.hasMoreElements()) {
-      ips.add(e.nextElement().getHostAddress());
+    Enumeration<InetAddress> addrs = netIf.getInetAddresses();
+    while (addrs.hasMoreElements()) {
+      ips.add(addrs.nextElement().getHostAddress());
-   *            The name of the network interface to query (e.g. eth0)
-   *            or the string "default"
+   *            The name of the network interface or subinterface to query
+   *             (e.g. eth0 or eth0:0) or the string "default"
-   *            The name of the network interface to query (e.g. eth0)
+   *            The name of the network interface or subinterface to query
+   *            (e.g. eth0 or eth0:0)

INS31 INS29 INS83 INS83 INS43 INS42 INS44 INS43 INS8 INS65 INS42 INS43 INS42 INS42 INS60 INS61 INS41 INS66 INS66 INS42 INS74 INS59 INS32 INS8 INS33 UPD66 UPD66 INS43 UPD66 UPD66 UPD66 INS66 INS43 INS43 INS42 INS32 INS42 INS42 INS60 INS61 INS42 UPD42 INS25 UPD42 UPD42 UPD42 INS42 INS42 INS42 INS42 INS74 INS59 INS32 INS8 INS27 INS8 UPD42 INS43 INS43 INS42 INS32 INS42 INS42 INS60 INS25 UPD42 INS42 INS33 INS21 INS42 INS42 INS32 INS42 MOV43 INS59 INS32 INS8 INS7 INS42 INS42 INS42 INS32 INS32 INS42 INS42 INS41 INS42 INS32 UPD42 INS42 INS42 INS42 INS42 INS42 INS42 INS42