Merge r1569890 through r1571553 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1571554 13f79535-47bb-0310-9956-ffa450edef68

+    // call refreshAdminAcls before HA state transition
+    // for the case that adminAcls have been updated in previous active RM
+    try {
+      refreshAdminAcls(false);
+    } catch (YarnException ex) {
+      throw new ServiceFailedException("Can not execute refreshAdminAcls", ex);
+    }
+
+      // call all refresh*s for active RM to get the updated configurations.
+      refreshAll();
+    // call refreshAdminAcls before HA state transition
+    // for the case that adminAcls have been updated in previous active RM
+    try {
+      refreshAdminAcls(false);
+    } catch (YarnException ex) {
+      throw new ServiceFailedException("Can not execute refreshAdminAcls", ex);
+    }
+    return refreshAdminAcls(true);
+  }
+
+  private RefreshAdminAclsResponse refreshAdminAcls(boolean checkRMHAState)
+      throws YarnException, IOException {
-    
-    if (!isRMActive()) {
+
+    if (checkRMHAState && !isRMActive()) {
+  private void refreshAll() throws ServiceFailedException {
+    try {
+      refreshQueues(RefreshQueuesRequest.newInstance());
+      refreshNodes(RefreshNodesRequest.newInstance());
+      refreshSuperUserGroupsConfiguration(
+          RefreshSuperUserGroupsConfigurationRequest.newInstance());
+      refreshUserToGroupsMappings(
+          RefreshUserToGroupsMappingsRequest.newInstance());
+      if (getConfig().getBoolean(
+          CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHORIZATION,
+          false)) {
+        refreshServiceAcls(RefreshServiceAclsRequest.newInstance());
+      }
+    } catch (Exception ex) {
+      throw new ServiceFailedException(ex.getMessage());
+    }
+  }
+

INS31 INS31 MOV78 INS83 INS43 INS42 MOV44 INS43 INS43 INS8 UPD83 INS44 INS83 INS39 INS42 INS43 INS8 INS54 INS54 INS42 INS42 INS42 INS41 INS39 INS42 INS42 INS54 INS8 INS12 INS8 INS12 INS32 INS27 INS8 INS12 INS21 INS44 INS8 INS21 INS21 INS44 INS8 INS42 INS9 INS42 MOV38 INS21 INS21 INS21 INS21 INS25 INS44 INS8 INS32 INS43 INS42 INS53 INS32 INS32 INS43 INS42 INS53 INS32 INS32 INS32 INS32 INS32 INS8 INS43 INS42 INS53 INS42 INS9 INS42 INS14 INS42 INS42 INS9 INS42 INS14 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS32 INS32 INS42 INS40 INS9 INS21 INS42 INS14 INS43 INS45 INS42 INS43 INS45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS43 INS32 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42