Revert "HDFS-9820. Improve distcp to support efficient restore to an earlier snapshot. Contributed by Yongjun Zhang."

This reverts commit 412c4c9a342b73bf1c1a7f43ea91245cbf94d02d.

-import org.apache.commons.lang.StringUtils;
-  // When "-diff s1 s2 src tgt" is passed, apply forward snapshot diff (from s1
-  // to s2) of source cluster to the target cluster to sync target cluster with
-  // the source cluster. Referred to as "Fdiff" in the code.
-  // It's required that s2 is newer than s1.
-  // When "-rdiff s2 s1 src tgt" is passed, apply reversed snapshot diff (from
-  // s2 to s1) of target cluster to the target cluster, so to make target
-  // cluster go back to s1. Referred to as "Rdiff" in the code.
-  // It's required that s2 is newer than s1, and src and tgt have exact same
-  // content at their s1, if src is not the same as tgt.
-  private boolean useRdiff = false;
-
-  // For both -diff and -rdiff, given the example command line switches, two
-  // steps are taken:
-  //   1. Sync Step. This step does renaming/deletion ops in the snapshot diff,
-  //      so to avoid copying files copied already but renamed later(HDFS-7535)
-  //   2. Copy Step. This step copy the necessary files from src to tgt
-  //      2.1 For -diff, it copies from snapshot s2 of src (HDFS-8828)
-  //      2.2 For -rdiff, it copies from snapshot s1 of src, where the src
-  //          could be the tgt itself (HDFS-9820).
-  //
-
-      this.useDiff = that.useDiff;
-      this.useRdiff = that.useRdiff;
-  public boolean shouldUseRdiff() {
-    return this.useRdiff;
-  }
-
-  public boolean shouldUseSnapshotDiff() {
-    return shouldUseDiff() || shouldUseRdiff();
-  }
-
-  public void setUseDiff(String fromSS, String toSS) {
-    this.useDiff = true;
-    this.fromSnapshot = fromSS;
-    this.toSnapshot = toSS;
+  public void setUseDiff(boolean useDiff, String fromSnapshot, String toSnapshot) {
+    this.useDiff = useDiff;
+    this.fromSnapshot = fromSnapshot;
+    this.toSnapshot = toSnapshot;
-  public void setUseRdiff(String fromSS, String toSS) {
-    this.useRdiff = true;
-    this.fromSnapshot = fromSS;
-    this.toSnapshot = toSS;
+  public void disableUsingDiff() {
+    this.useDiff = false;
-    if ((useDiff || useRdiff) && deleteMissing) {
-      // -delete and -diff/-rdiff are mutually exclusive. For backward
-      // compatibility, we ignore the -delete option here, instead of throwing
-      // an IllegalArgumentException. See HDFS-10397 for more discussion.
-      OptionsParser.LOG.warn(
-          "-delete and -diff/-rdiff are mutually exclusive. " +
+    if (useDiff && deleteMissing) {
+      // -delete and -diff are mutually exclusive. For backward compatibility,
+      // we ignore the -delete option here, instead of throwing an
+      // IllegalArgumentException. See HDFS-10397 for more discussion.
+      OptionsParser.LOG.warn("-delete and -diff are mutually exclusive. " +
-    if (!syncFolder && (useDiff || useRdiff)) {
+    if (!syncFolder && useDiff) {
-          "-diff/-rdiff is valid only with -update option");
-    }
-
-    if (useDiff || useRdiff) {
-      if (StringUtils.isBlank(fromSnapshot) ||
-          StringUtils.isBlank(toSnapshot)) {
-        throw new IllegalArgumentException(
-            "Must provide both the starting and ending " +
-            "snapshot names for -diff/-rdiff");
-      }
-    }
-    if (useDiff && useRdiff) {
-      throw new IllegalArgumentException(
-          "-diff and -rdiff are mutually exclusive");
+          "Diff is valid only with update options");
-   * @param conf - Configuration object to which the options need to be added
+   * @param conf - Configruation object to which the options need to be added
-    DistCpOptionSwitch.addToConf(conf, DistCpOptionSwitch.RDIFF,
-        String.valueOf(useRdiff));
-        ", useRdiff=" + useRdiff +

MOV44 INS44 UPD42 INS39 INS42 UPD42 UPD42 MOV21 MOV21 UPD66 INS42 UPD42 UPD42 UPD9 MOV42 MOV42 UPD45 UPD45 DEL40 DEL26 DEL83 DEL39 DEL42 DEL9 DEL59 DEL23 DEL52 DEL42 DEL22 DEL40 DEL7 DEL21 DEL83 DEL39 DEL42 DEL52 DEL42 DEL22 DEL41 DEL8 DEL31 DEL83 DEL39 DEL42 DEL42 DEL32 DEL42 DEL32 DEL27 DEL41 DEL8 DEL31 DEL40 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL52 DEL42 DEL22 DEL9 DEL7 DEL21 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21 DEL42 DEL27 DEL36 DEL42 DEL27 DEL36 DEL42 DEL42 DEL27 DEL42 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL27 DEL42 DEL43 DEL45 DEL45 DEL27 DEL14 DEL53 DEL8 DEL25 DEL8 DEL25 DEL42 DEL42 DEL27 DEL42 DEL43 DEL45 DEL14 DEL53 DEL8 DEL25 DEL42 DEL42 DEL42 DEL40 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21 DEL45 DEL42