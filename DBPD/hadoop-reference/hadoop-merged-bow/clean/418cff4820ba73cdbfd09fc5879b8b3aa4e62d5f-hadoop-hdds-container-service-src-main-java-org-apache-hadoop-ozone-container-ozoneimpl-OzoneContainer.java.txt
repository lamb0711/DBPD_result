Merge remote-tracking branch 'apache-commit/trunk' into HDDS-48

+import com.google.common.base.Preconditions;
+import org.apache.hadoop.hdds.protocol.datanode.proto.ContainerProtos;
-  private static final Logger LOG =
+  public static final Logger LOG =
+  private XceiverServerSpi getRatisSerer() {
+    for (XceiverServerSpi serverInstance : server) {
+      if (serverInstance instanceof XceiverServerRatis) {
+        return serverInstance;
+      }
+    }
+    return null;
+  }
+
+  private XceiverServerSpi getStandaAloneSerer() {
+    for (XceiverServerSpi serverInstance : server) {
+      if (!(serverInstance instanceof XceiverServerRatis)) {
+        return serverInstance;
+      }
+    }
+    return null;
+  }
+
-}
+  public void submitContainerRequest(
+      ContainerProtos.ContainerCommandRequestProto request,
+      HddsProtos.ReplicationType replicationType) throws IOException {
+    XceiverServerSpi serverInstance;
+    long containerId = getContainerIdForCmd(request);
+    if (replicationType == HddsProtos.ReplicationType.RATIS) {
+      serverInstance = getRatisSerer();
+      Preconditions.checkNotNull(serverInstance);
+      serverInstance.submitRequest(request);
+      LOG.info("submitting {} request over RATIS server for container {}",
+          request.getCmdType(), containerId);
+    } else {
+      serverInstance = getStandaAloneSerer();
+      Preconditions.checkNotNull(serverInstance);
+      getStandaAloneSerer().submitRequest(request);
+      LOG.info(
+          "submitting {} request over STAND_ALONE server for container {}",
+          request.getCmdType(), containerId);
+    }
+
+  }
+
+  private long getContainerIdForCmd(
+      ContainerProtos.ContainerCommandRequestProto request)
+      throws IllegalArgumentException {
+    ContainerProtos.Type type = request.getCmdType();
+    switch (type) {
+    case CloseContainer:
+      return request.getCloseContainer().getContainerID();
+      // Right now, we handle only closeContainer via queuing it over the
+      // over the XceiVerServer. For all other commands we throw Illegal
+      // argument exception here. Will need to extend the switch cases
+      // in case we want add another commands here.
+    default:
+      throw new IllegalArgumentException("Cmd " + request.getCmdType()
+          + " not supported over HearBeat Response");
+    }
+  }
+}

INS26 INS26 INS40 INS40 INS31 INS31 INS31 INS31 UPD83 INS83 INS43 INS42 INS8 INS83 INS43 INS42 INS8 INS83 INS39 INS42 INS44 INS44 INS43 INS8 INS83 INS39 INS42 INS44 INS43 INS8 INS42 INS70 INS41 INS42 INS70 INS41 INS43 INS42 INS43 INS42 INS42 INS60 INS60 INS25 INS43 INS42 INS42 INS60 INS50 INS44 INS42 INS8 INS33 INS44 INS42 INS8 INS33 INS40 INS40 INS43 INS59 INS39 INS59 INS27 INS8 INS8 INS40 INS43 INS59 INS42 INS49 INS41 INS49 INS53 INS43 INS42 INS25 INS43 INS42 INS25 INS42 INS42 INS42 INS32 INS42 INS40 INS21 INS21 INS21 INS21 INS21 INS21 INS21 INS21 INS40 INS42 INS32 INS42 INS32 INS14 INS42 INS62 INS8 INS42 INS38 INS8 INS42 INS42 INS7 INS32 INS32 INS32 INS7 INS32 INS32 INS32 INS42 INS42 INS32 INS42 INS43 INS27 INS42 INS43 INS41 INS36 INS41 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS45 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS45 INS32 INS42 INS42 INS42 INS42 INS45 INS32 INS45 INS42 INS42 INS62 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS42