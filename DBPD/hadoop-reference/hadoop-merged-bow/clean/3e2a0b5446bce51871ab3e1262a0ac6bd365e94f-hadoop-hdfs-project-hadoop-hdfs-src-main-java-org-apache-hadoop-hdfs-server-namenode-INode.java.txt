HDFS-6969. Archival Storage: INode#getStoragePolicyID should always return the latest storage policy. Contributed by Jing Zhao.

+import org.apache.hadoop.hdfs.BlockStoragePolicy;
-   * @return the storage policy id of the inode
+   * @return the latest block storage policy id of the INode. Specifically,
+   * if a storage policy is directly specified on the INode then return the ID
+   * of that policy. Otherwise follow the latest parental path and return the
+   * ID of the first specified storage policy.
-  public abstract byte getStoragePolicyID(int snapshotId);
+  public abstract byte getStoragePolicyID();
-  public byte getStoragePolicyID() {
-    return getStoragePolicyID(Snapshot.CURRENT_STATE_ID);
-  }
+  /**
+   * @return the storage policy directly specified on the INode. Return
+   * {@link BlockStoragePolicy#ID_UNSPECIFIED} if no policy has
+   * been specified.
+   */
+  public abstract byte getLocalStoragePolicyID();

INS26 INS40 INS29 INS83 UPD42 INS65 UPD66 INS66 INS66 INS66 INS66 INS65 INS66 INS66 INS67 INS42 INS42 DEL39 DEL42 DEL44 DEL42 DEL40 DEL32 DEL41 DEL8