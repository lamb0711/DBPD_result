YARN-335. Fair scheduler doesn't check whether rack needs containers before assigning to node. Contributed by Sandy Ryza.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1433484 13f79535-47bb-0310-9956-ffa450edef68

+        if (app.getTotalRequiredResources(priority) <= 0) {
+          continue;
+        }
+        
+
+        ResourceRequest rackLocalRequest = app.getResourceRequest(priority,
+            node.getRackName());
+        ResourceRequest localRequest = app.getResourceRequest(priority,
+            node.getHostName());
+        
-
-        ResourceRequest localRequest = app.getResourceRequest(priority,
-            node.getHostName());
-        if (localRequest != null && localRequest.getNumContainers() != 0) {
+        
+        if (rackLocalRequest != null && rackLocalRequest.getNumContainers() != 0
+            && localRequest != null && localRequest.getNumContainers() != 0) {
-        ResourceRequest rackLocalRequest = app.getResourceRequest(priority,
-            node.getRackName());

MOV60 MOV60 INS25 INS27 INS8 INS32 INS34 INS18 INS27 INS42 INS42 INS42 INS27 MOV27 INS27 INS27 INS42 INS33 INS32 INS34 INS42 INS42