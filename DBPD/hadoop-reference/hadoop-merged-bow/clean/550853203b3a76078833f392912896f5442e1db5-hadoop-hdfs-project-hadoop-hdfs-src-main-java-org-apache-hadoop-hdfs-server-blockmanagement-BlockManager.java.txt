HDFS-3475. Make the replication monitor multipliers configurable. Contributed by Harsh J Chouraria


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1355089 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.base.Preconditions;
+  final float blocksInvalidateWorkPct;
+  final int blocksReplWorkMultiplier;
+
-    
+
+    this.blocksInvalidateWorkPct = conf.getFloat(
+        DFSConfigKeys.DFS_NAMENODE_INVALIDATE_WORK_PCT_PER_ITERATION,
+        DFSConfigKeys.DFS_NAMENODE_INVALIDATE_WORK_PCT_PER_ITERATION_DEFAULT);
+    Preconditions.checkArgument(
+        (this.blocksInvalidateWorkPct > 0),
+        DFSConfigKeys.DFS_NAMENODE_INVALIDATE_WORK_PCT_PER_ITERATION +
+        " = '" + this.blocksInvalidateWorkPct + "' is invalid. " +
+        "It should be a positive, non-zero float value " +
+        "indicating a percentage.");
+    this.blocksReplWorkMultiplier = conf.getInt(
+        DFSConfigKeys.DFS_NAMENODE_REPLICATION_WORK_MULTIPLIER_PER_ITERATION,
+        DFSConfigKeys.DFS_NAMENODE_REPLICATION_WORK_MULTIPLIER_PER_ITERATION_DEFAULT);
+    Preconditions.checkArgument(
+        (this.blocksReplWorkMultiplier > 0),
+        DFSConfigKeys.DFS_NAMENODE_REPLICATION_WORK_MULTIPLIER_PER_ITERATION +
+        " = '" + this.blocksReplWorkMultiplier + "' is invalid. " +
+        "It should be a positive, non-zero integer value.");
+
-    private static final int INVALIDATE_WORK_PCT_PER_ITERATION = 32;
-    private static final int REPLICATION_WORK_MULTIPLIER_PER_ITERATION = 2;
-        * ReplicationMonitor.REPLICATION_WORK_MULTIPLIER_PER_ITERATION;
+        * this.blocksReplWorkMultiplier;
-        * ReplicationMonitor.INVALIDATE_WORK_PCT_PER_ITERATION / 100.0);
+        * this.blocksInvalidateWorkPct);

INS26 INS40 INS23 INS23 INS83 INS39 INS59 INS83 INS39 INS59 INS42 INS42 INS21 INS21 INS21 INS21 INS7 INS32 INS7 INS32 INS22 INS32 INS42 INS42 INS36 INS27 INS22 INS32 INS42 INS42 INS36 INS27 INS52 INS42 INS42 INS42 INS40 INS40 INS27 INS40 INS45 INS22 INS45 INS45 INS45 INS52 INS42 INS42 INS42 INS40 INS40 INS27 INS40 INS45 INS22 INS45 INS45 INS22 INS22 INS34 INS52 INS42 INS22 INS34 INS52 INS42 INS52 INS42 INS27 INS52 INS42 INS52 INS42 MOV42 INS22 INS52 INS42 DEL83 DEL83 DEL83 DEL39 DEL42 DEL34 DEL59 DEL23 DEL83 DEL83 DEL83 DEL39 DEL42 DEL34 DEL59 DEL23 DEL40 DEL40 DEL27 DEL34 DEL27