HDFS-12518. Re-encryption should handle task cancellation and progress better.

+    void reset() {
+      submissionDone = false;
+      tasks.clear();
+      numCheckpointed = 0;
+      numFutureDone = 0;
+    }
+
-    if (tracker != null) {
+    if (tracker != null && !tracker.getTasks().isEmpty()) {
-      handler.addDummyTracker(zoneId);
+      handler.addDummyTracker(zoneId, tracker);
+      final int batchSize = task.batch.size();
-              + " starting:{}.", task.numFilesUpdated, task.batch.size(),
+              + " starting:{}.", task.numFilesUpdated, batchSize,
+      if (curr.isCancelled()) {
+        break;
+      }
-    ReencryptionTask task = completed.get();
-      LOG.debug("Skipped canceled re-encryption task for zone {}, last: {}",
-          task.zoneId, task.lastFile);
+      // Ignore canceled zones. The cancellation is edit-logged by the handler.
+      LOG.debug("Skipped a canceled re-encryption task");
+    final ReencryptionTask task = completed.get();
-      Preconditions.checkNotNull(tracker, "zone tracker not found " + zonePath);
+      if (tracker == null) {
+        // re-encryption canceled.
+        LOG.info("Re-encryption was canceled.");
+        return;
+      }

INS31 MOV60 INS39 INS42 INS8 INS21 INS21 INS21 INS21 INS27 INS83 INS7 INS32 INS7 INS7 MOV27 INS38 INS60 INS25 INS25 INS42 INS9 INS42 INS42 INS42 INS34 INS42 INS34 INS32 INS83 INS39 INS59 INS32 INS8 INS27 INS8 INS32 INS42 INS42 INS42 MOV32 INS42 INS42 INS42 INS10 UPD45 INS42 INS33 MOV21 INS41 INS42 INS42 UPD42 UPD42 INS45 DEL40 DEL40 DEL42 DEL45 DEL42 DEL27