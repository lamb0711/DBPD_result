HDFS-4151. Change the methods in FSDirectory to pass INodesInPath instead of INode[] as a parameter.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1406006 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.namenode.INodeDirectory.INodesInPath;
-  /*
+  /**
-      INode[] pathINodes = dir.getExistingPathINodes(parent.toString());
-      INode parentNode = pathINodes[pathINodes.length - 1];
+      final INode parentNode = dir.getINode(parent.toString());
-            + parent.toString());
+            + parent);
-            + parent.toString());
+            + parent);
-      INode[] pathINodes = dir.getExistingPathINodes(src);
-      int inodesLen = pathINodes.length;
-      checkLease(src, clientName, pathINodes[inodesLen-1]);
-      INodeFileUnderConstruction pendingFile  = (INodeFileUnderConstruction) 
-                                                pathINodes[inodesLen - 1];
+
+      final INodesInPath inodesInPath = dir.rootDir.getExistingPathINodes(src, true);
+      final INode[] inodes = inodesInPath.getINodes();
+      final INodeFileUnderConstruction pendingFile
+          = checkLease(src, clientName, inodes[inodes.length - 1]);
-      newBlock = allocateBlock(src, pathINodes, targets);
+      newBlock = allocateBlock(src, inodesInPath, targets);
-   * @param inodes INode representing each of the components of src. 
-   *        <code>inodes[inodes.length-1]</code> is the INode for the file.
-   *        
+   * @param inodesInPath representing each of the components of src. 
+   *                     The last INode is the INode for the file.
-  private Block allocateBlock(String src, INode[] inodes,
-      DatanodeDescriptor targets[]) throws QuotaExceededException,
-      SafeModeException {
+  private Block allocateBlock(String src, INodesInPath inodesInPath,
+      DatanodeDescriptor targets[]) throws IOException {
-    b = dir.addBlock(src, inodes, b, targets);
+    b = dir.addBlock(src, inodesInPath, b, targets);

INS26 INS40 INS29 UPD43 INS65 INS43 UPD42 UPD42 INS66 UPD42 UPD66 UPD66 UPD42 MOV42 INS60 INS83 MOV43 INS83 INS43 INS83 MOV5 INS83 MOV43 INS59 UPD42 MOV42 UPD42 INS42 UPD42 UPD42 INS32 INS42 INS32 UPD42 INS40 INS9 INS42 INS42 MOV42 MOV42 MOV42 MOV2 UPD42 UPD42 INS42 INS40 INS42 DEL43 DEL85 DEL5 DEL42 DEL42 DEL40 DEL34 DEL27 DEL2 DEL59 DEL60 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL39 DEL40 DEL42 DEL32 DEL21 DEL42 DEL42 DEL43 DEL42 DEL42 DEL34 DEL27 DEL2 DEL11 DEL59 DEL60 DEL43 DEL85 DEL5 DEL42 DEL43