YARN-1781. Modified NodeManagers to allow admins to specify max disk utilization for local disks so as to be able to offline full disks. Contributed by Varun Vasudev.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1575463 13f79535-47bb-0310-9956-ffa450edef68

-
+  
+  /** Prefix for all node manager disk health checker configs. */
+  private static final String NM_DISK_HEALTH_CHECK_PREFIX =
+      "yarn.nodemanager.disk-health-checker.";
-   * Enable/Disable disks' health checker. Default is true.
-   * An expert level configuration property.
+   * Enable/Disable disks' health checker. Default is true. An expert level
+   * configuration property.
-    NM_PREFIX + "disk-health-checker.enable";
-  /** Frequency of running disks' health checker.*/
+      NM_DISK_HEALTH_CHECK_PREFIX + "enable";
+  /** Frequency of running disks' health checker. */
-    NM_PREFIX + "disk-health-checker.interval-ms";
+      NM_DISK_HEALTH_CHECK_PREFIX + "interval-ms";
-    2 * 60 * 1000;
+      2 * 60 * 1000;
-    NM_PREFIX + "disk-health-checker.min-healthy-disks";
+      NM_DISK_HEALTH_CHECK_PREFIX + "min-healthy-disks";
-   * By default, at least 25% of disks are to be healthy to say that the node
-   * is healthy in terms of disks.
+   * By default, at least 25% of disks are to be healthy to say that the node is
+   * healthy in terms of disks.
-  public static final float DEFAULT_NM_MIN_HEALTHY_DISKS_FRACTION
-    = 0.25F;
+  public static final float DEFAULT_NM_MIN_HEALTHY_DISKS_FRACTION = 0.25F;
+
+  /**
+   * The maximum percentage of disk space that can be used after which a disk is
+   * marked as offline. Values can range from 0.0 to 100.0. If the value is
+   * greater than or equal to 100, NM will check for full disk. This applies to
+   * nm-local-dirs and nm-log-dirs.
+   */
+  public static final String NM_MAX_PER_DISK_UTILIZATION_PERCENTAGE =
+      NM_DISK_HEALTH_CHECK_PREFIX + "max-disk-utilization-per-disk-percentage";
+  /**
+   * By default, 100% of the disk can be used before it is marked as offline.
+   */
+  public static final float DEFAULT_NM_MAX_PER_DISK_UTILIZATION_PERCENTAGE =
+      100.0F;
+
+  /**
+   * The minimum space that must be available on a local dir for it to be used.
+   * This applies to nm-local-dirs and nm-log-dirs.
+   */
+  public static final String NM_MIN_PER_DISK_FREE_SPACE_MB =
+      NM_DISK_HEALTH_CHECK_PREFIX + "min-free-space-per-disk-mb";
+  /**
+   * By default, all of the disk can be used before it is marked as offline.
+   */
+  public static final long DEFAULT_NM_MIN_PER_DISK_FREE_SPACE_MB = 0;

INS23 INS23 INS23 INS23 INS23 INS29 INS83 INS83 INS83 MOV43 INS59 MOV43 INS43 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS39 INS59 INS29 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS83 INS39 INS59 INS65 INS42 INS45 INS42 INS65 INS42 INS42 INS27 INS65 INS42 INS34 INS65 INS42 INS42 INS27 INS65 INS42 INS34 INS66 UPD66 UPD66 UPD42 UPD45 UPD66 UPD42 UPD45 UPD42 UPD45 UPD66 UPD66 INS66 INS66 INS66 INS66 INS42 INS45 INS66 INS66 INS66 INS42 INS45 INS66