YARN-1365. Changed ApplicationMasterService to allow an app to re-register after RM restart. Contributed by Anubhav Dhoot

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1605263 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.exceptions.ApplicationMasterNotRegisteredException;
+  private final AllocateResponse shutdown =
+      recordFactory.newRecordInstance(AllocateResponse.class);
+    this.shutdown.setAMCommand(AMCommand.AM_SHUTDOWN);
-        throw new InvalidApplicationMasterRequestException(message);
+        throw new ApplicationMasterNotRegisteredException(message);
-      
+
-      return resync;
+      return shutdown;
-            "Application Master is trying to allocate before registering for: "
-                + appAttemptId.getApplicationId();
-        LOG.error(message);
+            "Application Master is not registered for known application: "
+                + appAttemptId.getApplicationId()
+                + ". Let AM resync.";
+        LOG.info(message);
-        throw new InvalidApplicationMasterRequestException(message);
+        return resync;

INS26 INS40 INS23 INS83 INS83 INS43 INS59 INS42 INS42 INS32 INS21 INS42 INS42 INS57 INS32 INS43 INS22 INS42 INS40 INS41 INS42 INS52 INS42 INS42 MOV41 UPD43 UPD42 UPD42 UPD45 INS45 DEL42 DEL43 DEL42 DEL14 DEL53