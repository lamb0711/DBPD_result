MAPREDUCE-3098. Fixed RM and MR AM to report YarnApplicationState and application's FinalStatus separately. Contributed by Hitesh Shah.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1177633 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.api.records.FinalApplicationStatus;
-  private final Set<NodeId> ranNodes = 
+  private final Set<NodeId> ranNodes =
-  private final List<ContainerStatus> justFinishedContainers = 
+  private final List<ContainerStatus> justFinishedContainers =
-  private String finalState = "N/A";
+  // Set to null initially. Will eventually get set 
+  // if an RMAppAttemptUnregistrationEvent occurs
+  private FinalApplicationStatus finalStatus = null;
-          new ContainerAcquiredTransition())       
+          new ContainerAcquiredTransition())
-  
+
-  public String getAMFinalState() {
+  public FinalApplicationStatus getFinalApplicationStatus() {
-      return this.finalState;
+      return this.finalStatus;
-        RMAppAttemptEvent event) {      
+        RMAppAttemptEvent event) {
-    
+
-      
+
-      
+
-              rejectedEvent.getApplicationAttemptId().getApplicationId(), 
+              rejectedEvent.getApplicationAttemptId().getApplicationId(),
-  private static final List<ContainerId> EMPTY_CONTAINER_RELEASE_LIST = 
+  private static final List<ContainerId> EMPTY_CONTAINER_RELEASE_LIST =
-  private static final List<ResourceRequest> EMPTY_CONTAINER_REQUEST_LIST = 
+  private static final List<ResourceRequest> EMPTY_CONTAINER_REQUEST_LIST =
-          appEvent = 
+          appEvent =
-          appEvent = 
-              new RMAppFailedAttemptEvent(applicationId, 
-                  RMAppEventType.ATTEMPT_KILLED, 
+          appEvent =
+              new RMAppFailedAttemptEvent(applicationId,
+                  RMAppEventType.ATTEMPT_KILLED,
-          appEvent = 
-              new RMAppFailedAttemptEvent(applicationId, 
-                  RMAppEventType.ATTEMPT_FAILED, 
+          appEvent =
+              new RMAppFailedAttemptEvent(applicationId,
+                  RMAppEventType.ATTEMPT_FAILED,
-      
+
-      
+
-          " exitCode: " + status.getExitStatus() + 
+          " exitCode: " + status.getExitStatus() +
-      unregisterEvent.getFinalState();
-      appAttempt.finalState = unregisterEvent.getFinalState();
+      appAttempt.finalStatus = unregisterEvent.getFinalApplicationStatus();
-      ContainerStatus containerStatus = 
+      ContainerStatus containerStatus =
-            " exitCode: " + containerStatus.getExitStatus() + 
+            " exitCode: " + containerStatus.getExitStatus() +

INS26 INS40 UPD43 UPD43 UPD42 UPD42 UPD42 INS33 UPD42 UPD40 UPD42 UPD42 DEL45 DEL42 DEL42 DEL32 DEL21