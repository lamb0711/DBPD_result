HDFS-13348. Ozone: Update IP and hostname in Datanode from SCM's response to the register call. Contributed by Shashikant Banerjee.

-import org.apache.hadoop.hdds.protocol.proto.HddsProtos.DatanodeDetailsProto;
+import org.apache.hadoop.hdds.protocol.proto
+    .StorageContainerDatanodeProtocolProtos.SCMRegisteredCmdResponseProto;
-  private DatanodeDetailsProto datanodeDetailsProto;
+  private DatanodeDetails datanodeDetails;
-   * Get the DatanodeDetailsProto Proto.
+   * Get the DatanodeDetails.
-  public DatanodeDetailsProto getDatanodeDetailsProto() {
-    return datanodeDetailsProto;
+  public DatanodeDetails getDatanodeDetails() {
+    return datanodeDetails;
-   * @param datanodeDetailsProto - Container Node ID.
+   * @param datanodeDetails - Container Node ID.
-  public void setDatanodeDetailsProto(
-      DatanodeDetailsProto datanodeDetailsProto) {
-    this.datanodeDetailsProto = datanodeDetailsProto;
+  public void setDatanodeDetails(
+      DatanodeDetails datanodeDetails) {
+    this.datanodeDetails = datanodeDetails;
-    if (getDatanodeDetailsProto() == null) {
-      LOG.error("Container ID proto cannot be null in RegisterEndpoint task, " +
+    if (getDatanodeDetails() == null) {
+      LOG.error("DatanodeDetails cannot be null in RegisterEndpoint task, " +
-      rpcEndPoint.getEndPoint().register(datanodeDetailsProto,
-          conf.getStrings(ScmConfigKeys.OZONE_SCM_NAMES));
+      SCMRegisteredCmdResponseProto response = rpcEndPoint.getEndPoint()
+          .register(datanodeDetails.getProtoBufMessage(),
+              conf.getStrings(ScmConfigKeys.OZONE_SCM_NAMES));
+      if (response.hasHostname() && response.hasIpAddress()) {
+        datanodeDetails.setHostName(response.getHostname());
+        datanodeDetails.setIpAddress(response.getIpAddress());
+      }
-      task.setDatanodeDetailsProto(datanodeDetails.getProtoBufMessage());
+      task.setDatanodeDetails(datanodeDetails);

MOV26 UPD40 UPD43 UPD43 UPD42 UPD42 UPD42 UPD42 UPD42 UPD43 UPD42 UPD66 UPD42 UPD42 UPD42 UPD42 INS60 INS25 UPD42 UPD42 INS43 INS59 INS27 INS8 UPD42 MOV42 INS42 INS42 MOV32 INS32 INS32 MOV21 INS21 UPD45 MOV32 INS42 INS42 INS42 INS42 INS32 INS32 UPD42 MOV42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42