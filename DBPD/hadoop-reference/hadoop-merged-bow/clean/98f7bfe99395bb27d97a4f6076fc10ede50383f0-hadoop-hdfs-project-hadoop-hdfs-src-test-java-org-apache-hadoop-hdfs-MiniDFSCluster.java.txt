Merge branch 'HDFS-6584' into trunk

-    curDatanodesNum += numDataNodes;
-
+    
-        List<? extends FsVolumeSpi> volumes = dns[i].getFSDataset().getVolumes();
-        assert storageCapacities[i].length == storagesPerDatanode;
+        final int index = i - curDatanodesNum;
+        List<? extends FsVolumeSpi> volumes = dns[index].getFSDataset().getVolumes();
+        assert storageCapacities[index].length == storagesPerDatanode;
-          volume.setCapacityForTesting(storageCapacities[i][j]);
+          LOG.info("setCapacityForTesting "  + storageCapacities[index][j]
+              + " for [" + volume.getStorageType() + "]" + volume.getStorageID());
+          volume.setCapacityForTesting(storageCapacities[index][j]);

INS60 INS83 INS39 INS59 INS42 INS27 INS21 INS42 INS42 INS32 UPD42 INS42 INS42 INS27 UPD42 INS45 INS2 INS45 INS32 INS45 INS32 INS2 INS42 INS42 INS42 INS42 INS42 UPD42 INS42 INS42 DEL42 DEL42 DEL7 DEL21