MAPREDUCE-3901. Modified JobHistory records in YARN to lazily load job and task reports so as to improve UI response times. Contributed by Siddarth Seth.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1294417 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.LinkedHashMap;
-  
-  private final SortedMap<JobId, Job> loadedJobCache = 
-    new ConcurrentSkipListMap<JobId, Job>();
+
+  private Map<JobId, Job> loadedJobCache = null;
+  @SuppressWarnings("serial")
+    
+    loadedJobCache =
+        Collections.synchronizedMap(new LinkedHashMap<JobId, Job>(
+            loadedJobCacheSize + 1, 0.75f, true) {
+          @Override
+          public boolean removeEldestEntry(final Map.Entry<JobId, Job> eldest) {
+            return super.size() > loadedJobCacheSize;
+          }
+        });
+    
-    if (loadedJobCache.size() > loadedJobCacheSize ) {
-      loadedJobCache.remove(loadedJobCache.firstKey());
-    }
-            metaInfo.getHistoryFile(), true, metaInfo.getJobIndexInfo().getUser(),
+            metaInfo.getHistoryFile(), false, metaInfo.getJobIndexInfo().getUser(),
-  
+

INS26 INS40 UPD74 INS79 UPD43 INS33 INS42 INS45 INS21 UPD42 INS7 INS42 INS32 INS42 INS42 INS14 UPD74 MOV74 INS27 INS34 INS9 INS1 UPD43 INS42 INS34 INS31 UPD42 INS78 INS83 INS39 INS42 INS44 INS8 INS42 INS83 INS74 INS42 INS41 UPD9 INS43 INS43 INS43 INS27 INS40 INS42 INS42 INS48 INS42 INS42 DEL83 DEL14 DEL42 DEL42 DEL32 DEL42 DEL27 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21 DEL8 DEL25