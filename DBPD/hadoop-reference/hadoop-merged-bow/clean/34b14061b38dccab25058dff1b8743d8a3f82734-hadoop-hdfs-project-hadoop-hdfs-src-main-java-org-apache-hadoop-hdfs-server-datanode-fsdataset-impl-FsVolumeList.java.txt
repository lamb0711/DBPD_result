HDFS-14333. Datanode fails to start if any disk has errors during Namenode registration. Contributed by Stephen O'Donnell.

Signed-off-by: Wei-Chiu Chuang <weichiu@apache.org>

+import java.util.concurrent.ConcurrentHashMap;
-    final List<IOException> exceptions = Collections.synchronizedList(
-        new ArrayList<IOException>());
+    final Map<FsVolumeSpi, IOException> unhealthyDataDirs =
+        new ConcurrentHashMap<FsVolumeSpi, IOException>();
-            exceptions.add(ioe);
+            unhealthyDataDirs.put(v, ioe);
-    if (!exceptions.isEmpty()) {
-      throw exceptions.get(0);
-    }
+    if (!unhealthyDataDirs.isEmpty()) {
+      throw new AddBlockPoolException(unhealthyDataDirs);
+    }
-    
-    final List<IOException> exceptions = Collections.synchronizedList(
-        new ArrayList<IOException>());
+    final Map<FsVolumeSpi, IOException> unhealthyDataDirs =
+        new ConcurrentHashMap<FsVolumeSpi, IOException>();
-            exceptions.add(ioe);
+            unhealthyDataDirs.put(v, ioe);
-    if (!exceptions.isEmpty()) {
-      throw exceptions.get(0);
-    }
-    
+    if (!unhealthyDataDirs.isEmpty()) {
+      throw new AddBlockPoolException(unhealthyDataDirs);
+    }
-  
+

INS26 INS40 MOV25 MOV25 UPD74 UPD74 UPD43 INS43 UPD42 INS14 UPD43 INS43 MOV43 UPD42 INS14 UPD42 INS42 UPD74 MOV74 UPD42 INS14 UPD42 INS42 UPD74 MOV74 UPD42 INS14 UPD43 INS43 INS43 INS42 UPD43 INS43 MOV43 INS43 INS42 UPD42 INS42 INS42 UPD42 INS42 INS42 UPD42 UPD42 INS42 UPD42 UPD42 INS42 DEL42 DEL42 DEL14 DEL32 DEL42 DEL42 DEL34 DEL32 DEL42 DEL42 DEL14 DEL32 DEL42 DEL42 DEL34 DEL32