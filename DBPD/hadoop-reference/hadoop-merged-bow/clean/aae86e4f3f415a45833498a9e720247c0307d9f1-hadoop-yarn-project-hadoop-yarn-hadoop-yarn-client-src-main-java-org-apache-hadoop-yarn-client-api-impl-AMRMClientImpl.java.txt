merge changes from trunk to HDFS-4949 branch

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-4949@1524865 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.api.records.ResourceBlacklistRequest;
+  protected final Set<String> blacklistAdditions = new HashSet<String>();
+  protected final Set<String> blacklistRemovals = new HashSet<String>();
+  
-    ArrayList<ResourceRequest> askList = null;
-    ArrayList<ContainerId> releaseList = null;
+    List<ResourceRequest> askList = null;
+    List<ContainerId> releaseList = null;
+    List<String> blacklistToAdd = new ArrayList<String>();
+    List<String> blacklistToRemove = new ArrayList<String>();
+
+        blacklistToAdd.addAll(blacklistAdditions);
+        blacklistToRemove.addAll(blacklistRemovals);
+        
+        ResourceBlacklistRequest blacklistRequest = 
+            (blacklistToAdd != null) || (blacklistToRemove != null) ? 
+            ResourceBlacklistRequest.newInstance(blacklistToAdd,
+                blacklistToRemove) : null;
+        
-              askList, releaseList, null);
+              askList, releaseList, blacklistRequest);
+        // clear blacklistAdditions and blacklistRemovals before 
+        // unsynchronized part
+        blacklistAdditions.clear();
+        blacklistRemovals.clear();
+          
+          blacklistAdditions.addAll(blacklistToAdd);
+          blacklistRemovals.addAll(blacklistToRemove);
+
+  @Override
+  public synchronized void updateBlacklist(List<String> blacklistAdditions,
+      List<String> blacklistRemovals) {
+    
+    if (blacklistAdditions != null) {
+      this.blacklistAdditions.addAll(blacklistAdditions);
+      // if some resources are also in blacklistRemovals updated before, we 
+      // should remove them here.
+      this.blacklistRemovals.removeAll(blacklistAdditions);
+    }
+    
+    if (blacklistRemovals != null) {
+      this.blacklistRemovals.addAll(blacklistRemovals);
+      // if some resources are in blacklistAdditions before, we should remove
+      // them here.
+      this.blacklistAdditions.removeAll(blacklistRemovals);
+    }
+    
+    if (blacklistAdditions != null && blacklistRemovals != null
+        && blacklistAdditions.removeAll(blacklistRemovals)) {
+      // we allow resources to appear in addition list and removal list in the
+      // same invocation of updateBlacklist(), but should get a warn here.
+      LOG.warn("The same resources appear in both blacklistAdditions and " +
+          "blacklistRemovals in updateBlacklist.");
+    }
+  }

INS26 INS40 INS23 INS23 INS31 INS83 INS83 INS74 INS59 INS83 INS83 INS74 INS59 INS78 INS83 INS83 INS39 INS42 INS44 INS44 INS8 INS43 INS43 INS42 INS14 INS43 INS43 INS42 INS14 INS60 INS60 INS42 INS74 INS42 INS74 INS42 INS25 INS25 INS25 INS42 INS42 INS74 INS42 INS42 INS74 INS74 INS74 INS74 INS59 INS74 INS59 INS43 INS43 INS43 INS43 INS27 INS8 INS27 INS8 INS27 INS8 INS43 INS43 INS43 INS43 INS43 MOV43 INS43 MOV43 INS43 INS43 INS42 INS14 INS43 INS43 INS42 INS14 INS42 INS42 INS42 INS42 INS42 INS33 INS21 INS21 INS42 INS33 INS21 INS21 INS27 INS32 INS21 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 UPD74 MOV74 INS42 INS42 UPD74 MOV74 INS32 INS32 INS32 INS32 INS27 INS27 INS42 INS42 INS42 INS32 INS43 INS43 INS21 INS21 INS60 INS21 INS21 INS22 INS42 INS42 INS22 INS42 INS42 INS22 INS42 INS42 INS22 INS42 INS42 INS42 INS33 INS42 INS33 INS42 INS42 INS27 INS42 INS42 INS32 INS32 INS43 INS59 INS32 INS32 INS52 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS45 INS45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS16 INS42 INS42 INS42 INS42 INS21 INS21 INS27 INS32 INS33 INS42 INS32 INS32 INS36 INS36 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS27 INS27 INS42 INS33 INS42 INS33 DEL33