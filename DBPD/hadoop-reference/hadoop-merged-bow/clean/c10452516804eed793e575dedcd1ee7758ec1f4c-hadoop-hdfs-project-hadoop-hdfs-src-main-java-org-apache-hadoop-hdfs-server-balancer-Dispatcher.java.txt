Merge remote-tracking branch 'apache-commit/trunk' into HDDS-48

+  private long maxIterationTime;
+
-      LOG.info("Start moving " + this);
-      assert !(reportedBlock instanceof DBlockStriped);
-
+        if (source.isIterationOver()){
+          LOG.info("Cancel moving " + this +
+              " as iteration is already cancelled due to" +
+              " dfs.balancer.max-iteration-time is passed.");
+          throw new IOException("Block move cancelled.");
+        }
+        LOG.info("Start moving " + this);
+        assert !(reportedBlock instanceof DBlockStriped);
+
-      return (Time.monotonicNow()-startTime > MAX_ITERATION_TIME);
+      if (maxIterationTime < 0){
+        return false;
+      }
+      return (Time.monotonicNow()-startTime > maxIterationTime);
-    private static final long MAX_ITERATION_TIME = 20 * 60 * 1000L; // 20 mins
-
-        LOG.info("The maximum iteration time (" + MAX_ITERATION_TIME/1000
+        LOG.info("The maximum iteration time (" + maxIterationTime/1000
-        0L, 0L, 0, maxNoMoveInterval, conf);
+        0L, 0L, 0, maxNoMoveInterval, -1, conf);
-      long getBlocksSize, long getBlocksMinBlockSize,
-      int blockMoveTimeout, int maxNoMoveInterval, Configuration conf) {
+      long getBlocksSize, long getBlocksMinBlockSize, int blockMoveTimeout,
+      int maxNoMoveInterval, long maxIterationTime, Configuration conf) {
+    this.maxIterationTime = maxIterationTime;

INS23 INS83 INS39 INS59 INS44 INS42 INS39 INS42 INS21 INS25 INS38 INS7 INS27 INS8 INS34 INS22 INS42 INS25 MOV21 MOV6 INS42 INS34 INS41 INS52 INS42 INS32 INS8 INS9 UPD42 INS42 INS42 INS21 INS53 INS32 INS14 INS42 INS42 INS27 INS43 INS45 INS45 INS52 INS45 INS45 INS42 UPD42 DEL83 DEL83 DEL83 DEL39 DEL42 DEL34 DEL34 DEL34 DEL27 DEL59 DEL23