HDFS-7454. Reduce memory footprint for AclEntries in NameNode. Contributed by Vinayakumar B.

+import com.google.common.annotations.VisibleForTesting;
-    List<AclEntry> featureEntries = parent.getAclFeature().getEntries();
+    List<AclEntry> featureEntries = getEntriesFromAclFeature(parent
+        .getAclFeature());
-    return f == null ? ImmutableList.<AclEntry> of() : f.getEntries();
+    return getEntriesFromAclFeature(f);
+  }
+
+  /**
+   * Build list of AclEntries from the AclFeature
+   * @param aclFeature AclFeature
+   * @return List of entries
+   */
+  @VisibleForTesting
+  static ImmutableList<AclEntry> getEntriesFromAclFeature(AclFeature aclFeature) {
+    if (aclFeature == null) {
+      return ImmutableList.<AclEntry> of();
+    }
+    ImmutableList.Builder<AclEntry> b = new ImmutableList.Builder<AclEntry>();
+    for (int pos = 0, entry; pos < aclFeature.getEntriesSize(); pos++) {
+      entry = aclFeature.getEntryAt(pos);
+      b.add(AclEntryStatusFormat.toAclEntry(entry));
+    }
+    return b.build();
-    List<AclEntry> featureEntries = f.getEntries();
+    List<AclEntry> featureEntries = getEntriesFromAclFeature(f);
-    List<AclEntry> featureEntries = f.getEntries();
+    List<AclEntry> featureEntries = getEntriesFromAclFeature(f);
-    return new AclFeature(ImmutableList.copyOf(featureEntries));
+    return new AclFeature(AclEntryStatusFormat.toInt(featureEntries));

INS26 INS40 INS31 INS29 INS78 INS83 INS74 INS42 INS44 INS8 INS41 INS65 INS65 INS65 INS42 INS43 INS43 INS43 INS42 INS25 INS60 INS24 INS41 INS32 INS66 INS42 INS66 INS66 INS42 INS42 INS42 INS27 INS8 INS74 INS59 INS58 INS27 INS37 INS8 INS32 MOV32 INS42 INS42 INS42 INS33 MOV41 INS43 INS43 INS42 INS14 INS39 INS59 INS59 INS42 INS32 INS42 INS21 INS21 INS42 INS42 UPD42 MOV32 INS40 INS42 INS74 INS42 INS34 INS42 INS42 INS42 INS7 INS32 INS42 INS42 UPD42 UPD42 INS43 INS43 INS42 INS32 INS42 INS42 INS32 INS40 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL42 DEL33 DEL27 DEL42 DEL42 DEL32 DEL16 DEL42 DEL42