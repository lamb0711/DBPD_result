MAPREDUCE-4128. AM Recovery expects all attempts of a completed task to also be completed. (Bikas Saha via bobby)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1325765 13f79535-47bb-0310-9956-ffa450edef68

+    if(TaskStatus.State.SUCCEEDED.toString().equals(taskInfo.status))
+    {
+      //this is a successful task
+      if(attemptInfo.getAttemptId().equals(taskInfo.getSuccessfulAttemptId()))
+      {
+        // the failed attempt is the one that made this task successful
+        // so its no longer successful
+        taskInfo.status = null;
+        // not resetting the other fields set in handleTaskFinishedEvent()
+      }
+    }
+    taskInfo.successfulAttemptId = event.getSuccessfulTaskAttemptId();
+    TaskAttemptID successfulAttemptId;
+    /** @return the attempt Id that caused this task to succeed */
+    public TaskAttemptID getSuccessfulAttemptId() {
+      return successfulAttemptId;
+    }

INS23 INS31 INS25 INS21 INS43 INS59 INS29 INS83 INS43 INS42 INS8 INS32 INS8 INS7 INS42 INS42 INS65 INS42 INS41 INS32 INS42 INS40 INS25 INS40 INS32 INS66 INS42 INS40 INS42 INS32 INS8 INS42 INS42 INS32 INS42 INS32 INS21 INS42 INS42 INS42 INS42 INS7 INS40 INS33