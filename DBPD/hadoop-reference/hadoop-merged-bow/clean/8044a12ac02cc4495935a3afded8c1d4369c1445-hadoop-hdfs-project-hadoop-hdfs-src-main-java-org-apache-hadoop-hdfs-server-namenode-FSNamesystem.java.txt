HDFS-6618. FSNamesystem#delete drops the FSN lock between removing INodes from the tree and deleting them from the inode map (kihwal via cmccabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1609380 13f79535-47bb-0310-9956-ffa450edef68

-      removePathAndBlocks(src, null, null);
+      removePathAndBlocks(src, null, removedINodes, true);
-    dir.writeLock();
-    try {
-      dir.removeFromInodeMap(removedINodes);
-    } finally {
-      dir.writeUnlock();
-    }
-    removedINodes.clear();
+   * @param acquireINodeMapLock Whether to acquire the lock for inode removal
-      List<INode> removedINodes) {
+      List<INode> removedINodes, final boolean acquireINodeMapLock) {
-      dir.removeFromInodeMap(removedINodes);
+      if (acquireINodeMapLock) {
+        dir.writeLock();
+      }
+      try {
+        dir.removeFromInodeMap(removedINodes);
+      } finally {
+        if (acquireINodeMapLock) {
+          dir.writeUnlock();
+        }
+      }

INS44 INS65 INS83 INS39 INS42 INS42 INS66 INS25 MOV54 MOV21 INS42 INS8 INS8 INS42 INS9 MOV21 INS25 INS42 MOV8 DEL33 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL32 DEL21