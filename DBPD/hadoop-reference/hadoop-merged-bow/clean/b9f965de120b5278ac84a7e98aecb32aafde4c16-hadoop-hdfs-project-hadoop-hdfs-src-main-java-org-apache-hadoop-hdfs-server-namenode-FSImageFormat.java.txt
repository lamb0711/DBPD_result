HDFS-4103. Support O(1) snapshot creation.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1424782 13f79535-47bb-0310-9956-ffa450edef68

-      fsDir.rootDir.setQuota(nsQuota, dsQuota);
+      fsDir.rootDir.setQuota(nsQuota, dsQuota, null);
-    if (!parent.addChild(child, false)) {
+    if (!parent.addChild(child, false, null)) {
-        INodeFile oldnode = INodeFile.valueOf(fsDir.getINode(path), path);
-        fsDir.replaceINodeFile(path, oldnode, cons);
+        final INodesInPath iip = fsDir.getINodesInPath(path);
+        INodeFile oldnode = INodeFile.valueOf(iip.getINode(0), path);
+        fsDir.unprotectedReplaceINodeFile(path, oldnode, cons,
+            iip.getLatestSnapshot());

INS60 INS33 INS83 INS43 INS59 INS33 INS42 INS42 INS32 UPD42 INS32 INS42 INS42 INS42 INS42 INS42 UPD42 INS34 DEL42