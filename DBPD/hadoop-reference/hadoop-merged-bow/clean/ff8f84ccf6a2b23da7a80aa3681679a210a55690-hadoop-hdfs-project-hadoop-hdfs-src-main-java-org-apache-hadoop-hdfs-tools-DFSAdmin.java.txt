Merge trunk into branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3077@1396918 13f79535-47bb-0310-9956-ffa450edef68

+import java.security.PrivilegedExceptionAction;
+import org.apache.hadoop.security.SecurityUtil;
-            " is not a distributed file system");
+            " is not an HDFS file system");
-      " is not a distributed file system");
+      " is not an HDFS file system");
-  public int fetchImage(String[] argv, int idx) throws IOException {
-    String infoServer = DFSUtil.getInfoServer(
+  public int fetchImage(final String[] argv, final int idx) throws IOException {
+    final String infoServer = DFSUtil.getInfoServer(
-    TransferFsImage.downloadMostRecentImageToDirectory(infoServer,
-        new File(argv[idx]));
+    SecurityUtil.doAsCurrentUser(new PrivilegedExceptionAction<Void>() {
+      @Override
+      public Void run() throws Exception {
+        TransferFsImage.downloadMostRecentImageToDirectory(infoServer,
+            new File(argv[idx]));
+        return null;
+      }
+    });

INS26 INS26 INS40 INS40 INS83 INS83 INS21 INS83 INS32 INS42 INS42 INS14 INS74 INS1 INS43 INS43 INS31 UPD45 INS42 INS42 INS78 INS83 INS43 INS42 INS43 INS8 UPD45 INS42 INS42 INS42 MOV21 INS41 INS33