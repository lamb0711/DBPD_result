Merge r1555021 through r1569889 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1569890 13f79535-47bb-0310-9956-ffa450edef68

-  @SuppressWarnings("rawtypes")
-  private static final FinalTransition FINAL_TRANSITION = new FinalTransition();
-  @SuppressWarnings("unchecked")
-  @SuppressWarnings("unchecked")
-        FINAL_TRANSITION.transition(app, event);
+        new FinalTransition(app.recoveredFinalState).transition(app, event);
-      FINAL_TRANSITION.transition(app, event);
+      new FinalTransition(RMAppState.FAILED).transition(app, event);
+    public AppFinishedTransition() {
+      super(RMAppState.FINISHED);
+    }
+
+    public AppKilledTransition() {
+      super(RMAppState.KILLED);
+    }
+
+    public AppRejectedTransition() {
+      super(RMAppState.FAILED);
+    }
+
+    private final RMAppState finalState;
+
+    public FinalTransition(RMAppState finalState) {
+      this.finalState = finalState;
+    }
+
-      // TODO: We need to fix for the problem that RMApp enters the final state
-      // after RMAppAttempt in the killing case
-          .applicationFinished(app);
+          .applicationFinished(app, finalState);

INS31 INS31 INS31 INS23 INS31 INS83 INS42 INS8 INS83 INS42 INS8 INS83 INS42 INS8 INS83 INS83 INS43 INS59 INS83 INS42 INS44 INS8 INS46 INS46 INS46 INS42 INS42 INS43 INS42 INS21 INS40 INS40 INS40 INS42 INS7 INS14 INS22 INS42 INS42 MOV43 INS40 INS52 INS42 MOV14 INS40 DEL42 DEL45 DEL79 DEL83 DEL83 DEL83 DEL42 DEL59 DEL23 DEL42 DEL45 DEL79 DEL42 DEL45 DEL79 DEL42 DEL42