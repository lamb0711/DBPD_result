HDDS-1551. Implement Bucket Write Requests to use Cache and DoubleBuffer. (#850)



-      LoggerFactory.getLogger(OzoneManagerDoubleBuffer.class.getName());
+      LoggerFactory.getLogger(OzoneManagerDoubleBuffer.class);
+
+          long lastRatisTransactionIndex =
+              readyBuffer.stream().map(DoubleBufferEntry::getTrxLogIndex)
+              .max(Long::compareTo).get();
+
+          // cleanup cache.
+          cleanupCache(lastRatisTransactionIndex);
+  private void cleanupCache(long lastRatisTransactionIndex) {
+    // As now only bucket transactions are handled only called cleanupCache
+    // on bucketTable.
+    // TODO: After supporting all write operations we need to call
+    //  cleanupCache on the tables only when buffer has entries for that table.
+    omMetadataManager.getBucketTable().cleanupCache(lastRatisTransactionIndex);
+  }
+

INS31 INS83 INS39 INS42 INS44 INS8 MOV32 MOV57 INS39 INS42 INS21 INS42 UPD42 INS32 INS32 INS42 INS42 INS42 INS42 INS60 INS21 INS39 INS59 INS32 INS42 INS32 INS42 INS42 INS32 INS42 INS32 INS42 INS90 INS32 INS42 INS90 INS42 INS42 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL32