HDFS-14509. DN throws InvalidToken due to inequality of password when upgrade NN 2.x to 3.x. Contributed by Yuxuan Wang and Konstantin Shvachko.

+import org.apache.hadoop.io.IOUtils;
+    cache = null; // invalidate the cache
+
+    // this.cache should be assigned the raw bytes from the input data for
+    // upgrading compatibility. If we won't mutate fields and call getBytes()
+    // for something (e.g retrieve password), we should return the raw bytes
+    // instead of serializing the instance self fields to bytes, because we may
+    // lose newly added fields which we can't recognize
+    this.cache = IOUtils.readFullyToByteArray(dis);
+    dis.reset();
+

INS26 INS40 MOV21 INS21 INS21 INS21 INS7 INS7 INS32 INS42 INS33 INS22 INS32 INS42 INS42 INS52 INS42 INS42 INS42 INS42