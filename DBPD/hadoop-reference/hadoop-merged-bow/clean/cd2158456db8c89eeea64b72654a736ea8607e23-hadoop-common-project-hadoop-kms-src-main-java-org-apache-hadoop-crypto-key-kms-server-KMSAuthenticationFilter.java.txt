HADOOP-15418. Hadoop KMSAuthenticationFilter needs to use getPropsByPrefix instead of iterator to avoid ConcurrentModificationException. Contributed by lqjack and Suma Shivaprasad

+import com.google.common.annotations.VisibleForTesting;
-    Properties props = new Properties();
+
-    for (Map.Entry<String, String> entry : conf) {
-      String name = entry.getKey();
-      if (name.startsWith(CONFIG_PREFIX)) {
-        String value = conf.get(name);
-        name = name.substring(CONFIG_PREFIX.length());
-        props.setProperty(name, value);
-      }
+    return getKMSConfiguration(conf);
+  }
+
+  @VisibleForTesting
+  Properties getKMSConfiguration(Configuration conf) {
+    Properties props = new Properties();
+
+    Map<String, String> propsWithPrefixMap = conf.getPropsWithPrefix(
+        CONFIG_PREFIX);
+
+    for (Map.Entry<String, String> entry : propsWithPrefixMap.entrySet()) {
+      props.setProperty(entry.getKey(), entry.getValue());
+

INS26 INS40 INS31 MOV78 INS83 INS43 INS42 MOV44 MOV44 INS8 INS78 UPD42 INS44 INS42 MOV60 INS41 INS42 INS43 INS42 MOV60 INS70 INS32 INS42 INS74 MOV44 INS32 INS8 INS42 INS42 INS43 MOV43 MOV43 UPD42 UPD42 MOV42 UPD42 MOV42 MOV21 INS42 UPD42 UPD42 MOV32 INS32 UPD42 MOV42 UPD42 MOV42 DEL83 DEL42 DEL42 DEL59 DEL60 DEL42 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL32 DEL7 DEL21 DEL8 DEL25 DEL8 DEL70