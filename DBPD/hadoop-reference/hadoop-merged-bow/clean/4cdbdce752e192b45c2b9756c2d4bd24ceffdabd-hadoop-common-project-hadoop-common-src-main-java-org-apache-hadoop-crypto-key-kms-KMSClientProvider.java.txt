HADOOP-14841 Kms client should disconnect if unable to get output stream from connection. Contributed by Rushabh S Shah

+    OutputStream os = null;
-        writeJson(jsonOutput, conn.getOutputStream());
+        os = conn.getOutputStream();
+        writeJson(jsonOutput, os);
-      IOUtils.closeStream(conn.getInputStream());
+      // The payload is not serialized if getOutputStream fails.
+      // Calling getInputStream will issue the put/post request with no payload
+      // which causes HTTP 500 server error.
+      if (os == null) {
+        conn.disconnect();
+      } else {
+        IOUtils.closeStream(conn.getInputStream());
+      }

INS60 INS43 INS59 INS42 INS42 INS33 INS8 INS25 MOV53 INS21 INS27 INS8 MOV8 INS7 INS32 INS42 INS33 INS21 INS42 MOV32 INS42 INS42 INS42 INS32 INS42 INS42 DEL42 DEL42 DEL32