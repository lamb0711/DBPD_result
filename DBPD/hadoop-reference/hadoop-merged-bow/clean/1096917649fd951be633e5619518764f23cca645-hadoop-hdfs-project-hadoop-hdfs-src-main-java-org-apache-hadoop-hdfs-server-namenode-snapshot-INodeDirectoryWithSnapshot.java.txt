HDFS-4611. Update FSImage for INodeReference.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1463332 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.DataOutputStream;
+import java.io.DataOutput;
+import org.apache.hadoop.hdfs.server.namenode.snapshot.SnapshotFSImageFormat.ReferenceMap;
-    private void writeCreated(DataOutputStream out) throws IOException {
+    private void writeCreated(DataOutput out) throws IOException {
-    private void writeDeleted(DataOutputStream out) throws IOException {
+    private void writeDeleted(DataOutput out,
+        ReferenceMap referenceMap) throws IOException {
-        FSImageSerialization.saveINode2Image(node, out, true);
+        FSImageSerialization.saveINode2Image(node, out, true, referenceMap);
-    private void write(DataOutputStream out) throws IOException {
+    private void write(DataOutput out, ReferenceMap referenceMap
+        ) throws IOException {
-      writeDeleted(out);    
+      writeDeleted(out, referenceMap);    
-    void write(DataOutputStream out) throws IOException {
-      writeSnapshotPath(out);
+    void write(DataOutput out, ReferenceMap referenceMap) throws IOException {
+      writeSnapshot(out);
-      diff.write(out);
+      diff.write(out, referenceMap);
-    final INodeReference.WithName ref = new INodeReference.WithName(
+    final INodeReference.WithName ref = new INodeReference.WithName(this,
+

INS26 UPD40 INS40 INS44 INS44 INS44 UPD43 UPD43 INS43 INS42 UPD43 INS43 INS42 UPD43 INS43 INS42 UPD42 UPD42 INS42 UPD42 INS42 UPD42 INS42 INS42 UPD42 INS42 INS52 INS42