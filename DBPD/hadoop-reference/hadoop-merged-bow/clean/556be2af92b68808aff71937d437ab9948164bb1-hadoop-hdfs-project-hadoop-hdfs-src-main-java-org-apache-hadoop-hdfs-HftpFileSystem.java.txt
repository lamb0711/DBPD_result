svn merge -c -1366601 for reverting HDFS-3667.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1367407 13f79535-47bb-0310-9956-ffa450edef68

+    @Override
-    protected HttpURLConnection connect(final long offset,
-        final boolean resolved) throws IOException {
+    protected HttpURLConnection openConnection(final long offset) throws IOException {
-      conn.connect();
-
-      //Expects HTTP_OK or HTTP_PARTIAL response codes. 
-      final int code = conn.getResponseCode();
-      if (offset != 0L && code != HttpURLConnection.HTTP_PARTIAL) {
-        throw new IOException("HTTP_PARTIAL expected, received " + code);
-      } else if (offset == 0L && code != HttpURLConnection.HTTP_OK) {
-        throw new IOException("HTTP_OK expected, received " + code);
-      }
+    /** Expects HTTP_OK and HTTP_PARTIAL response codes. */
+    @Override
+    protected void checkResponseCode(final HttpURLConnection connection
+        ) throws IOException {
+      final int code = connection.getResponseCode();
+      if (startPos != 0 && code != HttpURLConnection.HTTP_PARTIAL) {
+        // We asked for a byte range but did not receive a partial content
+        // response...
+        throw new IOException("HTTP_PARTIAL expected, received " + code);
+      } else if (startPos == 0 && code != HttpURLConnection.HTTP_OK) {
+        // We asked for all bytes from the beginning but didn't receive a 200
+        // response (none of the other 2xx codes are valid here)
+        throw new IOException("HTTP_OK expected, received " + code);
+      }
+    }
+

INS31 INS78 UPD42 INS29 INS78 INS83 INS39 INS42 INS44 INS43 INS8 INS42 INS65 INS42 INS83 INS43 INS42 INS42 INS60 MOV25 INS66 INS42 INS83 INS39 INS59 INS42 INS32 INS42 INS42 UPD42 UPD34 UPD42 UPD34 DEL83 DEL39 DEL42 DEL44 DEL42 DEL42 DEL32 DEL21 DEL83 DEL39 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60