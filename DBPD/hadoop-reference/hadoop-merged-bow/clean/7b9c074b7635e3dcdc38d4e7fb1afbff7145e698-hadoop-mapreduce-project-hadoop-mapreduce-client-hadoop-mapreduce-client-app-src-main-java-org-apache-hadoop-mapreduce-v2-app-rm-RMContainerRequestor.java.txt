MAPREDUCE-5844. Add a configurable delay to reducer-preemption. (Maysam Yabandeh via kasha)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1603957 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.annotations.VisibleForTesting;
+import org.apache.hadoop.classification.InterfaceAudience.Private;
+  @Private
+  @VisibleForTesting
-    
+    /**
+     * the time when this request object was formed; can be used to avoid
+     * aggressive preemption for recently placed requests
+     */
+    final long requestTimeMs;
+
-    
+
+    public ContainerRequest(ContainerRequestEvent event, Priority priority,
+                            long requestTimeMs) {
+      this(event.getAttemptID(), event.getCapability(), event.getHosts(),
+          event.getRacks(), priority, requestTimeMs);
+    }
+
-        Resource capability, String[] hosts, String[] racks, 
-        Priority priority) {
+                            Resource capability, String[] hosts, String[] racks,
+                            Priority priority) {
+      this(attemptID, capability, hosts, racks, priority,
+          System.currentTimeMillis());
+    }
+
+    public ContainerRequest(TaskAttemptId attemptID,
+        Resource capability, String[] hosts, String[] racks,
+        Priority priority, long requestTimeMs) {
+      this.requestTimeMs = requestTimeMs;

INS26 INS26 INS40 INS40 INS78 INS78 INS23 INS31 INS31 INS42 INS42 INS29 INS83 INS39 INS59 INS83 INS42 INS44 INS44 INS44 INS8 INS83 INS42 INS44 INS44 INS44 INS44 INS44 INS8 INS44 INS65 INS42 INS43 INS42 INS43 INS42 INS39 INS42 INS17 INS43 INS42 INS43 INS42 INS5 INS42 INS5 INS42 INS43 INS42 INS17 INS39 INS42 INS21 INS66 INS66 INS42 INS42 INS32 INS32 INS32 INS32 INS42 INS42 INS42 INS42 INS43 INS85 INS43 INS85 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS7 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS22 INS42 INS52 INS42