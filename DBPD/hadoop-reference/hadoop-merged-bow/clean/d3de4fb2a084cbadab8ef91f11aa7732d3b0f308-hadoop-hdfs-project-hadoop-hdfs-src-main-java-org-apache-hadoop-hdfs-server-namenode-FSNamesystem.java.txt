HDFS-13077. [SPS]: Fix review comments of external storage policy satisfier. Contributed by Rakesh R.

+    validateStoragePolicySatisfy();
-      // make sure storage policy is enabled, otherwise
-      // there is no need to satisfy storage policy.
-      if (!dir.isStoragePolicyEnabled()) {
-        throw new IOException(String.format(
-            "Failed to satisfy storage policy since %s is set to false.",
-            DFS_STORAGE_POLICY_ENABLED_KEY));
-      }
-
-      if (!blockManager.isSPSEnabled()
-          || (blockManager.getSPSMode() == StoragePolicySatisfierMode.INTERNAL
-              && !blockManager.getStoragePolicySatisfier().isRunning())) {
-        throw new UnsupportedActionException(
-            "Cannot request to satisfy storage policy "
-                + "when storage policy satisfier feature has been disabled"
-                + " by admin. Seek for an admin help to enable it "
-                + "or use Mover tool.");
-      }
+  private void validateStoragePolicySatisfy()
+      throws UnsupportedActionException, IOException {
+    // make sure storage policy is enabled, otherwise
+    // there is no need to satisfy storage policy.
+    if (!dir.isStoragePolicyEnabled()) {
+      throw new IOException(String.format(
+          "Failed to satisfy storage policy since %s is set to false.",
+          DFS_STORAGE_POLICY_ENABLED_KEY));
+    }
+    // checks sps status
+    if (!blockManager.isSPSEnabled()
+        || (blockManager.getSPSMode() == StoragePolicySatisfierMode.INTERNAL
+            && !blockManager.getStoragePolicySatisfier().isRunning())) {
+      throw new UnsupportedActionException(
+          "Cannot request to satisfy storage policy "
+              + "when storage policy satisfier feature has been disabled"
+              + " by admin. Seek for an admin help to enable it "
+              + "or use Mover tool.");
+    }
+    // checks SPS Q has many outstanding requests.
+    blockManager.verifyOutstandingSPSPathQLimit();
+  }
+

INS31 INS83 INS39 INS42 INS43 INS43 MOV8 INS21 INS42 INS42 INS21 INS32 INS8 INS32 INS42 MOV21 MOV21 MOV21 INS42 INS42