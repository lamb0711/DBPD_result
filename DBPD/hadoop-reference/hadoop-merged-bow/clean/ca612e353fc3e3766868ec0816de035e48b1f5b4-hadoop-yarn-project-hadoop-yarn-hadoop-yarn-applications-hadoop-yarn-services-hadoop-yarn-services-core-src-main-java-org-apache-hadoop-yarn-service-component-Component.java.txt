YARN-8243. Flex down should remove instance with largest component instance ID first. Contributed by Gour Saha

-      } else if (delta < 0){
+      } else if (delta < 0) {
-        return STABLE;
+        return component.componentSpec.getState()
+            == org.apache.hadoop.yarn.service.api.records.ComponentState.STABLE
+                ? STABLE : FLEXING;
-        component.context.getServiceManager().checkAndUpdateServiceState(true);
+        component.context.getServiceManager().checkAndUpdateServiceState();
-        if (curState != component.componentSpec.getState()) {
-          LOG.info("[COMPONENT {}] state changed from {} -> {}",
-              component.componentSpec.getName(), curState,
-              component.componentSpec.getState());
-        }
-        // component state change will trigger re-check of service state
-        component.context.getServiceManager().checkAndUpdateServiceState(false);
+      } else if (component.componentMetrics.containersReady
+          .value() == component.componentMetrics.containersDesired.value()) {
+        component.componentSpec.setState(
+            org.apache.hadoop.yarn.service.api.records.ComponentState.STABLE);
+      if (curState != component.componentSpec.getState()) {
+        LOG.info("[COMPONENT {}] state changed from {} -> {}",
+            component.componentSpec.getName(), curState,
+            component.componentSpec.getState());
+      }
+      // component state change will trigger re-check of service state
+      component.context.getServiceManager().checkAndUpdateServiceState();

MOV8 MOV60 MOV21 INS42 MOV8 INS25 MOV27 INS8 INS25 MOV21 INS27 INS8 INS16 INS32 INS32 INS21 INS27 INS42 INS42 INS40 INS42 INS40 INS42 INS32 INS32 INS40 INS40 INS42 INS40 INS40 INS42 DEL42 DEL9 DEL9 DEL42 DEL25 DEL8