YARN-1774. FS: Submitting to non-leaf queue throws NPE. (Anubhav Dhoot and Karthik Kambatla via kasha)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1575415 13f79535-47bb-0310-9956-ffa450edef68

-      rmContext.getDispatcher().getEventHandler().handle(
-          new RMAppRejectedEvent(applicationId,
-              "Application rejected by queue placement policy"));
-  
+
+  /**
+   * Helper method that attempts to assign the app to a queue. The method is
+   * responsible to call the appropriate event-handler if the app is rejected.
+   */
+    String appRejectMsg = null;
+
-        return null;
+        appRejectMsg = "Application rejected by queue placement policy";
+      } else {
+        queue = queueMgr.getLeafQueue(queueName, true);
+        if (queue == null) {
+          appRejectMsg = queueName + " is not a leaf queue";
+        }
-      queue = queueMgr.getLeafQueue(queueName, true);
-    } catch (IOException ex) {
-      LOG.error("Error assigning app to queue, rejecting", ex);
+    } catch (IOException ioe) {
+      appRejectMsg = "Error assigning app to queue " + queueName;
-    
+
+    if (appRejectMsg != null && rmApp != null) {
+      LOG.error(appRejectMsg);
+      rmContext.getDispatcher().getEventHandler().handle(
+          new RMAppRejectedEvent(rmApp.getApplicationId(), appRejectMsg));
+      return null;
+    }
+
-      LOG.warn("Couldn't find RM app to set queue name on");
+      LOG.error("Couldn't find RM app to set queue name on");
-    

INS29 INS25 INS65 INS60 MOV25 MOV27 INS8 INS66 INS66 INS43 INS59 INS27 INS41 INS42 INS42 INS33 INS27 INS27 INS21 MOV41 INS8 UPD42 INS42 INS33 INS42 INS33 INS32 INS21 MOV21 INS25 INS7 INS42 INS42 INS42 UPD42 INS7 INS27 INS8 INS42 INS27 INS32 INS42 INS42 INS45 INS42 INS33 INS21 INS45 INS42 INS42 INS42 INS7 INS42 INS27 INS42 INS45 DEL42 DEL42 DEL45 DEL42 DEL32 DEL42 DEL45