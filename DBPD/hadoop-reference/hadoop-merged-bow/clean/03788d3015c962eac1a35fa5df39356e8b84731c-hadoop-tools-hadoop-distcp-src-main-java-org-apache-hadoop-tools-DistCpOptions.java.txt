HDFS-10397. Distcp should ignore -delete option if -diff option is provided instead of exiting. Contributed by Mingliang Liu.

-    validate(DistCpOptionSwitch.ATOMIC_COMMIT, atomicCommit);
-    validate(DistCpOptionSwitch.SYNC_FOLDERS, syncFolder);
-    validate(DistCpOptionSwitch.DELETE_MISSING, deleteMissing);
-    validate(DistCpOptionSwitch.OVERWRITE, overwrite);
-    validate(DistCpOptionSwitch.APPEND, append);
-    validate(DistCpOptionSwitch.DIFF, useDiff);
-    validate(DistCpOptionSwitch.SKIP_CRC, skipCRC);
-  public void validate(DistCpOptionSwitch option, boolean value) {
-
-    boolean syncFolder = (option == DistCpOptionSwitch.SYNC_FOLDERS ?
-        value : this.syncFolder);
-    boolean overwrite = (option == DistCpOptionSwitch.OVERWRITE ?
-        value : this.overwrite);
-    boolean deleteMissing = (option == DistCpOptionSwitch.DELETE_MISSING ?
-        value : this.deleteMissing);
-    boolean atomicCommit = (option == DistCpOptionSwitch.ATOMIC_COMMIT ?
-        value : this.atomicCommit);
-    boolean skipCRC = (option == DistCpOptionSwitch.SKIP_CRC ?
-        value : this.skipCRC);
-    boolean append = (option == DistCpOptionSwitch.APPEND ? value : this.append);
-    boolean useDiff = (option == DistCpOptionSwitch.DIFF ? value : this.useDiff);
+  void validate() {
+    if (useDiff && deleteMissing) {
+      // -delete and -diff are mutually exclusive. For backward compatibility,
+      // we ignore the -delete option here, instead of throwing an
+      // IllegalArgumentException. See HDFS-10397 for more discussion.
+      OptionsParser.LOG.warn("-delete and -diff are mutually exclusive. " +
+          "The -delete option will be ignored.");
+      setDeleteMissing(false);
+    }
-    if ((!syncFolder || deleteMissing) && useDiff) {
+    if (!syncFolder && useDiff) {

INS25 INS27 INS8 UPD27 MOV27 INS42 INS42 INS21 INS21 UPD42 INS32 INS32 INS40 INS42 INS27 INS42 INS9 INS45 INS45 DEL42 DEL40 DEL42 DEL32 DEL21 DEL42 DEL40 DEL42 DEL32 DEL21 DEL42 DEL40 DEL42 DEL32 DEL21 DEL42 DEL40 DEL42 DEL32 DEL21 DEL42 DEL40 DEL42 DEL32 DEL21 DEL42 DEL40 DEL42 DEL32 DEL21 DEL42 DEL40 DEL42 DEL32 DEL21 DEL83 DEL42 DEL43 DEL42 DEL44 DEL39 DEL42 DEL44 DEL39 DEL42 DEL42 DEL40 DEL27 DEL42 DEL52 DEL42 DEL22 DEL16 DEL36 DEL59 DEL60 DEL39 DEL42 DEL42 DEL40 DEL27 DEL42 DEL52 DEL42 DEL22 DEL16 DEL36 DEL59 DEL60 DEL39 DEL42 DEL42 DEL40 DEL27 DEL42 DEL52 DEL42 DEL22 DEL16 DEL36 DEL59 DEL60 DEL39 DEL42 DEL42 DEL40 DEL27 DEL42 DEL52 DEL42 DEL22 DEL16 DEL36 DEL59 DEL60 DEL39 DEL42 DEL42 DEL40 DEL27 DEL42 DEL52 DEL42 DEL22 DEL16 DEL36 DEL59 DEL60 DEL39 DEL42 DEL42 DEL40 DEL27 DEL42 DEL52 DEL42 DEL22 DEL16 DEL36 DEL59 DEL60 DEL39 DEL42 DEL42 DEL40 DEL27 DEL42 DEL52 DEL42 DEL22 DEL16 DEL36 DEL59 DEL60 DEL36 DEL42 DEL27