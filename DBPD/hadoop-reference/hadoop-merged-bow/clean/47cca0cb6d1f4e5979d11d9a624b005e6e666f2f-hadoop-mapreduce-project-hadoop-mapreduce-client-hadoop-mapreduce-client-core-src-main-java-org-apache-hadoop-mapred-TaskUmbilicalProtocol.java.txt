MAPREDUCE-5196. Add bookkeeping for managing checkpoints of task state.
Contributed by Carlo Curino


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1553939 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.mapreduce.checkpoint.CheckpointID;
+import org.apache.hadoop.mapreduce.checkpoint.FSCheckpointID;
+import org.apache.hadoop.mapreduce.checkpoint.TaskCheckpointID;
+   * Version 20 Added methods to manage checkpoints
-  public static final long versionID = 19L;
+  public static final long versionID = 20L;
-   * Report child's progress to parent.
+   * Report child's progress to parent. Also invoked to report still alive (used
+   * to be in ping). It reports an AMFeedback used to propagate preemption requests.
-  boolean statusUpdate(TaskAttemptID taskId, TaskStatus taskStatus) 
+  AMFeedback statusUpdate(TaskAttemptID taskId, TaskStatus taskStatus) 
-  /** Periodically called by child to check if parent is still alive. 
-   * @return True if the task is known
-   */
-  boolean ping(TaskAttemptID taskid) throws IOException;
-
+  /**
+   * Report to the AM that the task has been succesfully preempted.
+   *
+   * @param taskId task's id
+   * @param taskStatus status of the child
+   * @throws IOException
+   */
+  void preempted(TaskAttemptID taskId, TaskStatus taskStatus)
+      throws IOException, InterruptedException;
+
+  /**
+   * Return the latest CheckpointID for the given TaskID. This provides
+   * the task with a way to locate the checkpointed data and restart from
+   * that point in the computation.
+   *
+   * @param taskID task's id
+   * @return the most recent checkpoint (if any) for this task
+   * @throws IOException
+   */
+  TaskCheckpointID getCheckpointID(TaskID taskID);
+
+  /**
+   * Send a CheckpointID for a given TaskID to be stored in the AM,
+   * to later restart a task from this checkpoint.
+   * @param tid
+   * @param cid
+   */
+  void setCheckpointID(TaskID tid, TaskCheckpointID cid);
+

INS26 INS26 INS26 MOV31 INS40 INS40 INS40 INS31 INS31 INS43 UPD39 UPD42 INS44 INS43 INS29 INS43 INS42 INS44 INS29 INS39 INS42 INS44 INS44 UPD34 INS42 UPD65 INS65 INS65 UPD42 INS43 INS42 INS42 INS65 INS65 INS65 INS65 INS42 INS43 INS42 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS66 UPD66 INS66 UPD66 INS42 UPD66 INS42 INS66 INS42 INS42 INS66 INS66 INS66 INS42 INS66 INS66 INS42 INS42 INS66 INS66 INS42 INS42 INS42 INS42 DEL39