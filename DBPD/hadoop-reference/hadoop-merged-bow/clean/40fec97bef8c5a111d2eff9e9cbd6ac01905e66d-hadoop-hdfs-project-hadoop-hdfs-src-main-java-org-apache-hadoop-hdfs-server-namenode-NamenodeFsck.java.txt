svn merge -c -1534417 . for reverting HDFS-4885, which should be committed to trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1534424 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.hdfs.server.blockmanagement.BlockPlacementStatus;
-      BlockPlacementStatus blockPlacementStatus = 
-          BlockPlacementPolicy.getInstance(conf, null, networktopology).
-              verifyBlockPlacement(path, lBlk, targetFileReplication);
-      if (!blockPlacementStatus.isPlacementPolicySatisfied()) {
+      int missingRacks = BlockPlacementPolicy.getInstance(conf, null, networktopology).
+                           verifyBlockPlacement(path, lBlk, Math.min(2,targetFileReplication));
+      if (missingRacks > 0) {
-                    block + ". " + blockPlacementStatus.getErrorDescription());
+                    block +
+                    ". Block should be additionally replicated on " + 
+                    missingRacks + " more rack(s).");

INS39 INS27 UPD42 INS42 INS34 INS32 INS42 INS42 INS34 MOV42 UPD45 INS42 INS45 DEL40 DEL26 DEL42 DEL43 DEL42 DEL42 DEL32 DEL38 DEL42 DEL42 DEL32