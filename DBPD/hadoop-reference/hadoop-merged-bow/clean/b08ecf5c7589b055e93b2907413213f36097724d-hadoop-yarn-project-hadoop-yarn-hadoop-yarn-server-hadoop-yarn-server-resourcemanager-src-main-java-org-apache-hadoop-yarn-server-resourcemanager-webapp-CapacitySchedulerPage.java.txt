YARN-4304. AM max resource configuration per partition to be displayed/updated correctly in UI and in various partition related metrics. (Sunil G via wangda)

-import org.apache.hadoop.yarn.server.resourcemanager.webapp.dao.PartitionResourceUsageInfo;
+import org.apache.hadoop.yarn.server.resourcemanager.webapp.dao.PartitionResourcesInfo;
+import org.apache.hadoop.yarn.util.resource.Resources;
-      PartitionResourceUsageInfo resourceUsages =
+      PartitionResourcesInfo resourceUsages =
+
+      // Get UserInfo from first user to calculate AM Resource Limit per user.
+      ResourceInfo userAMResourceLimit = null;
+      ArrayList<UserInfo> usersList = lqinfo.getUsers().getUsersList();
+      if (usersList.isEmpty()) {
+        // If no users are present, consider AM Limit for that queue.
+        userAMResourceLimit = resourceUsages.getAMLimit();
+      } else {
+        userAMResourceLimit = usersList.get(0)
+            .getResourceUsageInfo().getPartitionResourceUsageInfo(label)
+            .getAMLimit();
+      }
+      ResourceInfo amUsed = (resourceUsages.getAmUsed() == null)
+          ? new ResourceInfo(Resources.none())
+          : resourceUsages.getAmUsed();
-      _("Used Resources:", resourceUsages.getUsed().toString());
+      _("Used Resources:", resourceUsages.getUsed().toString()).
+      _("Configured Max Application Master Limit:", StringUtils.format("%.1f",
+          capacities.getMaxAMLimitPercentage())).
+      _("Max Application Master Resources:",
+          resourceUsages.getAMLimit().toString()).
+      _("Used Application Master Resources:",
+          amUsed.toString()).
+      _("Max Application Master Resources Per User:",
+          userAMResourceLimit.toString());
-      _("Max Application Master Resources:", lqinfo.getAMResourceLimit().toString()).
-      _("Used Application Master Resources:", lqinfo.getUsedAMResource().toString()).
-      _("Max Application Master Resources Per User:", lqinfo.getUserAMResourceLimit().toString()).
+        PartitionResourcesInfo resourceUsages = lqinfo
+            .getResources()
+            .getPartitionResourceUsageInfo((nodeLabel == null) ? "" : nodeLabel);
+        ResourceInfo amUsed = (resourceUsages.getAmUsed() == null)
+            ? new ResourceInfo(Resources.none())
+            : resourceUsages.getAmUsed();
-            .td(lqinfo.getUserAMResourceLimit().toString())
-            .td(userInfo.getAMResourcesUsed().toString())
+            .td(resourceUsages.getAMLimit().toString())
+            .td(amUsed.toString())

INS26 UPD40 INS40 INS60 INS60 INS25 INS60 UPD43 INS43 INS59 INS74 INS59 INS32 INS8 INS8 INS43 INS59 INS32 MOV32 UPD42 INS42 INS42 INS33 INS43 INS43 INS42 INS32 INS42 INS42 INS21 INS21 INS42 INS42 INS16 INS32 INS42 INS45 INS32 UPD45 MOV32 INS60 INS60 INS42 INS42 INS32 INS42 INS7 INS7 INS36 INS14 INS32 INS32 INS42 INS45 INS32 INS42 INS42 UPD45 MOV16 MOV32 INS43 INS59 INS43 INS59 INS42 INS42 INS42 INS32 INS42 INS32 INS27 INS43 INS32 INS42 INS42 INS32 INS42 INS45 INS32 INS42 INS42 UPD45 MOV16 MOV42 MOV42 INS42 INS42 INS32 INS42 INS42 INS16 INS42 INS42 INS32 INS42 INS32 INS33 INS42 INS42 INS42 MOV32 INS42 INS45 INS32 INS32 INS42 UPD45 MOV32 MOV42 UPD42 MOV42 INS32 INS42 INS16 INS36 INS14 INS32 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS45 INS32 INS42 INS42 UPD45 UPD42 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS36 INS45 INS42 INS27 INS43 INS32 INS42 INS42 INS32 INS42 INS42 INS42 UPD45 MOV32 INS42 INS42 MOV45 INS27 INS32 INS33 INS42 INS42 INS42 INS42 INS42 INS34 UPD45 MOV27 UPD42 UPD42 INS42 INS33 INS42 INS42 UPD42 MOV42 MOV32 UPD42 UPD42 UPD42 DEL42 DEL32 DEL42 DEL32 DEL42 DEL42 DEL45 DEL32 DEL42 DEL45 DEL32 DEL42 DEL45 DEL32 DEL42 DEL32