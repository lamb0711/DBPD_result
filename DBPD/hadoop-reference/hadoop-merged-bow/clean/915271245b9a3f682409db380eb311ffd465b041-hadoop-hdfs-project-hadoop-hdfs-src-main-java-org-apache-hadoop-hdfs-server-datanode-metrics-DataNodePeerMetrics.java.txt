Make DataNodePeerMetrics#minOutlierDetectionSamples configurable (#1314). Contributed by Lisheng Sun.

Signed-off-by: sunlisheng <sunlisheng@xiaomi.com>
-import com.google.common.annotations.VisibleForTesting;
+import org.apache.hadoop.conf.Configuration;
+import static org.apache.hadoop.hdfs.DFSConfigKeys.DFS_DATANODE_PEER_METRICS_MIN_OUTLIER_DETECTION_SAMPLES_DEFAULT;
+import static org.apache.hadoop.hdfs.DFSConfigKeys.DFS_DATANODE_PEER_METRICS_MIN_OUTLIER_DETECTION_SAMPLES_KEY;
+
-  @VisibleForTesting
-  static final long MIN_OUTLIER_DETECTION_SAMPLES = 1000;
+  private final long minOutlierDetectionSamples;
-  public DataNodePeerMetrics(final String name) {
+  public DataNodePeerMetrics(final String name, Configuration conf) {
+    minOutlierDetectionSamples = conf.getLong(
+        DFS_DATANODE_PEER_METRICS_MIN_OUTLIER_DETECTION_SAMPLES_KEY,
+        DFS_DATANODE_PEER_METRICS_MIN_OUTLIER_DETECTION_SAMPLES_DEFAULT);
+  long getMinOutlierDetectionSamples() {
+    return minOutlierDetectionSamples;
+  }
+
-  public static DataNodePeerMetrics create(String dnName) {
+  public static DataNodePeerMetrics create(String dnName, Configuration conf) {
-    return new DataNodePeerMetrics(name);
+    return new DataNodePeerMetrics(name, conf);
-            MIN_OUTLIER_DETECTION_SAMPLES);
+            minOutlierDetectionSamples);

MOV26 INS26 INS26 UPD40 INS40 INS40 INS31 UPD83 INS44 INS39 INS42 INS8 INS44 UPD42 INS43 INS42 INS21 INS41 INS43 INS42 INS42 INS7 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 UPD42 DEL42 DEL78 DEL34