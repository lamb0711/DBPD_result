HADOOP-6900. Make the iterator returned by FileSystem#listLocatedStatus to throw IOException rather than RuntimeException when there is an IO error fetching the next file. Contributed by Hairong Kuang. 



git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@984301 13f79535-47bb-0310-9956-ffa450edef68

-        Iterator<FileStatus> list = listStatusIterator(dst);
+        RemoteIterator<FileStatus> list = listStatusIterator(dst);
-  protected Iterator<FileStatus> listStatusIterator(final Path f)
+  protected RemoteIterator<FileStatus> listStatusIterator(final Path f)
-    return new Iterator<FileStatus>() {
+    return new RemoteIterator<FileStatus>() {
-      
-      @Override
-      public void remove() {
-        throw new UnsupportedOperationException("Remove is not supported");
-      }
-  protected Iterator<LocatedFileStatus> listLocatedStatus(final Path f)
+  protected RemoteIterator<LocatedFileStatus> listLocatedStatus(final Path f)
-    return new Iterator<LocatedFileStatus>() {
-      private Iterator<FileStatus> itor = listStatusIterator(f);
+    return new RemoteIterator<LocatedFileStatus>() {
+      private RemoteIterator<FileStatus> itor = listStatusIterator(f);
-      /**
-       *  {@inheritDoc}
-       *  @return {@inheritDog} 
-       *  @throws Runtimeexception if any IOException occurs during traversal;
-       *  the IOException is set as the cause of the RuntimeException
-       */
-      public boolean hasNext() {
+      public boolean hasNext() throws IOException {
-      /**
-       *  {@inheritDoc}
-       *  @return {@inheritDoc} 
-       *  @throws Runtimeexception if any IOException occurs during traversal;
-       *  the IOException is set as the cause of the RuntimeException
-       *  @exception {@inheritDoc}
-       */
-      public LocatedFileStatus next() {
+      public LocatedFileStatus next() throws IOException {
-        try {
-          
-          BlockLocation[] locs = null;
-          if (result.isFile()) {
-            locs = getFileBlockLocations(
+        BlockLocation[] locs = null;
+        if (result.isFile()) {
+          locs = getFileBlockLocations(
-          }
-          return new LocatedFileStatus(result, locs);
-        } catch (IOException ioe) {
-          throw (RuntimeException)new RuntimeException().initCause(ioe);
-      }
-      
-      @Override
-      public void remove() {
-        throw new UnsupportedOperationException("Remove is not supported");
+        return new LocatedFileStatus(result, locs);

MOV31 UPD74 MOV29 UPD83 UPD74 MOV74 UPD42 MOV44 MOV43 MOV43 MOV43 MOV43 UPD43 UPD43 INS41 UPD42 UPD42 INS14 UPD74 UPD74 MOV74 INS1 UPD43 UPD43 MOV23 INS31 INS31 UPD42 UPD42 UPD74 MOV78 INS83 INS39 INS42 INS43 MOV8 MOV78 INS83 MOV43 INS42 MOV43 MOV8 UPD74 UPD43 UPD42 MOV42 MOV25 MOV60 UPD43 UPD42 UPD42 DEL42 DEL78 DEL83 DEL39 DEL42 DEL42 DEL43 DEL45 DEL14 DEL53 DEL8 DEL31 DEL65 DEL65 DEL66 DEL65 DEL66 DEL65 DEL42 DEL66 DEL66 DEL65 DEL66 DEL65 DEL29 DEL42 DEL44 DEL42 DEL43 DEL43 DEL14 DEL42 DEL42 DEL32 DEL11 DEL53 DEL8 DEL12 DEL54 DEL83 DEL42 DEL65 DEL65 DEL66 DEL65 DEL66 DEL65 DEL42 DEL66 DEL66 DEL65 DEL29 DEL83 DEL39 DEL42 DEL31 DEL42 DEL78 DEL83 DEL39 DEL42 DEL42 DEL43 DEL45 DEL14 DEL53 DEL8 DEL31 DEL1 DEL14 DEL41 DEL8 DEL31