HDFS-7719. BlockPoolSliceStorage#removeVolumes fails to remove some in-memory state associated with volumes. (Lei (Eddy) Xu via Colin P. McCabe)

-   * Remove storage directories.
-   * @param storageDirs a set of storage directories to be removed.
+   * Remove block pool level storage directory.
+   * @param absPathToRemove the absolute path of the root for the block pool
+   *                        level storage to remove.
-  void removeVolumes(Set<File> storageDirs) {
+  void remove(File absPathToRemove) {
+    Preconditions.checkArgument(absPathToRemove.isAbsolute());
+    LOG.info("Removing block level storage: " + absPathToRemove);
-      if (storageDirs.contains(sd.getRoot())) {
+      if (sd.getRoot().getAbsoluteFile().equals(absPathToRemove)) {
+        break;

UPD42 MOV43 INS42 INS21 INS21 UPD66 UPD42 INS66 UPD66 INS32 INS32 INS42 INS42 INS32 INS42 INS42 INS27 INS42 INS42 INS45 INS42 INS32 MOV32 MOV42 INS42 INS42 INS10 UPD42 DEL42 DEL43 DEL74 DEL42 DEL42