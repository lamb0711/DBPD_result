Merge trunk into branch.

Branch will not build after this commit: need to implement new JournalManager
interfaces in QuorumJournalManager in a follow-up.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3077@1371518 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.security.authentication.client.ConnectionConfigurator;
+import javax.net.ssl.HttpsURLConnection;
+import java.net.HttpURLConnection;
-public class SSLFactory {
+public class SSLFactory implements ConnectionConfigurator {
+  /**
+   * If the given {@link HttpURLConnection} is an {@link HttpsURLConnection}
+   * configures the connection with the {@link SSLSocketFactory} and
+   * {@link HostnameVerifier} of this SSLFactory, otherwise does nothing.
+   *
+   * @param conn the {@link HttpURLConnection} instance to configure.
+   * @return the configured {@link HttpURLConnection} instance.
+   *
+   * @throws IOException if an IO error occurred.
+   */
+  @Override
+  public HttpURLConnection configure(HttpURLConnection conn)
+    throws IOException {
+    if (conn instanceof HttpsURLConnection) {
+      HttpsURLConnection sslConn = (HttpsURLConnection) conn;
+      try {
+        sslConn.setSSLSocketFactory(createSSLSocketFactory());
+      } catch (GeneralSecurityException ex) {
+        throw new IOException(ex);
+      }
+      sslConn.setHostnameVerifier(getHostnameVerifier());
+      conn = sslConn;
+    }
+    return conn;
+  }

INS26 INS26 INS26 INS40 INS40 INS40 INS43 INS31 INS42 INS29 INS78 INS83 INS43 INS42 INS44 INS43 INS8 INS65 INS65 INS65 INS65 INS42 INS42 INS43 INS42 INS42 INS25 INS41 INS66 INS65 INS66 INS65 INS66 INS65 INS66 INS65 INS66 INS42 INS66 INS65 INS66 INS66 INS65 INS66 INS42 INS66 INS42 INS62 INS8 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS60 INS54 INS21 INS21 INS42 INS43 INS59 INS8 INS12 INS32 INS7 INS42 INS42 INS11 INS21 INS44 INS8 INS42 INS42 INS32 INS42 INS42 INS43 INS42 INS32 INS43 INS42 INS53 INS42 INS42 INS42 INS42 INS32 INS42 INS14 INS42 INS43 INS42 INS42