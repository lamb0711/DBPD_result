YARN-4356. Ensure the timeline service v.2 is disabled cleanly and has no
impact when it's turned off. Contributed by Sangjin Lee.

-import org.apache.hadoop.yarn.api.records.ContainerId;
+import org.apache.hadoop.yarn.exceptions.YarnException;
-import org.apache.hadoop.yarn.server.api.ContainerContext;
+    if (!YarnConfiguration.timelineServiceV2Enabled(conf)) {
+      throw new YarnException("Timeline service v2 is not enabled");
+    }
-      launchServer(String[] args, NodeTimelineCollectorManager collectorManager) {
+      launchServer(String[] args, NodeTimelineCollectorManager collectorManager,
+      Configuration conf) {
-      YarnConfiguration conf = new YarnConfiguration();
-    launchServer(args, null);
+    Configuration conf = new YarnConfiguration();
+    conf.setBoolean(YarnConfiguration.TIMELINE_SERVICE_ENABLED, true);
+    conf.setFloat(YarnConfiguration.TIMELINE_SERVICE_VERSION, 2.0f);
+    launchServer(args, null, conf);

MOV26 UPD40 INS44 INS25 INS43 INS42 MOV60 INS21 INS21 INS38 INS8 INS42 UPD43 INS32 INS32 INS32 INS53 UPD42 INS42 INS42 INS40 INS9 INS42 INS42 INS40 INS34 INS42 INS42 INS42 INS42 INS14 INS43 INS45 INS42 DEL40 DEL26