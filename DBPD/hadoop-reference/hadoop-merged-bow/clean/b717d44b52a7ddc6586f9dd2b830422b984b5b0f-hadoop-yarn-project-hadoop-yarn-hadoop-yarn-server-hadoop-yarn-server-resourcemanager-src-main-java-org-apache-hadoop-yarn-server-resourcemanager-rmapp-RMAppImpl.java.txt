YARN-614. Changed ResourceManager to not count disk failure, node loss and RM restart towards app failures. Contributed by Xuan Gong

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1606407 13f79535-47bb-0310-9956-ffa450edef68

-          // previously NonPreempted attempts + 1) equal to the max-attempt
+          // previously failed attempts(which should not include Preempted,
+          // hardware error and NM resync) + 1) equal to the max-attempt
-          maxAppAttempts == (getNumNonPreemptedAppAttempts() + 1));
+          maxAppAttempts == (getNumFailedAppAttempts() + 1));
-                  && app.getNumNonPreemptedAppAttempts() == app.maxAppAttempts))) {
+                  && app.getNumFailedAppAttempts() == app.maxAppAttempts))) {
-    } else if (getNumNonPreemptedAppAttempts() >= this.maxAppAttempts) {
+    } else if (getNumFailedAppAttempts() >= this.maxAppAttempts) {
-  private int getNumNonPreemptedAppAttempts() {
+  private int getNumFailedAppAttempts() {
-    // Do not count AM preemption as attempt failure.
+    // Do not count AM preemption, hardware failures or NM resync
+    // as attempt failure.
-      if (!attempt.isPreempted()) {
+      if (attempt.shouldCountTowardsMaxAttemptRetry()) {
-          && app.getNumNonPreemptedAppAttempts() < app.maxAppAttempts) {
+          && app.getNumFailedAppAttempts() < app.maxAppAttempts) {

UPD42 INS32 UPD42 MOV42 UPD42 MOV42 UPD42 UPD42 UPD42 DEL32 DEL38