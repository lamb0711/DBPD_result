HDFS-15359. EC: Allow closing a file with committed blocks. Contributed by Ayush Saxena.

-   * the block.
+   * the block. In case of erasure coding blocks, adds only in case there
+   * isn't any missing node.
-    if (!blk.isStriped()) {
-      DatanodeStorageInfo[] expectedStorages =
-          blk.getUnderConstructionFeature().getExpectedStorageLocations();
+    boolean addForStriped = false;
+    DatanodeStorageInfo[] expectedStorages =
+        blk.getUnderConstructionFeature().getExpectedStorageLocations();
+    if (blk.isStriped()) {
+      BlockInfoStriped blkStriped = (BlockInfoStriped) blk;
+      addForStriped =
+          blkStriped.getRealTotalBlockNum() == expectedStorages.length;
+    }
+    if (!blk.isStriped() || addForStriped) {

INS60 MOV60 INS25 UPD66 INS66 INS39 INS59 INS32 INS8 INS27 INS42 INS9 INS42 INS42 INS60 INS21 MOV38 INS42 INS43 INS59 INS7 INS42 INS42 INS11 INS42 INS27 INS43 INS42 INS32 INS40 INS42 INS42 INS42