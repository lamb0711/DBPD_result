YARN-7778. Merging of placement constraints defined at different levels. Contributed by Weiwei Yang.

-    // TODO do proper merge on different level of constraints, see YARN-7778.
-
-    // Request level constraint
-    PlacementConstraint constraint = request.getPlacementConstraint();
-    if (constraint == null) {
-      // Application level constraint
-      constraint = pcm.getConstraint(applicationId,
-          request.getAllocationTags());
-      if (constraint == null) {
-        // Global level constraint
-        constraint = pcm.getGlobalConstraint(request.getAllocationTags());
-        if (constraint == null) {
-          return true;
-        }
-      }
+    Set<String> sourceTags = null;
+    PlacementConstraint pc = null;
+    if (request != null) {
+      sourceTags = request.getAllocationTags();
+      pc = request.getPlacementConstraint();
-    return canSatisfyConstraints(applicationId, constraint, schedulerNode, atm);
+    return canSatisfyConstraints(applicationId,
+        pcm.getMultilevelConstraint(applicationId, sourceTags, pc),
+        schedulerNode, atm);

INS60 INS74 MOV43 INS59 UPD27 INS43 INS43 UPD42 INS33 INS42 INS33 UPD42 MOV21 INS32 INS42 INS42 INS42 UPD42 MOV42 INS42 INS42 INS42 UPD42 MOV32 INS42 MOV32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL42 DEL33 DEL27 DEL42 DEL33 DEL27 DEL9 DEL41 DEL8 DEL25 DEL8 DEL25