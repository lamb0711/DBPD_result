HDFS-4244. Support snapshot deletion.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1430953 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.namenode.INode.BlocksMapUpdateInfo;
-   * @param snapshotName
-   *          The name of the snapshot.
+   * @param snapshotName
+   *          The name of the snapshot.
-  public void createSnapshot(final String snapshotName, final String path
+  public void createSnapshot(final String path, final String snapshotName
+  
+  /**
+   * Delete a snapshot for a snapshottable directory
+   * @param path Path to the directory where the snapshot was taken
+   * @param snapshotName Name of the snapshot to be deleted
+   * @param collectedBlocks Used to collect information to update blocksMap 
+   * @throws IOException
+   */
+  public void deleteSnapshot(final String path, final String snapshotName,
+      BlocksMapUpdateInfo collectedBlocks) throws IOException {
+    // parse the path, and check if the path is a snapshot path
+    INodesInPath inodesInPath = fsdir.getMutableINodesInPath(path.toString());
+    // transfer the inode for path to an INodeDirectorySnapshottable.
+    // the INodeDirectorySnapshottable#valueOf method will throw Exception 
+    // if the path is not for a snapshottable directory
+    INodeDirectorySnapshottable dir = INodeDirectorySnapshottable.valueOf(
+        inodesInPath.getLastINode(), path.toString());
+    
+    dir.removeSnapshot(snapshotName, collectedBlocks);
+    numSnapshots.getAndDecrement();
+  }

INS26 INS40 MOV44 INS31 MOV65 INS29 INS83 INS39 INS42 INS44 INS44 INS44 INS43 INS8 INS65 INS65 INS65 INS65 INS65 INS83 INS43 INS42 INS83 INS43 INS42 INS43 INS42 INS42 INS60 INS60 INS21 INS21 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS42 INS42 INS43 INS59 INS43 INS59 INS32 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS32 INS42 INS42 INS42 INS42 INS42 INS42