HADOOP-15625. S3A input stream to use etags/version number to detect changed source files.

Author: Ben Roling <ben.roling@gmail.com>

Initial patch from Brahma Reddy Battula.

+import org.apache.hadoop.fs.PathIOException;
+import org.apache.hadoop.fs.s3a.impl.ChangeTracker;
+  public static final String OPERATION_OPEN = "open";
+  public static final String OPERATION_REOPEN = "re-open";
+
+  /** change tracker. */
+  private final ChangeTracker changeTracker;
+
+    this.changeTracker = new ChangeTracker(uri,
+        ctx.getChangeDetectionPolicy(),
+        streamStatistics.getVersionMismatchCounter());
-    String text = String.format("Failed to %s %s at %d",
-        (opencount == 0 ? "open" : "re-open"), uri, targetPos);
+    String operation = opencount == 0 ? OPERATION_OPEN : OPERATION_REOPEN;
+    String text = String.format("%s %s at %d",
+        operation, uri, targetPos);
+    changeTracker.maybeApplyConstraint(request);
+
+    changeTracker.processResponse(object, operation,
+        targetPos);
-      throw new IOException("Null IO stream from reopen of (" + reason +  ") "
-          + uri);
+      throw new PathIOException(uri,
+          "Null IO stream from " + operation + " of (" + reason +  ") ");
+      sb.append(changeTracker);

INS26 INS26 INS40 INS40 INS23 INS23 INS23 INS83 INS83 INS83 INS43 INS59 INS83 INS83 INS83 INS43 INS59 INS29 INS83 INS83 INS43 INS59 INS42 INS42 INS45 INS42 INS42 INS45 INS65 INS42 INS42 INS21 INS60 INS21 INS21 INS66 INS7 MOV43 INS59 INS43 INS32 INS32 INS22 INS14 INS42 MOV16 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS21 INS52 INS42 INS43 INS42 INS32 INS32 INS42 INS42 UPD45 INS42 INS32 INS42 INS42 INS42 INS42 INS42 UPD43 INS42 INS42 INS42 INS42 UPD42 UPD45 INS42 INS45 DEL45 DEL45 DEL36 DEL42