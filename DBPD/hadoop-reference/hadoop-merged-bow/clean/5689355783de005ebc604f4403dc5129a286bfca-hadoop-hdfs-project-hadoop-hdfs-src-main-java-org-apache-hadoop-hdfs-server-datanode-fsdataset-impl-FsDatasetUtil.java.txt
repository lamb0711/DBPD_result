HDFS-13768. Adding replicas to volume map makes DataNode start slowly. Contributed by Surendra Singh Lilhore.

-   * Find the meta-file for the specified block file
-   * and then return the generation stamp from the name of the meta-file.
+   * Find the meta-file for the specified block file and then return the
+   * generation stamp from the name of the meta-file. Generally meta file will
+   * be the next file in sorted array of file's.
+   *
+   * @param listdir
+   *          sorted list of file based on name.
+   * @param blockFile
+   *          block file for which generation stamp is needed.
+   * @param index
+   *          index of block file in array.
+   * @return generation stamp for block file.
-  static long getGenerationStampFromFile(File[] listdir, File blockFile)
-      throws IOException {
+  static long getGenerationStampFromFile(File[] listdir, File blockFile,
+      int index) {
-    for (int j = 0; j < listdir.length; j++) {
-      String path = listdir[j].getName();
-      if (!path.startsWith(blockName)) {
-        continue;
+    if ((index + 1) < listdir.length) {
+      // Check if next index file is meta file
+      String metaFile = listdir[index + 1].getName();
+      if (metaFile.startsWith(blockName)) {
+        return Block.getGenerationStamp(metaFile);
-      if (blockFile.getCanonicalPath().equals(listdir[j].getCanonicalPath())) {
-        continue;
-      }
-      return Block.getGenerationStamp(listdir[j].getName());

INS44 INS8 INS65 INS65 INS65 INS65 INS39 INS42 MOV60 INS25 MOV21 MOV41 UPD66 UPD66 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS66 INS27 INS8 INS36 MOV40 MOV60 INS25 INS27 INS32 INS8 UPD42 MOV42 INS34 UPD42 UPD42 MOV42 MOV42 MOV42 MOV41 INS27 UPD42 MOV42 INS42 INS34 DEL42 DEL42 DEL42 DEL2 DEL32 DEL42 DEL43 DEL39 DEL42 DEL34 DEL59 DEL58 DEL27 DEL42 DEL37 DEL32 DEL38 DEL18 DEL8 DEL25 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL2 DEL42 DEL32 DEL32 DEL18 DEL8 DEL25 DEL8 DEL24 DEL8