HDFS-7056. Snapshot support for truncate. Contributed by Konstantin Shvachko and Plamen Jeliazkov.
-    if (latestSnapshotId == Snapshot.CURRENT_STATE_ID) {
+    if (latestSnapshotId == Snapshot.CURRENT_STATE_ID ||
+        latestSnapshotId == Snapshot.NO_SNAPSHOT_ID) {
-      if (toDelete != null) {
-        toDeleteList.add(toDelete);
-      }
+      assert toDelete != null : "toDelete is null";
+      toDeleteList.add(toDelete);
-    
+
+    public void removeDeleteBlock(Block block) {
+      assert block != null : "block is null";
+      toDeleteList.remove(block);
+    }
+

INS31 MOV8 INS83 INS39 INS42 INS44 INS8 INS27 INS6 INS43 INS42 INS6 INS21 MOV27 INS27 MOV27 INS45 INS42 INS27 INS45 INS32 INS42 INS40 INS42 INS33 INS42 INS42 INS42 DEL25 DEL8