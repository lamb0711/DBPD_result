HDFS-6210. Support GETACLSTATUS operation in WebImageViewer. Contributed by Akira Ajisaka.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1589933 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.fs.permission.AclEntry;
+   * Return the JSON formatted ACL status of the specified file.
+   * @param path a path specifies a file
+   * @return JSON formatted AclStatus
+   * @throws IOException if failed to serialize fileStatus to JSON.
+   */
+  String getAclStatus(String path) throws IOException {
+    StringBuilder sb = new StringBuilder();
+    List<AclEntry> aclEntryList = getAclEntryList(path);
+    PermissionStatus p = getPermissionStatus(path);
+    sb.append("{\"AclStatus\":{\"entries\":[");
+    int i = 0;
+    for (AclEntry aclEntry : aclEntryList) {
+      if (i++ != 0) {
+        sb.append(',');
+      }
+      sb.append('"');
+      sb.append(aclEntry.toString());
+      sb.append('"');
+    }
+    sb.append("],\"group\": \"");
+    sb.append(p.getGroupName());
+    sb.append("\",\"owner\": \"");
+    sb.append(p.getUserName());
+    sb.append("\",\"stickyBit\": ");
+    sb.append(p.getPermission().getStickyBit());
+    sb.append("}}\n");
+    return sb.toString();
+  }
+
+  private List<AclEntry> getAclEntryList(String path) {
+    long id = getINodeId(path);
+    FsImageProto.INodeSection.INode inode = inodes.get(id);
+    switch (inode.getType()) {
+      case FILE: {
+        FsImageProto.INodeSection.INodeFile f = inode.getFile();
+        return FSImageFormatPBINode.Loader.loadAclEntries(
+            f.getAcl(), stringTable);
+      }
+      case DIRECTORY: {
+        FsImageProto.INodeSection.INodeDirectory d = inode.getDirectory();
+        return FSImageFormatPBINode.Loader.loadAclEntries(
+            d.getAcl(), stringTable);
+      }
+      default: {
+        return new ArrayList<AclEntry>();
+      }
+    }
+  }
+
+  private PermissionStatus getPermissionStatus(String path) {
+    long id = getINodeId(path);
+    FsImageProto.INodeSection.INode inode = inodes.get(id);
+    switch (inode.getType()) {
+      case FILE: {
+        FsImageProto.INodeSection.INodeFile f = inode.getFile();
+        return FSImageFormatPBINode.Loader.loadPermission(
+            f.getPermission(), stringTable);
+      }
+      case DIRECTORY: {
+        FsImageProto.INodeSection.INodeDirectory d = inode.getDirectory();
+        return FSImageFormatPBINode.Loader.loadPermission(
+            d.getPermission(), stringTable);
+      }
+      case SYMLINK: {
+        FsImageProto.INodeSection.INodeSymlink s = inode.getSymlink();
+        return FSImageFormatPBINode.Loader.loadPermission(
+            s.getPermission(), stringTable);
+      }
+      default: {
+        return null;
+      }
+    }
+  }
+
+  /**

INS26 INS40 INS31 INS31 INS31 INS29 INS43 INS42 INS44 INS43 INS8 INS83 INS74 INS42 INS44 INS8 INS83 INS43 INS42 INS44 INS8 INS65 INS65 INS65 INS65 INS42 INS43 INS42 INS42 INS60 INS60 INS60 INS21 INS60 INS70 INS21 INS21 INS21 INS21 INS21 INS21 INS21 INS41 INS43 INS43 INS43 INS42 INS60 INS60 INS50 INS42 INS43 INS42 INS60 INS60 INS50 INS66 INS42 INS66 INS66 INS42 INS66 INS42 INS43 INS59 INS74 INS59 INS43 INS59 INS32 INS39 INS59 INS44 INS42 INS8 INS32 INS32 INS32 INS32 INS32 INS32 INS32 INS32 INS42 INS42 INS42 INS39 INS59 INS43 INS59 INS32 INS49 INS8 INS49 INS8 INS49 INS8 INS42 INS39 INS59 INS43 INS59 INS32 INS49 INS8 INS49 INS8 INS49 INS8 INS49 INS8 INS42 INS42 INS14 INS43 INS43 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS45 INS42 INS34 INS43 INS42 INS25 INS21 INS21 INS21 INS42 INS42 INS45 INS42 INS42 INS32 INS42 INS42 INS45 INS42 INS42 INS32 INS42 INS42 INS45 INS42 INS42 INS32 INS42 INS42 INS45 INS42 INS42 INS42 INS32 INS40 INS42 INS32 INS42 INS42 INS42 INS60 INS41 INS42 INS60 INS41 INS41 INS42 INS32 INS40 INS42 INS32 INS42 INS42 INS42 INS60 INS41 INS42 INS60 INS41 INS42 INS60 INS41 INS41 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS27 INS8 INS32 INS32 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS59 INS32 INS43 INS59 INS32 INS14 INS42 INS42 INS42 INS42 INS42 INS43 INS59 INS32 INS43 INS59 INS32 INS43 INS59 INS32 INS33 INS42 INS37 INS34 INS21 INS42 INS42 INS13 INS42 INS42 INS32 INS42 INS42 INS13 INS42 INS42 INS40 INS42 INS32 INS40 INS42 INS32 INS42 INS40 INS42 INS32 INS40 INS42 INS32 INS42 INS74 INS40 INS42 INS32 INS40 INS42 INS32 INS42 INS40 INS42 INS32 INS40 INS42 INS32 INS42 INS40 INS42 INS32 INS40 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS13 INS42 INS42