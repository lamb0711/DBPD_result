HDFS-14768. EC : Busy DN replica should be consider in live replica check. Contributed by guojh.

-        containingLiveReplicasNodes, numReplicas,
+        containingLiveReplicasNodes, numReplicas, new ArrayList<Byte>(),
+    List<Byte> liveBusyBlockIndices = new ArrayList<>();
-        liveBlockIndices, priority);
+        liveBlockIndices, liveBusyBlockIndices, priority);
+      byte[] busyIndices = new byte[liveBusyBlockIndices.size()];
+      for (int i = 0; i < liveBusyBlockIndices.size(); i++) {
+        busyIndices[i] = liveBusyBlockIndices.get(i);
+      }
-          priority, indices);
+          priority, indices, busyIndices);
-      NumberReplicas numReplicas,
-      List<Byte> liveBlockIndices, int priority) {
+      NumberReplicas numReplicas, List<Byte> liveBlockIndices,
+      List<Byte> liveBusyBlockIndices, int priority) {
-      if (priority != LowRedundancyBlocks.QUEUE_HIGHEST_PRIORITY
-          && (!node.isDecommissionInProgress() && !node.isEnteringMaintenance())
-          && node.getNumberOfBlocksToBeReplicated() >= maxReplicationStreams) {
-        continue; // already reached replication limit
-      }
-
+      if (priority != LowRedundancyBlocks.QUEUE_HIGHEST_PRIORITY
+          && (!node.isDecommissionInProgress() && !node.isEnteringMaintenance())
+          && node.getNumberOfBlocksToBeReplicated() >= maxReplicationStreams) {
+        if (isStriped && state == StoredReplicaState.LIVE) {
+          liveBusyBlockIndices.add(blockIndex);
+        }
+        continue; // already reached replication limit
+      }
+
+        if (isStriped && state == StoredReplicaState.LIVE) {
+          liveBusyBlockIndices.add(blockIndex);
+        }

INS44 INS60 INS74 INS42 INS74 INS59 INS43 INS43 MOV25 INS14 INS43 INS43 INS42 INS14 INS60 INS24 INS42 INS42 INS74 INS42 INS42 INS74 INS42 INS5 INS59 INS58 INS27 INS37 INS8 INS43 INS43 INS43 INS39 INS85 INS42 INS3 INS39 INS59 INS42 INS32 INS42 INS21 INS42 INS25 INS25 INS42 INS42 INS42 INS5 INS32 INS42 INS34 INS42 INS42 INS7 INS27 INS8 INS27 INS8 INS39 INS85 INS42 INS42 INS2 INS32 INS42 INS27 INS21 INS42 INS27 INS21 INS42 INS42 INS42 INS42 INS42 INS42 INS40 INS32 INS42 INS40 INS32 INS42 INS42 INS42 INS42 INS42 INS42