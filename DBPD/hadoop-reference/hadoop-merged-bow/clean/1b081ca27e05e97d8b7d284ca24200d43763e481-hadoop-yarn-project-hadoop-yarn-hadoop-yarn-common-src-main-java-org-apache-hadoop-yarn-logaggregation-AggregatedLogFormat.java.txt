YARN-6288. Exceptions during aggregated log writes are mishandled. Contributed by Akira Ajisaka

-  public static class LogWriter {
+  public static class LogWriter implements AutoCloseable {
-    private final FSDataOutputStream fsDataOStream;
-    private final TFile.Writer writer;
+    private FSDataOutputStream fsDataOStream;
+    private TFile.Writer writer;
-    public LogWriter(final Configuration conf, final Path remoteAppLogFile,
-        UserGroupInformation userUgi) throws IOException {
+    /**
+     * Initialize the LogWriter.
+     * Must be called just after the instance is created.
+     * @param conf Configuration
+     * @param remoteAppLogFile remote log file path
+     * @param userUgi Ugi of the user
+     * @throws IOException Failed to initialize
+     */
+    public void initialize(final Configuration conf,
+                           final Path remoteAppLogFile,
+                           UserGroupInformation userUgi) throws IOException {
+    @Override
-      try {
-        this.writer.close();
-      } catch (IOException e) {
-        LOG.warn("Exception closing writer", e);
+      if (writer != null) {
+        try {
+          writer.close();
+        } catch (IOException e) {
+          LOG.warn("Exception closing writer", e);
+        }

INS43 INS42 INS29 INS39 UPD42 INS78 INS65 INS65 INS65 INS65 INS65 INS42 INS25 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS27 INS8 INS42 INS33 MOV54 INS42 DEL83 DEL83 DEL52 DEL42 DEL22