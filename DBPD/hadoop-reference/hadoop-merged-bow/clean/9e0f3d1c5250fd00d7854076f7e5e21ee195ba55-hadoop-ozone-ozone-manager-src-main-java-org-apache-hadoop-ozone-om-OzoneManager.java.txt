HDDS-1038. Support Service Level Authorization for Ozone. Contributed by Xiaoyu Yao and Ajay Kumar.

+import org.apache.hadoop.fs.CommonConfigurationKeys;
-    if (!testSecureOmFlag || !isOzoneSecurityEnabled()) {
-      scmContainerClient = getScmContainerClient(configuration);
-      // verifies that the SCM info in the OM Version file is correct.
-      scmBlockClient = getScmBlockClient(configuration);
+    scmContainerClient = getScmContainerClient(configuration);
+    // verifies that the SCM info in the OM Version file is correct.
+    scmBlockClient = getScmBlockClient(configuration);
+
+    // For testing purpose only, not hit scm from om as Hadoop UGI can't login
+    // two principals in the same JVM.
+    if (!testSecureOmFlag) {
-    } else {
-      // For testing purpose only
-      scmContainerClient = null;
-      scmBlockClient = null;
+
+    if (conf.getBoolean(CommonConfigurationKeys.HADOOP_SECURITY_AUTHORIZATION,
+        false)) {
+      rpcServer.refreshServiceAcl(conf, OMPolicyProvider.getInstance());
+    }

INS26 INS40 MOV21 MOV21 INS25 MOV38 INS32 INS8 INS42 INS42 INS40 INS9 INS21 INS32 INS42 INS42 INS42 INS32 INS42 INS42 DEL42 DEL32 DEL38 DEL27 DEL42 DEL33 DEL7 DEL21 DEL42 DEL33 DEL7 DEL21 DEL8