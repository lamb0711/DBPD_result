HDFS-2653. DFSClient should cache whether addrs are non-local when short-circuiting is enabled. Contributed by Eli Collins


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1213586 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.HashSet;
-import java.util.Set;
-  private static Set<String> localIpAddresses = Collections
-      .synchronizedSet(new HashSet<String>());
+  private static Map<String, Boolean> localAddrMap = Collections
+      .synchronizedMap(new HashMap<String, Boolean>());
-    if (localIpAddresses.contains(addr.getHostAddress())) {
+    Boolean cached = localAddrMap.get(addr.getHostAddress());
+    if (cached != null && cached) {
-    if (local == true) {
-      localIpAddresses.add(addr.getHostAddress());
-    }
+    localAddrMap.put(addr.getHostAddress(), local);

UPD74 UPD43 INS43 UPD42 INS60 MOV21 UPD42 INS42 UPD42 INS43 INS59 INS27 UPD74 INS42 INS42 MOV32 INS27 INS42 UPD42 UPD42 INS42 UPD43 INS43 UPD42 UPD42 INS42 INS33 UPD42 INS42 DEL40 DEL26 DEL40 DEL26 DEL42 DEL9 DEL27 DEL8 DEL25