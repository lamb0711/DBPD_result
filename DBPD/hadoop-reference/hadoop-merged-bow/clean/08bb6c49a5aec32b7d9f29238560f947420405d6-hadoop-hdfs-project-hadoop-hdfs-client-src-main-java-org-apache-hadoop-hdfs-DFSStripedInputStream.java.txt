HDFS-13926. ThreadLocal aggregations for FileSystem.Statistics are incorrect with striped reads.
Contributed by Xiao Chen, Hrishikesh Gadre.

Signed-off-by: Xiao Chen <xiao@apache.org>

+import static org.apache.hadoop.hdfs.util.IOUtilsClient.updateReadStatistics;
+
+   * Update read statistics. Note that this has to be done on the thread that
+   * initiates the read, rather than inside each async thread, for
+   * {@link org.apache.hadoop.fs.FileSystem.Statistics} to work correctly with
+   * its ThreadLocal.
+   *
+   * @param stats striped read stats
+   */
+  void updateReadStats(final StripedBlockUtil.BlockReadStats stats) {
+    if (stats == null) {
+      return;
+    }
+    updateReadStatistics(readStatistics, stats.getBytesRead(),
+        stats.isShortCircuit(), stats.getNetworkDistance());
+    dfsClient.updateFileSystemReadStats(stats.getNetworkDistance(),
+        stats.getBytesRead());
+    assert readStatistics.getBlockType() == BlockType.STRIPED;
+    dfsClient.updateFileSystemECReadStats(stats.getBytesRead());
+  }
+
+  /**

INS26 INS40 INS31 INS29 INS39 INS42 INS44 INS8 INS65 INS65 INS83 INS43 INS42 INS25 INS21 INS21 INS6 INS21 INS66 INS66 INS65 INS66 INS66 INS42 INS66 INS40 INS27 INS8 INS32 INS32 INS27 INS32 INS40 INS42 INS33 INS41 INS42 INS42 INS32 INS32 INS32 INS42 INS42 INS32 INS32 INS32 INS40 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42