HDFS-7097. Allow block reports to be processed during checkpointing on standby name node. (kihwal via wang)

+  /** 
+   * Checkpoint lock to protect FSNamesystem modification on standby NNs.
+   * Unlike fsLock, it does not affect block updates. On active NNs, this lock
+   * does not provide proper protection, because there are operations that
+   * modify both block and name system state.  Even on standby, fsLock is 
+   * used when block state changes need to be blocked.
+   */
+  private final ReentrantLock cpLock;
+
+    cpLock = new ReentrantLock();
+
+  /** Lock the checkpoint lock */
+  public void cpLock() {
+    this.cpLock.lock();
+  }
+
+  /** Lock the checkpoint lock interrupibly */
+  public void cpLockInterruptibly() throws InterruptedException {
+    this.cpLock.lockInterruptibly();
+  }
+
+  /** Unlock the checkpoint lock */
+  public void cpUnlock() {
+    this.cpLock.unlock();
+  }
+    
+
-
+    cpLock();  // Block if a checkpointing is in progress on standby.
+      cpUnlock();
+    cpLock();  // Block if a checkpointing is in progress on standby.
+      cpUnlock();
+    cpLock();  // Block if a checkpointing is in progress on standby.
+      cpUnlock();
+  public ReentrantLock getCpLockForTests() {
+    return cpLock;
+  }
+
+  @VisibleForTesting

INS23 INS31 INS31 INS31 INS31 INS29 INS83 INS83 INS43 INS59 INS29 INS83 INS39 INS42 INS8 INS29 INS83 INS39 INS42 INS43 INS8 INS29 INS83 INS39 INS42 INS8 INS78 INS83 INS43 INS42 INS8 INS65 INS42 INS42 INS21 INS65 INS21 INS65 INS42 INS21 INS65 INS21 INS21 INS21 INS21 INS42 INS42 INS41 INS66 INS66 INS66 INS66 INS66 INS7 INS66 INS32 INS66 INS32 INS66 INS32 INS32 INS32 INS8 INS32 MOV8 INS42 INS42 INS14 INS22 INS42 INS22 INS42 INS22 INS42 INS42 INS21 INS42 MOV21 INS21 INS42 INS21 INS43 INS52 INS42 INS52 INS42 INS52 INS42 INS32 INS32 INS32 INS42 INS42 INS42 INS42 DEL8