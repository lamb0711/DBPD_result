YARN-9697. Efficient allocation of Opportunistic containers. Contributed by Abhishek Modi.

-import org.apache.hadoop.yarn.server.scheduler.DistributedOpportunisticContainerAllocator;
+import org.apache.hadoop.yarn.server.resourcemanager.scheduler.distributed.CentralizedOpportunisticContainerAllocator;
-    this.oppContainerAllocator =
-        new DistributedOpportunisticContainerAllocator(
-            rmContext.getContainerTokenSecretManager(),
-            maxAllocationsPerAMHeartbeat);
-        new NodeQueueLoadMonitor(nodeSortInterval, comparator);
+        new NodeQueueLoadMonitor(nodeSortInterval, comparator, numNodes);
+    this.oppContainerAllocator =
+        new CentralizedOpportunisticContainerAllocator(
+            rmContext.getContainerTokenSecretManager(),
+            maxAllocationsPerAMHeartbeat, nodeMonitor);
+  protected void serviceStop() throws Exception {
+    if (nodeMonitor != null) {
+      nodeMonitor.stop();
+    }
+    super.serviceStop();
+  }
+
+  @Override

UPD40 INS31 MOV21 INS78 INS83 INS39 INS42 INS43 INS8 INS42 INS42 INS25 INS21 MOV43 INS27 INS8 INS48 INS42 INS33 INS21 INS42 MOV43 INS42 UPD43 INS42 INS32 UPD42 INS42 INS42