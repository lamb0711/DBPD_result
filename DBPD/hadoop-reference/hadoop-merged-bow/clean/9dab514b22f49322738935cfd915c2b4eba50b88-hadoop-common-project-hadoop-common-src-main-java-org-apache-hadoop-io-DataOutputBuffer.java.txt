HDFS-6038. Allow JournalNode to handle editlog produced by new release with future layoutversion. Contributed by Jing Zhao.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1579813 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.base.Preconditions;
+
+
+    /**
+     * Set the count for the current buf.
+     * @param newCount the new count to set
+     * @return the original count
+     */
+    private int setCount(int newCount) {
+      Preconditions.checkArgument(newCount >= 0 && newCount <= buf.length);
+      int oldCount = count;
+      count = newCount;
+      return oldCount;
+    }
+
+  /**
+   * Overwrite an integer into the internal buffer. Note that this call can only
+   * be used to overwrite existing data in the buffer, i.e., buffer#count cannot
+   * be increased, and DataOutputStream#written cannot be increased.
+   */
+  public void writeInt(int v, int offset) throws IOException {
+    Preconditions.checkState(offset + 4 <= buffer.getLength());
+    byte[] b = new byte[4];
+    b[0] = (byte) ((v >>> 24) & 0xFF);
+    b[1] = (byte) ((v >>> 16) & 0xFF);
+    b[2] = (byte) ((v >>> 8) & 0xFF);
+    b[3] = (byte) ((v >>> 0) & 0xFF);
+    int oldCount = buffer.setCount(offset);
+    buffer.write(b);
+    buffer.setCount(oldCount);
+  }

INS26 INS40 INS31 INS31 INS29 INS83 INS39 INS42 INS44 INS44 INS43 INS8 INS29 INS83 INS39 INS42 INS44 INS8 INS65 INS39 INS42 INS39 INS42 INS42 INS21 INS60 INS21 INS21 INS21 INS21 INS60 INS21 INS21 INS65 INS65 INS65 INS39 INS42 INS21 INS60 INS21 INS41 INS66 INS66 INS66 INS32 INS5 INS59 INS7 INS7 INS7 INS7 INS39 INS59 INS32 INS32 INS66 INS42 INS66 INS66 INS32 INS39 INS59 INS7 INS42 INS42 INS42 INS27 INS39 INS85 INS42 INS3 INS2 INS11 INS2 INS11 INS2 INS11 INS2 INS11 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS27 INS42 INS42 INS42 INS42 INS27 INS32 INS5 INS34 INS42 INS34 INS39 INS36 INS42 INS34 INS39 INS36 INS42 INS34 INS39 INS36 INS42 INS34 INS39 INS36 INS42 INS42 INS42 INS27 INS27 INS42 INS34 INS42 INS42 INS39 INS85 INS27 INS27 INS27 INS27 INS42 INS34 INS42 INS40 INS36 INS34 INS36 INS34 INS36 INS34 INS36 INS34 INS27 INS27 INS27 INS27 INS42 INS34 INS42 INS34 INS42 INS34 INS42 INS34