HDFS-4487. Fix snapshot diff report for HDFS-4446.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1446385 13f79535-47bb-0310-9956-ffa450edef68

+  
+  /**
+   * Check if changes have happened between two snapshots.
+   * @param earlierSnapshot The snapshot taken earlier
+   * @param laterSnapshot The snapshot taken later
+   * @return Whether or not modifications (including diretory/file metadata
+   *         change, file creation/deletion under the directory) have happened
+   *         between snapshots.
+   */
+  final boolean changedBetweenSnapshots(Snapshot earlierSnapshot,
+      Snapshot laterSnapshot) {
+    final int size = diffs.size();
+    int earlierDiffIndex = Collections.binarySearch(diffs, earlierSnapshot);
+    if (-earlierDiffIndex - 1 == size) {
+      // if the earlierSnapshot is after the latest SnapshotDiff stored in
+      // diffs, no modification happened after the earlierSnapshot
+      return false;
+    }
+    if (laterSnapshot != null) {
+      int laterDiffIndex = Collections.binarySearch(diffs, laterSnapshot);
+      if (laterDiffIndex == -1 || laterDiffIndex == 0) {
+        // if the laterSnapshot is the earliest SnapshotDiff stored in diffs, or
+        // before it, no modification happened before the laterSnapshot
+        return false;
+      }
+    }
+    return true;
+  }

INS31 INS29 INS83 INS39 INS42 INS44 INS44 INS8 INS65 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS60 INS60 INS25 INS25 INS41 INS66 INS42 INS66 INS42 INS66 INS66 INS66 INS66 INS42 INS42 INS83 INS39 INS59 INS39 INS59 INS27 INS8 INS27 INS8 INS9 INS42 INS32 INS42 INS32 INS27 INS42 INS41 INS42 INS33 INS60 INS25 INS42 INS42 INS42 INS42 INS42 INS42 INS38 INS34 INS9 INS39 INS59 INS27 INS8 INS42 INS42 INS32 INS27 INS27 INS41 INS42 INS42 INS42 INS42 INS42 INS38 INS42 INS34 INS9 INS34