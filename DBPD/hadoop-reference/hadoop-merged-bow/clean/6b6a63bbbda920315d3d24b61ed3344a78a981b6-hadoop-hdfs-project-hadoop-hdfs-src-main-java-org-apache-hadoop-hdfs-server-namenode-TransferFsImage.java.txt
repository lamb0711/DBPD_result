Merge commit '456e901a4c5c639267ee87b8e5f1319f256d20c2' (HDFS-6407. Add sorting and pagination in the datanode tab of the NN Web UI. Contributed by Haohui Mai.) into HDFS-7285-merge

-  
+
+  public enum TransferResult{
+    SUCCESS(HttpServletResponse.SC_OK, false),
+    AUTHENTICATION_FAILURE(HttpServletResponse.SC_FORBIDDEN, true),
+    NOT_ACTIVE_NAMENODE_FAILURE(HttpServletResponse.SC_EXPECTATION_FAILED, false),
+    OLD_TRANSACTION_ID_FAILURE(HttpServletResponse.SC_CONFLICT, false),
+    UNEXPECTED_FAILURE(-1, true);
+
+    private final int response;
+    private final boolean shouldReThrowException;
+
+    private TransferResult(int response, boolean rethrow) {
+      this.response = response;
+      this.shouldReThrowException = rethrow;
+    }
+
+    public static TransferResult getResultForCode(int code){
+      TransferResult ret = UNEXPECTED_FAILURE;
+      for(TransferResult result:TransferResult.values()){
+        if(result.response == code){
+          return result;
+        }
+      }
+      return ret;
+    }
+  }
+
-  public static void uploadImageFromStorage(URL fsName, Configuration conf,
+  public static TransferResult uploadImageFromStorage(URL fsName, Configuration conf,
-    uploadImageFromStorage(fsName, conf, storage, nnf, txid, null);
+    return uploadImageFromStorage(fsName, conf, storage, nnf, txid, null);
-  public static void uploadImageFromStorage(URL fsName, Configuration conf,
+  public static TransferResult uploadImageFromStorage(URL fsName, Configuration conf,
-      if (e.getResponseCode() == HttpServletResponse.SC_CONFLICT) {
-        // this is OK - this means that a previous attempt to upload
-        // this checkpoint succeeded even though we thought it failed.
-        LOG.info("Image upload with txid " + txid + 
-            " conflicted with a previous image upload to the " +
-            "same NameNode. Continuing...", e);
-        return;
-      } else {
+      // translate the error code to a result, which is a bit more obvious in usage
+      TransferResult result = TransferResult.getResultForCode(e.getResponseCode());
+      if (result.shouldReThrowException) {
+      return result;
+    return TransferResult.SUCCESS;

INS71 INS83 INS42 INS72 INS72 INS72 INS72 INS72 INS23 INS23 INS31 INS31 INS43 INS43 INS42 INS40 INS9 INS42 INS40 INS9 INS42 INS40 INS9 INS42 INS40 INS9 INS42 INS38 INS9 INS83 INS83 INS39 INS59 INS83 INS83 INS39 INS59 INS83 INS42 INS44 INS44 INS8 INS83 INS83 INS43 INS42 INS44 INS8 INS42 INS41 INS42 INS41 INS34 INS42 INS42 INS39 INS42 INS39 INS42 INS21 INS21 INS42 INS39 INS42 INS60 INS70 INS41 MOV32 INS40 INS7 INS7 INS43 INS59 INS44 INS32 INS8 INS42 INS8 INS22 INS42 INS22 INS42 INS42 INS42 INS42 INS43 INS42 INS42 INS42 INS25 INS60 INS25 MOV41 INS52 INS42 INS52 INS42 INS42 INS27 INS8 INS43 INS59 INS40 MOV8 INS42 INS40 INS42 INS41 INS42 INS42 INS32 INS42 INS42 UPD42 MOV42 MOV32 DEL39 DEL21 DEL39 DEL40 DEL27 DEL42 DEL42 DEL45 DEL42 DEL45 DEL45 DEL27 DEL32 DEL21 DEL8 DEL25 DEL8