HADOOP-13103 Group resolution from LDAP may fail on javax.naming.ServiceUnavailableException

-import java.io.FileReader;
+import java.util.Collections;
-import javax.naming.CommunicationException;
-import org.apache.hadoop.io.IOUtils;
-  public static int RECONNECT_RETRY_COUNT = 3;
+  public static final int RECONNECT_RETRY_COUNT = 3;
-  public synchronized List<String> getGroups(String user) throws IOException {
-    List<String> emptyResults = new ArrayList<String>();
+  public synchronized List<String> getGroups(String user) {
-    try {
-      return doGetGroups(user);
-    } catch (CommunicationException e) {
-      LOG.warn("Connection is closed, will try to reconnect");
-    } catch (NamingException e) {
-      LOG.warn("Exception trying to get groups for user " + user + ": "
-          + e.getMessage());
-      return emptyResults;
-    }
-
-    int retryCount = 0;
-    while (retryCount ++ < RECONNECT_RETRY_COUNT) {
-      //reset ctx so that new DirContext can be created with new connection
-      this.ctx = null;
-      
+    for(int retry = 0; retry < RECONNECT_RETRY_COUNT; retry++) {
-      } catch (CommunicationException e) {
-        LOG.warn("Connection being closed, reconnecting failed, retryCount = " + retryCount);
-        LOG.warn("Exception trying to get groups for user " + user + ":"
-            + e.getMessage());
-        return emptyResults;
+        LOG.warn("Failed to get groups for user " + user + " (retry=" + retry
+            + ") by " + e);
+        LOG.trace("TRACE", e);
+
+      //reset ctx so that new DirContext can be created with new connection
+      this.ctx = null;
-    return emptyResults;
+    return Collections.emptyList();
+    if (LOG.isDebugEnabled()) {
+      LOG.debug("doGetGroups(" + user + ") return " + groups);
+    }

MOV26 UPD40 INS83 INS24 INS25 INS58 INS27 INS37 INS8 INS32 INS32 INS8 INS39 INS59 INS42 MOV42 INS42 MOV54 MOV21 INS42 INS42 INS42 INS42 INS21 UPD42 MOV42 MOV34 MOV8 INS12 INS32 MOV44 INS8 INS42 INS42 INS27 MOV21 MOV21 INS45 INS42 INS45 INS42 UPD42 INS45 MOV42 INS45 INS42 UPD45 UPD42 INS45 INS42 DEL40 DEL26 DEL40 DEL26 DEL42 DEL43 DEL45 DEL42 DEL45 DEL42 DEL32 DEL27 DEL42 DEL42 DEL32 DEL41 DEL8 DEL42 DEL43 DEL42 DEL44 DEL8 DEL12 DEL42 DEL43 DEL42 DEL44 DEL42 DEL41 DEL8 DEL12 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL42 DEL43 DEL42 DEL43 DEL74 DEL14 DEL59 DEL60 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL45 DEL32 DEL21 DEL8 DEL12 DEL42 DEL42 DEL45 DEL42 DEL45 DEL42 DEL42 DEL32 DEL27 DEL32 DEL21 DEL42 DEL41 DEL8 DEL12 DEL54 DEL39 DEL59 DEL60 DEL42 DEL37 DEL27 DEL8 DEL61 DEL42