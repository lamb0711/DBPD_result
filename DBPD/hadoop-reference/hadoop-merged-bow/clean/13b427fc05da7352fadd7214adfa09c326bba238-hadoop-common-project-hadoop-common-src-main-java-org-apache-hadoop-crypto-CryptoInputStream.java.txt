HDFS-14564: Add libhdfs APIs for readFully; add readFully to ByteBufferPositionedReadable (#963) Contributed by Sahil Takiar.

Reviewed-by: Siyao Meng <smeng@cloudera.com>
-      throw new UnsupportedOperationException("This stream does not support " +
-          "positioned read.");
+      throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " does not support positioned read.");
-      throw new UnsupportedOperationException("This stream does not support " +
-          "positioned reads with byte buffers.");
+      throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " does not support positioned reads with byte buffers.");
-  
+
+  /**
+   * Positioned readFully using {@link ByteBuffer}s. This method is thread-safe.
+   */
+  @Override
+  public void readFully(long position, final ByteBuffer buf)
+      throws IOException {
+    checkStream();
+    if (!(in instanceof ByteBufferPositionedReadable)) {
+      throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " does not support positioned reads with byte buffers.");
+    }
+    int bufPos = buf.position();
+    ((ByteBufferPositionedReadable) in).readFully(position, buf);
+    final int n = buf.position() - bufPos;
+    if (n > 0) {
+      // This operation does not change the current offset of the file
+      decrypt(position, buf, n, bufPos);
+    }
+  }
+
-      throw new UnsupportedOperationException("This stream does not support " +
-          "positioned readFully.");
+      throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " does not support positioned readFully.");
-        throw new UnsupportedOperationException("This stream does not " +
-                "support seek.");
+        throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+            + " does not support seek.");
-      throw new UnsupportedOperationException("This stream does not support " +
-          "seekToNewSource.");
+      throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " does not support seekToNewSource.");
-        throw new UnsupportedOperationException("This stream does not " +
-                "support seek.");
+        throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+            + " does not support seek.");
-      throw new UnsupportedOperationException("This stream does not support " +
-          "enhanced byte buffer access.");
+      throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " does not support enhanced byte buffer access.");
-      throw new UnsupportedOperationException("This stream does not support " + 
-          "release buffer.");
+      throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " does not support release buffer.");
-      throw new UnsupportedOperationException("This stream does not support " +
-          "setting the readahead caching strategy.");
+      throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " does not support setting the readahead caching strategy.");
-      throw new UnsupportedOperationException("This stream does not " +
-          "support setting the drop-behind caching setting.");
+      throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " stream does not support setting the drop-behind caching"
+          + " setting.");
-        throw new UnsupportedOperationException("This stream does not expose " +
-          "its stream capabilities.");
+        throw new UnsupportedOperationException(in.getClass().getCanonicalName()
+          + " does not expose its stream capabilities.");

MOV31 INS31 INS29 INS78 INS42 INS44 INS44 INS43 MOV78 INS83 INS39 INS42 MOV44 INS8 INS65 INS42 INS39 INS42 INS83 INS43 INS42 INS42 INS21 INS60 INS21 INS60 INS25 INS25 MOV21 INS66 INS65 INS66 INS42 INS32 INS39 INS59 INS32 INS83 INS39 INS59 INS27 INS8 MOV38 INS38 MOV38 INS8 MOV38 MOV38 INS42 INS42 INS42 INS32 INS36 INS42 INS42 INS42 INS42 INS27 INS42 INS34 INS21 INS36 INS53 INS42 INS42 INS11 INS32 INS42 INS32 MOV38 INS62 INS14 UPD43 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 MOV43 INS43 INS42 INS43 MOV43 MOV43 INS27 MOV43 MOV43 INS32 UPD45 INS32 UPD45 UPD42 INS32 UPD45 INS42 INS32 UPD45 INS42 INS32 UPD45 INS42 INS32 UPD45 INS32 INS45 INS32 UPD45 INS32 UPD45 UPD45 INS32 INS42 INS32 INS42 INS32 INS42 INS32 INS42 MOV43 INS32 INS42 INS43 INS32 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS32 UPD45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 UPD45 INS42 INS42 INS42 INS32 UPD45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL45 DEL45 DEL42 DEL45 DEL45 DEL45 DEL45 DEL45 DEL45 DEL45 DEL45