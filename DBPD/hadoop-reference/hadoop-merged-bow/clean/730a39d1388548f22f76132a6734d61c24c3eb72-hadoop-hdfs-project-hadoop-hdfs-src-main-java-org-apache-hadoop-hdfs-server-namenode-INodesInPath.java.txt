HDFS-15372. Files in snapshots no longer see attribute provider permissions. Contributed by Stephen O'Donnell.

Signed-off-by: Wei-Chiu Chuang <weichiu@apache.org>

+  /**
+   * Returns true if the given path component starts with the same byte stream
+   * as {@link HdfsConstants#DOT_SNAPSHOT_DIR}, indicating the component
+   * starts with a DotSnapshot directory.
+   * @param pathComponent Bytes representing the pathComponent
+   * @return True is the component starts with
+   *         {@link HdfsConstants#DOT_SNAPSHOT_DIR} and false otherwise.
+   */
+  private static boolean isDotSnapshotDirPrefix(byte[] pathComponent) {
+    return pathComponent != null &&
+        isDotSnapshotDir(Arrays.copyOf(
+            pathComponent, HdfsServerConstants.DOT_SNAPSHOT_DIR_BYTES.length));
+  }
+
+  /**
+   * Retrieves the existing INodes from a path, starting at the root directory.
+   * The root directory is located by following the parent link in the inode
+   * recursively until the final root inode is found.
+   * The inodes returned will depend upon the output of inode.getFullPathName().
+   * For a snapshot path, like /data/.snapshot/snap1, it will be resolved to:
+   *     [null, data, .snapshot/snap1]
+   * For a file in the snapshot, as inode.getFullPathName resolves the snapshot
+   * information, the returned inodes for a path like /data/.snapshot/snap1/d1
+   * would be:
+   *     [null, data, d1]
+   * @param inode the {@link INode} to be resolved
+   * @return INodesInPath
+   */
+  static INodesInPath resolveFromRoot(INode inode) {
+    INode[] inodes = getINodes(inode);
+    byte[][] paths = INode.getPathComponents(inode.getFullPathName());
+    INodeDirectory rootDir = inodes[0].asDirectory();
+    return resolve(rootDir, paths);
+  }
+
+   * @return Return true if .snapshot is the prefix of the last path component.
+   */
+  boolean isDotSnapshotDirPrefix() {
+    return isDotSnapshotDirPrefix(getLastLocalName());
+  }
+
+  /**

INS31 INS31 INS31 INS29 INS83 INS83 INS39 INS42 INS44 INS8 INS29 INS83 INS43 INS42 INS44 INS8 INS29 INS39 INS42 INS8 INS65 INS65 INS65 INS5 INS42 INS41 INS65 INS65 INS65 INS42 INS43 INS42 INS60 INS60 INS60 INS41 INS65 INS41 INS66 INS66 INS65 INS66 INS66 INS42 INS66 INS66 INS65 INS66 INS39 INS85 INS27 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS42 INS66 INS65 INS66 INS66 INS42 INS5 INS59 INS5 INS59 INS43 INS59 INS32 INS66 INS32 INS67 INS67 INS27 INS32 INS42 INS43 INS85 INS42 INS32 INS39 INS85 INS85 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS33 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS32 INS2 INS42 INS42 INS42 INS42 INS42 INS40 INS42 INS42 INS42 INS34