HDFS-4906. HDFS Output streams should not accept writes after being closed. Contributed by Aaron T. Myers.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1494303 13f79535-47bb-0310-9956-ffa450edef68

+import java.nio.channels.ClosedChannelException;
+    private boolean isClosed = false;
-      flushBuffer();
-      sums.close();
-      datas.close();
+      try {
+        flushBuffer();
+        sums.close();
+        datas.close();
+      } finally {
+        isClosed = true;
+      }
+
+    @Override
+    protected void checkClosed() throws IOException {
+      if (isClosed) {
+        throw new ClosedChannelException();
+      }
+    }

INS26 INS40 INS23 INS31 INS83 INS39 INS59 INS8 INS78 INS83 INS39 INS42 INS43 INS8 INS42 INS9 INS54 INS42 INS42 INS25 MOV8 INS8 INS42 INS8 INS21 INS53 INS7 INS14 INS42 INS9 INS43 INS42