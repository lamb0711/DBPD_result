MAPREDUCE-3250. When AM restarts, client keeps reconnecting to the new AM and prints a lots of logs. (vinodkv via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1189023 13f79535-47bb-0310-9956-ffa450edef68

-  private boolean forceRefresh;
-    if (!forceRefresh && realProxy != null) {
+    if (realProxy != null) {
-    while (application == null || YarnApplicationState.RUNNING == application.getYarnApplicationState()) {
+    while (application == null
+        || YarnApplicationState.RUNNING == application
+            .getYarnApplicationState()) {
-        instantiateAMProxy(serviceAddr);
+        realProxy = instantiateAMProxy(serviceAddr);
-  private void instantiateAMProxy(final String serviceAddr) throws IOException {
+  MRClientProtocol instantiateAMProxy(final String serviceAddr)
+      throws IOException {
-    realProxy = currentUser.doAs(new PrivilegedAction<MRClientProtocol>() {
+    MRClientProtocol proxy = currentUser
+        .doAs(new PrivilegedAction<MRClientProtocol>() {
+    return proxy;
-        forceRefresh = true;
+        // Force reconnection by setting the proxy to null.
+        realProxy = null;
-        forceRefresh = true;
+        // Force reconnection by setting the proxy to null.
+        realProxy = null;

INS43 INS42 INS60 INS41 MOV27 INS43 INS59 INS42 INS42 INS42 MOV32 INS7 INS42 MOV32 UPD42 INS33 UPD42 INS33 DEL83 DEL39 DEL42 DEL59 DEL23 DEL42 DEL38 DEL27 DEL83 DEL39 DEL42 DEL7 DEL21 DEL9 DEL9