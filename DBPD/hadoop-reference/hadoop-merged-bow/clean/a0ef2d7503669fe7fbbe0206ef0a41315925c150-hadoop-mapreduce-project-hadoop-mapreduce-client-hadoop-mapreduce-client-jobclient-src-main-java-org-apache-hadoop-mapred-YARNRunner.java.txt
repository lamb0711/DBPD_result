MAPREDUCE-2937. Ensure reason for application failure is displayed to the user. Contributed by Mahadev Konar.  


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1166966 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.ipc.VersionedProtocol;
+import org.apache.hadoop.mapreduce.Cluster.JobTrackerStatus;
-import org.apache.hadoop.mapreduce.Cluster.JobTrackerStatus;
-import org.apache.hadoop.yarn.ipc.RPCUtil;
+    this(conf, new ResourceMgrDelegate(conf));
+  }
+
+  /**
+   * Similar to {@link #YARNRunner(Configuration)} but allowing injecting 
+   * {@link ResourceMgrDelegate}. Enables mocking and testing.
+   * @param conf the configuration object for the client
+   * @param resMgrDelegate the resourcemanager client handle.
+   */
+  public YARNRunner(Configuration conf, ResourceMgrDelegate resMgrDelegate) {
-      this.resMgrDelegate = new ResourceMgrDelegate(this.conf);
+      this.resMgrDelegate = resMgrDelegate;
-
+  
-      throw RPCUtil.getRemoteException("failed to run job");
+      throw new IOException("Failed to run job : " + 
+        appMaster.getDiagnostics());
-  private ApplicationSubmissionContext createApplicationSubmissionContext(
+  public ApplicationSubmissionContext createApplicationSubmissionContext(

MOV26 INS31 MOV29 INS83 INS42 INS44 INS8 INS29 INS44 UPD83 INS43 INS42 INS17 INS65 INS65 INS65 INS43 INS42 INS42 INS42 MOV14 INS66 INS65 INS66 INS65 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS68 INS42 INS42 INS69 INS14 INS43 INS42 INS43 INS27 INS42 INS42 INS45 INS32 INS42 INS42 DEL40 DEL26 DEL40 DEL26 DEL52 DEL42 DEL22 DEL42 DEL42 DEL45 DEL32