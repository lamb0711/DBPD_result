Merge r1555021 through r1561943 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1561944 13f79535-47bb-0310-9956-ffa450edef68

-  // Note that fromByte(..) depends on OP_INVALID being at the last position.  
+  // Note that the current range of the valid OP code is 0~127
-  private static final FSEditLogOpCodes[] VALUES = FSEditLogOpCodes.values();
+  private static FSEditLogOpCodes[] VALUES;
+  
+  static {
+    byte max = 0;
+    for (FSEditLogOpCodes code : FSEditLogOpCodes.values()) {
+      if (code.getOpCode() > max) {
+        max = code.getOpCode();
+      }
+    }
+    VALUES = new FSEditLogOpCodes[max + 1];
+    for (FSEditLogOpCodes code : FSEditLogOpCodes.values()) {
+      if (code.getOpCode() >= 0) {
+        VALUES[code.getOpCode()] = code;
+      }
+    }
+  }
-    if (opCode == -1) {
-      return OP_INVALID;
-    }
-    if (opCode >= 0 && opCode < OP_INVALID.ordinal()) {
+    if (opCode >= 0 && opCode < VALUES.length) {
-    return null;
+    return opCode == -1 ? OP_INVALID : null;

INS28 INS83 INS8 INS60 INS70 INS21 INS70 MOV41 INS39 INS59 INS44 MOV32 INS8 INS7 INS44 INS32 INS8 INS16 INS42 INS34 INS43 INS42 INS25 INS42 INS3 INS43 INS42 INS42 INS42 INS25 MOV27 INS42 INS33 INS42 INS27 INS8 INS5 INS27 INS42 INS27 INS8 INS40 INS32 INS42 INS21 INS43 INS85 INS42 INS34 INS32 INS34 INS21 INS42 INS42 INS7 INS42 INS42 INS42 INS7 INS42 INS32 INS2 INS42 INS42 INS42 INS42 INS32 INS42 INS42 DEL83 DEL8 DEL25 DEL42 DEL42 DEL32 DEL42 DEL33 DEL41