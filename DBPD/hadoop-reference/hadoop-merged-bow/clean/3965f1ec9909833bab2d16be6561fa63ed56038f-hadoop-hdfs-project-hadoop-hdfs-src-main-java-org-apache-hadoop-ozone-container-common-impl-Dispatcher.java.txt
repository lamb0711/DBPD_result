HDFS-12853. Ozone: Optimize chunk writes for Ratis by avoiding double writes.  Contributed by Mukul Kumar Singh

-    byte[] data = msg.getWriteChunk().getData().toByteArray();
-    metrics.incContainerBytesStats(Type.WriteChunk, data.length);
-    this.containerManager.getChunkManager().writeChunk(pipeline, keyName,
-        chunkInfo, data);
+    byte[] data = null;
+    if (msg.getWriteChunk().getStage() == ContainerProtos.Stage.WRITE_DATA
+        || msg.getWriteChunk().getStage() == ContainerProtos.Stage.COMBINED) {
+       data = msg.getWriteChunk().getData().toByteArray();
+      metrics.incContainerBytesStats(Type.WriteChunk, data.length);
+
+    }
+    this.containerManager.getChunkManager()
+        .writeChunk(pipeline, keyName, chunkInfo,
+            data, msg.getWriteChunk().getStage());
+
-          .getKeyName(), chunkInfo, data);
+          .getKeyName(), chunkInfo, data, ContainerProtos.Stage.COMBINED);

INS25 INS27 INS8 INS33 INS27 INS27 INS21 MOV21 INS32 INS32 INS40 INS32 INS40 INS7 INS32 INS42 INS32 INS42 INS32 INS42 INS42 MOV32 INS42 INS42 INS40 INS42 INS42 INS42 INS42