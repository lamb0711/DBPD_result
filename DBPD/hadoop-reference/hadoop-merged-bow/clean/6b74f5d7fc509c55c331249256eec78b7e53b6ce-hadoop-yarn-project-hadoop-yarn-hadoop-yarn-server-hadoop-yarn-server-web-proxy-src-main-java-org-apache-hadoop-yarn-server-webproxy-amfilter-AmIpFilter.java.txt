YARN-8197. Fixed AM IP Filter and Webapp proxy to redirect app tracking-URLs correctly when UI is secure. Contributed by Sunil Govindan.

+import org.apache.hadoop.security.UserGroupInformation;
-  private boolean isValidUrl(String url) {
+  @VisibleForTesting
+  public boolean isValidUrl(String url) {
-      HttpURLConnection conn =
-          (HttpURLConnection) new URL(url).openConnection();
+      HttpURLConnection conn = (HttpURLConnection) new URL(url)
+          .openConnection();
+      // If security is enabled, any valid RM which can give 401 Unauthorized is
+      // good enough to access. Since AM doesn't have enough credential, auth
+      // cannot be completed and hence 401 is fine in such case.
+      if (!isValid && UserGroupInformation.isSecurityEnabled()) {
+        isValid = (conn
+            .getResponseCode() == HttpURLConnection.HTTP_UNAUTHORIZED)
+            || (conn.getResponseCode() == HttpURLConnection.HTTP_FORBIDDEN);
+        return isValid;
+      }
-      LOG.debug("Failed to connect to " + url + ": " + e.toString());
+      LOG.warn("Failed to connect to " + url + ": " + e.toString());

INS26 INS40 INS78 UPD83 INS42 INS25 INS27 INS8 INS38 INS32 INS21 INS41 INS42 INS42 INS42 INS7 INS42 UPD42 INS42 INS27 INS36 INS36 INS27 INS27 INS32 INS40 INS32 INS40 INS42 INS42 INS42 INS42