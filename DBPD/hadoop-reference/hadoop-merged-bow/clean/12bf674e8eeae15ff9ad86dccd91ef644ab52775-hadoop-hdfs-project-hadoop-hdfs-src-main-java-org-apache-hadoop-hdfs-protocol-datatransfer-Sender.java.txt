Merge trunk into branch.

Fixed a couple trivial conflicts due to HDFS-4363, which moved some methods
from HdfsProtoUtil to PBHelper


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-347@1433133 13f79535-47bb-0310-9956-ffa450edef68

-import static org.apache.hadoop.hdfs.protocol.HdfsProtoUtil.toProto;
-import static org.apache.hadoop.hdfs.protocol.HdfsProtoUtil.toProtos;
+import org.apache.hadoop.hdfs.protocolPB.PBHelper;
+    if (LOG.isTraceEnabled()) {
+      LOG.trace("Sending DataTransferOp " + proto.getClass().getSimpleName()
+          + ": " + proto);
+    }
-      final long length) throws IOException {
+      final long length,
+      final boolean sendChecksum) throws IOException {
+      .setSendChecksums(sendChecksum)
-      .addAllTargets(toProtos(targets, 1))
+      .addAllTargets(PBHelper.convert(targets, 1))
-      proto.setSource(toProto(source));
+      proto.setSource(PBHelper.convertDatanodeInfo(source));
-      .addAllTargets(toProtos(targets, 0))
+      .addAllTargets(PBHelper.convert(targets))
-      .setSource(toProto(source))
+      .setSource(PBHelper.convertDatanodeInfo(source))

MOV26 UPD40 INS44 INS25 INS83 INS39 INS42 INS32 INS8 INS42 INS42 INS21 INS32 INS32 MOV32 INS42 INS42 INS42 INS27 UPD42 INS42 INS45 INS32 INS45 INS42 INS42 UPD42 UPD42 INS42 INS42 UPD42 INS32 INS42 INS42 INS42 UPD42 INS42 DEL40 DEL26 DEL34