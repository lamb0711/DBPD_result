Merging r1527684 through r1532876 from trunk to branch HDFS-2832

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1532910 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.yarn.conf.YarnConfiguration;
+import org.apache.hadoop.yarn.conf.HAUtil;
+  private boolean haEnabled;
-  public synchronized void serviceInit(Configuration conf) throws Exception {
+  protected synchronized void serviceInit(Configuration conf) throws
+      Exception {
+    haEnabled = HAUtil.isHAEnabled(this.conf);
+    if (haEnabled) {
+      HAUtil.setAllRpcAddresses(this.conf);
+      rm.setConf(this.conf);
+    }
-  public synchronized void serviceStart() throws Exception {
-    boolean haEnabled = this.conf.getBoolean(YarnConfiguration.RM_HA_ENABLED,
-        YarnConfiguration.DEFAULT_RM_HA_ENABLED);
-
+  protected synchronized void serviceStart() throws Exception {
-  public synchronized void serviceStop() throws Exception {
+  protected synchronized void serviceStop() throws Exception {

MOV26 UPD40 INS23 INS83 INS39 INS59 UPD83 UPD83 UPD83 INS42 INS21 INS25 INS7 INS42 INS8 INS42 INS32 INS21 INS21 INS42 INS42 INS22 INS32 INS32 INS52 INS42 INS42 INS42 INS22 INS42 INS42 MOV22 INS52 INS42 DEL39 DEL42 DEL42 DEL40 DEL40 DEL32 DEL59 DEL60