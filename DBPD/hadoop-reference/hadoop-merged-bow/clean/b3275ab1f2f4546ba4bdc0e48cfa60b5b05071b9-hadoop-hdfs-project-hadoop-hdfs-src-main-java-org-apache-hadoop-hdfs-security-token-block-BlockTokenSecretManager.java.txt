HDFS-14305. Fix serial number calculation in BlockTokenSecretManager to avoid token key ID overlap between NameNodes. Contributed by Konstantin V Shvachko.
-    setSerialNo(new SecureRandom().nextInt());
-    generateKeys();
+    setSerialNo(new SecureRandom().nextInt(Integer.MAX_VALUE));
+    LOG.info("Block token key range: [{}, {})",
+        nnRangeStart, nnRangeStart + intRange);
-  public synchronized void setSerialNo(int serialNo) {
+  public synchronized void setSerialNo(int nextNo) {
-    this.serialNo = (serialNo % intRange) + (nnRangeStart);
+    this.serialNo = (nextNo % intRange) + (nnRangeStart);
+    assert serialNo >= nnRangeStart && serialNo < (nnRangeStart + intRange) :
+      "serialNo " + serialNo + " is not in the designated range: [" +
+      nnRangeStart + ", " + (nnRangeStart + intRange) + ")";

MOV21 INS21 UPD42 INS6 INS32 INS27 INS27 INS42 INS42 INS45 INS42 INS27 INS27 INS27 INS45 INS42 INS45 INS42 INS45 INS36 INS45 INS40 INS42 INS42 INS42 INS42 INS42 INS36 INS27 INS27 INS42 INS42 UPD42 INS42 INS42 DEL42 DEL32 DEL21