YARN-8473. Containers being launched as app tears down can leave containers in NEW state. Contributed by Jason Lowe.

+  private static final InitContainerTransition INIT_CONTAINER_TRANSITION =
+      new InitContainerTransition();
+
-               new InitContainerTransition())
+               INIT_CONTAINER_TRANSITION)
-               new InitContainerTransition())
+               INIT_CONTAINER_TRANSITION)
-               new InitContainerTransition())
+               INIT_CONTAINER_TRANSITION)
+              ApplicationEventType.INIT_CONTAINER,
+              INIT_CONTAINER_TRANSITION)
+          .addTransition(ApplicationState.FINISHING_CONTAINERS_WAIT,
+              ApplicationState.FINISHING_CONTAINERS_WAIT,
+              ApplicationEventType.INIT_CONTAINER,
+              INIT_CONTAINER_TRANSITION)
+          .addTransition(ApplicationState.APPLICATION_RESOURCES_CLEANINGUP,
+              ApplicationState.APPLICATION_RESOURCES_CLEANINGUP,
+          .addTransition(ApplicationState.FINISHED,
+              ApplicationState.FINISHED,
+              ApplicationEventType.INIT_CONTAINER,
+              INIT_CONTAINER_TRANSITION)
+                  ApplicationEventType.APPLICATION_CONTAINER_FINISHED,
-      
-      switch (app.getApplicationState()) {
+
+      ApplicationState appState = app.getApplicationState();
+      switch (appState) {
-        assert false : "Invalid state for InitContainerTransition: " +
-            app.getApplicationState();
+        LOG.warn("Killing {} because {} is in state {}",
+            container.getContainerId(), app, appState);
+        app.dispatcher.getEventHandler().handle(new ContainerKillEvent(
+            container.getContainerId(),
+            ContainerExitStatus.KILLED_AFTER_APP_COMPLETION,
+            "Application no longer running.\n"));
+        break;

INS23 INS83 INS83 INS83 INS43 INS59 INS42 INS42 MOV14 INS32 MOV32 INS42 INS60 INS42 INS40 INS40 INS32 INS43 INS59 INS42 INS21 INS21 INS10 UPD40 MOV40 INS42 UPD42 MOV42 INS42 INS40 INS40 INS40 INS42 INS42 MOV32 INS32 INS32 INS42 INS42 INS45 INS32 INS42 INS42 INS32 INS42 INS14 INS32 INS42 INS40 INS40 INS42 INS42 INS40 INS42 INS43 INS32 INS40 INS45 MOV32 MOV42 MOV40 MOV40 INS40 INS42 INS42 INS42 INS42 INS32 INS42 INS40 INS40 MOV32 MOV42 MOV40 MOV40 INS40 INS42 INS42 INS42 INS42 DEL42 DEL43 DEL14 DEL42 DEL43 DEL14 DEL42 DEL42 DEL40 DEL32 DEL42 DEL42 DEL32 DEL9 DEL45 DEL27 DEL6