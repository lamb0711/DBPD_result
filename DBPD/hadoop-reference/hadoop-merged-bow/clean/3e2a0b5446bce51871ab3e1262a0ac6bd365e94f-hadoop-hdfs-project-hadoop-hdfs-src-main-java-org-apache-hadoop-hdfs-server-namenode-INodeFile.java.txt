HDFS-6969. Archival Storage: INode#getStoragePolicyID should always return the latest storage policy. Contributed by Jing Zhao.

-  /** Convert this file to an {@link INodeFileUnderConstruction}. */
-  public byte getStoragePolicyID(int snapshotId) {
-    if (snapshotId != Snapshot.CURRENT_STATE_ID) {
-      return getSnapshotINode(snapshotId).getStoragePolicyID();
-    }
-    return getStoragePolicyID();
+  public byte getLocalStoragePolicyID() {
+    return HeaderFormat.getStoragePolicyID(header);
-    return HeaderFormat.getStoragePolicyID(header);
+    byte id = getLocalStoragePolicyID();
+    if (id == BlockStoragePolicy.ID_UNSPECIFIED) {
+      return this.getParent() != null ?
+          this.getParent().getStoragePolicyID() : id;
+    }
+    return id;

MOV31 UPD42 INS8 INS60 MOV25 MOV41 INS39 INS59 UPD27 INS42 INS42 INS32 UPD42 UPD40 INS42 INS16 INS27 INS32 INS42 INS32 INS33 MOV32 MOV42 INS52 INS42 INS52 UPD42 DEL66 DEL42 DEL65 DEL66 DEL65 DEL29 DEL42 DEL32 DEL42 DEL32 DEL39 DEL42 DEL44 DEL8