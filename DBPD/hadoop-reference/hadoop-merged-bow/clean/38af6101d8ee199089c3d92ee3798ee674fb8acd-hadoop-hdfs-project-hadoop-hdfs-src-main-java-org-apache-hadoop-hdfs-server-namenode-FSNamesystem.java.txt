HDFS-6671. Change BlockPlacementPolicy to consider block storage policy in replicaiton.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-6584@1611334 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.hdfs.StorageType;
-    long blockSize;
-    int replication;
+    final long blockSize;
+    final int replication;
+    final byte storagePolicyID;
+      storagePolicyID = pendingFile.getStoragePolicyID();
-    final DatanodeStorageInfo targets[] = getBlockManager().chooseTarget( 
-        src, replication, clientNode, excludedNodes, blockSize, favoredNodes);
+    final DatanodeStorageInfo targets[] = getBlockManager().chooseTarget4NewBlock( 
+        src, replication, clientNode, excludedNodes, blockSize, favoredNodes,
+        storagePolicyID);
+    final byte storagePolicyID;
+      storagePolicyID = file.getStoragePolicyID();
-    final DatanodeStorageInfo[] targets = blockManager.getBlockPlacementPolicy(
-        ).chooseTarget(src, numAdditionalNodes, clientnode, chosen, true,
-            // TODO: get storage type from the file
-        excludes, preferredblocksize, StorageType.DEFAULT);
+    final DatanodeStorageInfo[] targets = blockManager.chooseTarget4AdditionalDatanode(
+        src, numAdditionalNodes, clientnode, chosen, 
+        excludes, preferredblocksize, storagePolicyID);

INS60 INS60 INS83 INS83 INS83 INS39 INS59 INS83 INS39 INS59 INS42 INS21 INS42 INS21 INS7 UPD42 INS42 INS7 MOV42 UPD42 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS42 DEL40 DEL26 DEL42 DEL32 DEL9 DEL40