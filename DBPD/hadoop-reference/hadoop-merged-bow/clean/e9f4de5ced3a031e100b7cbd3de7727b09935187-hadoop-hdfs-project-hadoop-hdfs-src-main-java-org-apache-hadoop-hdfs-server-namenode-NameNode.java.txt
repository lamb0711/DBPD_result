Merge trunk into branch

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3077@1387449 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.fs.CommonConfigurationKeys;
-    LOG.info(getRole() + " up at: " + rpcServer.getRpcAddress());
+    LOG.info(getRole() + " RPC up at: " + rpcServer.getRpcAddress());
-      LOG.info(getRole() + " service server is up at: "
+      LOG.info(getRole() + " service RPC up at: "
-      this.rpcServer.join();
+      rpcServer.join();
-   * Returns the address on which the NameNodes is listening to.
-   * @return namenode rpc address
+   * @return NameNode RPC address
-  
+
-   * Returns namenode service rpc address, if set. Otherwise returns
-   * namenode rpc address.
-   * @return namenode service rpc address used by datanodes
+   * @return NameNode RPC address in "host:port" string form
-  public InetSocketAddress getServiceRpcAddress() {
-    return rpcServer.getServiceRpcAddress() != null ? rpcServer.getServiceRpcAddress() : rpcServer.getRpcAddress();
+  public String getNameNodeAddressHostPortString() {
+    return NetUtils.getHostPortString(rpcServer.getRpcAddress());
-   * Returns the address of the NameNodes http server, 
-   * which is used to access the name-node web UI.
-   * 
-   * @return the http address.
+   * @return NameNode service RPC address if configured, the
+   *    NameNode RPC address otherwise
+   */
+  public InetSocketAddress getServiceRpcAddress() {
+    final InetSocketAddress serviceAddr = rpcServer.getServiceRpcAddress();
+    return serviceAddr == null ? rpcServer.getRpcAddress() : serviceAddr;
+  }
+
+  /**
+   * @return NameNode HTTP address, used by the Web UI, image transfer,
+   *    and HTTP-based file system clients like Hftp and WebHDFS
+    // If the RPC address is set use it to (re-)configure the default FS
+      LOG.info("Setting " + FS_DEFAULT_NAME_KEY + " to " + defaultUri.toString());
-      if (namenode != null)
+      if (namenode != null) {
+      }

INS31 INS29 INS83 INS43 INS42 INS8 INS65 INS42 INS41 UPD65 INS60 UPD65 UPD66 INS66 INS32 UPD66 UPD66 INS83 INS43 INS59 UPD66 UPD66 INS42 INS42 MOV32 INS42 INS42 MOV32 INS27 INS32 INS42 INS21 UPD45 INS42 INS33 MOV42 UPD42 MOV42 INS32 INS8 INS42 INS42 INS42 INS27 MOV21 UPD45 INS45 INS42 INS45 INS32 INS42 INS42 DEL40 DEL26 DEL52 DEL42 DEL22 DEL66 DEL65 DEL66 DEL65 DEL32 DEL33 DEL27 DEL66 DEL65