YARN-2496. Enhanced Capacity Scheduler to have basic support for allocating resources based on node-labels. Contributed by Wangda Tan.
YARN-2500. Ehnaced ResourceManager to support schedulers allocating resources based on node-labels. Contributed by Wangda Tan.

-    validateResourceRequest(submissionContext);
+    ResourceRequest amReq = validateAndCreateResourceRequest(submissionContext);
-            submissionContext.getApplicationTags());
+            submissionContext.getApplicationTags(), amReq);
-  private void validateResourceRequest(
+  private ResourceRequest validateAndCreateResourceRequest(
-      ResourceRequest amReq = BuilderUtils.newResourceRequest(
-          RMAppAttemptImpl.AM_CONTAINER_PRIORITY, ResourceRequest.ANY,
-          submissionContext.getResource(), 1);
+      ResourceRequest amReq;
+      if (submissionContext.getAMContainerResourceRequest() != null) {
+        amReq = submissionContext.getAMContainerResourceRequest();
+      } else {
+        amReq =
+            BuilderUtils.newResourceRequest(
+                RMAppAttemptImpl.AM_CONTAINER_PRIORITY, ResourceRequest.ANY,
+                submissionContext.getResource(), 1);
+      }
+      
+      // set label expression for AM container
+      if (null == amReq.getNodeLabelExpression()) {
+        amReq.setNodeLabelExpression(submissionContext
+            .getNodeLabelExpression());
+      }
+
-            scheduler.getMaximumResourceCapability());
+            scheduler.getMaximumResourceCapability(),
+            submissionContext.getQueue(), scheduler);
+      
+      return amReq;
+    
+    return null;

MOV43 UPD42 INS60 INS41 INS43 INS59 INS33 INS42 INS42 INS32 INS25 INS25 INS41 UPD42 MOV42 MOV42 INS42 INS43 INS27 INS8 INS8 INS27 INS8 INS42 INS42 INS32 INS33 INS21 INS21 INS33 INS32 INS21 INS42 INS42 INS7 INS7 INS42 INS42 INS32 INS42 INS32 INS42 MOV32 INS42 INS42 INS32 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL32 DEL21 DEL39