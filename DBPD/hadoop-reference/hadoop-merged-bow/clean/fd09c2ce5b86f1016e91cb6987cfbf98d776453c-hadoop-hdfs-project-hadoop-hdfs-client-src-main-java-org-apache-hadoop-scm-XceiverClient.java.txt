HDFS-12890 . Ozone: XceiverClient should have upper bound on async requests. Contributed by Shashikant Banerjee.

+import org.apache.hadoop.ozone.client.OzoneClientUtils;
+import java.util.concurrent.Semaphore;
+  private final Semaphore semaphore;
+    this.semaphore =
+        new Semaphore(OzoneClientUtils.getMaxOutstandingRequests(config));
-        .handler(new XceiverClientInitializer(this.pipeline));
+        .handler(new XceiverClientInitializer(this.pipeline, semaphore));
-      ContainerProtos.ContainerCommandRequestProto request)
-      throws IOException {
+      ContainerProtos.ContainerCommandRequestProto request) throws IOException {
-      throw new IOException("Unexpected exception during execution", e);
+      /**
+       * In case the netty channel handler throws an exception,
+       * the exception thrown will be wrapped within {@link ExecutionException}.
+       * Unwarpping here so that original exception gets passed
+       * to to the client.
+       */
+      if (e instanceof ExecutionException) {
+        Throwable cause = e.getCause();
+        if (cause instanceof IOException) {
+          throw (IOException) cause;
+        }
+      }
+      throw new IOException(
+          "Unexpected exception during execution:" + e.getMessage());

INS26 INS26 INS40 INS40 INS23 INS83 INS83 INS43 INS59 INS42 INS42 INS21 INS7 INS22 INS14 INS52 INS42 INS43 INS32 INS42 INS25 INS42 INS42 INS42 INS42 INS62 INS8 INS42 INS43 INS60 INS25 INS43 INS27 INS42 INS43 INS59 INS62 INS8 INS42 INS45 INS32 INS42 INS42 INS32 INS42 INS43 INS53 INS42 INS42 INS42 INS42 INS42 INS11 MOV43 INS42 DEL45 DEL42