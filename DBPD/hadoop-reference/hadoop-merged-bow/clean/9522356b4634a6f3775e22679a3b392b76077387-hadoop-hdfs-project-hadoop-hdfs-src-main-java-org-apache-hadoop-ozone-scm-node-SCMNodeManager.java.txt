HDFS-12069. Ozone: Create a general abstraction for metadata store. Contributed by Weiwei Yang.

-    if (nodePoolManager.getNodePool(datanodeID) == null) {
-      nodePoolManager.addNode(SCMNodePoolManager.DEFAULT_NODEPOOL, datanodeID);
+    try {
+      if (nodePoolManager.getNodePool(datanodeID) == null) {
+        nodePoolManager.addNode(SCMNodePoolManager.DEFAULT_NODEPOOL,
+            datanodeID);
+      }
+    } catch (IOException e) {
+      // TODO: make sure registration failure is handled correctly.
+      return RegisteredCommand.newBuilder()
+          .setErrorCode(ErrorCode.errorNodeNotPermitted)
+          .build();
-}
+}

INS54 INS8 INS12 MOV25 INS44 INS8 INS43 INS42 INS41 INS42 INS32 INS32 INS42 INS32 INS42 INS40 INS42 INS42