YARN-3542. Refactored existing CPU cgroups support to use the newer and integrated ResourceHandler mechanism, and also deprecated the old LCEResourceHandler inteface hierarchy. Contributed by Varun Vasudev.

+import org.apache.hadoop.yarn.server.nodemanager.util.CgroupsLCEResourcesHandler;
-    resourcesHandler = ReflectionUtils.newInstance(
-        conf.getClass(YarnConfiguration.NM_LINUX_CONTAINER_RESOURCES_HANDLER,
-            DefaultLCEResourcesHandler.class, LCEResourcesHandler.class), conf);
-    resourcesHandler.setConf(conf);
+    resourcesHandler = getResourcesHandler(conf);
+  private LCEResourcesHandler getResourcesHandler(Configuration conf) {
+    LCEResourcesHandler handler = ReflectionUtils.newInstance(
+        conf.getClass(YarnConfiguration.NM_LINUX_CONTAINER_RESOURCES_HANDLER,
+            DefaultLCEResourcesHandler.class, LCEResourcesHandler.class), conf);
+
+    // Stop using CgroupsLCEResourcesHandler
+    // use the resource handler chain instead
+    // ResourceHandlerModule will create the cgroup cpu module if
+    // CgroupsLCEResourcesHandler is set
+    if (handler instanceof CgroupsLCEResourcesHandler) {
+      handler =
+          ReflectionUtils.newInstance(DefaultLCEResourcesHandler.class, conf);
+    }
+    handler.setConf(conf);
+    return handler;
+  }
+
+      if (LOG.isDebugEnabled()) {
+        LOG.debug("Resource handler chain enabled = " + (resourceHandlerChain
+            == null));
+      }
+        LOG.debug("Bootstrapping resource handler chain");

INS26 INS40 INS31 INS83 INS43 INS42 INS44 INS8 INS21 INS42 INS43 INS42 INS60 INS25 INS21 INS41 INS7 INS42 INS43 INS59 INS62 INS8 INS32 INS42 MOV42 INS32 INS42 INS42 MOV32 INS42 INS43 INS21 INS42 INS42 INS42 INS25 UPD42 MOV42 MOV42 INS42 INS7 INS32 INS8 INS42 INS32 INS42 INS42 INS21 INS21 INS42 INS42 INS57 INS42 INS32 INS32 INS43 INS42 INS42 INS27 INS42 INS42 INS45 INS42 INS45 INS36 INS27 INS42 INS33 DEL7 DEL21 DEL42 DEL32 DEL21