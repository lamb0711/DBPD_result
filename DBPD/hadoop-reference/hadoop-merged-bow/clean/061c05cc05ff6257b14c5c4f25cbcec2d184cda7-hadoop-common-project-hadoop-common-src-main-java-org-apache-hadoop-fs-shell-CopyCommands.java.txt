HADOOP-12657. Add a option to skip newline on empty files with getMerge -nl. Contributed by Kanaka Kumar Avvaru.

-    public static final String USAGE = "[-nl] <src> <localdst>";
+    public static final String USAGE = "[-nl] [-skip-empty-file] "
+        + "<src> <localdst>";
-      "Get all the files in the directories that " +
-      "match the source file pattern and merge and sort them to only " +
-      "one file on local fs. <src> is kept.\n" +
-      "-nl: Add a newline character at the end of each file.";
+        "Get all the files in the directories that "
+        + "match the source file pattern and merge and sort them to only "
+        + "one file on local fs. <src> is kept.\n"
+        + "-nl: Add a newline character at the end of each file.\n"
+        + "-skip-empty-file: Do not add new line character for empty file.";
+    private boolean skipEmptyFileDelimiter;
-        CommandFormat cf = new CommandFormat(2, Integer.MAX_VALUE, "nl");
+        CommandFormat cf = new CommandFormat(2, Integer.MAX_VALUE, "nl",
+            "skip-empty-file");
+        skipEmptyFileDelimiter = cf.getOpt("skip-empty-file");
-          FSDataInputStream in = src.fs.open(src.path);
-          try {
-            IOUtils.copyBytes(in, out, getConf(), false);
-            if (delimiter != null) {
-              out.write(delimiter.getBytes("UTF-8"));
+          if (src.stat.getLen() != 0) {
+            try (FSDataInputStream in = src.fs.open(src.path)) {
+              IOUtils.copyBytes(in, out, getConf(), false);
+              writeDelimiter(out);
-          } finally {
-            in.close();
+          } else if (!skipEmptyFileDelimiter) {
+            writeDelimiter(out);
-      }      
+      }
- 
+
+    private void writeDelimiter(FSDataOutputStream out) throws IOException {
+      if (delimiter != null) {
+        out.write(delimiter.getBytes("UTF-8"));
+      }
+    }
+

INS23 INS31 INS83 INS39 INS59 INS83 INS39 INS42 INS44 INS43 MOV8 INS27 INS42 INS43 INS42 INS42 INS45 INS45 UPD45 INS45 INS42 INS21 MOV43 INS7 INS8 INS42 INS32 INS25 MOV43 INS45 INS42 INS42 INS45 INS27 MOV8 INS25 INS32 INS34 INS38 INS8 INS40 INS42 INS58 INS42 INS21 MOV43 MOV59 MOV21 INS32 INS42 INS42 UPD42 UPD42 DEL45 DEL60