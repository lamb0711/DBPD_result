HDFS-6599. 2.4 addBlock is 10 to 20 times slower compared to 0.23 (daryn)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1611737 13f79535-47bb-0310-9956-ffa450edef68

-      double avgLoad = 0;
-      if (stats != null) {
-        int size = stats.getNumDatanodesInService();
-        if (size != 0) {
-          avgLoad = (double)stats.getTotalLoad()/size;
-        }
-      }
-      if (node.getXceiverCount() > (2.0 * avgLoad)) {
-        logNodeIsNotChosen(storage, "the node is too busy ");
+      final double maxLoad = 2.0 * stats.getInServiceXceiverAverage();
+      final int nodeLoad = node.getXceiverCount();
+      if (nodeLoad > maxLoad) {
+        logNodeIsNotChosen(storage,
+            "the node is too busy (load:"+nodeLoad+" > "+maxLoad+") ");

MOV60 INS83 INS83 UPD42 INS27 INS42 MOV32 INS42 UPD42 MOV42 INS34 INS32 INS42 INS42 INS27 INS45 INS42 INS45 INS42 INS45 DEL34 DEL42 DEL42 DEL42 DEL32 DEL42 DEL33 DEL27 DEL42 DEL34 DEL27 DEL42 DEL39 DEL42 DEL42 DEL32 DEL11 DEL42 DEL27 DEL7 DEL21 DEL8 DEL25 DEL8 DEL25 DEL34 DEL27 DEL36 DEL45