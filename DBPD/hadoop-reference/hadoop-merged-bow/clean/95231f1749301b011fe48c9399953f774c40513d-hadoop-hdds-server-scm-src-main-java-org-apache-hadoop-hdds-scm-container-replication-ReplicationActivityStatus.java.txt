HDDS-362. Modify functions impacted by SCM chill mode in ScmBlockLocationProtocol. Contributed by Ajay Kumar.

-
-public class ReplicationActivityStatus
-    implements EventHandler<Boolean>, ReplicationActivityStatusMXBean,
-    Closeable {
+public class ReplicationActivityStatus implements
+    ReplicationActivityStatusMXBean, Closeable {
-
+  private AtomicBoolean replicationStatusSetExternally = new AtomicBoolean();
+  private ReplicationStatusListener replicationStatusListener;
+  private ChillModeStatusListener chillModeStatusListener;
+
+  public ReplicationActivityStatus(){
+    replicationStatusListener = new ReplicationStatusListener();
+    chillModeStatusListener = new ChillModeStatusListener();
+  }
-  /**
-   * The replication status could be set by async events.
-   */
-  @Override
-  public void onMessage(Boolean enabled, EventPublisher publisher) {
-    replicationEnabled.set(enabled);
-  }
+
+  /**
+   * Replication status listener.
+   */
+  class ReplicationStatusListener implements EventHandler<Boolean> {
+    @Override
+    public void onMessage(Boolean status, EventPublisher publisher) {
+      replicationStatusSetExternally.set(true);
+      replicationEnabled.set(status);
+    }
+  }
+
+  /**
+   * Replication status is influenced by Chill mode status as well.
+   */
+  class ChillModeStatusListener implements EventHandler<Boolean> {
+
+    @Override
+    public void onMessage(Boolean inChillMode, EventPublisher publisher) {
+      if (!replicationStatusSetExternally.get()) {
+        replicationEnabled.set(!inChillMode);
+      }
+    }
+  }
+
+  public ReplicationStatusListener getReplicationStatusListener() {
+    return replicationStatusListener;
+  }
+
+  public ChillModeStatusListener getChillModeStatusListener() {
+    return chillModeStatusListener;
+  }
+

INS23 INS23 INS23 INS31 INS55 INS55 INS31 INS31 INS83 INS43 INS59 INS83 INS43 INS59 INS83 INS43 INS59 INS83 INS42 INS8 INS29 INS42 MOV74 INS31 INS29 INS42 INS74 INS31 INS83 INS43 INS42 INS8 INS83 INS43 INS42 INS8 INS42 INS42 INS14 INS42 INS42 INS42 INS42 INS21 INS21 MOV65 MOV78 MOV83 MOV39 MOV42 MOV44 MOV44 MOV8 INS65 INS43 INS43 INS78 INS83 INS39 INS42 INS44 INS44 INS8 INS42 INS41 INS42 INS41 INS43 INS7 INS7 UPD66 UPD42 INS21 INS66 INS42 INS42 INS42 INS43 INS42 INS43 INS42 INS25 INS42 INS42 INS42 INS42 INS14 INS42 INS14 INS32 INS42 INS42 INS38 INS8 INS43 INS43 INS42 INS42 INS9 UPD42 INS32 INS21 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS38 INS42 DEL29 DEL31