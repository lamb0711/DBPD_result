HDFS-6102. Lower the default maximum items per directory to fix PB fsimage loading. Contributed by Andrew Wang.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1577426 13f79535-47bb-0310-9956-ffa450edef68

+    // We need a maximum maximum because by default, PB limits message sizes
+    // to 64MB. This means we can only store approximately 6.7 million entries
+    // per directory, but let's use 6.4 million for some safety.
+    final int MAX_DIR_ITEMS = 64 * 100 * 1000;
+    Preconditions.checkArgument(
+        maxDirItems > 0 && maxDirItems <= MAX_DIR_ITEMS, "Cannot set "
+            + DFSConfigKeys.DFS_NAMENODE_MAX_DIRECTORY_ITEMS_KEY
+            + " to a value less than 0 or greater than " + MAX_DIR_ITEMS);
-    if (maxDirItems == 0) {
-      return;
-    }

INS60 INS21 INS83 INS39 INS59 INS32 INS42 INS27 INS42 INS42 INS27 INS27 INS34 INS34 INS34 INS27 INS27 INS45 INS40 INS45 INS42 INS42 INS34 INS42 INS42 DEL42 DEL34 DEL27 DEL41 DEL8 DEL25