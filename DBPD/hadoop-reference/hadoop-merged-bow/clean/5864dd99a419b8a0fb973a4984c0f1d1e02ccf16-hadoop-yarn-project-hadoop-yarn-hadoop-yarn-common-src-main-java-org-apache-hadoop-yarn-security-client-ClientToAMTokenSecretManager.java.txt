YARN-1915. Fixed a race condition that client could use the ClientToAMToken to contact with AM before AM actually receives the ClientToAMTokenMasterKey. Contributed by Jason Lowe

+  private static final int MASTER_KEY_WAIT_MSEC = 10 * 1000;
-  private SecretKey masterKey;
+  private volatile SecretKey masterKey;
+  public byte[] retrievePassword(ClientToAMTokenIdentifier identifier)
+      throws InvalidToken {
+    if (this.masterKey == null) {
+      synchronized (this) {
+        while (masterKey == null) {
+          try {
+            wait(MASTER_KEY_WAIT_MSEC);
+            break;
+          } catch (InterruptedException e) {
+          }
+        }
+      }
+    }
+    return super.retrievePassword(identifier);
+  }
+
+  @Override
-    this.masterKey = SecretManager.createSecretKey(key);
+    synchronized (this) {
+      this.masterKey = SecretManager.createSecretKey(key);
+      notifyAll();
+    }

INS23 INS31 INS83 INS83 INS83 INS39 INS59 INS83 INS78 INS83 INS5 INS42 INS44 INS43 INS8 INS8 INS42 INS27 INS42 INS39 INS85 INS43 INS42 INS42 INS25 INS41 INS51 INS34 INS34 INS42 INS27 INS8 INS48 INS52 MOV8 INS22 INS33 INS51 INS42 INS42 INS21 INS52 INS42 INS52 INS8 INS32 INS61 INS42 INS27 INS8 INS42 INS33 INS54 INS8 INS12 INS21 INS10 INS44 INS8 INS32 INS43 INS42 INS42 INS42 INS42