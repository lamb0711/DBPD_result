HDFS-14230. RBF: Throw RetriableException instead of IOException when no namenodes available. Contributed by Fei Hui.

+import org.apache.hadoop.ipc.RetriableException;
-   * @throws IOException Original exception if the retry policy generates one
-   *                     or IOException for no available namenodes.
+   * @throws NoNamenodesAvailableException Exception that the retry policy
+   *         generates for no available namenodes.
-        throw new IOException("No namenode available under nameservice " + nsId,
-            ioe);
+        throw new NoNamenodesAvailableException(nsId, ioe);
+        } else if (ioe instanceof NoNamenodesAvailableException) {
+          if (this.rpcMonitor != null) {
+            this.rpcMonitor.proxyOpNoNamenodes();
+          }
+          LOG.error("Can not get available namenode for {} {} error: {}",
+              nsId, rpcAddress, ioe.getMessage());
+          // Throw RetriableException so that client can retry
+          throw new RetriableException(ioe);

INS26 INS40 UPD42 UPD66 UPD66 UPD43 INS42 UPD42 INS25 INS62 INS8 MOV8 INS42 INS43 INS25 INS21 INS53 INS42 INS27 INS8 INS32 INS14 INS22 INS33 INS21 INS42 INS42 INS45 INS42 INS42 INS32 INS43 INS42 INS52 INS42 INS32 INS42 INS42 INS42 INS22 INS42 INS52 INS42 DEL45 DEL42 DEL27