MAPREDUCE-3166. [Rumen] Make Rumen use job history api instead of relying on current history file name format.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1182330 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.IOException;
+   * Extracts job id from the current hadoop version's job history file name.
+   * @param fileName job history file name from which job id is to be extracted
+   * @return job id if the history file name format is same as that of the
+   * current hadoop version. Returns null otherwise.
+   */
+  private static String extractJobIDFromCurrentHistoryFile(String fileName) {
+    JobID id = null;
+    if (org.apache.hadoop.mapreduce.v2.jobhistory.JobHistoryUtils
+            .isValidJobHistoryFileName(fileName)) {
+      try {
+        id = org.apache.hadoop.mapreduce.v2.jobhistory.JobHistoryUtils
+                 .getJobIDFromHistoryFilePath(fileName);
+      } catch (IOException e) {
+        // Ignore this exception and go ahead with getting of jobID assuming
+        // older hadoop verison's history file
+      }
+    }
+    if (id != null) {
+      return id.toString();
+    }
+    return null;
+  }
+
+  /**
+
+    // Try to get the jobID assuming that the history file is from the current
+    // hadoop version
+    String jobID = extractJobIDFromCurrentHistoryFile(fileName);
+    if (jobID != null) {
+      return jobID;//history file is of current hadoop version
+    }
+
+    // History file could be of older hadoop versions
-    if (pre21JobID != null) {
-      return pre21JobID;
-    }
-    return applyParser(fileName, JobHistory.JOBHISTORY_FILENAME_REGEX);
+    return pre21JobID;

INS26 INS40 INS31 INS29 INS83 INS83 INS43 INS42 INS44 INS8 MOV25 INS65 INS65 INS65 INS42 INS43 INS42 INS60 INS25 INS25 INS41 INS60 MOV41 INS66 INS42 INS66 INS66 INS66 INS42 INS43 INS59 INS32 INS8 INS27 INS8 INS33 INS43 INS59 INS42 INS42 INS33 INS40 INS42 INS42 INS54 INS42 INS33 INS41 INS42 INS42 INS32 UPD42 INS41 INS8 INS12 INS32 INS42 INS42 INS42 INS21 INS44 INS8 INS42 INS42 INS7 INS43 INS42 INS42 INS32 INS42 INS40 INS42 INS42 DEL42 DEL42 DEL40 DEL32 DEL41