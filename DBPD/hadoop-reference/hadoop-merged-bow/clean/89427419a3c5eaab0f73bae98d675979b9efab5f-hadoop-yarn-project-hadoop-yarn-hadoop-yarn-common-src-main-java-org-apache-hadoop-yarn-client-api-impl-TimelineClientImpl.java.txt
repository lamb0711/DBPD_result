YARN-2673. Made timeline client put APIs retry if ConnectException happens. Contributed by Li Lu.

+import java.net.ConnectException;
+import com.sun.jersey.api.client.filter.ClientFilter;
+import com.sun.jersey.api.client.ClientRequest;
+import com.sun.jersey.api.client.ClientHandlerException;
+  private TimelineJerseyRetryFilter retryFilter;
+
+  static class TimelineJerseyRetryFilter extends ClientFilter {
+    // maxRetries < 0 means keep trying
+    @Private
+    @VisibleForTesting
+    public int maxRetries;
+
+    @Private
+    @VisibleForTesting
+    public long retryInterval;
+
+    // Indicates if retries happened last time
+    @Private
+    @VisibleForTesting
+    public boolean retried = false;
+
+    // Constructor with default retry settings
+    public TimelineJerseyRetryFilter(Configuration conf) {
+      super();
+      maxRetries = conf.getInt(
+        YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,
+        YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_MAX_RETRIES);
+      retryInterval = conf.getLong(
+        YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,
+        YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS);
+    }
+
+    @Override
+    public ClientResponse handle(ClientRequest cr)
+        throws ClientHandlerException {
+      int leftRetries = maxRetries;
+      retried = false;
+      // keep trying
+      while (true) {
+        try {
+          // try pass the request on, if fail, keep retrying
+          return getNext().handle(cr);
+        } catch (ClientHandlerException e) {
+          // break if there's no retries left
+          if (leftRetries == 0) {
+            break;
+          }
+          if(e.getCause() instanceof ConnectException) {
+            if (leftRetries > 0) {
+              LOG.info("Connection Timeout (" + cr.getURI() + "), will try "
+                  + leftRetries + " more time(s).");
+            } else {
+              // note that maxRetries may be -1 at the very beginning
+              // maxRetries = -1 means keep trying
+              LOG.info("Connection Timeout (" + cr.getURI()
+                  + "), will keep retrying.");
+            }
+            retried = true;
+          } else {
+            throw e;
+          }
+        }
+        if (leftRetries > 0) {
+          leftRetries--;
+        }
+        try {
+          // sleep for the given time interval
+          Thread.sleep(retryInterval);
+        } catch (InterruptedException ie) {
+          LOG.warn("Client retry sleep interrupted! ");
+        }
+      }
+      throw new ClientHandlerException("Failed to connect to timeline server. "
+          + "Connection retries limit exceeded. "
+          + "The posted timeline event may be missing");
+    };
+  }
+
+      retryFilter = new TimelineJerseyRetryFilter(conf);
+      client.addFilter(retryFilter);
+  public TimelineJerseyRetryFilter getRetryFilter() {
+    return retryFilter;
+  }
+
+  @Private
+  @VisibleForTesting

INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS23 INS55 INS31 INS83 INS43 INS59 INS83 INS42 INS43 INS23 INS23 INS23 INS31 INS31 INS78 INS78 INS83 INS43 INS42 INS8 INS42 INS42 INS42 INS78 INS78 INS83 INS39 INS59 INS78 INS78 INS83 INS39 INS59 INS78 INS78 INS83 INS39 INS59 INS83 INS42 INS44 INS8 INS78 INS83 INS43 INS42 INS44 INS43 INS8 INS42 INS42 INS42 INS41 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS9 INS43 INS42 INS46 INS21 INS21 INS42 INS42 INS43 INS42 INS42 INS60 INS21 INS61 INS53 INS42 INS42 INS7 INS7 INS42 INS39 INS59 INS7 INS9 INS8 INS14 INS21 INS21 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS9 INS54 INS25 INS54 INS43 INS27 INS7 INS32 INS42 INS42 INS40 INS40 INS42 INS42 INS40 INS40 INS8 INS12 INS27 INS8 INS8 INS12 INS42 INS45 INS45 INS45 INS42 INS14 INS42 INS42 INS42 INS41 INS44 INS8 INS42 INS34 INS21 INS21 INS44 INS8 INS43 INS42 INS32 INS43 INS42 INS25 INS25 INS37 INS32 INS43 INS42 INS21 INS42 INS32 INS42 INS42 INS42 INS27 INS8 INS62 INS8 INS8 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS34 INS10 INS32 INS43 INS25 INS21 INS53 INS42 INS42 INS45 INS42 INS42 INS42 INS27 INS8 INS8 INS7 INS42 INS42 INS34 INS21 INS21 INS42 INS9 INS32 INS32 INS42 INS42 INS27 INS42 INS42 INS27 INS45 INS32 INS45 INS42 INS45 INS45 INS32 INS45 INS42 INS42 INS42 INS42