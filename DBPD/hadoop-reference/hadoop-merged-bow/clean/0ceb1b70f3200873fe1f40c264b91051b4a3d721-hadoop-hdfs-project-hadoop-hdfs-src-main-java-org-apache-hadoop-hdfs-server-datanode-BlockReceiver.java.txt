HDFS-14260. Replace synchronized method in BlockReceiver with atomic value. Contributed by BELUGA BEHR.

+import java.util.concurrent.atomic.AtomicLong;
-  private long lastSentTime;
+  private final AtomicLong lastSentTime = new AtomicLong(0L);
-      this.lastSentTime = Time.monotonicNow();
+      this.lastSentTime.set(Time.monotonicNow());
-  synchronized void setLastSentTime(long sentTime) {
-    lastSentTime = sentTime;
-  }
-
-   * It can return false if
-   * - upstream did not send packet for a long time
-   * - a packet was received but got stuck in local disk I/O.
-   * - a packet was received but got stuck on send to mirror.
+   * Check if a packet was sent within an acceptable period of time.
+   *
+   * Some example of when this method may return false:
+   * <ul>
+   * <li>Upstream did not send packet for a long time</li>
+   * <li>Packet was received but got stuck in local disk I/O</li>
+   * <li>Packet was received but got stuck on send to mirror</li>
+   * </ul>
+   *
+   * @return true if packet was sent within an acceptable period of time;
+   *         otherwise false.
-  synchronized boolean packetSentInTime() {
-    long diff = Time.monotonicNow() - lastSentTime;
-    if (diff > maxSendIdleTime) {
-      LOG.info("A packet was last sent " + diff + " milliseconds ago.");
-      return false;
+  boolean packetSentInTime() {
+    final long diff = Time.monotonicNow() - this.lastSentTime.get();
+    final boolean allowedIdleTime = (diff <= this.maxSendIdleTime);
+    LOG.debug("A packet was last sent {}ms ago.", diff);
+    if (!allowedIdleTime) {
+      LOG.warn("A packet was last sent {}ms ago. Maximum idle time: {}ms.",
+          diff, this.maxSendIdleTime);
-    return true;
+    return allowedIdleTime;
-        setLastSentTime(now);
+        this.lastSentTime.set(now);

INS26 INS40 INS23 MOV83 INS83 INS43 INS59 INS42 INS42 INS14 INS65 INS60 INS21 INS25 INS43 INS34 INS66 UPD66 INS66 UPD66 UPD66 UPD66 INS66 INS66 INS66 INS83 INS83 INS39 INS59 INS32 INS38 MOV8 INS42 INS42 INS42 INS36 INS42 INS42 INS45 INS42 INS42 INS32 INS32 INS27 MOV22 INS42 MOV32 INS22 INS42 MOV42 INS22 UPD42 INS45 INS42 INS22 INS52 INS42 INS52 INS42 INS52 INS42 INS22 INS42 INS52 INS42 DEL39 DEL42 DEL59 DEL23 DEL7 DEL83 DEL39 DEL42 DEL39 DEL42 DEL44 DEL42 DEL42 DEL7 DEL21 DEL8 DEL31 DEL83 DEL42 DEL45 DEL42 DEL45 DEL27 DEL9 DEL41 DEL42 DEL27 DEL25 DEL9 DEL42