HDDS-1766. ContainerStateMachine is unable to increment lastAppliedTermIndex. Contributed by  Mukul Kumar Singh. (#1072)


-      LOG.info(
-          "The snapshot info is null." + "Setting the last applied index to:"
-              + empty);
+      LOG.info("{}: The snapshot info is null. Setting the last applied index" +
+              "to:{}", gid, empty);
-      return RaftLog.INVALID_LOG_INDEX;
+      return empty.getIndex();
-    LOG.info("Setting the last applied index to " + last);
+    LOG.info("{}: Setting the last applied index to {}", gid, last);
-    LOG.info("Taking snapshot at termIndex:" + ti);
+    long startTime = Time.monotonicNow();
-      LOG.info("Taking a snapshot to file {}", snapshotFile);
+      LOG.info("{}: Taking a snapshot at:{} file {}", gid, ti, snapshotFile);
-        LOG.warn("Failed to write snapshot file \"" + snapshotFile
-            + "\", last applied index=" + ti);
+        LOG.info("{}: Failed to write snapshot at:{} file {}", gid, ti,
+            snapshotFile);
+      LOG.info("{}: Finished taking a snapshot at:{} file:{} time:{}",
+          gid, ti, snapshotFile, (Time.monotonicNow() - startTime));
-    LOG.trace("dispatch {} containerID={} pipelineID={} traceID={}",
+    LOG.trace("{}: dispatch {} containerID={} pipelineID={} traceID={}", gid,
-    LOG.trace("response {}", response);
+    LOG.trace("{}: response {}", gid, response);
-    LOG.debug("writeChunk writeStateMachineData : blockId " + write.getBlockID()
-        + " logIndex " + entryIndex + " chunkName " + write.getChunkData()
-        .getChunkName());
+    LOG.debug(gid + ": writeChunk writeStateMachineData : blockId " +
+        write.getBlockID() + " logIndex " + entryIndex + " chunkName "
+        + write.getChunkData().getChunkName());
-      LOG.debug("writeChunk writeStateMachineData  completed: blockId " + write
-          .getBlockID() + " logIndex " + entryIndex + " chunkName " + write
-          .getChunkData().getChunkName());
+      LOG.debug(gid + ": writeChunk writeStateMachineData  completed: blockId" +
+           write.getBlockID() + " logIndex " + entryIndex + " chunkName "
+          + write.getChunkData().getChunkName());
-      LOG.error("unable to read stateMachineData:" + e);
+      LOG.error("{} unable to read stateMachineData:", gid, e);
-  private void updateLastApplied() {
+  private synchronized void updateLastApplied() {

INS83 INS60 MOV21 INS39 INS59 INS45 INS42 INS42 INS42 INS32 INS21 UPD45 INS42 UPD45 INS42 INS32 UPD42 MOV42 INS42 INS32 INS42 UPD45 INS27 INS42 INS42 INS42 INS42 UPD45 INS42 INS42 INS42 INS42 INS45 INS42 INS42 INS42 INS36 MOV21 UPD45 MOV45 UPD45 MOV45 INS27 INS45 INS42 INS42 INS32 INS42 UPD42 INS45 INS42 INS42 INS42 INS42 INS42 INS42 UPD45 DEL42 DEL27 DEL40 DEL45 DEL42 DEL27 DEL42 DEL45 DEL42 DEL27 DEL32 DEL21 DEL45 DEL42 DEL45 DEL42 DEL27 DEL45 DEL42 DEL27