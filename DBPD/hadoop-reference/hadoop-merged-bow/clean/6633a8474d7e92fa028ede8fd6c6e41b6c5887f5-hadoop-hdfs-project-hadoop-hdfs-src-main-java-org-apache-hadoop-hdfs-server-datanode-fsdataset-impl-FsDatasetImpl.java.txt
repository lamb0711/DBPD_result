HDFS-7833. DataNode reconfiguration does not recalculate valid volumes required, based on configured failed volumes tolerated. Contributed by Lei (Eddy) Xu.

-  private final int validVolsRequired;
+  private final int volFailuresTolerated;
-    final int volFailuresTolerated =
+    volFailuresTolerated =
-    this.validVolsRequired = volsConfigured - volFailuresTolerated;
-    return volumes.getVolumes().size() >= validVolsRequired;
+    return getNumFailedVolumes() <= volFailuresTolerated;

MOV21 UPD42 UPD27 INS42 MOV32 INS32 UPD42 UPD42 MOV42 DEL52 DEL42 DEL22 DEL42 DEL42 DEL27 DEL83 DEL39 DEL42 DEL59 DEL60 DEL42 DEL32 DEL42 DEL32