HDFS-4876. Fix the javadoc of FileWithSnapshot and move FileDiffList to FileWithSnapshot.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1489708 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.namenode.INodeFileUnderConstruction;
- * {@link INodeFile} with a link to the next element.
- * The link of all the snapshot files and the original file form a circular
- * linked list so that all elements are accessible by any of the elements.
+ * An interface for {@link INodeFile} to support snapshot.
-    FileDiff(Snapshot snapshot, INodeFile file) {
+    private FileDiff(Snapshot snapshot, INodeFile file) {
+  /** A list of FileDiffs for storing snapshot data. */
+  public static class FileDiffList
+      extends AbstractINodeDiffList<INodeFile, FileDiff> {
+
+    @Override
+    FileDiff createDiff(Snapshot snapshot, INodeFile file) {
+      return new FileDiff(snapshot, file);
+    }
+    
+    @Override
+    INodeFile createSnapshotCopy(INodeFile currentINode) {
+      if (currentINode instanceof INodeFileUnderConstructionWithSnapshot) {
+        final INodeFileUnderConstruction uc = 
+            (INodeFileUnderConstruction) currentINode;
+        
+        final INodeFileUnderConstruction copy = new INodeFileUnderConstruction(
+            uc, uc.getClientName(), uc.getClientMachine(), uc.getClientNode());
+        
+        copy.setBlocks(null);
+        return copy;
+      } else {
+        final INodeFile copy = new INodeFile(currentINode);
+        copy.setBlocks(null);
+        return copy;
+      }
+    }
+  }
+

INS26 INS40 INS55 MOV65 INS29 INS83 INS83 INS42 INS74 INS31 INS31 UPD66 UPD66 INS83 INS65 INS43 INS43 INS43 INS78 INS43 INS42 INS44 INS44 INS8 INS78 INS43 INS42 INS44 INS8 INS66 INS42 INS42 INS42 INS42 INS42 INS43 INS42 INS43 INS42 INS41 INS42 INS42 INS43 INS42 INS25 INS42 INS42 INS14 INS42 INS62 INS8 INS8 INS43 INS42 INS42 INS42 INS43 INS60 INS60 INS21 INS41 INS60 INS21 INS41 INS42 INS42 INS83 INS43 INS59 INS83 INS43 INS59 INS32 INS42 INS83 INS43 INS59 INS32 INS42 INS42 INS42 INS11 INS42 INS42 INS14 INS42 INS42 INS33 INS42 INS42 INS14 INS42 INS42 INS33 INS43 INS42 INS43 INS42 INS32 INS32 INS32 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL66