HDDS-705. OS3Exception resource name should be the actual resource name.
Contributed by Bharat Viswanadham.

-
+import static org.apache.hadoop.hdds.protocol.datanode.proto.ContainerProtos.Result.UNKNOWN_BCSID;
+import static org.apache.hadoop.hdds.protocol.datanode.proto.ContainerProtos.Result.BCSID_MISMATCH;
+  private long getBlockCommitSequenceId(MetadataStore db)
+      throws IOException {
+    byte[] bscId = db.get(blockCommitSequenceIdKey);
+    return bscId == null ? 0 : Longs.fromByteArray(bscId);
+  }
+
-    byte[] blockCommitSequenceIdValue = db.get(blockCommitSequenceIdKey);
+    long blockCommitSequenceIdValue = getBlockCommitSequenceId(db);
-    if (blockCommitSequenceIdValue != null && blockCommitSequenceId != 0) {
-      if (blockCommitSequenceId <= Longs
-          .fromByteArray(blockCommitSequenceIdValue)) {
+    if (blockCommitSequenceId != 0) {
+      if (blockCommitSequenceId <= blockCommitSequenceIdValue) {
-        LOG.warn("blockCommitSequenceId " + Longs
-            .fromByteArray(blockCommitSequenceIdValue)
+        LOG.warn("blockCommitSequenceId " + blockCommitSequenceIdValue
+   * @param bcsId latest commit Id of the block
-  public BlockData getBlock(Container container, BlockID blockID)
+  @Override
+  public BlockData getBlock(Container container, BlockID blockID, long bcsId)
+
+    long containerBCSId = getBlockCommitSequenceId(db);
+    if (containerBCSId < bcsId) {
+      throw new StorageContainerException(
+          "Unable to find the block with bcsID " + bcsId + " .Container "
+              + container.getContainerData().getContainerID() + " bcsId is "
+              + containerBCSId + ".", UNKNOWN_BCSID);
+    }
+    long id = blockData.getBlockCommitSequenceId();
+    if (id != bcsId) {
+      throw new StorageContainerException(
+          "bcsId " + bcsId + " mismatches with existing block Id "
+              + id + " for block " + blockID + ".", BCSID_MISMATCH);
+    }

INS26 INS26 INS40 INS40 INS31 INS83 INS39 INS42 INS44 INS43 INS8 INS78 INS44 INS43 INS42 INS42 MOV60 INS41 INS60 INS25 INS65 INS42 INS39 INS42 INS60 INS25 INS60 INS25 INS42 INS16 INS39 INS59 MOV27 MOV8 INS42 INS66 INS39 INS59 INS27 INS8 INS39 INS59 INS27 INS8 UPD42 INS27 INS34 INS32 INS42 INS32 INS42 INS32 INS42 INS42 INS53 INS42 INS32 INS42 INS42 INS53 INS42 INS33 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS14 INS42 INS42 INS14 INS42 INS43 INS27 INS42 INS43 INS27 INS42 INS42 INS45 INS42 INS45 INS32 INS45 INS42 INS45 INS42 INS45 INS42 INS45 INS42 INS45 INS42 INS45 INS32 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL42 DEL33 DEL27 DEL27 DEL25