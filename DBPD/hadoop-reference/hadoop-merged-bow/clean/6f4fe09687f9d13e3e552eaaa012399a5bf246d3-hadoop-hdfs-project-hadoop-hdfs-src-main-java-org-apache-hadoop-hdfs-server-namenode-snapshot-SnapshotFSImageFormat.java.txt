HDFS-4447. Refactor INodeDirectoryWithSnapshot for supporting general INode diff lists.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1440216 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.hdfs.server.namenode.snapshot.INodeDirectoryWithSnapshot.SnapshotDiff;
+import org.apache.hadoop.hdfs.server.namenode.snapshot.INodeDirectoryWithSnapshot.DirectoryDiff;
-    List<SnapshotDiff> diffs = sNode.getSnapshotDiffs();
+    List<DirectoryDiff> diffs = sNode.getDiffs().asList();
-      SnapshotDiff sdiff = diffs.get(i);
+      DirectoryDiff sdiff = diffs.get(i);
-    for (SnapshotDiff postDiff : parent.getSnapshotDiffs()) {
-      INode created = findCreated(createdNodeName, postDiff.getDiff());
+    for (DirectoryDiff postDiff : parent.getDiffs()) {
+      INode created = findCreated(createdNodeName, postDiff.getChildrenDiff());
-      SnapshotDiff diff = loadSnapshotDiff(parentWithSnapshot, in, loader);
-      parentWithSnapshot.insertDiff(diff);
+      DirectoryDiff diff = loadSnapshotDiff(parentWithSnapshot, in, loader);
+      parentWithSnapshot.getDiffs().insert(diff);
-  private static SnapshotDiff loadSnapshotDiff(
+  private static DirectoryDiff loadSnapshotDiff(
-    SnapshotDiff sdiff = parent.new SnapshotDiff(snapshot, childrenSize,
-        snapshotINode, parent.getSnapshotDiffs().isEmpty() ? null : parent
-            .getSnapshotDiffs().get(0), createdList, deletedList);
+    List<DirectoryDiff> diffs = parent.getDiffs().asList();
+    DirectoryDiff sdiff = parent.new DirectoryDiff(snapshot, snapshotINode,
+        diffs.isEmpty() ? null : diffs.get(0),
+        childrenSize, createdList, deletedList);

UPD40 UPD43 UPD42 INS60 UPD74 INS74 INS59 UPD43 UPD43 INS32 UPD43 UPD42 INS43 INS43 INS42 INS32 UPD42 UPD42 INS32 INS42 UPD43 UPD42 UPD43 INS42 INS42 INS32 INS42 UPD43 INS42 MOV42 UPD42 MOV42 UPD42 UPD42 INS32 UPD42 INS42 INS42 UPD42 MOV42 INS42 UPD42 MOV42 UPD42 MOV42 UPD42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL32