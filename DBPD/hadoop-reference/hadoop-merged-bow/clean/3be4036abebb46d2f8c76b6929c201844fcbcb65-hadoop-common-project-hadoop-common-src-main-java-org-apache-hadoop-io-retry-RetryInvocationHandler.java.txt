HADOOP-9792. Retry the methods that are tagged @AtMostOnce along with @Idempotent. Contributed by Suresh Srinivas.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1508312 13f79535-47bb-0310-9956-ffa450edef68

-  RetryInvocationHandler(FailoverProxyProvider proxyProvider,
+  protected RetryInvocationHandler(FailoverProxyProvider proxyProvider,
-        boolean isMethodIdempotent = proxyProvider.getInterface()
+        boolean isIdempotentOrAtMostOnce = proxyProvider.getInterface()
+        if (!isIdempotentOrAtMostOnce) {
+          isIdempotentOrAtMostOnce = proxyProvider.getInterface()
+              .getMethod(method.getName(), method.getParameterTypes())
+              .isAnnotationPresent(AtMostOnce.class);
+        }
-            invocationFailoverCount, isMethodIdempotent);
+            invocationFailoverCount, isIdempotentOrAtMostOnce);
-  private Object invokeMethod(Method method, Object[] args) throws Throwable {
+  protected Object invokeMethod(Method method, Object[] args) throws Throwable {

INS83 UPD83 INS25 INS38 INS8 UPD42 INS42 INS21 INS7 UPD42 INS42 INS32 INS32 INS42 INS57 INS32 INS42 INS32 INS32 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42