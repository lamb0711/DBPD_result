HDFS-3049. During the normal NN startup process, fall back on a different edit log if we see one that is corrupt. Contributed by Colin Patrick McCabe.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1349114 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.PriorityQueue;
+import java.util.TreeSet;
-import com.google.common.collect.TreeMultiset;
-    final TreeMultiset<EditLogInputStream> allStreams =
-        TreeMultiset.create(EDIT_LOG_INPUT_STREAM_COMPARATOR);
+    final PriorityQueue<EditLogInputStream> allStreams = 
+        new PriorityQueue<EditLogInputStream>(64,
+            EDIT_LOG_INPUT_STREAM_COMPARATOR);
-    for (EditLogInputStream elis : allStreams) {
+    EditLogInputStream elis;
+    while ((elis = allStreams.poll()) != null) {
-          streams.add(acc.get(0));
+          streams.add(new RedundantEditLogInputStream(acc, fromTxId));
-      streams.add(acc.get(0));
+      streams.add(new RedundantEditLogInputStream(acc, fromTxId));

MOV26 INS26 INS40 UPD40 INS60 INS61 UPD74 MOV43 INS59 INS27 MOV8 UPD43 INS14 INS42 INS36 INS33 UPD42 INS74 INS34 INS42 INS7 INS43 INS43 INS42 INS32 INS14 INS42 INS42 INS42 INS42 INS43 INS42 INS42 INS42 INS14 INS43 INS42 INS42 INS42 DEL42 DEL42 DEL42 DEL32 DEL42 DEL42 DEL34 DEL32 DEL42 DEL44 DEL42 DEL70 DEL42 DEL42 DEL34 DEL32