YARN-3505. Node's Log Aggregation Report with SUCCEED should not cached in RMApps. Contributed by Xuan Gong.

+import org.apache.hadoop.yarn.server.resourcemanager.rmapp.RMAppImpl;
+    table_description.tr().td(LogAggregationStatus.RUNNING_WITH_FAILURE.name())
+      .td("Log Aggregation is Running, but has failures "
+          + "in previous cycles")._();
-    boolean logAggregationEnabled =
-        conf.getBoolean(YarnConfiguration.LOG_AGGREGATION_ENABLED,
-          YarnConfiguration.DEFAULT_LOG_AGGREGATION_ENABLED);
+    RMApp rmApp = rm.getRMContext().getRMApps().get(appId);
-              + (logAggregationEnabled ? "Enabled" : "Disabled")).table(
+              + (rmApp == null ? "N/A" : rmApp
+                .getLogAggregationStatusForAppReport() == null ? "N/A" : rmApp
+                .getLogAggregationStatusForAppReport().name())).table(
-    table.
-      tr().
-        th(_TH, "NodeId").
-        th(_TH, "Log Aggregation Status").
-        th(_TH, "Diagnostis Message").
-      _();
-    RMApp rmApp = rm.getRMContext().getRMApps().get(appId);
+    int maxLogAggregationDiagnosticsInMemory = conf.getInt(
+      YarnConfiguration.RM_MAX_LOG_AGGREGATION_DIAGNOSTICS_IN_MEMORY,
+      YarnConfiguration.DEFAULT_RM_MAX_LOG_AGGREGATION_DIAGNOSTICS_IN_MEMORY);
+    table
+      .tr()
+      .th(_TH, "NodeId")
+      .th(_TH, "Log Aggregation Status")
+      .th(_TH, "Last "
+          + maxLogAggregationDiagnosticsInMemory + " Diagnostic Messages")
+      .th(_TH, "Last "
+          + maxLogAggregationDiagnosticsInMemory + " Failure Messages")._();
+
+          String failureMessage =
+              report.getValue() == null ? null : ((RMAppImpl)rmApp)
+                  .getLogAggregationFailureMessagesForNM(report.getKey());
-            .td(message == null ? "N/A" : message)._();
+            .td(message == null ? "N/A" : message)
+            .td(failureMessage == null ? "N/A" : failureMessage)._();

INS26 INS40 MOV60 INS21 INS60 INS32 INS39 INS59 INS32 INS32 INS42 INS42 INS32 MOV32 INS42 INS32 INS42 INS27 INS42 INS42 INS40 INS40 INS42 UPD42 INS27 INS32 UPD42 MOV42 INS32 INS45 INS45 INS27 INS45 INS42 INS45 INS42 UPD42 MOV42 UPD40 MOV40 INS42 INS45 INS42 INS45 INS60 INS27 UPD45 INS16 INS43 INS59 INS32 INS42 INS33 INS27 UPD45 MOV45 INS32 INS42 INS42 INS16 MOV32 INS42 INS32 INS33 INS32 INS42 INS27 INS33 INS32 UPD42 INS16 INS42 INS42 INS42 INS42 INS32 INS33 INS36 INS42 INS32 INS27 INS45 INS42 INS42 INS42 INS11 INS42 INS42 INS42 INS33 INS43 INS42 INS42 DEL39 DEL42 DEL40 DEL32 DEL59 DEL60 DEL42 DEL45