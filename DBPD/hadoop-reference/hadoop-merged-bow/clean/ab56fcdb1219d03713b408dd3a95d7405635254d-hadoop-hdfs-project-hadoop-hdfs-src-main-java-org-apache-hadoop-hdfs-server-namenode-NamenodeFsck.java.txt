Merge remote-tracking branch 'apache/trunk' into HDFS-7285

+import org.apache.hadoop.hdfs.client.HdfsClientConfigKeys;
-import org.apache.hadoop.hdfs.server.common.HdfsServerConstants;
-          bm.getExpectedReplicaNum(bc, blockInfo));
+          bm.getExpectedReplicaNum(blockInfo));
+    if (isOpen && !showOpenFiles) {
+      return;
+    }
+    final LocatedBlock lastBlock = blocks.getLastLocatedBlock();
+      if (!blocks.isLastBlockComplete() && lastBlock != null &&
+          lastBlock.getBlock().equals(block)) {
+        // this is the last block and this is not complete. ignore it since
+        // it is under construction
+        continue;
+      }
-        if (failures >= DFSConfigKeys.DFS_CLIENT_MAX_BLOCK_ACQUIRE_FAILURES_DEFAULT) {
+        if (failures >= HdfsClientConfigKeys.DFS_CLIENT_MAX_BLOCK_ACQUIRE_FAILURES_DEFAULT) {
-                  s.connect(addr, HdfsServerConstants.READ_TIMEOUT);
-                  s.setSoTimeout(HdfsServerConstants.READ_TIMEOUT);
+                  s.connect(addr, HdfsConstants.READ_TIMEOUT);
+                  s.setSoTimeout(HdfsConstants.READ_TIMEOUT);

MOV26 UPD40 INS25 INS60 INS27 INS8 INS83 INS43 INS59 INS42 INS38 INS41 INS42 INS42 INS32 INS25 INS42 INS42 INS42 INS27 INS8 INS27 INS32 INS18 INS38 INS27 INS32 INS42 INS42 INS32 INS42 INS33 INS42 INS42 INS42 INS42 UPD40 UPD40 UPD40 DEL42