YARN-693. Modified RM to send NMTokens on allocate call so that AMs can then use them for authentication with NMs. Contributed by Omkar Vinit Joshi.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1493448 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.security.proto.SecurityProtos.TokenProto;
+import org.apache.hadoop.yarn.api.records.NMToken;
-import org.apache.hadoop.yarn.api.records.Token;
+import org.apache.hadoop.yarn.api.records.impl.pb.NMTokenPBImpl;
-import org.apache.hadoop.yarn.api.records.impl.pb.TokenPBImpl;
+import org.apache.hadoop.yarn.proto.YarnServiceProtos.NMTokenProto;
-  private List<Token> nmTokens = null;
+  private List<NMToken> nmTokens = null;
-      Iterable<TokenProto> iterable = getTokenProtoIterable(nmTokens);
+      Iterable<NMTokenProto> iterable = getTokenProtoIterable(nmTokens);
-  public synchronized void setNMTokens(List<Token> nmTokens) {
+  public synchronized void setNMTokens(List<NMToken> nmTokens) {
-      this.nmTokens.clear();
+      if (this.nmTokens != null) {
+        this.nmTokens.clear();
+      }
-  public synchronized List<Token> getNMTokens() {
+  public synchronized List<NMToken> getNMTokens() {
-    List<TokenProto> list = p.getNmTokensList();
-    nmTokens = new ArrayList<Token>();
-    for (TokenProto t : list) {
+    List<NMTokenProto> list = p.getNmTokensList();
+    nmTokens = new ArrayList<NMToken>();
+    for (NMTokenProto t : list) {
-  private synchronized Iterable<TokenProto> getTokenProtoIterable(
-      final List<Token> nmTokenList) {
+  private synchronized Iterable<NMTokenProto> getTokenProtoIterable(
+      final List<NMToken> nmTokenList) {
-    return new Iterable<TokenProto>() {
+    return new Iterable<NMTokenProto>() {
-      public synchronized Iterator<TokenProto> iterator() {
-        return new Iterator<TokenProto>() {
+      public synchronized Iterator<NMTokenProto> iterator() {
+        return new Iterator<NMTokenProto>() {
-          Iterator<Token> iter = nmTokenList.iterator();
+          Iterator<NMToken> iter = nmTokenList.iterator();
-          public TokenProto next() {
+          public NMTokenProto next() {
-  private synchronized TokenProto convertToProtoFormat(Token token) {
-    return ((TokenPBImpl)token).getProto();
+  private synchronized NMTokenProto convertToProtoFormat(NMToken token) {
+    return ((NMTokenPBImpl)token).getProto();
-  private synchronized Token convertFromProtoFormat(TokenProto proto) {
-    return new TokenPBImpl(proto);
+  private synchronized NMToken convertFromProtoFormat(NMTokenProto proto) {
+    return new NMTokenPBImpl(proto);

MOV26 MOV26 MOV26 UPD40 UPD40 UPD40 UPD74 UPD74 UPD74 UPD43 UPD43 UPD43 UPD74 UPD43 UPD43 UPD74 UPD42 UPD43 UPD42 UPD43 UPD42 UPD43 INS8 UPD42 UPD74 UPD42 UPD43 UPD42 UPD42 UPD42 INS25 MOV21 INS41 UPD43 UPD43 UPD42 UPD74 UPD43 UPD74 INS27 MOV8 UPD42 UPD74 UPD42 UPD43 UPD42 UPD43 INS22 INS33 UPD43 UPD42 UPD74 MOV74 UPD43 UPD42 INS52 INS42 UPD42 UPD43 UPD42 UPD42 UPD74 MOV74 UPD43 UPD42 UPD74 MOV74 UPD43 UPD43 UPD42 UPD42 DEL41