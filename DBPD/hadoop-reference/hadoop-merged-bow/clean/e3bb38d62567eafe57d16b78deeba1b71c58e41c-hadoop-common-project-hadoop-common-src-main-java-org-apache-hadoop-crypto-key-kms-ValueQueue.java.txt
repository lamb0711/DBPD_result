HDFS-9405. Warmup NameNode EDEK caches in background thread. Contributed by Xiao Chen.

+import java.util.Arrays;
+import java.util.Map;
-   * Get size of the Queue for keyName
+   * Get size of the Queue for keyName. This is only used in unit tests.
-   * @throws ExecutionException
-  public int getSize(String keyName) throws ExecutionException {
-    return keyQueues.get(keyName).size();
+  public int getSize(String keyName) {
+    // We can't do keyQueues.get(keyName).size() here,
+    // since that will have the side effect of populating the cache.
+    Map<String, LinkedBlockingQueue<E>> map =
+        keyQueues.getAllPresent(Arrays.asList(keyName));
+    if (map.get(keyName) == null) {
+      return 0;
+    }
+    return map.get(keyName).size();

INS26 INS26 INS40 INS40 INS8 INS60 INS25 MOV41 UPD66 INS74 INS59 INS27 INS8 INS43 INS43 INS74 INS42 INS32 INS32 INS33 INS41 INS42 INS42 INS43 INS43 INS42 INS42 INS32 INS42 INS42 INS42 INS34 UPD42 INS42 UPD42 MOV42 INS42 INS42 INS42 DEL42 DEL65 DEL43 DEL8