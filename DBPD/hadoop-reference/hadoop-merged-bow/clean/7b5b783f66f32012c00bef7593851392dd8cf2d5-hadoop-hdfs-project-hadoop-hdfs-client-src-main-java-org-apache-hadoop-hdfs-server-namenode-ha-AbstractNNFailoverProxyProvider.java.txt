HDFS-14327. Using FQDN instead of IP to access servers with DNS resolving. Contributed by Fengnan Li.

-import java.net.InetAddress;
-      addressesOfNns = getResolvedAddressesIfNecessary(addressesOfNns, uri);
+      addressesOfNns = getResolvedHostsIfNecessary(addressesOfNns, uri);
-  Collection<InetSocketAddress> getResolvedAddressesIfNecessary(
+  Collection<InetSocketAddress> getResolvedHostsIfNecessary(
+    // decide whether to access server by IP or by host name
+    String useFQDNKeyWithHost =
+        HdfsClientConfigKeys.Failover.RESOLVE_ADDRESS_TO_FQDN + "." + host;
+    boolean requireFQDN = conf.getBoolean(useFQDNKeyWithHost,
+        HdfsClientConfigKeys.Failover.RESOLVE_ADDRESS_TO_FQDN_DEFAULT);
-      InetAddress[] resolvedAddresses = dnr.getAllByDomainName(
-          address.getHostName());
+      String[] resolvedHostNames = dnr.getAllResolvedHostnameByDomainName(
+          address.getHostName(), requireFQDN);
-      for (InetAddress raddress : resolvedAddresses) {
+      for (String hostname : resolvedHostNames) {
-            raddress, port);
+            hostname, port);

UPD42 INS60 INS60 INS43 INS59 INS39 INS59 INS42 INS42 INS27 INS42 INS32 INS40 INS45 INS42 INS42 INS42 INS42 INS40 UPD5 UPD42 UPD43 UPD42 UPD43 UPD42 UPD42 UPD42 UPD42 INS42 UPD42 MOV43 MOV43 UPD42 DEL40 DEL26