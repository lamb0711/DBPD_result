Merge trunk into auto-HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3042@1340622 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.base.Joiner;
-  public Daemon recoverBlocks(final Collection<RecoveringBlock> blocks) {
+  public Daemon recoverBlocks(
+      final String who,
+      final Collection<RecoveringBlock> blocks) {
+    
-            logRecoverBlock("NameNode", b.getBlock(), b.getLocations());
+            logRecoverBlock(who, b);
-  private static void logRecoverBlock(String who,
-      ExtendedBlock block, DatanodeID[] targets) {
-    StringBuilder msg = new StringBuilder(targets[0].toString());
-    for (int i = 1; i < targets.length; i++) {
-      msg.append(", " + targets[i]);
-    }
+  private static void logRecoverBlock(String who, RecoveringBlock rb) {
+    ExtendedBlock block = rb.getBlock();
+    DatanodeInfo[] targets = rb.getLocations();
+    
-        + ", targets=[" + msg + "])");
+        + ", targets=[" + Joiner.on(", ").join(targets) + "]"
+        + ", newGenerationStamp=" + rb.getNewGenerationStamp() + ")");

INS26 INS40 INS44 INS83 INS43 INS42 INS43 UPD42 INS60 INS42 UPD42 MOV42 MOV43 INS5 INS59 UPD42 INS32 INS43 INS85 INS42 INS32 INS42 UPD42 MOV42 INS42 UPD42 MOV42 INS42 INS32 UPD45 INS45 INS32 INS45 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS45 UPD42 MOV42 MOV42 DEL45 DEL42 DEL32 DEL42 DEL32 DEL42 DEL44 DEL43 DEL85 DEL5 DEL42 DEL43 DEL42 DEL43 DEL42 DEL34 DEL2 DEL32 DEL14 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL40 DEL27 DEL42 DEL37 DEL42 DEL45 DEL42 DEL42 DEL2 DEL27 DEL32 DEL21 DEL8 DEL24 DEL42