MAPREDUCE-6761. Regression when handling providers - invalid configuration ServiceConfiguration causes Cluster initialization failure. Contributed by Peter Vary

+import java.util.ServiceConfigurationError;
+import com.google.common.annotations.VisibleForTesting;
-  
+
-  private static ServiceLoader<ClientProtocolProvider> frameworkLoader =
+  @VisibleForTesting
+  static Iterable<ClientProtocolProvider> frameworkLoader =
-          for (ClientProtocolProvider provider : frameworkLoader) {
-            localProviderList.add(provider);
+          try {
+            for (ClientProtocolProvider provider : frameworkLoader) {
+              localProviderList.add(provider);
+            }
+          } catch(ServiceConfigurationError e) {
+            LOG.info("Failed to instantiate ClientProtocolProvider, please "
+                         + "check the /META-INF/services/org.apache."
+                         + "hadoop.mapreduce.protocol.ClientProtocolProvider "
+                         + "files on the classpath", e);

INS26 INS26 INS40 INS40 INS78 UPD74 INS42 UPD43 UPD42 INS54 INS8 INS12 MOV70 INS44 INS8 INS43 INS42 INS21 INS42 INS32 INS42 INS42 INS27 INS42 INS45 INS45 INS45 INS45 DEL83