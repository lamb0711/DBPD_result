YARN-3334. NM uses timeline client to publish container metrics to new timeline service. Contributed by Junping Du.

-
-      threadPool.shutdown();
-
-      while (!threadPool.isTerminated()) { // wait for all posting thread to finish
-        try {
-          if (!threadPool.awaitTermination(30, TimeUnit.SECONDS)) {
-            threadPool.shutdownNow(); // send interrupt to hurry them along
-          }
-        } catch (InterruptedException e) {
-          LOG.warn("Timeline client service stop interrupted!");
-          break;
-        }
-      }
+      
+      shutdownAndAwaitTermination();
+  
+  //TODO remove threadPool after adding non-blocking call in TimelineClient
+  private static void shutdownAndAwaitTermination() {
+    threadPool.shutdown();
+    try {
+      // Wait a while for existing tasks to terminate
+      if (!threadPool.awaitTermination(60, TimeUnit.SECONDS)) {
+        threadPool.shutdownNow();
+        if (!threadPool.awaitTermination(60, TimeUnit.SECONDS))
+            LOG.error("ThreadPool did not terminate");
+      }
+    } catch (InterruptedException ie) {
+      threadPool.shutdownNow();
+      // Preserve interrupt status
+      Thread.currentThread().interrupt();
+    }
+  }

INS31 INS83 INS83 INS39 INS42 INS8 MOV21 INS54 INS8 INS12 MOV21 INS25 MOV44 INS8 INS38 INS8 UPD42 INS21 INS21 UPD42 INS32 MOV21 INS25 INS32 INS32 INS42 INS42 INS34 INS40 INS38 INS21 INS42 INS42 INS32 INS42 INS32 INS32 INS42 INS42 INS42 INS42 INS34 INS40 INS42 INS42 INS45 DEL42 DEL45 DEL42 DEL42 DEL32 DEL38 DEL42 DEL42 DEL34 DEL40 DEL32 DEL38 DEL8 DEL25 DEL8 DEL10 DEL8 DEL12 DEL54 DEL8 DEL61