YARN-1903. Set exit code and diagnostics when container is killed at NEW/LOCALIZING state. Contributed by Zhijie Shen

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1586522 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.server.nodemanager.ContainerExecutor.ExitCode;
-        ContainerEventType.KILL_CONTAINER, CONTAINER_DONE_TRANSITION)
+        ContainerEventType.KILL_CONTAINER, new KillOnNewTransition())
+      container.exitCode = ExitCode.TERMINATED.getExitCode();
+      container.diagnostics.append("Container is killed before being launched.\n");
-   * - NEW -> DONE upon KILL_CONTAINER
+   * Handle the following transition:
+   * - NEW -> DONE upon KILL_CONTAINER
+   */
+  static class KillOnNewTransition extends ContainerDoneTransition {
+    @Override
+    public void transition(ContainerImpl container, ContainerEvent event) {
+      ContainerKillEvent killEvent = (ContainerKillEvent) event;
+      container.exitCode = ExitCode.TERMINATED.getExitCode();
+      container.diagnostics.append(killEvent.getDiagnostic()).append("\n");
+      container.diagnostics.append("Container is killed before being launched.\n");
+      super.transition(container, event);
+    }
+  }
+
+  /**

INS26 INS40 INS83 INS42 INS55 INS29 INS83 INS42 INS43 INS31 INS65 INS42 INS78 INS83 INS39 INS42 INS44 INS44 INS8 INS21 INS21 INS66 INS66 INS42 INS43 INS42 INS43 INS42 INS60 INS21 INS21 INS21 INS21 INS7 INS32 INS42 INS42 INS43 INS59 INS7 INS32 INS32 INS48 INS40 INS32 INS40 INS42 INS45 INS42 INS42 INS11 INS40 INS32 INS32 INS42 INS45 INS40 INS42 INS45 INS42 INS42 INS42 INS40 INS42 INS43 INS42 INS40 INS42 INS40 INS42 INS32 INS42 INS42 INS42 INS14 INS43 INS42 DEL83 DEL42 DEL42 DEL66