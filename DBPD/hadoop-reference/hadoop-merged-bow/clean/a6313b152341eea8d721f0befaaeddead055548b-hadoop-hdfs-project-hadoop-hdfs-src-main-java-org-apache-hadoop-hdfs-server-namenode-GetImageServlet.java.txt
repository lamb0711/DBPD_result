Merge trunk to HDFS-4685.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-4685@1549699 13f79535-47bb-0310-9956-ffa450edef68

+import java.net.URL;
-
-
-      final Configuration conf = 
-        (Configuration)getServletContext().getAttribute(JspHelper.CURRENT_CONF);
+      final Configuration conf = (Configuration) context
+          .getAttribute(JspHelper.CURRENT_CONF);
-                        parsedParams.getInfoServer(), txid,
+                        parsedParams.getInfoServer(conf), txid,
-      InetSocketAddress imageListenAddress, Storage storage) {
+      URL url, Storage storage) {
+    InetSocketAddress imageListenAddress = NetUtils.createSocketAddr(url
+        .getAuthority());
-    String getInfoServer() throws IOException{
+    URL getInfoServer(Configuration conf) throws IOException {
-        throw new IOException ("MachineName and port undefined");
+        throw new IOException("MachineName and port undefined");
-      return machineName + ":" + remoteport;
+      return new URL(DFSUtil.getHttpClientScheme(conf), machineName, remoteport, "");

INS26 INS40 INS43 INS42 INS60 UPD43 INS44 INS42 MOV43 INS59 UPD42 INS43 INS42 INS42 INS32 INS42 INS14 INS42 INS42 INS32 INS43 INS32 INS42 INS42 INS45 INS42 INS42 INS42 INS42 INS42 INS42 UPD42 MOV42 INS42 DEL32 DEL42 DEL42 DEL45 DEL42 DEL27