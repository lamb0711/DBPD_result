HDFS-4727. Update inodeMap after deleting files/directories/snapshots.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1470756 13f79535-47bb-0310-9956-ffa450edef68

-      Snapshot prior, final BlocksMapUpdateInfo collectedBlocks)
-      throws QuotaExceededException {
+      Snapshot prior, final BlocksMapUpdateInfo collectedBlocks,
+      final List<INode> removedINodes) throws QuotaExceededException {
-          collectedBlocks);
+          collectedBlocks, removedINodes);
-  public void destroyAndCollectBlocks(
-      final BlocksMapUpdateInfo collectedBlocks) {
+  public void destroyAndCollectBlocks(final BlocksMapUpdateInfo collectedBlocks,
+      final List<INode> removedINodes) {
-      child.destroyAndCollectBlocks(collectedBlocks);
+      child.destroyAndCollectBlocks(collectedBlocks, removedINodes);
-    // TODO: Need to update the cleanSubtree/destroy methods to clean inode map
+    removedINodes.add(this);
-      final BlocksMapUpdateInfo collectedBlocks)
-      throws QuotaExceededException {
+      final BlocksMapUpdateInfo collectedBlocks, 
+      final List<INode> removedINodes) throws QuotaExceededException {
-      destroyAndCollectBlocks(collectedBlocks);
+      destroyAndCollectBlocks(collectedBlocks, removedINodes);
-          collectedBlocks);
+          collectedBlocks, removedINodes);

INS44 INS44 INS44 INS83 INS74 INS42 INS83 INS74 INS42 INS21 INS83 INS74 INS42 INS43 INS43 INS43 INS43 INS32 INS43 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS52 INS42 INS42 INS42 INS42 INS42 INS42