HDFS-5080. BootstrapStandby not working with QJM when the existing NN is active. Contributed by Jing Zhao.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1514386 13f79535-47bb-0310-9956-ffa450edef68

+   * @param inProgressOk whether or not to include the in-progress edit log 
+   *        segment       
-      boolean forReading) throws IOException {
+      boolean forReading, boolean inProgressOk) throws IOException {
+    // make sure not reading in-progress edit log, i.e., if forReading is true,
+    // we should ignore the in-progress edit log.
+    Preconditions.checkArgument(!(forReading && inProgressOk));
+    
-      if (elf.hasCorruptHeader() || elf.isInProgress()) continue;
+      if (elf.hasCorruptHeader() || (!inProgressOk && elf.isInProgress())) {
+        continue;
+      }

INS44 INS65 INS39 INS42 INS21 INS42 INS66 INS66 INS32 INS42 INS42 INS38 INS36 INS8 INS27 INS36 INS18 INS42 INS42 INS27 INS38 MOV32 INS42 DEL18