YARN-814. Improving diagnostics when containers fail during launch due to various reasons like invalid env etc. Contributed by Jian He.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1504732 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerDiagnosticsUpdateEvent;
+import org.apache.hadoop.util.StringUtils;
+    private Container container;
-    public DelayedProcessKiller(String user, String pid, long delay,
-        Signal signal,
-        ContainerExecutor containerExecutor) {
+    public DelayedProcessKiller(Container container, String user, String pid,
+        long delay, Signal signal, ContainerExecutor containerExecutor) {
+      this.container = container;
-        LOG.warn("Exception when killing task " + pid, e);
+        String message = "Exception when user " + user + " killing task " + pid
+            + " in DelayedProcessKiller: " + StringUtils.stringifyException(e);
+        LOG.warn(message);
+        container.handle(new ContainerDiagnosticsUpdateEvent(container
+          .getContainerId(), message));

INS26 INS26 INS40 INS40 INS23 INS83 INS43 INS59 INS44 INS42 INS42 INS43 INS42 INS21 INS42 INS7 INS22 INS42 INS52 INS42 INS60 INS21 INS21 INS43 INS59 INS32 INS32 INS42 INS42 INS27 INS42 INS42 INS42 INS42 UPD42 MOV42 INS14 UPD45 MOV45 INS42 INS45 MOV42 INS45 INS32 INS43 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL27 DEL32 DEL21