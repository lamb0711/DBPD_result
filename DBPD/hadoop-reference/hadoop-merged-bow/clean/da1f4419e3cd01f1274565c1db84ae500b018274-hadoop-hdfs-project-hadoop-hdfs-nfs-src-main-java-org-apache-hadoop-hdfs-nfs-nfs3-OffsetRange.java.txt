merge the rest of trunk to branch HDFS-4949

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-4949@1532967 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Comparator;
+
+import com.google.common.base.Preconditions;
+
-public class OffsetRange implements Comparable<OffsetRange> {
+public class OffsetRange {
+  
+  public static final Comparator<OffsetRange> ReverseComparatorOnMin = 
+      new Comparator<OffsetRange>() {
+    @Override
+    public int compare(OffsetRange o1, OffsetRange o2) {
+      if (o1.getMin() == o2.getMin()) {
+        return o1.getMax() < o2.getMax() ? 
+            1 : (o1.getMax() > o2.getMax() ? -1 : 0);
+      } else {
+        return o1.getMin() < o2.getMin() ? 1 : -1;
+      }
+    }
+  };
+  
-    if ((min >= max) || (min < 0) || (max < 0)) {
-      throw new IllegalArgumentException("Wrong offset range: (" + min + ","
-          + max + ")");
-    }
+    Preconditions.checkArgument(min >= 0 && max >= 0 && min < max);
-    assert (o instanceof OffsetRange);
-    OffsetRange range = (OffsetRange) o;
-    return (min == range.getMin()) && (max == range.getMax());
-  }
-
-  private static int compareTo(long left, long right) {
-    if (left < right) {
-      return -1;
-    } else if (left > right) {
-      return 1;
-    } else {
-      return 0;
+    if (o instanceof OffsetRange) {
+      OffsetRange range = (OffsetRange) o;
+      return (min == range.getMin()) && (max == range.getMax());
-  }
-
-  @Override
-  public int compareTo(OffsetRange other) {
-    final int d = compareTo(min, other.getMin());
-    return d != 0 ? d : compareTo(max, other.getMax());
+    return false;

INS26 INS26 MOV31 INS40 INS40 INS23 INS83 INS83 INS83 UPD74 MOV74 INS59 UPD42 MOV44 MOV44 UPD43 INS42 INS14 INS21 MOV21 MOV21 INS25 INS41 UPD42 INS74 INS1 INS32 MOV62 INS8 INS9 INS43 INS43 INS31 INS42 UPD42 MOV42 INS27 MOV60 MOV41 INS42 UPD42 MOV42 MOV78 UPD83 MOV83 MOV39 UPD42 MOV42 MOV44 MOV44 MOV8 INS27 INS27 INS43 INS42 UPD42 INS27 INS27 INS42 INS42 INS42 INS27 INS8 MOV8 INS42 INS34 UPD42 MOV42 MOV34 INS32 INS32 INS41 INS42 INS42 INS42 INS42 INS16 INS16 INS27 INS34 INS36 INS27 INS34 INS38 INS32 INS32 INS16 INS32 INS32 INS34 INS42 INS42 INS42 INS42 INS27 MOV38 INS34 INS42 INS42 INS42 INS42 INS32 INS32 INS42 INS42 INS42 INS42 DEL39 DEL42 DEL34 DEL42 DEL42 DEL27 DEL41 DEL8 DEL42 DEL42 DEL27 DEL34 DEL41 DEL8 DEL25 DEL83 DEL39 DEL83 DEL39 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL59 DEL60 DEL27 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL16 DEL41 DEL42 DEL42 DEL42 DEL27 DEL36 DEL42 DEL34 DEL27 DEL36 DEL42 DEL34 DEL27 DEL36 DEL27 DEL43 DEL45 DEL42 DEL45 DEL42 DEL45 DEL27 DEL14 DEL53 DEL8 DEL25 DEL8 DEL31 DEL36 DEL6 DEL83 DEL39 DEL42 DEL44 DEL31