MAPREDUCE-5976. native-task: should not fail to build if snappy is missing (Manu Zhang)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/MR-2841@1616115 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.base.Charsets;
-      String message = "Native output collector don't support customized java comparator "
+      String message = "Native output collector doesn't support customized java comparator "
-    if (job.getBoolean(MRJobConfig.MAP_OUTPUT_COMPRESS, false) == true) {
-      if (!isCodecSupported(job.get(MRJobConfig.MAP_OUTPUT_COMPRESS_CODEC))) {
-        String message = "Native output collector don't support compression codec "
-          + job.get(MRJobConfig.MAP_OUTPUT_COMPRESS_CODEC) + ", We support Gzip, Lz4, snappy";
-        LOG.error(message);
-        throw new InvalidJobConfException(message);
-      }
-    }
+
-      String message = "Native-Task don't support sort class " + job.get(Constants.MAP_SORT_CLASS);
+      String message = "Native-Task doesn't support sort class " + job.get(Constants.MAP_SORT_CLASS);
-      String message = "Native-Task don't support secure shuffle";
+      String message = "Native-Task doesn't support secure shuffle";
-        String message = "Native output collector don't support this key, this key is not comparable in native "
+        String message = "Native output collector doesn't support this key, this key is not comparable in native "
+      if (job.getBoolean(MRJobConfig.MAP_OUTPUT_COMPRESS, false)) {
+        String codec = job.get(MRJobConfig.MAP_OUTPUT_COMPRESS_CODEC);
+        if (!NativeRuntime.supportsCompressionCodec(codec.getBytes(Charsets.UTF_8))) {
+          String message = "Native output collector doesn't support compression codec " + codec;
+          LOG.error(message);
+          throw new InvalidJobConfException(message);
+        }
+      }
-  private boolean isCodecSupported(String string) {
-    if ("org.apache.hadoop.io.compress.SnappyCodec".equals(string)
-        || "org.apache.hadoop.io.compress.GzipCodec".equals(string)
-        || "org.apache.hadoop.io.compress.Lz4Codec".equals(string)) {
-      return true;
-    }
-    return false;
-  }

INS26 INS40 MOV25 MOV27 INS60 INS25 MOV42 UPD42 MOV42 UPD40 MOV40 MOV43 INS59 MOV32 INS8 INS42 INS45 MOV60 MOV25 UPD45 UPD45 INS43 INS38 INS42 UPD42 MOV32 INS32 INS42 INS42 INS32 UPD45 UPD42 MOV42 UPD42 MOV42 UPD40 MOV40 INS27 INS45 INS42 DEL9 DEL27 DEL8 DEL25 DEL42 DEL32 DEL32 DEL38 DEL45 DEL45 DEL27 DEL45 DEL83 DEL39 DEL42 DEL42 DEL44 DEL45 DEL42 DEL42 DEL32 DEL45 DEL42 DEL42 DEL32 DEL45 DEL42 DEL42 DEL32 DEL27 DEL9 DEL41 DEL8 DEL25 DEL9 DEL41 DEL8 DEL31