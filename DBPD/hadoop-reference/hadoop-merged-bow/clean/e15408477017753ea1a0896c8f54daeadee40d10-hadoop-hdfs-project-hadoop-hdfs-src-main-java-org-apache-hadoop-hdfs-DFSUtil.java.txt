HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes (#2026)


+import org.apache.hadoop.ipc.ProtobufRpcEngine;
-import org.apache.hadoop.ipc.ProtobufRpcEngine;
+import org.apache.hadoop.ipc.ProtobufRpcEngine2;
+    RPC.setProtocolEngine(conf, protocol, ProtobufRpcEngine2.class);
+    server.addProtocol(RPC.RpcKind.RPC_PROTOCOL_BUFFER, protocol, service);
+  }
+
+  /**
+   * Add protobuf based protocol to the {@link RPC.Server}.
+   * This engine uses Protobuf 2.5.0. Recommended to upgrade to
+   * Protobuf 3.x from hadoop-thirdparty and use
+   * {@link DFSUtil#addPBProtocol(Configuration, Class, BlockingService,
+   * RPC.Server)}.
+   * @param conf configuration
+   * @param protocol Protocol interface
+   * @param service service that implements the protocol
+   * @param server RPC server to which the protocol &amp; implementation is
+   *               added to
+   * @throws IOException
+   */
+  @Deprecated
+  public static void addPBProtocol(Configuration conf, Class<?> protocol,
+      com.google.protobuf.BlockingService service, RPC.Server server)
+      throws IOException {

MOV26 INS26 INS40 INS31 INS8 INS29 INS78 INS83 INS83 INS39 INS42 INS44 INS44 INS44 INS44 INS43 MOV8 INS21 INS21 INS65 INS65 INS65 INS65 INS65 INS65 INS42 INS43 INS42 INS74 INS42 INS43 INS42 INS43 INS42 INS42 INS32 INS32 INS66 INS65 INS66 INS66 INS66 INS65 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS66 INS42 INS42 INS43 INS76 INS40 INS40 INS42 INS42 INS42 INS42 INS57 INS42 INS42 INS40 INS42 INS42 INS40 INS68 INS42 INS43 INS42 INS42 INS69 INS69 INS69 INS69 INS42 INS43 INS43 INS43 INS43 INS42 INS42 INS42 INS40