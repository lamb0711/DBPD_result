YARN-6144. FairScheduler: preempted resources can become negative. (Miklos Szegedi via kasha)

-    containersToPreempt.add(container);
-    synchronized (preemptedResources) {
-      Resources.addTo(preemptedResources, container.getAllocatedResource());
+    if (containersToPreempt.add(container)) {
+      synchronized (preemptedResources) {
+        Resources.addTo(preemptedResources, container.getAllocatedResource());
+      }
-    synchronized (preemptedResources) {
-      Resources.subtractFrom(preemptedResources,
-          container.getAllocatedResource());
+    if (containersToPreempt.remove(container)) {
+      synchronized (preemptedResources) {
+        Resources.subtractFrom(preemptedResources,
+            container.getAllocatedResource());
+      }
-    containersToPreempt.remove(container);

INS25 INS25 MOV32 INS8 MOV32 INS8 MOV51 MOV51 DEL21 DEL21