HDFS-7095. Archival Storage: TestStorageMover often fails in Jenkins. Contributed by Jing Zhao.

-      targets.put(target);
-      getTargetStorages(target.getStorageType()).add(target);
+      if (target != null) {
+        targets.put(target);
+        getTargetStorages(target.getStorageType()).add(target);
+      }
+        final Source source = dn.addSource(t, Long.MAX_VALUE, dispatcher);
-        if (maxRemaining > 0L) {
-          final Source source = dn.addSource(t, Long.MAX_VALUE, dispatcher); 
-          final StorageGroup target = dn.addTarget(t, maxRemaining);
-          storages.add(source, target);
-        }
+        final StorageGroup target = maxRemaining > 0L ? dn.addTarget(t,
+            maxRemaining) : null;
+        storages.add(source, target);
-      db.addLocation(storages.getTarget(ml));
+      StorageGroup source = storages.getSource(ml);
+      if (source != null) {
+        db.addLocation(source);
+      }
-          if (ml.storageType == t) {
+          if (ml.storageType == t && source != null) {
-      return scheduleMoveReplica(db, storages.getSource(ml), targetTypes);
+      final Source source = storages.getSource(ml);
+      return source == null ? false : scheduleMoveReplica(db,
+          storages.getSource(ml), targetTypes);

MOV8 MOV60 INS25 MOV44 INS42 INS60 INS27 INS8 MOV60 INS70 INS60 INS25 INS83 INS43 INS59 INS16 INS42 INS33 MOV21 MOV21 MOV44 MOV32 MOV8 INS43 INS59 INS27 INS8 INS42 INS42 INS32 INS27 INS9 MOV32 MOV60 INS42 INS42 INS32 INS42 INS33 INS21 INS42 INS42 INS42 INS42 INS33 MOV42 UPD42 MOV42 MOV42 INS32 INS16 INS42 INS42 INS42 INS27 MOV27 MOV32 INS33 MOV27 INS27 INS42 INS33 DEL25 DEL42 DEL70 DEL8 DEL42 DEL42 DEL32 DEL32 DEL21