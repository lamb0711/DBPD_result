HDFS-12853. Ozone: Optimize chunk writes for Ratis by avoiding double writes.  Contributed by Mukul Kumar Singh

-      ContainerDispatcher dispatcher, RpcType rpcType, int maxChunkSize,
-      int raftSegmentSize) throws IOException {
+      ContainerDispatcher dispatcher, Configuration conf) throws IOException {
+
+    final String rpcType = conf.get(
+        OzoneConfigKeys.DFS_CONTAINER_RATIS_RPC_TYPE_KEY,
+        OzoneConfigKeys.DFS_CONTAINER_RATIS_RPC_TYPE_DEFAULT);
+    final RpcType rpc = SupportedRpcType.valueOfIgnoreCase(rpcType);
+    final int raftSegmentSize = conf.getInt(
+        OzoneConfigKeys.DFS_CONTAINER_RATIS_SEGMENT_SIZE_KEY,
+        OzoneConfigKeys.DFS_CONTAINER_RATIS_SEGMENT_SIZE_DEFAULT);
+    final int maxChunkSize = OzoneConfigKeys.DFS_CONTAINER_CHUNK_MAX_SIZE;
+    final int numWriteChunkThreads = conf.getInt(
+        OzoneConfigKeys.DFS_CONTAINER_RATIS_NUM_WRITE_CHUNK_THREADS_KEY,
+        OzoneConfigKeys.DFS_CONTAINER_RATIS_NUM_WRITE_CHUNK_THREADS_DEFAULT);
+
-    RaftProperties serverProperties = newRaftProperties(rpcType, port,
+    RaftProperties serverProperties = newRaftProperties(rpc, port,
-        .setStateMachine(new ContainerStateMachine(dispatcher))
+        .setStateMachine(new ContainerStateMachine(dispatcher,
+            numWriteChunkThreads))
-    final String rpcType = ozoneConf.get(
-        OzoneConfigKeys.DFS_CONTAINER_RATIS_RPC_TYPE_KEY,
-        OzoneConfigKeys.DFS_CONTAINER_RATIS_RPC_TYPE_DEFAULT);
-    final RpcType rpc = SupportedRpcType.valueOfIgnoreCase(rpcType);
-    final int raftSegmentSize =
-        ozoneConf.getInt(ScmConfigKeys.OZONE_SCM_RATIS_SEGMENT_SIZE_KEY,
-            ScmConfigKeys.OZONE_SCM_RATIS_SEGMENT_SIZE_DEFAULT);
-    final int maxChunkSize = ScmConfigKeys.OZONE_SCM_CHUNK_MAX_SIZE;
-        dispatcher, rpc, maxChunkSize, raftSegmentSize);
+        dispatcher, ozoneConf);

UPD43 UPD42 INS60 MOV60 INS60 INS60 INS60 UPD42 INS83 MOV43 INS59 INS83 INS39 INS59 INS83 INS39 INS59 INS83 INS39 INS59 INS42 INS32 INS42 INS32 INS42 INS40 INS42 INS32 UPD42 INS42 INS42 INS40 INS40 INS42 INS42 INS40 INS40 INS42 INS42 INS40 INS40 UPD42 INS42 DEL39 DEL42 DEL44 DEL39 DEL42 DEL44 DEL83 DEL42 DEL42 DEL42 DEL40 DEL40 DEL32 DEL59 DEL60 DEL83 DEL39 DEL42 DEL42 DEL42 DEL40 DEL40 DEL32 DEL59 DEL60 DEL83 DEL39 DEL42 DEL40 DEL59 DEL60 DEL42 DEL42