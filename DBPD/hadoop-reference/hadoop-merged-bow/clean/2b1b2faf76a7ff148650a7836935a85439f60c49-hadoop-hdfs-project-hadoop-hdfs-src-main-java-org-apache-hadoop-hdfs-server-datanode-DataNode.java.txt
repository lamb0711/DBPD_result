HDFS-9671. DiskBalancer: SubmitPlan implementation. (Contributed by Anu Engineer)

-import org.apache.hadoop.hdfs.server.diskbalancer.DiskbalancerException;
+import org.apache.hadoop.hdfs.server.diskbalancer.DiskBalancerException;
+  private DiskBalancer diskBalancer;
+
-  
+
+  /**
+   * Initilizes {@link DiskBalancer}.
+   * @param  data - FSDataSet
+   * @param conf - Config
+   */
+  private synchronized void initDiskBalancer(FsDatasetSpi data,
+                                             Configuration conf) {
+    if (this.diskBalancer != null) {
+      return;
+    }
+
+    DiskBalancer.BlockMover mover = new DiskBalancer.DiskBalancerMover(data,
+        conf);
+    this.diskBalancer = new DiskBalancer(getDatanodeUuid(), conf, mover);
+  }
+
+  /**
+   * Shutdown disk balancer.
+   */
+  private synchronized void shutdownDiskBalancer() {
+    if (this.diskBalancer != null) {
+      this.diskBalancer.shutdown();
+      this.diskBalancer = null;
+    }
+  }
+
+    initDiskBalancer(data, conf);
+    shutdownDiskBalancer();
-   * @return  success or throws an exception.
-   * @throws Exception
+   * @throws IOException
-    // TODO : This will be replaced with actual code later.
-    // Right now throwing DiskbalancerException instead
-    // NotImplementedException to indicate the eventually disk balancer code
-    // will throw DiskbalancerException.
-    throw new DiskbalancerException("Not Implemented", 0);
+    checkSuperuserPrivilege();
+    // TODO : Support force option
+    this.diskBalancer.submitPlan(planID, planVersion, plan, bandwidth, false);
-    throw new DiskbalancerException("Not Implemented", 0);
+    throw new DiskBalancerException("Not Implemented",
+        DiskBalancerException.Result.INTERNAL_ERROR);
-  public WorkStatus queryDiskBalancerPlan() throws IOException {
+  public DiskBalancerWorkStatus queryDiskBalancerPlan() throws IOException {
-    throw new DiskbalancerException("Not Implemented", 0);
+    throw new DiskBalancerException("Not Implemented",
+        DiskBalancerException.Result.INTERNAL_ERROR);
-    throw new DiskbalancerException("Not Implemented", 0);
+    throw new DiskBalancerException("Not Implemented",
+        DiskBalancerException.Result.INTERNAL_ERROR);

UPD40 INS23 INS31 INS31 INS83 INS43 INS59 INS29 INS83 INS83 INS39 INS42 INS44 INS44 INS8 INS29 INS83 INS83 INS39 INS42 INS8 MOV78 MOV78 UPD43 INS42 INS42 INS65 INS65 INS65 INS43 INS42 INS43 INS42 INS25 INS60 INS21 INS65 INS25 INS21 INS21 INS21 INS21 MOV21 UPD42 MOV21 INS66 INS65 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS27 INS8 INS43 INS59 INS7 INS66 INS27 INS8 INS32 INS32 UPD42 INS32 INS32 INS42 INS22 INS33 INS41 INS40 INS42 INS14 INS22 INS14 INS22 INS33 INS21 INS21 INS42 INS42 INS42 INS42 INS42 INS22 INS42 INS42 INS42 INS42 INS42 INS9 UPD43 INS40 UPD43 INS40 UPD43 INS40 INS52 INS42 INS43 INS42 INS42 INS52 INS42 INS43 INS32 INS42 INS42 INS52 INS42 INS32 INS7 INS52 INS42 UPD42 UPD42 UPD42 INS40 INS42 INS42 INS22 INS42 INS22 INS33 INS52 INS42 INS52 INS42 DEL66 DEL65 DEL42 DEL43 DEL45 DEL34 DEL14 DEL53 DEL34 DEL34 DEL34