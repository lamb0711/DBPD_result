MAPREDUCE-3764. Fixed resource usage metrics for queues and users.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1238255 13f79535-47bb-0310-9956-ffa450edef68

-  @Metric("Allocated memory in GiB") MutableGaugeInt allocatedGB;
+  @Metric("Allocated memory in MB") MutableGaugeInt allocatedMB;
-  @Metric("Available memory in GiB") MutableGaugeInt availableGB;
-  @Metric("Pending memory allocation in GiB") MutableGaugeInt pendingGB;
+  @Metric("Available memory in MB") MutableGaugeInt availableMB;
+  @Metric("Pending memory allocation in MB") MutableGaugeInt pendingMB;
-  @Metric("# of reserved memory in GiB") MutableGaugeInt reservedGB;
+  @Metric("# of reserved memory in MB") MutableGaugeInt reservedMB;
-  static final int GB = 1024; // resource.memory is in MB
-    availableGB.set(limit.getMemory()/GB);
+    availableMB.set(limit.getMemory());
-    pendingGB.incr(res.getMemory()/GB);
+    pendingMB.incr(res.getMemory());
-    pendingGB.decr(res.getMemory()/GB);
+    pendingMB.decr(res.getMemory());
-    allocatedGB.incr(res.getMemory()/GB * containers);
+    allocatedMB.incr(res.getMemory() * containers);
-    allocatedGB.decr(res.getMemory()/GB * containers);
+    allocatedMB.decr(res.getMemory() * containers);
-    reservedGB.incr(res.getMemory()/GB);
+    reservedMB.incr(res.getMemory());
-    reservedGB.decr(res.getMemory()/GB);
+    reservedMB.decr(res.getMemory());
-  public int getAllocatedGB() {
-    return allocatedGB.value();
+  public int getAllocatedMB() {
+    return allocatedMB.value();
-  public int getAvailableGB() {
-    return availableGB.value();
+  public int getAvailableMB() {
+    return availableMB.value();
-  public int getPendingGB() {
-    return pendingGB.value();
+  public int getPendingMB() {
+    return pendingMB.value();
-  public int getReservedGB() {
-    return reservedGB.value();
+  public int getReservedMB() {
+    return reservedMB.value();

UPD42 UPD42 UPD42 UPD42 UPD45 UPD42 UPD45 UPD42 UPD45 UPD42 UPD45 UPD42 UPD42 MOV32 UPD42 MOV32 UPD42 MOV32 UPD42 UPD27 MOV27 UPD42 UPD27 MOV27 UPD42 MOV32 UPD42 MOV32 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 DEL83 DEL83 DEL39 DEL42 DEL34 DEL59 DEL23 DEL42 DEL27 DEL42 DEL27 DEL42 DEL27 DEL42 DEL27 DEL42 DEL27 DEL42 DEL27 DEL42 DEL27