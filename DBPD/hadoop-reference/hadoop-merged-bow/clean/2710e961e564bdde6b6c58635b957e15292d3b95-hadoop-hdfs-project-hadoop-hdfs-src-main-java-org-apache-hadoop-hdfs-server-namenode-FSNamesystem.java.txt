HDFS-4361. When listing snapshottable directories, only return those where the user has permission to take snapshots.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1441202 13f79535-47bb-0310-9956-ffa450edef68

-   * Get the list of all the current snapshottable directories
+   * Get the list of snapshottable directories that are owned 
+   * by the current user. Return all the snapshottable directories if the 
+   * current user is a super user.
+    SnapshottableDirectoryStatus[] status = null;
-      
-      SnapshottableDirectoryStatus[] status = snapshotManager
-          .getSnapshottableDirListing();
-      if (auditLog.isInfoEnabled() && isExternalInvocation()) {
-        logAuditEvent(UserGroupInformation.getCurrentUser(), getRemoteIp(),
-              "listSnapshottableDirectory", null, null, null);
-      }
-      return status;
+      FSPermissionChecker checker = new FSPermissionChecker(
+          fsOwner.getShortUserName(), supergroup);
+      status = snapshotManager
+          .getSnapshottableDirListing(checker.isSuper ? null : checker.user);
+    if (auditLog.isInfoEnabled() && isExternalInvocation()) {
+      logAuditEvent(UserGroupInformation.getCurrentUser(), getRemoteIp(),
+            "listSnapshottableDirectory", null, null, null);
+    }
+    return status;

MOV8 MOV21 INS54 UPD66 INS66 INS66 INS8 MOV8 INS33 MOV21 INS60 INS21 INS43 INS59 INS7 INS42 INS42 INS14 INS42 INS32 INS43 INS32 INS42 INS42 INS42 INS16 INS42 INS42 INS42 INS40 INS33 INS40 DEL42 DEL42 DEL32 DEL54 DEL8