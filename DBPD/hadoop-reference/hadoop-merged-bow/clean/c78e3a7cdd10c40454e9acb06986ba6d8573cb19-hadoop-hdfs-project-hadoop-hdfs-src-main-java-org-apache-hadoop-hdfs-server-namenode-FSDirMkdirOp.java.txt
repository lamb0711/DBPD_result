HDFS-7059. Avoid resolving path multiple times. Contributed by Jing Zhao.

-    byte[][] pathComponents = FSDirectory.getPathComponentsForReservedPath
-        (src);
+    byte[][] pathComponents = FSDirectory.getPathComponentsForReservedPath(src);
-      if (!mkdirsRecursively(fsd, src, permissions, false, now())) {
+      if (mkdirsRecursively(fsd, iip, permissions, false, now()) == null) {
-   * @param src string representation of the path to the directory
+   * @param iip the INodesInPath instance containing all the existing INodes
+   *            and null elements for non-existing components in the path
-   * @return true if the operation succeeds false otherwise
+   * @return non-null INodesInPath instance if operation succeeds
-  static boolean mkdirsRecursively(
-      FSDirectory fsd, String src, PermissionStatus permissions,
-      boolean inheritPermission, long now)
+  static INodesInPath mkdirsRecursively(FSDirectory fsd, INodesInPath iip,
+      PermissionStatus permissions, boolean inheritPermission, long now)
-    src = FSDirectory.normalizePath(src);
-    String[] names = INode.getPathNames(src);
-    byte[][] components = INode.getPathComponents(names);
-    final int lastInodeIndex = components.length - 1;
+    final int lastInodeIndex = iip.length() - 1;
+    final byte[][] components = iip.getPathComponents();
+    final String[] names = new String[components.length];
+    for (int i = 0; i < components.length; i++) {
+      names[i] = DFSUtil.bytes2String(components[i]);
+    }
-      INodesInPath iip = fsd.getExistingPathINodes(components);
-          throw new FileAlreadyExistsException(
-                  "Parent path is not a directory: "
+          throw new FileAlreadyExistsException("Parent path is not a directory: "
-          return false;
+          return null;
-    return true;
+    return iip;

INS43 INS42 MOV43 INS42 INS60 INS24 UPD42 UPD66 INS66 UPD66 INS83 INS39 INS83 MOV83 INS5 INS59 INS58 INS27 INS37 INS8 INS42 UPD42 INS27 INS43 INS85 INS42 INS3 INS39 INS59 INS42 MOV40 INS42 INS21 INS27 INS32 INS34 UPD42 INS42 MOV5 INS40 UPD42 MOV42 INS34 INS7 INS32 INS33 UPD42 MOV42 UPD42 MOV42 INS2 INS32 MOV42 MOV42 UPD42 MOV42 MOV42 MOV9 MOV32 INS42 INS42 INS42 INS42 INS2 INS42 INS42 INS33 DEL32 DEL38 DEL39 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL7 DEL21 DEL42 DEL32 DEL42 DEL39 DEL34 DEL27 DEL59 DEL60 DEL42 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL9 DEL9