HDDS-1621. writeData in ChunkUtils should not use AsynchronousFileChannel. Contributed by Supratim Deka (#917)


+import java.nio.channels.FileChannel;
-    AsynchronousFileChannel file = null;
+    FileChannel file = null;
-      file = sync ?
-          AsynchronousFileChannel.open(chunkFile.toPath(),
-              StandardOpenOption.CREATE,
-              StandardOpenOption.WRITE,
-              StandardOpenOption.SPARSE,
-              StandardOpenOption.SYNC) :
-          AsynchronousFileChannel.open(chunkFile.toPath(),
+
+      // skip SYNC and DSYNC to reduce contention on file.lock
+      file = FileChannel.open(chunkFile.toPath(),
-      lock = file.lock().get();
-      int size = file.write(data, chunkInfo.getOffset()).get();
+
+      lock = file.lock();
+      int size = file.write(data, chunkInfo.getOffset());
+          if (sync) {
+            // ensure data and metadata is persisted. Outside the lock
+            file.force(true);
+          }

INS26 INS40 UPD43 UPD42 INS32 MOV32 MOV32 UPD42 MOV42 MOV42 MOV32 MOV40 MOV40 MOV40 INS25 INS42 INS8 INS21 INS32 INS42 INS42 INS9 DEL42 DEL40 DEL32 DEL42 DEL42 DEL42 DEL42 DEL32 DEL40 DEL40 DEL40 DEL32 DEL16 DEL42 DEL32 DEL42 DEL32