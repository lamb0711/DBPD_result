YARN-376. Fixes a bug which would prevent the NM knowing about completed containers and applications. Contributed by Jason Lowe.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1451473 13f79535-47bb-0310-9956-ffa450edef68

+  public void updateHeartbeatResponseForCleanup(HeartbeatResponse response) {
+    this.writeLock.lock();
+
+    try {
+      response.addAllContainersToCleanup(
+          new ArrayList<ContainerId>(this.containersToClean));
+      response.addAllApplicationsToCleanup(this.finishedApplications);
+      this.containersToClean.clear();
+      this.finishedApplications.clear();
+    } finally {
+      this.writeLock.unlock();
+    }
+  };
+
+  @Override
-      // HeartBeat processing from our end is done, as node pulls the following
-      // lists before sending status-updates. Clear data-structures
-      // TODO: These lists could go to the NM multiple times, or never.
-      rmNode.containersToClean.clear();
-      rmNode.finishedApplications.clear();
-

INS31 INS78 INS83 INS39 INS42 INS44 INS8 INS42 INS43 INS42 INS21 INS54 INS42 INS32 INS8 INS8 INS22 INS42 INS21 INS21 INS21 INS21 INS21 INS52 INS42 INS32 INS32 INS32 INS32 INS32 INS42 INS42 INS14 INS42 INS42 INS22 INS22 INS42 INS22 INS42 INS22 INS42 INS74 INS22 INS52 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS43 INS43 INS52 INS42 INS42 INS42 DEL40 DEL42 DEL32 DEL21 DEL40 DEL42 DEL32 DEL21