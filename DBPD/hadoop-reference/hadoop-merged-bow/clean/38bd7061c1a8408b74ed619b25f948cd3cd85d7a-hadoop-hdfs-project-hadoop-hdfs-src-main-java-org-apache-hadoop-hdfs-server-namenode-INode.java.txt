HDFS-4529. Disallow concat when one of the src files is in some snapshot.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1468667 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.base.Preconditions;
-   * Called by {@link INode#recordModification}. For a reference node and its
-   * subtree, the function tells which snapshot the modification should be
+   * When {@link #recordModification} is called on a referred node,
+   * this method tells which snapshot the modification should be
-   * @param latest
+   * @param latestInDst
-  public final boolean isInSrcSnapshot(final Snapshot latest) {
-    if (latest == null) {
+  public final boolean shouldRecordInSrcSnapshot(final Snapshot latestInDst) {
+    Preconditions.checkState(!isReference());
+
+    if (latestInDst == null) {
-      if (dstSnapshotId >= latest.getId()) {
+      if (dstSnapshotId >= latestInDst.getId()) {

INS26 INS40 UPD42 UPD42 INS21 UPD66 UPD66 UPD66 UPD42 INS32 INS42 INS42 INS38 UPD42 INS32 INS42 UPD42 DEL42