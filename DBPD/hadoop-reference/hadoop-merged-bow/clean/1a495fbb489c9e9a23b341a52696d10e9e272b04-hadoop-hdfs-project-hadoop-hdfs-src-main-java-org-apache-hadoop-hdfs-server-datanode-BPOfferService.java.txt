HDFS-7645. Rolling upgrade is restoring blocks from trash multiple times (Contributed by Vinayakumar B and Keisuke Ogiwara)

+import org.apache.hadoop.hdfs.protocol.RollingUpgradeStatus;
-   * @param inProgress true if a rolling upgrade is in progress
+   * @param rollingUpgradeStatus rolling upgrade status
-  void signalRollingUpgrade(boolean inProgress) throws IOException {
+  void signalRollingUpgrade(RollingUpgradeStatus rollingUpgradeStatus)
+      throws IOException {
+    if (rollingUpgradeStatus == null) {
+      return;
+    }
-    if (inProgress) {
+    if (!rollingUpgradeStatus.isFinalized()) {
-      dn.getFSDataset().restoreTrash(bpid);
+      dn.getFSDataset().clearTrash(bpid);

INS26 INS40 INS43 INS42 INS25 UPD42 UPD66 INS42 INS27 INS8 INS38 INS42 INS33 INS41 INS32 INS42 INS42 UPD42 DEL39 DEL42 DEL42