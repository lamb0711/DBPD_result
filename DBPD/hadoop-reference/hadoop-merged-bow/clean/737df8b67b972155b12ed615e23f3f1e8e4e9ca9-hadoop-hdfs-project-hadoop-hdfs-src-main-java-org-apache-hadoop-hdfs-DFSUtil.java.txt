HDFS-2716. Configuration needs to allow different dfs.http.addresses for each HA NN. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1226020 13f79535-47bb-0310-9956-ffa450edef68

-  static Collection<String> getNameNodeIds(Configuration conf, String nsId) {
+  public static Collection<String> getNameNodeIds(Configuration conf, String nsId) {
+      
+    String suffixes[];
-      String nameServiceId = DFSUtil.getNameServiceIdFromAddress(
-          conf, namenodeAddr,
+      suffixes = getSuffixIDs(conf, namenodeAddr,
+    } else {
+      suffixes = new String[2];
+    }
-      if (nameServiceId != null) {
-        httpAddress = conf.get(DFSUtil.addKeySuffixes(
-            httpAddressKey, nameServiceId));
-      }
+    return getSuffixedConf(conf, httpAddressKey, httpAddressDefault, suffixes);
+  }
+  
+  private static String getSuffixedConf(Configuration conf,
+      String key, String defaultVal, String[] suffixes) {
+    String ret = conf.get(DFSUtil.addKeySuffixes(key, suffixes));
+    if (ret != null) {
+      return ret;
-    // else - Use non-federation style configuration
-    if (httpAddress == null) {
-      httpAddress = conf.get(httpAddressKey, httpAddressDefault);
-    }
-    return httpAddress;
+    return conf.get(key, defaultVal);

INS31 INS83 INS83 INS83 INS43 INS42 INS44 INS44 INS44 INS44 INS8 INS60 INS41 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS5 INS42 INS60 INS25 INS41 MOV43 INS59 INS8 MOV8 INS32 INS42 INS42 INS42 INS43 INS85 INS43 INS59 INS27 INS8 INS32 INS42 INS85 INS21 INS42 MOV42 MOV42 MOV42 INS42 INS42 INS42 INS42 INS32 INS42 INS33 INS41 INS42 INS42 INS42 INS42 INS7 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS3 INS42 INS42 INS42 INS42 UPD42 MOV42 MOV42 MOV42 MOV40 MOV40 INS5 INS34 INS43 INS85 INS42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL25 DEL8 DEL42 DEL33 DEL27 DEL42 DEL42 DEL32 DEL7 DEL21 DEL8 DEL25 DEL42 DEL41