HDFS-11796. Ozone: MiniOzoneCluster should set "ozone.handler.type" key correctly. Contributed by Mukul Kumar Singh.

-      // TODO throw exception if key exists, may change to support key
-      // overwrite in the future
-      //Check if key already exists.
-      if(metadataManager.get(keyKey) != null) {
-        LOG.error("key already exist: {}/{}/{} ", volumeName, bucketName,
-            keyName);
-        throw new KSMException("Key already exist",
-            KSMException.ResultCodes.FAILED_KEY_ALREADY_EXISTS);
-      }
+      // TODO: Garbage collect deleted blocks due to overwrite of a key.
+      // FIXME: BUG: Please see HDFS-11922.
+      // If user overwrites a key, then we are letting it pass without
+      // corresponding process.
+      // In reality we need to garbage collect those blocks by telling SCM to
+      // clean up those blocks when it can. Right now making this change
+      // allows us to pass tests that expect ozone can overwrite a key.
+
+
+      // When we talk to SCM make sure that we ask for at least a byte in the
+      // block. This way even if the call is for a zero length key, we back it
+      // with a actual SCM block.
+      // TODO : Review this decision later. We can get away with only a
+      // metadata entry in case of 0 length key.
-          scmBlockClient.allocateBlock(args.getDataSize());
+          scmBlockClient.allocateBlock(Math.max(args.getDataSize(), 1));
-    } catch (DBException ex) {
+    } catch (Exception ex) {

UPD43 INS32 UPD42 INS42 INS42 MOV32 UPD42 UPD42 INS34 DEL42 DEL42 DEL42 DEL32 DEL33 DEL27 DEL42 DEL42 DEL45 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL43 DEL45 DEL40 DEL14 DEL53 DEL8 DEL25