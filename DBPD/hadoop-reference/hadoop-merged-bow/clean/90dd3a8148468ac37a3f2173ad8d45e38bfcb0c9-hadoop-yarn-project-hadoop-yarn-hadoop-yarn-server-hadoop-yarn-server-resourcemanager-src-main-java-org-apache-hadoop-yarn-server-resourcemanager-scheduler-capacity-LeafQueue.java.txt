YARN-2009. CapacityScheduler: Add intra-queue preemption for app priority support. (Sunil G via wangda)

+
-        computeUserLimit(application, clusterResource, user, partition,
-            SchedulingMode.RESPECT_PARTITION_EXCLUSIVITY), partition);
+        computeUserLimit(application.getUser(), clusterResource, user,
+            partition, SchedulingMode.RESPECT_PARTITION_EXCLUSIVITY),
+        partition);
-        computeUserLimit(application, clusterResource, queueUser,
+        computeUserLimit(application.getUser(), clusterResource, queueUser,
-  private Resource computeUserLimit(FiCaSchedulerApp application,
+  private Resource computeUserLimit(String userName,
-      String userName = application.getUser();
+  /**
+   * Obtain (read-only) collection of all applications.
+   */
+  public Collection<FiCaSchedulerApp> getAllApplications() {
+    Collection<FiCaSchedulerApp> apps = new HashSet<FiCaSchedulerApp>(
+        pendingOrderingPolicy.getSchedulableEntities());
+    apps.addAll(orderingPolicy.getSchedulableEntities());
+
+    return Collections.unmodifiableCollection(apps);
+  }
+
-              computeUserLimit(app, resources, user, partition,
+              computeUserLimit(app.getUser(), resources, user, partition,
+  public synchronized Resource getUserLimitPerUser(String userName,
+      Resource resources, String partition) {
+
+    // Check user resource limit
+    User user = getUser(userName);
+
+    return computeUserLimit(userName, resources, user, partition,
+        SchedulingMode.RESPECT_PARTITION_EXCLUSIVITY);
+  }
+
-   * return all ignored partition exclusivity RMContainers in the LeafQueue, this
-   * will be used by preemption policy.
+   * @return all ignored partition exclusivity RMContainers in the LeafQueue,
+   *         this will be used by preemption policy.

INS31 INS31 INS29 INS83 INS74 INS42 INS8 INS83 INS83 INS43 INS42 INS44 INS44 INS44 INS8 MOV43 INS42 INS65 INS43 INS43 INS60 INS21 INS41 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS60 INS41 UPD65 INS66 INS42 INS42 INS74 INS59 INS32 INS32 INS42 INS42 INS42 INS43 INS59 INS32 UPD66 UPD66 INS43 INS43 INS42 INS14 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS40 INS32 MOV32 INS42 INS42 INS74 INS32 INS42 INS42 INS42 INS42 MOV42 INS42 MOV42 INS43 INS43 INS42 INS42 INS42 INS42 INS32 MOV42 INS42 DEL42 DEL43 DEL42 DEL42 DEL59 DEL60