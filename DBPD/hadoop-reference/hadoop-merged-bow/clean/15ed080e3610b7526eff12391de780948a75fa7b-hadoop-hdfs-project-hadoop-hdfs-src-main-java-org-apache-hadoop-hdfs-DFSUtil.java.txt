HDFS-9365. Balaner does not work with the HDFS-6376 HA setup.

-  
+
+  /** @return Internal name services specified in the conf. */
+  static Collection<String> getInternalNameServices(Configuration conf) {
+    final Collection<String> ids = conf.getTrimmedStringCollection(
+        DFSConfigKeys.DFS_INTERNAL_NAMESERVICES_KEY);
+    return !ids.isEmpty()? ids: DFSUtilClient.getNameServiceIds(conf);
+  }
+
-   * Get a URI for each configured nameservice. If a nameservice is
+   * Get a URI for each internal nameservice. If a nameservice is
-  public static Collection<URI> getNsServiceRpcUris(Configuration conf) {
-    return getNameServiceUris(conf,
+  public static Collection<URI> getInternalNsRpcUris(Configuration conf) {
+    return getNameServiceUris(conf, getInternalNameServices(conf),
-  public static Collection<URI> getNameServiceUris(Configuration conf,
-      String... keys) {
+  static Collection<URI> getNameServiceUris(Configuration conf,
+      Collection<String> nameServices, String... keys) {
-    for (String nsId : DFSUtilClient.getNameServiceIds(conf)) {
+    for (String nsId : nameServices) {

INS31 INS29 INS83 INS74 INS42 INS44 INS8 UPD42 INS44 INS65 INS43 INS43 INS43 INS42 INS60 INS41 INS74 INS42 INS66 INS42 INS42 INS42 INS83 INS74 INS59 INS16 UPD66 INS43 INS43 INS42 INS43 INS43 INS42 INS32 INS38 INS42 MOV32 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS40 INS32 INS42 INS42 INS42 INS42 DEL83