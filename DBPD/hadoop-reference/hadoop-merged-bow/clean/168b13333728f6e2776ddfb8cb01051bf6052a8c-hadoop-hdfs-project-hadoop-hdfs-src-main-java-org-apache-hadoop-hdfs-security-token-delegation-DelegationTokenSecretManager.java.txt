Merging r1527684 through r1532876 from trunk to branch HDFS-2832

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1532910 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.ipc.RetriableException;
+  @Override
+  public byte[] retriableRetrievePassword(DelegationTokenIdentifier identifier)
+      throws InvalidToken, StandbyException, RetriableException, IOException {
+    namesystem.checkOperation(OperationCategory.READ);
+    try {
+      return super.retrievePassword(identifier);
+    } catch (InvalidToken it) {
+      if (namesystem.inTransitionToActive()) {
+        // if the namesystem is currently in the middle of transition to 
+        // active state, let client retry since the corresponding editlog may 
+        // have not been applied yet
+        throw new RetriableException(it);
+      } else {
+        throw it;
+      }
+    }
+  }
+  

INS26 INS40 INS31 INS78 INS83 INS5 INS42 INS44 INS43 INS43 INS43 INS43 INS8 INS42 INS39 INS85 INS43 INS42 INS42 INS42 INS42 INS42 INS21 INS54 INS42 INS32 INS8 INS12 INS42 INS42 INS40 INS41 INS44 INS8 INS48 INS43 INS42 INS25 INS42 INS42 INS42 INS32 INS8 INS8 INS42 INS42 INS53 INS53 INS14 INS42 INS43 INS42 INS42