HADOOP-14104. Client should always ask namenode for kms provider path. Contributed by Rushabh S Shah.

-import java.net.URISyntaxException;
-    final String providerUriStr = conf.getTrimmed(configKeyName, "");
+    final String providerUriStr = conf.getTrimmed(configKeyName);
-    if (providerUriStr.isEmpty()) {
+    if (providerUriStr == null || providerUriStr.isEmpty()) {
-    final URI providerUri;
-    try {
-      providerUri = new URI(providerUriStr);
-    } catch (URISyntaxException e) {
-      throw new IOException(e);
-    }
+    return createKeyProviderFromUri(conf, URI.create(providerUriStr));
+  }
+
+  public static KeyProvider createKeyProviderFromUri(final Configuration conf,
+      final URI providerUri) throws IOException {
-      throw new IOException("Could not instantiate KeyProvider from " +
-          configKeyName + " setting of '" + providerUriStr + "'");
+      throw new IOException("Could not instantiate KeyProvider for uri: " +
+          providerUri);

INS31 MOV29 INS83 INS83 MOV43 INS42 MOV44 MOV44 MOV43 INS8 INS43 UPD42 INS44 INS44 MOV43 MOV21 INS60 MOV25 INS41 INS42 INS83 INS43 INS42 INS83 MOV43 INS42 INS83 MOV43 INS59 INS27 INS32 INS42 INS42 INS32 INS27 MOV32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS33 INS42 INS42 INS42 UPD45 UPD42 DEL40 DEL26 DEL83 DEL42 DEL42 DEL42 DEL42 DEL45 DEL32 DEL59 DEL60 DEL83 DEL42 DEL59 DEL60 DEL42 DEL42 DEL43 DEL42 DEL14 DEL7 DEL21 DEL8 DEL42 DEL43 DEL42 DEL44 DEL42 DEL14 DEL53 DEL8 DEL12 DEL54 DEL42 DEL45 DEL45