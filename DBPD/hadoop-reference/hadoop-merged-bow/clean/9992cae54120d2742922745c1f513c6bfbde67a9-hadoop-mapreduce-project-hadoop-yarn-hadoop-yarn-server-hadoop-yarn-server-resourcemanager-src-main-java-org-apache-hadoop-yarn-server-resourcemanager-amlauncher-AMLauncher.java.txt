Reverting the previous trunk merge since it added other unintended changes in addition


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1177127 13f79535-47bb-0310-9956-ffa450edef68

-  protected ContainerManager getContainerMgrProxy(
+  private ContainerManager getContainerMgrProxy(
-    LOG.info("Command to launch container "
-        + containerID
-        + " : "
-        + StringUtils.arrayToString(container.getCommands().toArray(
-            new String[0])));
+    StringBuilder mergedCommand = new StringBuilder();
+    String failCount = Integer.toString(application.getAppAttemptId()
+        .getAttemptId());
+    List<String> commandList = new ArrayList<String>();
+    for (String str : container.getCommands()) {
+      // This is out-right wrong. AM FAIL count should be passed via env.
+      String result =
+          str.replaceFirst(ApplicationConstants.AM_FAIL_COUNT_STRING,
+              failCount);
+      mergedCommand.append(result).append(" ");
+      commandList.add(result);
+    }
+    container.setCommands(commandList);
+    /** add the failed count to the app master command line */
+   
+    LOG.info("Command to launch container " + 
+        containerID + " : " + mergedCommand);
-
-    // Set the AppAttemptId to be consumable by the AM.
-    environment.put(ApplicationConstants.APPLICATION_ATTEMPT_ID_ENV,
-        application.getAppAttemptId().toString());
-

UPD83 INS60 INS60 INS60 INS70 INS21 INS43 INS59 MOV43 INS59 INS74 INS59 INS44 MOV32 INS8 INS32 INS42 INS42 INS14 INS42 INS32 INS43 INS43 INS42 INS14 INS43 INS42 INS60 INS21 INS21 INS42 INS42 INS42 INS43 INS42 INS42 INS32 INS42 INS42 INS74 INS42 INS43 INS59 INS32 INS32 INS42 INS42 MOV32 INS42 INS43 INS43 INS42 INS42 INS32 INS32 INS42 INS45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS40 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL42 DEL85 DEL5 DEL34 DEL3 DEL32 DEL32 DEL42 DEL42 DEL40 DEL42 DEL32 DEL32 DEL21