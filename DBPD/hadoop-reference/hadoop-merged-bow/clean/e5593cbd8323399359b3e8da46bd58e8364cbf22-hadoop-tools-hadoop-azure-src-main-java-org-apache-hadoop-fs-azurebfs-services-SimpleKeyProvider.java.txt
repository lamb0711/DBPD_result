HADOOP-15694. ABFS: Allow OAuth credentials to not be tied to accounts.
Contributed by Sean Mackrory.

-import org.apache.hadoop.fs.azurebfs.AzureBlobFileSystem;
+import org.apache.hadoop.fs.azurebfs.AbfsConfiguration;
-import org.apache.hadoop.security.ProviderUtils;
+import org.apache.hadoop.fs.azurebfs.contracts.exceptions.InvalidConfigurationValueException;
-  public String getStorageAccountKey(String accountName, Configuration conf)
+  public String getStorageAccountKey(String accountName, Configuration rawConfig)
+
-      Configuration c = ProviderUtils.excludeIncompatibleCredentialProviders(
-          conf, AzureBlobFileSystem.class);
-      char[] keyChars = c.getPassword(ConfigurationKeys.FS_AZURE_ACCOUNT_KEY_PROPERTY_NAME + accountName);
-      if (keyChars != null) {
-        key = new String(keyChars);
-      }
+      AbfsConfiguration abfsConfig = new AbfsConfiguration(rawConfig, accountName);
+      key = abfsConfig.getPasswordString(ConfigurationKeys.FS_AZURE_ACCOUNT_KEY_PROPERTY_NAME);
+    } catch(IllegalAccessException | InvalidConfigurationValueException e) {
+      throw new KeyProviderException("Failure to initialize configuration", e);
+

UPD40 UPD40 UPD42 INS8 INS12 MOV60 INS21 INS44 INS8 UPD43 INS7 INS84 INS42 INS53 UPD42 UPD42 INS14 INS42 INS32 INS43 INS43 INS14 INS43 INS42 INS42 UPD42 MOV42 UPD42 MOV42 INS40 INS42 INS42 UPD43 MOV43 INS45 UPD42 MOV42 INS42 UPD42 DEL42 DEL42 DEL42 DEL42 DEL43 DEL57 DEL32 DEL39 DEL85 DEL5 DEL42 DEL40 DEL42 DEL27 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL42 DEL14 DEL7 DEL21 DEL8 DEL25 DEL8