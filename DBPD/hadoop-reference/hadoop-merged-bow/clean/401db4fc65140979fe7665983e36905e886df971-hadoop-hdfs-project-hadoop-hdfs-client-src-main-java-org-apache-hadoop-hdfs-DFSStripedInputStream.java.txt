HDFS-8901. Use ByteBuffer in striping positional read. Contributed by Sammi Chen and Kai Zheng.

-    AlignedStripe[] stripes = StripedBlockUtil.divideOneStripe(ecPolicy, cellSize,
-        blockGroup, offsetInBlockGroup,
+    AlignedStripe[] stripes = StripedBlockUtil.divideOneStripe(ecPolicy,
+        cellSize, blockGroup, offsetInBlockGroup,
-      long end, byte[] buf, int offset, CorruptedBlocks corruptedBlocks)
+      long end, ByteBuffer buf, CorruptedBlocks corruptedBlocks)
-        ecPolicy, cellSize, blockGroup, start, end, buf, offset);
+        ecPolicy, cellSize, blockGroup, start, end, buf);
+      buf.position(buf.position() + (int)(end - start + 1));
-      if (chunk.byteBuffer != null) {
-        ByteBufferStrategy strategy =
-            new ByteBufferStrategy(chunk.byteBuffer, readStatistics, dfsClient);
+      if (chunk.useByteBuffer()) {
+        ByteBufferStrategy strategy = new ByteBufferStrategy(
+            chunk.getByteBuffer(), readStatistics, dfsClient);
-            new ByteBufferStrategy[chunk.byteArray.getOffsets().length];
+            new ByteBufferStrategy[chunk.getChunkBuffer().getSlices().size()];
-          ByteBuffer buffer = ByteBuffer.wrap(chunk.byteArray.buf(),
-              chunk.byteArray.getOffsets()[i], chunk.byteArray.getLengths()[i]);
+          ByteBuffer buffer = chunk.getChunkBuffer().getSlice(i);
-    private byte[][] decodeInputs = null;
+    private ByteBuffer[] decodeInputs = null;
-      alignedStripe.chunks[index].addByteArraySlice(0,
-          (int) alignedStripe.getSpanInBlock());

INS43 UPD5 INS42 INS43 INS21 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS27 MOV43 MOV5 INS32 INS11 INS42 INS42 INS39 INS36 MOV43 INS32 MOV5 INS32 INS27 INS42 INS42 INS32 INS42 INS27 INS34 INS32 UPD42 MOV42 INS32 UPD42 MOV42 INS42 INS42 INS42 INS42 INS42 UPD42 MOV42 UPD42 MOV42 DEL39 DEL85 DEL5 DEL39 DEL42 DEL44 DEL42 DEL40 DEL33 DEL27 DEL40 DEL40 DEL32 DEL42 DEL22 DEL42 DEL40 DEL42 DEL32 DEL40 DEL32 DEL42 DEL2 DEL40 DEL32 DEL42 DEL2 DEL39 DEL85 DEL40 DEL42 DEL2 DEL42 DEL34 DEL39 DEL42 DEL42 DEL32 DEL11 DEL32 DEL21