YARN-1070. Fixed race conditions in NodeManager during container-kill. Contributed by Zhijie Shen.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1527827 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState;
+    // CONTAINER_KILLED_ON_REQUEST should not be missed if the container
+    // is already at KILLING
+    if (container.getContainerState() == ContainerState.KILLING) {
+      dispatcher.getEventHandler().handle(
+          new ContainerExitEvent(containerID,
+              ContainerEventType.CONTAINER_KILLED_ON_REQUEST,
+              Shell.WINDOWS ? ExitCode.FORCE_KILLED.getExitCode() :
+                  ExitCode.TERMINATED.getExitCode(),
+              "Container terminated before launch."));
+      return 0;
+    }
+
-        RPCUtil.getRemoteException(
+        throw RPCUtil.getRemoteException(

INS26 INS40 INS25 INS27 INS8 INS32 INS40 INS21 INS41 INS42 INS42 INS32 INS34 INS32 INS42 INS14 INS53 INS42 INS42 INS43 INS42 INS40 INS16 INS45 MOV32 INS42 INS40 INS32 INS32 INS40 INS42 INS40 INS42 DEL21