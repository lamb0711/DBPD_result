HDFS-5840. Follow-up to HDFS-5138 to improve error handling during partial upgrade failures. Contributed by Aaron T. Myers, Suresh Srinivas, and Jing Zhao.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1581260 13f79535-47bb-0310-9956-ffa450edef68

+import com.google.common.base.Preconditions;
+
-    assert sd.getCurrentDir().exists() : "Current directory must exist.";
+    Preconditions.checkState(sd.getCurrentDir().exists(),
+        "Current directory must exist.");
-    assert curDir.exists() : "Current directory must exist.";
-    assert !prevDir.exists() : "previous directory must not exist.";
-    assert !tmpDir.exists() : "previous.tmp directory must not exist.";
+
+    Preconditions.checkState(curDir.exists(),
+        "Current directory must exist for preupgrade.");
+    Preconditions.checkState(!prevDir.exists(),
+        "Previous directory must not exist for preupgrade.");
+    Preconditions.checkState(!tmpDir.exists(),
+        "Previous.tmp directory must not exist for preupgrade."
+            + "Consider restarting for recovery.");
+      Preconditions.checkState(!prevDir.exists(),
+          "previous directory must not exist for upgrade.");
+      Preconditions.checkState(tmpDir.exists(),
+          "previous.tmp directory must exist for upgrade.");
+
-    if (!prevDir.exists())
+    if (!prevDir.exists()) {
+    }
-    assert !tmpDir.exists() : "removed.tmp directory must not exist.";
+    Preconditions.checkState(!tmpDir.exists(),
+        "removed.tmp directory must not exist for rollback."
+            + "Consider restarting for recovery.");
-    assert curDir.exists() : "Current directory must exist.";
+    Preconditions.checkState(curDir.exists(),
+        "Current directory must exist for rollback.");
+

INS26 INS40 INS21 INS21 INS21 INS21 INS21 INS21 INS32 INS32 INS32 INS32 INS8 INS32 INS32 INS42 INS42 MOV32 INS45 INS42 INS42 MOV32 INS45 INS42 INS42 MOV38 INS45 INS42 INS42 MOV38 INS27 INS21 INS21 INS41 INS42 INS42 MOV38 INS27 INS42 INS42 MOV32 INS45 INS45 INS45 INS32 INS32 INS45 INS45 INS42 INS42 INS38 INS45 INS42 INS42 INS32 INS45 INS32 INS42 INS42 INS42 INS42 DEL45 DEL6 DEL45 DEL6 DEL45 DEL6 DEL45 DEL6 DEL41 DEL45 DEL6 DEL45 DEL6