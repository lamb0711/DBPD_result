HDFS-14026. Overload BlockPoolTokenSecretManager.checkAccess to make storageId and storageType optional. Contributed by Arpit Agarwal.

+  /** Check if access should be allowed. userID is not checked if null */
+  public void checkAccess(Token<BlockTokenIdentifier> token, String userId,
+      ExtendedBlock block, BlockTokenIdentifier.AccessMode mode)
+      throws InvalidToken {
+    BlockTokenIdentifier id = new BlockTokenIdentifier();
+    try {
+      id.readFields(new DataInputStream(new ByteArrayInputStream(token
+          .getIdentifier())));
+    } catch (IOException e) {
+      throw new InvalidToken(
+          "Unable to de-serialize block token identifier for user=" + userId
+              + ", block=" + block + ", access mode=" + mode);
+    }
+    checkAccess(id, userId, block, mode);
+    if (!Arrays.equals(retrievePassword(id), token.getPassword())) {
+      throw new InvalidToken("Block token with " + id
+          + " doesn't have the correct token password");
+    }
+  }
+

INS31 INS29 INS83 INS39 INS42 INS44 INS44 INS44 INS44 INS43 INS8 INS65 INS74 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS42 INS60 INS54 INS21 INS25 INS66 INS43 INS43 INS42 INS42 INS40 INS43 INS59 INS8 INS12 INS32 INS38 INS8 INS42 INS42 INS42 INS42 INS14 INS21 INS44 INS8 INS42 INS42 INS42 INS42 INS42 INS32 INS53 INS43 INS32 INS43 INS42 INS53 INS42 INS42 INS32 INS32 INS14 INS42 INS42 INS42 INS14 INS42 INS14 INS42 INS42 INS42 INS42 INS43 INS27 INS43 INS14 INS43 INS27 INS42 INS45 INS42 INS45 INS42 INS43 INS32 INS42 INS45 INS42 INS45 INS42 INS45 INS42 INS42 INS42 INS42