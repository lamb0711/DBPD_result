HDFS-12502. nntop should support a category based on FilesInGetListingOps.

+  /**
+   * In addition to counts of different RPC calls, NNTop also reports top
+   * users listing large directories (measured by the number of files involved
+   * in listing operations from the user). This is important because the CPU
+   * and GC overhead of a listing operation grows linearly with the number of
+   * files involved. This category in NNTop is {@link #FILES_IN_GETLISTING}.
+   */
+  public static final String FILES_IN_GETLISTING = "filesInGetListing";
-    report(userName, cmd);
+    report(userName, cmd, 1);
-  public void report(String userName, String cmd) {
+  public void reportFilesInGetListing(String userName, int numFiles) {
+    report(userName, FILES_IN_GETLISTING, numFiles);
+  }
+
+  public void report(String userName, String cmd, int delta) {
-    report(currTime, userName, cmd);
+    report(currTime, userName, cmd, delta);
-  public void report(long currTime, String userName, String cmd) {
+  public void report(long currTime, String userName, String cmd, int delta) {
-      rollingWindowManager.recordMetric(currTime, cmd, userName, 1);
-      rollingWindowManager.recordMetric(currTime,
-          TopConf.ALL_CMDS, userName, 1);
+      rollingWindowManager.recordMetric(currTime, cmd, userName, delta);
+      // Increase the number of all RPC calls by the user, unless the report
+      // is for the number of files in a listing operation.
+      if (!cmd.equals(FILES_IN_GETLISTING)) {
+        rollingWindowManager.recordMetric(currTime,
+            TopConf.ALL_CMDS, userName, delta);
+      }

INS23 INS31 INS29 INS83 INS83 INS83 INS43 INS59 INS83 INS39 INS42 INS44 INS44 INS8 INS44 INS44 INS65 INS42 INS42 INS45 INS43 INS42 INS39 INS42 INS21 INS39 INS42 INS39 INS42 INS66 INS66 INS66 INS66 INS66 INS65 INS66 INS42 INS32 INS67 INS34 INS42 INS42 INS42 INS42 INS42 INS25 INS42 INS38 INS8 INS42 INS32 MOV21 INS42 INS42 INS42 INS42 DEL34 DEL34