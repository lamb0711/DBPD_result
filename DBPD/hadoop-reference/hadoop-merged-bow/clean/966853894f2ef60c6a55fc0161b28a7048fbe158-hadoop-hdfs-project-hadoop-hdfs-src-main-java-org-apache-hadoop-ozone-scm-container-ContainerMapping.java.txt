HDFS-12795. Ozone: SCM: Support for Container LifeCycleState PENDING_CLOSE and LifeCycleEvent FULL_CONTAINER. Contributed by Nandakumar.

+import static org.apache.hadoop.ozone.scm.exceptions.SCMException.ResultCodes.FAILED_TO_CHANGE_CONTAINER_STATE;
-
-      if (event == OzoneProtos.LifeCycleEvent.BEGIN_CREATE) {
+      switch (event) {
+      case BEGIN_CREATE:
-      } else if (event == OzoneProtos.LifeCycleEvent.COMPLETE_CREATE) {
+        break;
+      case COMPLETE_CREATE:
+        break;
+      case TIMEOUT:
+        break;
+      case CLEANUP:
+        break;
+      case FULL_CONTAINER:
+        break;
+      case CLOSE:
+        break;
+      case UPDATE:
+        break;
+      case DELETE:
+        break;
+      default:
+        throw new SCMException("Unsupported container LifeCycleEvent.",
+            FAILED_TO_CHANGE_CONTAINER_STATE);
+      // If the below updateContainerState call fails, we should revert the
+      // changes made in switch case.
+      // Like releasing the lease in case of BEGIN_CREATE.
-            ContainerInfo updatedContainer =
-                containerStateManager.updateContainerState(
-                    ContainerInfo.fromProtobuf(newContainerInfo),
-                    OzoneProtos.LifeCycleEvent.CLOSE);
-            if (updatedContainer.getState() !=
-                OzoneProtos.LifeCycleState.CLOSED) {
+            OzoneProtos.LifeCycleState state = updateContainerState(
+                ContainerInfo.fromProtobuf(newContainerInfo).getContainerName(),
+                OzoneProtos.LifeCycleEvent.FULL_CONTAINER);
+            if (state != OzoneProtos.LifeCycleState.PENDING_CLOSE) {
-                      "in state {}", containerInfo.getContainerName(),
-                  updatedContainer.getState());
+                      "in state {}", containerInfo.getContainerName(), state);

INS26 INS40 INS50 INS42 INS49 MOV60 MOV21 INS10 INS49 MOV21 INS10 INS49 INS10 INS49 INS10 INS49 INS10 INS49 INS10 INS49 INS10 INS49 INS10 INS49 INS53 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS14 INS43 INS45 INS42 INS42 UPD43 INS40 INS42 INS32 INS42 UPD40 INS42 MOV32 MOV42 INS40 UPD42 UPD42 MOV42 DEL42 DEL40 DEL27 DEL8 DEL42 DEL40 DEL27 DEL8 DEL25 DEL25 DEL42 DEL42 DEL40 DEL42 DEL42 DEL42 DEL32 DEL42 DEL32