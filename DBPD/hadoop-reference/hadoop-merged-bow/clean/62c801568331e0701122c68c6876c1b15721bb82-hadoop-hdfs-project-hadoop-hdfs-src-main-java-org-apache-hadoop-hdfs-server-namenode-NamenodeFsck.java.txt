HDFS-15227. NPE if the last block changes from COMMITTED to COMPLETE during FSCK. Contributed by Ayush Saxena.

+import org.apache.hadoop.hdfs.server.blockmanagement.BlockUnderConstructionFeature;
-      DatanodeStorageInfo[] storages = storedBlock
-          .getUnderConstructionFeature().getExpectedStorageLocations();
-      report.append('\n')
-          .append("Under Construction Block:\n")
-          .append(blockNumber).append(". ").append(blkName)
-          .append(" len=").append(block.getNumBytes())
-          .append(" Expected_repl=" + storages.length);
-      String info=getReplicaInfo(storedBlock);
-      if (!info.isEmpty()){
-        report.append(" ").append(info);
+      BlockUnderConstructionFeature uc =
+          storedBlock.getUnderConstructionFeature();
+      if (uc != null) {
+        // BlockUnderConstructionFeature can be null, in case the block was
+        // in committed state, and the IBR came just after the check.
+        DatanodeStorageInfo[] storages = uc.getExpectedStorageLocations();
+        report.append('\n').append("Under Construction Block:\n")
+            .append(blockNumber).append(". ").append(blkName).append(" len=")
+            .append(block.getNumBytes())
+            .append(" Expected_repl=" + storages.length);
+        String info = getReplicaInfo(storedBlock);
+        if (!info.isEmpty()) {
+          report.append(" ").append(info);
+        }

INS26 INS40 INS25 INS43 INS27 INS8 INS42 UPD42 MOV32 INS42 INS33 INS60 MOV21 MOV60 MOV25 MOV5 INS59 INS42 INS32 INS42 INS42 DEL42 DEL32