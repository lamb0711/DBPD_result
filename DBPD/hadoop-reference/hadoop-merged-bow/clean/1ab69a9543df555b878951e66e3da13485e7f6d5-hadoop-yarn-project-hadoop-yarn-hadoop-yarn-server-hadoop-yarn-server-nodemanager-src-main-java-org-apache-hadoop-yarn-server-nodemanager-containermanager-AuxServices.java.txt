YARN-9221.  Added flag to disable dynamic auxiliary service feature.
            Contributed by Billie Rinaldi

-  private Path manifest;
-  private FileSystem manifestFS;
+  private volatile boolean manifestEnabled = false;
+  private volatile Path manifest;
+  private volatile FileSystem manifestFS;
+   * Returns whether aux services manifest / dynamic loading is enabled.
+   */
+  public boolean isManifestEnabled() {
+    return manifestEnabled;
+  }
+
+  /**
-  private void reloadManifest() throws IOException {
+  @VisibleForTesting
+  protected void reloadManifest() throws IOException {
-   * @throws IOException if aux services have not been started yet
+   * @throws IOException if aux services have not been started yet or dynamic
+   * reloading is not enabled
-  public void reload(AuxServiceRecords services) throws IOException {
+  public synchronized void reload(AuxServiceRecords services) throws
+      IOException {
+    if (!manifestEnabled) {
+      throw new IOException("Dynamic reloading is not enabled via " +
+          YarnConfiguration.NM_AUX_SERVICES_MANIFEST_ENABLED);
+    }
+    if (!manifestEnabled) {
+      throw new IOException("Dynamic reloading is not enabled via " +
+          YarnConfiguration.NM_AUX_SERVICES_MANIFEST_ENABLED);
+    }
-    String manifestStr = conf.get(YarnConfiguration.NM_AUX_SERVICES_MANIFEST);
-    if (manifestStr == null) {
+    manifestEnabled = conf.getBoolean(
+        YarnConfiguration.NM_AUX_SERVICES_MANIFEST_ENABLED,
+        YarnConfiguration.DEFAULT_NM_AUX_SERVICES_MANIFEST_ENABLED);
+    if (!manifestEnabled) {
-      manifest = new Path(manifestStr);
-      manifestFS = FileSystem.get(new URI(manifestStr), conf);
-      loadManifest(conf, false);
+      String manifestStr = conf.get(YarnConfiguration.NM_AUX_SERVICES_MANIFEST);
+      if (manifestStr != null) {
+        manifest = new Path(manifestStr);
+        manifestFS = FileSystem.get(new URI(manifestStr), conf);
+        loadManifest(conf, false);
+        manifestReloadInterval = conf.getLong(
+            YarnConfiguration.NM_AUX_SERVICES_MANIFEST_RELOAD_MS,
+            YarnConfiguration.DEFAULT_NM_AUX_SERVICES_MANIFEST_RELOAD_MS);
+        manifestReloadTask = new ManifestReloadTask();
+      } else {
+        LOG.info("Auxiliary services manifest is enabled, but no manifest " +
+            "file is specified in the configuration.");
+      }
-    manifestReloadInterval = conf.getLong(
-        YarnConfiguration.NM_AUX_SERVICES_MANIFEST_RELOAD_MS,
-        YarnConfiguration.DEFAULT_NM_AUX_SERVICES_MANIFEST_RELOAD_MS);
-    manifestReloadTask = new ManifestReloadTask();
-    if (manifest != null && manifestReloadInterval > 0) {
-      manifestReloadTimer = new Timer("AuxServicesManifestRelaod-Timer",
+    if (manifestEnabled && manifest != null && manifestReloadInterval > 0) {
+      LOG.info("Scheduling reloading auxiliary services manifest file at " +
+          "interval " + manifestReloadInterval + " ms");
+      manifestReloadTimer = new Timer("AuxServicesManifestReload-Timer",

INS23 INS31 INS83 INS83 INS39 INS59 INS83 INS83 INS29 INS83 INS39 INS42 INS8 INS78 UPD83 INS83 MOV25 INS42 INS9 INS65 INS41 INS42 INS25 INS25 INS66 INS42 UPD66 INS66 INS38 INS8 INS38 INS8 INS38 INS8 INS42 INS53 INS42 INS53 UPD42 INS42 MOV60 INS25 INS27 INS21 INS14 INS14 UPD42 UPD40 UPD40 UPD27 MOV27 MOV8 INS8 INS42 MOV27 INS32 INS43 INS27 INS43 INS27 INS21 MOV21 INS21 INS42 INS42 INS27 INS42 INS45 INS40 INS42 INS45 INS40 INS7 INS32 INS27 INS42 INS45 UPD45 INS42 INS32 INS42 INS42 INS27 INS45 INS45 INS42 INS42 INS40 INS40 INS45 INS45