Merge branch 'HDFS-9806' into trunk

+import org.apache.hadoop.fs.StorageType;
+    DatanodeStorageInfo providedStorageInfo = null;
-      if(cur != null && cur.getDatanodeDescriptor() == dn) {
-        return cur;
+      if(cur != null) {
+        if (cur.getStorageType() == StorageType.PROVIDED) {
+          // if block resides on provided storage, only match the storage ids
+          if (dn.getStorageInfo(cur.getStorageID()) != null) {
+            // do not return here as we have to check the other
+            // DatanodeStorageInfos for this block which could be local
+            providedStorageInfo = cur;
+          }
+        } else if (cur.getDatanodeDescriptor() == dn) {
+          return cur;
+        }
-    return null;
+    return providedStorageInfo;

INS26 INS40 INS60 INS41 INS43 INS59 INS42 INS42 INS42 INS33 INS25 MOV27 INS8 INS25 INS27 INS8 MOV25 INS32 INS40 INS25 MOV27 INS42 INS42 INS27 INS8 INS32 INS33 INS21 INS42 INS42 INS32 INS7 INS42 INS42 INS42 INS42 DEL27 DEL33 DEL41