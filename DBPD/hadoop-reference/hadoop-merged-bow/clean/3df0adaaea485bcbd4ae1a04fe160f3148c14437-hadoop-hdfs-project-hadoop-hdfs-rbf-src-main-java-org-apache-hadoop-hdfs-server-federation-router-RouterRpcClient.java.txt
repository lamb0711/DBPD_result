HDFS-15127. RBF: Do not allow writes when a subcluster is unavailable for HASH_ALL mount points. Contributed by Inigo Goiri

+    // Go over the results and exceptions
+    final List<IOException> thrownExceptions = new ArrayList<>();
+    IOException firstUnavailableException = null;
-      // Response from all servers required, use this error.
-      if (requireResponse && result.hasException()) {
-        throw result.getException();
+      if (result.hasException()) {
+        IOException ioe = result.getException();
+        thrownExceptions.add(ioe);
+        // Track unavailable exceptions to throw them first
+        if (isUnavailableException(ioe)) {
+          firstUnavailableException = ioe;
+        }
-    // Throw the exception for the first location if there are no results
-    if (ret.isEmpty()) {
-      final RemoteResult<T, R> result = results.get(0);
-      if (result.hasException()) {
-        throw result.getException();
+    // Throw exceptions if needed
+    if (!thrownExceptions.isEmpty()) {
+      // Throw if response from all servers required or no results
+      if (requireResponse || ret.isEmpty()) {
+        // Throw unavailable exceptions first
+        if (firstUnavailableException != null) {
+          throw firstUnavailableException;
+        } else {
+          throw thrownExceptions.get(0);
+        }

INS60 INS60 INS25 MOV83 INS74 INS59 INS43 INS59 INS38 INS8 UPD43 MOV43 UPD43 MOV43 INS42 INS14 INS42 INS42 INS33 INS32 MOV25 UPD42 UPD42 INS74 MOV32 INS8 UPD42 MOV42 UPD42 MOV42 INS27 INS8 UPD43 MOV43 MOV42 INS60 INS21 INS25 INS42 MOV32 INS25 UPD42 INS43 INS59 INS32 INS32 MOV8 INS27 INS8 MOV8 INS42 INS42 MOV32 INS42 INS42 INS42 INS42 INS42 INS21 INS42 INS33 INS53 INS7 INS42 INS42 INS42 UPD42 UPD42 INS34 DEL53 DEL42 DEL32 DEL27 DEL74 DEL42 DEL34 DEL32 DEL59 DEL60 DEL8 DEL25