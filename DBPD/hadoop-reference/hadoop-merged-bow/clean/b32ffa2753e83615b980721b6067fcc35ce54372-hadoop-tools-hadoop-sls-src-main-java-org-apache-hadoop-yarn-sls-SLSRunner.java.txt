YARN-4779. Fix AM container allocation logic in SLS. Contributed by Wangda Tan.

+import java.util.concurrent.ConcurrentHashMap;
+import org.apache.hadoop.yarn.server.resourcemanager.amlauncher.ApplicationMasterLauncher;
+import org.apache.hadoop.yarn.sls.resourcemanager.MockAMLauncher;
-    nmMap = new HashMap<NodeId, NMSimulator>();
-    queueAppNumMap = new HashMap<String, Integer>();
-    amMap = new HashMap<String, AMSimulator>();
-    amClassMap = new HashMap<String, Class>();
+    nmMap = new HashMap<>();
+    queueAppNumMap = new HashMap<>();
+    amMap = new ConcurrentHashMap<>();
+    amClassMap = new HashMap<>();
-    rm = new ResourceManager();
+
+    final SLSRunner se = this;
+    rm = new ResourceManager() {
+      @Override
+      protected ApplicationMasterLauncher createAMLauncher() {
+        return new MockAMLauncher(se, this.rmContext, amMap);
+      }
+    };

INS26 INS26 INS26 INS40 INS40 INS40 MOV21 INS60 INS83 INS43 INS59 UPD42 UPD42 INS42 INS42 INS52 INS14 UPD74 UPD74 UPD74 UPD74 MOV43 INS1 UPD43 INS31 UPD42 INS78 INS83 INS43 INS42 INS8 INS42 INS42 INS41 INS14 INS43 INS42 INS22 INS42 INS42 INS52 INS42 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL42 DEL43 DEL14