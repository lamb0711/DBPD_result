HDDS-279. DeleteBlocks command should not be sent for open containers. Contributed by Lokesh Jain.

+
+import org.apache.hadoop.hdds.scm.container.common.helpers.ContainerWithPipeline;
-  public void addTransaction(DeletedBlocksTransaction tx,
-      Set<UUID> dnsWithTransactionCommitted) throws IOException {
+  public boolean addTransaction(DeletedBlocksTransaction tx,
+      Set<UUID> dnsWithTransactionCommitted) {
-      pipeline = mappingService.getContainerWithPipeline(tx.getContainerID())
-          .getPipeline();
+      ContainerWithPipeline containerWithPipeline =
+          mappingService.getContainerWithPipeline(tx.getContainerID());
+      if (containerWithPipeline.getContainerInfo().isContainerOpen()) {
+        return false;
+      }
+      pipeline = containerWithPipeline.getPipeline();
+      return false;
-      return;
+      return false;
+    return true;

INS26 INS40 UPD39 INS41 INS9 INS60 INS25 INS43 INS59 INS32 INS8 INS41 INS9 INS42 INS42 MOV32 INS32 INS42 INS41 INS9 INS42 INS42 INS9 INS42 DEL42 DEL43