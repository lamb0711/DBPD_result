YARN-1435. Modified Distributed Shell to accept either the command or the custom script. Contributed by Xuan Gong.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1550867 13f79535-47bb-0310-9956-ffa450edef68

-  private final String ExecShellStringPath = "ExecShellScript.sh";
+  private static final String ExecShellStringPath = "ExecShellScript.sh";
+  private static final String ExecBatScripStringtPath = "ExecBatScript.bat";
-  private final String log4jPath = "log4j.properties";
+  private static final String log4jPath = "log4j.properties";
-  private final String shellCommandPath = "shellCommands";
-  private final String shellArgsPath = "shellArgs";
+  private static final String shellCommandPath = "shellCommands";
+  private static final String shellArgsPath = "shellArgs";
+  private final String linux_bash_command = "bash";
+  private final String windows_command = "cmd /c";
+
-    opts.addOption("shell_script", true,
-        "Location of the shell script to be executed");
-    if (!fileExist(shellCommandPath)) {
+    if (!fileExist(shellCommandPath)
+        && envs.get(DSConstants.DISTRIBUTEDSHELLSCRIPTLOCATION).isEmpty()) {
-          "No shell command specified to be executed by application master");
+          "No shell command or shell script specified to be executed by application master");
-    shellCommand = readContent(shellCommandPath);
+
+    if (fileExist(shellCommandPath)) {
+      shellCommand = readContent(shellCommandPath);
+    }
-        localResources.put(ExecShellStringPath, shellRsrc);
+        localResources.put(Shell.WINDOWS ? ExecBatScripStringtPath :
+            ExecShellStringPath, shellRsrc);
+        shellCommand = Shell.WINDOWS ? windows_command : linux_bash_command;
-        vargs.add(ExecShellStringPath);
+        vargs.add(Shell.WINDOWS ? ExecBatScripStringtPath
+            : ExecShellStringPath);

INS23 INS23 INS23 INS83 INS83 INS83 INS83 INS43 INS59 INS83 INS83 INS83 INS83 INS83 INS43 INS59 INS83 INS83 INS43 INS59 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS42 INS45 INS25 INS27 INS32 INS8 MOV38 INS32 UPD42 MOV42 UPD42 MOV42 MOV21 INS32 INS42 INS21 INS42 INS42 INS40 UPD45 INS7 INS16 INS42 INS16 INS16 INS40 INS42 INS42 INS40 INS42 INS42 INS40 INS42 INS42 DEL45 DEL9 DEL45 DEL32 DEL21 DEL42 DEL42