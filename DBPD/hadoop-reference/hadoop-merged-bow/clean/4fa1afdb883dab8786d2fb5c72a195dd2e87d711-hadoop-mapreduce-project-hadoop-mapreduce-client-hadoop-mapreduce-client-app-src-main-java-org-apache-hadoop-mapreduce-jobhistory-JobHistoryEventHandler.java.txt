YARN-4675. Reorganize TimelineClient and TimelineClientImpl into separate classes for ATSv1.x and ATSv2. Contributed by Naganarasimha G R.

+import org.apache.hadoop.yarn.client.api.TimelineV2Client;
-import com.fasterxml.jackson.databind.ObjectMapper;
-import com.fasterxml.jackson.databind.node.JsonNodeFactory;
-  private static final JsonNodeFactory FACTORY =
-      new ObjectMapper().getNodeFactory();
+  @VisibleForTesting
-
-  private boolean timelineServiceV2Enabled = false;
+  @VisibleForTesting
+  protected TimelineV2Client timelineV2Client;
-
-        timelineClient =
-            ((MRAppMaster.RunningAppContext)context).getTimelineClient();
-        timelineClient.init(conf);
-        timelineServiceV2Enabled =
-            YarnConfiguration.timelineServiceV2Enabled(conf);
+        boolean timelineServiceV2Enabled =
+            ((int) YarnConfiguration.getTimelineServiceVersion(conf) == 2);
+        if(timelineServiceV2Enabled) {
+          timelineV2Client =
+              ((MRAppMaster.RunningAppContext)context).getTimelineV2Client();
+          timelineV2Client.init(conf);
+        } else {
+          timelineClient =
+              ((MRAppMaster.RunningAppContext) context).getTimelineClient();
+          timelineClient.init(conf);
+        }
+    } else if (timelineV2Client != null) {
+      timelineV2Client.start();
+    } else if (timelineV2Client != null) {
+      timelineV2Client.stop();
-        if (timelineClient != null) {
-          if (timelineServiceV2Enabled) {
-            processEventForNewTimelineService(historyEvent, event.getJobID(),
-                event.getTimestamp());
-          } else {
-            processEventForTimelineServer(historyEvent, event.getJobID(),
-                event.getTimestamp());
-          }
+        if (timelineV2Client != null) {
+          processEventForNewTimelineService(historyEvent, event.getJobID(),
+              event.getTimestamp());
+        } else if (timelineClient != null) {
+          processEventForTimelineServer(historyEvent, event.getJobID(),
+              event.getTimestamp());
-            timelineClient.putEntities(jobEntityForConfigs);
-            timelineClient.putEntities(appEntityForConfigs);
+            timelineV2Client.putEntities(jobEntityForConfigs);
+            timelineV2Client.putEntities(appEntityForConfigs);
-        timelineClient.putEntities(jobEntityForConfigs);
-        timelineClient.putEntities(appEntityForConfigs);
+        timelineV2Client.putEntities(jobEntityForConfigs);
+        timelineV2Client.putEntities(appEntityForConfigs);
-        timelineClient.putEntitiesAsync(tEntity);
+        timelineV2Client.putEntitiesAsync(tEntity);
-        timelineClient.putEntities(tEntity, appEntityWithJobMetrics);
+        timelineV2Client.putEntities(tEntity, appEntityWithJobMetrics);

MOV26 MOV23 UPD40 INS78 INS78 UPD83 UPD43 INS42 INS42 UPD42 UPD42 INS25 INS25 INS27 INS8 INS27 INS8 INS8 INS42 INS33 INS21 INS42 INS33 INS21 INS60 INS25 MOV21 INS32 INS32 MOV25 INS39 INS59 INS42 INS8 MOV8 INS42 INS42 INS42 INS42 INS27 INS25 INS42 INS36 INS21 INS21 INS42 INS33 MOV27 MOV8 UPD42 UPD42 UPD42 UPD42 INS27 INS7 INS32 INS11 INS34 INS42 INS32 INS42 INS42 INS42 INS39 INS32 INS36 INS42 INS42 INS42 INS42 INS11 UPD42 UPD42 INS43 INS42 INS40 DEL40 DEL26 DEL83 DEL83 DEL42 DEL43 DEL14 DEL42 DEL32 DEL83 DEL39 DEL42 DEL9 DEL59 DEL23 DEL42 DEL42 DEL42 DEL42 DEL32 DEL7 DEL21 DEL42 DEL8 DEL25