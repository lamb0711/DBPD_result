Merge trunk into HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1196458 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.hdfs.server.namenode.FSNamesystem;
+import org.apache.hadoop.hdfs.server.namenode.FSClusterStats;
- * This class is a helper class for {@link FSNamesystem} and requires several
- * methods to be called with lock held on {@link FSNamesystem}.
-  public BlockManager(FSNamesystem fsn, Configuration conf) throws IOException {
-    namesystem = fsn;
-    datanodeManager = new DatanodeManager(this, fsn, conf);
+  public BlockManager(final Namesystem namesystem, final FSClusterStats stats,
+      final Configuration conf) throws IOException {
+    this.namesystem = namesystem;
+    datanodeManager = new DatanodeManager(this, namesystem, conf);
-        conf, fsn, datanodeManager.getNetworkTopology());
+        conf, stats, datanodeManager.getNetworkTopology());
-    // Update FSNamesystemMetrics counters
+    // Update counters

UPD40 INS44 INS83 UPD43 UPD42 INS83 INS43 INS42 INS83 UPD42 INS42 INS22 UPD42 INS52 INS42 UPD42 UPD42 DEL66 DEL42 DEL65 DEL66 DEL66 DEL42 DEL65 DEL66 DEL42