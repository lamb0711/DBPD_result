YARN-3122. Metrics for container's actual CPU usage. (Anubhav Dhoot via kasha)

+import org.apache.hadoop.yarn.server.nodemanager.util.NodeManagerHardwareUtils;
+  private int nodeCpuPercentageForYARN;
+    nodeCpuPercentageForYARN =
+        NodeManagerHardwareUtils.getNodeCpuPercentage(conf);
+
+            // if machine has 6 cores and 3 are used,
+            // cpuUsagePercentPerCore should be 300% and
+            // cpuUsageTotalCoresPercentage should be 50%
+            float cpuUsagePercentPerCore = pTree.getCpuUsagePercent();
+            float cpuUsageTotalCoresPercentage = cpuUsagePercentPerCore /
+                resourceCalculatorPlugin.getNumProcessors();
+
+            // Multiply by 1000 to avoid losing data when converting to int
+            int milliVcoresUsed = (int) (cpuUsageTotalCoresPercentage * 1000
+                * maxVCoresAllottedForContainers /nodeCpuPercentageForYARN);
+              ContainerMetrics.forContainer(
+                  containerId, containerMetricsPeriodMs).recordCpuUsage
+                  ((int)cpuUsagePercentPerCore, milliVcoresUsed);

INS26 INS40 INS23 INS83 INS39 INS59 INS42 INS21 INS7 INS42 INS32 INS42 INS42 INS42 INS60 INS60 INS60 INS39 INS59 INS39 INS59 INS39 INS59 INS42 INS32 INS42 INS27 INS42 INS11 INS21 INS42 INS42 INS42 INS32 INS39 INS36 INS32 INS42 INS42 INS27 INS32 INS42 INS11 INS42 INS27 INS42 INS42 INS42 INS42 INS42 INS39 INS42 INS42 INS34 INS42