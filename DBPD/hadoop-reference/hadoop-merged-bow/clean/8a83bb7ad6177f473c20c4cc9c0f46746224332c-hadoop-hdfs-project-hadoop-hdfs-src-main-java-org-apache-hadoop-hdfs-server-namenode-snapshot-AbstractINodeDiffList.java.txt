HDFS-4667. Capture renamed files/directories in snapshot diff report. Contributed by Jing Zhao and Binglin Chang.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1604488 13f79535-47bb-0310-9956-ffa450edef68

-  
-  /**
-   * Check if changes have happened between two snapshots.
-   * @param earlier The snapshot taken earlier
-   * @param later The snapshot taken later
-   * @return Whether or not modifications (including diretory/file metadata
-   *         change, file creation/deletion under the directory) have happened
-   *         between snapshots.
-   */
-  final boolean changedBetweenSnapshots(Snapshot earlier, Snapshot later) {
+
+  final int[] changedBetweenSnapshots(Snapshot from, Snapshot to) {
+    Snapshot earlier = from;
+    Snapshot later = to;
+    if (Snapshot.ID_COMPARATOR.compare(from, to) > 0) {
+      earlier = to;
+      later = from;
+    }
+
+    int laterDiffIndex = later == null ? size : Collections
+        .binarySearch(diffs, later.getId());
-      return false;
+      return null;
-    if (later != null) {
-      int laterDiffIndex = Collections.binarySearch(diffs, later.getId());
-      if (laterDiffIndex == -1 || laterDiffIndex == 0) {
-        // if the laterSnapshot is the earliest SnapshotDiff stored in diffs, or
-        // before it, no modification happened before the laterSnapshot
-        return false;
-      }
+    if (laterDiffIndex == -1 || laterDiffIndex == 0) {
+      // if the laterSnapshot is the earliest SnapshotDiff stored in diffs, or
+      // before it, no modification happened before the laterSnapshot
+      return null;
-    return true;
+    earlierDiffIndex = earlierDiffIndex < 0 ? (-earlierDiffIndex - 1)
+        : earlierDiffIndex;
+    laterDiffIndex = laterDiffIndex < 0 ? (-laterDiffIndex - 1)
+        : laterDiffIndex;
+    return new int[]{earlierDiffIndex, laterDiffIndex};

INS5 MOV25 INS39 INS85 INS43 INS42 INS43 INS42 INS60 INS60 MOV60 MOV25 INS21 INS21 INS42 INS42 MOV43 INS59 MOV43 INS59 UPD27 INS7 INS7 INS3 INS42 INS42 INS42 INS42 INS32 INS34 INS21 INS21 INS16 INS42 INS16 INS42 INS16 INS5 INS4 INS40 INS42 INS42 INS42 INS7 INS7 INS27 INS42 MOV32 INS33 INS33 INS27 INS36 INS42 INS27 INS36 INS42 INS39 INS85 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS33 INS42 INS34 INS27 INS42 INS34 INS27 INS38 INS34 INS38 INS34 INS42 INS42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL66 DEL66 DEL66 DEL65 DEL29 DEL39 DEL42 DEL42 DEL42 DEL33 DEL9 DEL9 DEL9