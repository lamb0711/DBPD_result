HDFS-3890. filecontext mkdirs doesn't apply umask as expected (Tom Graves via daryn)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1381606 13f79535-47bb-0310-9956-ffa450edef68

-    checkOpen();
-    if(LOG.isDebugEnabled()) {
-      LOG.debug(src + ": masked=" + masked);
-    }
-    try {
-      return namenode.mkdirs(src, masked, createParent);
-    } catch(RemoteException re) {
-      throw re.unwrapRemoteException(AccessControlException.class,
-                                     InvalidPathException.class,
-                                     FileAlreadyExistsException.class,
-                                     FileNotFoundException.class,
-                                     ParentNotDirectoryException.class,
-                                     SafeModeException.class,
-                                     NSQuotaExceededException.class,
-                                     UnresolvedPathException.class);
-    }
+    return primitiveMkdir(src, masked, createParent);
-  
+
+    return primitiveMkdir(src, absPermission, true);
+  }
+
+  /**
+   * Same {{@link #mkdirs(String, FsPermission, boolean)} except
+   * that the permissions has already been masked against umask.
+   */
+  public boolean primitiveMkdir(String src, FsPermission absPermission, 
+    boolean createParent)
+    throws IOException {
-      return namenode.mkdirs(src, absPermission, true);
+      return namenode.mkdirs(src, absPermission, createParent);
+                                     InvalidPathException.class,
+                                     FileAlreadyExistsException.class,
+                                     FileNotFoundException.class,
+                                     ParentNotDirectoryException.class,
+                                     SafeModeException.class,
-
+  

INS31 INS8 INS29 INS83 INS39 INS42 INS44 INS44 INS43 INS8 INS44 MOV8 MOV25 MOV60 INS41 INS65 INS43 INS42 INS43 INS42 INS42 INS41 INS39 INS42 MOV25 INS32 INS66 INS65 INS66 INS66 INS42 INS42 INS32 MOV32 INS42 INS42 INS42 INS42 INS68 INS42 INS42 INS42 INS9 MOV42 INS42 INS69 INS69 INS69 INS43 INS43 INS39 MOV27 UPD42 INS42 INS42 MOV45 UPD42 MOV42 MOV57 DEL42 DEL42 DEL42 DEL42 DEL9 DEL32 DEL41 DEL8 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL43 DEL57 DEL42 DEL43 DEL57 DEL42 DEL43 DEL57 DEL32 DEL53 DEL8 DEL12 DEL54 DEL8