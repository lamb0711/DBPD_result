HADOOP-13189. FairCallQueue makes callQueue larger than the configured capacity. Contributed by Vinitha Gankidi.
-   * @param capacity the maximum size of each sub-queue
+   * @param capacity the total size of all sub-queues
-   * Notes: the FairCallQueue has no fixed capacity. Rather, it has a minimum
-   * capacity of `capacity` and a maximum capacity of `capacity * number_queues`
+   * Notes: Each sub-queue has a capacity of `capacity / numSubqueues`.
+   * The first or the highest priority sub-queue has an excess capacity
+   * of `capacity % numSubqueues`
-    LOG.info("FairCallQueue is in use with " + numQueues + " queues.");
+    LOG.info("FairCallQueue is in use with " + numQueues +
+        " queues with total capacity of " + capacity);
-
+    int queueCapacity = capacity / numQueues;
+    int capacityForFirstQueue = queueCapacity + (capacity % numQueues);
-      this.queues.add(new LinkedBlockingQueue<E>(capacity));
+      if (i == 0) {
+        this.queues.add(new LinkedBlockingQueue<E>(capacityForFirstQueue));
+      } else {
+        this.queues.add(new LinkedBlockingQueue<E>(queueCapacity));
+      }

INS60 INS60 UPD66 UPD66 INS66 UPD66 INS39 INS59 INS39 INS59 INS8 INS42 INS27 INS42 INS27 INS25 MOV21 UPD45 INS42 INS42 INS42 INS42 INS36 INS27 MOV8 INS8 INS27 INS42 INS34 INS21 INS42 INS42 INS32 INS22 INS42 INS14 UPD42 INS52 INS42 INS74 INS42 INS43 INS43 INS42 INS42