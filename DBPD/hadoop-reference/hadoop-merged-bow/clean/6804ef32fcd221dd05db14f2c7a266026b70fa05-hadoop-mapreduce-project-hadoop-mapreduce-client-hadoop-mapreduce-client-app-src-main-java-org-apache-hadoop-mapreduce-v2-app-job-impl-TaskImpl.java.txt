MAPREDUCE-4252. MR2 job never completes with 1 pending task (Tom White via bobby)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1359747 13f79535-47bb-0310-9956-ffa450edef68

-        EnumSet.of(TaskState.SCHEDULED, TaskState.FAILED),
+        EnumSet.of(TaskState.SCHEDULED, TaskState.SUCCEEDED, TaskState.FAILED),
-  private void internalError(TaskEventType type) {
+  protected void internalError(TaskEventType type) {
+      if (event instanceof TaskTAttemptEvent) {
+        TaskTAttemptEvent castEvent = (TaskTAttemptEvent) event;
+        if (task.getState() == TaskState.SUCCEEDED &&
+            !castEvent.getTaskAttemptID().equals(task.successfulAttempt)) {
+          // don't allow a different task attempt to override a previous
+          // succeeded state
+          return TaskState.SUCCEEDED;
+        }
+      }
+      

UPD83 INS25 INS62 INS8 INS42 INS43 INS60 INS25 INS42 INS43 INS59 INS27 INS8 INS42 INS42 INS11 INS27 INS38 INS41 INS43 INS42 INS32 INS40 INS32 INS40 INS40 INS42 INS42 INS42 INS32 INS42 INS40 INS42 INS42