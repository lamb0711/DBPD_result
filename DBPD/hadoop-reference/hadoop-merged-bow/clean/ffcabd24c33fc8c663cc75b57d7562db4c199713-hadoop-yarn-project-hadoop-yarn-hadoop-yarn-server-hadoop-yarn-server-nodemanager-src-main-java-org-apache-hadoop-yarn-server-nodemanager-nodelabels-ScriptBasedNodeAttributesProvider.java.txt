YARN-7856. Validate Node Attributes from NM. Contributed by Weiwei Yang.

+import org.apache.hadoop.yarn.nodelabels.NodeLabelUtil;
+          // Automatically setup prefix for collected attributes
-              .newInstance(attributeStrs[0],
+              .newInstance(NodeAttribute.PREFIX_DISTRIBUTED,
+                  attributeStrs[0],
-          attributeSet.add(na);
+
+          // Since a NodeAttribute is identical with another one as long as
+          // their prefix and name are same, to avoid attributes getting
+          // overwritten by ambiguous attribute, make sure it fails in such
+          // case.
+          if (!attributeSet.add(na)) {
+            throw new IOException("Ambiguous node attribute is found: "
+                + na.toString() + ", a same attribute already exists");
+          }
+
+      // Before updating the attributes to the provider,
+      // verify if they are valid
+      try {
+        NodeLabelUtil.validateNodeAttributes(attributeSet);
+      } catch (IOException e) {
+        throw new IOException("Node attributes collected by the script "
+            + "contains some invalidate entries. Detail message: "
+            + e.getMessage());
+      }

INS26 INS40 INS54 INS8 INS12 INS21 INS44 INS8 INS32 INS43 INS42 INS53 INS25 INS42 INS42 INS42 INS42 INS14 INS38 INS8 INS43 INS27 MOV32 INS53 INS42 INS45 INS45 INS32 INS40 INS14 INS42 INS42 INS43 INS27 INS42 INS45 INS32 INS45 INS42 INS42 DEL21