HDFS-2693. Fix synchronization issues around state transition. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1221582 13f79535-47bb-0310-9956-ffa450edef68

-    exitState(context);
-    context.setState(s);
-    s.enterState(context);
+    context.writeLock();
+    try {
+      exitState(context);
+      context.setState(s);
+      s.enterState(context);
+    } finally {
+      context.writeUnlock();
+    }
-}
+}

INS8 INS21 INS54 INS32 MOV8 INS8 INS42 INS42 INS21 INS32 INS42 INS42