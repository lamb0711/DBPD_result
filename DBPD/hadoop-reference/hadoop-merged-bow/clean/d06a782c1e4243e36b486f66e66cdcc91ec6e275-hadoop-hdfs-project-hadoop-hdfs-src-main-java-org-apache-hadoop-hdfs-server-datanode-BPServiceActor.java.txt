HDFS-5501. Fix pendingReceivedRequests tracking in BPServiceActor.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1541371 13f79535-47bb-0310-9956-ffa450edef68

-        ReceivedDeletedBlockInfo[] receivedAndDeletedBlockArray = null;
-          receivedAndDeletedBlockArray = perStorageMap.dequeueBlockInfos();
-          pendingReceivedRequests -= receivedAndDeletedBlockArray.length;
-          blockArrays.put(storageUuid, receivedAndDeletedBlockArray);
+          ReceivedDeletedBlockInfo[] rdbi = perStorageMap.dequeueBlockInfos();
+          pendingReceivedRequests =
+              (pendingReceivedRequests > rdbi.length ?
+                  (pendingReceivedRequests - rdbi.length) : 0);
+          blockArrays.put(storageUuid, rdbi);
-            perStorageMap.putMissingBlockInfos(rdbi);
-            pendingReceivedRequests += perStorageMap.getBlockInfoCount();
+            pendingReceivedRequests += perStorageMap.putMissingBlockInfos(rdbi);
+     * @return the number of missing blocks that we added.
-    void putMissingBlockInfos(ReceivedDeletedBlockInfo[] blockArray) {
+    int putMissingBlockInfos(ReceivedDeletedBlockInfo[] blockArray) {
+      int blocksPut = 0;
+          ++blocksPut;
+      return blocksPut;

UPD39 INS65 INS60 INS41 INS66 INS39 INS59 INS42 INS42 INS34 INS21 MOV60 INS38 INS42 INS42 MOV32 UPD42 INS36 UPD42 INS16 INS7 INS27 INS36 INS34 INS42 MOV32 INS42 INS40 INS27 INS42 INS40 DEL42 DEL33 DEL42 DEL40 DEL7 DEL21 DEL42 DEL42 DEL42 DEL32 DEL7 DEL21