HDFS-7165. Separate block metrics for files with replication count 1. (Zhe Zhang via wang)

+  /** The number of corrupt blocks with replication factor 1 */
+  private int corruptReplOneBlocks = 0;
+
+  /** Return the number of corrupt blocks with replication factor 1 */
+  synchronized int getCorruptReplOneBlockSize() {
+    return corruptReplOneBlocks;
+  }
+
+      if (priLevel == QUEUE_WITH_CORRUPT_BLOCKS &&
+          expectedReplicas == 1) {
+        corruptReplOneBlocks++;
+      }
-    return remove(block, priLevel);
+    boolean removedBlock = remove(block, priLevel);
+    if (priLevel == QUEUE_WITH_CORRUPT_BLOCKS &&
+        oldExpectedReplicas == 1 &&
+        removedBlock) {
+      corruptReplOneBlocks--;
+      assert corruptReplOneBlocks >= 0 :
+          "Number of corrupt blocks with replication factor 1 " +
+              "should be non-negative";
+    }
+    return removedBlock;
+    if (oldPri != curPri || expectedReplicasDelta != 0) {
+      // corruptReplOneBlocks could possibly change
+      if (curPri == QUEUE_WITH_CORRUPT_BLOCKS &&
+          curExpectedReplicas == 1) {
+        // add a new corrupt block with replication factor 1
+        corruptReplOneBlocks++;
+      } else if (oldPri == QUEUE_WITH_CORRUPT_BLOCKS &&
+          curExpectedReplicas - expectedReplicasDelta == 1) {
+        // remove an existing corrupt block with replication factor 1
+        corruptReplOneBlocks--;
+      }
+    }

INS23 INS31 INS29 INS83 INS39 INS59 INS29 INS83 INS39 INS42 INS8 INS65 INS42 INS34 INS65 INS41 INS60 INS25 INS25 INS66 INS66 INS42 INS39 INS59 INS27 INS8 INS42 INS27 INS8 INS25 INS42 MOV32 INS27 INS42 INS21 INS6 INS27 INS27 INS25 INS27 INS8 INS27 INS27 INS37 INS27 INS27 INS42 INS42 INS42 INS34 INS27 INS8 INS25 INS27 INS27 INS21 INS42 INS42 INS42 INS34 INS42 INS42 INS34 INS45 INS45 INS27 INS27 INS21 INS27 INS8 INS42 INS42 INS42 INS34 INS37 INS42 INS42 INS42 INS34 INS37 INS27 INS27 INS21 INS42 INS42 INS42 INS42 INS27 INS34 INS37 INS42 INS42 INS42