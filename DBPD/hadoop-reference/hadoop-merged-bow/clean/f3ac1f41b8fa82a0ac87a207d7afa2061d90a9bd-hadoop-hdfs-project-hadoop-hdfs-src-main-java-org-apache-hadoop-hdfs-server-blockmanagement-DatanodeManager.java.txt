HDFS-9500. Fix software version counts for DataNodes during rolling upgrade. Contributed by Erik Krogen.
+  /**
+   * Will return true for all Datanodes which have a non-null software
+   * version and are considered alive (by {@link DatanodeDescriptor#isAlive()}),
+   * indicating the node has not yet been removed. Use {@code isAlive}
+   * rather than {@link DatanodeManager#isDatanodeDead(DatanodeDescriptor)}
+   * to ensure that the version is decremented even if the datanode
+   * hasn't issued a heartbeat recently.
+   *
+   * @param node The datanode in question
+   * @return True iff its version count should be decremented
+   */
-    return node.getSoftwareVersion() != null && node.isAlive() &&
-      !isDatanodeDead(node);
+    return node.getSoftwareVersion() != null && node.isAlive();
-        // Check isAlive too because right after removeDatanode(),
-        // isDatanodeDead() is still true 

INS29 INS65 INS65 INS65 INS66 INS66 INS65 INS66 INS66 INS65 INS66 INS65 INS66 INS66 INS42 INS66 INS66 MOV27 INS68 INS66 INS68 INS42 INS42 INS42 INS42 INS69 INS43 INS42 DEL42 DEL42 DEL32 DEL38 DEL27