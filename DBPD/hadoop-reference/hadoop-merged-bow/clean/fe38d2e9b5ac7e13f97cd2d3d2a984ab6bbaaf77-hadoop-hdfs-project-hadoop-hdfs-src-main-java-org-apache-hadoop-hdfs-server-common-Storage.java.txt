HDFS-6727. Refresh data volumes on DataNode based on configuration changes (Lei Xu via Colin Patrick McCabe)

+      boolean hadMkdirs = false;
-          if (startOpt != StartupOption.FORMAT) {
+          if (startOpt != StartupOption.FORMAT &&
+              startOpt != StartupOption.HOTSWAP) {
+          hadMkdirs = true;
-      if (startOpt == HdfsServerConstants.StartupOption.FORMAT)
+      // If startOpt is HOTSWAP, it returns NOT_FORMATTED for empty directory,
+      // while it also checks the layout version.
+      if (startOpt == HdfsServerConstants.StartupOption.FORMAT ||
+          (startOpt == StartupOption.HOTSWAP && hadMkdirs))

INS60 INS39 INS59 INS27 INS42 INS9 MOV27 INS36 INS27 INS21 INS27 INS42 INS27 INS7 INS42 INS40 MOV27 INS27 INS42 INS9 INS42 INS40