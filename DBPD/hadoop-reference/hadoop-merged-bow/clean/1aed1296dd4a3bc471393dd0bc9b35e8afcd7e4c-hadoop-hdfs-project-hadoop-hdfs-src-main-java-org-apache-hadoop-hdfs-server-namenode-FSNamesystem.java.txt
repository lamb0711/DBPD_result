HDFS-2812. When becoming active, the NN should treat all leases as freshly renewed. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1233612 13f79535-47bb-0310-9956-ffa450edef68

+  private boolean haEnabled;
+
+      if (haEnabled) {
+        // Renew all of the leases before becoming active.
+        // This is because, while we were in standby mode,
+        // the leases weren't getting renewed on this NN.
+        // Give them all a fresh start here.
+        leaseManager.renewAllLeases();
+      }
-    this.persistBlocks |= HAUtil.isHAEnabled(conf, nameserviceId) &&
-        HAUtil.usesSharedEditsDir(conf);
+    this.haEnabled = HAUtil.isHAEnabled(conf, nameserviceId);  
+    this.persistBlocks |= haEnabled && HAUtil.usesSharedEditsDir(conf);

INS23 INS83 INS39 INS59 INS42 INS21 INS7 INS25 INS22 MOV32 INS42 INS8 INS52 INS42 INS42 INS21 INS32 INS42 INS42