HDFS-4675. Fix rename across snapshottable directories.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1467540 13f79535-47bb-0310-9956-ffa450edef68

+  public static final int INVALID_ID = -1;
+  
-          final Snapshot s = ((INodeDirectoryWithSnapshot)dir).getDiffs()
-              .getPrior(anchor);
-          if (latest == null
-              || (s != null && ID_COMPARATOR.compare(latest, s) < 0)) {
-            latest = s;
-          }
+          latest = ((INodeDirectoryWithSnapshot) dir).getDiffs().updatePrior(
+              anchor, latest);

INS23 INS83 INS83 INS83 INS39 INS59 INS42 INS38 INS34 MOV25 MOV62 MOV32 UPD42 INS42 DEL42 DEL33 DEL27 DEL42 DEL33 DEL27 DEL42 DEL42 DEL42 DEL42 DEL32 DEL34 DEL27 DEL27 DEL36 DEL27 DEL42 DEL83 DEL42 DEL43 DEL42 DEL59 DEL60 DEL8 DEL25