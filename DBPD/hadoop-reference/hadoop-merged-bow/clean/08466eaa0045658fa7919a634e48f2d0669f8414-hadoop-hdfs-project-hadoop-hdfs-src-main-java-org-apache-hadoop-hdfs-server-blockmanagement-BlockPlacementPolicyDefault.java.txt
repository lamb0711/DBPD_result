HDFS-6700. BlockPlacementPolicy shoud choose storage but not datanode for deletion.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1611731 13f79535-47bb-0310-9956-ffa450edef68

-  public DatanodeDescriptor chooseReplicaToDelete(BlockCollection bc,
+  public DatanodeStorageInfo chooseReplicaToDelete(BlockCollection bc,
-      Collection<DatanodeDescriptor> first,
-      Collection<DatanodeDescriptor> second) {
+      Collection<DatanodeStorageInfo> first,
+      Collection<DatanodeStorageInfo> second) {
-    DatanodeDescriptor oldestHeartbeatNode = null;
+    DatanodeStorageInfo oldestHeartbeatStorage = null;
-    DatanodeDescriptor minSpaceNode = null;
+    DatanodeStorageInfo minSpaceStorage = null;
-    for(DatanodeDescriptor node : pickupReplicaSet(first, second)) {
+    for(DatanodeStorageInfo storage : pickupReplicaSet(first, second)) {
+      final DatanodeDescriptor node = storage.getDatanodeDescriptor();
-        oldestHeartbeatNode = node;
+        oldestHeartbeatStorage = storage;
-        minSpaceNode = node;
+        minSpaceStorage = storage;
-    return oldestHeartbeatNode != null ? oldestHeartbeatNode : minSpaceNode;
+
+    return oldestHeartbeatStorage != null? oldestHeartbeatStorage
+        : minSpaceStorage;
-  protected Collection<DatanodeDescriptor> pickupReplicaSet(
-      Collection<DatanodeDescriptor> first,
-      Collection<DatanodeDescriptor> second) {
+  protected Collection<DatanodeStorageInfo> pickupReplicaSet(
+      Collection<DatanodeStorageInfo> first,
+      Collection<DatanodeStorageInfo> second) {

MOV44 UPD43 UPD74 MOV74 UPD42 UPD74 UPD74 UPD43 UPD74 UPD42 UPD74 MOV74 UPD42 UPD43 INS43 UPD43 UPD43 UPD42 UPD43 UPD43 UPD42 INS42 UPD42 UPD42 UPD42 UPD42 UPD43 UPD42 INS60 UPD42 UPD42 UPD42 UPD42 UPD42 INS83 MOV43 INS59 UPD42 INS42 INS32 INS42 INS42 UPD42 UPD42 UPD42 UPD42