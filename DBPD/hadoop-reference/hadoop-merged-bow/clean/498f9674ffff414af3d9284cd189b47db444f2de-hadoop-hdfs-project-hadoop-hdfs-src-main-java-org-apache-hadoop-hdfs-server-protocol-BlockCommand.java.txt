Merge r1550130 through r1555020 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1555021 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.blockmanagement.DatanodeStorageInfo;
-  String poolId;
-  Block blocks[];
-  DatanodeInfo targets[][];
+  final String poolId;
+  final Block[] blocks;
+  final DatanodeInfo[][] targets;
+  final String[][] targetStorageIDs;
+    targetStorageIDs = new String[blocks.length][];
+
-      targets[i] = p.targets;
+      targets[i] = DatanodeStorageInfo.toDatanodeInfos(p.targets);
+      targetStorageIDs[i] = DatanodeStorageInfo.toStorageIDs(p.targets);
-  private static final DatanodeInfo[][] EMPTY_TARGET = {};
+  private static final DatanodeInfo[][] EMPTY_TARGET_DATANODES = {};
+  private static final String[][] EMPTY_TARGET_STORAGEIDS = {};
-    this(action, poolId, blocks, EMPTY_TARGET);
+    this(action, poolId, blocks, EMPTY_TARGET_DATANODES,
+        EMPTY_TARGET_STORAGEIDS);
-      DatanodeInfo[][] targets) {
+      DatanodeInfo[][] targets, String[][] targetStorageIDs) {
+    this.targetStorageIDs = targetStorageIDs;
+
+  public String[][] getTargetStorageIDs() {
+    return targetStorageIDs;
+  }

INS26 INS40 INS23 INS23 INS23 INS31 INS83 INS83 INS5 INS83 INS5 INS59 INS83 INS5 INS59 INS83 INS83 INS83 INS5 INS59 INS44 INS83 INS5 INS42 INS8 MOV43 INS85 INS43 INS85 INS85 MOV42 INS43 INS85 INS85 INS42 INS21 UPD42 INS43 INS85 INS85 INS42 INS4 INS5 INS42 INS21 INS43 INS85 INS85 INS41 MOV42 INS42 INS7 INS42 UPD42 INS42 INS43 INS85 INS85 INS7 INS42 INS42 INS42 INS3 INS21 INS42 INS22 INS42 INS5 INS40 INS7 INS52 INS42 INS43 INS85 INS85 INS32 INS2 INS32 INS42 INS42 INS42 INS40 INS42 INS42 INS42 INS42 INS40 DEL85 DEL43 DEL85 DEL85 DEL59 DEL23 DEL40