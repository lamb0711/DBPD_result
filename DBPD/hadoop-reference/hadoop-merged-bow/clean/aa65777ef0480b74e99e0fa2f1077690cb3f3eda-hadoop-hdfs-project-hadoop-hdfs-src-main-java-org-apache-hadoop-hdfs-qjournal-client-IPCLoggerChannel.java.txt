HDFS-3898. QJM: enable TCP_NODELAY for IPC. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3077@1383033 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.fs.CommonConfigurationKeysPublic;
+    final Configuration confCopy = new Configuration(conf);
+    
+    // Need to set NODELAY or else batches larger than MTU can trigger 
+    // 40ms nagling delays.
+    confCopy.setBoolean(
+        CommonConfigurationKeysPublic.IPC_CLIENT_TCPNODELAY_KEY,
+        true);
+    
+    RPC.setProtocolEngine(confCopy,
+        QJournalProtocolPB.class, ProtobufRpcEngine.class);
-            RPC.setProtocolEngine(conf,
+            RPC.setProtocolEngine(confCopy,
-                addr, conf);
+                addr, confCopy);

INS26 INS40 INS60 INS21 MOV21 INS83 INS43 INS59 INS32 INS42 INS42 INS14 INS42 INS42 INS40 INS9 UPD42 INS43 INS42 INS42 INS21 INS32 INS42 INS42 INS42 INS57 INS57 INS43 INS43 UPD42 INS42 INS42