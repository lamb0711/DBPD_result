Merge trunk into HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1202013 13f79535-47bb-0310-9956-ffa450edef68

-    String lastBlock = null;
+    int cookie = 0;
+    final String cookiePrefix = "Cookie:";
-      if (lastBlock != null) {
-        url.append("&startblockafter=").append(lastBlock);
+      if (cookie > 0) {
+        url.append("&startblockafter=").append(String.valueOf(cookie));
-          if ((line.endsWith(noCorruptLine)) || 
+          if (line.startsWith(cookiePrefix)){
+            try{
+              cookie = Integer.parseInt(line.split("\t")[1]);
+            } catch (Exception e){
+              allDone = true;
+              break;
+            }
+            continue;
+          }
+          if ((line.endsWith(noCorruptLine)) ||
-              || (line.startsWith("FSCK started by")) 
+              || (line.startsWith("FSCK started by"))
-            out.println("The list of corrupt files under path '" 
+            out.println("The list of corrupt files under path '"
-          try {
-            // Get the block # that we need to send in next call
-            lastBlock = line.split("\t")[0];
-          } catch (Exception e) {
-            allDone = true;
-            break;
-          }

INS60 INS39 INS83 MOV43 INS59 UPD42 INS34 INS42 INS45 UPD27 UPD42 INS34 INS32 INS25 UPD42 MOV42 INS42 INS42 INS32 INS8 INS42 INS42 INS42 MOV54 INS18 UPD42 INS32 INS42 INS42 MOV2 UPD34 DEL33 DEL33