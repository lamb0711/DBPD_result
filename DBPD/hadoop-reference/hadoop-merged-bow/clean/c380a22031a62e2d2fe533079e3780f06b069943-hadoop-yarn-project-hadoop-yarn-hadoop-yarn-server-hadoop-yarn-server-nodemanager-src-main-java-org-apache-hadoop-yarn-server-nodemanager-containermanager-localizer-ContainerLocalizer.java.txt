YARN-857. Localization failures should be available in container diagnostics. Contributed by  Vinod Kumar Vavilapalli.

+import org.apache.hadoop.classification.InterfaceAudience.Private;
+import com.google.common.annotations.VisibleForTesting;
-  LocalizationProtocol getProxy(final InetSocketAddress nmAddr) {
+  @Private
+  @VisibleForTesting
+  public LocalizationProtocol getProxy(final InetSocketAddress nmAddr) {
-  public int runLocalization(final InetSocketAddress nmAddr)
+  public void runLocalization(final InetSocketAddress nmAddr)
-      return 0;
+      return;
-      // Print traces to stdout so that they can be logged by the NM address
-      // space.
-      e.printStackTrace(System.out);
-      return -1;
+      throw new IOException(e);
-      throws IOException {
+      throws IOException, YarnException {
-          // ignore response
+          // ignore response while dying.
-          } catch (YarnException e) { }
+          } catch (YarnException e) {
+            // Cannot do anything about this during death stage, let's just log
+            // it.
+            e.printStackTrace(System.out);
+            LOG.error("Heartbeat failed while dying: ", e);
+          }
-        return;
+        throw e;
-      int nRet = localizer.runLocalization(nmAddr);
-      if (LOG.isDebugEnabled()) {
-        LOG.debug(String.format("nRet: %d", nRet));
-      }
-      System.exit(nRet);
+      localizer.runLocalization(nmAddr);
+      return;
-      // Print error to stdout so that LCE can use it.
+      // Print traces to stdout so that they can be logged by the NM address
+      // space in both DefaultCE and LCE cases
-      throw e;
+      System.exit(-1);

INS26 INS26 INS40 INS40 INS78 INS78 INS83 UPD39 INS43 INS42 INS42 INS42 INS8 MOV21 INS41 INS53 MOV32 INS21 INS14 INS32 INS43 INS42 MOV53 INS42 INS42 MOV38 INS42 MOV8 INS21 INS32 INS42 INS42 INS45 INS42 DEL34 DEL41 DEL8 DEL41 DEL42 DEL42 DEL42 DEL42 DEL45 DEL42 DEL32 DEL32 DEL39 DEL42 DEL59 DEL60 DEL42 DEL42 DEL32 DEL8 DEL25 DEL42 DEL42 DEL42 DEL32 DEL21