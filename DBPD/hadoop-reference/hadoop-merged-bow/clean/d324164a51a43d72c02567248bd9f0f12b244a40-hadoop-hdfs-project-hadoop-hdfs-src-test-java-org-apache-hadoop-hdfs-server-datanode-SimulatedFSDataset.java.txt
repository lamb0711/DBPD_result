HDFS-7435. PB encoding of block reports is very inefficient. Contributed by Daryn Sharp.

-import org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsVolumeImpl;
-      return null;
+      return finalized ? ReplicaState.FINALIZED : ReplicaState.RBW;
-      Iterable<Block> injectBlocks) throws IOException {
+      Iterable<? extends Block> injectBlocks) throws IOException {
-    final List<Replica> blocks = new ArrayList<Replica>();
+    BlockListAsLongs.Builder report = BlockListAsLongs.builder();
-          blocks.add(b);
+          report.add(b);
-    return new BlockListAsLongs(blocks, null);
+    return report.build();

UPD74 INS76 INS43 INS32 INS16 MOV43 INS40 UPD42 INS32 INS42 INS42 INS42 INS40 INS40 INS42 INS42 UPD42 DEL40 DEL26 DEL33 DEL83 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL43 DEL42 DEL43 DEL74 DEL14 DEL42 DEL43 DEL42 DEL33 DEL14