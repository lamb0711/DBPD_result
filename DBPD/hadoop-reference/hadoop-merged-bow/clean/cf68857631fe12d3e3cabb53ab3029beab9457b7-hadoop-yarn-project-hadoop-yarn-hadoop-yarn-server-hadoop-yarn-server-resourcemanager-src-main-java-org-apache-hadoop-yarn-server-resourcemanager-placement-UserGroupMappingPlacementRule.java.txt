YARN-9938. Validate Parent Queue for QueueMapping contains dynamic group as parent queue. Contributed by Manikandan R

+import org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.ParentQueue;
-            return getPlacementContext(
+            QueueMapping queueMapping =
-                    CURRENT_USER_MAPPING, groups.getGroups(user).get(0)),
-                user);
+                    user, groups.getGroups(user).get(0));
+            validateQueueMapping(queueMapping);
+            return getPlacementContext(queueMapping, user);
-              return getPlacementContext(new QueueMapping(mapping.getType(),
-                  mapping.getSource(), CURRENT_USER_MAPPING, secondaryGroup),
-                  user);
+              QueueMapping queueMapping = new QueueMapping(mapping.getType(),
+                  mapping.getSource(), user, secondaryGroup);
+              validateQueueMapping(queueMapping);
+              return getPlacementContext(queueMapping, user);
+  private void validateQueueMapping(QueueMapping queueMapping)
+      throws IOException {
+    String parentQueueName = queueMapping.getParentQueue();
+    String leafQueueName = queueMapping.getQueue();
+    CSQueue parentQueue = queueManager.getQueue(parentQueueName);
+    CSQueue leafQueue = queueManager.getQueue(leafQueueName);
+
+    if (leafQueue == null || (!(leafQueue instanceof LeafQueue))) {
+      throw new IOException("mapping contains invalid or non-leaf queue : "
+          + leafQueueName);
+    } else if (parentQueue == null || (!(parentQueue instanceof ParentQueue))) {
+      throw new IOException(
+          "mapping contains invalid parent queue [" + parentQueueName + "]");
+    } else if (!parentQueue.getQueueName()
+        .equals(leafQueue.getParent().getQueueName())) {
+      throw new IOException("mapping contains invalid parent queue "
+          + "which does not match existing leaf queue's parent : ["
+          + parentQueue.getQueueName() + "] does not match [ "
+          + leafQueue.getParent().getQueueName() + "]");
+    }
+  }
+

INS26 INS40 INS31 INS83 INS39 INS42 INS44 INS43 INS8 INS43 INS42 INS42 INS60 INS60 INS60 INS60 INS25 INS42 INS43 INS59 INS43 INS59 INS43 INS59 INS43 INS59 INS27 INS8 INS25 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS27 INS36 INS53 INS27 INS8 INS25 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS33 INS38 INS14 INS27 INS36 INS53 INS38 INS8 INS36 INS43 INS27 INS42 INS33 INS38 INS14 INS32 INS53 INS62 INS42 INS45 INS42 INS36 INS43 INS27 INS32 INS42 INS32 INS14 INS42 INS43 INS62 INS42 INS45 INS42 INS45 INS42 INS42 INS32 INS42 INS43 INS27 INS42 INS42 INS43 INS42 INS42 INS42 INS27 INS32 INS45 INS32 INS45 INS60 INS21 INS42 INS45 INS45 INS42 INS42 INS32 INS42 INS43 INS59 INS32 INS42 INS42 INS42 INS42 MOV14 INS42 INS42 INS42 UPD42 INS60 INS21 MOV43 INS59 INS32 INS42 MOV14 INS42 INS42 INS42 INS43 INS42 INS42 DEL42