HADOOP-7378. Add -d option to ls to not expand directories. Contributed by Daryn Sharp.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1151594 13f79535-47bb-0310-9956-ffa450edef68

-  public static final String USAGE = "[-R] [-h] [<path> ...]";
+  public static final String USAGE = "[-d] [-h] [-R] [<path> ...]";
-    "  -R  Recursively list the contents of directories.\n" +
+    "  -d  Directories are listed as plain files.\n" +
-    "      rather than of bytes.\n\n";
+    "      rather than a number of bytes.\n" +
+    "  -R  Recursively list the contents of directories.";
+  protected boolean dirRecurse;
-    CommandFormat cf = new CommandFormat(0, Integer.MAX_VALUE, "R", "h");
+    CommandFormat cf = new CommandFormat(0, Integer.MAX_VALUE, "d", "h", "R");
-    setRecursive(cf.getOpt("R"));
+    dirRecurse = !cf.getOpt("d");
+    setRecursive(cf.getOpt("R") && dirRecurse);
+  protected void processPathArgument(PathData item) throws IOException {
+    // implicitly recurse once for cmdline directories
+    if (dirRecurse && item.stat.isDirectory()) {
+      recursePath(item);
+    } else {
+      super.processPathArgument(item);
+    }
+  }
+
+  @Override
-    // implicitly recurse once for cmdline directories
-    if (parent == null && items[0].stat.isDirectory()) {
-      recursePath(items[0]);
-      return;
-    }
-

INS23 INS31 INS83 INS39 INS59 INS78 INS83 INS39 INS42 INS44 INS43 INS8 UPD45 INS42 INS21 INS42 INS43 INS42 INS42 INS25 UPD45 UPD45 INS45 MOV43 INS7 INS42 INS27 INS8 INS8 INS42 INS38 INS27 INS42 INS32 INS21 INS21 MOV43 UPD45 INS45 INS32 MOV32 INS42 INS40 INS42 INS32 INS48 INS42 INS42 INS45 INS42 INS42 INS42 INS42 DEL42 DEL33 DEL27 DEL42 DEL34 DEL2 DEL42 DEL22 DEL42 DEL32 DEL27 DEL42 DEL42 DEL34 DEL2 DEL32 DEL21 DEL41 DEL8 DEL25