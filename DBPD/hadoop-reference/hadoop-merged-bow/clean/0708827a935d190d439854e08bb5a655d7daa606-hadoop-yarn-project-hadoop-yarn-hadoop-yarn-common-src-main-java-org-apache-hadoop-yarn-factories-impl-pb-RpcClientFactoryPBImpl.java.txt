YARN-2613. Support retry in NMClient for rolling-upgrades. (Contributed by Jian He)

+import java.io.Closeable;
+import java.lang.reflect.InvocationHandler;
-import java.lang.reflect.Method;
+import java.lang.reflect.Proxy;
+import org.apache.hadoop.HadoopIllegalArgumentException;
-      Method closeMethod = proxy.getClass().getMethod("close");
-      closeMethod.invoke(proxy);
-    } catch (InvocationTargetException e) {
-      throw new YarnRuntimeException(e);
+      if (proxy instanceof Closeable) {
+        ((Closeable) proxy).close();
+        return;
+      } else {
+        InvocationHandler handler = Proxy.getInvocationHandler(proxy);
+        if (handler instanceof Closeable) {
+          ((Closeable) handler).close();
+          return;
+        }
+      }
-      LOG.error("Cannot call close method due to Exception. "
-          + "Ignoring.", e);
+      LOG.error("Cannot call close method due to Exception. " + "Ignoring.", e);
+    throw new HadoopIllegalArgumentException(
+      "Cannot close proxy - is not Closeable or "
+          + "does not provide closeable invocation handler " + proxy.getClass());

INS26 INS26 INS26 INS40 INS40 UPD40 INS40 INS54 MOV53 INS8 MOV12 INS25 UPD43 INS27 INS62 INS8 INS8 UPD42 INS45 INS45 MOV32 INS42 INS43 INS21 INS41 MOV60 INS25 INS42 INS32 UPD43 INS62 INS8 INS36 INS42 UPD42 UPD42 INS42 INS43 MOV21 INS41 INS11 INS42 UPD42 INS42 INS42 INS43 INS42 INS36 UPD42 INS42 INS11 INS43 INS42 INS42 DEL45 DEL42 DEL42 DEL42 DEL8 DEL42 DEL43 DEL42 DEL44 DEL8 DEL12 DEL54