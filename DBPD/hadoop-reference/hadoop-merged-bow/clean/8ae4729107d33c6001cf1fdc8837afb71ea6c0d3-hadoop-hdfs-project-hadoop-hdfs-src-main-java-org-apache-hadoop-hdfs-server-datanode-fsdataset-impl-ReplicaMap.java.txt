HDFS-10828. Fix usage of FsDatasetImpl object lock in ReplicaMap. (Arpit Agarwal)

+import org.apache.hadoop.util.AutoCloseableLock;
-  // Object using which this class is synchronized
-  private final Object mutex;
+  // Lock object to synchronize this instance.
+  private final AutoCloseableLock lock;
-  ReplicaMap(Object mutex) {
-    if (mutex == null) {
+  ReplicaMap(AutoCloseableLock lock) {
+    if (lock == null) {
-          "Object to synchronize on cannot be null");
+          "Lock to synchronize on cannot be null");
-    this.mutex = mutex;
+    this.lock = lock;
-    synchronized(mutex) {
+    try (AutoCloseableLock l = lock.acquire()) {
-    synchronized(mutex) {
+    try (AutoCloseableLock l = lock.acquire()) {
-    synchronized(mutex) {
+    try (AutoCloseableLock l = lock.acquire()) {
-    synchronized(mutex) {
+    try (AutoCloseableLock l = lock.acquire()) {
-    synchronized(mutex) {
+    try (AutoCloseableLock l = lock.acquire()) {
-    synchronized(mutex) {
+    try (AutoCloseableLock l = lock.acquire()) {
-   * externally using the mutex, both for getting the replicas
+   * externally using the lock, both for getting the replicas
-   * {@link #getMutext()} method.
+   * {@link #getLock()} method.
-    synchronized(mutex) {
+    try (AutoCloseableLock l = lock.acquire()) {
-    synchronized(mutex) {
+    try (AutoCloseableLock l = lock.acquire()) {
-   * Give access to mutex used for synchronizing ReplicasMap
-   * @return object used as lock
+   * Get the lock object used for synchronizing ReplicasMap
+   * @return lock object
-  Object getMutex() {
-    return mutex;
+  AutoCloseableLock getLock() {
+    return lock;

INS26 INS40 UPD43 UPD43 UPD42 UPD42 UPD42 UPD43 UPD42 INS54 INS54 INS54 INS54 INS54 INS54 INS54 INS54 UPD42 UPD42 INS58 MOV8 INS58 MOV8 INS58 MOV8 INS58 MOV8 INS58 MOV8 INS58 MOV8 UPD66 INS58 MOV8 INS58 MOV8 UPD66 UPD66 UPD42 UPD42 UPD42 INS43 INS59 INS43 INS59 INS43 INS59 INS43 INS59 INS43 INS59 INS43 INS59 INS43 INS59 INS43 INS59 UPD42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 UPD42 INS42 INS42 INS32 INS42 INS42 INS32 UPD45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL42 DEL51 DEL42 DEL51 DEL42 DEL51 DEL42 DEL51 DEL42 DEL51 DEL42 DEL51 DEL42 DEL51 DEL42 DEL51