	HDFS-2181 Separate HDFS Client wire protocol data types (sanjay)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1179877 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.Closeable;
-      this.namenode = DFSUtil.createNamenode(nameNodeAddr, conf);
+      this.namenode = DFSUtil.createNamenode(nameNodeAddr, conf, ugi);
-
+  
+  /**
+   * Close connections the Namenode.
+   * The namenode variable is either a rpcProxy passed by a test or 
+   * created using the protocolTranslator which is closeable.
+   * If closeable then call close, else close using RPC.stopProxy().
+   */
+  void closeConnectionToNamenode() {
+    if (namenode instanceof Closeable) {
+      try {
+        ((Closeable) namenode).close();
+        return;
+      } catch (IOException e) {
+        // fall through - lets try the stopProxy
+        LOG.warn("Exception closing namenode, stopping the proxy");
+      }     
+    }
+    RPC.stopProxy(namenode);
+  }
+  
-    RPC.stopProxy(namenode); // close connections to the namenode
+    closeConnectionToNamenode();
-      RPC.stopProxy(namenode);
+      closeConnectionToNamenode();

INS26 INS40 INS31 INS29 INS39 INS42 INS8 INS65 INS25 MOV21 INS21 INS66 INS66 INS66 INS66 INS62 INS8 INS32 INS42 INS43 INS54 INS42 INS42 INS8 INS12 INS21 INS41 INS44 INS8 UPD42 INS42 INS32 INS43 INS42 INS21 INS36 INS42 INS42 INS32 INS11 INS42 INS42 INS45 INS43 INS42 INS42 DEL42 DEL42