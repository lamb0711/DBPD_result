HDFS-3150. Add option for clients to contact DNs via hostname. Contributed by Eli Collins


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1373094 13f79535-47bb-0310-9956-ffa450edef68

-                + nodes[0].getXferAddr() + " : " + ie);
+                + nodes[0] + " : " + ie);
-              if (nodes[i].getXferAddr().equals(firstBadLink)) {
+              // NB: Unconditionally using the xfer addr w/o hostname
+              if (firstBadLink.equals(nodes[i].getXferAddr())) {
-    if(DFSClient.LOG.isDebugEnabled()) {
-      DFSClient.LOG.debug("Connecting to datanode " + first);
+    final String dnAddr = first.getXferAddr(client.connectToDnViaHostname());
+    if (DFSClient.LOG.isDebugEnabled()) {
+      DFSClient.LOG.debug("Connecting to datanode " + dnAddr);
-    final InetSocketAddress isa =
-      NetUtils.createSocketAddr(first.getXferAddr());
+    final InetSocketAddress isa = NetUtils.createSocketAddr(dnAddr);

INS60 INS83 INS43 INS59 INS42 INS42 INS32 INS42 INS42 INS32 UPD42 MOV42 INS42 INS42 UPD42 MOV2 MOV32 INS42 DEL42 DEL32 DEL42 DEL42 DEL32