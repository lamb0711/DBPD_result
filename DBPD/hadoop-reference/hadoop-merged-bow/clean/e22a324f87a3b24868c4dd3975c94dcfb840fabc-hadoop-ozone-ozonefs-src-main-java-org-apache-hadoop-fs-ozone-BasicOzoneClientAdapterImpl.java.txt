HDDS-2007. Make ozone fs shell command work with OM HA service ids	 (#1360)


+import org.apache.hadoop.ozone.OmUtils;
+    if (omHost == null && OmUtils.isServiceIdsDefined(conf)) {
+      // When the host name or service id isn't given
+      // but ozone.om.service.ids is defined, declare failure.
+
+      // This is a safety precaution that prevents the client from
+      // accidentally failing over to an unintended OM.
+      throw new IllegalArgumentException("Service ID or host name must not"
+          + " be omitted when ozone.om.service.ids is defined.");
+    }
+
+    if (omPort != -1) {
+      // When the port number is specified, perform the following check
+      if (OmUtils.isOmHAServiceId(conf, omHost)) {
+        // If omHost is a service id, it shouldn't use a port
+        throw new IllegalArgumentException("Port " + omPort +
+            " specified in URI but host '" + omHost + "' is "
+            + "a logical (HA) OzoneManager and does not use port information.");
+      }
+    } else {
+      // When port number is not specified, read it from config
+      omPort = OmUtils.getOmRpcPort(conf);
+    }
+
-      if (StringUtils.isNotEmpty(omHost) && omPort != -1) {
+      if (OmUtils.isOmHAServiceId(conf, omHost)) {
+        // omHost is listed as one of the service ids in the config,
+        // thus we should treat omHost as omServiceId
+        this.ozoneClient =
+            OzoneClientFactory.getRpcClient(omHost, conf);
+      } else if (StringUtils.isNotEmpty(omHost) && omPort != -1) {

INS26 INS40 INS25 INS25 INS27 INS8 INS27 INS8 INS8 INS27 INS32 INS53 INS42 INS38 INS25 INS21 INS25 INS42 INS33 INS42 INS42 INS42 INS14 INS34 INS32 INS8 INS7 INS32 INS8 MOV25 INS43 INS27 INS42 INS42 INS42 INS42 INS53 INS42 INS32 INS42 INS42 INS42 INS42 INS21 INS42 INS45 INS45 INS14 INS42 INS42 INS42 INS7 INS43 INS27 INS22 INS32 INS42 INS45 INS42 INS45 INS42 INS45 INS45 INS52 INS42 INS42 INS42 INS42 INS42