YARN-7972. Support inter-app placement constraints for allocation tags by application ID. (Weiwei Yang via asuresh)

+import org.apache.hadoop.yarn.api.records.AllocationTagNamespace;
+import org.apache.hadoop.yarn.api.records.AllocationTagNamespaceType;
+import org.apache.hadoop.yarn.exceptions.InvalidAllocationTagException;
-import static org.apache.hadoop.yarn.api.resource.PlacementConstraints.APPLICATION_LABEL_INTRA_APPLICATION;
-  private void validateAndSetSchedulingRequest(SchedulingRequest newSchedulingRequest)
+  private void validateAndSetSchedulingRequest(SchedulingRequest
+      newSchedulingRequest)
-        if (targetExpression.getTargetKey() != null && !targetExpression
-            .getTargetKey().equals(APPLICATION_LABEL_INTRA_APPLICATION)) {
+        try {
+          AllocationTagNamespace tagNS =
+              AllocationTagNamespace.parse(targetExpression.getTargetKey());
+          if (!AllocationTagNamespaceType.SELF
+              .equals(tagNS.getNamespaceType())) {
+            throwExceptionWithMetaInfo(
+                "As of now, the only accepted target key for targetKey of "
+                    + "allocation_tag target expression is: ["
+                    + AllocationTagNamespaceType.SELF.toString()
+                    + "]. Please make changes to placement constraints "
+                    + "accordingly. If this is null, it will be set to "
+                    + AllocationTagNamespaceType.SELF.toString()
+                    + " by default.");
+          }
+        } catch (InvalidAllocationTagException e) {
-              "As of now, the only accepted target key for targetKey of "
-                  + "allocation_tag target expression is: ["
-                  + APPLICATION_LABEL_INTRA_APPLICATION
-                  + "]. Please make changes to placement constraints "
-                  + "accordingly. If this is null, it will be set to "
-                  + APPLICATION_LABEL_INTRA_APPLICATION + " by default.");
+              "Invalid allocation tag namespace, message: " + e.getMessage());

MOV26 INS26 INS26 UPD40 INS40 INS40 INS54 INS8 INS12 INS60 MOV25 INS44 INS8 INS43 INS59 INS38 INS43 INS42 INS21 INS42 INS42 MOV32 MOV32 INS32 INS42 INS32 UPD42 UPD42 INS40 INS42 INS32 INS42 INS27 UPD42 MOV42 UPD42 MOV42 INS45 INS32 INS32 INS32 INS42 INS42 INS40 INS42 INS40 INS42 DEL32 DEL33 DEL27 DEL38 DEL27 DEL42 DEL42