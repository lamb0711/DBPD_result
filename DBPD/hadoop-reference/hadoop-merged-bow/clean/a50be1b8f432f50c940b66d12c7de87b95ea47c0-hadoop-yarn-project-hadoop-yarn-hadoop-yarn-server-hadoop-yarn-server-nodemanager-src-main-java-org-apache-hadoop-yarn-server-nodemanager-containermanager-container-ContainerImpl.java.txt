YARN-7275. NM Statestore cleanup for Container updates. (Kartheek Muthyala via asuresh)

+    .addTransition(ContainerState.SCHEDULED, ContainerState.PAUSED,
+        ContainerEventType.RECOVER_PAUSED_CONTAINER,
+        new RecoveredContainerTransition())
+      } else if (recoveredStatus == RecoveredContainerStatus.PAUSED) {
+        launcherEvent = ContainersLauncherEventType.RECOVER_PAUSED_CONTAINER;
+
-      // Recovery is not supported for paused container so we raise the
-      // launch event which will proceed to kill the paused container instead
-      // of raising the schedule event.
-      if (updateEvent.isResourceChange()) {
-        try {
-          // Persist change in the state store.
-          container.context.getNMStateStore().storeContainerResourceChanged(
-              container.containerId,
-              container.getContainerTokenIdentifier().getVersion(),
-              container.getResource());
-        } catch (IOException e) {
-          LOG.warn("Could not store container [" + container.containerId
-              + "] resource change..", e);
-        }
+
+      try {
+        // Persist change in the state store.
+        container.context.getNMStateStore()
+            .storeContainerUpdateToken(container.containerId,
+                container.getContainerTokenIdentifier());
+      } catch (IOException e) {
+        LOG.warn("Could not store container [" + container.containerId
+            + "] update..", e);
+      } else if (container.recoveredStatus == RecoveredContainerStatus.QUEUED) {
+        return ContainerState.SCHEDULED;
+   * Transition from SCHEDULED state to PAUSED state on recovery
+   */
+  static class RecoveredContainerTransition extends ContainerTransition {
+    @SuppressWarnings("unchecked")
+    @Override
+    public void transition(ContainerImpl container, ContainerEvent event) {
+      container.sendContainerMonitorStartEvent();
+      container.wasLaunched = true;
+    }
+  }
+
+  /**

INS83 INS42 INS55 INS29 INS83 INS42 INS43 INS31 MOV8 INS65 INS42 INS79 INS78 INS83 INS39 INS42 INS44 INS44 INS8 MOV60 MOV21 INS66 INS42 INS45 INS42 INS43 INS42 INS43 INS42 INS21 INS21 INS25 INS42 INS42 INS32 INS7 INS25 INS27 INS8 MOV25 INS42 INS42 INS40 INS9 INS27 INS8 MOV32 MOV32 INS40 INS40 INS41 INS42 INS40 INS21 MOV32 UPD42 INS40 INS40 INS7 INS42 INS40 UPD45 INS32 INS42 INS40 MOV32 MOV42 MOV40 INS40 INS40 MOV14 UPD40 UPD40 UPD40 MOV14 UPD40 UPD40 MOV14 UPD40 UPD40 INS42 UPD40 UPD40 MOV14 UPD40 UPD40 INS14 INS43 INS42 DEL83 DEL42 DEL42 DEL42 DEL40 DEL42 DEL42 DEL32 DEL32 DEL42 DEL42 DEL32 DEL25 DEL8