HDDS-1250. In OM HA AllocateBlock call where connecting to SCM from OM should not happen on Ratis.

-import org.apache.hadoop.ozone.om.protocol.OzoneManagerProtocol;
+import org.apache.hadoop.ozone.om.protocol.OzoneManagerServerProtocol;
-public class OzoneManagerRequestHandler {
+public class OzoneManagerRequestHandler implements RequestHandler {
-  private final OzoneManagerProtocol impl;
+  private final OzoneManagerServerProtocol impl;
-  public OzoneManagerRequestHandler(OzoneManagerProtocol om) {
+  public OzoneManagerRequestHandler(OzoneManagerServerProtocol om) {
+  @Override
+  @Override
-    OmKeyLocationInfo newLocation =
-        impl.allocateBlock(omKeyArgs, request.getClientID(),
-            ExcludeList.getFromProtoBuf(request.getExcludeList()));
+
+    OmKeyLocationInfo newLocation;
+    if (request.hasKeyLocation()) {
+      newLocation =
+          impl.addAllocatedBlock(omKeyArgs, request.getClientID(),
+              request.getKeyLocation());
+    } else {
+      newLocation =
+          impl.allocateBlock(omKeyArgs, request.getClientID(),
+              ExcludeList.getFromProtoBuf(request.getExcludeList()));
+    }
+

UPD40 INS43 INS42 UPD43 INS78 INS78 UPD42 UPD43 INS42 INS42 INS25 UPD42 INS32 INS8 INS8 INS42 INS42 INS21 INS21 INS7 INS7 INS42 INS32 INS42 MOV32 INS42 INS42 INS42 INS32 INS32 INS42 INS42 INS42 INS42