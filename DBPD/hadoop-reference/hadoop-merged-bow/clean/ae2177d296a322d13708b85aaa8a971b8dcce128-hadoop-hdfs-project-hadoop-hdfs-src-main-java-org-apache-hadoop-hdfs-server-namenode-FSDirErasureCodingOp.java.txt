HDFS-12897. getErasureCodingPolicy should handle .snapshot dir better. Contributed by LiXin Ge.

-   * @return {@link ErasureCodingPolicy}
+   * @return {@link ErasureCodingPolicy}, or null if no policy has
+   * been set or the policy is REPLICATION
+    if (FSDirectory.isExactReservedName(src)) {
+      return null;
+    }
+
-    if (iip.getLastINode() == null) {
-      throw new FileNotFoundException("Path not found: " + iip.getPath());
+    ErasureCodingPolicy ecPolicy;
+    if (iip.isDotSnapshotDir()) {
+      ecPolicy = null;
+    } else if (iip.getLastINode() == null) {
+      throw new FileNotFoundException("Path not found: " + src);
+    } else {
+      ecPolicy = getErasureCodingPolicyForPath(fsd, iip);
-    ErasureCodingPolicy ecPolicy = getErasureCodingPolicyForPath(fsd, iip);
-        final XAttrFeature xaf = inode.getXAttrFeature();
+        final XAttrFeature xaf = inode.getXAttrFeature(iip.getPathSnapshotId());

INS25 INS60 INS25 INS66 INS66 INS32 INS8 MOV43 INS59 INS32 INS8 INS25 INS42 INS42 INS42 INS41 INS42 INS42 INS42 INS21 MOV27 MOV8 INS8 INS33 INS7 INS21 INS42 INS33 INS7 INS42 MOV32 INS42 INS32 INS42 INS42 DEL42 DEL42 DEL32 DEL25 DEL42 DEL59 DEL60