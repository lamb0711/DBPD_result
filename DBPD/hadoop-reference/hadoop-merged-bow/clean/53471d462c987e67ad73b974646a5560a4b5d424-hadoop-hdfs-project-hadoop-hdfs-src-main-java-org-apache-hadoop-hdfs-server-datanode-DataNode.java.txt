HDFS-8009. Signal congestion on the DataNode. Contributed by Haohui Mai.

+  private static final int NUM_CORES = Runtime.getRuntime()
+      .availableProcessors();
+  private static final double CONGESTION_RATIO = 1.5;
-    return pipelineSupportECN ? PipelineAck.ECN.SUPPORTED : PipelineAck.ECN
-      .DISABLED;
+    if (!pipelineSupportECN) {
+      return PipelineAck.ECN.DISABLED;
+    }
+    double load = ManagementFactory.getOperatingSystemMXBean()
+        .getSystemLoadAverage();
+    return load > NUM_CORES * CONGESTION_RATIO ? PipelineAck.ECN.CONGESTED :
+        PipelineAck.ECN.SUPPORTED;

INS23 INS23 INS83 INS83 INS83 INS39 INS59 INS83 INS83 INS83 INS39 INS59 INS42 INS32 INS42 INS34 INS25 INS60 INS32 INS42 INS38 INS8 INS39 INS59 INS42 INS42 INS42 INS41 INS42 INS32 INS27 UPD40 UPD40 INS40 INS32 INS42 INS42 INS27 INS42 INS42 INS42 INS42 DEL42