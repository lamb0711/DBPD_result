Merging trunk to HDFS-1623 branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1177130 13f79535-47bb-0310-9956-ffa450edef68

-  private ContainerManager getContainerMgrProxy(
+  protected ContainerManager getContainerMgrProxy(
-    StringBuilder mergedCommand = new StringBuilder();
-    String failCount = Integer.toString(application.getAppAttemptId()
-        .getAttemptId());
-    List<String> commandList = new ArrayList<String>();
-    for (String str : container.getCommands()) {
-      // This is out-right wrong. AM FAIL count should be passed via env.
-      String result =
-          str.replaceFirst(ApplicationConstants.AM_FAIL_COUNT_STRING,
-              failCount);
-      mergedCommand.append(result).append(" ");
-      commandList.add(result);
-    }
-    container.setCommands(commandList);
-    /** add the failed count to the app master command line */
-   
-    LOG.info("Command to launch container " + 
-        containerID + " : " + mergedCommand);
+    LOG.info("Command to launch container "
+        + containerID
+        + " : "
+        + StringUtils.arrayToString(container.getCommands().toArray(
+            new String[0])));
+
+    // Set the AppAttemptId to be consumable by the AM.
+    environment.put(ApplicationConstants.APPLICATION_ATTEMPT_ID_ENV,
+        application.getAppAttemptId().toString());
+

UPD83 INS21 MOV32 UPD42 UPD42 INS40 INS32 UPD42 INS42 INS42 INS32 MOV32 INS42 INS3 INS5 INS34 MOV43 INS85 DEL42 DEL43 DEL42 DEL42 DEL43 DEL14 DEL59 DEL60 DEL42 DEL59 DEL60 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL42 DEL43 DEL42 DEL43 DEL74 DEL14 DEL59 DEL60 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL42 DEL42 DEL40 DEL42 DEL32 DEL59 DEL60 DEL42 DEL42 DEL42 DEL32 DEL42 DEL45 DEL32 DEL21 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL70 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42