MAPREDUCE-3463. Second AM fails to recover properly when first AM is killed with java.lang.IllegalArgumentException causing lost job. (Siddharth Seth via mahadev)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1208994 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.yarn.factories.RecordFactory;
-import org.apache.hadoop.yarn.factory.providers.RecordFactoryProvider;
-  private static final RecordFactory recordFactory = RecordFactoryProvider.getRecordFactory(null);
-
-    this.dispatcher = new RecoveryDispatcher();
+    this.dispatcher = createRecoveryDispatcher();
+  
+  protected Dispatcher createRecoveryDispatcher() {
+    return new RecoveryDispatcher();
+  }
+  
+  protected Dispatcher createRecoveryDispatcher(boolean exitOnException) {
+    return new RecoveryDispatcher(exitOnException);
+  }
+  @SuppressWarnings("rawtypes")
-    RecoveryDispatcher() {
+    RecoveryDispatcher(boolean exitOnException) {
+      super(exitOnException);
+    RecoveryDispatcher() {
+      this(false);
+    }
+
+    @SuppressWarnings("unchecked")
+      realDispatch(event);
+    }
+    
+    public void realDispatch(Event event) {
+  @SuppressWarnings({"rawtypes", "unchecked"})
-      NodeId nodeId = ConverterUtils.toNodeId(attemptInfo.getHostname());
+      NodeId nodeId =
+          ConverterUtils.toNodeId(attemptInfo.getHostname() + ":"
+              + attemptInfo.getPort());

INS31 INS31 INS83 INS43 INS42 INS8 INS83 INS43 INS42 INS44 INS8 INS79 INS31 INS31 INS79 INS42 INS41 UPD42 MOV42 INS39 INS42 INS41 INS42 INS45 INS44 INS42 INS8 INS79 INS83 INS39 INS42 INS44 INS8 INS42 INS4 MOV14 INS14 INS39 INS42 INS46 INS17 INS42 INS45 INS21 INS43 INS42 MOV21 INS45 INS45 INS32 INS43 INS42 INS42 INS9 INS32 INS42 INS42 INS42 INS42 INS42 INS27 MOV32 INS45 INS32 INS42 INS42 DEL40 DEL26 DEL40 DEL26 DEL83 DEL83 DEL83 DEL43 DEL42 DEL42 DEL42 DEL33 DEL32 DEL59 DEL23