HDFS-6345. DFS.listCacheDirectives() should allow filtering based on cache directive ID. (wang)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1595086 13f79535-47bb-0310-9956-ffa450edef68

-    if (filter.getId() != null) {
-      throw new IOException("Filtering by ID is unsupported.");
-    }
-      throw new IOException("Filtering by replication is unsupported.");
+      throw new InvalidRequestException(
+          "Filtering by replication is unsupported.");
+
+    // Querying for a single ID
+    final Long id = filter.getId();
+    if (id != null) {
+      if (!directivesById.containsKey(id)) {
+        throw new InvalidRequestException("Did not find requested id " + id);
+      }
+      // Since we use a tailMap on directivesById, setting prev to id-1 gets
+      // us the directive with the id (if present)
+      prevId = id - 1;
+    }
+
+
+      // If the requested ID is present, it should be the first item.
+      // Hitting this case means the ID is not present, or we're on the second
+      // item and should break out.
+      if (id != null &&
+          !(info.getId().equals(id))) {
+        break;
+      }

MOV25 INS60 INS25 MOV27 INS83 INS43 INS59 INS27 INS8 INS42 INS42 MOV32 INS42 INS33 MOV25 INS21 INS25 INS38 INS7 INS27 INS8 UPD43 UPD45 INS32 INS42 INS27 INS27 INS38 INS10 UPD42 INS42 INS42 INS42 INS42 INS34 INS42 INS33 INS36 UPD43 INS27 INS32 UPD42 INS45 INS42 INS32 INS42 INS42 INS42 INS42 DEL33 DEL27 DEL45