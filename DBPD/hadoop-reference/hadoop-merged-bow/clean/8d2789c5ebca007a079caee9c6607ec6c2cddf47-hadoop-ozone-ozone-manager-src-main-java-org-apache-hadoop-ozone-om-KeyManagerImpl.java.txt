HDDS-795. RocksDb specific classes leak from DBStore/Table interfaces. Contributed by  MÃ¡rton Elek.

-import com.google.common.base.Preconditions;
+import java.io.IOException;
+import java.util.ArrayList;
+import java.util.Collections;
+import java.util.List;
+import java.util.concurrent.TimeUnit;
+
-import org.apache.hadoop.ozone.protocol.proto
-    .OzoneManagerProtocolProtos.KeyLocationList;
+import org.apache.hadoop.ozone.protocol.proto.OzoneManagerProtocolProtos.KeyLocationList;
-import org.rocksdb.RocksDBException;
-import org.rocksdb.WriteBatch;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
+import org.apache.hadoop.utils.db.BatchOperation;
+import org.apache.hadoop.utils.db.DBStore;
-import java.io.IOException;
-import java.util.ArrayList;
-import java.util.Collections;
-import java.util.List;
-import java.util.concurrent.TimeUnit;
-
+import com.google.common.base.Preconditions;
-import static org.apache.hadoop.ozone.OzoneConfigKeys.OZONE_SCM_BLOCK_SIZE_DEFAULT;
+import static org.apache.hadoop.ozone.OzoneConfigKeys.OZONE_SCM_BLOCK_SIZE_DEFAULT;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
-      try (WriteBatch batch = new WriteBatch()) {
-        batch.delete(metadataManager.getKeyTable().getHandle(), fromKey);
-        batch.put(metadataManager.getKeyTable().getHandle(), toKey,
+      DBStore store = metadataManager.getStore();
+      try (BatchOperation batch = store.initBatchOperation()) {
+        metadataManager.getKeyTable().deleteWithBatch(batch, fromKey);
+        metadataManager.getKeyTable().putWithBatch(batch, toKey,
-        metadataManager.getStore().write(batch);
+        store.commitBatchOperation(batch);
-    } catch (RocksDBException | IOException ex) {
+    } catch (IOException ex) {

MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 UPD40 UPD40 INS60 INS43 INS59 MOV21 MOV43 INS42 INS42 MOV32 UPD43 UPD42 INS32 MOV32 INS42 INS42 UPD42 INS42 INS42 MOV32 UPD42 UPD42 UPD42 MOV32 UPD42 INS42 DEL42 DEL43 DEL14 DEL42 DEL42 DEL42 DEL32 DEL42 DEL32 DEL42 DEL43 DEL84