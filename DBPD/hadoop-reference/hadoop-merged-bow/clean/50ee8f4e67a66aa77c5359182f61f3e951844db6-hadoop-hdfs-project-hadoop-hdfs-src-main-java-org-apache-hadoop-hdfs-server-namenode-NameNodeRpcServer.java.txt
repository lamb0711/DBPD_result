HDFS-7960. The full block report should prune zombie storages even if they're not empty. Contributed by Colin McCabe and Eddy Xu.

+import org.apache.hadoop.hdfs.server.protocol.BlockReportContext;
-      String poolId, StorageBlockReport[] reports) throws IOException {
+        String poolId, StorageBlockReport[] reports,
+        BlockReportContext context) throws IOException {
-    for(StorageBlockReport r : reports) {
-      final BlockListAsLongs blocks = r.getBlocks();
+    for (int r = 0; r < reports.length; r++) {
+      final BlockListAsLongs blocks = reports[r].getBlocks();
-      noStaleStorages = bm.processReport(nodeReg, r.getStorage(), blocks);
+      noStaleStorages = bm.processReport(nodeReg, reports[r].getStorage(),
+          blocks, context, (r == reports.length - 1));

INS26 INS40 INS44 INS43 INS42 INS24 INS42 INS58 INS27 INS37 INS8 INS39 INS59 INS42 INS40 INS42 MOV60 MOV21 MOV21 INS42 INS34 INS2 INS42 INS36 INS42 INS42 INS2 INS27 INS42 INS42 INS42 INS27 INS40 INS34 DEL42 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL8 DEL70