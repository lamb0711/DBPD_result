HADOOP-6323. Add comparators to the serialization API.  Contributed by Aaron Kimball.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@889877 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.io.RawComparator;
-  protected abstract Schema getSchema(T t, Map<String, String> metadata);
+  protected abstract Schema getSchema(Map<String, String> metadata);
+    private Schema schema;
-      writer = getWriter(metadata);
+      this.writer = getWriter(metadata);
+      this.schema = getSchema(this.metadata);
+      writer.setSchema(this.schema);
-      writer.setSchema(getSchema(t, metadata));
+  @Override
+  @SuppressWarnings("unchecked")
+  /**
+   * Provides a raw comparator for Avro-encoded serialized data.
+   * Requires that {@link AvroSerialization#AVRO_SCHEMA_KEY} be provided
+   * in the metadata argument.
+   * @param metadata the Avro-serialization-specific parameters being
+   * provided that detail the schema for the data to deserialize and compare.
+   * @return a RawComparator parameterized for the specified Avro schema.
+   */
+  public RawComparator<T> getRawComparator(Map<String, String> metadata) {
+    Schema schema = Schema.parse(metadata.get(AVRO_SCHEMA_KEY));
+    return new AvroComparator(schema);
+  }
+

INS26 INS40 INS31 INS23 INS78 INS79 INS83 INS74 INS42 INS44 INS8 INS83 INS43 INS59 INS42 INS42 INS45 INS43 INS43 INS74 INS42 INS60 INS41 INS42 INS42 INS21 INS21 INS42 INS42 INS43 INS43 INS43 INS43 INS59 INS14 INS7 INS32 INS42 INS42 INS42 INS42 INS42 INS32 INS43 INS42 INS22 INS22 INS32 INS42 INS42 INS22 INS42 INS42 INS32 INS42 INS52 INS42 INS52 INS42 INS42 INS22 INS52 INS42 INS42 INS42 INS42 INS52 INS42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21