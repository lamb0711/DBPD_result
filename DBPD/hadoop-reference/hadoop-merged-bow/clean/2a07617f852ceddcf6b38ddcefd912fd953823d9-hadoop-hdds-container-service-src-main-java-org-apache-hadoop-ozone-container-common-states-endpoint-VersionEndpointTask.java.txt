HDDS-354. VolumeInfo.getScmUsed throws NPE. Contributed by Hanisha Koneru.

-      VolumeSet volumeSet = ozoneContainer.getVolumeSet();
-      Map<String, HddsVolume> volumeMap = volumeSet.getVolumeMap();
-      Preconditions.checkNotNull(scmId, "Reply from SCM: scmId cannot be " +
-          "null");
-      Preconditions.checkNotNull(clusterId, "Reply from SCM: clusterId " +
-          "cannot be null");
+      // Check volumes
+      VolumeSet volumeSet = ozoneContainer.getVolumeSet();
+      volumeSet.readLock();
+      try {
+        Map<String, HddsVolume> volumeMap = volumeSet.getVolumeMap();
-      // If version file does not exist create version file and also set scmId
-      for (Map.Entry<String, HddsVolume> entry : volumeMap.entrySet()) {
-        HddsVolume hddsVolume = entry.getValue();
-        boolean result = HddsVolumeUtil.checkVolume(hddsVolume, scmId,
-            clusterId, LOG);
-        if (!result) {
-          volumeSet.failVolume(hddsVolume.getHddsRootDir().getPath());
+        Preconditions.checkNotNull(scmId, "Reply from SCM: scmId cannot be " +
+            "null");
+        Preconditions.checkNotNull(clusterId, "Reply from SCM: clusterId " +
+            "cannot be null");
+
+        // If version file does not exist create version file and also set scmId
+        for (Map.Entry<String, HddsVolume> entry : volumeMap.entrySet()) {
+          HddsVolume hddsVolume = entry.getValue();
+          boolean result = HddsVolumeUtil.checkVolume(hddsVolume, scmId,
+              clusterId, LOG);
+          if (!result) {
+            volumeSet.failVolume(hddsVolume.getHddsRootDir().getPath());
+          }
+        if (volumeSet.getVolumesList().size() == 0) {
+          // All volumes are inconsistent state
+          throw new DiskOutOfSpaceException("All configured Volumes are in " +
+              "Inconsistent State");
+        }
+      } finally {
+        volumeSet.readUnlock();
-      if (volumeSet.getVolumesList().size() == 0) {
-        // All volumes are inconsistent state
-        throw new DiskOutOfSpaceException("All configured Volumes are in " +
-            "Inconsistent State");
-      }
+

MOV60 INS21 INS54 INS32 INS8 INS8 INS42 INS42 MOV60 MOV21 MOV21 MOV70 MOV25 INS21 INS32 INS42 INS42