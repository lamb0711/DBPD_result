Merge remote-tracking branch 'apache/trunk' into HDFS-7285

-package org.apache.hadoop.yarn.logaggregation;
+package org.apache.hadoop.yarn.server.nodemanager.containermanager.logaggregation;
+import org.apache.hadoop.yarn.server.api.ContainerLogContext;
+import org.apache.hadoop.yarn.server.nodemanager.ContainerExecutor.ExitCode;
-/**
- * This API is not exposed to end-users yet.
- */
-public enum ContainerLogsRetentionPolicy {
-  APPLICATION_MASTER_ONLY, AM_AND_FAILED_CONTAINERS_ONLY, ALL_CONTAINERS 
-}
+public class FailedContainerLogAggregationPolicy extends
+    AbstractContainerLogAggregationPolicy {
+  public boolean shouldDoLogAggregation(ContainerLogContext logContext) {
+    int exitCode = logContext.getExitCode();
+    return exitCode != 0 && exitCode != ExitCode.FORCE_KILLED.getExitCode()
+        && exitCode != ExitCode.TERMINATED.getExitCode();
+  }
+}

INS26 INS26 INS55 UPD40 INS40 INS40 MOV78 INS83 INS42 INS43 INS31 INS42 INS83 INS39 INS42 INS44 INS8 INS43 INS42 INS60 INS41 INS42 INS39 INS59 INS27 INS42 INS32 INS27 INS27 INS42 INS42 INS27 INS27 INS42 INS32 INS42 INS34 INS42 INS32 INS40 INS42 INS40 INS42 DEL83 DEL42 DEL42 DEL72 DEL42 DEL72 DEL42 DEL72 DEL71