YARN-3995. Some of the NM events are not getting published due race condition when AM container finishes in NM (Naganarasimha G R via sjlee)

+import java.util.concurrent.Executors;
+import java.util.concurrent.ScheduledExecutorService;
+import java.util.concurrent.TimeUnit;
+  private long collectorLingerPeriod;
+  private ScheduledExecutorService scheduler;
+    collectorLingerPeriod =
+        conf.getLong(YarnConfiguration.ATS_APP_COLLECTOR_LINGER_PERIOD_IN_MS,
+            YarnConfiguration.DEFAULT_ATS_APP_COLLECTOR_LINGER_PERIOD_IN_MS);
+    scheduler = Executors.newSingleThreadScheduledExecutor();
+    scheduler.shutdown();
+    if (!scheduler.awaitTermination(collectorLingerPeriod,
+        TimeUnit.MILLISECONDS)) {
+      LOG.warn(
+          "Scheduler terminated before removing the application collectors");
+    }
-      new Thread(new Runnable() {
+      scheduler.schedule(new Runnable() {
-          try {
-            // TODO Temporary Fix until solution for YARN-3995 is finalized.
-            Thread.sleep(1000l);
-          } catch (InterruptedException e) {
-            e.printStackTrace();
-          }
-      }).start();
+      }, collectorLingerPeriod, TimeUnit.MILLISECONDS);

INS26 INS26 INS26 INS40 INS40 INS40 INS23 INS23 INS83 INS39 INS59 INS83 INS43 INS59 INS8 INS42 INS42 INS42 INS21 INS21 INS21 INS25 MOV21 MOV21 INS7 INS7 INS32 INS38 INS8 INS42 INS32 INS42 INS32 INS42 INS42 INS32 INS21 INS42 INS42 INS40 INS40 INS42 INS42 INS42 INS42 INS42 INS40 INS32 INS42 INS42 INS45 INS42 INS42 INS14 UPD42 INS40 MOV43 MOV1 INS8 MOV21 DEL8 DEL42 DEL42 DEL34 DEL32 DEL21 DEL8 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL32 DEL21 DEL8 DEL12 DEL54 DEL8 DEL42 DEL43 DEL14 DEL14