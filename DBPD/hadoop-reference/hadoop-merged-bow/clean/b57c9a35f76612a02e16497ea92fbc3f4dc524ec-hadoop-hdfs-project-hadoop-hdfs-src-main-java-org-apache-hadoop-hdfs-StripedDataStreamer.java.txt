HDFS-8220. Erasure Coding: StripedDataStreamer fails to handle the blocklocations which doesn't satisfy BlockGroupSize.

+import org.apache.hadoop.hdfs.protocol.HdfsConstants;
+        if (lb.getLocations().length < HdfsConstants.NUM_DATA_BLOCKS) {
+          throw new IOException(
+              "Failed to get datablocks number of nodes from namenode: blockGroupSize= "
+                  + (HdfsConstants.NUM_DATA_BLOCKS + HdfsConstants.NUM_PARITY_BLOCKS)
+                  + ", blocks.length= " + lb.getLocations().length);
+        }
-          if (!coordinator.getStripedDataStreamer(i).isFailed()) {
-            if (blocks[i] == null) {
-              getLastException().set(
-                  new IOException("Failed to get following block, i=" + i));
-            } else {
-              followingBlocks.offer(i, blocks[i]);
-            }
+          StripedDataStreamer si = coordinator.getStripedDataStreamer(i);
+          if (si.isFailed()) {
+            continue; // skipping failed data streamer
+          }
+          if (blocks[i] == null) {
+            // Set exception and close streamer as there is no block locations
+            // found for the parity block.
+            LOG.warn("Failed to get block location for parity block, index="
+                + i);
+            si.getLastException().set(
+                new IOException("Failed to get following block, i=" + i));
+            si.setFailed(true);
+            si.endBlock();
+            si.close(true);
+          } else {
+            followingBlocks.offer(i, blocks[i]);
-          final ExtendedBlock bi = coordinator.getStripedDataStreamer(i).getBlock();
+          StripedDataStreamer si = coordinator.getStripedDataStreamer(i);
+          if (si.isFailed()) {
+            continue; // skipping failed data streamer
+          }
+          final ExtendedBlock bi = si.getBlock();
-          final ExtendedBlock bi = coordinator.getStripedDataStreamer(i).getBlock();
+          StripedDataStreamer si = coordinator.getStripedDataStreamer(i);
+          if (si.isFailed()) {
+            continue; // skipping failed data streamer
+          }
+          final ExtendedBlock bi = si.getBlock();

INS26 INS40 INS25 INS27 INS8 MOV8 INS22 INS40 INS53 INS60 INS25 INS25 INS60 INS25 INS60 INS32 INS42 INS14 INS43 INS59 INS32 INS8 INS43 INS32 INS8 INS83 MOV43 INS59 INS43 INS32 INS8 INS83 MOV43 INS59 INS42 INS42 INS43 INS27 INS42 INS42 MOV32 INS42 INS42 INS18 INS21 INS21 INS21 INS21 INS42 UPD42 MOV32 INS42 INS42 INS18 INS42 INS32 INS42 UPD42 MOV32 INS42 INS42 INS18 INS42 INS32 INS42 INS45 INS36 INS45 INS22 INS32 INS32 INS32 INS32 INS42 INS42 INS42 INS42 INS27 INS32 INS42 INS42 INS42 INS27 INS42 INS42 INS9 INS42 INS42 INS42 INS42 INS9 INS40 INS40 INS42 INS42 INS45 INS42 INS42 DEL42 DEL32 DEL38 DEL25 DEL8 DEL83 DEL42 DEL32 DEL83 DEL42 DEL32