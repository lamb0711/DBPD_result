HDFS-6948. DN rejects blocks if it has older UC block. Contributed by
Eric Payne.

-      throw new ReplicaAlreadyExistsException("Block " + b +
-          " already exists in state " + replicaInfo.getState() +
-          " and thus cannot be created.");
+      if (replicaInfo.getGenerationStamp() < b.getGenerationStamp()
+          && replicaInfo instanceof ReplicaInPipeline) {
+        // Stop the previous writer
+        ((ReplicaInPipeline)replicaInfo)
+                      .stopWriter(datanode.getDnConf().getXceiverStopTimeout());
+        invalidate(b.getBlockPoolId(), new Block[]{replicaInfo});
+      } else {
+        throw new ReplicaAlreadyExistsException("Block " + b +
+            " already exists in state " + replicaInfo.getState() +
+            " and thus cannot be created.");
+      }

INS25 MOV27 INS8 MOV25 INS27 INS8 INS27 INS62 INS21 INS21 INS32 INS32 INS42 INS43 INS32 INS32 INS42 INS42 INS42 INS42 INS42 INS36 INS42 INS32 INS42 INS32 INS3 INS11 INS32 INS42 INS42 INS42 INS5 INS4 INS43 INS42 INS42 INS42 INS43 INS85 INS42 INS42 INS42