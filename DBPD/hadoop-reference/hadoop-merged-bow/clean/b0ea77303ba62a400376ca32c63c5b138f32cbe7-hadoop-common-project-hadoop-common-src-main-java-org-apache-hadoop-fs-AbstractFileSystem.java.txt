HADOOP-8240. Add a new API to allow users to specify a checksum type on FileSystem.create(..).  Contributed by Kihwal Lee


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1374696 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.fs.Options.ChecksumOpt;
+import org.apache.hadoop.util.DataChecksum;
+    ChecksumOpt checksumOpt = null;
+      } else if (CreateOpts.ChecksumParam.class.isInstance(iOpt)) {
+        if (checksumOpt != null) {
+          throw new  HadoopIllegalArgumentException(
+              "CreateChecksumType option is set multiple times");
+        }
+        checksumOpt = ((CreateOpts.ChecksumParam) iOpt).getValue();
-    if (bytesPerChecksum == -1) {
-      bytesPerChecksum = ssDef.getBytesPerChecksum();
-    }
+
+    // Create a checksum option honoring user input as much as possible.
+    // If bytesPerChecksum is specified, it will override the one set in
+    // checksumOpt. Any missing value will be filled in using the default.
+    ChecksumOpt defaultOpt = new ChecksumOpt(
+        ssDef.getChecksumType(),
+        ssDef.getBytesPerChecksum());
+    checksumOpt = ChecksumOpt.processChecksumOpt(defaultOpt,
+        checksumOpt, bytesPerChecksum);
+
-      replication, blockSize, progress, bytesPerChecksum, createParent);
+      replication, blockSize, progress, checksumOpt, createParent);
-      int bytesPerChecksum, boolean createParent)
+      ChecksumOpt checksumOpt, boolean createParent)

INS26 INS26 INS40 INS40 INS60 INS60 MOV21 INS43 INS42 INS43 INS59 INS43 INS59 INS42 INS42 INS42 INS33 INS42 INS42 INS14 INS42 INS32 UPD42 INS43 INS32 MOV32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS25 INS32 INS8 MOV25 INS57 INS42 INS42 INS25 INS21 INS43 INS27 INS8 INS7 INS40 INS42 INS33 INS53 INS42 INS32 INS14 INS36 INS42 INS43 INS45 INS11 INS42 INS43 INS42 INS40 DEL42 DEL42 DEL34 DEL38 DEL27 DEL8 DEL25 DEL39 DEL42