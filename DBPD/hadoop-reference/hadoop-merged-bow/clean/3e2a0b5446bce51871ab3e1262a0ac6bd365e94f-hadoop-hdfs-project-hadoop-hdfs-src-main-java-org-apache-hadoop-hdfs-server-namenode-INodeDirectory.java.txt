HDFS-6969. Archival Storage: INode#getStoragePolicyID should always return the latest storage policy. Contributed by Jing Zhao.

-  public byte getStoragePolicyID(int snapshotId) {
-    if (snapshotId != Snapshot.CURRENT_STATE_ID) {
-      return getSnapshotINode(snapshotId).getStoragePolicyID();
-    }
+  public byte getLocalStoragePolicyID() {
+  @Override
+  public byte getStoragePolicyID() {
+    byte id = getLocalStoragePolicyID();
+    if (id != BlockStoragePolicy.ID_UNSPECIFIED) {
+      return id;
+    }
+    // if it is unspecified, check its parent
+    return getParent() != null ? getParent().getStoragePolicyID() :
+        BlockStoragePolicy.ID_UNSPECIFIED;
+  }
+

INS31 UPD42 INS78 INS83 INS39 INS42 INS8 INS42 INS60 INS25 INS41 INS39 INS59 INS27 INS8 INS16 INS42 INS32 INS42 INS40 INS41 INS27 INS32 INS40 INS42 INS42 INS32 INS33 INS32 INS42 INS42 INS42 DEL39 DEL42 DEL44 DEL42 DEL40 DEL27 DEL42 DEL42 DEL32 DEL42 DEL32 DEL41 DEL8 DEL25