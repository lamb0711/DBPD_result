Merge trunk into HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1202013 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.util.PureJavaCrc32;
-      int bytesPerChecksum, short replication) throws IOException {
-    super(new PureJavaCrc32(), bytesPerChecksum, 4);
+      DataChecksum checksum, short replication) throws IOException {
+    super(checksum, checksum.getBytesPerChecksum(), checksum.getChecksumSize());
+    int bytesPerChecksum = checksum.getBytesPerChecksum();
-    checksum = DataChecksum.newDataChecksum(DataChecksum.CHECKSUM_CRC32, 
-                                            bytesPerChecksum);
+    this.checksum = checksum;
-      int buffersize, int bytesPerChecksum) 
+      int buffersize, DataChecksum checksum) 
-    this(dfsClient, src, blockSize, progress, bytesPerChecksum, replication);
+    this(dfsClient, src, blockSize, progress, checksum, replication);
-    computePacketChunkSize(dfsClient.getConf().writePacketSize, bytesPerChecksum);
+    computePacketChunkSize(dfsClient.getConf().writePacketSize,
+        checksum.getBytesPerChecksum());
-      int bytesPerChecksum) throws IOException {
-    this(dfsClient, src, stat.getBlockSize(), progress, bytesPerChecksum, stat.getReplication());
+      DataChecksum checksum) throws IOException {
+    this(dfsClient, src, stat.getBlockSize(), progress, checksum, stat.getReplication());
-      streamer = new DataStreamer(lastBlock, stat, bytesPerChecksum);
+      streamer = new DataStreamer(lastBlock, stat, checksum.getBytesPerChecksum());
-      computePacketChunkSize(dfsClient.getConf().writePacketSize, bytesPerChecksum);
+      computePacketChunkSize(dfsClient.getConf().writePacketSize,
+          checksum.getBytesPerChecksum());

INS43 INS42 INS60 INS43 INS42 INS43 INS42 INS42 INS42 INS32 INS32 INS39 INS59 INS42 UPD42 INS42 UPD42 INS42 INS42 INS42 INS42 INS42 INS32 INS22 INS42 INS32 INS42 INS42 INS52 INS42 INS42 UPD42 MOV42 INS32 INS32 INS42 UPD42 MOV42 INS42 INS42 DEL40 DEL26 DEL39 DEL42 DEL42 DEL43 DEL14 DEL42 DEL34 DEL42 DEL42 DEL42 DEL40 DEL42 DEL32 DEL39 DEL42 DEL39 DEL42 DEL42