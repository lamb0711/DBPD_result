YARN-9814. JobHistoryServer can't delete aggregated files, if remote app root directory is created by NodeManager. Contributed by Adam Antal.

-import org.apache.hadoop.yarn.exceptions.YarnException;
-        String primaryGroupName = null;
-        try {
-          primaryGroupName = loginUser.getPrimaryGroupName();
-        } catch (IOException e) {
-          LOG.warn("No primary group found. The remote root log directory" +
-              " will be created with the HDFS superuser being its group " +
-              "owner. JobHistoryServer may be unable to read the directory.");
+        String primaryGroupName = conf.get(
+            YarnConfiguration.NM_REMOTE_APP_LOG_DIR_GROUPNAME);
+        if (primaryGroupName == null || primaryGroupName.isEmpty()) {
+          try {
+            primaryGroupName = loginUser.getPrimaryGroupName();
+          } catch (IOException e) {
+            LOG.warn("No primary group found. The remote root log directory" +
+                    " will be created with the HDFS superuser being its " +
+                    "group owner. JobHistoryServer may be unable to read " +
+                    "the directory.");
+          }
+        } else {
+          if (LOG.isDebugEnabled()) {
+            LOG.debug("The group of remote root log directory has been " +
+                "determined by the configuration and set to " +
+                primaryGroupName);
+          }

INS25 INS27 INS8 INS8 INS32 INS27 INS32 MOV54 INS25 INS42 INS42 INS40 INS42 INS33 INS42 INS42 INS32 INS8 INS42 INS42 INS21 INS32 INS42 INS42 INS27 INS45 INS45 INS42 UPD45 UPD45 INS45 DEL40 DEL26 DEL33