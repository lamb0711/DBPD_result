HADOOP-11847 Enhance raw coder allowing to read least required inputs in decoding. Contributed by Kai Zheng

-   * Ensure output buffer filled with ZERO bytes fully in chunkSize.
-   * @param buffer a buffer ready to write chunk size bytes
+   * Ensure a buffer filled with ZERO bytes from current readable/writable
+   * position.
+   * @param buffer a buffer ready to read / write certain size bytes
-  protected ByteBuffer resetOutputBuffer(ByteBuffer buffer) {
+  protected ByteBuffer resetBuffer(ByteBuffer buffer) {
-   * bytes fully in chunkSize.
+   * bytes fully in specified length of len.
+   * @param allowNull
-  protected void ensureLength(ByteBuffer[] buffers, int dataLen) {
+  protected void ensureLength(ByteBuffer[] buffers,
+                              boolean allowNull, int dataLen) {
-      if (buffers[i].remaining() != dataLen) {
+      if (buffers[i] == null && !allowNull) {
+        throw new HadoopIllegalArgumentException(
+            "Invalid buffer found, not allowing null");
+      } else if (buffers[i] != null && buffers[i].remaining() != dataLen) {
+   * @param allowNull
-  protected void ensureLength(byte[][] buffers, int dataLen) {
+  protected void ensureLength(byte[][] buffers,
+                              boolean allowNull, int dataLen) {
-      if (buffers[i].length != dataLen) {
+      if (buffers[i] == null && !allowNull) {
+        throw new HadoopIllegalArgumentException(
+            "Invalid buffer found, not allowing null");
+      } else if (buffers[i] != null && buffers[i].length != dataLen) {

UPD42 INS44 INS44 INS65 INS39 INS42 INS65 INS39 INS42 UPD66 INS66 UPD66 UPD66 INS42 INS42 INS25 INS25 INS27 INS8 MOV25 INS27 INS8 MOV25 INS27 INS38 INS53 INS27 INS27 INS38 INS53 INS27 INS2 INS33 INS42 INS14 INS27 MOV27 INS2 INS33 INS42 INS14 INS27 MOV27 INS42 INS42 INS43 INS45 INS2 INS33 INS42 INS42 INS43 INS45 INS2 INS33 INS42 INS42 INS42 INS42 INS42 INS42