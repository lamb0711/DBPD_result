YARN-6055. ContainersMonitorImpl need be adjusted when NM resource changed. Contributed by Inigo Goiri.

+  /** Maximum virtual memory in bytes. */
+  /** Maximum physical memory in bytes. */
-            this.resourceCalculatorPlugin, this.conf) * 1024 * 1024L;
+            this.resourceCalculatorPlugin, this.conf);
-    long configuredVCoresForContainers =
-        NodeManagerHardwareUtils.getVCores(this.resourceCalculatorPlugin,
-            this.conf);
-
-    // Setting these irrespective of whether checks are enabled. Required in
-    // the UI.
-    // ///////// Physical memory configuration //////
-    this.maxPmemAllottedForContainers = configuredPMemForContainers;
-    this.maxVCoresAllottedForContainers = configuredVCoresForContainers;
+    int configuredVCoresForContainers =
+        NodeManagerHardwareUtils.getVCores(
+            this.resourceCalculatorPlugin, this.conf);
-    this.maxVmemAllottedForContainers =
-        (long) (vmemRatio * configuredPMemForContainers);
+
+    // Setting these irrespective of whether checks are enabled.
+    // Required in the UI.
+    Resource resourcesForContainers = Resource.newInstance(
+        configuredPMemForContainers, configuredVCoresForContainers);
+    setAllocatedResourcesForContainers(resourcesForContainers);
+  @Override
+  public void setAllocatedResourcesForContainers(final Resource resource) {
+    LOG.info("Setting the resources allocated to containers to {}", resource);
+    this.maxVCoresAllottedForContainers = resource.getVirtualCores();
+    this.maxPmemAllottedForContainers = convertMBytesToBytes(
+        resource.getMemorySize());
+    this.maxVmemAllottedForContainers =
+        (long) (getVmemRatio() * maxPmemAllottedForContainers);
+  }
+
-      long pmemLimit =
-          changeEvent.getResource().getMemorySize() * 1024L * 1024L;
+      Resource resource = changeEvent.getResource();
+      long pmemLimit = convertMBytesToBytes(resource.getMemorySize());
-      int cpuVcores = changeEvent.getResource().getVirtualCores();
+      int cpuVcores = resource.getVirtualCores();
+
+  /**
+   * Convert MegaBytes to Bytes.
+   * @param mb MegaBytes (MB).
+   * @return Bytes representing the input MB.
+   */
+  private static long convertMBytesToBytes(long mb) {
+    return mb * 1024L * 1024L;
+  }

INS31 INS31 INS29 INS29 INS78 INS83 INS39 INS42 INS44 INS8 INS29 INS83 INS83 INS39 INS42 INS44 INS8 INS65 INS65 INS60 INS42 INS83 INS43 INS42 INS21 MOV21 MOV21 INS21 INS65 INS65 INS65 INS39 INS42 INS41 INS66 INS66 UPD39 INS43 INS59 INS32 INS42 INS32 INS7 MOV60 INS66 INS42 INS66 INS66 INS27 MOV32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS45 INS42 INS32 INS32 MOV22 INS11 INS60 INS42 INS34 INS34 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS39 INS36 INS43 INS39 INS59 INS42 INS42 INS27 INS42 UPD42 MOV32 INS32 INS42 INS32 INS32 INS42 UPD42 MOV42 INS32 INS42 INS42 INS42 UPD42 MOV42 MOV42 DEL34 DEL34 DEL27 DEL39 DEL42 DEL42 DEL27 DEL36 DEL11 DEL7 DEL42 DEL42 DEL39 DEL42 DEL32 DEL32 DEL32 DEL34 DEL34 DEL27