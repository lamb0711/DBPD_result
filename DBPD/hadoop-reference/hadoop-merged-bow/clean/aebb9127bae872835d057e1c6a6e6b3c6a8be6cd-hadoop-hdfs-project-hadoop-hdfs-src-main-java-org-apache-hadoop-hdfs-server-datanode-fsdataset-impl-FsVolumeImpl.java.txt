HDFS-11160. VolumeScanner reports write-in-progress replicas as corrupt incorrectly. Contributed by Wei-Chiu Chuang and Yongjun Zhang.

-  private byte[] loadLastPartialChunkChecksum(
+  @Override
+  public byte[] loadLastPartialChunkChecksum(
-    int offsetInChecksum = BlockMetadataHeader.getHeaderSize() +
-        (int)(onDiskLen / bytesPerChecksum * checksumSize);
+    long offsetInChecksum = BlockMetadataHeader.getHeaderSize() +
+        (onDiskLen / bytesPerChecksum) * checksumSize;
-      raf.read(lastChecksum, 0, checksumSize);
+      int readBytes = raf.read(lastChecksum, 0, checksumSize);
+      if (readBytes == -1) {
+        throw new IOException("Expected to read " + checksumSize +
+            " bytes from offset " + offsetInChecksum +
+            " but reached end of file.");
+      } else if (readBytes != checksumSize) {
+        throw new IOException("Expected to read " + checksumSize +
+            " bytes from offset " + offsetInChecksum + " but read " +
+            readBytes + " bytes.");
+      }

INS78 UPD83 INS42 UPD39 INS8 MOV21 INS60 INS25 MOV27 INS39 INS59 INS27 INS8 INS25 INS36 INS42 MOV32 INS42 INS38 INS53 INS27 INS8 MOV27 INS34 INS14 INS42 INS42 INS53 INS43 INS27 INS14 INS42 INS45 INS42 INS45 INS42 INS45 INS43 INS27 INS42 INS45 INS42 INS45 INS42 INS45 INS42 INS45 DEL39 DEL36 DEL11 DEL21 DEL8