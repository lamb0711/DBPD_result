HDFS-14366. Improve HDFS append performance. Contributed by Chao Sun.

-    final int replication =
-        Math.min(minReplication, getDatanodeManager().getNumLiveDataNodes());
-    return countNodes(b).liveReplicas() >= replication;
+    final int liveReplicas = countNodes(b).liveReplicas();
+    if (liveReplicas >= minReplication) {
+      return true;
+    }
+    // getNumLiveDataNodes() is very expensive and we minimize its use by
+    // comparing with minReplication first.
+    return liveReplicas >= getDatanodeManager().getNumLiveDataNodes();

INS60 INS25 MOV83 MOV39 INS59 INS27 INS8 UPD42 MOV42 MOV32 INS42 INS42 INS41 UPD42 MOV32 INS9 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60