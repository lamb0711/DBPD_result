YARN-7323. Data structure update in service REST API. Contributed by Jian He

+      .addTransition(INIT, INIT, STOP,
+          // container failed before launching, nothing to cleanup from registry
+          // This could happen if NMClient#startContainerAsync failed, container
+          // will be completed, but COMP_INSTANCE is still at INIT.
+          new ContainerStoppedTransition(true))
-      container.setComponentName(compInstance.getCompInstanceName());
+      container.setComponentInstanceName(compInstance.getCompInstanceName());
+    // whether the container failed before launched by AM or not.
+    boolean failedBeforeLaunching = false;
+    public ContainerStoppedTransition(boolean failedBeforeLaunching) {
+      this.failedBeforeLaunching = failedBeforeLaunching;
+    }
+
+    public ContainerStoppedTransition() {
+      this(false);
+    }
+
-      // clean up registry
-      // hdfs dir content will be overwritten when a new container gets started,
-      // so no need remove.
-      compInstance.scheduler.executorService
-          .submit(compInstance::cleanupRegistry);
+      if (!failedBeforeLaunching) {
+        // clean up registry
+        // If the container failed before launching, no need to cleanup registry,
+        // because it was not registered before.
+        // hdfs dir content will be overwritten when a new container gets started,
+        // so no need remove.
+        compInstance.scheduler.executorService
+            .submit(compInstance::cleanupRegistry);
+        if (compInstance.timelineServiceEnabled) {
+          // record in ATS
+          compInstance.serviceTimelinePublisher
+              .componentInstanceFinished(compInstance,
+                  event.getStatus().getExitStatus(), event.getStatus().getState(),
+                  containerDiag);
+        }
+        compInstance.containerSpec.setState(ContainerState.STOPPED);
+      }
-      if (compInstance.timelineServiceEnabled) {
-        // record in ATS
-        compInstance.serviceTimelinePublisher
-            .componentInstanceFinished(compInstance,
-                event.getStatus().getExitStatus(), event.getStatus().getState(),
-                containerDiag);
-      }
-
-      compInstance.containerSpec.setState(ContainerState.STOPPED);

INS23 INS31 INS31 INS39 INS59 INS83 INS42 INS44 INS8 INS83 INS42 INS8 INS42 INS9 INS39 INS42 INS21 INS17 INS25 INS7 INS9 INS38 INS8 UPD42 INS22 INS42 INS42 MOV21 MOV25 MOV21 INS52 INS42 INS32 INS42 MOV32 MOV42 INS42 INS42 INS42 INS14 INS43 INS9 INS42