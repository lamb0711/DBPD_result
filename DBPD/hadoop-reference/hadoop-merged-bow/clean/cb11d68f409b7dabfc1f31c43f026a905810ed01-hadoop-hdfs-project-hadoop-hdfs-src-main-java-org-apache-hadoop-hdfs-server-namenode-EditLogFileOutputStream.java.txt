HDFS-4677. Editlog should support synchronous writes. Contributed by Ivan Mitic.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1491096 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.conf.Configuration;
+import org.apache.hadoop.hdfs.DFSConfigKeys;
+  private boolean shouldSyncWritesAndSkipFsync = false;
+   * @param conf
+   *          Configuration object
-  public EditLogFileOutputStream(File name, int size) throws IOException {
+  public EditLogFileOutputStream(Configuration conf, File name, int size)
+      throws IOException {
+    shouldSyncWritesAndSkipFsync = conf.getBoolean(
+            DFSConfigKeys.DFS_NAMENODE_EDITS_NOEDITLOGCHANNELFLUSH,
+            DFSConfigKeys.DFS_NAMENODE_EDITS_NOEDITLOGCHANNELFLUSH_DEFAULT);
+
-    RandomAccessFile rp = new RandomAccessFile(name, "rw");
+    RandomAccessFile rp;
+    if (shouldSyncWritesAndSkipFsync) {
+      rp = new RandomAccessFile(name, "rws");
+    } else {
+      rp = new RandomAccessFile(name, "rw");
+    }
-    preallocate(); // preallocate file if necessay
+    preallocate(); // preallocate file if necessary
-    if (durable && !shouldSkipFsyncForTests) {
+    if (durable && !shouldSkipFsyncForTests && !shouldSyncWritesAndSkipFsync) {

INS26 INS26 INS40 INS40 INS23 INS83 INS39 INS59 INS44 INS42 INS9 INS65 INS43 INS42 INS21 INS25 INS42 INS66 INS42 INS7 INS42 INS8 INS8 INS42 INS32 INS21 INS21 INS38 INS42 INS42 INS40 INS40 INS7 INS7 INS42 INS42 INS14 INS42 MOV14 INS43 INS42 INS45 INS42