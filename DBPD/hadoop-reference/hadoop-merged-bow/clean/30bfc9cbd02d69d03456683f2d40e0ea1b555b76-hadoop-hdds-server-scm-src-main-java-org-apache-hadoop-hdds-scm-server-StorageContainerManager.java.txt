HDDS-955. SCM CA: Add CA to SCM.
Contributed by Anu Engineer.

-import org.apache.hadoop.hdds.scm.ScmConfigKeys;
+import org.apache.hadoop.hdds.scm.ScmConfigKeys;
-import org.apache.hadoop.hdds.scm.pipeline.SCMPipelineManager;
+import org.apache.hadoop.hdds.scm.pipeline.SCMPipelineManager;
+import org.apache.hadoop.hdds.security.x509.SecurityConfig;
+import org.apache.hadoop.hdds.security.x509.certificate.authority.CertificateServer;
+import org.apache.hadoop.hdds.security.x509.certificate.authority.DefaultCAServer;
-import org.apache.hadoop.ozone.OzoneSecurityUtil;
-import org.apache.hadoop.ozone.protocol.commands.RetriableDatanodeEventWatcher;
+import org.apache.hadoop.ozone.OzoneSecurityUtil;
+import org.apache.hadoop.ozone.protocol.commands.RetriableDatanodeEventWatcher;
+import org.apache.hadoop.security.SecurityUtil;
-import org.apache.hadoop.security.SecurityUtil;
-import static org.apache.hadoop.hdds.scm.ScmConfigKeys
-    .HDDS_SCM_WATCHER_TIMEOUT_DEFAULT;
+
+import java.net.InetAddress;
-
+import static org.apache.hadoop.hdds.scm.ScmConfigKeys.HDDS_SCM_WATCHER_TIMEOUT_DEFAULT;
+  private final CertificateServer certificateServer;
-   * Creates a new StorageContainerManager. Configuration will be updated
-   * with information on the
-   * actual listening addresses used for RPC servers.
+   * Creates a new StorageContainerManager. Configuration will be
+   * updated with information on the actual listening addresses used
+   * for RPC servers.
-    // Authenticate SCM if security is enabled
-    if (OzoneSecurityUtil.isSecurityEnabled(conf)) {
-      loginAsSCMUser(conf);
-    }
-
+    // Authenticate SCM if security is enabled
+    if (OzoneSecurityUtil.isSecurityEnabled(conf)) {
+      loginAsSCMUser(conf);
+      certificateServer = initializeCertificateServer(
+          getScmStorage().getClusterID(), getScmStorage().getScmId());
+      // TODO: Support Intermediary CAs in future.
+      certificateServer.init(new SecurityConfig(conf),
+          CertificateServer.CAType.SELF_SIGNED_CA);
+    } else {
+      // if no Security, we do not create a Certificate Server at all.
+      // This allows user to boot SCM without security temporarily
+      // and then come back and enable it without any impact.
+      certificateServer = null;
+    }
+
+
+
+
+  /**
+   * This function creates/initializes a certificate server as needed.
+   * This function is idempotent, so calling this again and again after the
+   * server is initialized is not a problem.
+   *
+   * @param clusterID - Cluster ID
+   * @param scmID     - SCM ID
+   */
+  private CertificateServer initializeCertificateServer(String clusterID,
+      String scmID) throws IOException {
+    // TODO: Support Certificate Server loading via Class Name loader.
+    // So it is easy to use different Certificate Servers if needed.
+    String subject = "scm@" + InetAddress.getLocalHost().getHostName();
+    return new DefaultCAServer(subject, clusterID, scmID);
+
+  }
+
-   * @param addr RPC server listening address
+   * @param addr        RPC server listening address
-      InetSocketAddress addr) {
+                                                  InetSocketAddress addr) {
-   *
+   * <p>
-   * @param args command-line arguments.
-   * @param conf HDDS configuration
+   * @param args        command-line arguments.
+   * @param conf        HDDS configuration
-    if(getSecurityProtocolServer() != null) {
+    if (getSecurityProtocolServer() != null) {
-      if(getSecurityProtocolServer() != null) {
+      if (getSecurityProtocolServer() != null) {
-  public EventPublisher getEventQueue(){
+  public EventPublisher getEventQueue() {
-    for (HddsProtos.LifeCycleState state: HddsProtos.LifeCycleState.values()) {
+    for (HddsProtos.LifeCycleState state : HddsProtos.LifeCycleState.values()) {

MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS23 INS31 INS83 INS83 INS43 INS59 MOV25 INS29 INS83 INS43 INS42 INS44 INS44 INS43 INS8 INS42 INS42 INS65 INS65 INS65 INS42 INS43 INS42 INS43 INS42 INS42 INS60 INS41 UPD66 UPD66 UPD66 INS8 INS66 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS43 INS59 INS14 UPD66 INS66 UPD66 UPD66 INS21 INS21 INS21 INS42 INS42 INS27 INS43 INS42 INS42 INS42 INS7 INS32 INS7 INS45 INS32 INS42 INS42 INS32 INS42 INS42 INS14 INS40 INS42 INS33 INS32 INS42 INS42 INS32 INS32 INS43 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS42