HDFS-15404. ShellCommandFencer should expose info about source. Contributed by Chen Liang.

+    return fence(fromSvc, null);
+  }
+
+  public boolean fence(HAServiceTarget fromSvc, HAServiceTarget toSvc) {
-        if (method.method.tryFence(fromSvc, method.arg)) {
-          LOG.info("====== Fencing successful by method " + method + " ======");
-          return true;
+        // only true when target node is given, AND fencing on it failed
+        boolean toSvcFencingFailed = false;
+        // if target is given, try to fence on target first. Only if fencing
+        // on target succeeded, do fencing on source node.
+        if (toSvc != null) {
+          toSvcFencingFailed = !method.method.tryFence(toSvc, method.arg);
+        }
+        if (toSvcFencingFailed) {
+          LOG.error("====== Fencing on target failed, skipping fencing "
+              + "on source ======");
+        } else {
+          if (method.method.tryFence(fromSvc, method.arg)) {
+            LOG.info("====== Fencing successful by method "
+                + method + " ======");
+            return true;
+          }

INS31 INS83 INS39 INS42 INS44 INS8 INS44 INS43 INS42 INS41 INS43 INS42 INS42 INS32 INS42 INS42 INS42 INS33 INS8 INS60 INS25 INS25 INS39 INS59 INS27 INS8 INS42 INS8 MOV8 INS42 INS9 INS42 INS33 INS21 INS21 INS7 INS32 INS42 INS38 INS42 INS42 INS27 INS32 INS45 INS45 INS40 INS42 INS42 INS40