Merge r1555021 through r1569889 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1569890 13f79535-47bb-0310-9956-ffa450edef68

+   * @param featuresToCopy any number of features to copy to the new node.
+   *              The method will do a reference copy, not a deep copy.
-  public INodeDirectory(INodeDirectory other, boolean adopt, boolean copyFeatures) {
+  public INodeDirectory(INodeDirectory other, boolean adopt,
+      Feature... featuresToCopy) {
-    if (copyFeatures) {
-      this.features = other.features;
-    }
+    this.features = featuresToCopy;
-    for (Feature f : features) {
-      if (f instanceof DirectoryWithQuotaFeature) {
-        return (DirectoryWithQuotaFeature)f;
-      }
-    }
-    return null;
+    return getFeature(DirectoryWithQuotaFeature.class);
-    for (Feature f : features) {
-      if (f instanceof DirectoryWithSnapshotFeature) {
-        return (DirectoryWithSnapshotFeature) f;
-      }
-    }
-    return null;
+    return getFeature(DirectoryWithSnapshotFeature.class);
-    return replaceSelf(new INodeDirectory(this, true, true), inodeMap);
+    return replaceSelf(new INodeDirectory(this, true, this.getFeatures()),
+      inodeMap);

INS8 INS8 INS65 MOV43 INS42 MOV21 MOV41 MOV41 INS42 INS66 INS66 INS32 INS32 INS42 INS42 INS57 INS42 INS57 MOV43 MOV43 INS32 INS52 INS42 DEL39 DEL42 DEL40 DEL42 DEL8 DEL25 DEL42 DEL11 DEL42 DEL44 DEL42 DEL42 DEL42 DEL43 DEL62 DEL8 DEL25 DEL8 DEL70 DEL33 DEL41 DEL8 DEL42 DEL11 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL43 DEL62 DEL8 DEL25 DEL8 DEL70 DEL33 DEL41 DEL8 DEL9