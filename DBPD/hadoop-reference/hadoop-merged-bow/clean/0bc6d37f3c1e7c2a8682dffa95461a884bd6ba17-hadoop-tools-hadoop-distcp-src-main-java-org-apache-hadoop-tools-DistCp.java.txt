Revert "HDFS-9820. Improve distcp to support efficient restore to an earlier snapshot. Contributed by Yongjun Zhang."

This reverts commit 412c4c9a342b73bf1c1a7f43ea91245cbf94d02d.

-  private void prepareFileListing(Job job) throws Exception {
-    if (inputOptions.shouldUseSnapshotDiff()) {
-      try {
-        DistCpSync distCpSync = new DistCpSync(inputOptions, getConf());
-        distCpSync.sync();
-        createInputFileListingWithDiff(job, distCpSync);
-      } catch (IOException e) {
-        throw new Exception("DistCp"
-            + " sync failed, input options: " + inputOptions, e);
-      }
-    } else {
-      createInputFileListing(job);
-    }
-  }
-
-      prepareFileListing(job);
+      if (inputOptions.shouldUseDiff()) {
+        DistCpSync distCpSync = new DistCpSync(inputOptions, getConf());
+        if (distCpSync.sync()) {
+          createInputFileListingWithDiff(job, distCpSync);
+        } else {
+          throw new Exception("DistCp sync failed, input options: "
+              + inputOptions);
+        }
+      }
+
+      // Fallback to default DistCp if without "diff" option or sync failed.
+      if (!inputOptions.shouldUseDiff()) {
+        createInputFileListing(job);
+      }
+
-    job.getConfiguration().set(DistCpConstants.CONF_LABEL_DISTCP_JOB_ID,
-        jobID);
+    job.getConfiguration().set(DistCpConstants.CONF_LABEL_DISTCP_JOB_ID, jobID);

MOV8 MOV51 INS25 MOV21 MOV21 MOV8 INS38 MOV8 UPD42 INS25 INS32 MOV32 INS8 INS8 INS42 INS42 MOV21 INS53 INS14 MOV43 INS27 INS45 INS42 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL31 DEL21 DEL42 DEL43 DEL42 DEL44 DEL45 DEL45 DEL42 DEL27 DEL42 DEL14 DEL53 DEL8 DEL12 DEL54 DEL8 DEL42 DEL42 DEL32 DEL21 DEL8