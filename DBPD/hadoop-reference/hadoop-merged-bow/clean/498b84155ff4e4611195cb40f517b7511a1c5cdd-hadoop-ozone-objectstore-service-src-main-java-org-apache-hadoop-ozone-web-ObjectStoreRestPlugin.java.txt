HDFS-13300. Ozone: Remove DatanodeID dependency from HDSL and Ozone.
Contributed by Nanda kumar.

-import org.apache.hadoop.hdfs.protocol.DatanodeID;
+import org.apache.hadoop.conf.Configuration;
+import org.apache.hadoop.hdsl.protocol.DatanodeDetails;
+import org.apache.hadoop.ozone.HdslDatanodeService;
+import org.apache.hadoop.util.ServicePlugin;
+  private final boolean isOzoneEnabled;
+
+  private Configuration conf;
-
-  private volatile int restServicePort = -1;
-
-    OzoneConfiguration.activate();
+      OzoneConfiguration.activate();
+      this.conf = new OzoneConfiguration();
+      this.isOzoneEnabled = OzoneUtils.isOzoneEnabled(conf);
-    if (OzoneUtils.isOzoneEnabled(dataNode.getConf())) {
+    if (isOzoneEnabled) {
+        getDatanodeDetails(dataNode).setOzoneRestPort(
+            objectStoreRestHttpServer.getHttpAddress().getPort());
-      synchronized (this) {
-        try {
-          restServicePort =
-              objectStoreRestHttpServer.getHttpAddress().getPort();
-        } finally {
-          //in case fo waiting for the port information: we can continue.
-          this.notify();
-        }
+    }
+  }
+
+  public static DatanodeDetails getDatanodeDetails(DataNode dataNode) {
+    for (ServicePlugin plugin : dataNode.getPlugins()) {
+      if (plugin instanceof HdslDatanodeService) {
+        return ((HdslDatanodeService) plugin).getDatanodeDetails();
+    throw new RuntimeException("Not able to find HdslDatanodeService in the" +
+        " list of plugins loaded by DataNode.");
-  @Override
-  public void onDatanodeIdCreation(DatanodeID dataNodeId) {
-    synchronized (this) {
-      if (restServicePort == -1) {
-        try {
-          this.wait();
-        } catch (InterruptedException e) {
-          LOG.error("Wait for starting up http server is interrupted.");
-        }
-      }
-    }
-    dataNodeId.setOzoneRestPort(restServicePort);
-  }

MOV26 INS26 INS26 INS26 MOV23 MOV31 INS40 UPD40 INS40 INS40 INS23 UPD83 UPD39 INS83 INS43 INS59 INS83 INS43 INS42 UPD42 INS42 INS42 INS21 INS21 INS42 UPD43 UPD42 INS70 INS53 INS7 INS7 INS42 UPD42 INS44 INS32 INS8 INS14 INS22 INS14 INS22 INS32 UPD43 MOV43 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 INS25 INS43 INS27 INS52 INS42 INS43 INS52 INS42 INS42 INS42 INS42 UPD42 INS62 INS8 INS42 INS45 INS45 INS42 INS21 INS42 INS43 INS41 INS32 INS42 INS32 INS32 INS42 MOV32 INS36 UPD42 MOV42 INS42 INS42 INS11 INS43 INS42 INS42 DEL34 DEL38 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL52 DEL42 DEL7 DEL21 DEL8 DEL52 DEL42 DEL32 DEL21 DEL8 DEL54 DEL8 DEL51 DEL42 DEL78 DEL39 DEL42 DEL52 DEL42 DEL34 DEL38 DEL27 DEL52 DEL42 DEL32 DEL21 DEL8 DEL44 DEL45 DEL32 DEL21 DEL8 DEL12 DEL54 DEL8 DEL25 DEL8 DEL51 DEL42 DEL42 DEL32 DEL21