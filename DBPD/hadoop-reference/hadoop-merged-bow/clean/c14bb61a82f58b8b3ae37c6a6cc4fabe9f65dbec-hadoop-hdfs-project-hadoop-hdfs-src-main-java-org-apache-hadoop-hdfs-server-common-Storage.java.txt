Merge trunk into HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1242635 13f79535-47bb-0310-9956-ffa450edef68

+      boolean deletionHookAdded = false;
-      lockF.deleteOnExit();
+      if (!lockF.exists()) {
+        lockF.deleteOnExit();
+        deletionHookAdded = true;
+      }
+      if (res != null && !deletionHookAdded) {
+        // If the file existed prior to our startup, we didn't
+        // call deleteOnExit above. But since we successfully locked
+        // the dir, we can take care of cleaning it up.
+        lockF.deleteOnExit();
+      }

INS60 INS25 INS25 INS39 INS59 INS38 INS8 INS27 INS8 INS42 INS9 INS32 MOV21 INS21 INS27 INS38 INS21 INS42 INS42 INS7 INS42 INS33 INS42 INS32 INS42 INS9 INS42 INS42