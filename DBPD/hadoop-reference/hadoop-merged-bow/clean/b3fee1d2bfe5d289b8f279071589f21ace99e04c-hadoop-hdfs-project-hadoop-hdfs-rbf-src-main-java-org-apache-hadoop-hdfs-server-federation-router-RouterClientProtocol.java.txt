HDFS-14011. RBF: Add more information to HdfsFileStatus for a mount point. Contributed by Akira Ajisaka.

+      } else if (children != null) {
+        // The src is a mount point, but there are no files or directories
+        ret = getMountPointStatus(src, 0, 0);
-    try {
-      // TODO support users, it should be the user for the pointed folder
-      UserGroupInformation ugi = RouterRpcServer.getRemoteUser();
-      owner = ugi.getUserName();
-      group = ugi.getPrimaryGroupName();
-    } catch (IOException e) {
-      LOG.error("Cannot get the remote user: {}", e.getMessage());
+    if (subclusterResolver instanceof MountTableResolver) {
+      try {
+        MountTableResolver mountTable = (MountTableResolver) subclusterResolver;
+        MountTable entry = mountTable.getMountPoint(name);
+        if (entry != null) {
+          permission = entry.getMode();
+          owner = entry.getOwnerName();
+          group = entry.getGroupName();
+        }
+      } catch (IOException e) {
+        LOG.error("Cannot get mount point: {}", e.getMessage());
+      }
+    } else {
+      try {
+        UserGroupInformation ugi = RouterRpcServer.getRemoteUser();
+        owner = ugi.getUserName();
+        group = ugi.getPrimaryGroupName();
+      } catch (IOException e) {
+        LOG.error("Cannot get remote user: {}", e.getMessage());
+      }

INS25 INS62 INS8 INS8 INS42 INS43 INS54 MOV54 INS25 INS42 INS8 MOV12 INS12 INS27 INS8 INS60 INS60 INS25 INS44 INS8 INS42 INS33 INS21 INS43 INS59 INS43 INS59 INS27 INS8 INS43 INS42 INS21 INS7 INS42 INS42 INS11 INS42 INS42 INS32 INS42 INS33 INS21 INS21 INS21 INS42 INS32 INS42 INS32 INS43 INS42 INS42 INS42 INS42 INS7 INS7 INS7 UPD45 INS42 INS42 INS45 INS32 INS42 INS42 INS34 INS34 INS42 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42