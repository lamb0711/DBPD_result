HDFS-13068. RBF: Add router admin option to manage safe mode. Contributed by Yiqun Lin.

+import org.apache.hadoop.hdfs.server.federation.router.RouterStateManager;
+import org.apache.hadoop.hdfs.server.federation.store.protocol.EnterSafeModeRequest;
+import org.apache.hadoop.hdfs.server.federation.store.protocol.EnterSafeModeResponse;
+import org.apache.hadoop.hdfs.server.federation.store.protocol.GetSafeModeRequest;
+import org.apache.hadoop.hdfs.server.federation.store.protocol.GetSafeModeResponse;
+import org.apache.hadoop.hdfs.server.federation.store.protocol.LeaveSafeModeRequest;
+import org.apache.hadoop.hdfs.server.federation.store.protocol.LeaveSafeModeResponse;
-        + "\t[-clrQuota <path>\n";
+        + "\t[-clrQuota <path>]\n"
+        + "\t[-safemode enter | leave | get]\n";
+
+    } else if ("-safemode".equalsIgnoreCase(cmd)) {
+      if (argv.length < 2) {
+        System.err.println("Not enough parameters specificed for cmd " + cmd);
+        printUsage();
+        return exitCode;
+      }
+      } else if ("-safemode".equals(cmd)) {
+        manageSafeMode(argv[i]);
+   * Manager the safe mode state.
+   * @param cmd Input command, enter or leave safe mode.
+   * @throws IOException
+   */
+  private void manageSafeMode(String cmd) throws IOException {
+    if (cmd.equals("enter")) {
+      if (enterSafeMode()) {
+        System.out.println("Successfully enter safe mode.");
+      }
+    } else if (cmd.equals("leave")) {
+      if (leaveSafeMode()) {
+        System.out.println("Successfully leave safe mode.");
+      }
+    } else if (cmd.equals("get")) {
+      boolean result = getSafeMode();
+      System.out.println("Safe Mode: " + result);
+    }
+  }
+
+  /**
+   * Request the Router entering safemode state.
+   * @return Return true if entering safemode successfully.
+   * @throws IOException
+   */
+  private boolean enterSafeMode() throws IOException {
+    RouterStateManager stateManager = client.getRouterStateManager();
+    EnterSafeModeResponse response = stateManager.enterSafeMode(
+        EnterSafeModeRequest.newInstance());
+    return response.getStatus();
+  }
+
+  /**
+   * Request the Router leaving safemode state.
+   * @return Return true if leaving safemode successfully.
+   * @throws IOException
+   */
+  private boolean leaveSafeMode() throws IOException {
+    RouterStateManager stateManager = client.getRouterStateManager();
+    LeaveSafeModeResponse response = stateManager.leaveSafeMode(
+        LeaveSafeModeRequest.newInstance());
+    return response.getStatus();
+  }
+
+  /**
+   * Verify if current Router state is safe mode state.
+   * @return True if the Router is in safe mode.
+   * @throws IOException
+   */
+  private boolean getSafeMode() throws IOException {
+    RouterStateManager stateManager = client.getRouterStateManager();
+    GetSafeModeResponse response = stateManager.getSafeMode(
+        GetSafeModeRequest.newInstance());
+    return response.isInSafeMode();
+  }
+
+  /**

INS26 INS26 INS26 INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS40 INS40 INS40 INS31 INS31 INS31 INS31 INS29 INS83 INS39 INS42 INS44 INS43 INS8 INS29 INS83 INS39 INS42 INS43 INS8 INS29 INS83 INS39 INS42 INS43 INS8 INS29 INS83 INS39 INS42 INS43 INS8 INS65 INS65 INS65 INS43 INS42 INS42 INS25 INS65 INS65 INS65 INS42 INS60 INS60 INS41 INS65 INS65 INS65 INS42 INS60 INS60 INS41 INS65 INS65 INS65 INS42 INS60 INS60 INS41 INS66 INS42 INS66 INS42 INS42 INS32 INS8 INS25 INS66 INS66 INS42 INS43 INS59 INS43 INS59 INS32 INS66 INS66 INS42 INS43 INS59 INS43 INS59 INS32 INS66 INS66 INS42 INS43 INS59 INS43 INS59 INS32 INS42 INS42 INS45 INS25 INS32 INS8 INS25 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 UPD45 INS45 INS32 INS8 INS42 INS42 INS45 INS25 INS32 INS8 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS25 INS42 INS21 INS32 INS8 INS42 INS42 INS45 INS60 INS21 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS8 INS32 INS42 INS21 INS39 INS59 INS32 INS45 INS42 INS42 INS25 INS40 INS42 INS45 INS32 INS42 INS32 INS40 INS42 INS27 INS27 INS8 INS25 INS40 INS42 INS45 INS42 INS45 INS42 INS40 INS34 INS21 INS21 INS41 INS32 INS8 MOV8 INS32 INS32 INS42 INS45 INS42 INS42 INS21 INS40 INS42 INS27 INS42 INS32 INS45 INS42 INS42 INS2 INS42 INS42