Merge branch 'trunk' into HADOOP-12756

-    containersMonitorEnabled = isEnabled();
+    containersMonitorEnabled = isContainerMonitorEnabled();
-  private boolean isEnabled() {
+  private boolean isContainerMonitorEnabled() {
+    return conf.getBoolean(YarnConfiguration.NM_CONTAINER_MONITOR_ENABLED,
+        YarnConfiguration.DEFAULT_NM_CONTAINER_MONITOR_ENABLED);
+  }
+
+  private boolean isResourceCalculatorAvailable() {
-            LOG.info("ResourceCalculatorPlugin is unavailable on this system. "
-                + this.getClass().getName() + " is disabled.");
-            return false;
-    }
-    if (ResourceCalculatorProcessTree.getResourceCalculatorProcessTree("0", processTreeClass, conf) == null) {
-        LOG.info("ResourceCalculatorProcessTree is unavailable on this system. "
-                + this.getClass().getName() + " is disabled.");
-            return false;
-    }
-    if (!(isPmemCheckEnabled() || isVmemCheckEnabled())) {
-      LOG.info("Neither virtual-memory nor physical-memory monitoring is " +
-          "needed. Not running the monitor-thread");
+      LOG.info("ResourceCalculatorPlugin is unavailable on this system. " + this
+          .getClass().getName() + " is disabled.");
-
+    if (ResourceCalculatorProcessTree
+        .getResourceCalculatorProcessTree("0", processTreeClass, conf)
+        == null) {
+      LOG.info("ResourceCalculatorProcessTree is unavailable on this system. "
+          + this.getClass().getName() + " is disabled.");
+      return false;
+    }
-            if (pId == null) {
+            if (pId == null || !isResourceCalculatorAvailable()) {

INS31 INS83 INS39 INS42 INS8 UPD42 INS41 INS32 INS42 INS42 INS40 INS40 UPD42 INS27 MOV27 INS38 INS32 INS42 DEL42 DEL32 DEL42 DEL32 DEL27 DEL36 DEL38 DEL42 DEL42 DEL45 DEL45 DEL27 DEL32 DEL21 DEL9 DEL41 DEL8 DEL25