YARN-3154. Added additional APIs in LogAggregationContext to avoid aggregating running logs of application when rolling is enabled. Contributed by Xuan Gong.

-import org.apache.hadoop.security.token.Token;
+  private final boolean logAggregationInRolling;
+    this.logAggregationInRolling =
+        this.rollingMonitorInterval <= 0 || this.logAggregationContext == null
+            || this.logAggregationContext.getRolledLogsIncludePattern() == null
+            || this.logAggregationContext.getRolledLogsIncludePattern()
+              .isEmpty() ? false : true;
-  private void uploadLogsForContainers() {
+  private void uploadLogsForContainers(boolean appFinished) {
-            aggregator.doContainerLogAggregation(writer);
+            aggregator.doContainerLogAggregation(writer, appFinished);
-          if (this.rollingMonitorInterval > 0) {
+          if (logAggregationInRolling) {
-            uploadLogsForContainers();
+            uploadLogsForContainers(false);
-    uploadLogsForContainers();
+    uploadLogsForContainers(true);
-    public Set<Path> doContainerLogAggregation(LogWriter writer) {
+    public Set<Path> doContainerLogAggregation(LogWriter writer,
+        boolean appFinished) {
-            this.uploadedFileMeta);
+            this.uploadedFileMeta, appFinished);

INS23 INS83 INS83 INS39 INS59 INS44 INS42 INS21 INS39 INS42 INS44 INS7 INS39 INS42 INS22 INS16 INS9 INS52 INS42 INS27 INS9 INS9 INS27 INS32 INS42 INS27 INS27 INS32 INS42 INS27 INS27 INS32 INS33 INS22 INS42 MOV22 INS34 INS22 INS33 INS22 INS42 INS52 INS42 INS42 INS42 INS52 INS42 INS52 INS42 INS9 DEL40 DEL26 DEL34 DEL27