YARN-3265. Fixed a deadlock in CapacityScheduler by always passing a queue's available resource-limit from the parent queue. Contributed by Wangda Tan.

-import org.junit.Assert;
-import org.apache.hadoop.yarn.api.protocolrecords.FinishApplicationMasterResponse;
+import org.junit.Assert;
+  private volatile AllocateResponse lastResponse;
-    return doAllocateAs(ugi, allocateRequest);
+    lastResponse = doAllocateAs(ugi, allocateRequest);
+    return lastResponse;
+  
+  public AllocateResponse doHeartbeat() throws Exception {
+    return allocate(null, null);
+  }

MOV26 INS23 INS31 INS83 INS83 INS43 INS59 INS83 INS43 INS42 INS43 INS8 INS42 INS42 INS21 INS42 INS42 INS41 INS7 INS42 INS32 INS42 MOV32 INS42 INS33 INS33 DEL40 DEL26