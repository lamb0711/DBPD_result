HDFS-3343. Improve metrics for DN read latency. Contributed by Andrew Wang.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1356928 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.EOFException;
+import org.apache.hadoop.hdfs.server.common.Util;
+  private DataNode datanode;
+      this.datanode = datanode;
-        // no need to flush. since we know out is not a buffered stream. 
-        sockOut.transferToFully(((FileInputStream)blockIn).getChannel(), 
-                                blockInPosition, dataLen);
+        // no need to flush since we know out is not a buffered stream
+        FileChannel fileCh = ((FileInputStream)blockIn).getChannel();
+        sockOut.transferToFully(fileCh, blockInPosition, dataLen, 
+            datanode.metrics.getSendDataPacketBlockedOnNetworkNanos(),
+            datanode.metrics.getSendDataPacketTransferNanos());

INS26 INS26 INS40 INS40 INS23 INS83 INS43 INS59 INS42 INS42 INS21 INS7 INS22 INS42 INS60 INS52 INS42 INS43 INS59 INS42 INS42 MOV32 INS42 INS32 INS32 INS40 INS42 INS40 INS42