HADOOP-16384: S3A: Avoid inconsistencies between DDB and S3.

Contributed by Steve Loughran

Contains

- HADOOP-16397. Hadoop S3Guard Prune command to support a -tombstone option.
- HADOOP-16406. ITestDynamoDBMetadataStore.testProvisionTable times out intermittently

This patch doesn't fix the underlying problem but it

* changes some tests to clean up better
* does a lot more in logging operations in against DDB, if enabled
* adds an entry point to dump the state of the metastore and s3 tables (precursor to fsck)
* adds a purge entry point to help clean up after a test run has got a store into a mess
* s3guard prune command adds -tombstone option to only clear tombstones

The outcome is that tests should pass consistently and if problems occur we have better diagnostics.

Change-Id: I3eca3f5529d7f6fec398c0ff0472919f08f054eb

-          child = new S3AFileStatus(located.getLen(),
-              located.getModificationTime(),
-              located.getPath(),
-              located.getBlockSize(),
-              located.getOwner(),
-              located.getETag(),
-              located.getVersionId());
+          child = located.toS3AFileStatus();
+
+    public static final String TOMBSTONE = "tombstone";
+
+        "[-" + TOMBSTONE + "]\n" +
-      super(conf);
+      super(conf, TOMBSTONE);
+      MetadataStore.PruneMode mode
+          = MetadataStore.PruneMode.ALL_BY_MODTIME;
+      if (getCommandFormat().getOpt(TOMBSTONE)) {
+        mode = MetadataStore.PruneMode.TOMBSTONES_BY_LASTUPDATED;
+      }
-        getStore().prune(MetadataStore.PruneMode.ALL_BY_MODTIME, divide,
+        getStore().prune(mode, divide,

INS23 INS83 INS83 INS83 INS43 INS59 INS42 INS42 INS45 INS60 INS25 INS45 INS42 INS45 INS42 INS43 INS59 INS32 INS8 INS40 INS42 INS40 INS32 INS42 INS42 INS21 INS42 INS7 INS42 INS40 INS42 INS32 MOV42 UPD42 MOV42 DEL42 DEL43 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL14 DEL40