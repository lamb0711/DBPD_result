HDFS-4563. Update namespace/diskspace usage after deleting snapshots.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1455396 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.hadoop.hdfs.protocol.NSQuotaExceededException;
+import org.apache.hadoop.hdfs.protocol.QuotaExceededException;
-import org.apache.hadoop.hdfs.server.namenode.INode.Content.CountsMap.Key;
+import org.apache.hadoop.hdfs.server.namenode.Content.CountsMap.Key;
-      throws NSQuotaExceededException {
+      throws QuotaExceededException {
-      throws NSQuotaExceededException {
+      throws QuotaExceededException {
-      throws NSQuotaExceededException {
+      throws QuotaExceededException {
-  public int cleanSubtree(final Snapshot snapshot, Snapshot prior,
+  public Quota.Counts cleanSubtree(final Snapshot snapshot, Snapshot prior,
-          throws NSQuotaExceededException {
+      throws QuotaExceededException {
-      return destroyAndCollectBlocks(collectedBlocks);
-    } else {
-      return 0;
+      destroyAndCollectBlocks(collectedBlocks);
+    return Quota.Counts.newInstance();
-  public int destroyAndCollectBlocks(BlocksMapUpdateInfo collectedBlocks) {
-    int total = 1;
+  public void destroyAndCollectBlocks(BlocksMapUpdateInfo collectedBlocks) {
-      total += ((FileWithSnapshot) this).getDiffs().clear();
+      ((FileWithSnapshot) this).getDiffs().clear();
-    return total;
-  final long diskspaceConsumed() {
+  public final long diskspaceConsumed() {

UPD40 UPD40 UPD43 UPD43 UPD43 INS43 UPD43 UPD39 INS83 UPD42 UPD42 UPD42 INS40 UPD42 INS41 INS32 INS21 INS40 INS42 MOV32 MOV32 DEL39 DEL41 DEL34 DEL41 DEL8 DEL39 DEL42 DEL34 DEL59 DEL60 DEL42 DEL7 DEL42 DEL41