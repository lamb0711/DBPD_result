HDFS-5042. Completed files lost after power failure. Contributed by Vinayakumar B.

+  private volatile boolean dirSyncOnFinalize;
+      // sync directory for finalize irrespective of syncOnClose config since
+      // sync is requested.
+      this.dirSyncOnFinalize = true;
+    dirSyncOnFinalize = syncOnClose;
-            datanode.data.finalizeBlock(block);
+            datanode.data.finalizeBlock(block, dirSyncOnFinalize);
-        datanode.data.finalizeBlock(block);
+        datanode.data.finalizeBlock(block, dirSyncOnFinalize);

INS23 INS83 INS83 INS39 INS59 INS42 INS21 INS7 INS21 INS42 INS42 INS7 INS22 INS9 INS52 INS42 INS42 INS42