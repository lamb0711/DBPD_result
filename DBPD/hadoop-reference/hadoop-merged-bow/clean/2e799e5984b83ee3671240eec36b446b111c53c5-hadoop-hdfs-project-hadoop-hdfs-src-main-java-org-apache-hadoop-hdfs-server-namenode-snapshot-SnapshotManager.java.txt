HDFS-6156. Simplify the JMX API that provides snapshot information. Contributed by Shinichi Yamashita.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1582847 13f79535-47bb-0310-9956-ffa450edef68

-  public SnapshotDirectoryMXBean getSnapshotStats() {
-    SnapshottableDirectoryStatus[] stats = getSnapshottableDirListing(null);
-    if (stats == null) {
-      return null;
+  public SnapshottableDirectoryStatus.Bean[]
+    getSnapshottableDirectories() {
+    List<SnapshottableDirectoryStatus.Bean> beans =
+        new ArrayList<SnapshottableDirectoryStatus.Bean>();
+    for (INodeDirectorySnapshottable d : getSnapshottableDirs()) {
+      beans.add(toBean(d));
-    return new SnapshotDirectoryMXBean(stats);
+    return beans.toArray(new SnapshottableDirectoryStatus.Bean[beans.size()]);
-  public class SnapshotDirectoryMXBean {
-    private List<SnapshottableDirectoryStatus.Bean> directory =
-        new ArrayList<SnapshottableDirectoryStatus.Bean>();
-    private List<SnapshotInfo.Bean> snapshots =
-        new ArrayList<SnapshotInfo.Bean>();
-
-    public SnapshotDirectoryMXBean(SnapshottableDirectoryStatus[] stats) {
-      set(stats);
-    }
-
-    public void set(SnapshottableDirectoryStatus[] stats) {
-      for (SnapshottableDirectoryStatus s : stats) {
-        directory.add(new SnapshottableDirectoryStatus.Bean(s));
-        try {
-          for (Snapshot shot : getSnapshottableRoot(
-              s.getFullPath().toString()).getSnapshotList()) {
-            snapshots.add(new SnapshotInfo.Bean(shot));
-          }
-        } catch (IOException e) {
-          continue;
-        }
+  @Override // SnapshotStatsMXBean
+  public SnapshotInfo.Bean[] getSnapshots() {
+    List<SnapshotInfo.Bean> beans = new ArrayList<SnapshotInfo.Bean>();
+    for (INodeDirectorySnapshottable d : getSnapshottableDirs()) {
+      for (Snapshot s : d.getSnapshotList()) {
+        beans.add(toBean(s));
+    return beans.toArray(new SnapshotInfo.Bean[beans.size()]);
+  }
-    public List<SnapshottableDirectoryStatus.Bean> getDirectory() {
-      return directory;
-    }
+  public static SnapshottableDirectoryStatus.Bean toBean(
+      INodeDirectorySnapshottable d) {
+    return new SnapshottableDirectoryStatus.Bean(
+        d.getFullPathName(),
+        d.getNumSnapshots(),
+        d.getSnapshotQuota(),
+        d.getModificationTime(),
+        Short.valueOf(Integer.toOctalString(
+            d.getFsPermissionShort())),
+        d.getUserName(),
+        d.getGroupName());
+  }
-    public List<SnapshotInfo.Bean> getSnapshots() {
-      return snapshots;
-    }
+  public static SnapshotInfo.Bean toBean(Snapshot s) {
+    return new SnapshotInfo.Bean(
+        s.getRoot().getLocalName(), s.getRoot().getFullPathName(),
+        s.getRoot().getModificationTime());

INS31 MOV31 MOV31 MOV31 MOV78 MOV83 INS5 UPD42 MOV42 INS8 INS78 INS5 INS42 INS83 INS43 INS42 INS44 INS83 INS43 INS42 INS44 INS8 INS43 INS85 INS60 INS70 INS41 INS42 UPD43 MOV43 MOV85 INS60 INS70 INS41 MOV40 INS43 INS42 INS40 INS43 INS42 INS41 INS40 MOV74 MOV59 INS44 INS32 INS8 INS32 INS40 MOV74 MOV59 MOV44 INS32 INS8 INS32 INS42 INS14 UPD42 MOV42 INS14 UPD42 INS43 INS42 UPD42 MOV42 INS21 INS42 INS42 INS3 UPD42 UPD43 UPD42 INS42 MOV70 INS42 INS42 INS3 MOV43 INS32 INS32 INS32 INS32 INS32 INS32 INS32 INS43 INS32 INS32 INS32 UPD42 MOV42 INS32 INS5 INS32 UPD42 INS5 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 MOV40 INS32 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS32 UPD43 MOV43 MOV85 UPD42 MOV42 UPD42 MOV42 UPD42 UPD42 MOV42 MOV43 INS85 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS40 INS42 INS42 UPD42 INS32 INS42 INS42 DEL42 DEL42 DEL39 DEL42 DEL5 DEL42 DEL44 DEL42 DEL42 DEL32 DEL42 DEL32 DEL32 DEL42 DEL14 DEL42 DEL42 DEL42 DEL42 DEL14 DEL32 DEL21 DEL8 DEL42 DEL43 DEL42 DEL44 DEL18 DEL8 DEL12 DEL54 DEL8 DEL70 DEL42 DEL43 DEL43 DEL74 DEL42 DEL42 DEL43 DEL43 DEL74 DEL42 DEL42 DEL41 DEL8 DEL42 DEL43 DEL43 DEL85 DEL5 DEL42 DEL33 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL33 DEL41 DEL8 DEL25 DEL42 DEL43 DEL42 DEL14 DEL41 DEL8 DEL31 DEL83 DEL42 DEL83 DEL23 DEL83 DEL23 DEL83 DEL42 DEL5 DEL42 DEL44 DEL32 DEL21 DEL8 DEL31 DEL55