HDFS-4760. Update inodeMap after node replacement.  Contributed by Jing Zhao


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1477827 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.namenode.INodeMap;
-  Snapshot addSnapshot(int id, String name)
-      throws SnapshotException, QuotaExceededException {
+  Snapshot addSnapshot(int id, String name) throws SnapshotException,
+      QuotaExceededException {
-    updateModificationTime(Time.now(), null);
-    s.getRoot().setModificationTime(getModificationTime(), null);
+    updateModificationTime(Time.now(), null, null);
+    s.getRoot().setModificationTime(getModificationTime(), null, null);
-  void replaceSelf(final Snapshot latest) throws QuotaExceededException {
+  INodeDirectory replaceSelf(final Snapshot latest, final INodeMap inodeMap)
+      throws QuotaExceededException {
-      replaceSelf4INodeDirectory();
+      return replaceSelf4INodeDirectory(inodeMap);
-      replaceSelf4INodeDirectoryWithSnapshot().recordModification(latest);
+      return replaceSelf4INodeDirectoryWithSnapshot(inodeMap)
+          .recordModification(latest, null);

INS26 INS40 INS43 INS44 INS42 INS83 INS43 INS42 INS42 INS33 INS33 INS41 INS41 INS32 INS32 MOV42 INS42 MOV32 MOV42 MOV42 INS33 INS42 DEL39 DEL32 DEL21 DEL32 DEL21