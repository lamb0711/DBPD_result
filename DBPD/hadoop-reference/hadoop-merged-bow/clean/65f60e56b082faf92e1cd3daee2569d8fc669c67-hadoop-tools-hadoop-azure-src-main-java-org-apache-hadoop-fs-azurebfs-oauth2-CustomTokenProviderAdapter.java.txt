HADOOP-16068. ABFS Authentication and Delegation Token plugins to optionally be bound to specific URI of the store.

Contributed by Steve Loughran.

+import java.net.URI;
+import org.apache.hadoop.conf.Configuration;
+import org.apache.hadoop.fs.azurebfs.extensions.BoundDTExtension;
+import org.apache.hadoop.fs.azurebfs.extensions.ExtensionHelper;
-public final class CustomTokenProviderAdapter extends AccessTokenProvider {
+public final class CustomTokenProviderAdapter extends AccessTokenProvider
+  implements BoundDTExtension {
-}
+
+  /**
+   * Bind to the filesystem by passing the binding call on
+   * to any custom token provider adaptee which implements
+   * {@link BoundDTExtension}.
+   * No-op if they don't.
+   * @param fsURI URI of the filesystem.
+   * @param conf configuration of this extension.
+   * @throws IOException failure.
+   */
+  @Override
+  public void bind(final URI fsURI,
+      final Configuration conf)
+      throws IOException {
+    ExtensionHelper.bind(adaptee, fsURI, conf);
+  }
+
+  @Override
+  public void close() {
+    ExtensionHelper.close(adaptee);
+  }
+
+  /**
+   * Get a suffix for the UserAgent suffix of HTTP requests, which
+   * can be used to identify the principal making ABFS requests.
+   *
+   * If the adaptee is a BoundDTExtension, it is queried for a UA Suffix;
+   * otherwise "" is returned.
+   *
+   * @return an empty string, or a key=value string to be added to the UA
+   * header.
+   */
+  public String getUserAgentSuffix() {
+    String suffix = ExtensionHelper.getUserAgentSuffix(adaptee, "");
+    return suffix != null ? suffix : "";
+  }
+}

INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS43 INS31 INS31 INS31 INS42 INS29 INS78 INS83 INS39 INS42 INS44 INS44 INS43 INS8 INS78 INS83 INS39 INS42 INS8 INS29 INS83 INS43 INS42 INS8 INS65 INS65 INS65 INS65 INS42 INS83 INS43 INS42 INS83 INS43 INS42 INS42 INS21 INS42 INS21 INS65 INS65 INS42 INS60 INS41 INS66 INS66 INS65 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS42 INS42 INS32 INS32 INS66 INS66 INS66 INS66 INS66 INS66 INS43 INS59 INS16 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS27 INS42 INS45 INS42 INS42 INS42 INS45 INS42 INS33