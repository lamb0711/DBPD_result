HDFS-4446. Support file snapshots with diff lists.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1443825 13f79535-47bb-0310-9956-ffa450edef68

-    getDiffs().addSnapshotDiff(s, this, true);
+    final DirectoryDiff d = getDiffs().addSnapshotDiff(s);
+    d.snapshotINode = s.getRoot();
-    final long timestamp = Time.now();
-    s.getRoot().updateModificationTime(timestamp, null);
-    updateModificationTime(timestamp, null);
+    updateModificationTime(Time.now(), null);
+    s.getRoot().setModificationTime(getModificationTime(), null);
-      replaceSelf4INodeDirectoryWithSnapshot(latest).recordModification(latest);
+      replaceSelf4INodeDirectoryWithSnapshot().recordModification(latest);

MOV21 INS60 INS21 INS83 INS43 INS59 INS7 INS42 INS42 INS32 INS40 INS32 MOV32 UPD42 INS32 MOV32 MOV42 MOV42 INS42 INS42 UPD42 MOV42 DEL52 DEL9 DEL32 DEL21 DEL83 DEL39 DEL42 DEL59 DEL60 DEL42 DEL42