HADOOP-15870. S3AInputStream.remainingInFile should use nextReadPos.

Contributed by lqjacklee.

Change-Id: I32bb00a683102e7ff8ff8ce0b8d9c3195ca7381c

-  public synchronized long getPos() throws IOException {
+  public synchronized long getPos() {
+  /**
+   * Return the number of bytes available.
+   * If the inner stream is closed, the value is 1 for consistency
+   * with S3ObjectStream -and so address the GZip bug
+   * http://bugs.java.com/bugdatabase/view_bug.do?bug_id=7036144 .
+   * If the stream is open, then it is the amount returned by the
+   * wrapped stream.
+   * @return a value greater than or equal to zero.
+   * @throws IOException IO failure.
+   */
-
-    long remaining = remainingInFile();
-    if (remaining > Integer.MAX_VALUE) {
-      return Integer.MAX_VALUE;
+    if (contentLength == 0 || (nextReadPos >= contentLength)) {
+      return 0;
-    return (int)remaining;
+
+    return wrappedStream == null
+        ? 1
+        : wrappedStream.available();
-  public synchronized long remainingInFile() {
-    return this.contentLength - this.pos;
+  public synchronized long remainingInFile() throws IOException {
+    return contentLength - getPos();
-    return this.contentRangeFinish - this.pos;
+    return contentRangeFinish - getPos();

INS29 MOV43 INS65 INS65 INS65 INS25 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS42 INS66 INS27 MOV8 INS16 INS27 INS36 INS27 INS34 INS32 INS42 INS32 INS42 INS32 INS42 INS34 INS27 INS34 INS42 INS33 INS42 INS42 INS42 INS42 UPD42 MOV42 INS42 DEL40 DEL39 DEL42 DEL42 DEL32 DEL59 DEL60 DEL40 DEL27 DEL25 DEL39 DEL42 DEL11 DEL52 DEL42 DEL22 DEL52 DEL42 DEL22 DEL52 DEL42 DEL22 DEL52 DEL42 DEL22