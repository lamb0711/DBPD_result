HDFS-8854. Erasure coding: add ECPolicy to replace schema+cellSize in hadoop-hdfs. Contributed by Walter Su.

-import org.apache.hadoop.io.erasurecode.ECSchema;
+import org.apache.hadoop.hdfs.protocol.ErasureCodingPolicy;
-  private final ECSchema schema;
+  private final ErasureCodingPolicy ecPolicy;
-      boolean verifyChecksum, ECSchema schema, int cellSize,
+      boolean verifyChecksum, ErasureCodingPolicy ecPolicy,
-    assert schema != null;
-    this.schema = schema;
-    this.cellSize = cellSize;
-    dataBlkNum = (short) schema.getNumDataUnits();
-    parityBlkNum = (short) schema.getNumParityUnits();
+    assert ecPolicy != null;
+    this.ecPolicy = ecPolicy;
+    this.cellSize = ecPolicy.getCellSize();
+    dataBlkNum = (short) ecPolicy.getNumDataUnits();
+    parityBlkNum = (short) ecPolicy.getNumParityUnits();
-    AlignedStripe[] stripes = StripedBlockUtil.divideOneStripe(schema, cellSize,
+    AlignedStripe[] stripes = StripedBlockUtil.divideOneStripe(ecPolicy, cellSize,
-        schema, cellSize, blockGroup, start, end, buf, offset);
+        ecPolicy, cellSize, blockGroup, start, end, buf, offset);

UPD40 UPD43 UPD42 UPD42 UPD43 UPD42 UPD42 UPD42 UPD42 INS32 UPD42 INS42 INS42 UPD42 UPD42 UPD42 UPD42 DEL39 DEL42 DEL44 DEL42