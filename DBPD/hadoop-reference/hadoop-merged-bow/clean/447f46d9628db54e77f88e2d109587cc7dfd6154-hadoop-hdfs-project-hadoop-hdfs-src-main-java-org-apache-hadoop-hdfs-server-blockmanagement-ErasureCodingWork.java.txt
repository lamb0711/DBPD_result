HDFS-14847. Erasure Coding: Blocks are over-replicated while EC decommissioning. Contributed by Fei Hui.

+    // Mark the block in normal node.
+    BlockInfoStriped block = (BlockInfoStriped)getBlock();
+    BitSet bitSet = new BitSet(block.getRealTotalBlockNum());
+    for (int i = 0; i < getSrcNodes().length; i++) {
+      if (getSrcNodes()[i].isInService()) {
+        bitSet.set(liveBlockIndicies[i]);
+      }
+    }
+    // If the block is on the node which is decommissioning or
+    // entering_maintenance, and it doesn't exist on other normal nodes,
+    // we just add the node into source list.
-      if (getSrcNodes()[i].isDecommissionInProgress() ||
+      if ((getSrcNodes()[i].isDecommissionInProgress() ||
-          getSrcNodes()[i].isAlive())) {
+          getSrcNodes()[i].isAlive())) &&
+          !bitSet.get(liveBlockIndicies[i])) {

INS60 INS60 INS24 INS43 INS59 INS43 INS59 INS58 INS27 INS37 INS8 INS42 INS42 INS11 INS42 INS42 INS14 INS39 INS59 INS42 INS22 INS42 INS25 INS43 INS32 INS43 INS32 INS42 INS34 INS32 INS42 INS32 INS8 INS27 INS42 INS42 INS42 INS42 INS42 INS42 INS2 INS42 INS21 INS36 INS38 INS32 INS42 INS32 MOV27 INS32 INS42 INS42 INS42 INS2 INS42 INS42 INS2 INS42 INS42 INS42 INS42