HDFS-7949. WebImageViewer need support file size calculation with striped blocks. Contributed by Rakesh R.

-import java.io.EOFException;
+import org.apache.hadoop.hdfs.protocol.HdfsConstants;
+import org.apache.hadoop.hdfs.protocol.proto.HdfsProtos.StripedBlockProto;
+import org.apache.hadoop.hdfs.util.StripedBlockUtil;
-    for (HdfsProtos.BlockProto p : f.getBlocksList()) {
-      size += p.getNumBytes();
+    if (f.hasStripedBlocks()) {
+      List<StripedBlockProto> blocksList = f.getStripedBlocks().getBlocksList();
+      // Get total of actual data block size
+      for (StripedBlockProto p : blocksList) {
+        // Total usage by this striped blocks should be the total of data
+        // blocks and parity blocks
+        size += StripedBlockUtil.spaceConsumedByStripedBlock(p.getBlock()
+            .getNumBytes(), p.getDataBlockNum(), p.getParityBlockNum(),
+            HdfsConstants.BLOCK_STRIPED_CELL_SIZE);
+      }
+    } else {
+      for (HdfsProtos.BlockProto p : f.getBlocksList()) {
+        size += p.getNumBytes();
+      }
+

MOV26 INS26 INS26 UPD40 INS40 INS40 INS8 MOV60 INS25 MOV41 INS32 INS8 MOV8 INS42 INS42 INS60 INS70 INS74 INS59 INS44 INS42 INS8 INS43 INS43 INS42 INS32 INS43 INS42 INS21 INS42 INS42 INS32 INS42 INS42 INS7 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS32 INS32 INS40 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42