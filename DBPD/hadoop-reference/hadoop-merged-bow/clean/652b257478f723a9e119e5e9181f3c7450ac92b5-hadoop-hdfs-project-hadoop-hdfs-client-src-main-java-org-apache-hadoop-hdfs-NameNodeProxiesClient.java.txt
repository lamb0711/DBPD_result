HDFS-14035. NN status discovery does not leverage delegation token. Contributed by Chen Liang.

-import java.util.concurrent.TimeUnit;
-import org.apache.hadoop.ha.protocolPB.HAServiceProtocolClientSideTranslatorPB;
-import org.apache.hadoop.ipc.Client;
-  /**
-   * Creates a non-HA proxy object with {@link HAServiceProtocol} to the
-   * given NameNode address, using the provided configuration. The proxy will
-   * use the RPC timeout configuration specified via {@link
-   * org.apache.hadoop.fs.CommonConfigurationKeys#IPC_CLIENT_RPC_TIMEOUT_KEY}.
-   * Upon failures, this will retry up to certain times with {@link RetryProxy}.
-   *
-   * @param address the NameNode address
-   * @param conf the configuration to be used
-   * @return a non-HA proxy with {@link HAServiceProtocol}.
-   */
-  public static HAServiceProtocol createNonHAProxyWithHAServiceProtocol(
-      InetSocketAddress address, Configuration conf) throws IOException {
-    RetryPolicy timeoutPolicy = RetryPolicies.exponentialBackoffRetry(
-        MAX_RETRIES, DELAY_MILLISECONDS, TimeUnit.MILLISECONDS);
-
-    HAServiceProtocol proxy =
-        new HAServiceProtocolClientSideTranslatorPB(
-            address, conf, NetUtils.getDefaultSocketFactory(conf),
-            Client.getRpcTimeout(conf));
-    return (HAServiceProtocol) RetryProxy.create(
-        HAServiceProtocol.class,
-        new DefaultFailoverProxyProvider<>(HAServiceProtocol.class, proxy),
-        new HashMap<>(),
-        timeoutPolicy
-    );
-  }
-

DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL66 DEL42 DEL65 DEL66 DEL66 DEL66 DEL40 DEL42 DEL67 DEL65 DEL66 DEL66 DEL42 DEL65 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL66 DEL42 DEL65 DEL66 DEL65 DEL29 DEL83 DEL83 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL42 DEL40 DEL32 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL14 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL42 DEL43 DEL57 DEL42 DEL43 DEL74 DEL42 DEL43 DEL57 DEL42 DEL14 DEL42 DEL43 DEL74 DEL14 DEL42 DEL32 DEL11 DEL41 DEL8 DEL31