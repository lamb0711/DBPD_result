HDDS-2047. Datanodes fail to come up after 10 retries in a secure envâ€¦ (#1379)


+import java.util.concurrent.TimeUnit;
+import org.apache.hadoop.io.retry.RetryPolicies;
+import org.apache.hadoop.io.retry.RetryPolicy;
-   * @param address - inet socket address of scm.
-      OzoneConfiguration conf, InetSocketAddress address) throws IOException {
+      OzoneConfiguration conf) throws IOException {
+    InetSocketAddress address =
+        getScmAddressForSecurityProtocol(conf);
+    RetryPolicy retryPolicy =
+        RetryPolicies.retryForeverWithFixedSleep(
+            1000, TimeUnit.MILLISECONDS);
-            RPC.getProxy(SCMSecurityProtocolPB.class, scmVersion,
+            RPC.getProtocolProxy(SCMSecurityProtocolPB.class, scmVersion,
-                Client.getRpcTimeout(conf)));
+                Client.getRpcTimeout(conf), retryPolicy).getProxy());

INS26 INS26 INS26 INS40 INS40 INS40 INS60 INS60 MOV43 INS59 INS43 INS59 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS34 INS40 INS32 MOV32 INS42 UPD42 INS42 DEL42 DEL66 DEL65 DEL42 DEL44