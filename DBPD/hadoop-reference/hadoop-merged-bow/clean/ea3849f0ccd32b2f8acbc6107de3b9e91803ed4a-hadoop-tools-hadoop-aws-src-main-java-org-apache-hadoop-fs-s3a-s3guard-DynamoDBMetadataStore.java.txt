HADOOP-14759 S3GuardTool prune to prune specific bucket entries. Contributed by Gabor Bota.

-  private ItemCollection<ScanOutcome> expiredFiles(long modTime) {
-    String filterExpression = "mod_time < :mod_time";
+  private ItemCollection<ScanOutcome> expiredFiles(long modTime,
+      String keyPrefix) {
+    String filterExpression =
+        "mod_time < :mod_time and begins_with(parent, :parent)";
-    ValueMap map = new ValueMap().withLong(":mod_time", modTime);
+    ValueMap map = new ValueMap()
+        .withLong(":mod_time", modTime)
+        .withString(":parent", keyPrefix);
+    prune(modTime, "/");
+  }
+
+  @Override
+  @Retries.OnceRaw("once(batchWrite)")
+  public void prune(long modTime, String keyPrefix) throws IOException {
-      for (Item item : expiredFiles(modTime)) {
+      for (Item item : expiredFiles(modTime, keyPrefix)) {

INS31 INS44 INS78 INS79 INS83 INS39 INS42 INS44 INS43 INS8 INS44 MOV43 INS42 INS42 INS40 INS45 INS39 INS42 INS42 INS21 INS43 INS42 INS43 INS32 INS42 INS42 UPD45 INS32 INS42 INS42 INS45 MOV32 INS42 INS45 INS42 INS42