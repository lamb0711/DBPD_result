 HDDS-1501 : Create a Recon task interface to update internal DB on updates from OM. (#819)


+import java.io.IOException;
-                .packages("org.apache.hadoop.ozone.recon.api");
+              .packages("org.apache.hadoop.ozone.recon.api");
-    // Schedule the task to read OM DB and write the reverse mapping to Recon
-    // container DB.
-    ContainerKeyMapperTask containerKeyMapperTask = new ContainerKeyMapperTask(
-        ozoneManagerServiceProvider, containerDBServiceProvider);
-    scheduler.scheduleWithFixedDelay(containerKeyMapperTask, initialDelay,
-        interval, TimeUnit.MILLISECONDS);
+
+    scheduler.scheduleWithFixedDelay(() -> {
+      try {
+        ozoneManagerServiceProvider.updateReconOmDBWithNewSnapshot();
+        // Schedule the task to read OM DB and write the reverse mapping to
+        // Recon container DB.
+        ContainerKeyMapperTask containerKeyMapperTask =
+            new ContainerKeyMapperTask(containerDBServiceProvider,
+                ozoneManagerServiceProvider.getOMMetadataManagerInstance());
+        containerKeyMapperTask.reprocess(
+            ozoneManagerServiceProvider.getOMMetadataManagerInstance());
+      } catch (IOException e) {
+        LOG.error("Unable to get OM " +
+            "Snapshot", e);
+      }
+    }, initialDelay, interval, TimeUnit.MILLISECONDS);

INS26 INS40 INS21 INS32 INS42 INS42 INS86 MOV42 MOV42 MOV40 INS8 INS54 INS8 INS12 INS21 MOV60 INS21 INS44 INS8 INS32 MOV43 INS32 INS43 INS42 INS21 INS42 INS42 INS42 INS42 INS32 INS42 INS32 MOV43 UPD42 INS32 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS27 INS42 INS42 INS42 INS45 INS45 DEL42 DEL42 DEL32 DEL21