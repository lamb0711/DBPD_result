HDFS-5634. Allow BlockReaderLocal to switch between checksumming and not (cmccabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1551701 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.EOFException;
+import java.nio.ByteBuffer;
+import java.nio.channels.FileChannel;
- 
+  /**
+   * Read the header without changing the position of the FileChannel.
+   *
+   * @param fc The FileChannel to read.
+   * @return the Metadata Header.
+   * @throws IOException on error.
+   */
+  public static BlockMetadataHeader preadHeader(FileChannel fc)
+      throws IOException {
+    byte arr[] = new byte[2 + DataChecksum.HEADER_LEN];
+    ByteBuffer buf = ByteBuffer.wrap(arr);
+
+    while (buf.hasRemaining()) {
+      if (fc.read(buf, 0) <= 0) {
+        throw new EOFException("unexpected EOF while reading " +
+            "metadata file header");
+      }
+    }
+    short version = (short)((arr[0] << 8) | (arr[1] & 0xff));
+    DataChecksum dataChecksum = DataChecksum.newDataChecksum(arr, 2);
+    return new BlockMetadataHeader(version, dataChecksum);
+  }
+

INS26 INS26 INS26 INS40 INS40 INS40 INS31 INS29 INS83 INS83 INS43 INS42 INS44 INS43 INS8 INS65 INS65 INS65 INS65 INS42 INS43 INS42 INS42 INS60 INS60 INS61 INS60 INS60 INS41 INS66 INS42 INS66 INS66 INS42 INS66 INS42 INS39 INS59 INS43 INS59 INS32 INS8 INS39 INS59 INS43 INS59 INS14 INS42 INS85 INS3 INS42 INS42 INS32 INS42 INS42 INS25 INS42 INS11 INS42 INS42 INS32 INS43 INS42 INS42 INS5 INS27 INS42 INS42 INS42 INS27 INS8 INS39 INS36 INS42 INS42 INS42 INS34 INS42 INS39 INS85 INS34 INS40 INS32 INS34 INS53 INS27 INS42 INS42 INS42 INS34 INS14 INS36 INS36 INS43 INS27 INS27 INS27 INS42 INS45 INS45 INS2 INS34 INS2 INS34 INS42 INS34 INS42 INS34