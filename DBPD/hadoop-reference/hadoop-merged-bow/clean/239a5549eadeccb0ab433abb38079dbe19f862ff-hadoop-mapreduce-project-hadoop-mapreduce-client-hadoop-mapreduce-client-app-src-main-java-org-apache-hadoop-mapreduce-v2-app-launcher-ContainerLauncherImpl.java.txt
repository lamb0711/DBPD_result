MAPREDUCE-3616. Thread pool for launching containers in MR AM not expanding as expected. (Contributed by Vinod Kumar Vavilapalli) 


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1229394 13f79535-47bb-0310-9956-ffa450edef68

-  private ThreadPoolExecutor launcherPool;
-  private static final int INITIAL_POOL_SIZE = 10;
+  protected ThreadPoolExecutor launcherPool;
+  protected static final int INITIAL_POOL_SIZE = 10;
+    LOG.info("Upper limit on the thread pool size is " + this.limitOnPoolSize);
-            if (poolSize <= idealPoolSize) {
+            if (poolSize < idealPoolSize) {
-              int newPoolSize = idealPoolSize + INITIAL_POOL_SIZE;
-              LOG.info("Setting ContainerLauncher pool size to "
-                  + newPoolSize);
+              int newPoolSize = Math.min(limitOnPoolSize, idealPoolSize
+                  + INITIAL_POOL_SIZE);
+              LOG.info("Setting ContainerLauncher pool size to " + newPoolSize
+                  + " as number-of-nodes to talk to is " + numNodes);
-          launcherPool.execute(new EventProcessor(event));
+          launcherPool.execute(createEventProcessor(event));
+  protected EventProcessor createEventProcessor(ContainerLauncherEvent event) {
+    return new EventProcessor(event);
+  }
+
-    this.allNodes.add(containerManagerBindAddr);
-
-  private class EventProcessor implements Runnable {
+  class EventProcessor implements Runnable {
-          // Interruped during getProxy, but that didn't throw exception
+          // Interrupted during getProxy, but that didn't throw exception
+      this.allNodes.add(event.getContainerMgrAddress());

INS31 UPD83 UPD83 INS83 INS43 INS42 INS44 INS8 INS21 INS42 INS43 INS42 INS41 INS32 INS42 MOV14 INS42 INS42 INS27 MOV21 INS45 INS22 INS52 INS42 INS32 INS42 UPD42 MOV42 INS32 UPD27 INS42 INS42 INS32 INS42 INS42 INS42 MOV27 INS45 INS42 DEL83