commit correct version of HDFS-5121

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-4949@1520090 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.IOException;
+import org.apache.hadoop.hdfs.protocol.CachePoolInfo;
-   * Check if this CachePool can be accessed.
+   * Whether a cache pool can be accessed by the current context
-   * @param pc
-   *          Permission checker object with user name and groups.
-   * @param write
-   *          True if we care about write access; false otherwise.
-   * @return
-   *          True only if the cache pool is accessible.
+   * @param pool CachePool being accessed
+   * @param access type of action being performed on the cache pool
+   * @return if the pool can be accessed
-  private boolean checkPermission(String userName, 
-      String groupName, int mode, int mask) {
-    if ((mode & mask) != 0) {
+  public boolean checkPermission(CachePool pool, FsAction access) {
+    CachePoolInfo info = pool.getInfo();
+    FsPermission mode = info.getMode();
+    if (isSuperUser()) {
-    if (((mode & (mask << 6)) != 0) 
-        && (getUser().equals(userName))) {
+    if (user.equals(info.getOwnerName())
+        && mode.getUserAction().implies(access)) {
-    if (((mode & (mask << 6)) != 0) 
-        && (containsGroup(groupName))) {
+    if (groups.contains(info.getGroupName())
+        && mode.getGroupAction().implies(access)) {
+      return true;
+    }
+    if (mode.getOtherAction().implies(access)) {
-
-  public boolean checkWritePermission(String userName,
-      String groupName, int mode) {
-    return checkPermission(userName, groupName, mode, 02);
-  }
-
-  public boolean checkReadPermission(String userName,
-      String groupName, int mode) {
-    return checkPermission(userName, groupName, mode, 04);
-  }

MOV26 UPD40 INS31 MOV29 UPD83 MOV83 MOV39 MOV42 MOV44 MOV44 INS8 UPD43 UPD42 UPD43 UPD42 INS60 INS60 INS25 INS25 INS25 INS25 MOV41 UPD66 UPD42 UPD66 UPD42 UPD66 UPD66 UPD42 UPD42 INS43 INS59 INS43 INS59 INS32 MOV8 INS27 MOV8 INS27 MOV8 INS32 INS8 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS32 INS32 INS32 INS32 INS32 INS42 INS42 MOV41 INS42 INS42 INS42 INS42 UPD42 MOV42 MOV42 INS32 INS32 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS32 INS32 UPD42 MOV42 UPD42 MOV42 MOV42 INS42 INS9 INS42 UPD42 MOV42 INS42 INS42 INS42 INS42 INS42 UPD42 MOV42 DEL42 DEL42 DEL42 DEL42 DEL34 DEL32 DEL39 DEL42 DEL44 DEL39 DEL42 DEL44 DEL42 DEL42 DEL27 DEL36 DEL34 DEL27 DEL25 DEL42 DEL42 DEL34 DEL27 DEL36 DEL27 DEL36 DEL34 DEL27 DEL36 DEL32 DEL32 DEL36 DEL27 DEL25 DEL42 DEL42 DEL34 DEL27 DEL36 DEL27 DEL36 DEL34 DEL27 DEL36 DEL32 DEL36 DEL27 DEL25 DEL8 DEL31 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL39 DEL42 DEL44 DEL34 DEL32 DEL41 DEL8 DEL31 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL39 DEL42 DEL44 DEL8 DEL31