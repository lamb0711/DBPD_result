Merge trunk to branch.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/fs-encryption@1608603 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.NameNodeProxies.ProxyAndInfo;
+    List<ProxyAndInfo<ClientProtocol>> proxies =
+        getProxiesForAllNameNodesInNameservice(conf, nsId, ClientProtocol.class);
+
+    List<ClientProtocol> namenodes = new ArrayList<ClientProtocol>(
+        proxies.size());
+    for (ProxyAndInfo<ClientProtocol> proxy : proxies) {
+      namenodes.add(proxy.getProxy());
+    }
+    return namenodes;
+  }
+
+  /**
+   * Get an RPC proxy for each NN in an HA nameservice. Used when a given RPC
+   * call should be made on every NN in an HA nameservice, not just the active.
+   *
+   * @param conf configuration
+   * @param nsId the nameservice to get all of the proxies for.
+   * @param xface the protocol class.
+   * @return a list of RPC proxies for each NN in the nameservice.
+   * @throws IOException in the event of error.
+   */
+  public static <T> List<ProxyAndInfo<T>> getProxiesForAllNameNodesInNameservice(
+      Configuration conf, String nsId, Class<T> xface) throws IOException {
-    List<ClientProtocol> namenodes = new ArrayList<ClientProtocol>();
+    List<ProxyAndInfo<T>> proxies = new ArrayList<ProxyAndInfo<T>>(
+        nnAddresses.size());
-      NameNodeProxies.ProxyAndInfo<ClientProtocol> proxyInfo = null;
+      NameNodeProxies.ProxyAndInfo<T> proxyInfo = null;
-          nnAddress, ClientProtocol.class,
+          nnAddress, xface,
-      namenodes.add(proxyInfo.getProxy());
+      proxies.add(proxyInfo);
-    return namenodes;
+    return proxies;

INS26 INS40 INS31 INS8 INS29 INS83 INS83 INS73 INS74 INS42 INS44 INS44 INS44 INS43 INS8 INS60 MOV60 INS70 MOV41 INS65 INS65 INS65 INS65 INS65 INS65 INS42 INS43 INS74 INS43 INS42 INS43 INS42 INS74 INS42 INS42 MOV60 INS60 INS70 INS41 INS74 INS59 INS44 INS42 INS8 INS66 INS66 INS42 INS66 INS42 INS66 INS42 INS66 INS66 INS42 INS66 INS42 INS43 INS43 INS42 INS42 INS43 INS43 INS74 INS59 MOV44 MOV32 INS8 INS42 INS43 INS74 INS42 INS32 INS74 INS42 MOV21 INS42 INS42 INS42 INS42 INS43 INS74 INS42 INS14 MOV60 INS21 INS21 INS42 INS43 INS43 UPD42 MOV42 MOV42 UPD42 MOV42 MOV57 INS32 INS43 MOV43 INS42 INS43 INS43 INS74 INS32 UPD74 INS7 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS74 INS42 INS42 INS43 INS42 INS32 INS42 INS42 INS42 UPD42 INS42 INS43 INS43 INS42 INS42 INS42 INS42 INS42 INS42 MOV32 INS9 INS42 INS42 DEL42 DEL42 DEL9 DEL32 DEL7 DEL21 DEL8 DEL70 DEL8