Merge trunk into QJM branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3077@1367365 13f79535-47bb-0310-9956-ffa450edef68

-    if (scheme == null) {                       // no scheme: use default FS
+    if (scheme == null && authority == null) {     // use default FS
-    if (authority == null) {                       // no authority
+    if (scheme != null && authority == null) {     // no authority
+  
+  /**
+   * Cancel the deletion of the path when the FileSystem is closed
+   * @param f the path to cancel deletion
+   */
+  public boolean cancelDeleteOnExit(Path f) {
+    synchronized (deleteOnExit) {
+      return deleteOnExit.remove(f);
+    }
+  }
-          delete(path, true);
+          if (exists(path)) {
+            delete(path, true);
+          }

INS31 INS29 INS83 INS39 INS42 INS44 INS8 INS65 INS65 INS43 INS42 INS51 INS27 INS27 INS66 INS42 INS66 INS42 INS42 INS8 MOV27 MOV27 INS27 INS27 INS41 INS42 INS33 INS42 INS33 MOV42 MOV33 INS32 INS42 INS42 INS42 INS8 INS25 INS32 MOV8 INS42 INS42