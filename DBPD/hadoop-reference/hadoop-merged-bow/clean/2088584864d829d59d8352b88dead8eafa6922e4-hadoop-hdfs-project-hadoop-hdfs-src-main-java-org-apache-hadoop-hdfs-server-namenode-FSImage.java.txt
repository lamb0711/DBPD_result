HDFS-5980. Rollback does not need to load edits.  Contributed by jing9


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1570078 13f79535-47bb-0310-9956-ffa450edef68

-    loadEdits(editStreams, target, startOpt, recovery);
-    if (rollingRollback) {
-      // Trigger the rollback for rolling upgrade. 
-      // Here lastAppliedTxId == (markerTxId - 1), and we should decrease 1 from
-      // lastAppliedTxId for the start-segment transaction.
-      rollingRollback(lastAppliedTxId--, imageFiles.get(0).getCheckpointTxId());
-      needToSave = false;
-    } else {
+    if (!rollingRollback) {
+      loadEdits(editStreams, target, startOpt, recovery);
+    } else {
+      // Trigger the rollback for rolling upgrade. Here lastAppliedTxId equals
+      // to the last txid in rollback fsimage.
+      rollingRollback(lastAppliedTxId + 1, imageFiles.get(0).getCheckpointTxId());
+      needToSave = false;
-        boolean rollingRollback = StartupOption
-            .isRollingUpgradeRollback(startOpt);
-        if (editIn.getLastTxId() != HdfsConstants.INVALID_TXID
-            && !rollingRollback) {
+        if (editIn.getLastTxId() != HdfsConstants.INVALID_TXID) {

MOV8 MOV38 MOV21 INS27 INS42 INS34 MOV27 DEL42 DEL42 DEL37 DEL39 DEL42 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL27