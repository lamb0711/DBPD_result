HDFS-6300. Prevent multiple balancers from running simultaneously (Contributed by Rakesh R)

-      final FSDataOutputStream out = fs.create(idPath);
-      if (write2IdFile) {
-        out.writeBytes(InetAddress.getLocalHost().getHostName());
-        out.hflush();
+      if (fs.exists(idPath)) {
+        // try appending to it so that it will fail fast if another balancer is
+        // running.
+        IOUtils.closeStream(fs.append(idPath));
+        fs.delete(idPath, true);
-      return out;
+      final FSDataOutputStream fsout = fs.create(idPath, false);
+      // mark balancer idPath to be deleted during filesystem closure
+      fs.deleteOnExit(idPath);
+      if (write2IdFile) {
+        fsout.writeBytes(InetAddress.getLocalHost().getHostName());
+        fsout.hflush();
+      }
+      return fsout;

INS25 INS21 INS32 INS8 INS32 UPD42 INS42 INS42 INS42 INS21 INS21 UPD42 INS42 INS42 INS42 INS32 INS32 INS9 INS42 INS42 INS32 INS42 INS42 INS42 INS9 UPD42 UPD42 INS42 INS42 INS42