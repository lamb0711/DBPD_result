YARN-4888. Changes in scheduler to identify resource-requests explicitly by allocation-id. (Subru Krishnan via wangda)

-
-  public static final SchedulerRequestKey UNDEFINED =
-      new SchedulerRequestKey(Priority.UNDEFINED);
+  private final long allocationRequestId;
-    return new SchedulerRequestKey(req.getPriority());
+    return new SchedulerRequestKey(req.getPriority(),
+        req.getAllocationRequestId());
-    return new SchedulerRequestKey(container.getPriority());
+    return new SchedulerRequestKey(container.getPriority(),
+        container.getAllocationRequestId());
-  private SchedulerRequestKey(Priority priority) {
+  private SchedulerRequestKey(Priority priority, long allocationRequestId) {
+    this.allocationRequestId = allocationRequestId;
+  /**
+   * Get the Id of the associated {@link ResourceRequest}.
+   *
+   * @return the Id of the associated {@link ResourceRequest}
+   */
+  public long getAllocationRequestId() {
+    return allocationRequestId;
+  }
+
-    return o.getPriority().compareTo(priority);
+    int priorityCompare = o.getPriority().compareTo(priority);
+    // we first sort by priority and then by allocationRequestId
+    if (priorityCompare != 0) {
+      return priorityCompare;
+    }
+    return Long.compare(allocationRequestId, o.getAllocationRequestId());
-    return getPriority().equals(that.getPriority());
+    if (getAllocationRequestId() != that.getAllocationRequestId()) {
+      return false;
+    }
+    return getPriority() != null ?
+        getPriority().equals(that.getPriority()) :
+        that.getPriority() == null;
-    return getPriority().hashCode();
+    int result = getPriority() != null ? getPriority().hashCode() : 0;
+    result = 31 * result + (int) (getAllocationRequestId() ^ (
+        getAllocationRequestId() >>> 32));
+    return result;

INS23 INS31 UPD83 MOV83 MOV83 INS39 INS59 INS44 INS29 INS83 INS39 INS42 INS8 INS42 INS39 INS42 INS21 INS65 INS65 INS41 INS60 INS25 INS41 INS25 INS60 INS21 INS7 INS66 INS65 INS66 INS66 INS65 INS42 INS39 INS59 INS27 INS8 INS32 INS27 INS8 INS16 INS39 INS59 INS7 INS42 INS32 INS32 INS22 INS42 INS42 INS42 INS42 MOV32 INS42 INS34 MOV41 INS42 INS42 INS42 INS32 INS32 INS32 INS41 INS27 MOV32 INS27 INS42 INS16 INS42 INS27 INS42 INS42 INS42 INS42 INS52 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS9 INS32 INS33 INS32 INS33 INS27 MOV32 INS34 INS27 INS11 INS42 INS42 INS42 INS32 INS33 INS34 INS42 INS39 INS36 INS42 INS27 INS32 INS36 INS42 INS27 INS32 INS34 INS42 DEL83 DEL42 DEL43 DEL42 DEL42 DEL43 DEL40 DEL14 DEL59 DEL23