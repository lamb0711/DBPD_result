Merge trunk into auto-HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3042@1333291 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.IOException;
-    this.conf = new Configuration();
-    // force the resolution of the configuration files
-    // this is required if we want the factory to be able to handle
-    // file:// URLs
-    this.conf.getClass("fs.file.impl", null);
-    this.handler = new FsUrlStreamHandler(this.conf);
+    this(new Configuration());
-    // force the resolution of the configuration files
-    this.conf.getClass("fs.file.impl", null);
-      boolean known =
-          (conf.getClass("fs." + protocol + ".impl", null) != null);
+      boolean known = true;
+      try {
+        FileSystem.getFileSystemClass(protocol, conf);
+      }
+      catch (IOException ex) {
+        known = false;
+      }

INS26 INS40 INS17 MOV14 INS60 INS54 MOV39 INS59 INS8 INS12 MOV42 INS9 INS21 INS44 INS8 INS32 INS43 INS42 INS21 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS42 INS7 INS42 INS9 DEL52 DEL42 DEL22 DEL7 DEL21 DEL52 DEL42 DEL22 DEL42 DEL45 DEL33 DEL32 DEL21 DEL52 DEL42 DEL22 DEL42 DEL43 DEL52 DEL42 DEL22 DEL14 DEL7 DEL21 DEL52 DEL42 DEL22 DEL42 DEL45 DEL33 DEL32 DEL21 DEL45 DEL42 DEL45 DEL27 DEL33 DEL32 DEL33 DEL27 DEL36 DEL59 DEL60