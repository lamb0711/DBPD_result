Merge trunk into HDFS-347 branch.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-347@1446832 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.FileNotFoundException;
+
- * An id which uniquely identifies an inode
+ * An id which uniquely identifies an inode. Id 1 to 1000 are reserved for
+ * potential future usage. The id won't be recycled and is not expected to wrap
+ * around in a very long time. Root inode id is always 1001. Id 0 is used for
+ * backward compatibility support.
-class INodeId extends SequentialNumber {
+public class INodeId extends SequentialNumber {
-   * The last reserved inode id. Reserve id 1 to 1000 for potential future
-   * usage. The id won't be recycled and is not expected to wrap around in a
-   * very long time. Root inode id will be 1001.
+   * The last reserved inode id. 
+  /**
+   * To check if the request id is the same as saved id. Don't check fileId
+   * with GRANDFATHER_INODE_ID for backward compatibility.
+   */
+  public static void checkId(long requestId, INode inode)
+      throws FileNotFoundException {
+    if (requestId != GRANDFATHER_INODE_ID && requestId != inode.getId()) {
+      throw new FileNotFoundException(
+          "ID mismatch. Request id and saved id: " + requestId + " , "
+              + inode.getId());
+    }
+  }
+  

INS26 INS40 INS83 INS31 INS29 INS83 INS83 INS39 INS42 INS44 INS44 INS43 INS8 UPD66 INS66 INS66 INS66 INS65 INS39 INS42 INS43 INS42 INS42 INS25 UPD66 INS66 INS66 INS42 INS27 INS8 INS27 INS27 INS53 INS42 INS42 INS42 INS32 INS14 INS42 INS42 INS43 INS27 INS42 INS45 INS42 INS45 INS32 INS42 INS42 DEL66 DEL66