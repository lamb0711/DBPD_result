HDFS-8647. Abstract BlockManager's rack policy into BlockPlacementPolicy. (Brahma Reddy Battula via mingma)

-  public static final Log LOG = 
+  public static final Log LOG =
-    
+
+
+  /**
+   * Whether or not this cluster has ever consisted of more than 1 rack,
+   * according to the NetworkTopology.
+   */
+  private boolean clusterEverBeenMultiRack = false;
+
-          numOfRacks++;
+          incrementRacks();
-  
+
+  protected void incrementRacks() {
+    numOfRacks++;
+    if (!clusterEverBeenMultiRack && numOfRacks > 1) {
+      clusterEverBeenMultiRack = true;
+    }
+  }
+
-  
+
+  /**
+   * @return true if this cluster has ever consisted of multiple racks, even if
+   *         it is not now a multi-rack cluster.
+   */
+  public boolean hasClusterEverBeenMultiRack() {
+    return clusterEverBeenMultiRack;
+  }
+
-   * 
+   *

INS23 INS31 INS31 INS29 INS83 INS39 INS59 INS83 INS39 INS42 INS8 INS29 INS83 INS39 INS42 INS8 INS65 INS42 INS9 MOV21 INS25 INS65 INS41 INS66 INS66 INS27 INS8 INS66 INS66 INS42 INS38 INS27 INS21 INS42 INS42 INS34 INS7 INS42 INS9 INS21 INS32 INS42