HADOOP-9676.  Make maximum RPC buffer size configurable (Colin Patrick McCabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1498737 13f79535-47bb-0310-9956-ffa450edef68

+  private final int maxDataLength;
-    
+
+    private void checkDataLength(int dataLength) throws IOException {
+      if (dataLength < 0) {
+        String error = "Unexpected data length " + dataLength +
+                       "!! from " + getHostAddress();
+        LOG.warn(error);
+        throw new IOException(error);
+      } else if (dataLength > maxDataLength) {
+        String error = "Requested data length " + dataLength +
+              " is longer than maximum configured RPC length " + 
+            maxDataLength + ".  RPC came from " + getHostAddress();
+        LOG.warn(error);
+        throw new IOException(error);
+      }
+    }
+
-          
-          if (dataLength < 0) {
-            LOG.warn("Unexpected data length " + dataLength + "!! from " + 
-                getHostAddress());
-          }
+          checkDataLength(dataLength);
+    this.maxDataLength = conf.getInt(CommonConfigurationKeys.IPC_MAXIMUM_DATA_LENGTH,
+        CommonConfigurationKeys.IPC_MAXIMUM_DATA_LENGTH_DEFAULT);

INS23 INS83 INS83 INS39 INS59 INS31 INS42 INS83 INS39 INS42 INS44 INS43 INS8 INS21 INS39 INS42 INS42 INS25 INS7 MOV27 INS8 INS25 INS22 INS32 INS60 INS21 INS53 INS27 INS8 INS52 INS42 INS42 INS42 INS40 INS40 INS43 INS59 INS32 INS14 INS42 INS42 INS60 INS21 INS53 INS42 INS42 MOV27 INS42 INS42 INS42 INS43 INS42 INS43 INS59 INS32 INS14 MOV21 INS42 INS42 INS42 INS27 INS42 INS42 INS42 INS43 INS42 INS45 INS42 INS45 INS42 INS45 INS32 INS42 UPD42 UPD42 INS42 DEL8 DEL25