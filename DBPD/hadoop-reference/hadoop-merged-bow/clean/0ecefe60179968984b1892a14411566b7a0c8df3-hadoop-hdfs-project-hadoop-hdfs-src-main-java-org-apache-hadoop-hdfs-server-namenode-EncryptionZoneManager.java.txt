HDFS-7078. Fix listEZs to work correctly with snapshots. (wang)

-      zones.add(new EncryptionZone(getFullPathName(ezi),
+      /*
+       Skip EZs that are only present in snapshots. Re-resolve the path to 
+       see if the path's current inode ID matches EZ map's INode ID.
+       
+       INode#getFullPathName simply calls getParent recursively, so will return
+       the INode's parents at the time it was snapshotted. It will not 
+       contain a reference INode.
+      */
+      final String pathName = getFullPathName(ezi);
+      INodesInPath iip = dir.getINodesInPath(pathName, false);
+      INode lastINode = iip.getLastINode();
+      if (lastINode == null || lastINode.getId() != ezi.getINodeId()) {
+        continue;
+      }
+      // Add the EZ to the result list
+      zones.add(new EncryptionZone(pathName,

INS60 INS60 INS60 INS25 INS83 INS43 INS59 INS43 INS59 INS43 INS59 INS27 INS8 INS42 INS42 MOV32 INS42 INS42 INS32 INS42 INS42 INS32 INS27 INS27 INS18 INS42 INS42 INS42 INS9 INS42 INS42 INS42 INS33 INS32 INS32 INS42 INS42 INS42 INS42 INS42