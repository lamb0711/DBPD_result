YARN-7666. Introduce scheduler specific environment variable support in ApplicationSubmissionContext for better scheduling placement configurations. (Sunil G via wangda)

Change-Id: I0fd826490f5160d47d42af2a9ac0bd8ec4e959dc

+import org.apache.hadoop.yarn.server.resourcemanager.scheduler.common.ApplicationSchedulingConfig;
-import org.apache.hadoop.yarn.server.resourcemanager.scheduler.placement.LocalityAppPlacementAllocator;
+  public final Map<String, String> applicationSchedulingEnvs = new HashMap<>();
-  public AppSchedulingInfo(ApplicationAttemptId appAttemptId,
-      String user, Queue queue, AbstractUsersManager abstractUsersManager,
-      long epoch, ResourceUsage appResourceUsage) {
+  public AppSchedulingInfo(ApplicationAttemptId appAttemptId, String user,
+      Queue queue, AbstractUsersManager abstractUsersManager, long epoch,
+      ResourceUsage appResourceUsage,
+      Map<String, String> applicationSchedulingEnvs) {
+    this.applicationSchedulingEnvs.putAll(applicationSchedulingEnvs);
-        dedupRequests.entrySet()) {
+    dedupRequests.entrySet()) {
-      if (!schedulerKeyToAppPlacementAllocator.containsKey(
-          schedulerRequestKey)) {
+      if (!schedulerKeyToAppPlacementAllocator
+          .containsKey(schedulerRequestKey)) {
+        AppPlacementAllocator<SchedulerNode> placementAllocatorInstance = ApplicationPlacementFactory
+            .getAppPlacementAllocator(applicationSchedulingEnvs
+                .get(ApplicationSchedulingConfig.ENV_APPLICATION_PLACEMENT_TYPE_CLASS));
+        placementAllocatorInstance.setAppSchedulingInfo(this);
+
-            new LocalityAppPlacementAllocator<>(this));
+            placementAllocatorInstance);
-      PendingAskUpdateResult pendingAmountChanges =
-          schedulerKeyToAppPlacementAllocator.get(schedulerRequestKey)
-              .updatePendingAsk(entry.getValue().values(),
-                  recoverPreemptedRequestForAContainer);
+      PendingAskUpdateResult pendingAmountChanges = schedulerKeyToAppPlacementAllocator
+          .get(schedulerRequestKey).updatePendingAsk(entry.getValue().values(),
+              recoverPreemptedRequestForAContainer);
-        updatePendingResources(
-            pendingAmountChanges, schedulerRequestKey,
+        updatePendingResources(pendingAmountChanges, schedulerRequestKey,

MOV26 UPD40 INS23 INS83 INS83 INS74 INS59 INS44 INS43 INS43 INS43 INS42 INS14 INS74 INS42 INS21 INS42 INS42 INS42 INS74 INS43 INS43 INS43 INS32 INS43 INS42 INS42 INS42 INS22 INS42 INS42 INS42 INS52 INS42 INS60 INS21 INS74 INS59 INS32 INS43 INS43 INS42 INS32 INS42 INS42 INS52 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS40 DEL42 DEL43 DEL74 DEL52 DEL14