HDFS-8786. Erasure coding: use simple replication for internal blocks on decommissioning datanodes. Contributed by Rakesh R.

-    final int additionalReplRequired;
+    int additionalReplRequired;
+
+      // should reconstruct all the internal blocks before scheduling
+      // replication task for decommissioning node(s).
+      if (additionalReplRequired - numReplicas.decommissioning() > 0) {
+        additionalReplRequired = additionalReplRequired
+            - numReplicas.decommissioning();
+      }
+      // mark that the reconstruction work is to replicate internal block to a
+      // new rack.
+      rw.setNotEnoughRack();
-    rw.addTaskToDatanode();
+    rw.addTaskToDatanode(numReplicas);

INS25 INS21 INS42 INS27 INS8 INS32 INS27 INS34 INS21 INS42 INS42 INS42 INS32 INS7 INS42 INS42 INS42 INS27 INS42 INS32 INS42 INS42 DEL83