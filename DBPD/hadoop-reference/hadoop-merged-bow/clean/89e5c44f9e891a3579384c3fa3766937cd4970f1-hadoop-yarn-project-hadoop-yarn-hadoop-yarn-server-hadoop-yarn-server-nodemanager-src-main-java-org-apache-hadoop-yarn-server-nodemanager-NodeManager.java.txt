YARN-4356. Ensure the timeline service v.2 is disabled cleanly and has no
impact when it's turned off. Contributed by Sangjin Lee.

+  // the NM collector service is set only if the timeline service v.2 is enabled
-    this.nmCollectorService = createNMCollectorService(context);
-    addService(nmCollectorService);
+    if (YarnConfiguration.timelineServiceV2Enabled(conf)) {
+      this.nmCollectorService = createNMCollectorService(context);
+      addService(nmCollectorService);
+    }
-    protected Map<ApplicationId, String> registeredCollectors =
-        new ConcurrentHashMap<ApplicationId, String>();
+    protected Map<ApplicationId, String> registeredCollectors;
+      if (YarnConfiguration.timelineServiceV2Enabled(conf)) {
+        this.registeredCollectors = new ConcurrentHashMap<>();
+      }
-  // For testing
+  /**
+   * Returns the NM collector service. It should be used only for testing
+   * purposes.
+   *
+   * @return the NM collector service, or null if the timeline service v.2 is
+   * not enabled
+   */
+  @VisibleForTesting
+    @SuppressWarnings("resource")

INS29 INS78 INS25 INS65 INS65 INS42 INS32 INS8 INS25 INS66 INS66 INS66 INS66 INS79 INS42 INS42 INS42 MOV21 MOV21 INS32 INS8 INS42 INS45 INS42 INS42 INS42 INS21 INS7 INS22 MOV14 INS52 INS42 UPD74 DEL42 DEL43 DEL42 DEL43