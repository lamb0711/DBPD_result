YARN-10226. NPE in Capacity Scheduler while using %primary_group queue mapping. Contributed by Peter Bacsko.

-    CSQueue parent = queueManager.getQueue(mapping.getParentQueue());
+    String parent = mapping.getParentQueue();
+    CSQueue groupQueue = queueManager.getQueue(group);
-    if (parent instanceof ManagedParentQueue) {
-      return getPlacementContext(mapping, group);
-    } else {
-      CSQueue queue = this.queueManager.getQueue(group);
-      if ( queue != null) {
-        return getPlacementContext(mapping, queue.getQueuePath());
+    if (parent != null) {
+      CSQueue parentQueue = queueManager.getQueue(parent);
+
+      if (parentQueue instanceof ManagedParentQueue) {
+        return getPlacementContext(mapping, group);
-        return null;
+        return groupQueue == null ? null : getPlacementContext(mapping, group);
+    } else {
+      return groupQueue == null ? null : getPlacementContext(mapping, group);

INS8 MOV60 MOV60 MOV60 MOV25 INS43 MOV43 INS8 INS42 MOV32 UPD42 UPD42 INS60 INS25 INS42 MOV43 INS59 MOV62 MOV8 MOV8 INS16 INS42 INS32 UPD42 INS27 INS33 INS32 INS42 INS42 INS42 INS16 INS42 INS33 INS42 INS42 INS42 INS27 INS33 INS32 INS42 INS33 MOV42 MOV42 UPD42 MOV42 DEL42 DEL42 DEL32 DEL52 DEL42 DEL22 DEL42 DEL32 DEL32 DEL33 DEL8 DEL25 DEL8