MAPREDUCE-6680. JHS UserLogDir scan algorithm sometime could skip directory with update in CloudFS (Azure FileSystem, S3, etc. Contributed by Junping Du

-    
+    private long scanTime = 0;
+
-      if (modTime != newModTime) {
+      // MAPREDUCE-6680: In some Cloud FileSystem, like Azure FS or S3, file's
+      // modification time is truncated into seconds. In that case,
+      // modTime == newModTime doesn't means no file update in the directory,
+      // so we need to have additional check.
+      // Note: modTime (X second Y millisecond) could be casted to X second or
+      // X+1 second.
+      if (modTime != newModTime
+          || (scanTime/1000) == (modTime/1000)
+          || (scanTime/1000 + 1) == (modTime/1000)) {
+        // reset scanTime before scanning happens
+        scanTime = System.currentTimeMillis();
+        // reset scanTime
+        scanTime = System.currentTimeMillis();
-  
+

INS23 INS83 INS39 INS59 INS42 INS34 INS27 INS27 INS27 INS21 INS21 MOV27 INS27 INS36 INS36 INS7 INS7 INS36 INS36 INS27 INS27 INS42 INS32 INS42 INS32 INS27 INS27 INS27 INS34 INS42 INS34 INS42 INS42 INS42 INS42 INS42 INS34 INS42 INS34 INS42 INS34