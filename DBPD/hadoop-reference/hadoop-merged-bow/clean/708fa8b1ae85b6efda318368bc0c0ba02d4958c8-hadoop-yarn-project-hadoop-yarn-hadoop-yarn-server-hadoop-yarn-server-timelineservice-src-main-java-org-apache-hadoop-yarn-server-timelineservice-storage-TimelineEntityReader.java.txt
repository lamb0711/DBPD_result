YARN-4210. HBase reader throws NPE if Get returns no rows (Varun Saxena via vrushali)

+import org.apache.commons.logging.Log;
+import org.apache.commons.logging.LogFactory;
+import org.apache.hadoop.hbase.client.ResultScanner;
+  private static final Log LOG = LogFactory.getLog(TimelineEntityReader.class);
+    if (result == null || result.isEmpty()) {
+      // Could not find a matching row.
+      LOG.info("Cannot find matching entity of type " + entityType);
+      return null;
+    }
-    Iterable<Result> results = getResults(hbaseConf, conn);
-    for (Result result : results) {
-      TimelineEntity entity = parseEntity(result);
-      if (entity == null) {
-        continue;
+    ResultScanner results = getResults(hbaseConf, conn);
+    try {
+      for (Result result : results) {
+        TimelineEntity entity = parseEntity(result);
+        if (entity == null) {
+          continue;
+        }
+        entities.add(entity);
+        if (entities.size() > limit) {
+          entities.pollLast();
+        }
-      entities.add(entity);
-      if (entities.size() > limit) {
-        entities.pollLast();
-      }
+      return entities;
+    } finally {
+      results.close();
-    return entities;
-   * Fetches an iterator for {@link Result} instances for a multi-entity read.
+   * Fetches a {@link ResultScanner} for a multi-entity read.
-  protected abstract Iterable<Result> getResults(Configuration hbaseConf,
+  protected abstract ResultScanner getResults(Configuration hbaseConf,

INS26 INS26 INS26 INS40 INS40 INS40 INS23 INS83 INS83 INS83 INS43 INS59 INS43 INS42 INS42 INS32 INS25 INS54 UPD42 MOV42 INS42 INS42 INS57 INS27 INS8 INS43 INS8 INS8 UPD66 UPD66 INS43 INS27 INS32 INS21 INS41 UPD42 MOV42 MOV70 MOV41 INS21 UPD42 INS42 INS42 INS33 INS42 INS42 INS32 INS33 INS32 INS42 INS42 INS27 INS42 INS42 INS45 INS42 DEL42 DEL43 DEL43 DEL74 DEL42 DEL43 DEL43 DEL74