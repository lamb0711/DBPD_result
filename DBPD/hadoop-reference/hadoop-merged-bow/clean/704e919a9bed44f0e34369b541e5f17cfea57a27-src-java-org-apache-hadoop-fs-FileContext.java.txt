HADOOP-6563. Add more symlink tests to cover intermediate symlinks in paths. Contributed by Eli Collins.



git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@939827 13f79535-47bb-0310-9956-ffa450edef68

-    final Path absSrc  = fixRelativePart(src);
+    final Path absSrc = fixRelativePart(src);
-       * was unresolved. Resolve the source path completely, then
-       * resolve the destination. 
+       * was unresolved. Resolve the source path up until the final
+       * path component, then fully resolve the destination. 
-      final Path source = resolve(absSrc);    
+      final Path source = resolveIntermediate(absSrc);    
+   * Resolves all symbolic links in the specified path leading up 
+   * to, but not including the final path component.
+   * @param f path to resolve
+   * @return the new path object.
+   */
+  protected Path resolveIntermediate(final Path f) throws IOException {
+    return new FSLinkResolver<FileStatus>() {
+      public FileStatus next(final AbstractFileSystem fs, final Path p) 
+        throws IOException, UnresolvedLinkException {
+        return fs.getFileLinkStatus(p);
+      }
+    }.resolve(this, f).getPath();
+  }
+  
+  /**

INS31 INS29 INS83 INS43 INS42 INS44 INS43 INS8 INS65 INS65 INS65 INS42 INS83 INS43 INS42 INS42 INS41 INS66 INS66 INS42 INS66 INS66 INS42 INS32 INS32 INS42 INS14 INS42 INS52 INS42 INS74 INS1 INS43 INS43 INS31 UPD42 INS42 INS42 INS83 INS43 INS42 INS44 INS44 INS43 INS43 INS8 INS42 INS83 INS43 INS42 INS83 INS43 INS42 INS42 INS42 INS41 INS42 INS42 INS32 INS42 INS42 INS42