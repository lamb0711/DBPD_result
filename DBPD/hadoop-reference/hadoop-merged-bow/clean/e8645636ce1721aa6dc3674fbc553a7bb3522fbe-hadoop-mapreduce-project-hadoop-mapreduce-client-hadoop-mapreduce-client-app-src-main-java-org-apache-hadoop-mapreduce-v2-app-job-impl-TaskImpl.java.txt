MAPREDUCE-3511. Removed a multitude of cloned/duplicate counters in the AM thereby reducing the AM heap size and preventing full GCs. (vinodkv)


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1229347 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.mapreduce.Counters;
-import org.apache.hadoop.mapreduce.v2.api.records.Counters;
-      report.setCounters(getCounters());
+
+      // Add a copy of counters as the last step so that their lifetime on heap
+      // is as small as possible.
+      report.setCounters(TypeConverter.toYarn(getCounters()));
+
-        counters = recordFactory.newRecordInstance(Counters.class);
+        counters = TaskAttemptImpl.EMPTY_COUNTERS;
-        TypeConverter.fromYarn(task.getCounters()));
+        task.getCounters());

MOV26 UPD40 MOV21 INS32 MOV32 INS42 INS42 MOV32 UPD42 UPD42 INS40 DEL42 DEL42 DEL42 DEL43 DEL57 DEL32 DEL42 DEL42 DEL32