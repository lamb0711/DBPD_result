HDFS-4908. Reduce snapshot inode memory usage.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1494858 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.namenode.INodeAttributes;
+import org.apache.hadoop.hdfs.server.namenode.INodeDirectoryAttributes;
+import org.apache.hadoop.hdfs.server.namenode.INodeFileAttributes;
-  private static <N extends INode, D extends AbstractINodeDiff<N, D>>
-      void saveINodeDiffs(final AbstractINodeDiffList<N, D> diffs,
+  private static <N extends INode, A extends INodeAttributes, D extends AbstractINodeDiff<N, A, D>>
+      void saveINodeDiffs(final AbstractINodeDiffList<N, A, D> diffs,
-    final INodeFile snapshotINode = in.readBoolean()?
-        loader.loadINodeWithLocalName(true, in, false).asFile(): null;
+    final INodeFileAttributes snapshotINode = in.readBoolean()?
+        loader.loadINodeFileAttributes(in): null;
-  private static INodeDirectory loadSnapshotINodeInDirectoryDiff(
+  private static INodeDirectoryAttributes loadSnapshotINodeInDirectoryDiff(
-      return in.readBoolean()?
-          loader.loadINodeWithLocalName(true, in, false).asDirectory(): null;
+      return in.readBoolean()? loader.loadINodeDirectoryAttributes(in): null;
-    INodeDirectory snapshotINode = loadSnapshotINodeInDirectoryDiff(snapshot,
-        in, loader);
+    INodeDirectoryAttributes snapshotINode = loadSnapshotINodeInDirectoryDiff(
+        snapshot, in, loader);

INS26 INS26 INS26 INS40 INS40 INS40 INS73 UPD43 INS42 INS43 UPD74 UPD74 UPD42 INS42 INS43 INS43 UPD43 UPD43 INS42 INS42 UPD42 UPD42 INS32 MOV42 UPD42 MOV42 MOV42 INS32 MOV42 UPD42 MOV42 MOV42 DEL9 DEL9 DEL32 DEL42 DEL32 DEL9 DEL9 DEL32 DEL42 DEL32