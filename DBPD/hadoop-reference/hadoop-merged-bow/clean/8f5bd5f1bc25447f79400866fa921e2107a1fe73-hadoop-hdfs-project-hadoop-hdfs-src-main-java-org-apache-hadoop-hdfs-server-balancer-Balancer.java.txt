HDFS-4261. Fix bugs in Balancer that it does not terminate in some cases and it checks BlockPlacementPolicy instance incorrectly.  Contributed by Junping Du


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1419192 13f79535-47bb-0310-9956-ffa450edef68

-  
-    if (BlockPlacementPolicy.getInstance(conf, null, null) instanceof 
-        BlockPlacementPolicyDefault) {
+    if (!(BlockPlacementPolicy.getInstance(conf, null, null) instanceof 
+        BlockPlacementPolicyDefault)) {
-  private int notChangedIterations = 0;
-      if (dispatchBlockMoves() > 0) {
-        notChangedIterations = 0;
-      } else {
-        notChangedIterations++;
-        if (notChangedIterations >= 5) {
-          System.out.println(
-              "No block has been moved for 5 iterations. Exiting...");
-          return ReturnStatus.NO_MOVE_PROGRESS;
-        }
+      if (!this.nnc.shouldContinue(dispatchBlockMoves())) {
+        return ReturnStatus.NO_MOVE_PROGRESS;

INS38 INS36 MOV62 INS38 MOV8 INS32 INS22 INS42 MOV32 INS52 INS42 DEL83 DEL39 DEL42 DEL34 DEL59 DEL23 DEL40 DEL42 DEL45 DEL32 DEL21 DEL34 DEL27 DEL42 DEL34 DEL7 DEL21 DEL8 DEL42 DEL37 DEL21 DEL42 DEL34 DEL27 DEL25 DEL8