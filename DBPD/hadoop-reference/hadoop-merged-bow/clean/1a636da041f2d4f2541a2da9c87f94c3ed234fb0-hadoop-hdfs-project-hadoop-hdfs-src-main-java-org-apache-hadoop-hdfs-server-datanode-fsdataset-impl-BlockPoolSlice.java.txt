HDFS-15033. Support to save replica cached files to other place and make expired time configurable. Contributed by Yang Yun.

+import java.util.concurrent.TimeUnit;
-  private final long replicaCacheExpiry = 5*60*1000;
+  private final long replicaCacheExpiry;
+  private final File replicaCacheDir;
+    String cacheDirRoot = conf.get(
+        DFSConfigKeys.DFS_DATANODE_REPLICA_CACHE_ROOT_DIR_KEY);
+    if (cacheDirRoot != null && !cacheDirRoot.isEmpty()) {
+      this.replicaCacheDir = new File(cacheDirRoot,
+          currentDir.getCanonicalPath());
+      if (!this.replicaCacheDir.exists()) {
+        if (!this.replicaCacheDir.mkdirs()) {
+          throw new IOException("Failed to mkdirs " + this.replicaCacheDir);
+        }
+      }
+    } else {
+      this.replicaCacheDir = currentDir;
+    }
+    this.replicaCacheExpiry = conf.getTimeDuration(
+        DFSConfigKeys.DFS_DATANODE_REPLICA_CACHE_EXPIRY_TIME_KEY,
+        DFSConfigKeys.DFS_DATANODE_REPLICA_CACHE_EXPIRY_TIME_DEFAULT,
+        TimeUnit.MILLISECONDS);
+
-    File replicaFile = new File(currentDir, REPLICA_CACHE_FILE);
+    File replicaFile = new File(replicaCacheDir, REPLICA_CACHE_FILE);
-    final File tmpFile = new File(currentDir, REPLICA_CACHE_FILE + ".tmp");
-    final File replicaCacheFile = new File(currentDir, REPLICA_CACHE_FILE);
+    final File tmpFile = new File(replicaCacheDir, REPLICA_CACHE_FILE + ".tmp");
+    final File replicaCacheFile = new File(replicaCacheDir, REPLICA_CACHE_FILE);

INS26 INS40 INS23 INS83 INS83 INS43 INS59 INS42 INS42 INS60 INS25 INS21 INS43 INS59 INS27 INS8 INS8 INS7 MOV43 INS42 INS42 INS32 INS27 INS38 INS21 INS25 INS21 INS22 INS32 INS42 INS42 INS40 INS42 INS33 INS32 INS7 INS38 INS8 INS7 INS52 INS42 INS42 INS42 INS40 INS40 INS40 MOV43 UPD42 UPD42 UPD42 INS42 INS42 INS22 INS14 INS32 INS25 INS22 INS42 INS52 INS42 INS43 INS42 INS32 INS22 INS42 INS38 INS8 INS52 INS42 INS42 INS42 INS42 INS52 INS42 INS32 INS53 INS22 INS42 INS14 INS52 INS42 INS43 INS27 INS42 INS45 INS22 INS52 INS42 DEL34 DEL34 DEL34 DEL27