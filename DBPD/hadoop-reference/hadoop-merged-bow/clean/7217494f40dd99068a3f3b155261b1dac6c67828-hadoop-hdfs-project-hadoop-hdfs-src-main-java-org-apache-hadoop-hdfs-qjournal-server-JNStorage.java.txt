HDFS-10659. Namenode crashes after Journalnode re-installation in an HA cluster due to missing paxos directory. Contributed by star, Hanisha Koneru.

Signed-off-by: Wei-Chiu Chuang <weichiu@apache.org>

-  public boolean isPreUpgradableLayout(StorageDirectory sd) throws IOException {
+  public boolean isPreUpgradableLayout(StorageDirectory sd)
+      throws IOException {
-  File findFinalizedEditsFile(long startTxId, long endTxId) throws IOException {
+  File findFinalizedEditsFile(long startTxId, long endTxId)
+      throws IOException {
-    return new File(getPaxosDir(), String.valueOf(segmentTxId));
+    return new File(getOrCreatePaxosDir(), String.valueOf(segmentTxId));
-  File getPaxosDir() {
-    return new File(sd.getCurrentDir(), "paxos");
+  File getOrCreatePaxosDir() {
+    File paxosDir = new File(sd.getCurrentDir(), "paxos");
+    if(!paxosDir.exists()) {
+      LOG.info("Creating paxos dir: {}", paxosDir.toPath());
+      if(!paxosDir.mkdir()) {
+        LOG.error("Could not create paxos dir: {}", paxosDir.toPath());
+      }
+    }
+    return paxosDir;
-    purgeMatching(getPaxosDir(), PAXOS_DIR_PURGE_REGEXES, minTxIdToKeep);
+    purgeMatching(getOrCreatePaxosDir(),
+        PAXOS_DIR_PURGE_REGEXES, minTxIdToKeep);
-    createPaxosDir();
+    getOrCreatePaxosDir();
-  void createPaxosDir() throws IOException {
-    if (!getPaxosDir().mkdirs()) {
-      throw new IOException("Could not create paxos dir: " + getPaxosDir());
-    }
-  }
-  

INS31 INS43 UPD42 MOV42 INS8 INS42 INS60 INS25 INS41 MOV43 INS59 INS38 INS8 INS42 INS42 MOV14 INS32 INS21 MOV25 UPD42 UPD42 INS42 INS42 INS32 UPD42 INS42 INS42 INS45 INS32 INS21 INS42 INS42 UPD42 MOV42 UPD42 INS32 INS42 INS42 INS45 INS32 UPD42 MOV42 INS42 DEL32 DEL42 DEL43 DEL45 DEL32 DEL27 DEL14 DEL53 DEL41 DEL8 DEL31 DEL39 DEL42 DEL42 DEL43 DEL8 DEL31