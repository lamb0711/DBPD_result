HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes (#2026)


-import org.apache.hadoop.thirdparty.protobuf.*;
-import org.apache.hadoop.thirdparty.protobuf.Descriptors.MethodDescriptor;
+import com.google.protobuf.BlockingService;
+import com.google.protobuf.Descriptors.MethodDescriptor;
+import com.google.protobuf.Message;
+import com.google.protobuf.ServiceException;
+import com.google.protobuf.TextFormat;
+import org.apache.hadoop.ipc.RPC.RpcKind;
+ * This engine uses Protobuf 2.5.0. Recommended to upgrade to Protobuf 3.x
+ * from hadoop-thirdparty and use ProtobufRpcEngine2.
+@Deprecated
+    private static final RpcInvoker RPC_INVOKER = new ProtoBufRpcInvoker();
-    
+
+    @Override
+    protected RpcInvoker getServerRpcInvoker(RpcKind rpcKind) {
+      if (rpcKind == RpcKind.RPC_PROTOCOL_BUFFER) {
+        return RPC_INVOKER;
+      }
+      return super.getServerRpcInvoker(rpcKind);
+    }
+

INS26 INS26 INS26 INS26 UPD40 UPD40 INS40 INS40 INS40 INS40 INS78 INS42 INS23 INS31 INS66 INS66 INS83 INS83 INS83 INS43 INS59 INS78 INS83 INS43 INS42 INS44 INS8 INS42 INS42 INS14 INS42 INS42 INS43 INS42 INS25 INS41 INS43 INS42 INS27 INS8 INS48 INS42 INS42 INS40 INS41 INS42 INS42 INS42