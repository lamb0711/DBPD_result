YARN-7224. Support GPU isolation for docker container. Contributed by Wangda Tan.

-   * Get list of minor device numbers of Gpu devices usable by YARN.
+   * Get list of GPU devices usable by YARN.
-   * @return List of minor device numbers of Gpu devices.
+   * @return List of GPU devices
-  public synchronized List<Integer> getMinorNumbersOfGpusUsableByYarn()
+  public synchronized List<GpuDevice> getGpusUsableByYarn()
-    List<Integer> minorNumbers = new ArrayList<>();
+    List<GpuDevice> gpuDevices = new ArrayList<>();
-        for (PerGpuDeviceInformation gpu : lastDiscoveredGpuInformation
-            .getGpus()) {
-          minorNumbers.add(gpu.getMinorNumber());
+        for (int i = 0; i < lastDiscoveredGpuInformation.getGpus().size();
+             i++) {
+          List<PerGpuDeviceInformation> gpuInfos =
+              lastDiscoveredGpuInformation.getGpus();
+          gpuDevices.add(new GpuDevice(i, gpuInfos.get(i).getMinorNumber()));
-          minorNumbers.add(Integer.valueOf(s.trim()));
+          String[] kv = s.trim().split(":");
+          if (kv.length != 2) {
+            throw new YarnException(
+                "Illegal format, it should be index:minor_number format, now it="
+                    + s);
+          }
+
+          gpuDevices.add(
+              new GpuDevice(Integer.parseInt(kv[0]), Integer.parseInt(kv[1])));
-      LOG.info("Allowed GPU devices with minor numbers:" + allowedDevicesStr);
+      LOG.info("Allowed GPU devices:" + gpuDevices);
-    return minorNumbers;
+    return gpuDevices;

UPD74 UPD42 UPD43 UPD66 UPD66 UPD42 UPD74 UPD42 UPD43 UPD42 UPD42 INS24 INS58 INS27 INS37 INS8 UPD45 UPD42 INS39 INS59 INS42 INS32 INS42 INS60 MOV21 INS60 INS25 INS42 INS34 INS32 INS42 INS74 INS59 INS5 INS59 INS27 INS8 INS42 INS42 INS43 MOV43 INS42 MOV32 UPD42 INS14 INS43 INS85 INS42 MOV32 MOV42 INS40 INS34 INS53 UPD42 INS14 INS42 INS43 INS42 INS32 INS42 UPD42 INS45 INS14 INS43 INS32 INS32 INS42 INS32 MOV42 INS43 INS27 INS42 INS42 INS42 INS2 INS42 INS42 INS2 UPD42 MOV42 INS42 INS42 INS42 INS45 INS42 INS42 INS34 INS42 INS34 DEL32 DEL42 DEL44 DEL8 DEL70 DEL42