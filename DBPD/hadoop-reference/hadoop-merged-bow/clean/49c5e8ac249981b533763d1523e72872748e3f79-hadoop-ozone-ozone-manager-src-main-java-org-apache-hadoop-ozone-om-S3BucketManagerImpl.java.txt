HDDS-1672. Improve locking in OzoneManager. (#1016)



+
+import static org.apache.hadoop.ozone.om.lock.OzoneManagerLock.Resource.S3_BUCKET_LOCK;
-    omMetadataManager.getLock().acquireS3Lock(bucketName);
+    omMetadataManager.getLock().acquireLock(S3_BUCKET_LOCK, bucketName);
-      String bucket =
-          omMetadataManager.getS3Table().get(bucketName);
+      String bucket = omMetadataManager.getS3Table().get(bucketName);
-      omMetadataManager.getLock().releaseS3Lock(bucketName);
+      omMetadataManager.getLock().releaseLock(S3_BUCKET_LOCK, bucketName);
+
-    omMetadataManager.getLock().acquireS3Lock(bucketName);
+    omMetadataManager.getLock().acquireLock(S3_BUCKET_LOCK, bucketName);
-      omMetadataManager.getLock().releaseS3Lock(bucketName);
+      omMetadataManager.getLock().releaseLock(S3_BUCKET_LOCK, bucketName);
-  private String formatOzoneVolumeName(String userName) {
+  @Override
+  public String formatOzoneVolumeName(String userName) {
-    omMetadataManager.getLock().acquireS3Lock(s3BucketName);
+    omMetadataManager.getLock().acquireLock(S3_BUCKET_LOCK, s3BucketName);
-      omMetadataManager.getLock().releaseS3Lock(s3BucketName);
+      omMetadataManager.getLock().releaseLock(S3_BUCKET_LOCK, s3BucketName);

INS26 INS40 INS78 UPD83 INS42 UPD42 INS42 UPD42 INS42 UPD42 INS42 UPD42 INS42 UPD42 INS42 UPD42 INS42