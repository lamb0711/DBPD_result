HADOOP-14919. BZip2 drops records when reading data in splits. Contributed by Jason Lowe

- * stream to know about the progess. The notion of position becomes complicated
+ * stream to know about the progress. The notion of position becomes complicated
- * in this process) and the position is updated (i.e. the caller of this class
- * will find out the stream location). At this point we are ready for actual
- * reading (i.e. decompression) of data.
+ * in this process) and the position is reported as the beginning of the block
+ * start delimiter. At this point we are ready for actual reading
+ * (i.e. decompression) of data.
- * block reading, position is not updated. (We can only update the postion on
+ * block reading, position is not updated. (We can only update the position on
-  * If marker is found, the stream position will be right after marker at the
-  * end of this call.
+  * If marker is found, the stream position will be at the byte containing
+  * the starting bit of the marker.
+  * @return true if the marker was found otherwise false
+        this.reportedBytesReadFromCompressedStream =
+            this.bytesReadFromCompressedStream;
+          // Report the byte position where the marker starts
+          long markerBytesRead = (markerBitLength + this.bsLive + 7) / 8;
+          this.reportedBytesReadFromCompressedStream =
+              this.bytesReadFromCompressedStream - markerBytesRead;
-
-          } else
+          } else {
+            this.reportedBytesReadFromCompressedStream =
+                this.bytesReadFromCompressedStream;
+          }
+      this.reportedBytesReadFromCompressedStream =
+          this.bytesReadFromCompressedStream;
-      this.reportedBytesReadFromCompressedStream = this.bytesReadFromCompressedStream;
-      //Exactly when we are about to start a new block, we advertise the stream position.
-      this.reportedBytesReadFromCompressedStream = this.bytesReadFromCompressedStream;

UPD66 UPD66 UPD66 UPD66 UPD66 INS65 UPD66 UPD66 INS66 MOV21 MOV41 INS21 MOV41 INS7 INS22 INS22 INS60 INS21 INS52 INS42 INS52 INS42 INS39 INS59 INS7 INS8 INS42 INS27 INS22 INS27 MOV21 MOV41 INS36 INS34 INS52 INS42 INS22 INS42 INS27 INS52 INS42 INS42 INS22 INS34 INS52 INS42