HDFS-10956. Remove rename/delete performance penalty when not using snapshots. Contributed by Daryn Sharp.

-      validateRenameSource(srcIIP);
+      validateRenameSource(fsd, srcIIP);
-    validateRenameSource(srcIIP);
+    validateRenameSource(fsd, srcIIP);
-      FSDirSnapshotOp.checkSnapshot(dstInode, snapshottableDirs);
+      FSDirSnapshotOp.checkSnapshot(fsd, dstIIP, snapshottableDirs);
-  private static void validateRenameSource(INodesInPath srcIIP)
-      throws IOException {
+  private static void validateRenameSource(FSDirectory fsd,
+      INodesInPath srcIIP) throws IOException {
-    FSDirSnapshotOp.checkSnapshot(srcInode, null);
+    FSDirSnapshotOp.checkSnapshot(fsd, srcIIP, null);

INS44 INS43 INS42 INS42 INS42 INS42 UPD42 INS42 INS42 UPD42