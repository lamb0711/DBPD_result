YARN-3087. Made the REST server of per-node aggregator work alone in NM daemon. Conntributed by Li Lu.

(cherry picked from commit 41a08ad404d4278fe598d6c222b2ae0e84bae0df)

+import javax.servlet.ServletContext;
-import com.google.inject.Inject;
-import java.net.URI;
-
-  private final AppLevelServiceManager serviceManager;
-
-  @Inject
-  public PerNodeAggregatorWebService(AppLevelServiceManager serviceManager) {
-    this.serviceManager = serviceManager;
-  }
+  private @Context ServletContext context;
-      AppLevelAggregatorService service = serviceManager.getService(appId);
+      AppLevelAggregatorService service = getAggregatorService(req, appId);
+  private AppLevelAggregatorService
+      getAggregatorService(HttpServletRequest req, String appIdToParse) {
+    String appIdString = parseApplicationId(appIdToParse);
+    final AppLevelServiceManager serviceManager =
+        (AppLevelServiceManager) context.getAttribute(
+            PerNodeAggregatorServer.AGGREGATOR_COLLECTION_ATTR_KEY);
+    return serviceManager.getService(appIdString);
+  }
+

MOV26 MOV31 UPD40 INS78 INS43 UPD83 INS43 UPD42 INS44 INS42 INS42 UPD42 INS42 INS43 INS42 INS43 INS42 INS60 INS60 INS41 INS42 INS42 INS43 INS59 INS83 MOV43 INS59 INS32 INS42 INS42 INS32 INS42 INS11 INS42 INS42 INS42 INS42 INS42 MOV43 INS32 INS42 INS42 INS40 UPD42 UPD42 DEL40 DEL26 DEL83 DEL42 DEL78 DEL42 DEL52 DEL42 DEL22 DEL42 DEL7 DEL21