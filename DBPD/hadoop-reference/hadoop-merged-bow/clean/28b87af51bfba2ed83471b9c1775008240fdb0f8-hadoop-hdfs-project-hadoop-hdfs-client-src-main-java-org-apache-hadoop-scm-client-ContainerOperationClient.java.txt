HDFS-13013. Fix closeContainer API with the right container state change. Contributed by Xiaoyu Yao.

-import org.apache.hadoop.ozone.protocol.proto.StorageContainerLocationProtocolProtos.NotifyObjectCreationStageRequestProto;
+import org.apache.hadoop.ozone.protocol.proto.StorageContainerLocationProtocolProtos.ObjectStageChangeRequestProto;
-    storageContainerLocationClient.notifyObjectCreationStage(
-        NotifyObjectCreationStageRequestProto.Type.container,
+    storageContainerLocationClient.notifyObjectStageChange(
+        ObjectStageChangeRequestProto.Type.container,
-        NotifyObjectCreationStageRequestProto.Stage.begin);
+        ObjectStageChangeRequestProto.Op.create,
+        ObjectStageChangeRequestProto.Stage.begin);
-    storageContainerLocationClient.notifyObjectCreationStage(
-        NotifyObjectCreationStageRequestProto.Type.container,
+    storageContainerLocationClient.notifyObjectStageChange(
+        ObjectStageChangeRequestProto.Type.container,
-        NotifyObjectCreationStageRequestProto.Stage.complete);
+        ObjectStageChangeRequestProto.Op.create,
+        ObjectStageChangeRequestProto.Stage.complete);
-    storageContainerLocationClient.notifyObjectCreationStage(
-        NotifyObjectCreationStageRequestProto.Type.pipeline,
+    storageContainerLocationClient.notifyObjectStageChange(
+        ObjectStageChangeRequestProto.Type.pipeline,
-        NotifyObjectCreationStageRequestProto.Stage.begin);
+        ObjectStageChangeRequestProto.Op.create,
+        ObjectStageChangeRequestProto.Stage.begin);
-    storageContainerLocationClient.notifyObjectCreationStage(
-        NotifyObjectCreationStageRequestProto.Type.pipeline,
+    storageContainerLocationClient.notifyObjectStageChange(
+        ObjectStageChangeRequestProto.Type.pipeline,
-        NotifyObjectCreationStageRequestProto.Stage.complete);
+        ObjectStageChangeRequestProto.Op.create,
+        ObjectStageChangeRequestProto.Stage.complete);
+
+      String containerId = pipeline.getContainerName();
+
+      storageContainerLocationClient.notifyObjectStageChange(
+          ObjectStageChangeRequestProto.Type.container,
+          containerId,
+          ObjectStageChangeRequestProto.Op.close,
+          ObjectStageChangeRequestProto.Stage.begin);
+
-      String containerId = pipeline.getContainerName();
-      storageContainerLocationClient.closeContainer(containerId);
+      storageContainerLocationClient.notifyObjectStageChange(
+          ObjectStageChangeRequestProto.Type.container,
+          containerId,
+          ObjectStageChangeRequestProto.Op.close,
+          ObjectStageChangeRequestProto.Stage.complete);

UPD40 MOV21 UPD42 UPD40 INS40 UPD40 UPD42 UPD40 INS40 UPD40 UPD42 UPD40 INS40 UPD40 UPD42 UPD40 INS40 UPD40 INS21 INS32 UPD42 INS40 INS40 INS40 INS42 INS42 INS40 INS42 INS40 INS40