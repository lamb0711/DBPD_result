HDFS-4523. Fix INodeFile replacement, TestQuota and javac errors from trunk merge.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1450477 13f79535-47bb-0310-9956-ffa450edef68

-      if(repl != srcInode.getFileReplication()) {
+      if(repl != srcInode.getBlockReplication()) {
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(path);
+      checkOwner(pc, path);
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(path);
+      checkOwner(pc, path);
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(snapshotRoot);
+      checkOwner(pc, snapshotRoot);
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(path);
+      checkOwner(pc, path);
-      status = snapshotManager
-          .getSnapshottableDirListing(checker.isSuper ? null : checker.user);
+      final String user = checker.isSuperUser()? null : checker.getUser();
+      status = snapshotManager.getSnapshottableDirListing(user);
+    final FSPermissionChecker pc = getPermissionChecker();
-      checkOwner(snapshotRoot);
+      checkOwner(pc, snapshotRoot);

INS60 INS60 INS60 INS60 INS60 INS83 INS43 INS59 INS83 INS43 INS59 INS83 INS43 INS59 INS83 INS43 INS59 INS83 INS43 INS59 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS60 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS83 INS43 INS59 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS16 INS42 UPD42 INS32 INS33 INS32 INS42 INS42 INS42 INS42 INS42 DEL40 DEL33 DEL40 DEL16