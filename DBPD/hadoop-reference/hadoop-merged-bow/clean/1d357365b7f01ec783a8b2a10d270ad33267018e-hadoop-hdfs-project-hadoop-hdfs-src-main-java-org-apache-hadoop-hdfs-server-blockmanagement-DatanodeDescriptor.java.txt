HDFS-5455. NN should update storageMap on first heartbeat.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1538787 13f79535-47bb-0310-9956-ffa450edef68

-      if (storage != null) {
-        storage.receivedHeartbeat(report);
-        totalCapacity += report.getCapacity();
-        totalRemaining += report.getRemaining();
-        totalBlockPoolUsed += report.getBlockPoolUsed();
-        totalDfsUsed += report.getDfsUsed();
-      } else {
-        // This warning is generally benign during cluster initialization
-        // when the heartbeat is received before the initial block reports
-        // from each storage.
-        LOG.warn("Unrecognized storage ID " + report.getStorageID());
+      if (storage == null) {
+        // This is seen during cluster initialization when the heartbeat
+        // is received before the initial block reports from each storage.
+        storage = updateStorage(new DatanodeStorage(report.getStorageID()));
+      storage.receivedHeartbeat(report);
+      totalCapacity += report.getCapacity();
+      totalRemaining += report.getRemaining();
+      totalBlockPoolUsed += report.getBlockPoolUsed();
+      totalDfsUsed += report.getDfsUsed();
+        LOG.info("Adding new storage ID " + s.getStorageID() +
+                 " for DN " + getXferAddr());

MOV8 MOV60 MOV60 MOV60 MOV60 MOV21 MOV21 MOV21 MOV21 MOV21 INS70 MOV21 MOV21 MOV21 MOV21 MOV21 MOV44 INS42 MOV8 MOV32 MOV60 INS25 UPD42 MOV42 INS27 INS8 INS42 INS33 INS21 INS21 INS7 INS32 INS42 INS32 INS42 INS42 INS27 INS42 INS14 INS45 INS32 INS45 INS32 INS43 MOV32 INS42 INS42 INS42 INS42 INS42 DEL42 DEL45 DEL27 DEL42 DEL33 DEL27 DEL8 DEL25 DEL42 DEL70 DEL8