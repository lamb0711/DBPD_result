HDFS-15147. LazyPersistTestCase wait logic is flawed. Contributed by Ahmed Hussein.

+import java.util.concurrent.atomic.AtomicLong;
-
+  /**
+   * Timestamp marking the end time of {@link #redundancyThread}'s full cycle.
+   * This value can be checked by the Junit tests to verify that the
+   * {@link #redundancyThread} has run at least one full iteration.
+   */
+  private final AtomicLong lastRedundancyCycleTS = new AtomicLong(-1);
+   * Used as ad hoc to check the time stamp of the last full cycle of
+   * {@link #redundancyThread}. This is used by the Junit tests to block until
+   * {@link #lastRedundancyCycleTS} is updated.
+   * @return the current {@link #lastRedundancyCycleTS}.
+   */
+  @VisibleForTesting
+  public long getLastRedundancyMonitorTS() {
+    return lastRedundancyCycleTS.get();
+  }
+
+  /**
+            lastRedundancyCycleTS.set(Time.monotonicNow());

INS26 INS40 INS23 INS31 INS29 INS83 INS83 INS43 INS59 INS29 INS78 INS83 INS39 INS42 INS8 INS65 INS42 INS42 INS14 INS65 INS65 INS42 INS41 INS66 INS65 INS66 INS66 INS65 INS66 INS43 INS38 INS66 INS65 INS66 INS65 INS66 INS66 INS65 INS66 INS32 INS67 INS67 INS42 INS34 INS67 INS67 INS67 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS21 INS32 INS42 INS42 INS32 INS42 INS42