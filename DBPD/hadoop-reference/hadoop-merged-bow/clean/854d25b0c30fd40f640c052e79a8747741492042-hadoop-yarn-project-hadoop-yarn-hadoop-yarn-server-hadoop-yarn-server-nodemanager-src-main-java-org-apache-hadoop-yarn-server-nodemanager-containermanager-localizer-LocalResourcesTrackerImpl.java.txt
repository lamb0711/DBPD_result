YARN-3727. For better error recovery, check if the directory exists before using it for localization. Contributed by Zhihai Xu

+   * @param {@link DeletionService} Deletion Service to delete existing
+   *        path for localization.
-  public Path
-      getPathForLocalization(LocalResourceRequest req, Path localDirPath) {
+  public Path getPathForLocalization(LocalResourceRequest req,
+      Path localDirPath, DeletionService delService) {
-    rPath = new Path(rPath,
-        Long.toString(uniqueNumberGenerator.incrementAndGet()));
+    while (true) {
+      Path uniquePath = new Path(rPath,
+          Long.toString(uniqueNumberGenerator.incrementAndGet()));
+      File file = new File(uniquePath.toUri().getRawPath());
+      if (!file.exists()) {
+        rPath = uniquePath;
+        break;
+      }
+      // If the directory already exists, delete it and move to next one.
+      LOG.warn("Directory " + uniquePath + " already exists, " +
+          "try next one.");
+      if (delService != null) {
+        delService.delete(getUser(), uniquePath);
+      }
+    }
+

INS44 INS65 INS43 INS42 INS61 INS66 INS65 INS66 INS66 INS42 INS9 INS8 INS42 INS60 INS60 INS25 INS21 INS25 INS43 INS59 INS43 INS59 INS38 INS8 INS32 INS27 INS8 INS42 INS42 MOV14 INS42 INS42 INS14 INS32 MOV21 INS10 INS42 INS42 INS27 INS42 INS33 INS21 INS43 INS32 INS42 INS42 INS45 INS42 INS45 INS45 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42