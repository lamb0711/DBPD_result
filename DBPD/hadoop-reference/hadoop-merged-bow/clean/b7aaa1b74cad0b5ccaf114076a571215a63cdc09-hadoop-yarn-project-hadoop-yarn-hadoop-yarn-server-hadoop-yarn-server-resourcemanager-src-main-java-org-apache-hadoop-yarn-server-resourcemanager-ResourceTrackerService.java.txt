Merge trunk into the HDFS-347 branch.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-347@1467511 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.yarn.YarnException;
+import org.apache.hadoop.yarn.server.utils.YarnServerBuilderUtils;
+  private long nextHeartBeatInterval;
-  private static final NodeHeartbeatResponse reboot = recordFactory
+  private static final NodeHeartbeatResponse resync = recordFactory
-    reboot.setNodeAction(NodeAction.REBOOT);
+    resync.setNodeAction(NodeAction.RESYNC);
+    nextHeartBeatInterval =
+        conf.getLong(YarnConfiguration.RM_NM_HEARTBEAT_INTERVAL_MS,
+            YarnConfiguration.DEFAULT_RM_NM_HEARTBEAT_INTERVAL_MS);
+    if (nextHeartBeatInterval <= 0) {
+      throw new YarnException("Invalid Configuration. "
+          + YarnConfiguration.RM_NM_HEARTBEAT_INTERVAL_MS
+          + " should be larger than 0.");
+    }
-      return reboot;
+      return resync;
-
-    NodeHeartbeatResponse nodeHeartBeatResponse = recordFactory
-        .newRecordInstance(NodeHeartbeatResponse.class);
-      return reboot;
+      return resync;
-    nodeHeartBeatResponse.setResponseId(lastNodeHeartbeatResponse.getResponseId() + 1);
+    NodeHeartbeatResponse nodeHeartBeatResponse = YarnServerBuilderUtils
+        .newNodeHeartbeatResponse(lastNodeHeartbeatResponse.
+            getResponseId() + 1, NodeAction.NORMAL, null, null, null,
+            nextHeartBeatInterval);
-    nodeHeartBeatResponse.setNodeAction(NodeAction.NORMAL);
-

INS26 INS26 INS40 INS40 INS23 INS83 INS39 INS59 MOV60 INS42 UPD42 INS21 INS25 INS7 INS27 INS8 UPD42 UPD40 INS42 INS32 INS42 INS34 INS53 MOV32 MOV42 INS42 INS42 INS40 INS40 INS14 UPD42 INS42 UPD42 INS40 INS33 INS33 INS33 UPD42 INS43 INS27 UPD42 INS42 INS45 INS40 INS45 DEL42 DEL42 DEL42 DEL43 DEL57 DEL32 DEL21 DEL42 DEL42 DEL40 DEL32 DEL21