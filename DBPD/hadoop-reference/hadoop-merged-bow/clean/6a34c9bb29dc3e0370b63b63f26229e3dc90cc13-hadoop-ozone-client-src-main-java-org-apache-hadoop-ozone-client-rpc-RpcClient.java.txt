HDDS-1299. Support TokenIssuer interface for running jobs with OzoneFileSystem. Contributed by Xiaoyu Yao.

This closes #627.

+import org.apache.hadoop.crypto.key.KeyProviderTokenIssuer;
+import java.net.URI;
-public class RpcClient implements ClientProtocol {
+public class RpcClient implements ClientProtocol, KeyProviderTokenIssuer {
+  private Text dtService;
+    dtService =
+        getOMProxyProvider().getProxy().getDelegationTokenService();
-      Text dtService =
-          getOMProxyProvider().getProxy().getDelegationTokenService();
-      LOG.debug("Created token {}", token);
+      LOG.debug("Created token {} for dtService {}", token, dtService);
-      LOG.debug("Cannot get ozone delegation token from {}", renewer);
+      LOG.debug("Cannot get ozone delegation token for renewer {} to access " +
+          "service {}", renewer, dtService);
-    // TODO: support get kms uri from om rpc server.
-        OzoneKMSUtil.getKeyProvider(conf, OzoneKMSUtil.getKeyProviderUri(
-            ugi, null, null, conf)));
+        getKeyProvider());
+  @Override
+  public KeyProvider getKeyProvider() throws IOException {
+    return OzoneKMSUtil.getKeyProvider(conf, getKeyProviderUri());
+  }
+
+  @Override
+  public URI getKeyProviderUri() throws IOException {
+    // TODO: fix me to support kms instances for difference OMs
+    return OzoneKMSUtil.getKeyProviderUri(ugi,
+        null, null, conf);
+  }
+
+  @Override
+  public String getCanonicalServiceName() {
+    return (dtService != null) ? dtService.toString() : null;
+  }
+
+  @Override
+  public Token<?> getDelegationToken(String renewer) throws IOException {
+    return getDelegationToken(renewer == null ? null : new Text(renewer));
+  }

INS26 INS26 INS40 INS40 INS43 INS23 INS31 INS31 INS31 INS31 INS42 INS83 INS43 INS59 INS78 INS83 INS43 INS42 INS43 INS8 INS78 INS83 INS43 INS42 INS43 INS8 INS78 INS83 INS43 INS42 INS8 INS78 INS83 INS74 INS42 INS44 INS43 INS8 INS42 INS42 INS21 INS42 INS42 INS42 INS41 INS42 INS42 INS42 INS41 INS42 INS42 INS41 INS42 INS43 INS76 INS43 INS42 INS42 INS41 INS7 INS32 MOV32 INS16 INS42 INS42 INS32 INS42 MOV32 INS42 INS42 INS42 INS32 INS36 INS32 INS33 INS42 INS16 INS42 INS27 INS42 INS42 INS27 INS33 INS14 UPD45 INS42 INS27 INS42 INS42 INS33 INS42 INS33 MOV43 INS42 INS45 INS45 DEL42 DEL59 DEL60 DEL45 DEL42 DEL42