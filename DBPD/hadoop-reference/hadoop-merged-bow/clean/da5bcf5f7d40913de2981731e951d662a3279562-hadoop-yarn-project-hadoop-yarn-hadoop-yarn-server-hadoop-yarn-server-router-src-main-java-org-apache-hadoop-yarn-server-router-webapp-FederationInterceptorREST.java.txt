YARN-8186. [Router] Federation: routing getAppState REST invocations transparently to multiple RMs. Contributed by Giovanni Matteo Fumarola.

+  /**
+   * The YARN Router will forward to the respective YARN RM in which the AM is
+   * running.
+   * <p>
+   * Possible failure:
+   * <p>
+   * Client: identical behavior as {@code RMWebServices}.
+   * <p>
+   * Router: the Client will timeout and resubmit the request.
+   * <p>
+   * ResourceManager: the Router will timeout and the call will fail.
+   * <p>
+   * State Store: the Router will timeout and it will retry depending on the
+   * FederationFacade settings - if the failure happened before the select
+   * operation.
+   */
+  @Override
+  public AppState getAppState(HttpServletRequest hsr, String appId)
+      throws AuthorizationException {
+
+    ApplicationId applicationId = null;
+    try {
+      applicationId = ApplicationId.fromString(appId);
+    } catch (IllegalArgumentException e) {
+      return null;
+    }
+
+    SubClusterInfo subClusterInfo = null;
+    SubClusterId subClusterId = null;
+    try {
+      subClusterId =
+          federationFacade.getApplicationHomeSubCluster(applicationId);
+      if (subClusterId == null) {
+        return null;
+      }
+      subClusterInfo = federationFacade.getSubCluster(subClusterId);
+    } catch (YarnException e) {
+      return null;
+    }
+
+    DefaultRequestInterceptorREST interceptor =
+        getOrCreateInterceptorForSubCluster(subClusterId,
+            subClusterInfo.getRMWebServiceAddress());
+    return interceptor.getAppState(hsr, appId);
+  }
+
-  public AppState getAppState(HttpServletRequest hsr, String appId)
-      throws AuthorizationException {
-    throw new NotImplementedException();
-  }
-
-  @Override

MOV31 INS29 INS65 INS60 INS54 INS60 INS60 INS54 INS60 INS41 INS66 INS66 INS66 INS66 INS66 INS66 INS65 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS66 INS43 INS59 INS8 INS12 INS43 INS59 INS43 INS59 INS8 INS12 INS43 INS59 INS32 INS66 INS42 INS42 INS33 INS21 INS44 INS8 INS42 INS42 INS33 INS42 INS42 INS33 INS21 INS25 INS21 INS44 INS8 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS7 INS43 INS42 INS41 INS7 INS27 INS8 INS7 INS43 INS42 INS41 INS42 INS42 INS32 INS42 INS32 INS42 INS33 INS42 INS32 INS42 INS33 INS41 INS42 INS32 UPD42 MOV42 INS33 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS33 INS42 INS42 INS42 DEL43 DEL14 DEL53