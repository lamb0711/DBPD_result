HDFS-5163. Miscellaneous cache pool RPC fixes (Contributed by Colin Patrick McCabe)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-4949@1520665 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.NoSuchElementException;
+import org.apache.hadoop.fs.BatchedRemoteIterator.BatchedEntries;
-import org.apache.hadoop.hdfs.protocol.CachePoolInfo;
+import org.apache.hadoop.hdfs.protocol.CachePoolInfo;
-    private final Long poolId;
+    private final String pool;
-    public ServerSidePathCacheEntriesIterator(Long firstKey,
-        int maxRepliesPerRequest, Long poolId) {
-      super(firstKey, maxRepliesPerRequest);
-      this.poolId = poolId;
+    public ServerSidePathCacheEntriesIterator(Long firstKey, String pool) {
+      super(firstKey);
+      this.pool = pool;
-        Long prevKey, int maxRepliesPerRequest) throws IOException {
-      return new BatchedListEntries<PathCacheEntry>(
-          namesystem.listPathCacheEntries(prevKey, poolId,
-              maxRepliesPerRequest));
+        Long nextKey) throws IOException {
+      return namesystem.listPathCacheEntries(nextKey, pool);
-
+  
-      long poolId, int maxReplies) throws IOException {
-    return new ServerSidePathCacheEntriesIterator(prevId, maxReplies, poolId);
+      String pool) throws IOException {
+    return new ServerSidePathCacheEntriesIterator(prevId, pool);
-  public CachePool addCachePool(CachePoolInfo info) throws IOException {
-    return namesystem.addCachePool(info);
+  public void addCachePool(CachePoolInfo info) throws IOException {
+    namesystem.addCachePool(info);
-  public void modifyCachePool(long poolId, CachePoolInfo info)
-      throws IOException {
-    namesystem.modifyCachePool(poolId, info);
+  public void modifyCachePool(CachePoolInfo info) throws IOException {
+    namesystem.modifyCachePool(info);
-  public void removeCachePool(long poolId) throws IOException {
-    namesystem.removeCachePool(poolId);
+  public void removeCachePool(String cachePoolName) throws IOException {
+    namesystem.removeCachePool(cachePoolName);
-      extends BatchedRemoteIterator<Long, CachePool> {
+      extends BatchedRemoteIterator<String, CachePoolInfo> {
-    public ServerSideCachePoolIterator(long prevId, int maxRepliesPerRequest) {
-      super(prevId, maxRepliesPerRequest);
+    public ServerSideCachePoolIterator(String prevKey) {
+      super(prevKey);
-    public BatchedEntries<CachePool> makeRequest(Long prevId,
-        int maxRepliesPerRequest) throws IOException {
-      return new BatchedListEntries<CachePool>(
-          namesystem.listCachePools(prevId, maxRepliesPerRequest));
+    public BatchedEntries<CachePoolInfo> makeRequest(String prevKey)
+        throws IOException {
+      return namesystem.listCachePools(prevKey);
-    public Long elementToPrevKey(CachePool element) {
-      return element.getId();
+    public String elementToPrevKey(CachePoolInfo element) {
+      return element.getPoolName();
-  public RemoteIterator<CachePool> listCachePools(long prevPoolId,
-      int maxRepliesPerRequest) throws IOException {
-    return new ServerSideCachePoolIterator(prevPoolId, maxRepliesPerRequest);
+  public RemoteIterator<CachePoolInfo> listCachePools(String prevKey)
+      throws IOException {
+    return new ServerSideCachePoolIterator(prevKey);

MOV26 INS26 INS26 INS40 INS40 INS39 MOV78 MOV78 UPD74 UPD74 UPD43 INS43 UPD42 INS21 INS43 UPD42 UPD43 UPD43 UPD74 UPD43 UPD43 INS43 UPD42 UPD42 UPD42 UPD43 UPD42 UPD42 INS42 MOV32 INS42 UPD42 UPD42 INS43 UPD42 UPD43 UPD43 UPD42 UPD42 UPD43 UPD42 INS42 UPD42 INS32 UPD42 UPD42 INS42 UPD42 UPD42 UPD42 INS32 UPD42 UPD42 UPD42 MOV42 MOV42 UPD42 MOV42 UPD42 MOV42 MOV42 MOV42 UPD42 MOV42 UPD42 UPD42 DEL39 DEL42 DEL44 DEL42 DEL39 DEL42 DEL44 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL32 DEL14 DEL39 DEL39 DEL42 DEL44 DEL42 DEL42 DEL43 DEL41 DEL39 DEL42 DEL44 DEL42 DEL39 DEL39 DEL39 DEL42 DEL44 DEL42 DEL39 DEL42 DEL44 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL32 DEL14 DEL39 DEL39 DEL42 DEL44 DEL42