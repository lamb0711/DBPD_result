HDFS-8854. Erasure coding: add ECPolicy to replace schema+cellSize in hadoop-hdfs. Contributed by Walter Su.

+import org.apache.hadoop.hdfs.protocol.ErasureCodingPolicy;
-import org.apache.hadoop.io.erasurecode.ECSchema;
-   * @param schema ECSchema for the erasure coding zone
-   * @param cellSize Cell size of stripe
+   * @param ecPolicy erasure coding policy for the erasure coding zone
-      final String srcArg, final ECSchema schema, final int cellSize,
+      final String srcArg, final ErasureCodingPolicy ecPolicy,
-          iip, schema, cellSize);
+          iip, ecPolicy);
-    return getErasureCodingSchemaForPath(fsn, iip) != null;
+    return getErasureCodingPolicyForPath(fsn, iip) != null;
-    return getErasureCodingSchema(fsn, iip) != null;
+    return getErasureCodingPolicy(fsn, iip) != null;
-   * Get erasure coding schema.
+   * Get the erasure coding policy.
-   * @return {@link ECSchema}
+   * @return {@link ErasureCodingPolicy}
-  static ECSchema getErasureCodingSchema(final FSNamesystem fsn,
+  static ErasureCodingPolicy getErasureCodingPolicy(final FSNamesystem fsn,
-    return getErasureCodingSchemaForPath(fsn, iip);
+    return getErasureCodingPolicyForPath(fsn, iip);
-   * Get available erasure coding schemas.
+   * Get available erasure coding polices.
-   * @return {@link ECSchema} array
+   * @return {@link ErasureCodingPolicy} array
-  static ECSchema[] getErasureCodingSchemas(final FSNamesystem fsn)
+  static ErasureCodingPolicy[] getErasureCodingPolicies(final FSNamesystem fsn)
-    return fsn.getErasureCodingSchemaManager().getSchemas();
-  }
-
-  /**
-   * Get the ECSchema specified by the name.
-   *
-   * @param fsn namespace
-   * @param schemaName schema name
-   * @return {@link ECSchema}
-   */
-  static ECSchema getErasureCodingSchema(final FSNamesystem fsn,
-      final String schemaName) throws IOException {
-    assert fsn.hasReadLock();
-
-    return fsn.getErasureCodingSchemaManager().getSchema(schemaName);
+    return fsn.getErasureCodingPolicyManager().getPolicies();
-  private static ECSchema getErasureCodingSchemaForPath(final FSNamesystem fsn,
+  private static ErasureCodingPolicy getErasureCodingPolicyForPath(final FSNamesystem fsn,
-      return fsn.getErasureCodingZoneManager().getErasureCodingSchema(iip);
+      return fsn.getErasureCodingZoneManager().getErasureCodingPolicy(iip);

MOV26 UPD40 UPD43 UPD42 UPD5 UPD42 UPD43 UPD42 UPD43 UPD42 UPD42 UPD43 UPD42 UPD42 UPD66 UPD42 UPD66 UPD66 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 DEL42 DEL66 DEL65 DEL83 DEL39 DEL42 DEL44 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL42 DEL66 DEL65 DEL66 DEL42 DEL65 DEL65 DEL29 DEL83 DEL42 DEL43 DEL42 DEL83 DEL42 DEL43 DEL42 DEL44 DEL83 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL42 DEL32 DEL6 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31