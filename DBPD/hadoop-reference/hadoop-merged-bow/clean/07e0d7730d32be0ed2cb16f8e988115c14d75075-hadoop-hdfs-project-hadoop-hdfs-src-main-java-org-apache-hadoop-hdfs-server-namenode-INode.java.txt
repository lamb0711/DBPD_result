HDFS-4129. Add utility methods to dump NameNode in memory tree for testing. Contributed by Tsz Wo (Nicholas), SZE.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1403956 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.PrintWriter;
+import java.io.StringWriter;
+import com.google.common.annotations.VisibleForTesting;
-   * Get local file name
-   * @return local file name
+   * @return null if the local name is null; otherwise, return the local name.
-    return DFSUtil.bytes2String(name);
+    return name == null? null: DFSUtil.bytes2String(name);
-   * Get local file name
-   * @return local file name
+   * @return null if the local name is null;
+   *         otherwise, return the local name byte array.
+
+  /**
+   * Dump the subtree starting from this inode.
+   * @return a text representation of the tree.
+   */
+  @VisibleForTesting
+  public StringBuffer dumpTreeRecursively() {
+    final StringWriter out = new StringWriter(); 
+    dumpTreeRecursively(new PrintWriter(out, true), new StringBuilder());
+    return out.getBuffer();
+  }
+
+  /**
+   * Dump tree recursively.
+   * @param prefix The prefix string that each line should print.
+   */
+  @VisibleForTesting
+  public void dumpTreeRecursively(PrintWriter out, StringBuilder prefix) {
+    out.print(prefix);
+    out.print(" ");
+    out.print(getLocalName());
+    out.print("   (");
+    final String s = super.toString();
+    out.print(s.substring(s.lastIndexOf(getClass().getSimpleName())));
+    out.println(")");
+  }

INS26 INS26 INS26 INS40 INS40 INS40 INS31 INS31 INS29 INS78 INS83 INS43 INS42 INS8 INS29 INS78 INS83 INS39 INS42 INS44 INS44 INS8 INS65 INS65 INS42 INS42 INS60 INS21 INS41 INS65 INS65 INS42 INS43 INS42 INS43 INS42 INS21 INS21 INS21 INS21 INS60 INS21 INS21 UPD66 INS16 UPD66 INS66 INS66 INS66 INS83 INS43 INS59 INS32 INS32 INS66 INS42 INS66 INS42 INS42 INS32 INS32 INS32 INS32 INS83 INS43 INS59 INS32 INS32 INS27 INS33 MOV32 INS42 INS42 INS14 INS42 INS14 INS14 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS45 INS42 INS42 INS32 INS42 INS42 INS45 INS42 INS42 INS48 INS42 INS42 INS32 INS42 INS42 INS45 INS42 INS33 INS43 INS43 INS42 INS9 INS43 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS32 INS32 INS42 INS42 DEL66 DEL65 DEL66 DEL65