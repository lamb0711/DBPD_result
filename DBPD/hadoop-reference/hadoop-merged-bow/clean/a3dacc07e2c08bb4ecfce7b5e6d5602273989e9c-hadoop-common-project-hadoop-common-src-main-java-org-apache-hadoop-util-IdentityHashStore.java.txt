HADOOP-11221. IdentityHashStore assumes System.identityHashCode() is non-negative. Contributed by Jinghui Wang

-    int hash = System.identityHashCode(k);
-    final int numEntries = buffer.length / 2;
-    int index = hash % numEntries;
+    final int hash = System.identityHashCode(k);
+    final int numEntries = buffer.length >>  1;
+    //computing modulo with the assumption buffer.length is power of 2
+    int index = hash & (numEntries-1);
-    final int numEntries = buffer.length / 2;
-    int hash = System.identityHashCode(k);
-    int index = hash % numEntries;
+    final int numEntries = buffer.length >> 1;
+    final int hash = System.identityHashCode(k);
+    //computing modulo with the assumption buffer.length is power of 2
+    int index = hash & (numEntries -1);

INS83 INS83 UPD27 UPD27 UPD27 UPD27 UPD34 INS36 UPD34 INS36 INS27 INS27 MOV42 INS34 MOV42 INS34