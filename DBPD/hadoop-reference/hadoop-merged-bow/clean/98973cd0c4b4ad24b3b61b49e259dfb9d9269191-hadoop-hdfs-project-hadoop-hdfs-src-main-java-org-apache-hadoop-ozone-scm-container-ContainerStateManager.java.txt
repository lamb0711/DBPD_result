HDFS-12966. Ozone: owner name should be set properly when the container allocation happens. Contributed by Shashikant Banerjee.

-import org.apache.hadoop.ozone.protocol.proto.OzoneProtos.Owner;
-    initializeContainerMaps();
-  private void initializeContainerMaps() {
+  private void initializeContainerMaps(String owner) {
-    for (OzoneProtos.Owner owner : OzoneProtos.Owner.values()) {
-      for (ReplicationType type : ReplicationType.values()) {
-        for (ReplicationFactor factor : ReplicationFactor.values()) {
-          for (LifeCycleState state : LifeCycleState.values()) {
-            ContainerKey key = new ContainerKey(owner, type, factor, state);
-            PriorityQueue<ContainerInfo> queue = new PriorityQueue<>();
-            containers.put(key, queue);
-          }
+    for (ReplicationType type : ReplicationType.values()) {
+      for (ReplicationFactor factor : ReplicationFactor.values()) {
+        for (LifeCycleState state : LifeCycleState.values()) {
+          ContainerKey key = new ContainerKey(owner, type, factor, state);
+          PriorityQueue<ContainerInfo> queue = new PriorityQueue<>();
+          containers.put(key, queue);
+      List<String> ownerList = new ArrayList<>();
-        ContainerKey key = new ContainerKey(container.getOwner(),
-            container.getPipeline().getType(),
-            container.getPipeline().getFactor(), container.getState());
+        String owner = container.getOwner();
+        if (ownerList.isEmpty() || !ownerList.contains(owner)) {
+          ownerList.add(owner);
+          initializeContainerMaps(owner);
+        }
+        ContainerKey key =
+            new ContainerKey(owner, container.getPipeline().getType(),
+                container.getPipeline().getFactor(), container.getState());
-      final String containerName, OzoneProtos.Owner owner) throws
+      final String containerName, String owner) throws
-      Preconditions.checkNotNull(queue);
+      if (queue == null) {
+        initializeContainerMaps(owner);
+        queue = containers.get(key);
+      }
-      Owner owner, ReplicationType type, ReplicationFactor factor,
+      String owner, ReplicationType type, ReplicationFactor factor,
+      if (queue == null) {
+        initializeContainerMaps(owner);
+        queue = containers.get(key);
+      }
-  public List<ContainerInfo> getMatchingContainers(Owner owner,
+  public List<ContainerInfo> getMatchingContainers(String owner,
-      return Arrays.asList((ContainerInfo[]) containers.get(key)
-          .toArray(new ContainerInfo[0]));
+      if (containers.get(key) == null) {
+        return null;
+      } else {
+        return Arrays.asList((ContainerInfo[]) containers.get(key)
+            .toArray(new ContainerInfo[0]));
+      }
-    private final OzoneProtos.Owner owner;
+    private final String owner;
-    ContainerKey(Owner owner, ReplicationType type,
+    ContainerKey(String owner, ReplicationType type,

INS44 MOV8 UPD43 MOV43 MOV42 MOV21 UPD43 UPD43 UPD43 UPD43 INS42 INS42 UPD42 UPD42 INS8 INS42 UPD43 INS60 INS25 INS25 INS25 UPD42 INS74 INS59 INS27 INS8 INS27 INS8 INS27 INS8 MOV8 INS43 INS43 INS42 INS14 INS60 INS25 INS42 INS33 INS21 MOV21 INS42 INS33 INS21 INS21 INS32 INS33 INS41 INS42 INS42 INS74 INS43 INS59 INS27 INS8 INS32 INS7 INS32 INS7 INS42 INS42 INS42 INS33 INS43 INS42 INS42 MOV32 INS32 INS38 INS21 INS21 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS32 INS32 INS42 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL40 DEL26 DEL42 DEL32 DEL21 DEL40 DEL44 DEL40 DEL42 DEL32 DEL70 DEL8 DEL40 DEL32 DEL40