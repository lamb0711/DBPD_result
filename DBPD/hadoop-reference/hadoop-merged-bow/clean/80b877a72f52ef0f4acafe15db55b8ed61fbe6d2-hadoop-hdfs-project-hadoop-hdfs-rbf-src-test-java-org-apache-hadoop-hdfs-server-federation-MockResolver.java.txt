HDFS-15196. RBF: RouterRpcServer getListing cannot list large dirs correctly. Contributed by Fengnan Li.

-    // Mounts only supported under root level
-    if (!path.equals("/")) {
-      return null;
-    }
-    for (String mount : this.locations.keySet()) {
-      if (mount.length() > 1) {
-        // Remove leading slash, this is the behavior of the mount tree,
-        // return only names.
-        mounts.add(mount.replace("/", ""));
+    // for root path search, returning all downstream root level mapping
+    if (path.equals("/")) {
+      // Mounts only supported under root level
+      for (String mount : this.locations.keySet()) {
+        if (mount.length() > 1) {
+          // Remove leading slash, this is the behavior of the mount tree,
+          // return only names.
+          mounts.add(mount.replace("/", ""));
+        }
+      }
+    } else {
+      // a simplified version of MountTableResolver implementation
+      for (String key : this.locations.keySet()) {
+        if (key.startsWith(path)) {
+          String child = key.substring(path.length());
+          if (child.length() > 0) {
+            // only take children so remove parent path and /
+            mounts.add(key.substring(path.length()+1));
+          }
+        }
+      }
+      if (mounts.size() == 0) {
+        mounts = null;

INS8 MOV60 INS25 MOV41 MOV32 MOV8 INS8 INS70 INS25 INS44 INS32 INS8 INS27 INS8 INS43 INS42 INS22 INS42 INS25 INS32 INS34 INS21 INS42 INS52 INS42 INS32 INS8 INS42 INS42 INS7 INS42 INS42 INS42 INS60 INS25 INS42 INS33 INS43 INS59 INS27 INS8 INS42 INS42 INS32 INS32 INS34 INS21 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS27 INS32 INS34 INS42 INS42 DEL38 DEL33 DEL41 DEL8 DEL25