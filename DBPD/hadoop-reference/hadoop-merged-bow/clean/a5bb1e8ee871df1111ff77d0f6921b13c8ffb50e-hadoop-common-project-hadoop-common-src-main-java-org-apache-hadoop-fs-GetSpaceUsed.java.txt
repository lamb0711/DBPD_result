HDFS-14313. Get hdfs used space from FsDatasetImpl#volumeMap#ReplicaInfo in memory instead of df/du. Contributed by Lisheng Sun.

-import java.util.concurrent.TimeUnit;
-  final class Builder {
+  class Builder {
-    static final String CLASSNAME_KEY = "fs.getspaceused.classname";
-    static final String JITTER_KEY = "fs.getspaceused.jitterMillis";
-    static final long DEFAULT_JITTER = TimeUnit.MINUTES.toMillis(1);
-
-
+    private Constructor<? extends GetSpaceUsed> cons;
-      return conf.getClass(CLASSNAME_KEY, result, GetSpaceUsed.class);
+      return conf.getClass(CommonConfigurationKeys.FS_GETSPACEUSED_CLASSNAME,
+          result, GetSpaceUsed.class);
-          return DEFAULT_JITTER;
+          return CommonConfigurationKeys.FS_GETSPACEUSED_JITTER_DEFAULT;
-        return configuration.getLong(JITTER_KEY, DEFAULT_JITTER);
+        return configuration.getLong(CommonConfigurationKeys.FS_GETSPACEUSED_JITTER_KEY,
+                CommonConfigurationKeys.FS_GETSPACEUSED_JITTER_DEFAULT);
+    public Constructor<? extends GetSpaceUsed> getCons() {
+      return cons;
+    }
+
+    public void setCons(Constructor<? extends GetSpaceUsed> cons) {
+      this.cons = cons;
+    }
+
-        Constructor<? extends GetSpaceUsed> cons =
-            getKlass().getConstructor(Builder.class);
+        if (cons == null) {
+          cons = getKlass().getConstructor(Builder.class);
+        }
+

MOV23 INS31 INS31 UPD83 INS74 INS83 INS74 INS42 INS8 INS83 INS39 INS42 INS44 INS8 INS43 INS76 UPD42 INS43 INS76 INS41 MOV74 INS42 INS21 UPD42 MOV42 INS43 UPD42 MOV42 INS43 INS42 INS7 INS42 INS40 INS42 INS22 INS42 INS25 INS52 INS42 INS27 INS8 INS40 INS40 INS42 INS33 INS21 INS40 INS7 INS42 MOV32 DEL40 DEL26 DEL83 DEL83 DEL83 DEL43 DEL42 DEL45 DEL59 DEL23 DEL83 DEL83 DEL39 DEL42 DEL40 DEL42 DEL34 DEL32 DEL59 DEL23 DEL83 DEL43 DEL45 DEL42 DEL42 DEL42 DEL42 DEL42 DEL59 DEL60