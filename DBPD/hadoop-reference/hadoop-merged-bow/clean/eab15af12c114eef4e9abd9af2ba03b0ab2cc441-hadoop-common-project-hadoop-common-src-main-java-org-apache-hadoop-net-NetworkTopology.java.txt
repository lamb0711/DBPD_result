HADOOP-10131. NetWorkTopology#countNumOfAvailableNodes() is returning wrong value if excluded nodes passed are not part of the cluster tree (Contributed by Vinayakumar B)

-    int count=0; // the number of nodes in both scope & excludedNodes
+    int excludedCountInScope = 0; // the number of nodes in both scope & excludedNodes
+    int excludedCountOffScope = 0; // the number of nodes outside scope & excludedNodes
-      for(Node node:excludedNodes) {
-        if ((NodeBase.getPath(node)+NodeBase.PATH_SEPARATOR_STR).
-            startsWith(scope+NodeBase.PATH_SEPARATOR_STR)) {
-          count++;
+      for (Node node : excludedNodes) {
+        node = getNode(NodeBase.getPath(node));
+        if (node == null) {
+          continue;
+        }
+        if ((NodeBase.getPath(node) + NodeBase.PATH_SEPARATOR_STR)
+            .startsWith(scope + NodeBase.PATH_SEPARATOR_STR)) {
+          excludedCountInScope++;
+        } else {
+          excludedCountOffScope++;
-      Node n=getNode(scope);
-      int scopeNodeCount=1;
+      Node n = getNode(scope);
+      int scopeNodeCount = 0;
+      if (n != null) {
+        scopeNodeCount++;
+      }
-        return clusterMap.getNumOfLeaves()-
-          scopeNodeCount-excludedNodes.size()+count;
+        return clusterMap.getNumOfLeaves() - scopeNodeCount
+            - excludedCountOffScope;
-        return scopeNodeCount-count;
+        return scopeNodeCount - excludedCountInScope;

INS60 INS39 INS59 UPD42 INS42 INS34 INS25 INS27 INS8 INS21 INS25 UPD34 INS42 INS33 INS21 INS7 INS27 INS8 INS8 INS37 MOV27 INS42 INS32 INS42 INS33 INS18 INS21 INS42 INS42 UPD42 INS42 INS32 INS37 INS42 INS42 INS42 UPD42 INS42 DEL42 DEL42 DEL32 DEL42 DEL27