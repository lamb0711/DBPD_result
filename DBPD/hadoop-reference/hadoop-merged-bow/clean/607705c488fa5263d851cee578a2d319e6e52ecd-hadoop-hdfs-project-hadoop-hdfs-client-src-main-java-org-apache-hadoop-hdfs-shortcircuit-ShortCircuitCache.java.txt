HDFS-10690. Optimize insertion/removal of replica in ShortCircuitCache. Contributed by Fenghua Hu.

-import java.util.TreeMap;
+import java.util.NoSuchElementException;
+import org.apache.commons.collections.map.LinkedMap;
-        Long evictionTimeNs = (long) 0;
+        Long evictionTimeNs;
-          Entry<Long, ShortCircuitReplica> entry =
-              evictable.ceilingEntry(evictionTimeNs);
-          if (entry == null) break;
-          evictionTimeNs = entry.getKey();
+          Object eldestKey;
+          try {
+            eldestKey = evictable.firstKey();
+          } catch (NoSuchElementException e) {
+            break;
+          }
+          evictionTimeNs = (Long)eldestKey;
-          ShortCircuitReplica replica = entry.getValue();
+          ShortCircuitReplica replica = (ShortCircuitReplica)evictable.get(
+              eldestKey);
-   * Tree of evictable elements.
+   * LinkedMap of evictable elements.
-  private final TreeMap<Long, ShortCircuitReplica> evictable = new TreeMap<>();
+  private final LinkedMap evictable = new LinkedMap();
-   * Tree of mmaped evictable elements.
+   * LinkedMap of mmaped evictable elements.
-  private final TreeMap<Long, ShortCircuitReplica> evictableMmapped =
-      new TreeMap<>();
+  private final LinkedMap evictableMmapped = new LinkedMap();
-    Long evictionTimeNs = (long) 0;
+    Long evictionTimeNs;
-      Entry<Long, ShortCircuitReplica> entry =
-          evictableMmapped.ceilingEntry(evictionTimeNs);
-      if (entry == null) break;
-      evictionTimeNs = entry.getKey();
+      Object eldestKey;
+      try {
+        eldestKey = evictableMmapped.firstKey();
+      } catch (NoSuchElementException e) {
+        break;
+      }
+      evictionTimeNs = (Long)eldestKey;
-      ShortCircuitReplica replica = entry.getValue();
+      ShortCircuitReplica replica = (ShortCircuitReplica)evictableMmapped.get(
+          eldestKey);
-      if (evictableSize == 0) {
-        replica = evictableMmapped.firstEntry().getValue();
-      } else {
-        replica = evictable.firstEntry().getValue();
+      try {
+        if (evictableSize == 0) {
+          replica = (ShortCircuitReplica)evictableMmapped.get(evictableMmapped
+              .firstKey());
+        } else {
+          replica = (ShortCircuitReplica)evictable.get(evictable.firstKey());
+        }
+      } catch (NoSuchElementException e) {
+        break;
-      TreeMap<Long, ShortCircuitReplica> map) {
+      LinkedMap map) {
-    ShortCircuitReplica removed = map.remove(evictableTimeNs);
+    ShortCircuitReplica removed = (ShortCircuitReplica)map.remove(
+        evictableTimeNs);
-      ShortCircuitReplica replica, TreeMap<Long, ShortCircuitReplica> map) {
+      ShortCircuitReplica replica, LinkedMap map) {
-        Entry<Long, ShortCircuitReplica> entry = evictable.firstEntry();
-        if (entry == null) break;
-        purge(entry.getValue());
+        Object eldestKey;
+        try {
+          eldestKey = evictable.firstKey();
+        } catch (NoSuchElementException e) {
+          break;
+        }
+        purge((ShortCircuitReplica)evictable.get(eldestKey));
-        Entry<Long, ShortCircuitReplica> entry = evictableMmapped.firstEntry();
-        if (entry == null) break;
-        purge(entry.getValue());
+        Object eldestKey;
+        try {
+          eldestKey = evictableMmapped.firstKey();
+        } catch (NoSuchElementException e) {
+          break;
+        }
+        purge((ShortCircuitReplica)evictableMmapped.get(eldestKey));
-        Map<Long, ShortCircuitReplica> evictable,
-        Map<Long, ShortCircuitReplica> evictableMmapped);
+        LinkedMap evictable,
+        LinkedMap evictableMmapped);

INS26 UPD40 INS40 INS43 INS43 UPD42 MOV42 UPD42 MOV42 INS43 INS43 UPD66 INS43 UPD66 INS43 UPD42 MOV42 MOV43 UPD42 MOV42 INS43 INS43 UPD42 MOV42 UPD42 MOV42 INS60 INS54 INS54 INS11 UPD42 MOV42 UPD42 MOV42 INS43 INS59 INS8 INS12 MOV43 INS8 INS12 MOV43 MOV32 UPD42 MOV42 UPD42 MOV42 INS21 INS44 INS8 INS11 INS11 MOV25 INS44 INS8 INS60 INS54 INS60 INS54 INS60 INS54 INS7 INS43 INS42 INS10 MOV43 INS42 MOV43 INS32 INS43 INS42 INS10 INS43 INS59 INS8 INS12 INS43 INS59 INS8 INS12 INS43 INS59 INS8 INS12 INS42 INS32 INS42 UPD42 MOV42 UPD42 MOV42 INS42 INS42 UPD42 MOV42 INS42 INS21 INS44 INS8 INS11 UPD42 MOV42 INS42 INS21 INS44 INS8 INS11 UPD42 MOV42 UPD42 MOV42 INS21 INS44 INS8 INS11 INS11 MOV42 UPD42 MOV42 INS7 INS43 INS42 INS10 MOV43 INS32 INS7 INS43 INS42 INS10 MOV43 INS32 INS7 INS43 INS42 INS10 MOV43 INS42 MOV43 INS32 INS11 INS11 INS42 INS32 INS42 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS32 INS42 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS32 INS42 UPD42 MOV42 UPD42 MOV42 INS42 MOV43 INS32 MOV43 INS32 MOV42 UPD42 MOV42 MOV42 UPD42 MOV42 MOV42 UPD42 MOV42 INS42 INS42 MOV32 INS42 INS42 MOV32 UPD42 UPD42 DEL39 DEL34 DEL11 DEL43 DEL74 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL10 DEL25 DEL42 DEL42 DEL32 DEL32 DEL43 DEL42 DEL43 DEL42 DEL43 DEL74 DEL43 DEL74 DEL43 DEL42 DEL43 DEL74 DEL43 DEL74 DEL39 DEL34 DEL11 DEL43 DEL74 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL10 DEL25 DEL42 DEL42 DEL32 DEL32 DEL42 DEL32 DEL42 DEL32 DEL43 DEL42 DEL43 DEL74 DEL43 DEL42 DEL43 DEL74 DEL43 DEL42 DEL43 DEL74 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL10 DEL25 DEL32 DEL43 DEL42 DEL43 DEL74 DEL42 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL10 DEL25 DEL32 DEL43 DEL42 DEL43 DEL42 DEL43 DEL74 DEL43 DEL42 DEL43 DEL42 DEL43 DEL74