HDDS-2210. ContainerStateMachine should not be marked unhealthy if applyTransaction fails with closed container exception(#1552).



-  private final AtomicBoolean isStateMachineHealthy;
+  private final AtomicBoolean stateMachineHealthy;
-    isStateMachineHealthy = new AtomicBoolean(true);
+    stateMachineHealthy = new AtomicBoolean(true);
+  public boolean isStateMachineHealthy() {
+    return stateMachineHealthy.get();
+  }
+
-    if (!isStateMachineHealthy.get()) {
+    if (!isStateMachineHealthy()) {
-        if (r.getResult() != ContainerProtos.Result.SUCCESS) {
+        // ignore close container exception while marking the stateMachine
+        // unhealthy
+        if (r.getResult() != ContainerProtos.Result.SUCCESS
+            && r.getResult() != ContainerProtos.Result.CONTAINER_NOT_OPEN
+            && r.getResult() != ContainerProtos.Result.CLOSED_CONTAINER_IO) {
-          isStateMachineHealthy.compareAndSet(true, false);
+          stateMachineHealthy.compareAndSet(true, false);
-          if (isStateMachineHealthy.get()) {
+          if (isStateMachineHealthy()) {

INS31 INS83 INS39 INS42 INS8 UPD42 INS41 INS32 UPD42 INS42 INS42 INS27 INS27 INS27 MOV27 INS27 INS32 INS40 INS32 INS40 INS42 INS42 UPD42 INS42 INS42 DEL42 DEL42