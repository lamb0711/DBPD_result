HDFS-4206. Change the fields in INode and its subclasses to private.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1410996 13f79535-47bb-0310-9956-ffa450edef68

-  /**
-   *  The inode name is in java UTF8 encoding; 
-   *  The name in HdfsFileStatus should keep the same encoding as this.
-   *  if this encoding is changed, implicitly getFileInfo and listStatus in
-   *  clientProtocol are changed; The decoding at the client
-   *  side should change accordingly.
-   */
-  protected byte[] name;
-  protected INodeDirectory parent;
-  protected long modificationTime;
-  protected long accessTime;
-  /** Simple wrapper for two counters : 
-   *  nsCount (namespace consumed) and dsCount (diskspace consumed).
-   */
+  /** Wrapper of two counters for namespace consumed and diskspace consumed. */
+    /** namespace count */
+    /** diskspace count */
-  //Only updated by updatePermissionStatus(...).
-  //Other codes should not modify it.
-  private long permission;
-
+
+    /** Set the {@link PermissionStatus} */
+    static long toLong(PermissionStatus ps) {
+      long permission = 0L;
+      final int user = SerialNumberManager.INSTANCE.getUserSerialNumber(
+          ps.getUserName());
+      permission = PermissionStatusFormat.USER.combine(user, permission);
+      final int group = SerialNumberManager.INSTANCE.getGroupSerialNumber(
+          ps.getGroupName());
+      permission = PermissionStatusFormat.GROUP.combine(group, permission);
+      final int mode = ps.getPermission().toShort();
+      permission = PermissionStatusFormat.MODE.combine(mode, permission);
+      return permission;
+    }
-  INode(PermissionStatus permissions, long mTime, long atime) {
-    this.name = null;
-    this.parent = null;
-    this.modificationTime = mTime;
-    setAccessTime(atime);
-    setPermissionStatus(permissions);
+  /**
+   *  The inode name is in java UTF8 encoding; 
+   *  The name in HdfsFileStatus should keep the same encoding as this.
+   *  if this encoding is changed, implicitly getFileInfo and listStatus in
+   *  clientProtocol are changed; The decoding at the client
+   *  side should change accordingly.
+   */
+  private byte[] name = null;
+  /** 
+   * Permission encoded using PermissionStatusFormat.
+   * Codes other than {@link #updatePermissionStatus(PermissionStatusFormat, long)}.
+   * should not modify it.
+   */
+  private long permission = 0L;
+  protected INodeDirectory parent = null;
+  protected long modificationTime = 0L;
+  protected long accessTime = 0L;
+
+  private INode(byte[] name, long permission, INodeDirectory parent,
+      long modificationTime, long accessTime) {
+    this.name = name;
+    this.permission = permission;
+    this.parent = parent;
+    this.modificationTime = modificationTime;
+    this.accessTime = accessTime;
+  }
+
+  INode(byte[] name, PermissionStatus permissions, INodeDirectory parent,
+      long modificationTime, long accessTime) {
+    this(name, PermissionStatusFormat.toLong(permissions), parent,
+        modificationTime, accessTime);
+  }
+
+  INode(PermissionStatus permissions, long mtime, long atime) {
+    this(null, permissions, null, mtime, atime);
-    this(permissions, 0L, 0L);
-    setLocalName(name);
+    this(DFSUtil.string2Bytes(name), permissions, null, 0L, 0L);
-  /** copy constructor
-   * 
-   * @param other Other node to be copied
-   */
+  /** @param other Other node to be copied */
-    setLocalName(other.getLocalName());
-    this.parent = other.getParent();
-    setPermissionStatus(other.getPermissionStatus());
-    setModificationTime(other.getModificationTime());
-    setAccessTime(other.getAccessTime());
+    this(other.getLocalNameBytes(), other.permission, other.getParent(), 
+        other.getModificationTime(), other.getAccessTime());

MOV55 MOV71 INS23 INS31 INS31 INS31 INS31 UPD83 INS29 INS83 INS39 INS59 INS83 INS42 INS44 INS44 INS44 INS44 MOV44 INS8 INS42 INS44 INS44 INS44 INS44 INS44 INS8 INS42 MOV44 INS44 MOV44 INS8 INS29 INS29 INS29 INS83 INS39 INS42 INS44 INS8 INS33 INS65 INS42 INS34 INS33 INS34 INS34 INS5 INS42 INS39 INS42 INS43 INS42 INS39 INS42 UPD42 MOV21 MOV21 MOV21 MOV21 MOV21 INS5 INS42 INS43 INS42 INS43 INS42 INS39 INS42 INS39 INS42 INS17 INS39 INS42 INS17 INS17 UPD66 INS65 INS65 INS65 INS43 INS42 INS60 INS60 INS21 INS60 INS21 INS60 INS21 INS41 INS66 INS66 INS65 INS66 INS66 INS39 INS85 INS42 INS7 INS39 INS85 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS33 INS42 INS33 INS42 INS42 INS32 INS33 UPD66 INS32 INS40 MOV32 MOV32 MOV32 INS66 INS66 INS66 INS65 INS66 INS42 INS39 INS59 INS83 INS39 INS59 INS7 INS83 INS39 INS59 INS7 INS83 INS39 INS59 INS7 INS42 INS68 INS42 INS42 INS42 UPD42 INS22 INS42 UPD42 MOV42 INS42 MOV42 INS42 INS42 INS42 MOV42 UPD42 MOV42 INS42 INS42 INS34 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS69 INS69 UPD42 INS52 INS42 INS40 INS42 INS32 INS40 INS42 INS42 INS42 INS40 INS42 INS32 INS40 INS42 INS42 INS42 INS32 INS42 INS40 INS42 INS42 INS42 INS43 INS39 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL66 DEL33 DEL33 DEL42 DEL42 DEL32 DEL83 DEL39 DEL42 DEL59 DEL23 DEL42 DEL32 DEL21 DEL8 DEL31 DEL42 DEL42 DEL32 DEL21 DEL66 DEL65 DEL42 DEL32 DEL32 DEL21 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21 DEL42 DEL32 DEL21 DEL42 DEL32 DEL21