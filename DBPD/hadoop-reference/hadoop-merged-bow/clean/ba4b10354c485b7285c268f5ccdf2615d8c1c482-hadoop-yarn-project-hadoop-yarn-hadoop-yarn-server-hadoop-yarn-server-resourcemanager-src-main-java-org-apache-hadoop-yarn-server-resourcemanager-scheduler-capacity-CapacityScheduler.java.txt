Merging r1566359 through r1568420 from trunk.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1568437 13f79535-47bb-0310-9956-ffa450edef68

-  private boolean useLocalConfigurationProvider;
+    Configuration configuration = new Configuration(conf);
-      this.useLocalConfigurationProvider =
-          (LocalConfigurationProvider.class.isAssignableFrom(conf.getClass(
-              YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,
-              LocalConfigurationProvider.class)));
-      this.conf =
-          new CapacitySchedulerConfiguration(conf,
-              this.useLocalConfigurationProvider);
+      if (rmContext.getConfigurationProvider() instanceof
+          LocalConfigurationProvider) {
+        this.conf = new CapacitySchedulerConfiguration(configuration, true);
+      } else {
+        try {
+          this.conf =
+              new CapacitySchedulerConfiguration(rmContext
+                  .getConfigurationProvider().getConfiguration(configuration,
+                      YarnConfiguration.CS_CONFIGURATION_FILE), false);
+        } catch (Exception e) {
+          throw new IOException(e);
+        }
+      }
-              this.useLocalConfigurationProvider);
+              rmContext.getConfigurationProvider() instanceof
+                  LocalConfigurationProvider);
+

INS60 INS43 INS59 INS42 INS42 INS14 INS25 INS43 INS42 INS62 INS8 INS8 INS42 INS32 MOV43 MOV21 INS54 INS42 INS42 INS8 INS12 INS62 INS14 MOV21 INS44 INS8 INS32 MOV43 UPD42 INS43 INS42 INS9 INS43 INS42 INS53 INS42 INS42 INS42 INS42 INS14 INS32 INS9 INS43 INS42 INS32 INS42 INS42 INS40 INS42 INS42 INS42 DEL83 DEL39 DEL42 DEL59 DEL23 DEL57 DEL42 DEL42 DEL42 DEL40 DEL57 DEL32 DEL32 DEL36 DEL42 DEL52 DEL42 DEL22 DEL52 DEL42 DEL22