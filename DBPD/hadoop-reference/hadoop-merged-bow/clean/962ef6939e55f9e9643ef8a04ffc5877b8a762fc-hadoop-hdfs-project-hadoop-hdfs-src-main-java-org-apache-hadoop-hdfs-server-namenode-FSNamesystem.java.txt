HDFS-6490. Fix the keyid format for generated keys in FSNamesystem.createEncryptionZone (clamb)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/fs-encryption@1611722 13f79535-47bb-0310-9956-ffa450edef68

+  private String nameserviceId;
+
-      String nameserviceId = DFSUtil.getNamenodeNameServiceId(conf);
+      nameserviceId = DFSUtil.getNamenodeNameServiceId(conf);
-   * @param keyId id of the key
+   * @param keyIdArg id of the key
-  private KeyVersion createNewKey(String keyId, String src)
+  private KeyVersion createNewKey(String keyIdArg, String src)
-    Preconditions.checkNotNull(keyId);
+    Preconditions.checkNotNull(keyIdArg);
-    // TODO pass in hdfs://HOST:PORT (HDFS-6490)
-    providerOptions.setDescription(src);
+    final StringBuilder sb = new StringBuilder("hdfs://");
+    if (nameserviceId != null) {
+      sb.append(nameserviceId);
+    }
+    sb.append(src);
+    if (!src.endsWith("/")) {
+      sb.append('/');
+    }
+    sb.append(keyIdArg);
+    final String keyId = sb.toString();
+    providerOptions.setDescription(keyId);
-      version = provider.createKey(keyId, providerOptions);
+      version = provider.createKey(keyIdArg, providerOptions);

INS23 INS83 MOV43 INS59 INS42 UPD42 INS60 INS25 INS21 INS25 INS21 INS60 UPD42 INS83 INS43 INS59 INS27 INS8 INS32 INS38 INS8 INS32 INS83 INS43 INS59 INS21 UPD42 INS42 INS42 INS14 INS42 INS33 INS21 INS42 INS42 INS42 INS32 INS21 INS42 INS42 INS42 INS42 INS42 INS32 UPD42 INS7 INS43 INS45 INS32 INS42 INS42 INS45 INS32 INS42 INS42 INS42 MOV32 INS42 INS42 INS42 INS42 INS42 INS42 INS13 UPD42 DEL42 DEL59 DEL60