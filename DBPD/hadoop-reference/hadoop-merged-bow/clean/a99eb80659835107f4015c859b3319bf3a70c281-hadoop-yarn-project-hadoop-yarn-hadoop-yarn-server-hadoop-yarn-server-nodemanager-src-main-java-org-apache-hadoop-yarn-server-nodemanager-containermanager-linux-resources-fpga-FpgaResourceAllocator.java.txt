YARN-9267. General improvements in FpgaResourceHandlerImpl. Contributed by Peter Bacsko.

-import org.apache.hadoop.yarn.server.nodemanager.containermanager.resourceplugin.fpga.FpgaDiscoverer;
+    // SHA-256 hash of the uploaded aocx file
+    private String aocxHash;
+    public String getAocxHash() {
+      return aocxHash;
+    }
+
+    public void setAocxHash(String hash) {
+      this.aocxHash = hash;
+    }
+
-          this.major + ", Minor: " + this.minor + ", IPID: " + this.IPID + ")";
+          this.major + ", Minor: " + this.minor + ", IPID: " +
+          this.IPID + ", Hash: " + this.aocxHash + ")";
-      FpgaDevice device, String newIPID) {
+      FpgaDevice device, String newIPID, String newHash) {
+      FpgaDevice fpga = usedFpgas.get(index);
+      fpga.setIPID(newIPID);
+      fpga.setAocxHash(newHash);
-   * @param IPIDPreference allocate slot with this IPID first
+   * @param ipidHash hash of the localized aocx file
-      Container container, String IPIDPreference) throws ResourceHandlerException {
+      Container container, String ipidHash) throws ResourceHandlerException {
-        if ( null != currentAvailableFpga.get(i).getIPID() &&
-            currentAvailableFpga.get(i).getIPID().equalsIgnoreCase(IPIDPreference)) {
+        String deviceIPIDhash = currentAvailableFpga.get(i).getAocxHash();
+        if (deviceIPIDhash != null &&
+            deviceIPIDhash.equalsIgnoreCase(ipidHash)) {

INS23 INS31 INS31 INS44 INS83 INS43 INS59 INS83 INS43 INS42 INS8 INS83 INS39 INS42 INS44 INS8 INS43 INS42 UPD42 INS42 INS42 INS42 INS41 INS43 INS42 INS21 INS42 UPD42 UPD66 INS42 INS42 INS7 INS60 INS21 INS21 INS22 INS42 INS45 INS22 INS43 INS59 INS32 INS32 INS52 INS42 INS52 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS60 INS42 INS42 INS42 INS43 INS59 INS42 INS42 MOV32 UPD42 INS42 INS33 INS42 UPD42 DEL40 DEL26 DEL33 DEL42 DEL42 DEL42 DEL32 DEL42 DEL32