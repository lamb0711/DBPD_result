HDFS-3190. Simple refactors in existing NN code to assist QuorumJournalManager extension. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1356525 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.server.common.StorageErrorReporter;
+import org.apache.hadoop.hdfs.server.common.Storage;
-      String fsName, long imageTxId, NNStorage dstStorage, boolean needDigest)
+      String fsName, long imageTxId, Storage dstStorage, boolean needDigest)
-      NNStorage storage, long txid) throws IOException {
+      Storage storage, long txid) throws IOException {
-      NNStorage dstStorage, boolean getChecksum) throws IOException {
-    byte[] buf = new byte[HdfsConstants.IO_FILE_BUFFER_SIZE];
+      Storage dstStorage, boolean getChecksum) throws IOException {
-    long startTime = Util.monotonicNow();
-
+    return doGetUrl(url, localPaths, dstStorage, getChecksum);
+  }
+  
+  public static MD5Hash doGetUrl(URL url, List<File> localPaths,
+      Storage dstStorage, boolean getChecksum) throws IOException {
+    long startTime = Util.monotonicNow();
-                            "by the namenode when trying to fetch " + str);
+                            "by the namenode when trying to fetch " + url);
-                  + " with file downloaded from " + str);
+                  + " with file downloaded from " + url);
-            if (dstStorage != null) {
-              dstStorage.reportErrorOnFile(f);
+            if (dstStorage != null &&
+                (dstStorage instanceof StorageErrorReporter)) {
+              ((StorageErrorReporter)dstStorage).reportErrorOnFile(f);
+      byte[] buf = new byte[HdfsConstants.IO_FILE_BUFFER_SIZE];
-        throw new IOException("File " + str + " received length " + received +
+        throw new IOException("File " + url + " received length " + received +
-        throw new IOException("File " + str + " computed digest " +
+        throw new IOException("File " + url + " computed digest " +

INS26 INS26 INS40 INS40 INS31 MOV29 INS83 INS43 INS42 MOV44 MOV44 INS44 INS44 INS44 INS43 INS8 INS83 UPD42 INS44 UPD43 UPD43 INS42 INS74 INS42 INS43 INS42 INS39 INS42 INS42 MOV60 MOV21 MOV60 INS41 INS43 INS42 UPD43 UPD42 UPD42 INS43 INS43 INS42 INS32 INS42 UPD42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 MOV60 UPD42 MOV43 MOV43 UPD42 UPD42 INS27 MOV27 INS36 INS62 UPD42 INS42 INS43 INS36 INS42 INS11 INS43 INS42 INS42 DEL42