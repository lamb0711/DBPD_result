Merging r1519884 through r1520449 from trunk to branch HDFS-2832

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2832@1520454 13f79535-47bb-0310-9956-ffa450edef68

+    CacheEntry(byte[] clientId, int callId, long expirationTime,
+        boolean success) {
+      this(clientId, callId, expirationTime);
+      this.state = success ? SUCCESS : FAILED;
+    }
+
+    CacheEntryWithPayload(byte[] clientId, int callId, Object payload,
+        long expirationTime, boolean success) {
+     super(clientId, callId, expirationTime, success);
+     this.payload = payload;
+   }
+
-        + expirationTime);
-    newEntry.completed(true);
-    set.put(newEntry);
+        + expirationTime, true);
+    synchronized(this) {
+      set.put(newEntry);
+    }
-    CacheEntry newEntry = new CacheEntryWithPayload(clientId, callId, payload,
-        System.nanoTime() + expirationTime);
-    newEntry.completed(true);
-    set.put(newEntry);
+    CacheEntry newEntry = new CacheEntryWithPayload(clientId, callId, payload,
+        System.nanoTime() + expirationTime, true);
+    synchronized(this) {
+      set.put(newEntry);
+    }

INS31 INS31 INS42 INS44 INS44 INS44 INS44 INS8 INS42 INS44 INS44 INS44 INS44 INS44 INS8 INS51 INS51 INS5 INS42 INS39 INS42 INS39 INS42 INS39 INS42 INS17 INS21 INS5 INS42 INS39 INS42 INS43 INS42 INS39 INS42 INS39 INS42 INS46 INS21 MOV43 INS52 INS8 INS52 INS8 INS39 INS85 INS42 INS42 INS42 INS7 INS39 INS85 INS42 INS42 INS42 INS42 INS42 INS7 MOV21 MOV21 INS22 INS16 INS22 INS42 MOV43 INS9 MOV32 INS9 INS52 INS42 INS42 INS42 INS42 INS52 INS42 MOV42 MOV42 MOV42 DEL42 DEL9 DEL42 DEL42 DEL9 DEL32 DEL21