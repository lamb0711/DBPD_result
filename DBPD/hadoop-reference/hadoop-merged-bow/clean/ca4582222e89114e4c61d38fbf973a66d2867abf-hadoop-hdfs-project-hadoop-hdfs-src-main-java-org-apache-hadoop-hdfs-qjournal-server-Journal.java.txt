HDFS-3885. QJM: optimize log sync when JN is lagging behind. Contributed by Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-3077@1383039 13f79535-47bb-0310-9956-ffa450edef68

+
+    // If the edit has already been marked as committed, we know
+    // it has been fsynced on a quorum of other nodes, and we are
+    // "catching up" with the rest. Hence we do not need to fsync.
+    boolean isLagging = lastTxnId <= committedTxnId.get();
+    boolean shouldFsync = !isLagging;
-    curSegment.flush();
+    curSegment.flush(shouldFsync);
-    
-    if (committedTxnId.get() > lastTxnId) {
+
+    if (isLagging) {

INS60 INS60 INS39 INS59 INS39 INS59 INS42 INS42 UPD27 MOV27 MOV32 INS42 INS38 INS42 INS42