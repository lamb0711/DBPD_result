HDFS-4805. Webhdfs client is fragile to token renewal errors. Contributed by Daryn Sharp.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1482121 13f79535-47bb-0310-9956-ffa450edef68

+  @VisibleForTesting
+  DelegationTokenRenewer.RenewAction<?> action;
-    dtRenewer.addRenewAction(webhdfs);
+    action = dtRenewer.addRenewAction(webhdfs);
-    if (!hasInitedToken) {
+    // we haven't inited yet, or we used to have a token but it expired
+    if (!hasInitedToken || (action != null && !action.isValid())) {

INS23 INS78 INS74 INS59 INS42 INS43 INS76 INS42 INS40 INS7 INS27 INS42 MOV32 MOV38 INS36 INS27 INS27 INS38 INS42 INS33 INS32 INS42 INS42