HDFS-3689. Add support for variable length block. Contributed by Jing Zhao.

+    if (flag.contains(CreateFlag.NEW_BLOCK)) {
+      value |= CreateFlagProto.NEW_BLOCK.getNumber();
+    }
-    return new EnumSetWritable<CreateFlag>(result);
+    if ((flag & CreateFlagProto.NEW_BLOCK_VALUE)
+        == CreateFlagProto.NEW_BLOCK_VALUE) {
+      result.add(CreateFlag.NEW_BLOCK);
+    }
+    return new EnumSetWritable<CreateFlag>(result, CreateFlag.class);
-            InotifyProtos.AppendEventProto reopen =
+            InotifyProtos.AppendEventProto append =
-            events.add(new Event.AppendEvent.Builder()
-                  .path(reopen.getPath())
-                  .build());
+            events.add(new Event.AppendEvent.Builder().path(append.getPath())
+                .newBlock(append.hasNewBlock() && append.getNewBlock())
+                .build());
-                .setContents(
-                    InotifyProtos.AppendEventProto.newBuilder()
-                        .setPath(re2.getPath()).build().toByteString()
-                ).build());
+                .setContents(InotifyProtos.AppendEventProto.newBuilder()
+                    .setPath(re2.getPath())
+                    .setNewBlock(re2.toNewBlock()).build().toByteString())
+                .build());

INS25 INS25 INS32 INS8 INS27 INS8 INS42 INS42 INS40 INS21 INS36 INS40 INS21 INS57 INS7 INS27 INS32 INS43 INS42 INS32 INS42 INS40 INS42 INS42 INS40 INS42 INS40 INS42 UPD42 INS32 MOV32 INS42 INS27 INS32 INS32 INS32 MOV32 INS42 UPD42 INS42 INS42 INS42 INS42 UPD42 INS42 INS32 UPD42 MOV42 INS42