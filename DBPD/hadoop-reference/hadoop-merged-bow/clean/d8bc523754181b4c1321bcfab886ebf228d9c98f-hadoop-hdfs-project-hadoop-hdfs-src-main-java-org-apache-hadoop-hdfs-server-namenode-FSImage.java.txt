HDFS-5753. Add new NN startup options for downgrade and rollback using upgrade marker.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1559907 13f79535-47bb-0310-9956-ffa450edef68

-    return loadFSImage(target, recovery);
+    return loadFSImage(target, startOpt, recovery);
-    this.loadFSImage(target, null);
+    this.loadFSImage(target, null, null);
-  boolean loadFSImage(FSNamesystem target, MetaRecoveryContext recovery)
+  private boolean loadFSImage(FSNamesystem target, StartupOption startOpt,
+      MetaRecoveryContext recovery)
-    long txnsAdvanced = loadEdits(editStreams, target, recovery);
+    long txnsAdvanced = loadEdits(editStreams, target, startOpt, recovery);
-      FSNamesystem target, MetaRecoveryContext recovery) throws IOException {
+      FSNamesystem target) throws IOException {
+    return loadEdits(editStreams, target, null, null);
+  }
+
+  private long loadEdits(Iterable<EditLogInputStream> editStreams,
+      FSNamesystem target, StartupOption startOpt, MetaRecoveryContext recovery)
+          throws IOException {
-          loader.loadFSEdits(editIn, lastAppliedTxId + 1, recovery);
+          loader.loadFSEdits(editIn, lastAppliedTxId + 1, startOpt, recovery);

INS31 INS83 INS44 MOV29 INS83 INS39 INS42 INS44 INS44 INS43 INS8 UPD83 INS44 INS43 INS42 INS74 INS42 INS43 INS42 INS42 INS41 INS43 INS42 INS42 INS43 INS43 INS42 INS32 INS42 INS42 INS33 INS42 INS42 INS42 INS42 INS42 INS33 INS33 INS42 INS42