YARN-2046. Out of band heartbeats are sent only on container kill and possibly too early. Contributed by Ming Ma

+import org.apache.hadoop.yarn.server.nodemanager.Context;
+  private Context context;
-      NMStateStoreService stateStore, ContainerLaunchContext launchContext,
-      Credentials creds, NodeManagerMetrics metrics,
-      ContainerTokenIdentifier containerTokenIdentifier) {
+      ContainerLaunchContext launchContext, Credentials creds,
+      NodeManagerMetrics metrics,
+      ContainerTokenIdentifier containerTokenIdentifier, Context context) {
-    this.stateStore = stateStore;
+    this.stateStore = context.getNMStateStore();
+    this.context = context;
-      NMStateStoreService stateStore, ContainerLaunchContext launchContext,
-      Credentials creds, NodeManagerMetrics metrics,
+      ContainerLaunchContext launchContext, Credentials creds,
+      NodeManagerMetrics metrics,
-      String diagnostics, boolean wasKilled, Resource recoveredCapability) {
-    this(conf, dispatcher, stateStore, launchContext, creds, metrics,
-        containerTokenIdentifier);
+      String diagnostics, boolean wasKilled, Resource recoveredCapability,
+      Context context) {
+    this(conf, dispatcher, launchContext, creds, metrics,
+        containerTokenIdentifier, context);
-      if (container.getCurrentState() 
+      if (container.getCurrentState()
+      container.context.getNodeStatusUpdater().sendOutofBandHeartBeat();

INS26 INS40 INS23 MOV44 MOV44 INS83 INS43 INS59 INS42 INS42 UPD43 UPD42 INS21 UPD43 UPD42 UPD42 INS7 UPD42 INS42 INS21 INS32 INS22 INS42 INS32 INS42 INS42 INS52 INS42 INS32 INS42 INS40 INS42 DEL42 DEL42