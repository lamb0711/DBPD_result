Revert "YARN-4502. Fix two AM containers get allocated when AM restart. (Vinod Kumar Vavilapalli via wangda)"

This reverts commit 805a9ed85eb34c8125cfb7d26d07cdfac12b3579.

-   * @param rmContainer rmContainer
+   * @param rmContainer
-  private void recoverResourceRequestForContainer(RMContainer rmContainer) {
+  protected void recoverResourceRequestForContainer(RMContainer rmContainer) {
-
-    // Add resource request back to Scheduler ApplicationAttempt.
-
-    // We lookup the application-attempt here again using
-    // getCurrentApplicationAttempt() because there is only one app-attempt at
-    // any point in the scheduler. But in corner cases, AMs can crash,
-    // corresponding containers get killed and recovered to the same-attempt,
-    // but because the app-attempt is extinguished right after, the recovered
-    // requests don't serve any purpose, but that's okay.
-    SchedulerApplicationAttempt schedulerAttempt =
-        getCurrentAttemptForContainer(rmContainer.getContainerId());
+    // Add resource request back to Scheduler.
+    SchedulerApplicationAttempt schedulerAttempt 
+        = getCurrentAttemptForContainer(rmContainer.getContainerId());
-      schedulerAttempt.recoverResourceRequestsForContainer(requests);
+      schedulerAttempt.recoverResourceRequests(requests);
-  @VisibleForTesting
-  @Private
-  public void completedContainer(RMContainer rmContainer,
-      ContainerStatus containerStatus, RMContainerEventType event) {
-
-    if (rmContainer == null) {
-      LOG.info("Container " + containerStatus.getContainerId()
-          + " completed with event " + event
-          + ", but corresponding RMContainer doesn't exist.");
-      return;
-    }
-
-    completedContainerInternal(rmContainer, containerStatus, event);
-
-    // If the container is getting killed in ACQUIRED state, the requester (AM
-    // for regular containers and RM itself for AM container) will not know what
-    // happened. Simply add the ResourceRequest back again so that requester
-    // doesn't need to do anything conditionally.
-    recoverResourceRequestForContainer(rmContainer);
-  }
-
-  // clean up a completed container
-  protected abstract void completedContainerInternal(RMContainer rmContainer,
+  protected abstract void completedContainer(RMContainer rmContainer,

UPD83 UPD42 UPD42 DEL66 DEL42 DEL78 DEL42 DEL78 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL33 DEL27 DEL42 DEL42 DEL45 DEL42 DEL42 DEL32 DEL45 DEL42 DEL45 DEL27 DEL32 DEL21 DEL41 DEL8 DEL25 DEL42 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL32 DEL21 DEL8 DEL31