YARN-443. allow OS scheduling priority of NM to be different than the containers it launches (tgraves)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1454411 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.ArrayList;
+import java.util.Arrays;
+import org.apache.hadoop.yarn.conf.YarnConfiguration;
-  /** Return a command to execute the given command in OS shell.
+  /** 
+   *  Return a command to execute the given command in OS shell.
-   *  non-Windows, groupId is ignored. */
-  protected static String[] getRunCommand(String command,
-                                          String groupId) {
+   *  non-Windows, groupId is ignored. 
+   */
+  protected static String[] getRunCommand(String command, String groupId,
+                                          Configuration conf) {
+    boolean containerSchedPriorityIsSet = false;
+    int containerSchedPriorityAdjustment = 
+        YarnConfiguration.DEFAULT_NM_CONTAINER_EXECUTOR_SCHED_PRIORITY;
+
+    if (conf.get(YarnConfiguration.NM_CONTAINER_EXECUTOR_SCHED_PRIORITY) != 
+        null) {
+      containerSchedPriorityIsSet = true;
+      containerSchedPriorityAdjustment = conf 
+          .getInt(YarnConfiguration.NM_CONTAINER_EXECUTOR_SCHED_PRIORITY, 
+          YarnConfiguration.DEFAULT_NM_CONTAINER_EXECUTOR_SCHED_PRIORITY);
+    }
+  
-        "cmd /c " + command };
+          "cmd /c " + command };
-      return new String[] { "bash", "-c", command };
+      List<String> retCommand = new ArrayList<String>();
+      if (containerSchedPriorityIsSet) {
+        retCommand.addAll(Arrays.asList("nice", "-n",
+            Integer.toString(containerSchedPriorityAdjustment)));
+      }
+      retCommand.addAll(Arrays.asList("bash", "-c", command));
+      return retCommand.toArray(new String[retCommand.size()]);
+

INS26 INS26 INS26 INS40 INS40 INS40 INS44 INS43 INS42 INS60 INS60 INS25 INS42 INS39 INS59 INS39 INS59 INS27 INS8 INS8 INS42 INS9 INS42 INS40 INS32 INS33 INS21 INS21 INS60 INS25 INS21 MOV41 INS42 INS42 INS40 INS7 INS7 INS74 INS59 INS42 MOV8 INS32 INS32 INS42 INS9 INS42 INS32 INS43 INS43 INS42 INS14 INS21 INS42 INS42 INS32 INS42 INS42 MOV3 INS42 INS42 INS40 INS40 INS42 INS42 INS74 INS32 INS42 INS42 INS45 INS45 INS42 INS32 INS43 INS43 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS45 INS45 INS32 INS42 INS42 INS42 DEL45 DEL45 DEL42 DEL4