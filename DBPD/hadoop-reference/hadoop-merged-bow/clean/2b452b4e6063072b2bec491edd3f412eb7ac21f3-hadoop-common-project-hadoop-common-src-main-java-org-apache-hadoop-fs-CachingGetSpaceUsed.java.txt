HDFS-14986. ReplicaCachingGetSpaceUsed throws ConcurrentModificationException. Contributed by Aiphago.

+  private boolean shouldFirstRefresh;
+    this.shouldFirstRefresh = true;
+      if (!shouldFirstRefresh) {
+        // Skip initial refresh operation, so we need to do first refresh
+        // operation immediately in refresh thread.
+        initRefeshThread(true);
+        return;
+      }
+    initRefeshThread(false);
+  }
+  /**
+   * RunImmediately should set true, if we skip the first refresh.
+   * @param runImmediately The param default should be false.
+   */
+  private void initRefeshThread (boolean runImmediately) {
-      refreshUsed = new Thread(new RefreshThread(this),
+      refreshUsed = new Thread(new RefreshThread(this, runImmediately),
+   * Reset that if we need to do the first refresh.
+   * @param shouldFirstRefresh The flag value to set.
+   */
+  protected void setShouldFirstRefresh(boolean shouldFirstRefresh) {
+    this.shouldFirstRefresh = shouldFirstRefresh;
+  }
+
+  /**
+    private boolean runImmediately;
-    RefreshThread(CachingGetSpaceUsed spaceUsed) {
+    RefreshThread(CachingGetSpaceUsed spaceUsed, boolean runImmediately) {
+      this.runImmediately = runImmediately;
-          Thread.sleep(refreshInterval);
+          if (!runImmediately) {
+            Thread.sleep(refreshInterval);
+          }
+          runImmediately = false;

INS23 INS31 INS31 INS83 INS39 INS59 INS39 INS42 INS8 INS29 INS83 UPD42 INS44 INS29 INS83 INS39 INS42 INS44 INS8 INS23 INS42 INS21 MOV25 INS21 INS65 INS65 INS39 INS42 INS65 INS65 INS39 INS42 INS21 INS83 INS39 INS59 INS44 INS7 INS32 INS66 INS42 INS66 INS66 INS42 INS66 INS7 INS42 INS39 INS42 INS21 INS22 INS9 INS25 INS42 INS9 INS22 INS42 INS7 INS52 INS42 INS38 INS8 INS52 INS42 INS22 INS42 INS42 INS21 INS41 INS52 INS42 INS32 INS25 INS21 INS42 INS9 INS42 INS38 INS8 INS7 INS42 MOV21 INS42 INS9