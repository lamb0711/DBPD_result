HDFS-15464: ViewFsOverloadScheme should work when -fs option pointing to remote cluster without mount links (#2132). Contributed by Uma Maheswara Rao G.


+import org.apache.hadoop.fs.FileSystem;
-  private final INodeLink<T> rootFallbackLink;
+  private INodeLink<T> rootFallbackLink;
-  protected InodeTree(final Configuration config, final String viewName)
+  protected InodeTree(final Configuration config, final String viewName,
+      final URI theUri, boolean initingUriAsFallbackOnNoMounts)
-      throw new IOException(
-          "ViewFs: Cannot initialize: Empty Mount table in config for " +
-              "viewfs://" + mountTableName + "/");
+      if (!initingUriAsFallbackOnNoMounts) {
+        throw new IOException(
+            "ViewFs: Cannot initialize: Empty Mount table in config for "
+                + "viewfs://" + mountTableName + "/");
+      }
+      StringBuilder msg =
+          new StringBuilder("Empty mount table detected for ").append(theUri)
+              .append(" and considering itself as a linkFallback.");
+      FileSystem.LOG.info(msg.toString());
+      rootFallbackLink =
+          new INodeLink<T>(mountTableName, ugi, getTargetFileSystem(theUri),
+              theUri);
+      getRootDir().addFallbackLink(rootFallbackLink);

INS26 INS40 INS44 INS44 INS83 INS43 INS42 INS39 INS42 INS25 INS42 MOV38 INS8 MOV25 INS60 INS21 INS21 INS21 INS38 INS43 INS59 INS32 INS7 INS32 INS42 INS42 INS42 INS32 INS40 INS42 INS32 INS42 INS14 INS32 INS42 INS42 INS32 INS42 INS45 INS42 INS42 INS74 INS42 INS42 INS32 INS42 INS42 INS14 INS42 INS42 INS43 INS43 INS42 INS42 INS43 INS45 INS42 INS42 INS42 DEL83