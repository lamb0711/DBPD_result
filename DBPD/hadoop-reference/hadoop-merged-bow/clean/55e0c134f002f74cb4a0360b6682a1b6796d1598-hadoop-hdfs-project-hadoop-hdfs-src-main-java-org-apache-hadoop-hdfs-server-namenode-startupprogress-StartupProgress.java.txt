HDFS-14500. NameNode StartupProgress should not allow new steps in an already-completed phase. Contributed by Erik Krogen.

-   * Begins execution of the specified step within the specified phase.
+   * Begins execution of the specified step within the specified phase. This is
+   * a no-op if the phase is already completed.
-   * @param phase Phase to begin
+   * @param phase Phase within which the step should be started
-    if (!isComplete()) {
+    if (!isComplete(phase)) {
-   * Ends execution of the specified step within the specified phase.
-   * 
-   * @param phase Phase to end
+   * Ends execution of the specified step within the specified phase. This is
+   * a no-op if the phase is already completed.
+   *
+   * @param phase Phase within which the step should be ended
-    if (!isComplete()) {
+    if (!isComplete(phase)) {
-    if (!isComplete()) {
+    if (!isComplete(phase)) {
-    for (Phase phase: EnumSet.allOf(Phase.class)) {
-      if (getStatus(phase) != Status.COMPLETE) {
-        return false;
-      }
-    }
-    return true;
+    return EnumSet.allOf(Phase.class).stream().allMatch(this::isComplete);
+  }
+
+  /**
+   * Returns true if the given startup phase has been completed.
+   *
+   * @param phase Which phase to check for completion
+   * @return boolean true if the given startup phase has completed.
+   */
+  private boolean isComplete(Phase phase) {
+    return getStatus(phase) == Status.COMPLETE;

INS31 INS29 INS83 INS39 INS42 MOV44 MOV8 INS65 INS65 INS65 MOV41 UPD66 INS66 UPD66 UPD66 INS66 UPD66 INS32 INS66 INS42 INS66 INS66 UPD27 MOV27 INS32 INS42 INS90 INS42 INS42 INS42 MOV32 INS42 INS52 INS42 DEL70 DEL9 DEL9 DEL8 DEL25