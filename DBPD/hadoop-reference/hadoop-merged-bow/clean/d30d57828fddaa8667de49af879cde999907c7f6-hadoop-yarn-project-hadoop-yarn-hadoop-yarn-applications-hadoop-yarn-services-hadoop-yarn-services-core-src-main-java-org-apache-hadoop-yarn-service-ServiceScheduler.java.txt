YARN-6669.  Implemented Kerberos security for YARN service framework.  (Contributed by Jian He)

+import org.apache.commons.lang3.StringUtils;
+import org.apache.hadoop.security.HadoopKerberosName;
-      throws YarnException {
+      throws YarnException, IOException {
-    RegistryOperations registryClient = RegistryOperationsFactory
-        .createInstance("ServiceScheduler", configuration);
+    RegistryOperations registryClient = null;
+    if (UserGroupInformation.isSecurityEnabled() &&
+        !StringUtils.isEmpty(context.principal)
+        && !StringUtils.isEmpty(context.keytab)) {
+      Configuration conf = getConfig();
+      // Only take the first section of the principal
+      // e.g. hdfs-demo@EXAMPLE.COM will take hdfs-demo
+      // This is because somehow zookeeper client only uses the first section
+      // for acl validations.
+      String username = new HadoopKerberosName(context.principal.trim())
+          .getServiceName();
+      LOG.info("Set registry user accounts: sasl:" + username);
+      conf.set(KEY_REGISTRY_USER_ACCOUNTS, "sasl:" + username);
+      registryClient = RegistryOperationsFactory
+          .createKerberosInstance(conf,
+              "Client", context.principal, context.keytab);
+    } else {
+      registryClient = RegistryOperationsFactory
+          .createInstance("ServiceScheduler", configuration);
+    }
-    containerLaunchService = new ContainerLaunchService(context.fs);
+    containerLaunchService = new ContainerLaunchService(context);
-              "Failed to register app " + app.getName() + " in registry");
+              "Failed to register app " + app.getName() + " in registry", e);

INS26 INS26 INS40 INS40 INS43 INS42 INS25 INS27 INS8 INS8 INS33 INS32 INS38 INS38 INS60 INS60 INS21 INS21 INS21 INS21 INS42 INS42 INS32 INS32 INS43 INS59 INS43 INS59 INS32 INS32 INS7 INS7 INS42 INS42 INS42 INS40 INS42 INS42 INS40 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS27 INS42 INS42 INS42 INS27 INS42 INS32 INS42 MOV32 INS42 INS14 INS42 INS45 INS42 INS45 INS42 INS42 INS42 INS42 INS45 INS40 INS40 INS43 INS32 INS42 INS40 INS42 INS42 DEL40