HDFS-12904. Add DataTransferThrottler to the Datanode transfers. Contributed by Lisheng Sun.

+import org.apache.hadoop.hdfs.util.DataTransferThrottler;
+    /** Throttle to block replication when data transfers. */
+    private DataTransferThrottler transferThrottler;
+
+      // 1. the stage is PIPELINE_SETUP_CREATEï¼Œthat is moving blocks, set
+      // throttler.
+      // 2. the stage is PIPELINE_SETUP_APPEND_RECOVERY or
+      // PIPELINE_SETUP_STREAMING_RECOVERY,
+      // that is writing and recovering pipeline, don't set throttle.
+      if (stage == BlockConstructionStage.PIPELINE_SETUP_CREATE
+          && clientname.isEmpty()) {
+        this.transferThrottler = xserver.getTransferThrottler();
+      }
-        blockSender.sendBlock(out, unbufOut, null);
+        blockSender.sendBlock(out, unbufOut, transferThrottler);

INS26 INS40 INS23 INS29 INS83 INS43 INS59 INS65 INS42 INS42 INS25 INS66 INS27 INS8 INS27 INS32 INS21 INS42 INS40 INS42 INS42 INS7 INS22 INS32 INS42 INS52 INS42 INS42 INS42 DEL33