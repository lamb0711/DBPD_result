YARN-7064. Use cgroup to get container resource utilization. (Miklos Szegedi via Haibo Chen)

+  /**
+   * Get the best process tree calculator.
+   * @param pId container process id
+   * @return process tree calculator
+   */
+  private ResourceCalculatorProcessTree
+      getResourceCalculatorProcessTree(String pId) {
+    return ResourceCalculatorProcessTree.
+        getResourceCalculatorProcessTree(
+            pId, processTreeClass, conf);
+  }
+
-    if (ResourceCalculatorProcessTree
-        .getResourceCalculatorProcessTree("0", processTreeClass, conf)
-        == null) {
+    if (getResourceCalculatorProcessTree("0") == null) {
-                  ResourceCalculatorProcessTree.
-                        getResourceCalculatorProcessTree(
-                            pId, processTreeClass, conf);
+              getResourceCalculatorProcessTree(pId);
-                "Memory usage of ProcessTree %s for container-id %s: ",
-                pId, containerId.toString()) +
-                formatUsageString(
-                      currentVmemUsage, vmemLimit,
-                      currentPmemUsage, pmemLimit));
+            "Resource usage of ProcessTree %s for container-id %s:" +
+                " %s CPU:%f CPU/core:%f",
+            pId, containerId.toString(),
+            formatUsageString(
+                currentVmemUsage, vmemLimit,
+                currentPmemUsage, pmemLimit),
+            cpuUsagePercentPerCore,
+            cpuUsageTotalCoresPercentage));

INS31 INS29 INS83 MOV43 INS42 INS44 INS8 INS65 INS65 INS65 INS43 INS42 INS41 INS66 INS42 INS66 INS66 INS42 MOV32 INS32 INS42 INS42 MOV32 INS43 MOV42 MOV42 INS27 MOV42 MOV32 MOV32 INS42 INS42 INS42 INS32 INS45 INS45 INS42 INS42 DEL42 DEL42 DEL42 DEL42 DEL42 DEL45 DEL32 DEL27