HDFS-8920. Erasure Coding: when recovering lost blocks, logs can be too verbose and hurt performance. Contributed by Rui Li

+import java.util.ArrayList;
+import java.util.Collections;
+import java.util.List;
+  /**
+   * When warning the user of a lost block in striping mode, we remember the
+   * dead nodes we've logged. All other striping blocks on these nodes can be
+   * considered lost too, and we don't want to log a warning for each of them.
+   * This is to prevent the log from being too verbose. Refer to HDFS-8920.
+   *
+   * To minimize the overhead, we only store the datanodeUuid in this set
+   */
+  private final Set<String> warnedNodes = Collections.newSetFromMap(
+      new ConcurrentHashMap<String, Boolean>());
+
+  @Override
+  protected void reportLostBlock(LocatedBlock lostBlock,
+      Collection<DatanodeInfo> ignoredNodes) {
+    DatanodeInfo[] nodes = lostBlock.getLocations();
+    if (nodes != null && nodes.length > 0) {
+      List<String> dnUUIDs = new ArrayList<>();
+      for (DatanodeInfo node : nodes) {
+        dnUUIDs.add(node.getDatanodeUuid());
+      }
+      if (!warnedNodes.containsAll(dnUUIDs)) {
+        DFSClient.LOG.warn(Arrays.toString(nodes) + " are unavailable and " +
+            "all striping blocks on them are lost. " +
+            "IgnoredNodes = " + ignoredNodes);
+        warnedNodes.addAll(dnUUIDs);
+      }
+    } else {
+      super.reportLostBlock(lostBlock, ignoredNodes);
+    }
+  }
+

INS26 INS26 INS26 INS40 INS40 INS40 INS23 INS31 INS29 INS83 INS83 INS74 INS59 INS78 INS83 INS39 INS42 INS44 INS44 INS8 INS65 INS43 INS43 INS42 INS32 INS42 INS43 INS42 INS74 INS42 INS60 INS25 INS66 INS66 INS66 INS66 INS66 INS42 INS42 INS42 INS42 INS14 INS42 INS43 INS43 INS5 INS59 INS27 INS8 INS8 INS74 INS42 INS42 INS43 INS85 INS42 INS32 INS27 INS27 INS60 INS70 INS25 INS21 INS43 INS43 INS43 INS42 INS42 INS42 INS42 INS33 INS40 INS34 INS74 INS59 INS44 INS42 INS8 INS38 INS8 INS48 INS42 INS42 INS42 INS43 INS43 INS42 INS14 INS43 INS42 INS21 INS32 INS21 INS21 INS42 INS42 INS42 INS42 INS42 INS74 INS42 INS32 INS42 INS42 INS42 INS32 INS32 INS43 INS42 INS42 INS32 INS40 INS42 INS27 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS45 INS45 INS45 INS42 INS42 INS42 INS42