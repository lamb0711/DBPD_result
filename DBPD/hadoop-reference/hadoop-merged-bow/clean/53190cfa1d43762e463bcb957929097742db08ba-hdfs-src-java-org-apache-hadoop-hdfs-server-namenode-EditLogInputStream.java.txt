HDFS-2187. Make EditLogInputStream act like an iterator over FSEditLogOps. Contributed by Ivan Kelly and Todd Lipcon.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1153996 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.BufferedInputStream;
-import java.io.DataInputStream;
+import java.io.Closeable;
-import java.io.InputStream;
-abstract class EditLogInputStream extends InputStream
-implements JournalStream {
-  /** {@inheritDoc} */
-  public abstract int available() throws IOException;
-
-  /** {@inheritDoc} */
-  public abstract int read() throws IOException;
-
-  /** {@inheritDoc} */
-  public abstract int read(byte[] b, int off, int len) throws IOException;
-
-  /** {@inheritDoc} */
+abstract class EditLogInputStream implements JournalStream, Closeable {
+  /**
+   * Close the stream.
+   * @throws IOException if an error occurred while closing
+   */
+  /** 
+   * Read an operation from the stream
+   * @return an operation from the stream or null if at end of stream
+   * @throws IOException if there is an error reading from the stream
+   */
+  public abstract FSEditLogOp readOp() throws IOException;
+
+  /** 
+   * Get the layout version of the data in the stream.
+   * @return the layout version of the ops in the stream.
+   * @throws IOException if there is an error reading the version
+   */
+  public abstract int getVersion() throws IOException;
+
+  /**
+   * Get the "position" of in the stream. This is useful for 
+   * debugging and operational purposes.
+   *
+   * Different stream types can have a different meaning for 
+   * what the position is. For file streams it means the byte offset
+   * from the start of the file.
+   *
+   * @return the position in the stream
+   */
+  public abstract long getPosition();
+
-
-  /**
-   * Return DataInputStream based on this edit stream.
-   */
-  DataInputStream getDataInputStream() {
-    return new DataInputStream(new BufferedInputStream(this));
-  }

MOV26 MOV43 UPD40 UPD43 UPD42 UPD39 UPD42 INS43 UPD42 INS42 MOV43 UPD39 UPD42 INS65 INS65 INS65 INS65 INS65 INS42 INS65 INS65 INS65 INS65 INS65 INS66 INS42 UPD66 MOV66 INS66 INS66 INS42 UPD66 MOV66 INS66 INS66 INS42 UPD66 MOV66 INS66 INS66 INS66 INS66 INS66 UPD66 MOV66 DEL40 DEL26 DEL40 DEL26 DEL65 DEL65 DEL65 DEL65 DEL39 DEL65 DEL65 DEL42 DEL39 DEL85 DEL5 DEL42 DEL44 DEL39 DEL42 DEL44 DEL39 DEL42 DEL44 DEL42 DEL43 DEL65 DEL65 DEL66 DEL65 DEL29 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL43 DEL52 DEL14 DEL14 DEL41 DEL8 DEL31