Merge changes from trunk

+    if (type.size == 0) return;
+    if (type.size == 0) return;

INS25 INS25 INS27 INS41 INS27 INS41 INS40 INS34 INS40 INS34