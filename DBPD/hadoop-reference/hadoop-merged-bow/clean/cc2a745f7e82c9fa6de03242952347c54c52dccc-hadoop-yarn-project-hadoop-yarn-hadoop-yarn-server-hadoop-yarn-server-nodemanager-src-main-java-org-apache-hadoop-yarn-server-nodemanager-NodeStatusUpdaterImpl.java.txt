YARN-2997. Fixed NodeStatusUpdater to not send alreay-sent completed container statuses on heartbeat. Contributed by Chengbing Liu

+  // Save the reported completed containers in case of lost heartbeat responses.
+  // These completed containers will be sent again till a successful response.
+  private final Map<ContainerId, ContainerStatus> pendingCompletedContainers;
+    this.pendingCompletedContainers =
+        new HashMap<ContainerId, ContainerStatus>();
-      ApplicationId applicationId = container.getContainerId()
-          .getApplicationAttemptId().getApplicationId();
+      ApplicationId applicationId = containerId.getApplicationAttemptId()
+          .getApplicationId();
-      containerStatuses.add(containerStatus);
+          pendingCompletedContainers.put(containerId, containerStatus);
-          // Adding to finished containers cache. Cache will keep it around at
-          // least for #durationToTrackStoppedContainers duration. In the
-          // subsequent call to stop container it will get removed from cache.
-          addCompletedContainer(container.getContainerId());
+          if (!isContainerRecentlyStopped(containerId)) {
+            pendingCompletedContainers.put(containerId, containerStatus);
+            // Adding to finished containers cache. Cache will keep it around at
+            // least for #durationToTrackStoppedContainers duration. In the
+            // subsequent call to stop container it will get removed from cache.
+            addCompletedContainer(containerId);
+          }
+      } else {
+        containerStatuses.add(containerStatus);
+    containerStatuses.addAll(pendingCompletedContainers.values());
-      ApplicationId applicationId = container.getContainerId()
-          .getApplicationAttemptId().getApplicationId();
+      ApplicationId applicationId = containerId.getApplicationAttemptId()
+          .getApplicationId();
-        addCompletedContainer(container.getContainerId());
+        addCompletedContainer(containerId);
-      if (nmContainer != null && nmContainer.getContainerState().equals(
+      if (nmContainer == null) {
+        iter.remove();
+      } else if (nmContainer.getContainerState().equals(
+    pendingCompletedContainers.clear();
-  
+
+              pendingCompletedContainers.clear();

INS23 INS83 INS83 INS74 INS59 INS43 INS43 INS43 INS42 INS21 INS21 INS21 INS42 INS42 INS42 INS7 INS32 INS32 INS22 INS14 INS42 INS42 INS32 INS25 INS42 INS42 INS52 INS42 INS74 INS8 INS42 INS42 INS27 INS8 MOV25 INS43 INS43 INS43 MOV21 INS42 INS33 INS21 MOV32 INS42 INS42 INS42 INS8 INS32 UPD42 MOV42 INS21 INS25 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS32 INS38 MOV8 INS42 INS42 INS42 INS42 INS32 INS21 INS42 INS42 INS32 UPD42 INS42 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS21 INS32 INS42 INS42 DEL42 DEL32 DEL32 DEL42 DEL32 DEL42 DEL32 DEL42 DEL33 DEL27 DEL27