YARN-2656. Made RM web services authentication filter support proxy user. Contributed by Varun Vasudev and Zhijie Shen.

+import org.apache.hadoop.security.token.delegation.web.DelegationTokenAuthenticationHandler;
-    if (!KerberosAuthenticationHandler.TYPE.equals(authType)) {
+    if (!KerberosAuthenticationHandler.TYPE.equalsIgnoreCase(authType)) {
-              + "Kerberos authenticated channel";
+              + "Kerberos authenticated channel. Expected auth type is "
+              + KerberosAuthenticationHandler.TYPE + ", got type " + authType;
+      throw new YarnException(msg);
+    }
+    if (hsr
+      .getAttribute(DelegationTokenAuthenticationHandler.DELEGATION_TOKEN_UGI_ATTRIBUTE) != null) {
+      String msg =
+          "Delegation token operations cannot be carried out using delegation"
+              + " token authentication.";

INS26 INS40 INS25 INS27 INS8 INS32 INS33 INS60 INS53 UPD42 INS42 INS42 INS40 INS43 INS59 INS14 INS27 INS42 INS42 INS27 INS43 INS42 INS27 INS40 INS45 INS42 INS45 INS45 INS42 MOV45 UPD45 MOV45 DEL27