Command hdfs dfs -rm -r can't remove empty directory. Contributed by Yongjun Zhang.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1594036 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.hdfs.util.ReadOnlyList;
+   * @param ignoreEmptyDir Ignore permission checking for empty directory?
-      FsAction subAccess, boolean resolveLink)
+      FsAction subAccess, boolean ignoreEmptyDir, boolean resolveLink)
+          + ", ignoreEmptyDir=" + ignoreEmptyDir
-      checkSubAccess(last, snapshotId, subAccess);
+      checkSubAccess(last, snapshotId, subAccess, ignoreEmptyDir);
-  private void checkSubAccess(INode inode, int snapshotId, FsAction access
-      ) throws AccessControlException {
+  private void checkSubAccess(INode inode, int snapshotId, FsAction access,
+      boolean ignoreEmptyDir) throws AccessControlException {
-      check(d, snapshotId, access);
+      ReadOnlyList<INode> cList = d.getChildrenList(snapshotId);
+      if (!(cList.isEmpty() && ignoreEmptyDir)) {
+        check(d, snapshotId, access);
+      }
-      for(INode child : d.getChildrenList(snapshotId)) {
+      for(INode child : cList) {

INS26 INS40 INS44 INS44 INS65 INS39 INS42 INS39 INS42 INS42 INS66 INS60 INS25 INS74 INS59 INS38 INS8 INS42 INS42 INS43 INS43 INS42 MOV32 INS36 MOV21 INS45 INS42 INS42 INS42 INS27 INS32 INS42 INS42 INS42