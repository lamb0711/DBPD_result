HDFS-13713. Add specification of Multipart Upload API to FS specification, with contract tests.

Contributed by Ewan Higgs and Steve Loughran.

+import java.util.ArrayList;
+import java.util.Map;
+import java.util.UUID;
-import com.google.common.base.Preconditions;
-import org.apache.commons.lang3.tuple.Pair;
+import static org.apache.hadoop.io.IOUtils.cleanupWithLogger;
-
+    checkPutArguments(filePath, inputStream, partNumber, uploadId,
+        lengthInBytes);
-      org.apache.hadoop.io.IOUtils.cleanupWithLogger(LOG, inputStream);
+      cleanupWithLogger(LOG, inputStream);
+    String uuid = UUID.randomUUID().toString();
-            mergePaths(new Path("_multipart"),
+            mergePaths(new Path("_multipart_" + uuid),
-  public PathHandle complete(Path filePath,
-      List<Pair<Integer, PartHandle>> handles, UploadHandle multipartUploadId)
-      throws IOException {
+  public PathHandle complete(Path filePath, Map<Integer, PartHandle> handleMap,
+      UploadHandle multipartUploadId) throws IOException {
-    if (handles.isEmpty()) {
-      throw new IOException("Empty upload");
-    }
-    // If destination already exists, we believe we already completed it.
-    if (fs.exists(filePath)) {
-      return getPathHandle(filePath);
-    }
+    checkPartHandles(handleMap);
+    List<Map.Entry<Integer, PartHandle>> handles =
+        new ArrayList<>(handleMap.entrySet());
+    handles.sort(Comparator.comparingInt(Map.Entry::getKey));
-    handles.sort(Comparator.comparing(Pair::getKey));
-    Path collectorPath = createCollectorPath(filePath);
+    byte[] uploadIdByteArray = multipartUploadId.toByteArray();
+    Path collectorPath = new Path(new String(uploadIdByteArray, 0,
+        uploadIdByteArray.length, Charsets.UTF_8));
+

MOV26 MOV26 INS26 INS26 UPD40 INS40 INS40 UPD40 INS21 INS60 UPD74 MOV74 UPD42 INS21 INS60 INS60 INS32 INS43 INS59 UPD43 INS32 INS74 INS59 INS5 INS59 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 UPD42 UPD42 MOV42 UPD42 MOV42 MOV43 INS74 INS42 INS14 INS39 INS85 INS42 INS32 INS14 INS32 INS42 INS43 INS43 INS43 INS74 INS32 UPD42 INS42 INS42 INS43 INS14 INS42 INS42 INS40 UPD42 MOV42 INS42 INS43 UPD42 MOV42 UPD42 MOV42 INS40 INS42 INS43 INS42 INS34 INS40 INS40 INS27 INS42 INS42 INS45 INS42 DEL40 DEL45 DEL74 DEL32 DEL43 DEL45 DEL14 DEL53 DEL8 DEL25 DEL42 DEL42 DEL42 DEL32 DEL32 DEL41 DEL8 DEL25 DEL42 DEL42 DEL42 DEL32