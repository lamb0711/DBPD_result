 MAPREDUCE-2807. Fix AM restart and client redirection. Contributed by Sharad Agarwal.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1161408 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.hadoop.mapreduce.v2.jobhistory.JobHistoryUtils;
-  private ClientServiceDelegate clientServiceDelegate;
+  private ClientCache clientCache;
-      this.clientServiceDelegate = new ClientServiceDelegate(this.conf,
+      this.clientCache = new ClientCache(this.conf,
-    return clientServiceDelegate.getJobStatus(jobId);
+    return clientCache.getClient(jobId).getJobStatus(jobId);
-    return clientServiceDelegate.getJobCounters(arg0);
+    return clientCache.getClient(arg0).getJobCounters(arg0);
-    return clientServiceDelegate.getJobHistoryDir();
+    return JobHistoryUtils.getConfiguredHistoryServerDoneDirPrefix(conf);
-    JobStatus status = clientServiceDelegate.getJobStatus(jobID);
+    JobStatus status = clientCache.getClient(jobID).getJobStatus(jobID);
-    return clientServiceDelegate.getTaskCompletionEvents(arg0, arg1, arg2);
+    return clientCache.getClient(arg0).getTaskCompletionEvents(arg0, arg1, arg2);
-    return clientServiceDelegate.getTaskDiagnostics(arg0);
+    return clientCache.getClient(arg0.getJobID()).getTaskDiagnostics(arg0);
-    return clientServiceDelegate
+    return clientCache.getClient(jobID)
-    if (!clientServiceDelegate.killJob(arg0)) {
+    if (!clientCache.getClient(arg0).killJob(arg0)) {
-    return clientServiceDelegate.killTask(arg0, arg1);
+    return clientCache.getClient(arg0.getJobID()).killTask(arg0, arg1);

INS26 INS40 UPD43 UPD42 UPD42 INS32 INS32 UPD42 UPD42 INS42 INS32 INS32 INS32 INS32 UPD42 MOV42 INS42 INS42 UPD42 MOV42 INS42 INS42 INS32 UPD42 MOV42 INS42 INS42 UPD42 MOV42 INS42 INS32 UPD42 MOV42 INS42 INS42 INS32 UPD42 MOV42 INS42 INS32 UPD42 MOV42 INS42 INS42 INS42 INS42 UPD42 MOV42 INS42 INS42 INS42 INS42 UPD42 UPD43 UPD42