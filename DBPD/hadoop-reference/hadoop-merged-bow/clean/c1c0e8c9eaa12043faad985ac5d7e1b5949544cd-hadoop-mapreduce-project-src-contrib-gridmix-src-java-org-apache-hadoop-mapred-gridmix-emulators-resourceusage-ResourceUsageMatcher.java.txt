MAPREDUCE-3008. Improvements to cumulative CPU emulation for short running tasks in Gridmix. (amarrk)

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1179933 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.IOException;
-public class ResourceUsageMatcher {
+public class ResourceUsageMatcher implements Progressive {
-  public void matchResourceUsage() throws Exception {
+  public void matchResourceUsage() throws IOException, InterruptedException {
+  
+  /**
+   * Returns the average progress.
+   */
+  @Override
+  public float getProgress() {
+    if (emulationPlugins.size() > 0) {
+      // return the average progress
+      float progress = 0f;
+      for (ResourceUsageEmulatorPlugin emulator : emulationPlugins) {
+        // consider weighted progress of each emulator
+        progress += emulator.getProgress();
+      }
+
+      return progress / emulationPlugins.size();
+    }
+    
+    // if no emulators are configured then return 1
+    return 1f;
+    
+  }

INS26 INS40 INS43 INS31 INS42 UPD43 INS43 INS29 INS78 INS83 INS39 INS42 INS8 UPD42 INS42 INS65 INS42 INS25 INS41 INS66 INS27 INS8 INS34 INS32 INS34 INS60 INS70 INS41 INS42 INS42 INS39 INS59 INS44 INS42 INS8 INS27 INS42 INS34 INS43 INS42 INS21 INS42 INS32 INS42 INS7 INS42 INS42 INS42 INS32 INS42 INS42