HDFS-7382. DataNode in secure mode may throw NullPointerException if client connects before DataNode registers itself with NameNode. Contributed by Chris Nauroth.

+   * @param int xferPort data transfer port of DataNode accepting connection
-      InputStream underlyingIn, DatanodeID datanodeId) throws IOException {
+      InputStream underlyingIn, int xferPort, DatanodeID datanodeId)
+      throws IOException {
-    } else if (datanodeId.getXferPort() < 1024) {
+    } else if (xferPort < 1024) {
-        "SASL server skipping handshake in unsecured configuration for "
+        "SASL server skipping handshake in secured configuration for "
-      return getSaslStreams(peer, underlyingOut, underlyingIn, datanodeId);
+      return getSaslStreams(peer, underlyingOut, underlyingIn);
-   * @param datanodeId ID of DataNode accepting connection
-      InputStream underlyingIn, final DatanodeID datanodeId) throws IOException {
+      InputStream underlyingIn) throws IOException {

INS44 INS65 INS39 INS42 MOV25 INS66 MOV32 MOV8 MOV38 INS25 MOV27 INS8 MOV25 INS42 INS21 INS41 INS32 INS14 INS42 INS42 INS27 INS42 INS42 INS43 INS42 INS42 INS45 INS45 INS42 DEL42 DEL42 DEL45 DEL45 DEL27 DEL42 DEL42 DEL32 DEL21 DEL42 DEL43 DEL42 DEL42 DEL14 DEL41 DEL8 DEL42 DEL42 DEL32 DEL42 DEL25 DEL42 DEL66 DEL65 DEL83 DEL42 DEL43 DEL42 DEL44