HDFS-14498 LeaseManager can loop forever on the file for which create has failed. Contributed by Stephen O'Donnell.

+      } else if (penultimateBlockMinStorage && lastBlock.getNumBytes() == 0) {
+        // HDFS-14498 - this is a file with a final block of zero bytes and was
+        // likely left in this state by a client which exited unexpectedly
+        pendingFile.removeLastBlock(lastBlock);
+        finalizeINodeFileUnderConstruction(src, pendingFile,
+            iip.getLatestSnapshotId(), false);
+        NameNode.stateChangeLog.warn("BLOCK*" +
+            " internalReleaseLease: Committed last block is zero bytes with" +
+            " insufficient replicas. Final block removed, lease removed, file "
+            + src + " closed.");
+        return true;

INS25 INS27 INS8 INS42 INS27 INS21 INS21 INS21 INS41 INS32 INS34 INS32 INS32 INS32 INS9 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS9 INS40 INS42 INS27 INS42 INS42 INS27 INS42 INS45 INS45 INS45 INS45