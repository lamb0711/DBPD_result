Merge r1414455 through r1415803 from trunk.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1415809 13f79535-47bb-0310-9956-ffa450edef68

+
+  /**
+   * Update the length for the last block
+   * 
+   * @param lastBlockLength
+   *          The length of the last block reported from client
+   * @throws IOException
+   */
+  void updateLengthOfLastBlock(long lastBlockLength) throws IOException {
+    BlockInfo lastBlock = this.getLastBlock();
+    assert (lastBlock != null) : "The last block for path "
+        + this.getFullPathName() + " is null when updating its length";
+    assert (lastBlock instanceof BlockInfoUnderConstruction) : "The last block for path "
+        + this.getFullPathName()
+        + " is not a BlockInfoUnderConstruction when updating its length";
+    lastBlock.setNumBytes(lastBlockLength);
+  }
+  

INS31 INS29 INS39 INS42 INS44 INS43 INS8 INS65 INS65 INS65 INS39 INS42 INS42 INS60 INS6 INS6 INS21 INS66 INS42 INS66 INS42 INS43 INS59 INS36 INS27 INS36 INS27 INS32 INS42 INS42 INS32 INS27 INS45 INS32 INS45 INS62 INS45 INS32 INS45 INS42 INS42 INS42 INS52 INS42 INS42 INS33 INS52 INS42 INS42 INS43 INS52 INS42 INS42