Merge trunk into HA branch


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1202013 13f79535-47bb-0310-9956-ffa450edef68

+    public final boolean shouldCancelAtEnd;
-        Configuration conf, long expirationDate) {
+        Configuration conf, long expirationDate, boolean shouldCancelAtEnd) {
+      this.shouldCancelAtEnd = shouldCancelAtEnd;
+   * @param shouldCancelAtEnd true if tokens should be canceled when the app is
+   * done else false. 
-      ApplicationId applicationId, Credentials ts) 
+      ApplicationId applicationId, Credentials ts, boolean shouldCancelAtEnd) 
-          new DelegationTokenToRenew(applicationId, token, getConfig(), now); 
+          new DelegationTokenToRenew(applicationId, token, getConfig(), now, 
+              shouldCancelAtEnd); 
-    dtCancelThread.cancelToken(t.token, t.conf);
+    if(t.shouldCancelAtEnd) {
+      dtCancelThread.cancelToken(t.token, t.conf);
+    } else {
+      LOG.info("Did not cancel "+t);
+    }

INS23 INS44 INS8 INS83 INS83 INS39 INS59 INS44 INS65 INS39 INS42 INS25 INS42 INS39 INS42 INS21 INS42 INS66 INS66 INS40 MOV8 INS8 INS7 INS21 INS22 INS42 INS32 INS52 INS42 INS42 INS42 INS27 INS45 INS42 INS42