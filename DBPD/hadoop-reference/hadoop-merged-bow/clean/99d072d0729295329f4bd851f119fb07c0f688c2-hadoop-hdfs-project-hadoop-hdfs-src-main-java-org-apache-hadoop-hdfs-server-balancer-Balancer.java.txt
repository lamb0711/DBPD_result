svn -c -1419192 . for reverting HDFS-4261 since TestBalancerWithNodeGroup failed in the recent Jenkins builds.


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1420010 13f79535-47bb-0310-9956-ffa450edef68

+  
-    if (!(BlockPlacementPolicy.getInstance(conf, null, null) instanceof 
-        BlockPlacementPolicyDefault)) {
+    if (BlockPlacementPolicy.getInstance(conf, null, null) instanceof 
+        BlockPlacementPolicyDefault) {
+  private int notChangedIterations = 0;
-      if (!this.nnc.shouldContinue(dispatchBlockMoves())) {
-        return ReturnStatus.NO_MOVE_PROGRESS;
+      if (dispatchBlockMoves() > 0) {
+        notChangedIterations = 0;
+      } else {
+        notChangedIterations++;
+        if (notChangedIterations >= 5) {
+          System.out.println(
+              "No block has been moved for 5 iterations. Exiting...");
+          return ReturnStatus.NO_MOVE_PROGRESS;
+        }

INS23 INS83 INS39 INS59 INS42 INS34 MOV62 INS27 INS8 INS8 MOV32 INS34 INS21 INS21 INS25 INS7 INS37 INS27 MOV8 INS42 INS34 INS42 INS42 INS34 INS21 INS32 INS40 INS42 INS45 DEL36 DEL38 DEL52 DEL42 DEL22 DEL42 DEL32 DEL38