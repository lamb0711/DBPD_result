OPENNLP-402 Added formats support to trainer and evaluator tools. Refactoring of various things. Thanks to Aliaksandr Autayeu for providing a patch.

git-svn-id: https://svn.apache.org/repos/asf/incubator/opennlp/trunk@1209220 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.File;
-import java.io.FileInputStream;
-import java.io.IOException;
-
-import opennlp.tools.cmdline.ObjectStreamFactory;
-import opennlp.tools.cmdline.TerminateToolException;
+import opennlp.tools.cmdline.StreamFactoryRegistry;
-import opennlp.tools.tokenize.DetokenizationDictionary;
-import opennlp.tools.tokenize.Detokenizer;
-import opennlp.tools.tokenize.DictionaryDetokenizer;
-public class ConllXSentenceSampleStreamFactory implements ObjectStreamFactory<SentenceSample> {
+public class ConllXSentenceSampleStreamFactory extends
+    DetokenizerSampleStreamFactory<SentenceSample> {
-    // TODO:
-    // Make chunk size configurable
-  }
-  
-  public String getUsage() {
-    return ArgumentParser.createUsage(Parameters.class);
+    // TODO: make chunk size configurable
-  public String validateArguments(String[] args) {
-    return ArgumentParser.validateArgumentsLoudly(args, Parameters.class);
+  public static void registerFactory() {
+    StreamFactoryRegistry.registerFactory(SentenceSample.class,
+        ConllXPOSSampleStreamFactory.CONLLX_FORMAT, new ConllXSentenceSampleStreamFactory(Parameters.class));
+  }
+
+  protected <P> ConllXSentenceSampleStreamFactory(Class<P> params) {
+    super(params);
-    
-    
-    // TODO: Compare code to ConllXTokenSampleStream, maybe it can be shared somehow
-    
-    ObjectStream<POSSample> posSampleStream = 
-        new ConllXPOSSampleStreamFactory().create(params);
-    
-    Detokenizer detokenizer;
-    try {
-      detokenizer = new DictionaryDetokenizer(new DetokenizationDictionary(new FileInputStream(new File(params.getDetokenizer()))));
-    } catch (IOException e) {
-      System.err.println("Error while loading detokenizer dict: " + e.getMessage());
-      throw new TerminateToolException(-1);
-    }
-    
-    return new POSToSentenceSampleStream(detokenizer, posSampleStream, 30);
+    language = params.getLang();
+
+    ObjectStream<POSSample> posSampleStream = StreamFactoryRegistry.getFactory(POSSample.class,
+        ConllXPOSSampleStreamFactory.CONLLX_FORMAT).create(
+        ArgumentParser.filter(args, ConllXPOSSampleStreamFactory.Parameters.class));
+    return new POSToSentenceSampleStream(createDetokenizer(params), posSampleStream, 30);
