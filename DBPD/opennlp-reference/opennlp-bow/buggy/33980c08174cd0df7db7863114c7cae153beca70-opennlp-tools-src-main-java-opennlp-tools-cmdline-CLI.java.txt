OPENNLP-402 Added formats support to trainer and evaluator tools. Refactoring of various things. Thanks to Aliaksandr Autayeu for providing a patch.

git-svn-id: https://svn.apache.org/repos/asf/incubator/opennlp/trunk@1209220 13f79535-47bb-0310-9956-ffa450edef68

-import opennlp.tools.cmdline.postag.POSTaggerConverter;
+import opennlp.tools.cmdline.postag.POSTaggerConverterTool;
-  private static Map<String, CmdLineTool> toolLookupMap;
+  private static Map<String, AbstractCmdLineTool> toolLookupMap;
-    toolLookupMap = new LinkedHashMap<String, CmdLineTool>();
+    toolLookupMap = new LinkedHashMap<String, AbstractCmdLineTool>();
-    List<CmdLineTool> tools = new LinkedList<CmdLineTool>();
+    List<AbstractCmdLineTool> tools = new LinkedList<AbstractCmdLineTool>();
-    // Docoument Categorizer
+    // Document Categorizer
-    tools.add(new POSTaggerConverter());
-    
-    // add evaluator
-    // add cv validator
+    tools.add(new POSTaggerConverterTool());
-    for (CmdLineTool tool : tools) {
+    for (AbstractCmdLineTool tool : tools) {
-    int numberOfSpaces = 25;
+    int numberOfSpaces = -1;
+    for (String toolName : toolLookupMap.keySet()) {
+      if (toolName.length() > numberOfSpaces) {
+        numberOfSpaces = toolName.length();
+      }
+    }
+    numberOfSpaces = numberOfSpaces + 4;
-    for (CmdLineTool tool : toolLookupMap.values()) {
+    for (AbstractCmdLineTool tool : toolLookupMap.values()) {
-      System.exit(1);
+      System.exit(0);
-    
-    CmdLineTool tool = toolLookupMap.get(args[0]);
-    
-    if (tool == null) {
-      usage();
-      System.exit(1); 
+
+    String toolName = args[0];
+
+    //check for format
+    String formatName = StreamFactoryRegistry.DEFAULT_FORMAT;
+    int idx = toolName.indexOf(".");
+    if (-1 < idx) {
+      formatName = toolName.substring(idx + 1);
+      toolName = toolName.substring(0, idx);
-    else if (args.length > 1 && args[1].equals("help")) {
-      System.out.println(tool.getHelp());
-      System.exit(1);
-    }
+    AbstractCmdLineTool tool = toolLookupMap.get(toolName);
-      tool.run(toolArguments);
+      if (null == tool) {
+        throw new TerminateToolException(1, "Tool " + toolName + " is not found.");
+      }
+
+      if (0 == toolArguments.length ||
+          0 < toolArguments.length && "help".equals(toolArguments[0])) {
+          if (tool instanceof TypedCmdLineTool) {
+            System.out.println(((TypedCmdLineTool) tool).getHelp(formatName));
+          } else if (tool instanceof CmdLineTool) {
+            System.out.println(tool.getHelp());
+          }
+
+          System.exit(0);
+      }
+
+      if (tool instanceof TypedCmdLineTool) {
+        ((TypedCmdLineTool) tool).run(formatName, toolArguments);
+      } else if (tool instanceof CmdLineTool) {
+        if (-1 == idx) {
+          ((CmdLineTool) tool).run(toolArguments);
+        } else {
+          throw new TerminateToolException(1, "Tool " + toolName + " does not support formats.");
+        }
+      } else {
+        throw new TerminateToolException(1, "Tool " + toolName + " is not supported.");
+      }
