[MNG-4201] Custom packaging break in trunk (rev 784628)

o Restored compat with 2.x, both in terms of lifecycle configuration and API for implementors of custom mappings

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@796801 13f79535-47bb-0310-9956-ffa450edef68

+
-    public Map<String,Lifecycle> getLifecycles()
+    /** @deprecated use lifecycles instead */
+    private Map<String, String> phases;
+
+    /**
+     * Populates the lifecycle map from the injected list of lifecycle mappings (if not already done).
+     */
+    private void initLifecycleMap()
-            lifecycleMap = new HashMap<String,Lifecycle>();
+            lifecycleMap = new HashMap<String, Lifecycle>();
+            else
+            {
+                /*
+                 * NOTE: This is to provide a migration path for implementors of the legacy API which did not know about
+                 * getLifecycles().
+                 */
+
+                String[] lifecycleIds = { "default", "clean", "site" };
+
+                for ( String lifecycleId : lifecycleIds )
+                {
+                    Map<String, String> phases = getPhases( lifecycleId );
+                    if ( phases != null )
+                    {
+                        Lifecycle lifecycle = new Lifecycle();
+
+                        lifecycle.setId( lifecycleId );
+                        lifecycle.setPhases( phases );
+
+                        lifecycleMap.put( lifecycleId, lifecycle );
+                    }
+                }
+            }
+    }
+
+    public Map<String, Lifecycle> getLifecycles()
+    {
+        initLifecycleMap();
+
+    public List<String> getOptionalMojos( String lifecycle )
+    {
+        return null;
+    }
+
+    public Map<String, String> getPhases( String lifecycle )
+    {
+        initLifecycleMap();
+
+        Lifecycle lifecycleMapping = lifecycleMap.get( lifecycle );
+
+        if ( lifecycleMapping != null )
+        {
+            return lifecycleMapping.getPhases();
+        }
+        else if ( "default".equals( lifecycle ) )
+        {
+            return phases;
+        }
+        else
+        {
+            return null;
+        }
+    }
+

INS23 INS31 INS31 INS31 INS29 INS83 INS74 INS59 INS29 UPD83 INS39 UPD42 INS83 MOV74 INS42 INS8 INS83 INS74 INS42 INS44 INS8 INS83 INS74 INS42 INS44 INS8 INS65 INS43 INS43 INS43 INS42 INS65 INS21 MOV41 INS43 INS43 INS43 INS42 INS41 INS43 INS43 INS43 INS43 INS42 INS21 INS60 INS25 INS66 INS42 INS42 INS42 INS66 INS32 INS42 INS42 INS42 INS33 INS42 INS42 INS42 INS42 INS32 INS43 INS59 INS27 INS8 INS25 INS25 INS42 INS42 INS42 INS42 INS32 INS42 INS33 INS41 INS32 INS8 INS8 MOV27 MOV8 INS8 INS42 INS42 INS42 INS32 INS45 INS42 INS42 INS41 INS41 INS60 INS70 INS42 INS42 INS42 INS33 INS5 INS59 INS44 INS42 INS8 INS43 INS85 INS42 INS4 INS43 INS42 INS60 MOV25 INS42 INS45 INS45 INS45 INS42 INS74 INS59 INS27 INS8 INS43 INS43 INS43 INS42 INS32 INS42 INS33 INS60 INS21 INS21 INS21 INS42 INS42 INS42 INS42 INS42 INS43 INS59 INS32 INS32 INS32 INS42 INS42 INS14 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS42