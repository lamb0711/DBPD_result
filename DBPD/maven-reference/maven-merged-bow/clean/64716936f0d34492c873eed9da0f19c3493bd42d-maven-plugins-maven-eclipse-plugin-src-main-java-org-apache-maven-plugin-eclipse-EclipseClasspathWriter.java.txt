include optional direct dependencies in classpath and resolve artifacts.
These are not included in project.getTestArtifacts() while they should be required if dependency is direct (seems to be a problem only with reactor projects).
Modified master test in order to manually check file content instead of comparing files (easier to explain and comment, ignore order).


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@330040 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Set;
+        // @todo direct optional artifacts are not included in the list returned by project.getTestArtifacts()
+        // .classpath should include ANY direct dependency, and optional dependencies are required to compile
+        Set depArtifacts = project.getDependencyArtifacts();
+        for ( Iterator it = depArtifacts.iterator(); it.hasNext(); )
+        {
+            Artifact artifact = (Artifact) it.next();
+            if ( artifact.isOptional() && !artifacts.contains( artifact ) )
+            {
+                try
+                {
+                    artifactResolver.resolve( artifact, remoteArtifactRepositories, localRepository );
+                }
+                catch ( ArtifactResolutionException e )
+                {
+                    log.error( "Unable to resolve optional artifact " + artifact.getId() );
+                    continue;
+                }
+                catch ( ArtifactNotFoundException e )
+                {
+                    log.error( "Unable to resolve optional artifact " + artifact.getId() );
+                    continue;
+                }
+                artifacts.add( artifact );
+            }
+        }
+

INS26 INS40 INS60 INS24 INS43 INS59 INS58 INS32 INS8 INS42 INS42 INS32 INS43 INS59 INS42 INS42 INS60 INS25 INS42 INS42 INS42 INS42 INS32 INS43 INS59 INS27 INS8 INS42 INS42 INS42 INS42 INS11 INS32 INS38 INS54 INS21 INS43 INS32 INS42 INS42 INS32 INS8 INS12 INS12 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS21 INS44 INS8 INS44 INS8 INS42 INS42 INS42 INS32 INS43 INS42 INS21 INS18 INS43 INS42 INS21 INS18 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS27 INS42 INS42 INS27 INS45 INS32 INS45 INS32 INS42 INS42 INS42 INS42