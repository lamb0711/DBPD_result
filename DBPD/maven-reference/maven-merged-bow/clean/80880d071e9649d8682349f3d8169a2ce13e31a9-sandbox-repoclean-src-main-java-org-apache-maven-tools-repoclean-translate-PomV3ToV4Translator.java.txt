o Fixed a configuration issue for the DefaultRepositoryLayout in components.xml...it needed a requirement on the ArtifactHandlerManager.
o Fixed a formatting issue for the layout in DefaultRepositoryLayout relating to groupId's.
o Revamped the repoclean tool to use an Artifact-centric approach to converting, cleaning, and reporting on repositories.
o Added the ability for repoclean to report on the health of an existing v3 or v4 repository, using a DefaultArtifactDiscoverer (Default* being the prefix given to the new repo layout going forward) and a V4PomRewriter implementation.
o Tested repoclean by converting my local m1 repository to a m2 repository.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163669 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.model.v4_0_0.Build;
-import org.apache.maven.model.v4_0_0.CiManagement;
-import org.apache.maven.model.v4_0_0.Contributor;
-import org.apache.maven.model.v4_0_0.Dependency;
-import org.apache.maven.model.v4_0_0.Developer;
-import org.apache.maven.model.v4_0_0.DistributionManagement;
-import org.apache.maven.model.v4_0_0.Goal;
-import org.apache.maven.model.v4_0_0.IssueManagement;
-import org.apache.maven.model.v4_0_0.License;
-import org.apache.maven.model.v4_0_0.MailingList;
-import org.apache.maven.model.v4_0_0.Model;
-import org.apache.maven.model.v4_0_0.Notifier;
-import org.apache.maven.model.v4_0_0.Organization;
-import org.apache.maven.model.v4_0_0.Plugin;
-import org.apache.maven.model.v4_0_0.Reports;
-import org.apache.maven.model.v4_0_0.Repository;
-import org.apache.maven.model.v4_0_0.Resource;
-import org.apache.maven.model.v4_0_0.Scm;
-import org.apache.maven.model.v4_0_0.Site;
+import org.apache.maven.model.Build;
+import org.apache.maven.model.CiManagement;
+import org.apache.maven.model.Contributor;
+import org.apache.maven.model.Dependency;
+import org.apache.maven.model.Developer;
+import org.apache.maven.model.DistributionManagement;
+import org.apache.maven.model.Goal;
+import org.apache.maven.model.IssueManagement;
+import org.apache.maven.model.License;
+import org.apache.maven.model.MailingList;
+import org.apache.maven.model.Model;
+import org.apache.maven.model.Notifier;
+import org.apache.maven.model.Organization;
+import org.apache.maven.model.Plugin;
+import org.apache.maven.model.Reports;
+import org.apache.maven.model.Repository;
+import org.apache.maven.model.Resource;
+import org.apache.maven.model.Scm;
+import org.apache.maven.model.Site;
+import org.codehaus.plexus.util.xml.Xpp3Dom;
-/* ====================================================================
- *   Copyright 2001-2004 The Apache Software Foundation.
- *
- *   Licensed under the Apache License, Version 2.0 (the "License");
- *   you may not use this file except in compliance with the License.
- *   You may obtain a copy of the License at
- *
- *       http://www.apache.org/licenses/LICENSE-2.0
- *
- *   Unless required by applicable law or agreed to in writing, software
- *   distributed under the License is distributed on an "AS IS" BASIS,
- *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *   See the License for the specific language governing permissions and
- *   limitations under the License.
- * ====================================================================
+/*
+ * ==================================================================== Copyright 2001-2004 The
+ * Apache Software Foundation.
+ * 
+ * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
+ * in compliance with the License. You may obtain a copy of the License at
+ * 
+ * http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ * Unless required by applicable law or agreed to in writing, software distributed under the License
+ * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
+ * or implied. See the License for the specific language governing permissions and limitations under
+ * the License. ====================================================================
-        logHeader.append( "Translation of POM {" ).append( v3Model.getGroupId() ).append( ":" )
-                 .append( v3Model.getArtifactId() ).append( ":" ).append( version ).append( "}\n" );
+        logHeader.append( "Translation of POM {" ).append( v3Model.getGroupId() ).append( ":" ).append(
+                                                                                                        v3Model.getArtifactId() ).append(
+                                                                                                                                          ":" ).append(
+                                                                                                                                                        version ).append(
+                                                                                                                                                                          "}" );
-                info.append( "Using some contrived information for report: \'" ).append( reportName ).append( "\'.\n" )
-                    .append( "\to groupId: \'maven\'\n" ).append( "\to artifactId: \'" ).append( reportPluginName )
-                    .append( "\'\n" ).append( "\to version: \'1.0-SNAPSHOT\'\n" ).append( "\to goal: \'report\'\n" )
-                    .append( "\n" )
-                    .append( "These values were extracted using the v3 report naming convention, but may be wrong." );
+                info.append( "Using some contrived information for report: \'" ).append( reportName ).append( "\'.\n" ).append(
+                                                                                                                                "\to groupId: \'maven\'\n" ).append(
+                                                                                                                                                                     "\to artifactId: \'" ).append(
+                                                                                                                                                                                                    reportPluginName ).append(
+                                                                                                                                                                                                                               "\'\n" ).append(
+                                                                                                                                                                                                                                                "\to version: \'1.0-SNAPSHOT\'\n" ).append(
+                                                                                                                                                                                                                                                                                            "\to goal: \'report\'\n" ).append(
+                                                                                                                                                                                                                                                                                                                               "\n" ).append(
+                                                                                                                                                                                                                                                                                                                                              "These values were extracted using the v3 report naming convention, but may be wrong." );
-    private org.apache.maven.model.v4_0_0.Organization translateOrganization(
-                                                                             org.apache.maven.model.v3_0_0.Organization v3Organization,
-                                                                             Reporter reporter )
+    private org.apache.maven.model.Organization translateOrganization(
+                                                                      org.apache.maven.model.v3_0_0.Organization v3Organization,
+                                                                      Reporter reporter )
-                org.apache.maven.model.v3_0_0.MailingList v3List = (org.apache.maven.model.v3_0_0.MailingList) it
-                                                                                                                 .next();
+                org.apache.maven.model.v3_0_0.MailingList v3List = (org.apache.maven.model.v3_0_0.MailingList) it.next();
-                //                throw new Exception( "Missing 'distributionSite': Both distributionSite and distributionDirectory must be set." );
+                //                throw new Exception( "Missing 'distributionSite': Both distributionSite and
+                // distributionDirectory must be set." );
-                org.apache.maven.model.v3_0_0.Developer v3Developer = (org.apache.maven.model.v3_0_0.Developer) it
-                                                                                                                  .next();
+                org.apache.maven.model.v3_0_0.Developer v3Developer = (org.apache.maven.model.v3_0_0.Developer) it.next();
-                org.apache.maven.model.v3_0_0.Contributor v3Contributor = (org.apache.maven.model.v3_0_0.Contributor) it
-                                                                                                                        .next();
+                org.apache.maven.model.v3_0_0.Contributor v3Contributor = (org.apache.maven.model.v3_0_0.Contributor) it.next();
-                    Properties config = new Properties();
+                    Xpp3Dom config = new Xpp3Dom( "configuration" );
-                    String includes = pathPatternsToString( testIncludes );
-
-                    if ( StringUtils.isNotEmpty( includes ) )
+                    if ( notEmpty( testIncludes ) )
-                        config.setProperty( "includes", includes );
+                        Xpp3Dom includes = new Xpp3Dom( "includes" );
+                        for ( Iterator it = testIncludes.iterator(); it.hasNext(); )
+                        {
+                            String includePattern = (String) it.next();
+                            Xpp3Dom include = new Xpp3Dom( "include" );
+                            include.setValue( includePattern );
+
+                            includes.addChild( include );
+                        }
+
+                        config.addChild( includes );
-                    String excludes = pathPatternsToString( testExcludes );
-
-                    if ( StringUtils.isNotEmpty( excludes ) )
+                    if ( notEmpty( testExcludes ) )
-                        config.setProperty( "excludes", excludes );
+                        Xpp3Dom excludes = new Xpp3Dom( "excludes" );
+                        for ( Iterator it = testExcludes.iterator(); it.hasNext(); )
+                        {
+                            String excludePattern = (String) it.next();
+                            Xpp3Dom exclude = new Xpp3Dom( "exclude" );
+                            exclude.setValue( excludePattern );
+
+                            excludes.addChild( exclude );
+                        }
+
+                        config.addChild( excludes );
-                    if ( !config.isEmpty() )
+                    if ( config.getChildCount() > 0 )
-                resource.setExcludes( pathPatternsToString( v3Resource.getExcludes() ) );
-                resource.setIncludes( pathPatternsToString( v3Resource.getIncludes() ) );
+                resource.setExcludes( v3Resource.getExcludes() );
+                resource.setIncludes( v3Resource.getIncludes() );
-    private String pathPatternsToString( List patterns )
-    {
-        StringBuffer result = new StringBuffer();
-
-        if ( notEmpty( patterns ) )
-        {
-            for ( Iterator it = patterns.iterator(); it.hasNext(); )
-            {
-                String pattern = (String) it.next();
-
-                result.append( "," ).append( pattern );
-            }
-
-            result.setLength( result.length() - 1 );
-        }
-
-        return result.toString();
-    }
+//    private String pathPatternsToString( List patterns )
+//    {
+//        StringBuffer result = new StringBuffer();
+//
+//        if ( notEmpty( patterns ) )
+//        {
+//            for ( Iterator it = patterns.iterator(); it.hasNext(); )
+//            {
+//                String pattern = (String) it.next();
+//
+//                result.append( "," ).append( pattern );
+//            }
+//
+//            result.setLength( result.length() - 1 );
+//        }
+//
+//        return result.toString();
+//    }

INS26 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 UPD40 INS40 UPD43 UPD40 UPD45 MOV32 MOV32 INS25 INS25 UPD42 INS42 UPD42 INS42 UPD43 INS32 INS8 INS32 INS8 INS27 UPD42 INS42 INS42 INS60 INS24 MOV21 INS42 INS42 INS60 INS24 MOV21 INS32 INS34 UPD43 INS45 INS43 INS59 INS58 INS32 INS8 INS43 INS59 INS58 MOV32 INS8 MOV42 UPD42 MOV42 UPD42 INS42 INS42 INS14 INS43 INS59 INS42 INS42 MOV60 INS60 INS21 INS21 UPD42 INS42 INS42 INS14 MOV43 INS59 MOV60 INS60 INS21 INS21 UPD42 INS43 INS45 INS42 INS42 INS32 MOV43 INS43 INS59 INS32 INS32 INS43 INS45 INS42 INS32 MOV43 INS43 INS59 INS32 INS32 INS42 INS42 INS42 UPD42 INS11 INS42 INS42 INS14 INS42 INS42 INS42 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS42 UPD42 MOV11 INS42 INS42 INS14 INS42 INS42 INS42 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 INS43 INS32 INS43 INS45 INS43 INS45 INS42 UPD42 MOV42 UPD42 MOV42 INS42 UPD42 MOV42 INS42 DEL32 DEL45 DEL32 DEL45 DEL32 DEL8 DEL25 DEL32 DEL8 DEL25 DEL32 DEL38 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL83 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL42 DEL43 DEL14 DEL59 DEL60 DEL42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL32 DEL59 DEL58 DEL42 DEL43 DEL42 DEL59 DEL60 DEL42 DEL42 DEL45 DEL32 DEL42 DEL42 DEL32 DEL21 DEL8 DEL24 DEL42 DEL42 DEL42 DEL42 DEL32 DEL34 DEL27 DEL32 DEL21 DEL8 DEL25 DEL42 DEL42 DEL32 DEL41 DEL8 DEL31