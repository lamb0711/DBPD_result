o Changed clumsy collection interpolation into List interpolation, since it's all lists anyway.

Performs twice as fast, but you'll have to be a profiler to appreciate this subtle
performance increase.

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1377020 13f79535-47bb-0310-9956-ffa450edef68

+                        else if ( List.class.isAssignableFrom( type ) )
+                        {
+                            fields.add( new ListField( currentField ) );
+                        }
-                            fields.add( new CollectionField( currentField ) );
+                            throw new RuntimeException("We dont interpolate into collections, use a list instead");
-        static final class CollectionField
+        static final class ListField
-            CollectionField( Field field )
+            ListField( Field field )
-                @SuppressWarnings( "unchecked" ) Collection<Object> c = (Collection<Object>) field.get( target );
-                if ( c == null || c.isEmpty() )
+                @SuppressWarnings( "unchecked" ) List<Object> c = (List<Object>) field.get( target );
+                if ( c == null )
-                List<Object> originalValues = new ArrayList<Object>( c );
-                try
+                int size = c.size();
+                Object value;
+                for ( int i = 0; i < size; i++ )
-                    c.clear();
-                }
-                catch ( UnsupportedOperationException e )
-                {
-                    return;
-                }
-                for ( Object value : originalValues )
-                {
-                    if ( value == null )
-                    {
-                        // add the null back in...not sure what else to do...
-                        c.add( value );
-                    }
-                    else if ( String.class == value.getClass() )
-                    {
-                        String interpolated = ctx.interpolate( (String) value );
+                    value = c.get( i );
-                        if ( !interpolated.equals( value ) )
+                    if ( value != null )
+                    {
+                        if ( String.class == value.getClass() )
-                            c.add( interpolated );
+                            String interpolated = ctx.interpolate( (String) value );
+
+                            if ( !interpolated.equals( value ) )
+                            {
+                                try
+                                {
+                                    c.set( i, interpolated );
+                                }
+                                catch ( UnsupportedOperationException e )
+                                {
+                                    return;
+                                }
+                            }
-                            c.add( value );
-                        }
-                    }
-                    else
-                    {
-                        c.add( value );
-                        if ( value.getClass().isArray() )
-                        {
-                            evaluateArray( value, ctx );
-                        }
-                        else
-                        {
-                            ctx.interpolationTargets.add( value );
+                            if ( value.getClass().isArray() )
+                            {
+                                evaluateArray( value, ctx );
+                            }
+                            else
+                            {
+                                ctx.interpolationTargets.add( value );
+                            }

UPD42 UPD42 INS60 INS24 UPD74 MOV27 INS39 MOV43 INS59 INS58 INS27 INS37 MOV8 UPD43 UPD42 INS32 INS42 INS39 INS59 INS42 INS42 INS42 INS21 UPD42 MOV74 INS42 INS42 INS42 INS34 INS7 UPD27 INS42 INS32 MOV25 INS25 INS42 INS42 INS42 INS32 INS8 MOV25 INS57 INS42 INS42 INS21 INS43 INS32 INS53 MOV54 INS42 INS42 INS42 INS14 INS14 INS43 INS42 UPD43 MOV43 INS45 INS42 UPD42 UPD42 INS42 INS42 DEL42 DEL42 DEL42 DEL14 DEL32 DEL21 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL42 DEL32 DEL27 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL14 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL44 DEL42 DEL70