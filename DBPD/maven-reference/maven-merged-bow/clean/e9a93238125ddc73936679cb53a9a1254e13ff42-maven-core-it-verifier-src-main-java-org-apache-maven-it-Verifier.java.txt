o Changed maven-user-model/UserModel/UserModelBuilder to maven-settings/MavenSettings/MavenSettingsBuilder.

  This supports a change to a simpler local configuration file (~/.m2/settings.xml by default), which has the general format of:

<settings>
  <profiles>
    <profile>
      <active>true</active> <!-- not needed if this is the only profile -->
      <localRepository>/path/to/repo</localRepository>
    </profile>
    .
    .
    .
  </profiles>
  <servers>
    <server>
      <id>myserver</id>
      <username>me</username>
      <password>mypass</password>
      <privateKey>/path/to/key</privateKey>
      <passphrase>key-passphrase</passphrase>
    </server>
    .
    .
    .
  </servers>
  <proxies>
    <proxy>
      <active>true</active> <!-- not needed if this is the only proxy -->
      .
      .
      .
    </proxy>
    .
    .
    .
  </proxies>
</settings>

o Added special parameter named '#settings' which simply injects the current MavenSettings from the MavenSession into the request parameters.
o Adjusted the it-verifier and mboot2 accordingly.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163578 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Map;
-import java.util.TreeMap;
-                File userXml = new File( userHome, ".m2/user.xml" );
+                File userXml = new File( userHome, ".m2/settings.xml" );
-                    MavenProfile activeProfile = userModelReader.getActiveMavenProfile();
+                    Profile activeProfile = userModelReader.getActiveMavenProfile();
-        private Map mavenProfiles = new TreeMap();
+        private List profiles = new ArrayList();
-        private MavenProfile currentProfile = null;
+        private Profile currentProfile = null;
-        private String activeProfileId = null;
-
-        private MavenProfile activeMavenProfile = null;
+        private Profile activeMavenProfile = null;
-        public MavenProfile getActiveMavenProfile()
+        public Profile getActiveMavenProfile()
-            if ( "mavenProfile".equals( rawName ) )
+            if ( "profile".equals( rawName ) )
-                if ( notEmpty( currentProfile.getId() ) && notEmpty( currentProfile.getLocalRepo() ) )
+                if ( notEmpty( currentProfile.getLocalRepo() ) )
-                    mavenProfiles.put( currentProfile.getId(), currentProfile );
+                    profiles.add( currentProfile );
-                        + "fields: {id,localRepository}." );
+                        + "fields: {localRepository}." );
-                if ( "id".equals( rawName ) )
+                if ( "active".equals( rawName ) )
-                    currentProfile.setId( currentBody.toString().trim() );
+                    currentProfile.setActive( Boolean.valueOf(currentBody.toString().trim()).booleanValue() );
-                    throw new SAXException( "Illegal element inside mavenProfile: \'" + rawName + "\'" );
+                    throw new SAXException( "Illegal element inside profile: \'" + rawName + "\'" );
-            else if ( "userModel".equals( rawName ) )
+            else if ( "settings".equals( rawName ) )
-                this.activeMavenProfile = (MavenProfile) mavenProfiles.get( activeProfileId );
-            }
-            else if ( "mavenProfileId".equals( rawName ) )
-            {
-                this.activeProfileId = currentBody.toString().trim();
+                if(profiles.size() == 1)
+                {
+                    activeMavenProfile = (Profile) profiles.get(0);
+                }
+                else
+                {
+                    for ( Iterator it = profiles.iterator(); it.hasNext(); )
+                    {
+                        Profile profile = (Profile) it.next();
+                        if(profile.isActive())
+                        {
+                            activeMavenProfile = profile;
+                        }
+                    }
+                }
-            if ( "mavenProfile".equals( rawName ) )
+            if ( "profile".equals( rawName ) )
-                currentProfile = new MavenProfile();
+                currentProfile = new Profile();
-            this.activeProfileId = null;
-            this.mavenProfiles.clear();
+            this.profiles.clear();
-    public static class MavenProfile
+    public static class Profile
-
-        private String id;
+        private boolean active = false;
-
-        public void setId( String id )
+        
+        public void setActive( boolean active )
-            this.id = id;
+            this.active = active;
-
-        public String getId()
+        
+        public boolean isActive()
-            return id;
+            return active;

UPD42 UPD43 UPD43 UPD43 UPD43 INS39 UPD42 INS39 INS42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 INS9 INS39 INS42 UPD43 UPD42 UPD42 UPD45 UPD45 UPD42 MOV32 INS8 UPD42 UPD42 MOV43 UPD45 INS25 UPD45 INS27 MOV8 INS8 UPD43 MOV43 UPD45 UPD43 UPD42 UPD42 MOV42 INS32 INS32 INS34 INS24 UPD42 UPD42 UPD45 INS42 INS42 INS32 INS42 INS42 INS58 INS32 INS8 MOV32 INS42 INS42 INS43 INS59 INS42 INS42 INS60 INS25 UPD42 UPD42 UPD45 UPD43 INS42 INS42 INS32 INS43 INS59 MOV32 MOV8 UPD42 UPD42 INS34 INS42 INS42 INS42 INS42 INS11 UPD42 UPD42 INS43 INS32 INS42 INS42 INS42 INS42 INS42 DEL40 DEL26 DEL40 DEL26 DEL83 DEL42 DEL43 DEL42 DEL33 DEL59 DEL23 DEL42 DEL42 DEL42 DEL32 DEL32 DEL27 DEL42 DEL42 DEL32 DEL52 DEL42 DEL22 DEL42 DEL45 DEL52 DEL42 DEL22 DEL42 DEL42 DEL32 DEL42 DEL32 DEL25 DEL52 DEL42 DEL22 DEL33 DEL7 DEL21 DEL42 DEL43 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42