Removing maven-build-context, and replacing it with caching aspects for model-lineage stuff and project instances. Still needs caching for artifact resolution, and I have an aspect for this too, but it's not enabled yet, since it's still buggy.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@595215 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.profiles.DefaultProfileManager;
+import org.apache.maven.profiles.ProfileManager;
-import org.apache.maven.profiles.ProfileManager;
-import org.apache.maven.profiles.DefaultProfileManager;
+import org.apache.maven.profiles.activation.ProfileActivationContext;
-    public List applyActivatedProfiles( Model model, File pomFile, List explicitlyActiveIds, List explicitlyInactiveIds, boolean useProfilesXml )
+    public List applyActivatedProfiles( Model model,
+                                        File pomFile,
+                                        List explicitlyActiveIds,
+                                        List explicitlyInactiveIds,
+                                        boolean useProfilesXml,
+                                        ProfileActivationContext activationContext )
-        logger.debug( "Building profile manager for model: " + model.getId() + " with pom file: " + pomFile );
-        ProfileManager profileManager = buildProfileManager( model, pomFile, explicitlyActiveIds, explicitlyInactiveIds, useProfilesXml );
+        logger.debug( "Building profile manager for model: " + model.getId() + " with pom file: "
+                      + pomFile );
+        ProfileManager profileManager = buildProfileManager( model,
+                                                             pomFile,
+                                                             explicitlyActiveIds,
+                                                             explicitlyInactiveIds,
+                                                             useProfilesXml,
+                                                             activationContext );
-    public List applyActivatedExternalProfiles( Model model, File projectDir, ProfileManager externalProfileManager )
+    public List applyActivatedExternalProfiles( Model model,
+                                                File projectDir,
+                                                ProfileManager externalProfileManager )
-        logger.debug( "Building profile manager for model: " + model.getId() + " with external profile manager including profiles: " + externalProfileManager.getProfilesById() );
+        logger.debug( "Building profile manager for model: " + model.getId()
+                      + " with external profile manager including profiles: "
+                      + externalProfileManager.getProfilesById() );
-    private List applyActivatedProfiles( Model model, File pomFile, ProfileManager profileManager )
+    private List applyActivatedProfiles( Model model,
+                                         File pomFile,
+                                         ProfileManager profileManager )
-    private ProfileManager buildProfileManager( Model model, File pomFile, List explicitlyActiveIds, List explicitlyInactiveIds, boolean useProfilesXml )
+    private ProfileManager buildProfileManager( Model model,
+                                                File pomFile,
+                                                List explicitlyActiveIds,
+                                                List explicitlyInactiveIds,
+                                                boolean useProfilesXml,
+                                                ProfileActivationContext profileActivationContext )
-        ProfileManager profileManager = new DefaultProfileManager( container );
+        ProfileManager profileManager = new DefaultProfileManager( container, profileActivationContext );
-                throw new ProjectBuildingException( modelId,
-                                                    "Failed to compute active profiles for repository aggregation.", pomFile, e );
+                throw new ProjectBuildingException(
+                                                    modelId,
+                                                    "Failed to compute active profiles for repository aggregation.",
+                                                    pomFile, e );
-    public LinkedHashSet getArtifactRepositoriesFromActiveProfiles( Model model, File pomFile,
-                                                                    List explicitlyActiveIds, List explicitlyInactiveIds,
-                                                                    boolean useProfilesXml )
+    public LinkedHashSet getArtifactRepositoriesFromActiveProfiles( Model model,
+                                                                    File pomFile,
+                                                                    List explicitlyActiveIds,
+                                                                    List explicitlyInactiveIds,
+                                                                    boolean useProfilesXml,
+                                                                    ProfileActivationContext activationContext )
-        ProfileManager profileManager = buildProfileManager( model, pomFile, explicitlyActiveIds, explicitlyInactiveIds, useProfilesXml );
+        ProfileManager profileManager = buildProfileManager( model,
+                                                             pomFile,
+                                                             explicitlyActiveIds,
+                                                             explicitlyInactiveIds,
+                                                             useProfilesXml,
+                                                             activationContext );
-    private void loadExternalProjectProfiles( ProfileManager profileManager, Model model, File pomFile )
+    private void loadExternalProjectProfiles( ProfileManager profileManager,
+                                              Model model,
+                                              File pomFile )
-                throw new ProjectBuildingException( model.getId(), "Cannot read profiles.xml resource from directory: "
-                    + projectDir, pomFile, e );
+                throw new ProjectBuildingException( model.getId(),
+                                                    "Cannot read profiles.xml resource from directory: "
+                                                                    + projectDir, pomFile, e );
-                                                    "Cannot parse profiles.xml resource from directory: " + projectDir,
-                                                    pomFile, e );
+                                                    "Cannot parse profiles.xml resource from directory: "
+                                                                    + projectDir, pomFile, e );

MOV26 MOV26 INS26 INS40 INS44 INS44 INS44 INS43 INS42 INS43 INS42 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42