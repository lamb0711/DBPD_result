Fixing project inheritance and profile-injection now that we've moved to the model lineage builder. Iteration was backward.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@499603 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.repository.ArtifactRepositoryFactory;
+import org.apache.maven.project.build.model.ModelLineageIterator;
-import org.apache.maven.project.injection.ProfileInjector;
-        List models = modelLineage.getModelsInDescendingOrder();
-        List poms = modelLineage.getFilesInDescendingOrder();
-        
-        for( int i = 0; i < models.size(); i++ )
+        for ( ModelLineageIterator it = modelLineage.lineageIterator(); it.hasNext(); )
-            Model currentModel = (Model) models.get( i );
-            File currentPom = (File) poms.get( i );
+            Model currentModel = (Model) it.next();
+            File currentPom = it.getPOMFile();
-            project.setActiveProfiles( profileAdvisor.applyActivatedProfiles( model, projectDir, explicitlyActive,
+            project.setActiveProfiles( profileAdvisor.applyActivatedProfiles( currentModel, projectDir, explicitlyActive,
-                project.setParent( lastProject );
+                lastProject.setParent( project );
-                project.setParentArtifact( artifactFactory.createParentArtifact( lastProject.getGroupId(), lastProject
-                    .getArtifactId(), lastProject.getVersion() ) );
+                lastProject.setParentArtifact( artifactFactory.createParentArtifact( project.getGroupId(), project
+                    .getArtifactId(), project.getVersion() ) );
-            lineage.addLast( project );
+            lineage.addFirst( project );
-        MavenProject result = (MavenProject) lineage.get( lineage.size() - 1 );
+        MavenProject result = (MavenProject) lineage.getLast();

MOV26 UPD40 INS24 INS58 INS32 MOV8 MOV43 INS43 INS59 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 UPD42 MOV42 MOV32 MOV43 MOV43 UPD42 INS32 UPD42 UPD42 MOV43 UPD42 MOV42 UPD42 MOV42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 DEL40 DEL26 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL60 DEL42 DEL43 DEL59 DEL60 DEL42 DEL42 DEL43 DEL42 DEL32 DEL11 DEL39 DEL42 DEL34 DEL59 DEL58 DEL42 DEL32 DEL27 DEL42 DEL37 DEL24 DEL42 DEL42 DEL32 DEL34 DEL27