[MNG-5350] improved warning message: when in debug mode, list the goals and not only the plugins

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1398044 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.plugin.descriptor.MojoDescriptor;
-    @SuppressWarnings( { "UnusedDeclaration" } )
-                logger.warn( "* contains the following plugin(s) that are not marked as       *" );
-                logger.warn( "* @threadSafe to support parallel building.                     *" );
+                logger.warn( "* contains the following plugin(s) that have goals not marked   *" );
+                logger.warn( "* as @threadSafe to support parallel building.                  *" );
-                logger.warn( "The following plugins are not marked @threadSafe in " + project.getName() + ":" );
-                for ( Plugin unsafePlugin : unsafePlugins )
+                if ( logger.isDebugEnabled() )
-                    logger.warn( unsafePlugin.getId() );
+                    final Set<MojoDescriptor> unsafeGoals = executionPlan.getNonThreadSafeMojos();
+                    logger.warn( "The following goals are not marked @threadSafe in " + project.getName() + ":" );
+                    for ( MojoDescriptor unsafeGoal : unsafeGoals )
+                    {
+                        logger.warn( unsafeGoal.getId() );
+                    }
+                }
+                else
+                {
+                    logger.warn( "The following plugins are not marked @threadSafe in " + project.getName() + ":" );
+                    for ( Plugin unsafePlugin : unsafePlugins )
+                    {
+                        logger.warn( unsafePlugin.getId() );
+                    }
+                    logger.warn( "Enable debug to see more precisely which goals are not marked @threadSafe." );

INS26 INS40 INS25 INS32 INS8 INS8 UPD45 UPD45 INS42 INS42 INS60 INS21 INS70 MOV21 MOV70 INS21 INS83 INS74 INS59 INS32 INS44 INS42 INS8 INS32 INS43 INS43 INS42 INS32 INS42 INS42 INS27 INS43 INS42 INS21 INS42 INS42 INS45 INS42 INS42 INS42 INS42 INS45 INS32 INS45 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 DEL42 DEL45 DEL4 DEL79