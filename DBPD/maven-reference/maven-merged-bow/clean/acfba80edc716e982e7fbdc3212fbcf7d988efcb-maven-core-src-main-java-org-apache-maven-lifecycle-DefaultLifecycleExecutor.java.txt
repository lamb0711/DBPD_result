consolidate defaults injection

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@168152 13f79535-47bb-0310-9956-ffa450edef68

-        // TODO: use the model injector, or just lookup the versions from the project?
-        // They need to be injected, but we should track the required plugins first, then just sweep through.
-
-        // TODO: this is a bit of a hack to get the version from plugin management - please fix
-
-        Plugin plugin = findPlugin( project.getPlugins(), groupId, artifactId );
+        String key = Plugin.constructKey( groupId, artifactId );
+        Plugin plugin = (Plugin) project.getBuild().getPluginsAsMap().get( key );
+
+            Plugin def = (Plugin) project.getPluginManagement().getPluginsAsMap().get( key );
+            if ( def != null )
+            {
+                modelDefaultsInjector.mergePluginWithDefaults( plugin, def );
+            }
+
-
-        // TODO: shouldn't have to call all the time
-        modelDefaultsInjector.injectDefaults( project.getModel() );
-
-        // TODO: remove - should discover the version
-        plugin = findPlugin( project.getPlugins(), groupId, artifactId );
-        if ( plugin.getVersion() == null )
-        {
-            plugin.setVersion( PluginDescriptor.getDefaultPluginVersion() );
-        }
-    }
-
-    private static Plugin findPlugin( List plugins, String groupId, String artifactId )
-    {
-        Plugin plugin = null;
-
-        for ( Iterator i = plugins.iterator(); i.hasNext() && plugin == null; )
-        {
-            Plugin p = (Plugin) i.next();
-            if ( groupId.equals( p.getGroupId() ) && artifactId.equals( p.getArtifactId() ) )
-            {
-                plugin = p;
-            }
-        }
-        return plugin;

INS60 INS43 MOV43 INS59 INS42 UPD42 INS42 INS11 INS60 INS25 UPD42 UPD42 MOV42 MOV43 INS32 MOV43 INS59 INS27 INS8 INS32 UPD42 MOV42 UPD42 MOV42 INS42 INS11 INS42 INS33 INS21 MOV32 UPD42 MOV42 MOV43 INS32 INS32 UPD42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS42 DEL42 DEL32 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21 DEL42 DEL42 DEL42 DEL32 DEL7 DEL21 DEL42 DEL32 DEL33 DEL27 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21 DEL8 DEL25 DEL83 DEL83 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL33 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL42 DEL32 DEL59 DEL58 DEL42 DEL42 DEL32 DEL42 DEL33 DEL27 DEL27 DEL42 DEL42 DEL42 DEL32 DEL11 DEL59 DEL60 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL27 DEL42 DEL42 DEL7 DEL21 DEL8 DEL25 DEL8 DEL24 DEL42 DEL41 DEL8 DEL31