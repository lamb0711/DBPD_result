PR: MNG-1101

Fixed dependency-exclusion propagation to the release-pom.xml, and changed the pom-file handling for release:perform to allow non-standard POM filenames, and to prompt in the case where the POM being used is the release-pom.xml.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@329946 13f79535-47bb-0310-9956-ffa450edef68

-import org.codehaus.plexus.components.interactivity.InputHandler;
+import java.util.HashMap;
- * Prepare for a release in SCM
+ * Prepare for a release in SCM.
+ * <br/>
+ * NOTE: This will cause the 'install' phase to be executed...if we cannot
+ * at least install the project, we shouldn't start the release process.
+ * @execute phase="install"
-     * @component
-     */
-    private InputHandler inputHandler;
-
-    /**
-     * @parameter default-value="false"
+     * @parameter default-value="false" expression="${generateReleasePoms}"
-            versionResolver = new ProjectVersionResolver( getLog(), inputHandler, interactive );
+            versionResolver = new ProjectVersionResolver( getLog(), getInputHandler(), interactive );
-
+                
+                    Map oldDeps = new HashMap();
+                    
+                    List deps = releaseProject.getDependencies();
+                    if ( deps != null )
+                    {
+                        for ( Iterator depIterator = deps.iterator(); depIterator.hasNext(); )
+                        {
+                            Dependency dep = (Dependency) depIterator.next();
+                            
+                            oldDeps.put( ArtifactUtils.artifactId( dep.getGroupId(), dep.getArtifactId(), dep.getType(), dep.getVersion() ), dep );
+                        }
+                    }
+
+                        
+                        String key = artifact.getId();
+                        
+                        Dependency old = (Dependency) oldDeps.get( key );
+                        
+                        if ( old != null )
+                        {
+                            newdep.setSystemPath( old.getSystemPath() );
+                            newdep.setExclusions( old.getExclusions() );
+                            newdep.setOptional( old.isOptional() );
+                        }
-                    String inputTag = inputHandler.readLine();
+                    String inputTag = getInputHandler().readLine();
-                throw new MojoExecutionException( "An error is occurred in the tag process.", e );
+                throw new MojoExecutionException( "An error has occurred in the tag process.", e );

MOV26 UPD40 INS65 UPD66 INS66 INS66 INS66 INS66 UPD66 INS32 INS42 INS60 INS60 INS25 INS43 INS59 INS43 INS59 INS27 INS8 UPD45 INS42 INS42 INS14 INS42 INS42 INS32 INS42 INS33 INS24 INS60 INS60 INS25 INS43 INS42 INS42 INS58 INS32 INS8 INS43 INS59 INS43 INS59 INS27 INS8 INS32 INS42 INS43 INS59 INS42 INS42 INS60 INS21 INS42 INS42 INS32 INS42 INS42 INS11 INS42 INS33 INS21 INS21 INS21 UPD42 MOV42 INS42 INS42 INS32 INS43 INS59 INS32 INS42 INS42 INS43 INS32 INS32 INS32 INS32 INS42 INS42 INS42 INS42 INS11 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS43 INS32 INS42 INS42 INS32 INS32 INS32 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL65 DEL29 DEL83 DEL42 DEL43 DEL42 DEL59 DEL23 DEL42