Solving MRM-4. If the source pom doesn't exist, it'll check for the existence of the target pom before writing the skeleton.

It'll always try to verify/patch the MD5/SHA1 for the target pom.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@189785 13f79535-47bb-0310-9956-ffa450edef68

-        boolean pomNeedsRewriting = true;
+        boolean shouldRewritePom = true;
-                pomNeedsRewriting = false;
+                shouldRewritePom = false;
+        else if( targetPom.exists() )
+        {
+            // we have a target pom for this artifact already, and we'll only be making up a new pom.
+            // let's leave the existing one alone.
+            shouldRewritePom = false;
+        }
-        if ( pomNeedsRewriting )
+        File bridgedTargetPom = null;
+        
+        boolean wroteBridge = false;
+        
+        if ( shouldRewritePom )
-                File bridgedTargetPom = new File( targetBase, bridgingLayout.pathOfMetadata( pom ).replace( '+', '-' ) );
+                bridgedTargetPom = new File( targetBase, bridgingLayout.pathOfMetadata( pom ).replace( '+', '-' ) );
-                boolean wroteBridge = bridgePomLocations( pom, targetPom, bridgedTargetPom, artifactReporter,
+                wroteBridge = bridgePomLocations( pom, targetPom, bridgedTargetPom, artifactReporter,
-
-                digestVerifier.verifyDigest( sourcePom, targetPom, transaction, artifactReporter, reportOnly );
-
-                if ( wroteBridge )
-                {
-                    digestVerifier.verifyDigest( sourcePom, bridgedTargetPom, transaction, artifactReporter,
-                                                 reportOnly );
-                }
+        
+        digestVerifier.verifyDigest( sourcePom, targetPom, transaction, artifactReporter, reportOnly );
+
+        if ( wroteBridge )
+        {
+            digestVerifier.verifyDigest( sourcePom, bridgedTargetPom, transaction, artifactReporter,
+                                         reportOnly );
+        }

INS60 INS60 MOV21 MOV25 INS25 MOV43 INS59 INS39 INS59 UPD42 UPD42 INS32 INS8 INS42 INS33 INS42 INS9 INS42 INS42 INS21 INS7 INS21 INS21 INS42 INS9 INS7 INS7 UPD42 INS42 MOV14 INS42 MOV32 DEL42 DEL59 DEL60 DEL39 DEL42 DEL59 DEL60