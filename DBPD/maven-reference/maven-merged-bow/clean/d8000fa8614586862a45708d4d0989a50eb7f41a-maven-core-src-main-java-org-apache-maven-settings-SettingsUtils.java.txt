[MNG-5224] REGRESSION: Injected Settings in a Mojo are missing the profiles from settings.xml

o This is the fix, manually tested. Now I just have to figure out a good way to test the via a unit/integration test

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1226842 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.List;
-
+import java.util.List;
+
+    public static Profile convertToSettingsProfile( org.apache.maven.model.Profile modelProfile )
+    {
+        Profile profile = new Profile();
+
+        profile.setId( modelProfile.getId() );
+
+        org.apache.maven.model.Activation modelActivation = modelProfile.getActivation();
+
+        if ( modelActivation != null )
+        {
+            Activation activation = new Activation();
+
+            activation.setActiveByDefault( modelActivation.isActiveByDefault() );
+
+            activation.setJdk( modelActivation.getJdk() );
+
+            org.apache.maven.model.ActivationProperty modelProp = modelActivation.getProperty();
+
+            if ( modelProp != null )
+            {
+                ActivationProperty prop = new ActivationProperty();
+                prop.setName( modelProp.getName() );
+                prop.setValue( modelProp.getValue() );
+                activation.setProperty( prop );
+            }
+
+            org.apache.maven.model.ActivationOS modelOs = modelActivation.getOs();
+
+            if ( modelOs != null )
+            {
+                ActivationOS os = new ActivationOS();
+
+                os.setArch( modelOs.getArch() );
+                os.setFamily( modelOs.getFamily() );
+                os.setName( modelOs.getName() );
+                os.setVersion( modelOs.getVersion() );
+
+                activation.setOs( os );
+            }
+
+            ActivationFile modelFile = modelActivation.getFile();
+
+            if ( modelFile != null )
+            {
+                org.apache.maven.settings.ActivationFile file = new org.apache.maven.settings.ActivationFile();
+
+                file.setExists( modelFile.getExists() );
+                file.setMissing( modelFile.getMissing() );
+
+                activation.setFile( file );
+            }
+
+            profile.setActivation( activation );
+        }
+
+        profile.setProperties( modelProfile.getProperties() );
+
+        List<org.apache.maven.model.Repository> repos = modelProfile.getRepositories();
+        if ( repos != null )
+        {
+            for ( org.apache.maven.model.Repository repo : repos )
+            {
+                profile.addRepository( convertToSettingsRepository( repo ) );
+            }
+        }
+
+        List<org.apache.maven.model.Repository> pluginRepos = modelProfile.getPluginRepositories();
+        if ( pluginRepos != null )
+        {
+            for ( org.apache.maven.model.Repository pluginRepo : pluginRepos )
+            {
+                profile.addPluginRepository( convertToSettingsRepository( pluginRepo ) );
+            }
+        }
+
+        return profile;
+    }
+
+    /**
+     * @param settingsProfile
+     * @return a profile
+     */
+     * @param modelRepo
+     * @return a repository
+     */
+    private static Repository convertToSettingsRepository( org.apache.maven.model.Repository modelRepo )
+    {
+        Repository repo = new Repository();
+
+        repo.setId( modelRepo.getId() );
+        repo.setLayout( modelRepo.getLayout() );
+        repo.setName( modelRepo.getName() );
+        repo.setUrl( modelRepo.getUrl() );
+
+        if ( modelRepo.getSnapshots() != null )
+        {
+            repo.setSnapshots( convertRepositoryPolicy( modelRepo.getSnapshots() ) );
+        }
+        if ( modelRepo.getReleases() != null )
+        {
+            repo.setReleases( convertRepositoryPolicy( modelRepo.getReleases() ) );
+        }
+
+        return repo;
+    }
+
+    /**
+     * @param modelPolicy
+     * @return a RepositoryPolicy
+     */
+    private static RepositoryPolicy convertRepositoryPolicy( org.apache.maven.model.RepositoryPolicy modelPolicy )
+    {
+        RepositoryPolicy policy = new RepositoryPolicy();
+        policy.setEnabled( modelPolicy.isEnabled() );
+        policy.setUpdatePolicy( modelPolicy.getUpdatePolicy() );
+        policy.setChecksumPolicy( modelPolicy.getChecksumPolicy() );
+        return policy;
+    }
+
+    /**

MOV26 INS31 INS31 INS31 INS29 INS83 INS83 INS43 INS42 INS44 INS8 INS29 INS83 INS83 INS43 INS42 INS44 INS8 INS29 INS83 INS83 INS43 INS42 INS44 INS8 INS65 INS65 INS42 INS43 INS42 INS60 INS21 INS60 INS25 INS21 INS60 INS25 INS60 INS25 INS41 INS65 INS65 INS42 INS43 INS42 INS60 INS21 INS21 INS21 INS21 INS25 INS25 INS41 INS65 INS65 INS42 INS43 INS42 INS60 INS21 INS21 INS21 INS41 INS42 INS66 INS40 INS43 INS59 INS32 INS43 INS59 INS27 INS8 INS32 INS74 INS59 INS27 INS8 INS74 INS59 INS27 INS8 INS42 INS42 INS66 INS40 INS43 INS59 INS32 INS32 INS32 INS32 INS27 INS8 INS27 INS8 INS42 INS42 INS66 INS40 INS43 INS59 INS32 INS32 INS32 INS42 INS42 INS42 INS14 INS42 INS42 INS32 INS40 INS42 INS32 INS42 INS33 INS60 INS21 INS21 INS60 INS25 INS60 INS25 INS60 INS25 INS21 INS42 INS42 INS32 INS43 INS43 INS42 INS32 INS42 INS33 INS70 INS43 INS43 INS42 INS32 INS42 INS33 INS70 INS42 INS42 INS14 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS32 INS33 INS21 INS32 INS33 INS21 INS42 INS42 INS14 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS43 INS42 INS42 INS42 INS42 INS43 INS59 INS32 INS32 INS43 INS59 INS27 INS8 INS43 INS59 INS27 INS8 INS43 INS59 INS27 INS8 INS32 INS42 INS42 INS42 INS40 INS42 INS42 INS44 INS42 INS8 INS42 INS40 INS42 INS42 INS44 INS42 INS8 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS14 INS42 INS42 INS32 INS42 INS42 INS32 INS40 INS42 INS32 INS42 INS33 INS60 INS21 INS21 INS21 INS40 INS42 INS32 INS42 INS33 INS60 INS21 INS21 INS21 INS21 INS21 INS42 INS42 INS32 INS42 INS33 INS60 INS21 INS21 INS21 INS42 INS42 INS42 INS43 INS42 INS21 INS43 INS42 INS21 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS59 INS32 INS32 INS32 INS42 INS42 INS43 INS59 INS32 INS32 INS32 INS32 INS32 INS42 INS42 INS43 INS59 INS32 INS32 INS32 INS40 INS32 INS40 INS32 INS42 INS32 INS42 INS32 INS42 INS42 INS42 INS14 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS14 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS40 INS42 INS14 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS43 INS42 INS42 INS42 INS42 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS43 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS40