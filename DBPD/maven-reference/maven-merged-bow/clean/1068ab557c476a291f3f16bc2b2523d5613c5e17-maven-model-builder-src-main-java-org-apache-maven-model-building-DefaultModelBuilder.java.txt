[MNG-4454] Incomplete <parent> element causes NPE

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@881784 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.building.ModelProblem.Severity;
-        if ( hasErrors( problems.getProblems() ) )
+        if ( problems.hasErrors() )
-                    problems.addError( "Malformed POM " + modelSource.getLocation() + ": " + e.getMessage(), e );
+                    problems.add( Severity.ERROR, "Malformed POM " + modelSource.getLocation() + ": " + e.getMessage(),
+                                  e );
-                    problems.addWarning( "Malformed POM " + modelSource.getLocation() + ": " + e.getMessage(), e );
+                    problems.add( Severity.WARNING, "Malformed POM " + modelSource.getLocation() + ": "
+                        + e.getMessage(), e );
-            problems.addFatalError( "Non-parseable POM " + modelSource.getLocation() + ": " + e.getMessage(), e );
+            problems.add( Severity.FATAL, "Non-parseable POM " + modelSource.getLocation() + ": " + e.getMessage(), e );
-            problems.addFatalError( "Non-readable POM " + modelSource.getLocation() + ": " + e.getMessage(), e );
+            problems.add( Severity.FATAL, "Non-readable POM " + modelSource.getLocation() + ": " + e.getMessage(), e );
-        return model;
-    }
-
-    private boolean hasErrors( List<ModelProblem> problems )
-    {
-        if ( problems != null )
+        if ( problems.hasFatalErrors() )
-            for ( ModelProblem problem : problems )
-            {
-                if ( ModelProblem.Severity.ERROR.compareTo( problem.getSeverity() ) >= 0 )
-                {
-                    return true;
-                }
-            }
+            throw new ModelBuildingException( problems.getRootModelId(), problems.getProblems() );
-        return false;
+        return model;
-                problems.addError( "Invalid repository " + repository.getId() + ": " + e.getMessage(), e );
+                problems.add( Severity.ERROR, "Invalid repository " + repository.getId() + ": " + e.getMessage(), e );
-                problems.addError( "Invalid packaging for parent POM " + ModelProblemUtils.toSourceHint( parentModel )
-                    + ", must be \"pom\" but is \"" + parentModel.getPackaging() + "\"" );
+                problems.add( Severity.ERROR, "Invalid packaging for parent POM "
+                    + ModelProblemUtils.toSourceHint( parentModel ) + ", must be \"pom\" but is \""
+                    + parentModel.getPackaging() + "\"", null );
-            problems.addFatalError( "Non-resolvable parent POM "
+            problems.add( Severity.FATAL, "Non-resolvable parent POM "
-                problems.addError( message );
+                problems.add( Severity.ERROR, message, null );
-                    problems.addError( "Non-resolvable import POM "
+                    problems.add( Severity.ERROR, "Non-resolvable import POM "

INS26 INS40 INS25 INS32 INS32 INS8 MOV42 UPD42 MOV42 INS42 INS42 INS53 INS14 INS43 INS32 INS32 UPD42 INS40 UPD42 INS40 INS42 INS42 INS42 INS42 INS42 UPD42 INS40 UPD42 INS40 INS33 UPD42 INS40 INS33 UPD42 INS40 UPD42 INS40 UPD42 INS40 UPD42 INS40 DEL42 DEL32 DEL32 DEL83 DEL39 DEL42 DEL42 DEL43 DEL42 DEL43 DEL74 DEL42 DEL44 DEL42 DEL33 DEL27 DEL42 DEL43 DEL42 DEL44 DEL42 DEL40 DEL42 DEL42 DEL42 DEL32 DEL32 DEL34 DEL27 DEL9 DEL41 DEL8 DEL25 DEL8 DEL70 DEL8 DEL25 DEL9 DEL41 DEL8 DEL31