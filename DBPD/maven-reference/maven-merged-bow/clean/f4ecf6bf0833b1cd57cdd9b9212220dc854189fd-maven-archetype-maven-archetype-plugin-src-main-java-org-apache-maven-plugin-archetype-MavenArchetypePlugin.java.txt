update the archetypes


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163837 13f79535-47bb-0310-9956-ffa450edef68

- * Copyright 2001-2004 The Apache Software Foundation.
+ * Copyright 2001-2005 The Apache Software Foundation.
+import org.apache.maven.plugin.PluginExecutionException;
-import java.util.ArrayList;
+import java.io.File;
- *
- *
- * @parameter
- *   name="archetype"
- *   type="org.apache.maven.archetype.Archetype"
- *   required="true"
- *   validator=""
- *   expression="#component.org.apache.maven.archetype.Archetype"
- *   description=""
- *
- * @parameter
- *   name="localRepository"
- *   type="org.apache.maven.artifact.ArtifactRepository"
- *   required="true"
- *   validator=""
- *   expression="#localRepository"
- *   description=""
- *
- * @parameter
- *   name="archetypeGroupId"
- *   type="String"
- *   required="true"
- *   validator=""
- *   expression="#archetypeGroupId"
- *   default="maven"
- *   description=""
- *
- * @parameter
- *   name="archetypeArtifactId"
- *   type="String"
- *   required="true"
- *   validator=""
- *   expression="#archetypeArtifactId"
- *   default="maven"
- *   description=""
- *
- * @parameter
- *   name="archetypeVersion"
- *   type="String"
- *   required="true"
- *   validator=""
- *   expression="#archetypeVersion"
- *   default="maven"
- *   description=""
- *
- * @parameter
- *   name="groupId"
- *   type="String"
- *   required="true"
- *   validator=""
- *   expression="#groupId"
- *   default="maven"
- *   description=""
- *
- * @parameter
- *   name="artifactId"
- *   type="String"
- *   required="true"
- *   validator=""
- *   expression="#artifactId"
- *   default="quickstart"
- *   description=""
- *
- * @parameter
- *   name="version"
- *   type="String"
- *   required="true"
- *   validator=""
- *   expression="#version"
- *   default="1.0"
- *   description=""
- *
- * @parameter
- *   name="package"
- *   type="String"
- *   required="true"
- *   validator=""
- *   expression="#package"
- *   default="org.apache.maven.quickstart"
- *   description=""
+ * @parameter name="archetype"
+ * type="org.apache.maven.archetype.Archetype"
+ * required="true"
+ * validator=""
+ * expression="#component.org.apache.maven.archetype.Archetype"
+ * description=""
+ * @parameter name="localRepository"
+ * type="org.apache.maven.artifact.ArtifactRepository"
+ * required="true"
+ * validator=""
+ * expression="#localRepository"
+ * description=""
+ * @parameter name="archetypeGroupId"
+ * type="String"
+ * required="true"
+ * validator=""
+ * expression="#archetypeGroupId"
+ * default="org.apache.maven.archetypes"
+ * description=""
+ * @parameter name="archetypeArtifactId"
+ * type="String"
+ * required="true"
+ * validator=""
+ * expression="#archetypeArtifactId"
+ * default="maven-archetype-quickstart"
+ * description=""
+ * @parameter name="archetypeVersion"
+ * type="String"
+ * required="true"
+ * validator=""
+ * expression="#archetypeVersion"
+ * default="1.0-alpha-1-SNAPSHOT"
+ * description=""
+ * @parameter name="groupId"
+ * type="String"
+ * required="true"
+ * validator=""
+ * expression="#groupId"
+ * description=""
+ * @parameter name="artifactId"
+ * type="String"
+ * required="true"
+ * validator=""
+ * expression="#artifactId"
+ * description=""
+ * @parameter name="version"
+ * type="String"
+ * required="true"
+ * validator=""
+ * expression="#version"
+ * default="1.0-SNAPSHOT"
+ * description=""
+ * @parameter name="package"
+ * type="String"
+ * required="true"
+ * validator=""
+ * expression="#package"
+ * default="com.mycompany.app"
+ * description=""
+ * @parameter name="remoteRepositories"
+ * type="java.util.List"
+ * required="true"
+ * validator=""
+ * expression="#project.remoteArtifactRepositories"
+ * description=""
+        // TODO: prompt for missing values
+        // TODO: use new plugin type
+        // TODO: configurable license
+
-        // When there is no project how do we get the local repository and remote repos.
-        // The local repository will always be present but the remote is in the POM except
-        // for the super POM ...
-
-        List remoteRepositories = new ArrayList();
-
-        ArtifactRepository remoteRepository = new ArtifactRepository( "remote", "http://repo1.maven.org" );
-
-        remoteRepositories.add( remoteRepository );
+        // From the super POM
+        List remoteRepositories = (List) request.getParameter( "remoteRepositories" );
-        request.getParameters().put( "outputDirectory", System.getProperty( "user.dir" ) );
+        String basedir = System.getProperty( "user.dir" );
-        archetype.createArchetype( archetypeGroupId, archetypeArtifactId, archetypeVersion,
-                                   localRepository, remoteRepositories, request.getParameters() );
+        // TODO: allow this to be configured
+        File outputDirectory = new File( basedir, (String) request.getParameter( "artifactId" ) );
+        request.getParameters().put( "outputDirectory", outputDirectory.getAbsolutePath() );
+
+        if ( outputDirectory.exists() )
+        {
+            throw new PluginExecutionException(
+                outputDirectory.getName() + " already exists - please run from a clean directory" );
+        }
+
+        archetype.createArchetype( archetypeGroupId, archetypeArtifactId, archetypeVersion, localRepository,
+                                   remoteRepositories, request.getParameters() );

INS26 INS40 UPD40 INS65 MOV60 MOV21 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 UPD66 INS66 INS66 INS66 INS66 INS66 INS66 INS60 INS25 INS43 INS59 UPD43 INS32 INS8 INS11 INS42 INS42 MOV32 UPD42 UPD42 MOV32 UPD42 INS45 INS32 UPD42 MOV42 INS42 INS53 INS43 INS32 UPD43 INS42 INS11 UPD42 MOV42 UPD42 MOV42 INS14 UPD42 MOV42 INS42 INS42 INS45 UPD42 INS43 INS32 INS43 INS27 INS42 INS42 INS42 INS45 INS42 INS32 INS45 INS42 INS42 DEL66 DEL66 DEL43 DEL14 DEL45 DEL45 DEL45 DEL32 DEL21