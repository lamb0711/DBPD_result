compile based on source roots


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163423 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.ArrayList;
- *  name="sourceDirectory"
- *  type="String"
+ *  name="compileSourceRootsList"
+ *  type="java.util.List"
- *  expression="#project.build.sourceDirectory"
+ *  expression="#project.compileSourceRootsList"
- * @todo use compile source roots and not the pom.build.sourceDirectory so that any
- *       sort of preprocessing and/or source generation can be taken into consideration.
-        String sourceDirectory = (String) request.getParameter( "sourceDirectory" );
+        List compileSourceRootsList = (List) request.getParameter( "compileSourceRootsList" );
-        
-        if ( ! new File( sourceDirectory ).exists() )
+
+        compileSourceRootsList = removeEmptyCompileSourceRoots( compileSourceRootsList );
+        if ( compileSourceRootsList.isEmpty() )
-        
+
-        compilerConfiguration.setSourceLocations(Arrays.asList(new String[] {sourceDirectory}));
+        compilerConfiguration.setSourceLocations( compileSourceRootsList );
+
+    /** @todo also in ant plugin. This should be resolved at some point so that it does not need to be calculated continuously - or should the plugins accept empty source roots as is? */
+    private static List removeEmptyCompileSourceRoots( List compileSourceRootsList )
+    {
+        List newCompileSourceRootsList = new ArrayList();
+        if ( compileSourceRootsList != null )
+        {
+            // copy as I may be modifying it
+            for ( Iterator i = compileSourceRootsList.iterator(); i.hasNext(); )
+            {
+                String srcDir = (String) i.next();
+                if ( !newCompileSourceRootsList.contains( srcDir ) && new File( srcDir ).exists() )
+                {
+                    newCompileSourceRootsList.add( srcDir );
+                }
+            }
+        }
+        return newCompileSourceRootsList;
+    }

INS26 INS40 INS31 INS29 INS83 INS83 INS43 INS42 INS44 INS8 UPD66 UPD66 UPD66 INS21 INS65 INS42 INS43 INS42 INS60 INS25 INS41 UPD43 INS7 INS32 INS66 INS42 INS43 INS59 INS27 INS8 INS42 UPD42 UPD42 INS42 INS32 INS42 INS42 UPD42 MOV42 INS42 INS42 INS14 INS42 INS33 INS24 INS43 INS42 INS42 INS43 INS58 INS32 INS8 INS42 UPD45 INS42 INS43 INS59 INS42 INS42 INS60 INS25 INS42 INS42 INS32 MOV43 INS59 INS27 INS8 INS42 INS42 INS42 INS11 INS38 MOV32 INS21 MOV43 INS32 INS32 INS32 INS42 INS42 INS42 INS42 INS42 UPD42 INS42 INS42 INS42 DEL66 DEL66 DEL65 DEL38 DEL42 DEL85 DEL5 DEL42 DEL4 DEL3 DEL32