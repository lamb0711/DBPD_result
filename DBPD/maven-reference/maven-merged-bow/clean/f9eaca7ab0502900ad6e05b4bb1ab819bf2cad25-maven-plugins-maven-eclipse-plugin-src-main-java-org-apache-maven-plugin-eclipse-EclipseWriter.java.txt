PR: MNG-549
Submitted by: Kenney Westerhof
make eclipse plugin reactor aware


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@225723 13f79535-47bb-0310-9956-ffa450edef68

-    public void write( MavenProject project, MavenProject executedProject )
+    public void write( MavenProject project, MavenProject executedProject, List reactorProjects )
-        writeEclipseClasspath( basedir, project, executedProject, map );
+        writeEclipseClasspath( basedir, project, executedProject, map, reactorProjects );
-    protected void writeEclipseClasspath( File basedir, MavenProject project, MavenProject executedProject, Map map )
+    protected void writeEclipseClasspath( File basedir, MavenProject project, MavenProject executedProject, Map map, List reactorProjects )
-            addDependency( writer, artifact );
+            addDependency( writer, artifact, reactorProjects );
-    private void addDependency( XMLWriter writer, Artifact artifact )
+    private void addDependency( XMLWriter writer, Artifact artifact, List reactorProjects )
-        File path = artifact.getFile();
-
+        String path = getProjectPath( reactorProjects, artifact );
+        
+        String kind = path == null ? "var" : "src";
+                
+        // fall-through when no local project could be found in the reactor
-            System.err.println( "The artifacts path was null. Artifact id: " + artifact.getId() );
+            File artifactPath = artifact.getFile();
-            return;
+            if ( artifactPath == null )
+            {
+                System.err.println( "The artifacts path was null. Artifact id: " + artifact.getId() );
+    
+                return;
+            }
+            
+            path = "M2_REPO/" + toRelative( localRepository, artifactPath.getPath() );
-        writer.addAttribute( "kind", "var" );
+        writer.addAttribute( "kind", kind );
-        writer.addAttribute( "path", "M2_REPO/" + toRelative( localRepository, path.getPath() ) );
+        writer.addAttribute( "path", path );
+    
+    private String getProjectPath( List reactorProjects, Artifact artifact )
+    {
+        if ( reactorProjects == null )
+        {
+            return null;	// we're a single project
+        }
+        
+        for (Iterator it = reactorProjects.iterator(); it.hasNext(); )
+        {
+            MavenProject project = (MavenProject) it.next();
+            
+            if ( project.getGroupId().equals( artifact.getGroupId() )
+                && project.getArtifactId().equals( artifact.getArtifactId() )
+                && project.getVersion().equals( artifact.getVersion() )
+            )
+            {
+                return "/" + project.getArtifactId();
+            }
+        }
+        
+        return null;
+    }

INS31 INS44 INS44 INS44 INS83 INS43 INS42 INS44 INS44 INS8 INS43 INS42 INS43 INS42 INS43 INS42 INS60 INS60 INS25 INS21 INS21 INS42 INS43 INS42 INS43 INS42 INS25 INS24 INS41 INS42 INS42 INS42 INS43 INS59 INS43 INS59 MOV27 INS8 INS32 INS32 INS42 INS42 INS27 INS8 INS58 INS32 INS8 INS33 INS42 INS42 INS42 INS32 INS42 INS42 INS16 MOV60 MOV25 MOV21 INS42 INS42 INS45 INS42 INS42 INS42 INS45 INS42 INS42 INS33 INS41 INS43 INS59 INS42 INS42 INS60 INS25 INS42 INS42 INS42 INS27 INS45 INS45 INS27 INS7 INS33 INS42 INS42 INS32 INS43 INS59 INS27 INS8 INS42 INS42 INS33 UPD42 INS42 INS33 INS42 INS27 INS42 INS42 INS42 INS42 INS11 INS32 INS32 INS32 INS41 MOV45 MOV32 INS43 INS32 INS32 INS42 INS32 INS32 INS42 INS32 INS32 INS42 INS32 INS27 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS45 INS32 UPD42 INS42 INS42 DEL42 DEL42 DEL45 DEL27 DEL32 DEL42 DEL42 DEL45 DEL45 DEL32 DEL21