don't include lifecycle introduced plugins (also resolves issue with release plugin snapshot)


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@290352 13f79535-47bb-0310-9956-ffa450edef68

-    
+
-    
+
-    
+
-                
+
-                
+
-                    
-                    projectVersion = getVersionResolver().getResolvedVersion( releaseModel.getGroupId(), releaseModel.getArtifactId() );
-                    
+
+                    projectVersion = getVersionResolver().getResolvedVersion( releaseModel.getGroupId(),
+                                                                              releaseModel.getArtifactId() );
+
-                        throw new MojoExecutionException( "MAJOR PROBLEM!!! Cannot find resolved version to be used in releasing project: " + releaseProject.getId() );
+                        throw new MojoExecutionException(
+                            "MAJOR PROBLEM!!! Cannot find resolved version to be used in releasing project: " +
+                                releaseProject.getId() );
-                    
+
-                    
+
-                    
+
-                        throw new MojoExecutionException( "Cannot reliably adjust the finalName of project: " + releaseProject.getId() );
+                        throw new MojoExecutionException(
+                            "Cannot reliably adjust the finalName of project: " + releaseProject.getId() );
-                
+
-                        
+
-                        
+
-                            version = getVersionResolver().getResolvedVersion(artifact.getGroupId(), artifact.getArtifactId() );
-                            
+                            version = getVersionResolver().getResolvedVersion( artifact.getGroupId(),
+                                                                               artifact.getArtifactId() );
+
-                                throw new MojoExecutionException( "Unresolved SNAPSHOT version of: " + artifact.getId() + ". Cannot proceed with release." );
+                                throw new MojoExecutionException( "Unresolved SNAPSHOT version of: " +
+                                    artifact.getId() + ". Cannot proceed with release." );
-                        
+
-                // TODO: but is it the right settings?
-                Build model = releaseProject.getModel().getBuild();
-                List plugins = model != null ? model.getPlugins() : null;
+                Build build = releaseProject.getOriginalModel().getBuild();
+                List plugins = build != null ? build.getPlugins() : null;
-                            version = pluginVersionManager.resolvePluginVersion( plugin.getGroupId(), plugin.getArtifactId(), project, settings, localRepository );
+                            version = pluginVersionManager.resolvePluginVersion( plugin.getGroupId(),
+                                                                                 plugin.getArtifactId(), project,
+                                                                                 settings, localRepository );
-                        
-                        if ( ArtifactUtils.isSnapshot(version))
+
+                        if ( ArtifactUtils.isSnapshot( version ) )
-                            throw new MojoExecutionException( "Resolved version of plugin is a snapshot. Please release this plugin before releasing this project.\n\nGroupId: " + plugin.getGroupId() + "\nArtifactId: " + plugin.getArtifactId() + "\nResolved Version: " + version + "\n\n" );
+                            throw new MojoExecutionException(
+                                "Resolved version of plugin is a snapshot. Please release this plugin before releasing this project.\n\nGroupId: " +
+                                    plugin.getGroupId() + "\nArtifactId: " + plugin.getArtifactId() +
+                                    "\nResolved Version: " + version + "\n\n" );
-                        
-                        if ( ArtifactUtils.isSnapshot(version))
+
+                        if ( ArtifactUtils.isSnapshot( version ) )
-                            throw new MojoExecutionException( "Resolved version of plugin is a snapshot. Please release this report plugin before releasing this project.\n\nGroupId: " + plugin.getGroupId() + "\nArtifactId: " + plugin.getArtifactId() + "\nResolved Version: " + version + "\n\n" );
+                            throw new MojoExecutionException(
+                                "Resolved version of plugin is a snapshot. Please release this report plugin before releasing this project.\n\nGroupId: " +
+                                    plugin.getGroupId() + "\nArtifactId: " + plugin.getArtifactId() +
+                                    "\nResolved Version: " + version + "\n\n" );
-                
+
-                    relativizeBuildPaths( model, project.getFile().getParentFile().getCanonicalPath() );
+                    relativizeBuildPaths( releaseProject.getModel().getBuild(),
+                                          project.getFile().getParentFile().getCanonicalPath() );
-        
+
-        
+
-        
+
-        
+
-        
+
-        
+
-        
+
-                
+
-        
+
-                
+

INS42 INS32 INS32 INS42 INS42 INS42 UPD42 UPD42 MOV32 DEL42 DEL42