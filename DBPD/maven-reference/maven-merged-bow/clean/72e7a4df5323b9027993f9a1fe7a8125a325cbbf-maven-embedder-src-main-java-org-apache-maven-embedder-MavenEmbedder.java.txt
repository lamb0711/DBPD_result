o lining up all the uses of modello and using 1.0-alpha-13 of the modello plugin everywhere                                         
o add the generation of a JDOMWriter for use in the embedder so that working with models doesn't                                    
  completely whack the existing XML, and allow for outputting the namespace declarations                                            
o add a security manager to the embedder which is off by default but will barf if someone                                           
  tries to set system properties. you have to specifically turn this on because it will more then                                   
  likely break tons of code like xerces setting a system property named "version", nice.       



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@493811 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.embedder.writer.WriterUtils;
-import org.apache.maven.model.io.xpp3.MavenXpp3Writer;
-import org.apache.maven.plugin.descriptor.PluginDescriptor;
+import org.apache.maven.model.io.jdom.MavenJDOMWriter;
-import org.apache.maven.reactor.MavenExecutionException;
-import org.apache.maven.wagon.events.TransferListener;
-import java.io.InputStream;
-import java.io.InputStreamReader;
-    private MavenXpp3Writer modelWriter;
+    private MavenJDOMWriter modelWriter;
+    private boolean activateSystemManager;
+
+        // ----------------------------------------------------------------------------
+        // Don't override any existing SecurityManager if one has been installed. Our
+        // SecurityManager just checks to make sure
+        // ----------------------------------------------------------------------------
+
+        try
+        {
+            if ( System.getSecurityManager() == null && activateSystemManager )
+            {
+                System.setSecurityManager( new MavenEmbedderSecurityManager() );
+            }
+        }
+        catch ( RuntimeException e )
+        {
+            logger.warn( "Error trying to set the SecurityManager: " + e.getMessage() );
+        }
+
+                            Model model,
+                            boolean namespaceDeclaration )
+        throws IOException
+    {
+        WriterUtils.write( writer, model, true );
+    }
+
+    public void writeModel( Writer writer,
-        modelWriter.write( writer, model );
+        WriterUtils.write( writer, model, false );
-            MavenEmbedderLoggerManager loggerManager = new MavenEmbedderLoggerManager( new PlexusLoggerAdapter( logger ) );
+            MavenEmbedderLoggerManager loggerManager =
+                new MavenEmbedderLoggerManager( new PlexusLoggerAdapter( logger ) );
-            modelWriter = new MavenXpp3Writer();
+            modelWriter = new MavenJDOMWriter();

MOV26 MOV26 UPD40 UPD40 INS23 INS31 UPD43 INS83 INS39 INS59 INS44 INS43 INS83 INS39 INS42 INS44 INS44 MOV43 INS8 UPD42 INS42 INS54 INS39 INS42 INS42 INS43 INS42 INS43 INS42 INS21 INS8 INS12 INS42 INS42 INS32 INS25 INS44 INS8 UPD42 INS9 INS42 INS42 INS42 INS42 INS9 INS27 INS8 INS43 INS42 INS21 INS27 INS42 INS21 INS42 INS32 INS32 INS33 INS32 INS42 INS42 INS27 UPD43 INS42 INS42 INS42 INS42 INS14 INS45 INS32 UPD42 INS43 INS42 INS42 INS42 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26