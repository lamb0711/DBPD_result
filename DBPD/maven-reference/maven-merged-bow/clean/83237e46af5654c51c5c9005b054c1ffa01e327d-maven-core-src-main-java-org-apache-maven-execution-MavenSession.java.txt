[MNG-3004] Concurrent building of multimodule projects

This commit consists of a modularization of the DefaultLifecycleExecutor into smaller
components. This is primarily done with the intention of extracting execution strategy 
somewhat from the rest of the logic.

It also contains three differenent execution strategies:
A) Linear ("Classic")
B) Parallel (Based on Dan's original implemementation)
C) Weave (Still experimental) 

 
The command line -T option activates parallel running, and the argument
is in the form -T <[nThreads, a float][C][W]|auto>

Notes:
* The output demultiplexer is disabled in this commit, and output will appear intermingled.
* The modello plugin has known problems
* Surefire must be run in forkmode at least once.


git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@931884 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Collections;
+    implements Cloneable
-    
+
-        
+
-    
+
-    private Collection<String> blackListedProjects;
+    private boolean parallel;
-    private final Map<String,Map<String,Map<String,Object>>>  pluginContextsByProjectAndPluginKey =
-        new ConcurrentHashMap<String,Map<String,Map<String,Object>>> ();
+    private final Map<String, Map<String, Map<String, Object>>> pluginContextsByProjectAndPluginKey =
+        new ConcurrentHashMap<String, Map<String, Map<String, Object>>>();
-    public MavenSession( PlexusContainer container, MavenExecutionRequest request, MavenExecutionResult result, MavenProject project )
+    public MavenSession( PlexusContainer container, MavenExecutionRequest request, MavenExecutionResult result,
+                         MavenProject project )
-        this( container, request, result, Arrays.asList( new MavenProject[]{ project } ) );        
-    }    
+        this( container, request, result, Arrays.asList( new MavenProject[]{project} ) );
+    }
-    public MavenSession( PlexusContainer container, MavenExecutionRequest request, MavenExecutionResult result, List<MavenProject> projects )
+    public MavenSession( PlexusContainer container, MavenExecutionRequest request, MavenExecutionResult result,
+                         List<MavenProject> projects )
-    }    
-        
+    }
+
-     * 
+     *
-     * 
+     *
-    
+
-    
+
-    
+
-    }        
+    }
-    }        
-
+    }
+
+    public ProjectDependencyGraph getProjectDependencyGraph()
+    {
+        return projectDependencyGraph;
+    }
+
-    public boolean isBlackListed( MavenProject project )
+    @Override
+    public MavenSession clone()
-        return blackListedProjects != null && blackListedProjects.contains( getId( project ) );
-    }
-
-    public void blackList( MavenProject project )
-    {
-        if ( blackListedProjects == null )
+        try
-            blackListedProjects = new HashSet<String>();
+            return (MavenSession) super.clone();
-
-        if ( blackListedProjects.add( getId( project ) ) && projectDependencyGraph != null )
+        catch ( CloneNotSupportedException e )
-            for ( MavenProject downstreamProject : projectDependencyGraph.getDownstreamProjects( project, true ) )
-            {
-                blackListedProjects.add( getId( downstreamProject ) );
-            }
+            throw new RuntimeException( "Bug", e );
+    public boolean isParallel() {
+        return parallel;
+    }
+
+    public void setParallel(boolean parallel) {
+        this.parallel = parallel;
+    }

INS26 MOV31 INS40 INS43 INS31 INS31 INS31 INS42 INS39 INS43 INS42 INS78 MOV83 INS43 INS42 INS8 INS83 INS39 INS42 INS8 INS83 INS39 INS42 INS44 INS8 UPD42 UPD42 MOV42 INS42 UPD42 MOV42 INS54 INS41 INS39 INS42 MOV21 INS42 INS8 INS12 INS42 INS7 INS41 INS44 INS8 INS22 INS42 INS11 INS43 INS42 INS53 INS52 INS42 INS43 INS48 INS42 INS14 UPD42 MOV42 INS42 INS43 INS45 INS42 INS42 DEL42 DEL43 DEL42 DEL43 DEL74 DEL39 DEL42 DEL43 DEL42 DEL44 DEL42 DEL33 DEL27 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL27 DEL39 DEL42 DEL43 DEL42 DEL44 DEL42 DEL33 DEL27 DEL42 DEL43 DEL42 DEL43 DEL74 DEL14 DEL7 DEL21 DEL8 DEL25 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL42 DEL33 DEL27 DEL27 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL9 DEL32 DEL8 DEL70 DEL8 DEL25 DEL8 DEL31 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32