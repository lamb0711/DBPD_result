Commented out use of cached model in MavenMetadataSource, as this is causing problems with projects that depend on other projects which use managed dependencies.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163847 13f79535-47bb-0310-9956-ffa450edef68

-        if ( mavenProjectBuilder != null )
-        {
-            Model model = mavenProjectBuilder.getCachedModel( artifact.getGroupId(), artifact.getArtifactId(),
-                                                              artifact.getVersion() );
-            if ( model != null )
-            {
-                dependencies = model.getDependencies();
-            }
-        }
+        // [jc] Commenting this out, because the place where the model is 
+        // cached in the project builder has not accounted for interpolation or
+        // defaults injection. This wouldn't be a problem, except that the 
+        // interpolation step actually returns a different instance of the 
+        // model than was input, thus rendering the old version of the model
+        // stale. To test this, you have to create an artifact whose pom uses
+        // managed dependencies, then depend on that artifact from another
+        // project. The first plugin to refer to this dependency will work fine, 
+        // but subsequent plugins referring to the dep will retrieved a cached
+        // copy of the model that has no versions, etc. defined because that
+        // model instance has not had defaults injected or interpolations 
+        // resolved. See note in DefaultMavenProjectBuilder, line 170 for 
+        // further discussion.
+        
+//        if ( mavenProjectBuilder != null )
+//        {
+//            Model model = mavenProjectBuilder.getCachedModel( artifact.getGroupId(), artifact.getArtifactId(),
+//                                                              artifact.getVersion() );
+//            if ( model != null )
+//            {
+//                dependencies = model.getDependencies();
+//            }
+//        }

DEL42 DEL33 DEL27 DEL42 DEL43 DEL42 DEL42 DEL42 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL32 DEL59 DEL60 DEL42 DEL33 DEL27 DEL42 DEL42 DEL42 DEL32 DEL7 DEL21 DEL8 DEL25 DEL8 DEL25