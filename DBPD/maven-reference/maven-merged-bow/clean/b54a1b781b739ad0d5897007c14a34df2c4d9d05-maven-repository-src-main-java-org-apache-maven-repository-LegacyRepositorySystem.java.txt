o large patch to rework the chained local repository implementations necessary for efficient reactor and IDE workspace resolution
Submitted by: Igor Fedorenko

I've asked Igor to fill out and send in a CLA and I will put him on the Sonatype CCLA



git-svn-id: https://svn.apache.org/repos/asf/maven/components/branches/MNG-2766@777298 13f79535-47bb-0310-9956-ffa450edef68

-import java.net.MalformedURLException;
-import java.util.HashMap;
-import java.util.Map;
-import org.apache.maven.wagon.authentication.AuthenticationInfo;
-import org.apache.maven.wagon.proxy.ProxyInfo;
-import org.apache.maven.wagon.repository.RepositoryPermissions;
+import org.codehaus.plexus.PlexusContainer;
+import org.codehaus.plexus.component.repository.exception.ComponentLookupException;
-    
+
+    @Requirement
+    private PlexusContainer plexus;
+
-    {                
+    {
+        /*
+         * Probably is not worth it, but here I make sure I restore request
+         * to its original state. 
+         */
+        try
+        {
+            LocalArtifactRepository ideWorkspace = plexus.lookup( LocalArtifactRepository.class, LocalArtifactRepository.IDE_WORKSPACE );
+
+            if ( request.getLocalRepository() instanceof DelegatingLocalArtifactRepository )
+            {
+                DelegatingLocalArtifactRepository delegatingLocalRepository = (DelegatingLocalArtifactRepository) request.getLocalRepository();
+
+                LocalArtifactRepository orig = delegatingLocalRepository.getIdeWorspace();
+
+                delegatingLocalRepository.setIdeWorkspace( ideWorkspace );
+
+                try
+                {
+                    return artifactResolver.resolve( request );
+                }
+                finally
+                {
+                    delegatingLocalRepository.setIdeWorkspace( orig );
+                }
+            }
+            else
+            {
+                ArtifactRepository localRepository = request.getLocalRepository();
+                DelegatingLocalArtifactRepository delegatingLocalRepository = new DelegatingLocalArtifactRepository( localRepository );
+                delegatingLocalRepository.setIdeWorkspace( ideWorkspace );
+                request.setLocalRepository( delegatingLocalRepository );
+                try
+                {
+                    return artifactResolver.resolve( request );
+                }
+                finally
+                {
+                    request.setLocalRepository( localRepository );
+                }
+            }
+        }
+        catch ( ComponentLookupException e )
+        {
+            // no ide workspace artifact resolution
+        }
+

MOV26 UPD40 UPD40 INS23 INS78 INS83 INS43 INS59 INS8 INS42 INS42 INS42 INS54 INS41 INS8 INS12 INS32 INS60 INS25 INS44 INS8 INS42 INS42 INS42 INS43 INS59 INS62 INS8 INS8 INS43 INS42 INS42 INS42 INS32 INS32 INS43 INS60 INS60 INS21 INS54 INS60 INS60 INS21 INS21 INS54 INS42 INS42 INS42 INS57 INS40 INS42 INS42 INS42 INS43 INS59 INS43 INS59 INS32 MOV8 INS8 INS43 INS59 INS43 INS59 INS32 INS32 INS8 INS8 INS43 INS42 INS42 INS11 INS42 INS42 INS32 INS42 INS42 INS42 INS21 INS42 INS42 INS32 INS42 INS42 INS14 INS42 INS42 INS42 INS42 INS42 INS42 INS41 INS21 INS42 INS43 INS32 INS42 INS42 INS32 INS42 INS42 INS43 INS42 INS32 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26