Resolving: MNG-885

o Extracting basedir from the project instance when PluginParameterExpressionEvaluator is init'ed if project != null...otherwise, using ${user.dir} from sysprops.

o Extracting values for resolution from POM properties before POM instance during POM interpolation, and adding checks to guard against self-reference of POM elements.

o Added three ITs (one contra) to test these resolutions.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@291735 13f79535-47bb-0310-9956-ffa450edef68

+    
+    private final String basedir;
+        
+        String basedir = null;
+        
+        if ( project != null )
+        {
+            File projectFile = project.getFile();
+            
+            // this should always be the case for non-super POM instances...
+            if ( projectFile != null )
+            {
+                basedir = projectFile.getParentFile().getAbsolutePath();
+            }
+        }
+
+        if ( basedir == null )
+        {
+            basedir = System.getProperty( "user.dir" );
+        }
+        
+        this.basedir = basedir;
-            value = project.getBasedir().getAbsolutePath();
+            value = basedir;
-                value = project.getFile().getParentFile().getAbsolutePath() + expression.substring( pathSeparator );
+                value = basedir + expression.substring( pathSeparator );
-            // Check properties that have been injected via profiles before we default over to
-            // system properties.
-
-            if ( project.getProperties() != null )
+            // Check POM-level properties before we default over to system properties.
+            if ( project != null && project.getProperties() != null )

INS23 INS83 INS83 INS43 INS59 INS42 INS42 INS60 INS25 INS25 INS21 INS43 INS59 INS27 INS8 INS27 INS8 INS7 INS42 INS42 INS33 INS42 INS33 INS60 INS25 INS42 INS33 INS21 INS22 INS42 INS43 INS59 INS27 INS8 INS7 INS52 INS42 INS27 INS42 INS42 MOV32 INS42 INS33 INS21 INS42 INS32 INS27 MOV27 INS7 INS42 INS42 INS45 INS42 INS33 INS42 INS32 INS32 INS42 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL32 DEL42 DEL32 DEL42 DEL32 DEL42 DEL32