o adding a way to set the local repository using a -D option 
o make the cli handle things that are CLI specific like:
  - the $m2_home/conf/settings.xml file and the standard ~/.m2/settings.xml file, i am still falling back
    to this as people using the embedder have become used to this. but this has the effect of greatly 
    simplifying settings handling because it is up to the client code to define where settings are
    and how they should be processed
o use an embedder configuration for things like settings and the local repository which generally remain constant, another
  push toward a single source for session and request configuration information


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@512542 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.embedder.configuration.Configuration;
+import org.apache.maven.embedder.configuration.DefaultConfiguration;
-import org.apache.maven.settings.SettingsBuilderAdvice;
+    public static final File DEFAULT_GLOBAL_SETTINGS_FILE = new File( System
+        .getProperty( "maven.home", System.getProperty( "user.dir", "" ) ), "conf/settings.xml" );
+
+    public static final String LOCAL_REPO_PROPERTY = "maven.repo.local";
+
+
-        //** use CLI option values directly in request where possible
-
-        MavenEmbedder mavenEmbedder;
-
-        try
-        {
-            mavenEmbedder = new MavenEmbedder( classWorld );            
-        }
-        catch ( MavenEmbedderException e )
-        {
-            showFatalError( "Unable to start the embedded plexus container", e, showErrors );
-
-            return 1;
-        }
-
-            
-            SettingsBuilderAdvice settingsAdvice = new SettingsBuilderAdvice();
-            
-            settingsAdvice.setDefaultGlobalLocationEnabled( true );
-            settingsAdvice.setDefaultUserLocationEnabled( true );
-                    // Settings
-                .setSettingsFile( commandLine.getOptionValue( CLIManager.ALTERNATE_USER_SETTINGS ) )
-                .setSettingsBuilderAdvice( settingsAdvice )
-                    //.setLocalRepositoryPath( localRepositoryPath ) // default: ~/.m2/repository
-                    //
+        File userSettingsFile;
+
+        if ( commandLine.getOptionValue( CLIManager.ALTERNATE_USER_SETTINGS ) != null )
+        {
+            userSettingsFile = new File( commandLine.getOptionValue( CLIManager.ALTERNATE_USER_SETTINGS ) );
+        }
+        else
+        {
+            userSettingsFile = MavenEmbedder.DEFAULT_USER_SETTINGS_FILE;
+        }
+
+        Configuration configuration = new DefaultConfiguration()
+            .setUserSettingsFile( userSettingsFile )
+            .setGlobalSettingsFile( DEFAULT_GLOBAL_SETTINGS_FILE )
+            .setClassWorld( classWorld );
+
+        String localRepoProperty = executionProperties.getProperty( LOCAL_REPO_PROPERTY );
+
+        if ( localRepoProperty != null )
+        {
+            configuration.setLocalRepository( new File( localRepoProperty ) );
+        }
+
+        MavenEmbedder mavenEmbedder;
+
+        try
+        {
+            mavenEmbedder = new MavenEmbedder( configuration );
+        }
+        catch ( MavenEmbedderException e )
+        {
+            showFatalError( "Unable to start the embedded plexus container", e, showErrors );
+
+            return 1;
+        }
+
+

MOV26 INS26 UPD40 INS40 INS23 INS23 INS83 INS83 INS83 INS43 INS59 INS83 INS83 INS83 INS43 INS59 MOV60 MOV54 MOV60 INS42 INS42 INS14 INS42 INS42 INS45 INS60 INS25 INS60 INS25 INS43 INS32 INS45 INS43 INS59 INS27 INS8 INS8 UPD43 INS43 INS59 INS27 INS8 INS42 INS42 INS42 INS45 INS32 MOV32 INS42 INS42 INS32 INS33 INS21 INS21 UPD42 UPD42 INS32 INS42 INS42 INS32 INS42 INS33 MOV21 INS42 INS42 INS45 INS45 UPD42 UPD42 INS42 INS42 INS40 INS7 INS7 INS32 INS42 INS42 UPD42 MOV42 UPD42 MOV42 INS42 UPD42 UPD42 INS42 INS14 INS42 INS40 INS32 INS42 INS42 INS42 UPD42 INS14 UPD42 UPD42 INS43 MOV32 INS14 INS42 INS42 INS43 INS42 UPD42 UPD42 UPD42 INS42 UPD43 MOV43 INS42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 UPD42 INS42 DEL9 DEL32 DEL21 DEL42 DEL42 DEL32 DEL42 DEL42 DEL32 DEL14 DEL42 DEL9