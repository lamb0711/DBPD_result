various release plugin fixes

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@279256 13f79535-47bb-0310-9956-ffa450edef68

-     * @parameter expression="${maven.username}"
+     * @parameter expression="${username}"
-    private String username = System.getProperty( "user.name" );
+    private String username;
-            for ( Iterator it = reactorProjects.iterator(); it.hasNext(); )
-            {
-                MavenProject project = (MavenProject) it.next();
-
-                getVersionResolver().incrementVersion( project );
-
-                getScmRewriter().restoreScmInfo( project );
-            }
-
+                    getVersionResolver().incrementVersion( project );
+
+                    getScmRewriter().restoreScmInfo( project );
+                }
+
+                for ( Iterator it = reactorProjects.iterator(); it.hasNext(); )
+                {
+                    MavenProject project = (MavenProject) it.next();
+
+        }
+        Writer writer = null;
-            Writer writer = null;
+        try
+        {
+            writer = new FileWriter( project.getFile() );
-            try
-            {
-                writer = new FileWriter( project.getFile() );
-
-                project.writeOriginalModel( writer );
-            }
-            catch ( IOException e )
-            {
-                throw new MojoExecutionException( "Cannot write development version of pom to: " + project.getFile(),
-                                                  e );
-            }
-            finally
-            {
-                IOUtil.close( writer );
-            }
+            project.writeOriginalModel( writer );
+        }
+        catch ( IOException e )
+        {
+            throw new MojoExecutionException( "Cannot write development version of pom to: " + project.getFile(), e );
+        }
+        finally
+        {
+            IOUtil.close( writer );
+                if ( username == null )
+                {
+                    username = System.getProperty( "user.name" );
+                }
+        throws MojoExecutionException
-            scmRewriter = new ProjectScmRewriter();
+            scmRewriter = new ProjectScmRewriter( getReleaseProgress() );
-                ScmHelper scm = getScm();
-
-                scm.setWorkingDirectory( basedir );
+                ScmHelper scm = getScm( basedir );
-                    ScmHelper scm = getScm();
-
-                    scm.setWorkingDirectory( basedir );
+                    ScmHelper scm = getScm( basedir );
-            checkIn( "**/pom.xml,**/release-pom.xml", "[maven-release-plugin] prepare release " + getTagLabel() );
+            checkIn( "[maven-release-plugin] prepare release " + getTagLabel() );
-                    String releasePom = trimPathForScmCalculation( currentReleasePomFile );
+                    String releasePomPath = trimPathForScmCalculation( currentReleasePomFile );
-                    releasePom = releasePom.substring( canonicalBasedir.length() );
+                    releasePomPath = releasePomPath.substring( canonicalBasedir.length() + 1 );
-                    getScm().remove( "Removing for next development iteration.", releasePom );
+                    ScmHelper scm = getScm( basedir );
+
+                    scm.remove( "Removing for next development iteration.", releasePomPath );
-            checkIn( "**/pom.xml", "[maven-release-plugin] prepare for next development iteration" );
+            checkIn( "[maven-release-plugin] prepare for next development iteration" );
-    private void checkIn( String includePattern, String message )
+    private void checkIn( String message )
-            ScmHelper scm = getScm();
-
-            scm.setWorkingDirectory( basedir );
+            ScmHelper scm = getScm( basedir );
-            scm.checkin( message, includePattern, null );
+            scm.checkin( message );
-                ScmHelper scm = getScm();
-
-                scm.setWorkingDirectory( basedir );
+                ScmHelper scm = getScm( basedir );

INS43 MOV60 MOV54 INS42 UPD66 INS8 MOV24 INS25 MOV21 INS27 MOV8 INS32 INS42 INS42 INS33 INS21 INS42 INS60 INS7 INS42 INS43 INS59 INS42 INS42 MOV32 UPD42 UPD42 INS42 INS42 INS32 UPD42 MOV42 UPD42 INS42 UPD42 INS27 INS42 INS42 INS32 INS34 MOV42 MOV42 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL42 DEL42 DEL32 DEL21 DEL45 DEL32 DEL32 DEL45 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL33 DEL42 DEL42 DEL42 DEL32 DEL21