bug fixes, but still not completely fixed


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163693 13f79535-47bb-0310-9956-ffa450edef68

-        if ( isSnapshot( artifact ) && !alreadyResolved( artifact ) )
+        if ( isSnapshot( artifact ) )
+            //  - alternatively, keep the timestamp when downloading (as is done here), and use the SNAPSHOT file for install
+            //  - however, there is no mechanism to flip back and forward, and presently it keeps looking for 2.0-TIMESTAMP-0 instead as that is in the build file
+
+            //  - we definitely need the manual/daily check as this is quite slow given the large number of snapshots inside m2 presently
+
-            boolean foundRemote = false;
-            for ( Iterator i = remoteRepositories.iterator(); i.hasNext(); )
+            if ( !alreadyResolved( artifact ) )
-                ArtifactRepository remoteRepository = (ArtifactRepository) i.next();
-
-                SnapshotArtifactMetadata remoteMetadata = SnapshotArtifactMetadata.createRemoteSnapshotMetadata(
-                    artifact );
-                remoteMetadata.retrieveFromRemoteRepository( remoteRepository, wagonManager );
-
-                if ( remoteMetadata.compareTo( localMetadata ) > 0 )
+                boolean foundRemote = false;
+                for ( Iterator i = remoteRepositories.iterator(); i.hasNext(); )
-                    // TODO: investigate transforming this in place, in which case resolve can return void
-                    artifact = createArtifactCopy( artifact, remoteMetadata );
-                    artifact.setRepository( remoteRepository );
+                    ArtifactRepository remoteRepository = (ArtifactRepository) i.next();
-                    localMetadata = remoteMetadata;
-                    foundRemote = true;
+                    SnapshotArtifactMetadata remoteMetadata = SnapshotArtifactMetadata.createRemoteSnapshotMetadata(
+                        artifact );
+                    remoteMetadata.retrieveFromRemoteRepository( remoteRepository, wagonManager );
+
+                    if ( remoteMetadata.compareTo( localMetadata ) > 0 )
+                    {
+                        // TODO: investigate transforming this in place, in which case resolve can return void
+                        artifact.setRepository( remoteRepository );
+
+                        localMetadata = remoteMetadata;
+                        foundRemote = true;
+                    }
+                }
+
+                if ( foundRemote )
+                {
+                    artifact.addMetadata( localMetadata );
-            if ( foundRemote )
-            {
-                artifact.addMetadata( localMetadata );
-            }
-*/
+            artifact = createArtifactCopy( artifact, localMetadata );
+
+*/
+        ArtifactRepository oldRepository = artifact.getRepository();
+
+
+
+        artifact.setRepository( oldRepository );
+

INS60 INS21 MOV32 INS43 INS59 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL32 DEL38 DEL27 DEL42 DEL42 DEL42 DEL42 DEL32 DEL32 DEL21