[MNG-4106] [regression] Interpolation does not use properties from dominant settings profile if other profile defines same property

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@757584 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Iterator;
-        for ( Profile profile : projectProfiles )
+        try
-            try
+            // TODO: Review why this blows up the tests when we inject all the profiles in one go
+            for ( Iterator<Profile> it = projectProfiles.iterator(); it.hasNext(); )
-                model = inject( profile, model );
+                Profile profile = it.next();
+                PomClassicDomainModel dm =
+                    ProcessorContext.mergeProfilesIntoModel( Arrays.asList( profile ), model, false );
+                if ( !it.hasNext() )
+                {
+                    ProcessorContext.interpolateModelProperties( dm.getModelProperties(),
+                                                                 new ArrayList<InterpolatorProperty>(), dm );
+                    dm = new PomClassicDomainModel( dm.getModelProperties(), false );
+                }
+                model = dm.getModel();
-            catch ( IOException e )
-            {
+        }
+        catch ( IOException e )
+        {
-                throw new ProjectBuildingException(projectId, "", projectDescriptor, e);
-            }
+            throw new ProjectBuildingException(projectId, "", projectDescriptor, e);
-    private Model inject( Profile profile, Model model ) throws IOException
-    {
-        return ProcessorContext.mergeProfilesIntoModel( Arrays.asList(profile), model, false ).getModel();
-    }
-

INS26 INS40 INS54 INS8 MOV12 INS24 INS58 INS32 INS8 INS74 INS59 INS42 INS42 INS60 INS60 INS25 MOV21 INS43 MOV43 INS42 INS32 MOV43 INS59 INS43 INS59 INS38 INS8 INS42 INS42 INS42 INS42 INS32 INS42 INS42 MOV32 INS32 INS21 INS21 INS42 INS42 INS42 INS42 INS32 INS7 UPD42 UPD42 INS42 INS42 INS32 INS14 INS42 INS42 INS14 INS42 INS42 INS74 INS43 INS32 INS9 INS43 INS43 INS42 INS42 INS42 INS42 INS42 DEL42 DEL42 DEL44 DEL42 DEL8 DEL54 DEL8 DEL70 DEL83 DEL42 DEL43 DEL42 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL32 DEL41 DEL8 DEL31