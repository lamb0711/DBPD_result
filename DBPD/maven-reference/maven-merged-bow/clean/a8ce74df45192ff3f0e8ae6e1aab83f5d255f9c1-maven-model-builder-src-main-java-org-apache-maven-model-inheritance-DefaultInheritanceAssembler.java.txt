[MNG-5000] [regression] child distributionManagment.site.url not correct in a flat directory layout when child's artifactId doesn't match its module name

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1072613 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.File;
-            String childArtifactId = child.getArtifactId();
+            String childName = child.getArtifactId();
+
+            /*
+             * This logic exists only for the sake of backward-compat with 2.x (MNG-5000). In generally, it is wrong to
+             * base URL inheritance on the project directory names as this information is unavailable for POMs in the
+             * repository. In other words, projects where artifactId != projectDirName will see different effective URLs
+             * depending on how the POM was constructed.
+             */
+            File childDirectory = child.getProjectDirectory();
+            if ( childDirectory != null )
+            {
+                childName = childDirectory.getName();
+            }
-                if ( moduleName.equals( childArtifactId ) && lastSlash >= 0 )
+                if ( moduleName.equals( childName ) && lastSlash >= 0 )

INS26 INS40 INS60 INS25 INS43 INS59 INS27 INS8 UPD42 INS42 INS42 INS32 INS42 INS33 INS21 INS42 INS42 INS7 INS42 INS32 INS42 INS42 UPD42