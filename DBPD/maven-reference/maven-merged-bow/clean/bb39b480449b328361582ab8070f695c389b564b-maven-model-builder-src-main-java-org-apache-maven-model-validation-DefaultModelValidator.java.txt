[MNG-4695] Missing Error during pom validation: "You cannot have two plugin executions with the same (or missing) <id/> elements."

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@949720 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.BuildBase;
-                validateRawPlugins( problems, build.getPlugins(), false, request );
+                validateRawPlugins( problems, build.getPlugins(), "build.plugins.plugin", request );
-                    validateRawPlugins( problems, mngt.getPlugins(), true, request );
+                    validateRawPlugins( problems, mngt.getPlugins(), "build.pluginManagement.plugins.plugin", request );
+                String prefix = "profiles.profile[" + profile.getId() + "]";
+
-                validateRawDependencies( problems, profile.getDependencies(), "profiles.profile[" + profile.getId()
-                    + "].dependencies.dependency", request );
+                validateRawDependencies( problems, profile.getDependencies(), prefix + ".dependencies.dependency",
+                                         request );
-                    validateRawDependencies( problems, profile.getDependencyManagement().getDependencies(),
-                                          "profiles.profile[" + profile.getId()
-                                              + "].dependencyManagement.dependencies.dependency", request );
+                    validateRawDependencies( problems, profile.getDependencyManagement().getDependencies(), prefix
+                        + ".dependencyManagement.dependencies.dependency", request );
-                validateRepositories( problems, profile.getRepositories(), "profiles.profile[" + profile.getId()
-                    + "].repositories.repository", request );
+                validateRepositories( problems, profile.getRepositories(), prefix + ".repositories.repository", request );
-                validateRepositories( problems, profile.getPluginRepositories(), "profiles.profile[" + profile.getId()
-                    + "].pluginRepositories.pluginRepository", request );
+                validateRepositories( problems, profile.getPluginRepositories(), prefix
+                    + ".pluginRepositories.pluginRepository", request );
+
+                BuildBase buildBase = profile.getBuild();
+                if ( buildBase != null )
+                {
+                    validateRawPlugins( problems, buildBase.getPlugins(), prefix + ".plugins.plugin", request );
+
+                    PluginManagement mngt = buildBase.getPluginManagement();
+                    if ( mngt != null )
+                    {
+                        validateRawPlugins( problems, mngt.getPlugins(), prefix + ".pluginManagement.plugins.plugin",
+                                            request );
+                    }
+                }
-    private void validateRawPlugins( ModelProblemCollector problems, List<Plugin> plugins, boolean managed,
+    private void validateRawPlugins( ModelProblemCollector problems, List<Plugin> plugins, String prefix,
-        String prefix = ( managed ? "build.pluginManagement." : "build." ) + "plugins.plugin.";
-
-                addViolation( problems, errOn31, prefix + "(groupId:artifactId)", null,
+                addViolation( problems, errOn31, prefix + ".(groupId:artifactId)", null,
-                    addViolation( problems, Severity.ERROR, "build.plugins.plugin[" + plugin.getKey()
+                    addViolation( problems, Severity.ERROR, prefix + "[" + plugin.getKey()

INS26 INS40 MOV43 UPD42 INS60 INS60 INS25 INS43 INS59 INS43 INS59 INS27 INS8 INS45 INS42 INS42 MOV27 INS27 INS42 INS42 INS32 INS42 INS33 INS21 INS60 INS25 UPD45 INS42 INS45 INS42 UPD45 INS42 UPD45 INS42 INS42 INS32 INS43 INS59 INS27 INS8 UPD45 INS45 INS42 INS42 INS32 INS27 INS42 INS42 INS42 INS32 INS42 INS33 INS21 INS42 UPD45 INS42 INS42 INS42 INS45 INS42 INS42 INS32 INS42 UPD45 INS42 INS42 INS32 INS27 INS42 INS42 INS42 INS42 INS45 DEL9 DEL9 DEL45 DEL42 DEL42 DEL32 DEL45 DEL42 DEL42 DEL32 DEL45 DEL42 DEL42 DEL32 DEL39 DEL42 DEL42 DEL45 DEL45 DEL16 DEL36 DEL45 DEL27 DEL59 DEL60