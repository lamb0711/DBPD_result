[MNG-3119] Modifying MavenProject.addAttachment(..) and MavenProjectHelper.attachArtifact(..) implementations to throw an unchecked exception when a project attachment will collide with existing attachments. This includes tests to verify the behavior. The unchecked exception allows Maven to deal with it as a real build failure, while avoiding the need to modify the MavenProjectHelper API, which is part of Maven's core and which would render many existing plugins incompatible with new Maven releases.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@618497 13f79535-47bb-0310-9956-ffa450edef68

+import org.codehaus.plexus.logging.AbstractLogEnabled;
+    extends AbstractLogEnabled
-    
+
-        
+
-        
+
-        
+
-        
+
-        
+
-        
-        project.addAttachedArtifact( artifact );
+
+        attachArtifact(project, artifact);
-        
+
-        
+
-        
-        project.addAttachedArtifact( artifact );
+
+        attachArtifact(project, artifact);
-        
+
-        
+
-        
-        project.addAttachedArtifact( artifact );
+
+        attachArtifact(project, artifact);
+    }
+
+    public void attachArtifact(MavenProject project, Artifact artifact)
+    {
+        try
+        {
+        	project.addAttachedArtifact( artifact );
+        }
+        catch (DuplicateArtifactAttachmentException dae)
+        {
+        	getLogger().warn(dae.getMessage());
+
+        	// We can throw this because it's unchecked, and won't change the MavenProjectHelper API, which would break backward compat if it did.
+        	throw dae;
+        }

INS26 INS40 INS43 INS31 INS42 INS83 INS39 INS42 INS44 INS44 INS8 INS21 INS43 INS42 INS43 INS42 INS54 INS32 INS42 INS42 INS8 INS12 UPD42 UPD42 UPD42 UPD42 INS42 INS42 INS42 MOV21 INS44 INS8 INS43 INS42 INS21 INS53 INS42 INS32 INS42 INS32 INS42 INS32 INS42 INS42 INS42