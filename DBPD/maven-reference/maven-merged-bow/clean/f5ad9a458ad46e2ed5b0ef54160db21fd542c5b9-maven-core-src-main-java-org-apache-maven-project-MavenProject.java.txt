o Fixed lazy repo creation to cache result repo

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1021505 13f79535-47bb-0310-9956-ffa450edef68

-        if ( getDistributionManagement() != null && getDistributionManagement().getRepository() != null )
+        if ( releaseArtifactRepository == null )
-            try
+            if ( getDistributionManagement() != null && getDistributionManagement().getRepository() != null )
-                ArtifactRepository repo =
-                    repositorySystem.buildArtifactRepository( getDistributionManagement().getRepository() );
-                repositorySystem.injectProxy( projectBuilderConfiguration.getRepositorySession(), Arrays.asList( repo ) );
-                repositorySystem.injectAuthentication( projectBuilderConfiguration.getRepositorySession(),
-                                                       Arrays.asList( repo ) );
-                setReleaseArtifactRepository( repo );
-            }
-            catch ( InvalidRepositoryException e )
-            {
+                try
+                {
+                    ArtifactRepository repo =
+                        repositorySystem.buildArtifactRepository( getDistributionManagement().getRepository() );
+                    repositorySystem.injectProxy( projectBuilderConfiguration.getRepositorySession(),
+                                                  Arrays.asList( repo ) );
+                    repositorySystem.injectAuthentication( projectBuilderConfiguration.getRepositorySession(),
+                                                           Arrays.asList( repo ) );
+                    setReleaseArtifactRepository( repo );
+                }
+                catch ( InvalidRepositoryException e )
+                {
+                    if ( logger != null )
+                    {
+                        logger.debug( "Failed to create release distribution repository for " + getId(), e );
+                    }
+                }
-        
+
-        if ( getDistributionManagement() != null && getDistributionManagement().getSnapshotRepository() != null )
+        if ( snapshotArtifactRepository == null )
-            try
+            if ( getDistributionManagement() != null && getDistributionManagement().getSnapshotRepository() != null )
-                ArtifactRepository repo =
-                    repositorySystem.buildArtifactRepository( getDistributionManagement().getSnapshotRepository() );
-                repositorySystem.injectProxy( projectBuilderConfiguration.getRepositorySession(), Arrays.asList( repo ) );
-                repositorySystem.injectAuthentication( projectBuilderConfiguration.getRepositorySession(),
-                                                       Arrays.asList( repo ) );
-                setSnapshotArtifactRepository( repo );
-            }
-            catch ( InvalidRepositoryException e )
-            {
+                try
+                {
+                    ArtifactRepository repo =
+                        repositorySystem.buildArtifactRepository( getDistributionManagement().getSnapshotRepository() );
+                    repositorySystem.injectProxy( projectBuilderConfiguration.getRepositorySession(),
+                                                  Arrays.asList( repo ) );
+                    repositorySystem.injectAuthentication( projectBuilderConfiguration.getRepositorySession(),
+                                                           Arrays.asList( repo ) );
+                    setSnapshotArtifactRepository( repo );
+                }
+                catch ( InvalidRepositoryException e )
+                {
+                    if ( logger != null )
+                    {
+                        logger.debug( "Failed to create snapshot distribution repository for " + getId(), e );
+                    }
+                }
-        
+

INS8 INS8 INS25 MOV41 INS25 MOV41 INS27 MOV8 INS27 MOV8 INS42 INS33 INS42 INS33 INS8 INS8 INS25 INS25 INS27 INS8 INS27 INS8 INS42 INS33 INS21 INS42 INS33 INS21 INS32 INS32 INS42 INS42 INS27 INS42 INS42 INS42 INS27 INS42 INS45 INS32 INS45 INS32 INS42 INS42 DEL8 DEL8