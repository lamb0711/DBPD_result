convert archive mojos to new execute(). More work is required to reuse the common fields.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163659 13f79535-47bb-0310-9956-ffa450edef68

-/* ====================================================================
- *   Copyright 2001-2005 The Apache Software Foundation.
+/*
+ * Copyright 2001-2005 The Apache Software Foundation.
- *   Licensed under the Apache License, Version 2.0 (the "License");
- *   you may not use this file except in compliance with the License.
- *   You may obtain a copy of the License at
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
- *       http://www.apache.org/licenses/LICENSE-2.0
+ *      http://www.apache.org/licenses/LICENSE-2.0
- *   Unless required by applicable law or agreed to in writing, software
- *   distributed under the License is distributed on an "AS IS" BASIS,
- *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *   See the License for the specific language governing permissions and
- *   limitations under the License.
- * ====================================================================
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
-import org.apache.maven.model.Dependency;
-import org.apache.maven.plugin.PluginExecutionRequest;
+import org.codehaus.plexus.archiver.ArchiverException;
+import org.codehaus.plexus.archiver.jar.ManifestException;
+import java.io.IOException;
-import java.util.List;
+ * @todo improve the use of this now that plugin fields are used instead of a request object - add an <archive> element to configuration?
-    JarArchiver archiver = new JarArchiver();
+    private JarArchiver archiver = new JarArchiver();
-    File archiveFile;
+    private File archiveFile;
-    public Manifest getManifest( PluginExecutionRequest request )
-        throws Exception
+    public Manifest getManifest( MavenProject project, String mainClass, String packageName, boolean addClasspath,
+                                 boolean addExtensions )
+        throws ManifestException
-        MavenProject project = (MavenProject) request.getParameter( "project" );
-
-        String mainClass = (String) request.getParameter( "mainClass" );
-
-        String packageName = (String) request.getParameter( "package" );
-
-        boolean addClasspath = new Boolean( (String) request.getParameter( "addClasspath" ) ).booleanValue();
-
-        boolean addExtensions = new Boolean( (String) request.getParameter( "addExtensions" ) ).booleanValue();
-
-                    classpath.append( artifact.getArtifactId() + "-" + artifact.getVersion() + ".jar");
+                    classpath.append( artifact.getArtifactId() + "-" + artifact.getVersion() + ".jar" );
-                    Manifest.Attribute archImplVersionAttr = new Manifest.Attribute( artifact.getArtifactId() +
-                                                                                     "-Implementation-Version",
-                                                                                     artifact.getVersion() );
+                    String name = artifact.getArtifactId() + "-Implementation-Version";
+                    Manifest.Attribute archImplVersionAttr = new Manifest.Attribute( name, artifact.getVersion() );
-                    Manifest.Attribute archImplUrlAttr = new Manifest.Attribute( artifact.getArtifactId() +
-                                                                                 "-Implementation-URL", "http://www.ibiblio.org/maven/" +
-                                                                                                        artifact.toString() );
+                    // TODO: make repo configurable
+                    name = artifact.getArtifactId() + "-Implementation-URL";
+                    String url = "http://www.ibiblio.org/maven/" + artifact.toString();
+                    Manifest.Attribute archImplUrlAttr = new Manifest.Attribute( name, url );
-    public void createArchive( PluginExecutionRequest request )
-        throws Exception
+    public void createArchive( MavenProject project, String manifestFile, boolean compress, boolean index,
+                               Manifest manifest )
+        throws ArchiverException, ManifestException, IOException
-        MavenProject project = (MavenProject) request.getParameter( "project" );
-
-        String manifest = (String) request.getParameter( "manifest" );
-
-        boolean compress = new Boolean( (String) request.getParameter( "compress" ) ).booleanValue();
-
-        boolean index = new Boolean( (String) request.getParameter( "index" ) ).booleanValue();
-
-        // ----------------------------------------------------------------------
-        //
-        // ----------------------------------------------------------------------
-
-        if ( manifest != null && !"".equals( manifest ) )
+        if ( manifestFile != null && !"".equals( manifestFile ) )
-            File manifestFile = new File( manifest );
-            archiver.setManifest( manifestFile );
+            archiver.setManifest( new File( manifestFile ) );
-        archiver.addConfiguredManifest( getManifest( request ) );
+        archiver.addConfiguredManifest( manifest );

MOV26 MOV26 MOV26 UPD40 UPD40 UPD40 INS65 INS83 INS83 INS44 INS44 INS44 INS44 UPD43 INS44 INS44 INS44 INS44 INS43 INS43 INS43 INS8 INS66 MOV43 UPD42 MOV43 INS42 MOV43 INS42 INS39 INS42 INS39 INS42 UPD42 MOV43 UPD42 MOV43 INS42 INS39 INS42 INS39 INS42 INS43 INS42 UPD42 MOV42 INS42 INS42 MOV21 MOV25 MOV21 MOV21 MOV21 MOV21 MOV21 UPD42 MOV42 UPD42 MOV42 UPD42 UPD42 INS14 MOV43 INS42 INS60 INS21 INS60 MOV43 INS59 INS7 MOV43 MOV43 INS59 INS42 MOV27 INS42 MOV27 UPD42 MOV27 INS42 INS14 INS42 MOV43 INS42 INS42 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL42 DEL45 DEL32 DEL11 DEL59 DEL60 DEL42 DEL42 DEL42 DEL45 DEL32 DEL11 DEL59 DEL60 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL42 DEL45 DEL32 DEL11 DEL59 DEL60 DEL39 DEL42 DEL42 DEL43 DEL42 DEL43 DEL42 DEL42 DEL45 DEL32 DEL11 DEL14 DEL42 DEL32 DEL59 DEL60 DEL39 DEL42 DEL42 DEL43 DEL42 DEL43 DEL42 DEL42 DEL45 DEL32 DEL11 DEL14 DEL42 DEL32 DEL59 DEL60 DEL14 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL14 DEL59 DEL60 DEL42 DEL42 DEL32 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL42 DEL45 DEL32 DEL11 DEL59 DEL60 DEL42 DEL42 DEL42 DEL45 DEL32 DEL11 DEL59 DEL60 DEL39 DEL42 DEL42 DEL43 DEL42 DEL42 DEL45 DEL32 DEL11 DEL14 DEL42 DEL32 DEL59 DEL60 DEL39 DEL42 DEL43 DEL43 DEL42 DEL42 DEL45 DEL32 DEL11 DEL14 DEL42 DEL32 DEL59 DEL60 DEL8