MNG-2364 make sure the system properties are passed from the execution/embed requests, to make the on-property profile activation work in embedded environment

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@415000 13f79535-47bb-0310-9956-ffa450edef68

+        //TODO mkleint - use the (Container, Properties) constructor to make system properties embeddable
+        ProfileManager profileManager = new DefaultProfileManager( container );
+        return buildStandaloneSuperProject( localRepository, profileManager );
+    }
+    
+    public MavenProject buildStandaloneSuperProject( ArtifactRepository localRepository, ProfileManager profileManager ) 
+        throws ProjectBuildingException
+    {
-        ProfileManager profileManager = new DefaultProfileManager( container );
-        ProfileManager superProjectProfileManager = new DefaultProfileManager( container );
+        //TODO mkleint - use the (Container, Properties) constructor to make system properties embeddable
+        // shall the ProfileManager intefrace expose the properties?
+        
+        ProfileManager superProjectProfileManager;
+        if (externalProfileManager instanceof DefaultProfileManager) {
+            superProjectProfileManager = new DefaultProfileManager( container, ((DefaultProfileManager) externalProfileManager).getSystemProperties() );
+        } else {
+            superProjectProfileManager = new DefaultProfileManager( container );
+        }
-        ProfileManager profileManager = new DefaultProfileManager( container );
+        //TODO mkleint - use the (Container, Properties constructor to make system properties embeddable
+        ProfileManager profileManager;
+        if (externalProfileManager != null && externalProfileManager instanceof DefaultProfileManager ) {
+            profileManager = new DefaultProfileManager( container, ((DefaultProfileManager)externalProfileManager).getSystemProperties() );
+        } else {
+            profileManager = new DefaultProfileManager( container );
+        }

INS31 INS83 INS43 INS42 INS44 INS43 INS8 INS44 INS42 INS43 INS42 INS42 MOV60 INS41 INS43 INS42 INS25 INS60 INS25 INS42 INS32 INS42 INS62 INS8 INS8 INS43 INS59 INS27 INS8 INS8 INS42 INS42 INS42 INS42 INS43 INS21 INS21 INS42 INS42 INS27 INS62 INS21 INS21 INS42 INS7 INS7 INS42 INS33 INS42 INS43 INS7 INS7 INS42 INS14 INS42 MOV14 INS42 INS42 INS14 INS42 INS14 INS43 INS42 INS32 INS43 INS42 INS32 INS43 INS42 INS42 INS36 INS42 INS42 INS36 INS42 INS42 INS11 INS11 INS43 INS42 INS43 INS42 INS42 INS42 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL14 DEL59 DEL60