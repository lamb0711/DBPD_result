add-maven-repo was overwriting all the existing eclipse settins.
Fixed to preserve existing properties and only add/update the M2_REPO var

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@329579 13f79535-47bb-0310-9956-ffa450edef68

-
-import java.io.FileWriter;
+import java.io.FileInputStream;
+import java.io.FileNotFoundException;
+import java.io.FileOutputStream;
+import java.io.OutputStream;
+import java.util.Properties;
+
-public class AddMavenRepoMojo extends AbstractMojo
+public class AddMavenRepoMojo
+    extends AbstractMojo
-    
+
-    public void execute() throws MojoExecutionException
+    public void execute()
+        throws MojoExecutionException
-        
-        File workDir = new File( workspace, ".metadata/.plugins/org.eclipse.core.runtime/.settings" );
-        
+
+        File workDir = new File( workspace, ".metadata/.plugins/org.eclipse.core.runtime/.settings" ); //$NON-NLS-1$
-        
-        File f = new File( workDir.getAbsolutePath(), "org.eclipse.jdt.core.prefs" );
-        
+
+        Properties props = new Properties();
+
+        File f = new File( workDir.getAbsolutePath(), "org.eclipse.jdt.core.prefs" ); //$NON-NLS-1$
+
+        // preserve old settings
+        if ( f.exists() )
+        {
+            try
+            {
+                props.load( new FileInputStream( f ) );
+            }
+            catch ( FileNotFoundException e )
+            {
+                throw new MojoExecutionException( Messages
+                    .getString( "EclipsePlugin.cantreadfile", f.getAbsolutePath() ), e ); //$NON-NLS-1$
+            }
+            catch ( IOException e )
+            {
+                throw new MojoExecutionException( Messages
+                    .getString( "EclipsePlugin.cantreadfile", f.getAbsolutePath() ), e ); //$NON-NLS-1$
+            }
+        }
+
+        props.put( "\norg.eclipse.jdt.core.classpathVariable.M2_REPO", localRepository.getBasedir() ); //$NON-NLS-1$
+
-            FileWriter fWriter = new FileWriter( f );
-        
-            fWriter.write( "\norg.eclipse.jdt.core.classpathVariable.M2_REPO=" + localRepository.getBasedir() );
-
-            fWriter.flush();
-
-            fWriter.close();
+            OutputStream os = new FileOutputStream( f );
+            props.store( os, null );
+            os.close();
-        catch( IOException ioe )
+        catch ( IOException ioe )
-            throw new MojoExecutionException( "Unable to write to file: " + f.getAbsolutePath() );
+            throw new MojoExecutionException( Messages.getString( "EclipsePlugin.cantwritetofile", //$NON-NLS-1$
+                                                                  f.getAbsolutePath() ) );

INS26 INS26 INS26 INS26 UPD40 INS40 INS40 INS40 INS40 INS60 INS25 MOV21 INS43 INS59 INS32 INS8 INS12 INS42 INS42 INS14 INS42 INS42 INS54 UPD42 UPD42 INS45 MOV32 MOV44 INS8 INS43 INS8 MOV12 INS12 UPD43 INS53 INS42 INS21 INS44 INS44 INS8 UPD42 UPD42 UPD42 UPD42 INS42 INS33 UPD42 INS14 INS32 INS43 INS42 INS43 INS42 INS53 UPD43 INS43 INS32 INS42 INS42 INS14 INS42 INS42 INS14 UPD42 INS42 INS42 INS42 INS45 INS32 INS43 INS42 INS32 INS42 INS43 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS45 MOV32 INS42 INS42 INS42 INS45 INS32 INS42 INS42 DEL45 DEL27 DEL45 DEL27