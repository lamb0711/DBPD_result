Corrected goal and plugin configuration injection (from managed info).

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@165096 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.Goal;
-        
+
+        Map defaultGoals = new TreeMap();
+
+        List defGoalList = def.getGoals();
+
+        if ( defGoalList != null )
+        {
+            for ( Iterator it = defGoalList.iterator(); it.hasNext(); )
+            {
+                Goal defaultGoal = (Goal) it.next();
+
+                defaultGoals.put( defaultGoal.getId(), defaultGoal );
+            }
+        }
+
-        if( pluginGoals == null || pluginGoals.isEmpty() )
+
+        if ( pluginGoals != null )
-            plugin.setGoals( def.getGoals() );
+            for ( Iterator it = pluginGoals.iterator(); it.hasNext(); )
+            {
+                Goal pluginGoal = (Goal) it.next();
+
+                Goal defaultGoal = (Goal) defaultGoals.get( pluginGoal.getId() );
+
+                if ( defaultGoal != null )
+                {
+                    Xpp3Dom pluginGoalConfig = (Xpp3Dom) pluginGoal.getConfiguration();
+                    Xpp3Dom defaultGoalConfig = (Xpp3Dom) defaultGoal.getConfiguration();
+
+                    pluginGoalConfig = Xpp3Dom.mergeXpp3Dom( pluginGoalConfig, defaultGoalConfig );
+
+                    pluginGoal.setConfiguration( pluginGoalConfig );
+                }
+            }
-        
+
-        if( pluginConfiguration == null )
-        {
-            plugin.setConfiguration( def.getConfiguration() );
-        }
+        Xpp3Dom defaultConfiguration = (Xpp3Dom) def.getConfiguration();
+
+        pluginConfiguration = Xpp3Dom.mergeXpp3Dom( pluginConfiguration, defaultConfiguration );
+
+        plugin.setConfiguration( pluginConfiguration );

INS26 INS40 MOV60 MOV60 INS60 INS60 INS60 INS21 INS21 INS43 INS59 INS43 INS59 INS27 INS8 UPD27 INS8 INS43 INS59 INS7 INS32 INS42 INS42 INS14 INS42 INS42 MOV32 UPD42 MOV42 MOV33 INS24 UPD42 INS24 INS42 INS42 INS11 INS42 INS32 INS42 INS42 INS42 INS43 INS58 INS32 INS8 INS58 INS32 INS8 INS43 MOV32 INS42 INS42 INS42 INS42 INS42 INS43 INS59 INS42 INS42 INS60 MOV21 INS43 INS59 INS42 INS42 INS60 INS60 INS25 INS42 INS42 INS42 INS32 INS43 INS59 INS42 INS42 INS32 INS43 INS59 INS43 INS59 INS27 MOV8 UPD42 MOV42 UPD42 MOV42 INS42 INS42 INS11 INS42 UPD42 INS32 INS42 INS42 INS42 INS42 INS42 INS11 INS42 INS42 INS11 INS42 INS33 INS60 INS60 INS21 INS43 INS32 UPD42 MOV42 INS42 INS43 INS32 INS43 INS32 INS43 INS59 INS43 INS59 INS7 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS11 INS42 INS42 INS11 INS42 INS32 UPD42 INS42 INS42 INS42 INS43 INS32 INS43 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 DEL27 DEL32 DEL27 DEL8