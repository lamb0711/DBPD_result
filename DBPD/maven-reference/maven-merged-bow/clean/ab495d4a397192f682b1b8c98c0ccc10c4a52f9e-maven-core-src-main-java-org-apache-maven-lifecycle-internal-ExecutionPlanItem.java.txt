[MNG-4633] Changed to use nice clean countdownlatch instead of synchronized booleans

Also updated phase locking to only lock when project being built changes phase

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@939220 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.concurrent.atomic.AtomicBoolean;
+import java.util.concurrent.CountDownLatch;
-    private final AtomicBoolean complete = new AtomicBoolean( false );
-
-    private final Object monitor = new Object();
+    private final CountDownLatch done = new CountDownLatch( 1 );
-        boolean transitionSuccessful = ensureComplete();
-        if ( !transitionSuccessful )
-        {
-            throw new IllegalStateException( "Expected to be able to setComplete node, but was complete already" );
-        }
+        done.countDown();
-    public boolean ensureComplete()
+    public boolean isDone()
-        boolean f = complete.compareAndSet( false, true );
-        notifyListeners();
-        return f;
-    }
-
-    private void notifyListeners()
-    {
-        synchronized ( monitor )
-        {
-            monitor.notifyAll();
-        }
+        return done.getCount() < 1;
-        final boolean b = complete.getAndSet( true );
-        if ( !b )
-        {
-            notifyListeners();
-        } // Release anyone waiting for us
+        setComplete();
-        synchronized ( monitor )
-        {
-            while ( !complete.get() )
-            {
-                monitor.wait( 100 );
-            }
-        }
+        done.await();

UPD40 UPD43 UPD42 INS8 INS8 UPD42 UPD42 INS21 INS41 MOV21 MOV21 UPD43 INS34 INS32 INS27 UPD42 UPD42 MOV42 INS42 INS32 INS34 UPD42 UPD42 UPD42 UPD42 MOV42 UPD42 MOV42 DEL9 DEL83 DEL83 DEL42 DEL43 DEL42 DEL42 DEL43 DEL14 DEL59 DEL23 DEL39 DEL42 DEL32 DEL59 DEL60 DEL42 DEL38 DEL42 DEL43 DEL45 DEL14 DEL53 DEL8 DEL25 DEL39 DEL42 DEL9 DEL9 DEL32 DEL59 DEL60 DEL42 DEL32 DEL21 DEL42 DEL41 DEL83 DEL39 DEL42 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL51 DEL8 DEL31 DEL83 DEL39 DEL42 DEL42 DEL42 DEL9 DEL32 DEL59 DEL60 DEL42 DEL38 DEL8 DEL25 DEL8 DEL34 DEL42 DEL42 DEL42 DEL32 DEL38 DEL8 DEL61 DEL8 DEL51 DEL8