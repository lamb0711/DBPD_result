Use plugin realm to lookup plugin components - fixes custom lifecycle mappings

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@497491 13f79535-47bb-0310-9956-ffa450edef68

-    public Object getPluginComponent( Plugin plugin,
-                                      String role,
-                                      String roleHint )
+    public Object getPluginComponent( Plugin plugin, String role, String roleHint )
-        // XXX this needs the plugin realm!
-        return container.lookup( role, roleHint );
+        ClassRealm pluginRealm = pluginCollector.getPluginDescriptor( plugin ).getClassRealm();
+
+        if ( pluginRealm == null )
+        {
+            getLogger().warn( "getPluginComponent(" + plugin + ", " + role + "): descriptor is missing classRealm" );
+            pluginRealm = DefaultPlexusContainer.getLookupRealm();
+        }
+
+        return container.lookup( role, roleHint, pluginRealm );
-    public Map getPluginComponents( Plugin plugin,
-                                    String role )
+    public Map getPluginComponents( Plugin plugin, String role )
-        // XXX this needs the plugin realm!
-        return container.lookupMap( role );
+        ClassRealm pluginRealm = pluginCollector.getPluginDescriptor( plugin ).getClassRealm();
+
+        if ( pluginRealm == null )
+        {
+            getLogger().warn( "getPluginComponent(" + plugin + ", " + role + "): descriptor is missing classRealm" );
+            pluginRealm = DefaultPlexusContainer.getLookupRealm();
+        }
+
+        return container.lookupMap( role, pluginRealm );

INS60 INS25 INS60 INS25 INS43 INS59 INS27 INS8 INS43 INS59 INS27 INS8 INS42 INS42 INS32 INS42 INS33 INS21 INS21 INS42 INS42 INS42 INS32 INS42 INS33 INS21 INS21 INS42 INS32 INS42 INS32 INS7 INS32 INS42 INS32 INS7 INS42 INS42 INS42 INS32 INS42 INS27 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS27 INS42 INS32 INS42 INS45 INS42 INS45 INS42 INS45 INS42 INS42 INS42 INS45 INS42 INS45 INS42 INS45 INS42 INS42