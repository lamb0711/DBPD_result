MNG-3653/MNG-3677: restored property file nabbing from the core JAR, and reworked the runtime component to be more general and used it from the CLI



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@701264 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.versioning.ArtifactVersion;
+import java.io.IOException;
+import java.io.InputStream;
+import java.util.Properties;
+
-import java.io.IOException;
-import java.io.InputStream;
-import java.util.Properties;
-
+ * @author Jason van Zyl
-{
-    private static final String MAVEN_GROUPID = "org.apache.maven";
+{    
+    private ApplicationInformation applicationInformation;
-    private static final String MAVEN_PROPERTIES = "META-INF/maven/" + MAVEN_GROUPID + "/maven-core/pom.properties";
-
-    private ArtifactVersion applicationVersion;
-
-    public ArtifactVersion getApplicationVersion()
+    public ApplicationInformation getApplicationInformation()
-        return applicationVersion;
+        return applicationInformation;
-    {        
-        applicationVersion = new DefaultArtifactVersion( "2.1-SNAPSHOT" );    
+    {
+        applicationInformation = getVersion( getClass().getClassLoader(), "org.apache.maven", "maven-core" );
+    }
+    
+    public static ApplicationInformation getVersion( ClassLoader loader, String groupId, String artifactId )
+    {
+        String MAVEN_PROPERTIES = "META-INF/maven/" + groupId + "/" + artifactId + "/pom.properties";
-        /*
+        String version = "unknown";
+        String builtOn = "unknown";
+
-            resourceAsStream = getClass().getClassLoader().getResourceAsStream( MAVEN_PROPERTIES );
+            resourceAsStream = loader.getResourceAsStream( MAVEN_PROPERTIES );
+            
-            if ( property == null )
+            
+            if ( property != null )
-                throw new InitializationException( "maven-core properties did not include the version" );
+                version = property;
-
-            applicationVersion = new DefaultArtifactVersion( property );
+            
+            property = properties.getProperty( "builtOn" );
+            
+            if ( property != null )
+            {
+                builtOn = property;
+            }
+            
+            return new ApplicationInformation( new DefaultArtifactVersion( version ), builtOn );
+            
-            throw new InitializationException( "Unable to read properties file from maven-core", e );
+            return new ApplicationInformation( new DefaultArtifactVersion( version ), builtOn );
-        }
-        */
+        }        

MOV26 MOV26 MOV26 INS23 INS31 INS31 INS31 INS65 MOV83 INS43 INS59 INS83 INS43 INS42 INS8 INS83 INS39 INS42 MOV43 INS8 INS83 INS83 INS43 INS42 INS44 INS44 INS44 INS8 INS66 INS42 INS42 INS42 INS41 INS21 INS42 INS43 INS42 MOV43 INS42 MOV43 INS42 INS60 INS60 INS60 INS60 INS54 INS42 INS7 INS42 INS43 INS59 INS43 INS59 INS43 INS59 INS43 INS59 INS8 INS12 INS8 INS42 INS32 INS42 MOV42 MOV27 UPD42 MOV42 UPD42 MOV42 INS45 INS42 INS42 INS45 INS42 INS42 INS33 INS60 INS21 INS25 INS21 INS60 INS25 INS21 INS25 INS41 INS44 INS8 INS21 INS42 INS32 INS45 INS45 UPD42 INS45 INS42 UPD45 INS43 INS59 INS7 INS27 INS8 INS32 INS43 INS59 INS27 INS8 INS7 INS27 INS8 INS14 INS43 INS42 INS41 INS32 INS32 INS42 INS42 INS42 INS14 INS42 INS32 INS42 INS33 INS53 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS33 INS21 INS42 INS32 INS42 INS33 MOV21 INS43 MOV14 INS42 INS42 INS14 INS42 INS42 INS42 INS42 INS43 INS42 INS42 INS42 INS14 INS42 INS42 INS45 INS7 INS42 INS42 INS45 INS42 INS42 INS43 INS14 INS42 INS42 INS43 INS27 INS42 INS42 UPD42 INS42 INS42 INS43 INS42 UPD42 MOV42 INS45 INS42 INS42 DEL40 DEL26 DEL45 DEL83 DEL83 DEL42 DEL45 DEL59 DEL23 DEL83 DEL83 DEL83 DEL59 DEL23 DEL83 DEL43 DEL59 DEL23 DEL83 DEL43 DEL42 DEL42 DEL41 DEL8 DEL31 DEL83 DEL39 DEL42 DEL8 DEL31