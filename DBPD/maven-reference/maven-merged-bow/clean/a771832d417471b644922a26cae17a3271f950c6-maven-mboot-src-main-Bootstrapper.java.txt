o Committing changes submitted by Trygve Laugst��l to accomodate the new form
of specifying a parent model to use which is of the form:

<parent>
  <groupId/>
  <artifactId/>
  <version/>
</parent>

This allows us to work consistently from the local repository or the unified
source root where missing models are downloaded now that we have the required
information within the <parent/> element.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@162656 13f79535-47bb-0310-9956-ffa450edef68

-import org.xml.sax.Attributes;
-import org.xml.sax.InputSource;
-import org.xml.sax.SAXParseException;
-import org.xml.sax.helpers.DefaultHandler;
-
-import javax.xml.parsers.SAXParser;
-import javax.xml.parsers.SAXParserFactory;
+import javax.xml.parsers.SAXParser;
+import javax.xml.parsers.SAXParserFactory;
+
+import org.xml.sax.Attributes;
+import org.xml.sax.InputSource;
+import org.xml.sax.SAXParseException;
+import org.xml.sax.SAXException;
+import org.xml.sax.helpers.DefaultHandler;
+
+    private int pomVersion;
+
-        bootstrapPomParser.parse( new File( "project.xml" ) );
+        if( ! bootstrapPomParser.parse( new File( "project.xml" ) ) )
+        {
+            System.err.println( "Could not parse project.xml" );
+            System.exit( 1 );
+        }
+        private String parentGroupId;
+
+        private String parentArtifactId;
+
+        private String parentVersion;
+
+        private boolean insideParent = false;
+
-        public void parse( File file )
+        public boolean parse( File file )
+
+                return true;
+
+                return false;
-            if ( rawName.equals( "unitTest" ) )
+            if ( rawName.equals( "parent" ) )
+            {
+                insideParent = true;
+            }
+            else if ( rawName.equals( "unitTest" ) )
+            throws SAXException
-            if ( rawName.equals( "extend" ) )
+            if ( rawName.equals( "parent" ) )
-                String extend = interpolate( getBodyText(), properties );
+                File f;
-                File f = new File( file.getParentFile(), extend );
+                // support both v3 <extend> and v4 <parent>
+                if( getBodyText() == null )
+                {
+                    String extend = interpolate( getBodyText(), properties );
+
+                    f = new File( file.getParentFile(), extend );
+                }
+                else
+                {
+                    if ( parentArtifactId == null || parentArtifactId.trim().length() == 0 )
+                        throw new SAXException( "Missing required element in <parent>: artifactId." );
+
+                    if ( parentGroupId == null || parentGroupId.trim().length() == 0 )
+                        throw new SAXException( "Missing required element in <parent>: groupId." );
+
+                    if ( parentVersion == null || parentVersion.trim().length() == 0 )
+                        throw new SAXException( "Missing required element in <parent>: version." );
+
+                    f = new File( downloader.getMavenRepoLocal(), parentGroupId + "/poms/" + parentArtifactId + "-" + parentVersion + ".pom" );
+                }
-                p.parse( f );
+                if ( ! p.parse( f ) )
+                    throw new SAXException( "Could not parse parent project.xml" );
+
+                insideParent = false;
+            else if ( insideParent )
+            {
+                if ( rawName.equals( "groupId" ) )
+                {
+                    parentGroupId = getBodyText();
+                }
+                else if ( rawName.equals( "artifactId" ) )
+                {
+                    parentArtifactId = getBodyText();
+                }
+                else if ( rawName.equals( "version" ) )
+                {
+                    parentVersion = getBodyText();
+                }
+            }

MOV26 MOV26 MOV26 MOV26 MOV26 MOV26 INS26 INS40 INS23 INS83 INS39 INS59 INS23 INS23 INS23 INS23 INS42 INS25 INS83 INS43 INS59 INS83 INS43 INS59 INS83 INS43 INS59 INS83 INS39 INS59 UPD39 INS43 INS38 INS8 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS9 INS25 INS42 MOV32 MOV21 INS21 INS32 INS8 MOV25 INS32 INS32 INS41 INS42 INS42 INS45 INS21 UPD45 INS25 INS25 INS21 INS40 INS42 INS45 INS42 INS42 INS34 INS9 INS41 INS7 INS27 INS8 INS8 INS38 INS53 INS7 INS9 INS42 INS9 INS32 INS33 MOV60 MOV21 INS25 INS25 INS25 INS21 MOV32 INS14 INS42 INS9 INS25 INS42 INS7 INS27 INS53 INS27 INS53 INS27 INS53 INS7 INS43 INS45 INS42 INS8 MOV25 INS42 MOV14 INS27 INS27 INS14 INS27 INS27 INS14 INS27 INS27 INS14 INS42 INS14 INS42 INS25 INS42 INS33 INS32 INS34 INS43 INS45 INS42 INS33 INS32 INS34 INS43 INS45 INS42 INS33 INS32 INS34 INS43 INS45 INS43 INS32 INS27 INS32 INS8 INS25 INS32 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS45 INS42 INS45 INS42 INS45 INS42 INS42 INS45 INS21 INS32 INS8 INS25 INS42 INS42 INS42 INS42 INS42 INS42 INS7 INS42 INS42 INS45 INS21 INS32 INS8 INS42 INS32 INS7 INS42 INS42 INS45 INS21 INS42 INS42 INS32 INS7 INS42 INS42 INS32 INS42