Some cleanup and added tests for distributionManagement
so scp:// repo's etc. aren't added.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@420413 13f79535-47bb-0310-9956-ffa450edef68

-    private boolean insideParent = false;
+    private boolean insideParent;
-    private boolean insideDependency = false;
+    private boolean insideDependency;
-    private boolean insideResource = false;
+    private boolean insideResource;
-    private boolean insideRepository = false;
+    private boolean insideRepository;
-    private boolean insideDependencyManagement = false;
+    private boolean insideDependencyManagement;
+
+    private boolean insideDistributionManagement;
-//            List newChain = Collections.singletonList( new Dependency( model.getGroupId(), model.getArtifactId(), model
-//                .getVersion(), model.getPackaging(), this.chain ) );
+        else if ( rawName.equals( "distributionManagement" ) )
+        {
+            insideDistributionManagement = true;
+        }
-            // actually, these should be transtive (see MNG-77) - but some projects have circular deps that way
-                                                   model.getParentVersion(), inheritedScope, false, excluded, model.getChain() );//Collections.singletonList( model ) );
+                                                   model.getParentVersion(), inheritedScope, false, excluded, model.getChain() );
-            ProjectResolver.addDependencies( p.getAllDependencies(), model.parentDependencies, inheritedScope, excluded );
+            ProjectResolver.addDependencies( p.getAllDependencies(), model.getParentDependencies(), inheritedScope, excluded );
-            ProjectResolver.addDependencies( p.getManagedDependencies(), model.managedDependencies, inheritedScope, Collections.EMPTY_SET );
+            ProjectResolver.addDependencies( p.getManagedDependenciesCollection(), model.getManagedDependencies(), inheritedScope, Collections.EMPTY_SET );
-                model.managedDependencies.put( currentDependency.getConflictId(), currentDependency );
+                model.getManagedDependencies().put( currentDependency.getConflictId(), currentDependency );
+        else if ( rawName.equals( "distributionManagement" ) )
+        {
+            insideDistributionManagement = false;
+        }
-            model.getRepositories().add( currentRepository );
+            if ( !insideDistributionManagement )
+            {
+                model.getRepositories().add( currentRepository );
+            }

INS23 INS83 INS39 INS59 INS42 INS32 INS32 INS25 INS42 INS42 UPD42 INS42 INS42 INS32 INS8 MOV25 INS25 INS42 INS42 INS45 INS21 INS32 INS8 MOV25 INS32 INS7 INS42 INS42 INS45 INS21 INS42 INS42 INS42 INS9 INS25 INS7 INS38 INS8 INS42 INS9 INS42 MOV21 DEL9 DEL9 DEL9 DEL9 DEL9 DEL40 DEL40 DEL40