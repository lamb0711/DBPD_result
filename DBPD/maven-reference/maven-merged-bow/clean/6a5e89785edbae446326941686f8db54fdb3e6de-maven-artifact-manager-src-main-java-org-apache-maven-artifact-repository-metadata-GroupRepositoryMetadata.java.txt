PR: MNG-639
Separate local metadata by repository to ensure it remains consistent

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@267466 13f79535-47bb-0310-9956-ffa450edef68

-    /**
-     * TODO: reuse.
-     */
-    protected static final String METADATA_FILE = "maven-metadata.xml";
-
-    public void storeInLocalRepository( ArtifactRepository localRepository )
+    public void storeInLocalRepository( ArtifactRepository localRepository, ArtifactRepository remoteRepository )
-                updateRepositoryMetadata( localRepository );
+                updateRepositoryMetadata( localRepository, remoteRepository );
-    public String getFilename()
+    public String getRemoteFilename()
-        return METADATA_FILE;
+        return "maven-metadata.xml";
+    }
+
+    public String getLocalFilename( ArtifactRepository repository )
+    {
+        return "maven-metadata-" + repository.getKey() + ".xml";
-    private void updateRepositoryMetadata( ArtifactRepository localRepository )
+    private void updateRepositoryMetadata( ArtifactRepository localRepository, ArtifactRepository remoteRepository )
-        File metadataFile = new File( localRepository.getBasedir(), localRepository.pathOfArtifactMetadata( this ) );
+        File metadataFile = new File( localRepository.getBasedir(),
+                                      localRepository.pathOfLocalRepositoryMetadata( this, remoteRepository ) );

INS31 INS44 INS83 MOV43 INS42 INS8 UPD42 INS44 INS44 INS43 INS42 INS41 INS43 INS42 INS43 INS42 INS42 INS45 INS42 INS27 INS42 INS45 INS32 INS45 INS42 INS42 UPD42 INS42 INS42 DEL66 DEL65 DEL29 DEL83 DEL83 DEL83 DEL42 DEL45 DEL59 DEL23 DEL42