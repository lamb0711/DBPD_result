Generalized error diagnosis for use outside of maven-core. This allows us to print diagnostic messages in the Ant tasks, for instance (these modifications are also included), and share diagnosers between multiple uses (maven-core, maven-artifact-ant, for example). This should help with MNG-784, but I'll verify that before I close it.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@314804 13f79535-47bb-0310-9956-ffa450edef68

-        ArtifactRepository localRepo = createLocalArtifactRepository();
-
-        MavenProjectBuilder builder = (MavenProjectBuilder) lookup( MavenProjectBuilder.ROLE );
-        Pom pom = buildPom( builder, localRepo );
-
-        Artifact artifact = createArtifact( pom );
-
-        boolean isPomArtifact = "pom".equals( pom.getPackaging() );
-        if ( !isPomArtifact )
-        {
-            ArtifactMetadata metadata = new ProjectArtifactMetadata( artifact, pom.getFile() );
-            artifact.addMetadata( metadata );
-        }
-
-        ArtifactInstaller installer = (ArtifactInstaller) lookup( ArtifactInstaller.ROLE );
+            ArtifactRepository localRepo = createLocalArtifactRepository();
+
+            MavenProjectBuilder builder = (MavenProjectBuilder) lookup( MavenProjectBuilder.ROLE );
+            Pom pom = buildPom( builder, localRepo );
+
+            Artifact artifact = createArtifact( pom );
+
+            boolean isPomArtifact = "pom".equals( pom.getPackaging() );
-                installer.install( file, artifact, localRepo );
+                ArtifactMetadata metadata = new ProjectArtifactMetadata( artifact, pom.getFile() );
+                artifact.addMetadata( metadata );
-            else
+
+            ArtifactInstaller installer = (ArtifactInstaller) lookup( ArtifactInstaller.ROLE );
+            try
-                installer.install( pom.getFile(), artifact, localRepo );
+                if ( !isPomArtifact )
+                {
+                    installer.install( file, artifact, localRepo );
+                }
+                else
+                {
+                    installer.install( pom.getFile(), artifact, localRepo );
+                }
+            }
+            catch ( ArtifactInstallationException e )
+            {
+                // TODO: install exception that does not give a trace
+                throw new BuildException( "Error installing artifact", e );
-        catch ( ArtifactInstallationException e )
+        catch ( BuildException e )
-            // TODO: install exception that does not give a trace
-            throw new BuildException( "Error installing artifact", e );
+            diagnoseError( e );
+            
+            throw e;

INS8 INS54 MOV8 INS12 INS44 INS8 INS43 INS42 INS21 INS53 INS42 INS32 INS42 INS42 INS42