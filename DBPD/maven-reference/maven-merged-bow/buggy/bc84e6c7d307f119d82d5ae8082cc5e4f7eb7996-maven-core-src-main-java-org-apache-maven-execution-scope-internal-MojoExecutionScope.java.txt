MNG-5549 introduced MojoExecutionListener and ProjectExecutionListener

Signed-off-by: Igor Fedorenko <ifedorenko@apache.org>

-import org.apache.maven.execution.scope.MojoExecutionListener;
+import org.apache.maven.execution.MojoExecutionListener;
+import org.apache.maven.execution.scope.WeakMojoExecutionListener;
+import org.apache.maven.plugin.Mojo;
-    implements Scope
+    implements Scope, MojoExecutionListener
-                if ( provided == null )
+                if ( provided == null && unscoped != null )
-    public void afterExecutionSuccess()
+    public void beforeMojoExecution( MavenSession session, MavenProject project, MojoExecution execution, Mojo mojo )
-            if ( provided instanceof MojoExecutionListener )
+            if ( provided instanceof WeakMojoExecutionListener )
-                ( (MojoExecutionListener) provided ).afterMojoExecutionSuccess();
-                // TODO maybe deal with multiple MojoExecutionExceptions
+                ( (WeakMojoExecutionListener) provided ).beforeMojoExecution( session, project, execution, mojo );
-    public void afterExecutionAlways()
+    public void afterMojoExecutionSuccess( MavenSession session, MavenProject project, MojoExecution execution,
+                                           Mojo mojo )
-            if ( provided instanceof MojoExecutionListener )
+            if ( provided instanceof WeakMojoExecutionListener )
-                ( (MojoExecutionListener) provided ).afterMojoExecutionAlways();
-                // TODO maybe deal with multiple MojoExecutionExceptions
+                ( (WeakMojoExecutionListener) provided ).afterMojoExecutionSuccess( session, project, execution, mojo );
+            }
+        }
+    }
+
+    public void afterExecutionFailure( MavenSession session, MavenProject project, MojoExecution execution, Mojo mojo,
+                                       Throwable cause )
+    {
+        for ( Object provided : getScopeState().provided.values() )
+        {
+            if ( provided instanceof WeakMojoExecutionListener )
+            {
+                ( (WeakMojoExecutionListener) provided ).afterExecutionFailure( session, project, execution, mojo,
+                                                                                cause );

MOV26 INS26 INS26 INS40 UPD40 INS40 MOV43 INS31 INS83 INS39 INS42 INS44 INS44 INS44 INS44 MOV43 INS8 UPD42 INS44 INS44 INS44 INS44 UPD42 INS44 INS44 INS44 INS44 INS44 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS70 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS43 INS42 INS42 INS42 INS42 INS42 MOV44 MOV32 INS8 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS44 INS32 INS25 INS43 INS42 INS22 INS42 INS62 INS8 INS42 INS32 INS42 INS42 INS43 INS21 INS43 INS42 UPD43 INS42 INS32 INS42 UPD42 INS27 INS36 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 UPD42 INS42 INS42 INS42 INS42 INS42 MOV27 INS27 INS11 INS42 INS33 INS43 INS42 UPD43 UPD43 INS42 UPD42 UPD42