PR: MNG-1320

o Modified private resolveAlways(..) method to throw TransferFailedException, after blacklisting the repository.

o Added handling for the new TransferFailedException as it's thrown from resolveAlways(..). In two cases, where it's not essential that the metadata be non-empty, this exception is ignored. I'm anticipating this will change for 2.1, but for now it's just marked TODO. In the final case (the one that prompted this MNG), the exception is used to inhibit writing of the empty metadata to the local repository when the transfer fails. NOTE: The metadata is still handled the same as before when the system encounters ResourceDoesNotExistException, to prevent re-checking the remote repo on every build.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@331836 13f79535-47bb-0310-9956-ffa450edef68

+                    boolean metadataIsEmpty = true;
+                    
-                        resolveAlways( metadata, repository, file, policy.getChecksumPolicy(), true );
+                        try
+                        {
+                            resolveAlways( metadata, repository, file, policy.getChecksumPolicy(), true );
+                            metadataIsEmpty = false;
+                        }
+                        catch ( TransferFailedException e )
+                        {
+                            // TODO: [jc; 08-Nov-2005] revisit this for 2.1
+                            // suppressing logging to avoid logging this error twice.
+                            metadataIsEmpty = true;
+                        }
-                    else
+                    else if ( !metadataIsEmpty )
-        resolveAlways( metadata, remoteRepository, file, ArtifactRepositoryPolicy.CHECKSUM_POLICY_WARN, false );
+        try
+        {
+            resolveAlways( metadata, remoteRepository, file, ArtifactRepositoryPolicy.CHECKSUM_POLICY_WARN, false );
+        }
+        catch ( TransferFailedException e )
+        {
+            // TODO: [jc; 08-Nov-2005] revisit this for 2.1
+            // suppressing logging to avoid logging this error twice.
+            // We don't want to interrupt program flow here. Just allow empty metadata instead.
+            // rethrowing this would change behavior.
+        }
-        throws RepositoryMetadataResolutionException
+        throws RepositoryMetadataResolutionException, TransferFailedException
+            
+            throw e;
+        catch ( TransferFailedException e )
+        {
+            // TODO: [jc; 08-Nov-2005] revisit this for 2.1
+            // suppressing logging to avoid logging this error twice.
+            // We don't want to interrupt program flow here. Just allow empty metadata instead.
+            // rethrowing this would change behavior.
+        }

INS43 INS54 INS42 INS8 INS12 INS12 MOV21 INS44 INS8 INS44 INS8 INS43 INS42 INS53 INS43 INS42 INS42 INS42 INS42 INS60 INS39 INS59 INS25 INS42 INS9 INS54 INS38 MOV8 INS8 INS12 INS42 MOV21 INS21 INS44 INS8 INS7 INS43 INS42 INS21 INS42 INS9 INS42 INS7 INS42 INS9