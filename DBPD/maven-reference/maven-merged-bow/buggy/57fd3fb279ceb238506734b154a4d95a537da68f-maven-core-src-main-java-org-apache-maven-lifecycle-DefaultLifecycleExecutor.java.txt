[MNG-3779] Improve error message when trying to execute moojo with no pom.xml

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@928903 13f79535-47bb-0310-9956-ffa450edef68

+            if ( !session.isUsingPOMsFromFilesystem() && requiresProject( session ) )
+            {
+                throw new MissingProjectException( "The goal you specified requires a project to execute"
+                    + " but there is no POM in this directory (" + session.getExecutionRootDirectory() + ")."
+                    + " Please verify you invoked Maven from the correct directory." );
+            }
+
+            if ( projectBuilds.isEmpty() )
+            {
+                throw new NoGoalSpecifiedException( "No goals have been specified for this build."
+                    + " You must specify a valid lifecycle phase or a goal in the format <plugin-prefix>:<goal> or"
+                    + " <plugin-group-id>:<plugin-artifact-id>[:<plugin-version>]:<goal>."
+                    + " Available lifecycle phases are: " + getLifecyclePhaseList() + "." );
+            }
+
-                new IllegalStateException( "Goal requires a project to execute but there is no POM in this build." );
+                new MissingProjectException( "Goal requires a project to execute"
+                    + " but there is no POM in this directory (" + session.getExecutionRootDirectory() + ")."
+                    + " Please verify you invoked Maven from the correct directory." );
-            throw new LifecyclePhaseNotFoundException( lifecyclePhase );
+            throw new LifecyclePhaseNotFoundException( "Unknown lifecycle phase \"" + lifecyclePhase
+                + "\". You must specify a valid lifecycle phase" + " or a goal in the format <plugin-prefix>:<goal> or"
+                + " <plugin-group-id>:<plugin-artifact-id>[:<plugin-version>]:<goal>. Available lifecycle phases are: "
+                + getLifecyclePhaseList() + ".", lifecyclePhase );
+    private String getLifecyclePhaseList()
+    {
+        Set<String> phases = new LinkedHashSet<String>();
+
+        for ( Lifecycle lifecycle : lifecycles )
+        {
+            phases.addAll( lifecycle.getPhases() );
+        }
+
+        return StringUtils.join( phases.iterator(), ", " );
+    }
+
+    private boolean requiresProject( MavenSession session )
+    {
+        List<String> goals = session.getGoals();
+        if ( goals != null )
+        {
+            for ( String goal : goals )
+            {
+                if ( !isGoalSpecification( goal ) )
+                {
+                    return true;
+                }
+            }
+        }
+        return false;
+    }
+

INS31 INS31 INS83 INS43 INS42 INS8 INS83 INS39 INS42 INS44 INS8 INS42 INS60 INS70 INS41 INS43 INS42 INS60 INS25 INS41 INS8 INS74 INS59 INS44 INS42 INS8 INS32 INS42 INS74 INS59 INS27 INS8 INS9 INS25 MOV21 INS25 MOV21 INS43 INS43 INS42 INS14 INS43 INS42 INS21 INS42 INS42 INS32 INS45 INS43 INS43 INS42 INS32 INS42 INS33 INS70 INS27 INS8 INS32 INS8 INS42 INS42 INS74 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS44 INS42 INS8 INS38 INS32 INS53 INS42 INS42 INS53 INS27 INS42 INS43 INS43 INS42 INS42 INS32 INS43 INS42 INS25 INS32 INS42 INS42 INS14 INS14 UPD43 INS27 INS45 INS42 INS45 INS45 INS45 INS32 INS45 INS42 INS42 INS42 INS42 INS42 INS38 INS8 INS42 INS42 INS43 INS27 INS43 INS27 UPD42 INS27 INS32 INS45 INS45 INS42 INS32 INS41 INS42 INS27 INS32 INS45 INS45 INS42 INS27 INS32 INS45 INS45 INS45 INS42 INS42 INS42 INS42 INS9 INS45 INS45 INS42 INS42 INS45 INS45 INS45 INS45 INS42 DEL8 DEL45 DEL42