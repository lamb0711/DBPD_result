make sure to load extensions from all projects, not just the root in a reactor

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@234149 13f79535-47bb-0310-9956-ffa450edef68

-        MavenProject project = rm.getTopLevelProject();
+        MavenProject rootProject = rm.getTopLevelProject();
-        List taskSegments = segmentTaskListByAggregationNeeds( session.getGoals(), session, project );
+        List taskSegments = segmentTaskListByAggregationNeeds( session.getGoals(), session, rootProject );
-            for ( Iterator i = project.getBuildExtensions().iterator(); i.hasNext(); )
+            // TODO: probably don't want to do all this up front
+            for ( Iterator i = session.getSortedProjects().iterator(); i.hasNext(); )
-                Extension extension = (Extension) i.next();
-                extensionManager.addExtension( extension, project, session.getLocalRepository() );
+                MavenProject project = (MavenProject) i.next();
+
+                for ( Iterator j = project.getBuildExtensions().iterator(); j.hasNext(); )
+                {
+                    Extension extension = (Extension) j.next();
+                    extensionManager.addExtension( extension, project, session.getLocalRepository() );
+                }
+
+                Map handlers = findArtifactTypeHandlers( project, session.getSettings(), session.getLocalRepository() );
+                artifactHandlerManager.addHandlers( handlers );
-            Map handlers = findArtifactTypeHandlers( project, session.getSettings(), session.getLocalRepository() );
-            artifactHandlerManager.addHandlers( handlers );
-
-            executeTaskSegments( taskSegments, rm, session, project, dispatcher );
+            executeTaskSegments( taskSegments, rm, session, rootProject, dispatcher );

UPD42 INS24 UPD42 INS58 MOV32 INS8 INS43 INS59 MOV60 MOV24 MOV60 MOV21 UPD42 INS42 INS42 INS32 INS43 INS32 INS32 INS42 INS42 UPD42 INS42 INS42 INS60 INS42 INS42 INS43 UPD42 MOV43 INS59 INS42 INS42 INS11 MOV43 INS32 INS42 INS42