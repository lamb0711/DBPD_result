[MNG-4400] [regression] Repository order from settings.xml is not respected during artifact resolution

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@829009 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashSet;
+import java.util.Set;
+    private Set<String> repositoryIds;
+
-        if ( projectBuildingRequest.getRemoteRepositories() == null )
+        this.remoteRepositories = new ArrayList<ArtifactRepository>();
+        if ( projectBuildingRequest.getRemoteRepositories() != null )
-            throw new IllegalArgumentException( "no remote repositories specified" );
+            this.remoteRepositories.addAll( projectBuildingRequest.getRemoteRepositories() );
-        this.remoteRepositories = new ArrayList<ArtifactRepository>( projectBuildingRequest.getRemoteRepositories() );
+
+        this.repositoryIds = new HashSet<String>();
+    private RepositoryModelResolver( RepositoryModelResolver original )
+    {
+        this.repositorySystem = original.repositorySystem;
+        this.resolutionErrorHandler = original.resolutionErrorHandler;
+        this.projectBuildingRequest = original.projectBuildingRequest;
+        this.reactorModelPool = original.reactorModelPool;
+        this.remoteRepositories = new ArrayList<ArtifactRepository>( original.remoteRepositories );
+        this.repositoryIds = new HashSet<String>( original.repositoryIds );
+    }
+
-        return new RepositoryModelResolver( repositorySystem, resolutionErrorHandler, projectBuildingRequest,
-                                            reactorModelPool );
+        return new RepositoryModelResolver( this );
+        if ( !repositoryIds.add( repository.getId() ) )
+        {
+            return;
+        }
+
-            remoteRepositories.add( 0, repo );
+            remoteRepositories.add( repo );

INS26 INS26 INS40 INS40 INS23 INS31 INS83 INS74 INS59 UPD83 UPD42 INS44 INS83 MOV43 INS42 INS8 INS43 INS43 INS42 INS25 INS21 MOV43 INS42 INS21 INS21 INS21 INS21 INS21 INS21 INS41 INS25 INS42 INS42 UPD27 MOV27 INS8 INS7 INS7 INS7 INS7 INS7 INS7 INS7 INS14 INS38 INS8 INS21 INS22 INS14 INS22 INS40 INS22 INS40 INS22 INS40 INS22 INS40 INS22 INS14 INS22 INS14 INS43 INS52 INS32 INS41 INS32 INS52 INS42 INS74 INS52 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS52 INS42 INS74 INS40 INS52 INS42 INS74 INS40 INS42 INS42 INS42 INS32 INS22 INS42 MOV32 INS43 INS43 INS43 INS43 INS43 INS43 INS42 INS42 INS52 INS42 UPD42 MOV42 INS42 INS42 INS42 INS42 INS42 DEL43 DEL45 DEL14 DEL53 DEL8 DEL25 DEL42 DEL42 DEL42 DEL42 DEL14 DEL41 DEL34