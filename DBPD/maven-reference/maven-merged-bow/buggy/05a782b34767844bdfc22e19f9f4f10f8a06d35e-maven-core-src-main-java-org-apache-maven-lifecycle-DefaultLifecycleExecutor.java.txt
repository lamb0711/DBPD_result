[MNG-4199] [regression] Dependency resolution for compile and runtime scope misses provided&system dependencies

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@784480 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashSet;
-import org.apache.maven.artifact.Artifact;
-                    projectDependenciesResolver.resolve( currentProject, executionPlan.getRequiredResolutionScope(), session.getLocalRepository(), currentProject.getRemoteArtifactRepositories() );
+                    projectDependenciesResolver.resolve( currentProject, executionPlan.getRequiredResolutionScopes(), session.getLocalRepository(), currentProject.getRemoteArtifactRepositories() );
-        String requiredDependencyResolutionScope = null;
+        Set<String> requiredDependencyResolutionScopes = new HashSet<String>();
-            requiredDependencyResolutionScope = calculateRequiredDependencyResolutionScope( requiredDependencyResolutionScope, mojoDescriptor.isDependencyResolutionRequired() );
+            if ( StringUtils.isNotEmpty( mojoDescriptor.isDependencyResolutionRequired() ) )
+            {
+                requiredDependencyResolutionScopes.add( mojoDescriptor.isDependencyResolutionRequired() );
+            }
-        return new MavenExecutionPlan( lifecyclePlan, requiredDependencyResolutionScope );
+        return new MavenExecutionPlan( lifecyclePlan, requiredDependencyResolutionScopes );
-    // SCOPE_COMPILE
-    // SCOPE_TEST
-    // SCOPE_RUNTIME
-    //
-    String calculateRequiredDependencyResolutionScope( String currentRequiredDependencyResolutionScope, String inputScope )
-    {
-        if ( inputScope == null )
-        {
-            return currentRequiredDependencyResolutionScope;
-        }
-                
-        if ( currentRequiredDependencyResolutionScope == null && inputScope != null )
-        {
-            return inputScope;
-        }
-
-        if ( currentRequiredDependencyResolutionScope.equals( Artifact.SCOPE_COMPILE ) && ( inputScope.equals(  Artifact.SCOPE_RUNTIME ) || inputScope.equals( Artifact.SCOPE_TEST ) ) )
-        {
-            return inputScope;
-        }
-
-        if ( currentRequiredDependencyResolutionScope.equals( Artifact.SCOPE_RUNTIME ) && inputScope.equals(  Artifact.SCOPE_TEST ) )
-        {
-            return inputScope;
-        }        
-        
-        // Nothing changed we return what we were
-        //
-        return currentRequiredDependencyResolutionScope;
-    }
-    

MOV26 UPD40 INS74 INS43 MOV43 UPD42 INS14 INS25 UPD42 INS42 INS74 MOV32 INS8 INS43 MOV43 UPD42 UPD42 MOV21 INS42 INS32 INS42 INS42 INS32 INS42 INS42 UPD42 DEL33 DEL42 DEL7 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL33 DEL27 DEL42 DEL41 DEL8 DEL25 DEL42 DEL33 DEL27 DEL42 DEL33 DEL27 DEL27 DEL42 DEL41 DEL8 DEL25 DEL42 DEL42 DEL40 DEL32 DEL42 DEL42 DEL40 DEL32 DEL42 DEL42 DEL40 DEL32 DEL27 DEL36 DEL27 DEL42 DEL41 DEL8 DEL25 DEL42 DEL42 DEL40 DEL32 DEL42 DEL42 DEL40 DEL32 DEL27 DEL42 DEL41 DEL8 DEL25 DEL42 DEL41 DEL8 DEL31