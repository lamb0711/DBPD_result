o Updated the repo layout classes to use direct string concatenation rather than StringUtils.replace() which is not useful because the layout is non-varying.
o Repoclean still not working with the new artifact/artifactmetadata stuff...the above modifications to the repo layout classes was primarily meant to improve performance when using repoclean.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163736 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.Artifact;
+import org.apache.maven.artifact.handler.ArtifactHandler;
+import org.apache.maven.artifact.handler.manager.ArtifactHandlerManager;
+import org.apache.maven.artifact.handler.manager.ArtifactHandlerNotFoundException;
+import org.apache.maven.artifact.metadata.ArtifactMetadata;
+
-    extends AbstractArtifactRepositoryLayout
+    implements ArtifactRepositoryLayout
-    protected String layoutPattern()
+    private ArtifactHandlerManager artifactHandlerManager;
+
+    public String pathOf( Artifact artifact )
+        throws ArtifactPathFormatException
-        return "${groupPath}/${directory}/${artifactId}-${version}-${classifier}.${extension}";
+        ArtifactHandler artifactHandler = null;
+        try
+        {
+            // TODO: this is a poor excuse to have this method throwing an exception. Validate the artifact first, perhaps associate the handler with it
+            artifactHandler = artifactHandlerManager.getArtifactHandler( artifact.getType() );
+        }
+        catch ( ArtifactHandlerNotFoundException e )
+        {
+            throw new ArtifactPathFormatException( "Cannot find ArtifactHandler for artifact: \'" + artifact.getId()
+                + "\'.", e );
+        }
+        
+        StringBuffer path = new StringBuffer();
+        
+        path.append(artifact.getGroupId()).append('/');
+        path.append(artifactHandler.directory()).append('/');
+        path.append(artifact.getArtifactId()).append('-').append(artifact.getVersion());
+        
+        if ( artifact.hasClassifier() )
+        {
+            path.append('-').append(artifact.getClassifier());
+        }
+        
+        path.append('.').append(artifactHandler.extension());
+
+        return path.toString();
-    protected String metadataLayoutPattern()
+    public String pathOfMetadata( ArtifactMetadata metadata )
+        throws ArtifactPathFormatException
-        return "${groupPath}/poms/${metadataFilename}";
-    }
-
-    protected String groupIdAsPath( String groupId )
-    {
-        return groupId;
+        Artifact artifact = metadata.getArtifact();
+        
+        ArtifactHandler artifactHandler = null;
+        
+        try
+        {
+            // TODO: this is a poor excuse to have this method throwing an exception. Validate the artifact first, perhaps associate the handler with it
+            artifactHandler = artifactHandlerManager.getArtifactHandler( artifact.getType() );
+        }
+        catch ( ArtifactHandlerNotFoundException e )
+        {
+            throw new ArtifactPathFormatException( "Cannot find ArtifactHandler for artifact: \'" + artifact.getId()
+                + "\'.", e );
+        }
+        
+        StringBuffer path = new StringBuffer();
+        
+        path.append(artifact.getGroupId()).append("/poms/");
+        path.append(metadata.getFilename());
+        
+        return path.toString();

INS26 INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS40 UPD43 INS23 INS31 UPD42 INS83 INS43 INS59 UPD83 MOV43 INS42 INS44 INS43 INS8 UPD83 MOV83 MOV43 INS42 INS44 INS43 INS8 INS42 INS42 INS43 INS42 INS42 INS60 INS54 INS60 INS21 INS21 INS21 INS25 INS21 INS41 INS43 INS42 INS42 INS60 INS60 INS54 INS60 INS21 INS21 MOV41 UPD42 MOV42 INS43 INS59 INS8 INS12 INS43 INS59 INS32 INS32 INS32 INS32 INS8 INS32 INS32 INS42 INS43 INS59 INS43 INS59 INS8 INS12 INS43 INS59 INS32 INS32 INS32 INS42 INS42 INS33 INS21 INS44 INS8 INS42 INS42 INS14 INS32 INS42 INS13 INS32 INS42 INS13 INS32 INS42 INS32 INS42 INS42 INS21 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS33 INS21 INS44 INS8 INS42 INS42 INS14 INS32 INS42 INS45 INS42 INS42 INS32 INS42 INS42 INS7 INS43 INS42 INS53 INS43 INS42 INS42 INS32 INS42 INS42 INS32 INS32 INS42 INS13 INS42 INS42 INS32 INS42 INS42 INS13 INS42 INS42 INS42 INS42 INS7 INS43 INS42 INS53 INS43 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS14 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS32 INS42 INS32 INS42 INS32 INS42 INS14 UPD42 MOV42 INS42 INS42 INS42 INS42 INS32 INS43 INS27 INS42 INS42 INS42 INS42 INS42 INS13 INS42 INS42 INS42 INS42 INS32 INS43 INS27 INS42 INS42 INS42 INS42 INS45 INS32 INS45 INS42 INS42 INS42 INS45 INS32 INS45 INS42 INS42 INS42 INS42 DEL43 DEL42 DEL45 DEL41 DEL8 DEL42 DEL42 DEL45 DEL41 DEL8 DEL31 DEL83 DEL42 DEL43 DEL42 DEL44 DEL8 DEL31