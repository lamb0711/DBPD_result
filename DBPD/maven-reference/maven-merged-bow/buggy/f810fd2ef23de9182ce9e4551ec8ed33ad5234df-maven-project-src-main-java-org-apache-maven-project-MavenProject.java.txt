Merging from 2.0.x branch, revIds: 

- 391163:391165 
- 391167
- 391176
- 391202
- 391326
- 391328:391329
- 391398
- 391402
- 391404

These are the changes for the 2.0.4 RC's.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@391687 13f79535-47bb-0310-9956-ffa450edef68

+        
-        this.pluginArtifacts = Collections.unmodifiableSet( project.pluginArtifacts );
-        this.reportArtifacts = Collections.unmodifiableSet( project.reportArtifacts );
-        this.extensionArtifacts = Collections.unmodifiableSet( project.extensionArtifacts );
+        
+        if ( project.pluginArtifacts != null )
+        {
+            this.pluginArtifacts = Collections.unmodifiableSet( project.pluginArtifacts );
+        }
+        
+        if ( project.reportArtifacts != null )
+        {
+            this.reportArtifacts = Collections.unmodifiableSet( project.reportArtifacts );
+        }        
+        
+        if ( project.extensionArtifacts != null )
+        {
+            this.extensionArtifacts = Collections.unmodifiableSet( project.extensionArtifacts );
+        }        
+        
-        this.remoteArtifactRepositories = Collections.unmodifiableList( project.remoteArtifactRepositories );
-        this.pluginArtifactRepositories = Collections.unmodifiableList( project.pluginArtifactRepositories );
-        this.collectedProjects = Collections.unmodifiableList( project.collectedProjects );
-        this.activeProfiles = Collections.unmodifiableList( project.activeProfiles );
-
-        // clone properties modifyable by plugins in a forked lifecycle
-        this.attachedArtifacts = new ArrayList( project.getAttachedArtifacts() );
-
-        // no need for execution project
-
-        // clone source roots
-        this.compileSourceRoots = new ArrayList( project.compileSourceRoots );
-        this.testCompileSourceRoots = new ArrayList( project.testCompileSourceRoots );
-        this.scriptSourceRoots = new ArrayList( project.scriptSourceRoots );
-
+        if ( project.remoteArtifactRepositories != null )
+        {
+            this.remoteArtifactRepositories = Collections.unmodifiableList( project.remoteArtifactRepositories );
+        }        
+        
+        if ( project.pluginArtifactRepositories != null )
+        {
+            this.pluginArtifactRepositories = Collections.unmodifiableList( project.pluginArtifactRepositories );
+        }        
+        
+        if ( project.collectedProjects != null )
+        {
+            this.collectedProjects = Collections.unmodifiableList( project.collectedProjects );
+        }        
+        
+        if ( project.activeProfiles != null )
+        {
+            this.activeProfiles = Collections.unmodifiableList( project.activeProfiles );
+        }        
+        
+        if ( project.getAttachedArtifacts() != null )
+        {
+            // clone properties modifyable by plugins in a forked lifecycle
+            this.attachedArtifacts = new ArrayList( project.getAttachedArtifacts() );
+        }        
+        
+        if ( project.compileSourceRoots != null )
+        {
+            // clone source roots
+            this.compileSourceRoots = new ArrayList( project.compileSourceRoots );
+        }        
+        
+        if ( project.testCompileSourceRoots != null )
+        {
+            this.testCompileSourceRoots = new ArrayList( project.testCompileSourceRoots );
+        }        
+        
+        if ( project.scriptSourceRoots != null )
+        {
+            this.scriptSourceRoots = new ArrayList( project.scriptSourceRoots );
+        }        
+        
-        this.artifact = ArtifactUtils.copyArtifact( project.artifact );
+        if ( project.artifact != null )
+        {
+            this.artifact = ArtifactUtils.copyArtifact( project.artifact );
+        }        
-        return model.getGroupId();
+        String groupId = model.getGroupId();
+        
+        if ( groupId == null && model.getParent() != null )
+        {
+            groupId = model.getParent().getGroupId();
+        }
+        
+        return groupId;
-        return model.getVersion();
+        String version = model.getVersion();
+        
+        if ( version == null && model.getParent() != null )
+        {
+            version = model.getParent().getVersion();
+        }
+        
+        return version;

INS43 INS43 INS25 INS25 INS25 INS25 INS25 INS25 INS25 INS25 INS25 INS25 INS25 INS25 INS42 INS60 INS25 INS42 INS60 INS25 INS27 INS8 INS27 INS8 INS27 INS8 INS27 INS8 INS27 INS8 INS27 INS8 INS27 INS8 INS27 INS8 INS27 INS8 INS27 INS8 INS27 INS8 INS27 INS8 MOV43 INS59 INS27 INS8 INS42 MOV43 INS59 INS27 INS8 INS42 INS40 INS33 MOV21 INS40 INS33 MOV21 INS40 INS33 MOV21 INS40 INS33 MOV21 INS40 INS33 MOV21 INS40 INS33 MOV21 INS40 INS33 MOV21 INS32 INS33 MOV21 INS40 INS33 MOV21 INS40 INS33 MOV21 INS40 INS33 MOV21 INS40 INS33 MOV21 INS42 MOV32 INS27 INS27 INS21 INS42 MOV32 INS27 INS27 INS21 INS42 INS42 INS42 INS33 INS32 INS33 INS7 INS42 INS33 INS32 INS33 INS7 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS32 INS42 INS32 INS42 INS42 INS42 INS42 INS42