[MNG-4642] Extended MojoDescriptor with threadSafe attribute

Added support for detecting @threadSafe annotation and a nice noisy, warning message.

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@938443 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.plugin.*;
+import org.apache.maven.model.Plugin;
+import org.apache.maven.plugin.InvalidPluginDescriptorException;
+import org.apache.maven.plugin.MojoNotFoundException;
+import org.apache.maven.plugin.PluginDescriptorParsingException;
+import org.apache.maven.plugin.PluginNotFoundException;
+import org.apache.maven.plugin.PluginResolutionException;
+import org.codehaus.plexus.logging.Logger;
+    @Requirement
+    private Logger logger;
+    
+
+
-    public BuilderCommon( LifecycleDebugLogger lifecycleDebugLogger,
-                          LifecycleExecutionPlanCalculator lifeCycleExecutionPlanCalculator,
-                          LifecycleDependencyResolver lifecycleDependencyResolver )
+    public BuilderCommon(LifecycleDebugLogger lifecycleDebugLogger,
+                         LifecycleExecutionPlanCalculator lifeCycleExecutionPlanCalculator,
+                         LifecycleDependencyResolver lifecycleDependencyResolver, Logger logger)
+        this.logger = logger;
+        if ( session.getRequest().isThreadConfigurationPresent() )
+        {
+            final Set<Plugin> unsafePlugins = executionPlan.getNonThreadSafePlugins();
+            if ( !unsafePlugins.isEmpty() )
+            {
+                logger.warn( "*****************************************************************" );
+                logger.warn( "* Your build is requesting parallel execution, but project      *" );
+                logger.warn( "* contains the following plugin(s) that are not marked as       *" );
+                logger.warn( "* @threadSafe to support parallel building.                     *" );
+                logger.warn( "* While this /may/ work fine, please look for plugin updates    *" );
+                logger.warn( "* and/or request plugins be made thread-safe.                   *" );
+                logger.warn( "* If reporting an issue, report it against the plugin in        *" );
+                logger.warn( "* question, not against maven-core                              *" );
+                logger.warn( "*****************************************************************" );
+                logger.warn( "The following plugins are not marked @threadSafe in " + project.getName() + ":" );
+                for ( Plugin unsafePlugin : unsafePlugins )
+                {
+                    logger.warn( unsafePlugin.getId() );
+                }
+                logger.warn( "*****************************************************************" );
+            }
+        }
+

INS26 INS26 INS26 INS26 INS26 INS26 UPD40 INS40 INS40 INS40 INS40 INS40 INS40 INS23 INS78 INS83 INS43 INS59 INS44 INS8 INS42 INS42 INS42 INS43 INS42 INS21 MOV60 MOV21 INS25 MOV21 MOV41 INS42 INS7 INS32 INS8 INS22 INS42 INS32 INS42 INS60 INS25 INS52 INS42 INS42 INS42 INS83 INS74 INS59 INS38 INS8 INS43 INS43 INS42 INS32 INS32 INS21 INS21 INS21 INS21 INS21 INS21 INS21 INS21 INS21 INS21 INS70 INS21 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS32 INS32 INS32 INS32 INS32 INS32 INS32 INS32 INS32 INS44 INS42 INS8 INS32 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS42 INS45 INS42 INS42 INS27 INS43 INS42 INS21 INS42 INS42 INS45 INS45 INS32 INS45 INS42 INS32 INS42 INS42 INS42 INS42 INS32 INS42 INS42 DEL8