bring back the reactor (instantiation still needs work - see comments)


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163414 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.execution.MavenProjectExecutionRequest;
-import org.codehaus.plexus.util.FileUtils;
-        MavenExecutionResponse response = new MavenExecutionResponse();
-
-        handleProject( request );
-
-        return response;
+        // TODO: not happy about this:
+        if ( request instanceof MavenReactorExecutionRequest )
+        {
+            return handleReactor( (MavenReactorExecutionRequest) request );
+        }
+        else
+        {
+            return handleProject( request );
+        }
-    public void handleProject( MavenExecutionRequest request )
+    public MavenExecutionResponse handleProject( MavenExecutionRequest request )
+        // TODO: is this perhaps more appropriate in the CLI?
+                // TODO: this should be a "FATAL" exception, reported to the developers - however currently a LOT of
+                // "user" errors fall through the cracks (like invalid POMs, as one example)
+        return response;
-    public void handleReactor( MavenExecutionRequest request, MavenExecutionResponse response )
-        throws Exception
+    public MavenExecutionResponse handleReactor( MavenReactorExecutionRequest request )
+        throws ReactorException
-            List files = FileUtils.getFiles( new File( System.getProperty( "user.dir" ) ),
-                                             ( (MavenReactorExecutionRequest) request ).getIncludes(),
-                                             ( (MavenReactorExecutionRequest) request ).getExcludes() );
+            List files = request.getProjectFiles();
-            //MavenProjectExecutionRequest projectExecutionRequest = request.createProjectExecutionRequest( project );
+            MavenProjectExecutionRequest projectExecutionRequest = request.createProjectExecutionRequest( project );
-            //handleProject( projectExecutionRequest, response );
-
-            if ( response.isExecutionFailure() )
+            try
-                break;
+                MavenExecutionResponse response = handleProject( projectExecutionRequest );
+
+                if ( response.isExecutionFailure() )
+                {
+                    return response;
+                }
+            catch ( Exception e )
+            {
+                throw new ReactorException( "Error executing project within the reactor", e );
+            }
+
+
+        // TODO: not really satisfactory
+        return null;

MOV26 UPD40 MOV43 MOV43 INS43 INS25 MOV41 UPD43 INS42 INS41 INS62 INS8 INS8 UPD42 INS33 INS42 INS43 INS41 INS41 INS60 INS54 INS42 MOV32 MOV32 INS43 INS59 INS8 INS12 UPD42 MOV11 INS32 INS42 INS42 INS32 INS60 MOV25 INS44 INS8 INS42 UPD42 MOV42 INS42 INS42 INS42 MOV43 INS59 MOV43 INS42 INS53 INS42 INS32 INS41 INS14 INS42 INS42 INS42 INS43 INS45 INS42 INS42 DEL36 DEL42 DEL14 DEL59 DEL60 DEL21 DEL39 DEL39 DEL42 DEL44 DEL42 DEL42 DEL42 DEL43 DEL42 DEL42 DEL45 DEL32 DEL14 DEL42 DEL43 DEL42 DEL11 DEL36 DEL32 DEL32 DEL10