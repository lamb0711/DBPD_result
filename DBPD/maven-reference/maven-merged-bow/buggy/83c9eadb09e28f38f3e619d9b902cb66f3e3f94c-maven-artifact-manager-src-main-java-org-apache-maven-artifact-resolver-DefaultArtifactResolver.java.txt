[MNG-1908] force an update check if there are legacy snapshots within the updatePolicy window

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@375485 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.repository.ArtifactRepositoryPolicy;
+import java.util.Date;
+                List repositories = remoteRepositories;
+
+                // TODO: would prefer the snapshot transformation took care of this. Maybe we need a "shouldresolve" flag.
+                if ( artifact.isSnapshot() && artifact.getBaseVersion().equals( artifact.getVersion() ) &&
+                    destination.exists() )
+                {
+                    Date comparisonDate = new Date( destination.lastModified() );
+
+                    // cull to list of repositories that would like an update
+                    repositories = new ArrayList( remoteRepositories );
+                    for ( Iterator i = repositories.iterator(); i.hasNext(); )
+                    {
+                        ArtifactRepository repository = (ArtifactRepository) i.next();
+                        ArtifactRepositoryPolicy policy = repository.getSnapshots();
+                        if ( !policy.isEnabled() || !policy.checkOutOfDate( comparisonDate ) )
+                        {
+                            i.remove();
+                        }
+                    }
+
+                    if ( !repositories.isEmpty() )
+                    {
+                        // someone wants to check for updates
+                        force = true;
+                    }
+                }
-                            wagonManager.getArtifact( artifact, remoteRepositories );
+                            wagonManager.getArtifact( artifact, repositories );
-        
+
-            for( Iterator i=missingArtifacts.iterator(); i.hasNext(); )
+            for ( Iterator i = missingArtifacts.iterator(); i.hasNext(); )

INS26 INS26 INS40 INS40 INS60 INS25 INS43 INS59 INS27 INS8 INS42 INS42 INS42 INS32 INS32 INS32 INS60 INS21 INS24 INS25 INS42 INS42 INS32 INS42 INS32 INS42 INS42 INS43 INS59 INS7 INS58 INS32 INS8 INS38 INS8 INS42 INS42 INS42 INS42 INS42 INS42 INS14 INS42 INS14 INS43 INS59 INS42 INS42 INS60 INS60 INS25 INS32 INS21 INS43 INS32 INS43 INS42 INS42 INS42 INS32 INS43 INS59 INS43 INS59 INS27 INS8 INS42 INS42 INS7 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS11 INS42 INS42 INS32 INS38 INS38 INS21 INS42 INS9 INS43 INS32 INS42 INS42 INS32 INS32 INS32 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 UPD42