change archiving plugins to use a shred archive configuration


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163716 13f79535-47bb-0310-9956-ffa450edef68

- * @todo improve the use of this now that plugin fields are used instead of a request object - add an <archive> element to configuration?
+ * @todo improve the use of this now that plugin fields are used instead of a request object - add an <archive> element to configuration?
-    public Manifest getManifest( MavenProject project, String mainClass, String packageName, boolean addClasspath,
-                                 boolean addExtensions )
+    public Manifest getManifest( MavenProject project, ManifestConfiguration config )
-        if ( packageName != null )
+        if ( config.getPackageName() != null )
-            Manifest.Attribute packageAttr = new Manifest.Attribute( "Package", packageName );
+            Manifest.Attribute packageAttr = new Manifest.Attribute( "Package", config.getPackageName() );
-        if ( addClasspath )
+        if ( config.isAddClasspath() )
+        String mainClass = config.getMainClass();
-        if ( addExtensions )
+        if ( config.isAddExtensions() )
-                    // TODO: make repo configurable
-                    name = artifact.getArtifactId() + "-Implementation-URL";
-                    String url = "http://www.ibiblio.org/maven/" + artifact.toString();
-                    Manifest.Attribute archImplUrlAttr = new Manifest.Attribute( name, url );
-                    m.addConfiguredAttribute( archImplUrlAttr );
+
+                    if ( artifact.getRepository() != null )
+                    {
+                        // TODO: is this correct
+                        name = artifact.getArtifactId() + "-Implementation-URL";
+                        String url = artifact.getRepository().getUrl() + "/" + artifact.toString();
+                        Manifest.Attribute archImplUrlAttr = new Manifest.Attribute( name, url );
+                        m.addConfiguredAttribute( archImplUrlAttr );
+                    }
-    public void createArchive( MavenProject project, String manifestFile, boolean compress, boolean index,
-                               Manifest manifest )
+    public void createArchive( MavenProject project, MavenArchiveConfiguration archiveConfiguration )
+        String manifestFile = archiveConfiguration.getManifestFile();
+        Manifest manifest = getManifest( project, archiveConfiguration.getManifest() );
+
-        archiver.setCompress( compress );
-        archiver.setIndex( index );
+        archiver.setCompress( archiveConfiguration.isCompress() );
+        archiver.setIndex( archiveConfiguration.isIndex() );

MOV65 UPD43 UPD42 INS60 INS43 INS42 INS60 INS60 UPD42 INS32 MOV43 INS59 INS32 INS42 MOV43 INS59 MOV43 INS59 INS32 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS32 INS32 INS32 INS42 INS42 MOV43 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 UPD42 MOV42 INS42 UPD42 MOV42 INS42 INS42 MOV43 INS32 INS42 INS42 INS25 INS27 INS8 INS32 INS33 MOV21 MOV60 MOV60 MOV21 INS42 INS42 INS32 UPD45 INS32 INS42 INS42 INS42 DEL42 DEL44 DEL39 DEL42 DEL44 DEL39 DEL42 DEL44 DEL42 DEL42 DEL42 DEL42 DEL42 DEL39 DEL42 DEL44 DEL39 DEL42 DEL44 DEL42 DEL44