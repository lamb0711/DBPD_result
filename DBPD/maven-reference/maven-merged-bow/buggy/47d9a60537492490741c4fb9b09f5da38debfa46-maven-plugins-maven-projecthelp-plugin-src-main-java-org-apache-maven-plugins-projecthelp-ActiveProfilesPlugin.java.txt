Working on: MNG-786

o Changed the profile activation in it0075 to use a system property which is not always present

o Added projecthelp:active-profiles, package, and clean:clean to the goals list, in case it was only happening with the clean plugin

o Fixed the projecthelp mojos to be aggregators where appropriate

o Changed the ordering of modules in the profile injector (used to be that profile modules were prepended; now, they're appended)

NOTE: I still cannot reproduce the described behavior. Dan: Am I missing something WRT the test setup? I changed the activation trigger to be non-inherent, and I'm not using a boolean string to trigger the profile. What am I doing wrong??



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@292781 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.project.MavenProject;
+import java.io.File;
+import java.io.FileWriter;
+import java.io.IOException;
+import java.io.Writer;
+import java.util.Date;
+ * @aggregator
-     * @parameter expression="${project.activeProfiles}"
+     * This is the list of projects currently slated to be built by Maven.
+     * 
+     * @parameter expression="${reactorProjects}"
-    private List profiles;
+    private List projects;
+    
+    /**
+     * This is an optional parameter for a file destination for the output
+     * of this mojo...the listing of active profiles per project.
+     * 
+     * @parameter expression="${output}"
+     */
+    private File output;
+        for ( Iterator it = projects.iterator(); it.hasNext(); )
+        {
+            MavenProject project = (MavenProject) it.next();
+            
+            getActiveProfileStatement( project, message );
+            
+            message.append( "\n\n" );
+        }
+        
+        if ( output != null )
+        {
+            writeFile( message );
+        }
+        else
+        {
+            Log log = getLog();
+            log.info( message );
+        }
+    }
+    
+    private void writeFile( StringBuffer message ) 
+        throws MojoExecutionException
+    {
+        Writer writer = null;
+        try
+        {
+            File dir = output.getParentFile();
+            
+            if( !dir.exists() )
+            {
+                dir.mkdirs();
+            }
+            
+            writer = new FileWriter( output );
+            
+            writer.write( "Created by: " + getClass().getName() + "\n" );
+            writer.write( "Created on: " + new Date() + "\n\n" );
+            writer.write( message.toString() );
+            writer.flush();
+            
+            getLog().info( "Active profile report written to: " + output );
+        }
+        catch ( IOException e )
+        {
+            throw new MojoExecutionException( "Cannot write output to file: " + output, e );
+        }
+        finally
+        {
+            if ( writer != null )
+            {
+                try
+                {
+                    writer.close();
+                }
+                catch ( IOException e )
+                {
+                    getLog().debug( "Failed to close output file writer.", e );
+                }
+            }
+        }
+    }
+
+    private void getActiveProfileStatement( MavenProject project, StringBuffer message )
+    {
+        List profiles = project.getActiveProfiles();
+        
+        message.append( "Active Profiles for Project \'" + project.getId() + "\': \n\n" );
+        
-            message.append( "The following profiles are active:\n\n" );
+            message.append( "The following profiles are active:\n" );
-        message.append( "\n\n" );
-        
-        Log log = getLog();
-        
-        log.info( message );
-        
+        message.append( "\n" );
-    protected final List getProfiles()
+    public final void setProjects( List projects )
-        return profiles;
-    }
-
-    protected final void setProfiles( List profiles )
-    {
-        this.profiles = profiles;
+        this.projects = projects;

INS26 INS26 INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS40 INS40 INS23 INS31 INS31 INS65 INS29 INS83 INS43 INS59 UPD83 MOV83 INS39 INS42 MOV43 INS8 INS83 INS39 INS42 INS44 INS43 INS8 UPD83 INS42 INS44 INS44 UPD83 UPD42 INS65 UPD42 INS65 INS65 INS42 INS42 MOV60 INS24 INS25 INS43 INS42 INS42 INS60 INS54 INS43 INS42 INS43 INS42 INS60 INS21 INS21 MOV43 UPD42 INS66 UPD66 INS66 INS66 INS66 INS58 INS32 INS8 INS27 INS8 INS8 INS42 INS43 INS59 INS8 INS12 INS8 INS42 INS42 MOV43 INS59 INS32 INS32 INS43 INS59 INS42 INS42 INS60 INS21 MOV21 INS42 INS33 INS21 MOV60 MOV21 INS42 INS42 INS33 INS60 INS25 INS21 INS21 INS21 INS21 INS21 INS21 INS44 INS8 INS25 INS42 INS32 INS42 INS42 INS27 INS42 INS42 INS45 UPD42 INS42 INS42 INS32 INS43 INS59 INS32 INS32 INS43 INS59 INS38 INS8 INS7 INS32 INS32 INS32 INS32 INS32 INS43 INS42 INS53 INS27 INS8 INS42 INS42 INS45 INS32 INS45 UPD42 INS42 INS42 INS42 INS42 INS11 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS32 INS21 INS42 INS14 INS42 INS42 INS27 INS42 INS42 INS27 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS27 INS42 INS14 INS42 INS33 INS54 INS42 INS42 UPD45 INS43 INS32 INS42 INS42 INS42 INS42 INS32 INS43 INS42 INS45 INS32 INS45 INS45 INS14 INS45 INS42 INS42 INS42 INS45 INS42 INS43 INS27 INS42 INS8 INS12 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS43 INS42 INS45 INS42 INS21 INS44 INS8 INS42 INS42 INS32 INS43 INS42 INS21 INS42 INS42 INS42 INS32 INS32 INS42 INS45 INS42 INS42 DEL42 DEL83 DEL42 DEL42 DEL41 DEL8 DEL31