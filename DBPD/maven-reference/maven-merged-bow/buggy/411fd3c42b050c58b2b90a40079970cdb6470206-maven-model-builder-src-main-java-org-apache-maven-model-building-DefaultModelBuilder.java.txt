o Improved handling of circular parents

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@885106 13f79535-47bb-0310-9956-ffa450edef68

-    private ModelBuildingResult build( ModelBuildingRequest request, Collection<String> imports )
+    private ModelBuildingResult build( ModelBuildingRequest request, Collection<String> importIds )
+        Collection<String> parentIds = new LinkedHashSet<String>();
+        parentIds.add( ModelProblemUtils.toId( inputModel ) );
+
+            else if ( !parentIds.add( currentData.getId() ) )
+            {
+                String message = "The parents form a cycle: ";
+                for ( String modelId : parentIds )
+                {
+                    message += modelId + " -> ";
+                }
+                message += currentData.getId();
+
+                problems.add( ModelProblem.Severity.FATAL, message, null );
+                throw new ModelBuildingException( problems.getRootModelId(), problems.getProblems() );
+            }
-                                             DefaultModelProblemCollector problems, Collection<String> imports )
+                                             DefaultModelProblemCollector problems, Collection<String> importIds )
-        imports.add( importing );
+        importIds.add( importing );
-            if ( imports.contains( imported ) )
+            if ( importIds.contains( imported ) )
-                for ( String modelId : imports )
+                for ( String modelId : importIds )
-                    importResult = build( importRequest, imports );
+                    importResult = build( importRequest, importIds );
-        imports.remove( importing );
+        importIds.remove( importing );

UPD42 INS60 INS21 UPD42 INS74 INS59 INS32 INS43 INS43 INS42 INS14 INS42 INS42 INS32 INS25 UPD42 UPD42 INS42 INS42 INS74 INS42 INS42 INS42 MOV27 MOV8 INS25 INS43 INS43 INS38 INS8 UPD42 INS42 INS42 INS32 INS60 INS70 INS21 INS21 INS53 UPD42 INS42 INS42 INS32 INS43 INS59 INS44 INS42 INS8 INS7 INS32 INS14 INS42 INS42 INS42 INS42 INS45 INS43 INS42 INS21 INS42 INS32 INS42 INS42 INS40 INS42 INS33 INS43 INS32 INS32 INS42 INS7 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS27 UPD42 INS42 INS45 DEL25