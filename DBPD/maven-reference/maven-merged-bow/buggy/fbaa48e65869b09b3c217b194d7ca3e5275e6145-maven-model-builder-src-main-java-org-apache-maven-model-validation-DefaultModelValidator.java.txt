[MNG-1701] Validate that a plugin is not configured twice in the pom

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@928426 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.PluginManagement;
+            Build build = model.getBuild();
+            if ( build != null )
+            {
+                validateRawPlugins( problems, build.getPlugins(), false, request );
+
+                PluginManagement mngt = build.getPluginManagement();
+                if ( mngt != null )
+                {
+                    validateRawPlugins( problems, mngt.getPlugins(), true, request );
+                }
+            }
+
+    private void validateRawPlugins( ModelProblemCollector problems, List<Plugin> plugins, boolean managed,
+                                     ModelBuildingRequest request )
+    {
+        Severity errOn31 = getSeverity( request, ModelBuildingRequest.VALIDATION_LEVEL_MAVEN_3_1 );
+
+        String prefix = ( managed ? "build.pluginManagement." : "build." ) + "plugins.plugin.";
+
+        Map<String, Plugin> index = new HashMap<String, Plugin>();
+
+        for ( Plugin plugin : plugins )
+        {
+            String key = plugin.getKey();
+
+            Plugin existing = index.get( key );
+
+            if ( existing != null )
+            {
+                addViolation( problems, errOn31, prefix + "(groupId:artifactId)", null,
+                              "must be unique but found duplicate declaration of plugin " + key );
+            }
+            else
+            {
+                index.put( key, plugin );
+            }
+        }
+    }
+

INS26 INS40 INS31 INS83 INS39 INS42 INS44 INS44 INS44 INS44 INS8 INS43 INS42 INS74 INS42 INS39 INS42 INS43 INS42 INS60 INS60 INS60 INS70 INS42 INS43 INS43 INS42 INS43 INS59 INS43 INS59 INS74 INS59 INS44 INS42 INS8 INS60 INS25 INS42 INS42 INS42 INS42 INS32 INS42 INS42 INS27 INS43 INS43 INS43 INS42 INS14 INS43 INS42 INS60 INS60 INS25 INS43 INS59 INS27 INS8 INS42 INS42 INS40 INS36 INS45 INS42 INS42 INS42 INS74 INS42 INS43 INS59 INS43 INS59 INS27 INS8 INS8 INS42 INS42 INS32 INS42 INS33 INS21 INS60 INS25 INS16 INS43 INS43 INS43 INS42 INS42 INS32 INS42 INS42 INS32 INS42 INS33 INS21 INS21 INS42 INS42 INS32 INS43 INS59 INS27 INS8 INS42 INS45 INS45 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS32 INS42 INS42 INS32 INS9 INS42 INS42 INS42 INS32 INS42 INS33 INS21 INS42 INS42 INS42 INS27 INS33 INS27 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS42 INS32 INS42 INS45 INS45 INS42 INS42 INS42 INS32 INS9 INS42 INS42 INS42