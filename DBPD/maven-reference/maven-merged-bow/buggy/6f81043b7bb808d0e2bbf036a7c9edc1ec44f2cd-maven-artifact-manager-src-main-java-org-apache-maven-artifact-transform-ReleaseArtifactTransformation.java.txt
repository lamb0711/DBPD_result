Centralized repository handling in AbstractVersionTransformation, for consistency (should fix MNG-527).

Changed download strategy for plugins.xml metadata to download only when non-existent locally or when plugin prefix cannot be located within local metadata. NOTE: This could lead to local-only installs of plugins having their prefix mappings overwritten.

Next step is to change the maven-plugin-plugin.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@219615 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.metadata.VersionArtifactMetadata;
-import org.apache.maven.wagon.ResourceDoesNotExistException;
-import java.io.IOException;
-            if ( !version.equals( artifact.getVersion() ) )
+            
+            if ( version != null && !version.equals( artifact.getVersion() ) )
-    protected VersionArtifactMetadata retrieveFromRemoteRepository( Artifact artifact,
-                                                                    ArtifactRepository remoteRepository,
-                                                                    VersionArtifactMetadata localMetadata )
-        throws ArtifactMetadataRetrievalException
+    protected AbstractVersionArtifactMetadata createMetadata( Artifact artifact )
-        AbstractVersionArtifactMetadata metadata = new ReleaseArtifactMetadata( artifact );
-        try
-        {
-            metadata.retrieveFromRemoteRepository( remoteRepository, wagonManager );
-        }
-        catch ( ResourceDoesNotExistException e )
-        {
-            if ( localMetadata.constructVersion() == null )
-            {
-                throw new ArtifactMetadataRetrievalException( "Unable to find release for artifact " + artifact, e );
-            }
-            // otherwise, ignore - use the local one
-        }
-        return metadata;
+        return new ReleaseArtifactMetadata( artifact );
-    protected VersionArtifactMetadata readFromLocalRepository( Artifact artifact, ArtifactRepository localRepository )
-        throws IOException
-    {
-        AbstractVersionArtifactMetadata metadata = new ReleaseArtifactMetadata( artifact );
-        metadata.readFromLocalRepository( localRepository );
-        return metadata;
-    }

MOV43 INS42 MOV14 INS27 INS27 MOV38 INS42 INS33 DEL40 DEL26 DEL40 DEL26 DEL40 DEL26 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL59 DEL60 DEL42 DEL42 DEL42 DEL42 DEL32 DEL21 DEL8 DEL42 DEL43 DEL42 DEL44 DEL42 DEL42 DEL32 DEL33 DEL27 DEL42 DEL43 DEL45 DEL42 DEL27 DEL42 DEL14 DEL53 DEL8 DEL25 DEL8 DEL12 DEL54 DEL42 DEL83 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL44 DEL42 DEL43 DEL42 DEL43 DEL42 DEL42 DEL43 DEL42 DEL14 DEL59 DEL60 DEL42 DEL42 DEL42 DEL32 DEL21 DEL42 DEL41 DEL8 DEL31