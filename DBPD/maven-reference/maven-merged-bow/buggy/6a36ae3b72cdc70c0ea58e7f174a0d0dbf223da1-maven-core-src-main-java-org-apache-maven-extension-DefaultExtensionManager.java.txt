[MNG-2228] make sure build extensions are filtered from being loaded in plugins


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@480377 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.MavenArtifactFilterManager;
+import org.apache.maven.artifact.resolver.filter.ExcludesArtifactFilter;
+import org.apache.maven.plugin.PluginManager;
-import org.apache.maven.MavenArtifactFilterManager;
+import java.util.List;
+import java.util.ArrayList;
+    private PluginManager pluginManager;
+
-        		ArtifactFilter filter = new ProjectArtifactExceptionFilter( artifactFilter, project.getArtifact() );
-        		
+            ArtifactFilter filter = new ProjectArtifactExceptionFilter( artifactFilter, project.getArtifact() );
+
-                                                                                    artifactMetadataSource,
-                                                                                    filter );
+                                                                                    artifactMetadataSource, filter );
+
+            List excludedArtifacts = new ArrayList( result.getArtifacts().size() );
+                excludedArtifacts.add( ArtifactUtils.versionlessKey( a ) );
+
+            pluginManager.addToArtifactFilter( new ExcludesArtifactFilter( excludedArtifacts )  );
-    
-    private static final class ProjectArtifactExceptionFilter implements ArtifactFilter
-    {
-    		private ArtifactFilter passThroughFilter;
-    		private String projectDependencyConflictId;
-    		
-    		ProjectArtifactExceptionFilter( ArtifactFilter passThroughFilter, Artifact projectArtifact )
-    		{
-				this.passThroughFilter = passThroughFilter;
-				this.projectDependencyConflictId = projectArtifact.getDependencyConflictId();
-    		}
-		public boolean include(Artifact artifact) {
-			String depConflictId = artifact.getDependencyConflictId();
-			
-			return projectDependencyConflictId.equals( depConflictId )
-					|| passThroughFilter.include( artifact );
-		}
+    private static final class ProjectArtifactExceptionFilter
+        implements ArtifactFilter
+    {
+        private ArtifactFilter passThroughFilter;
+
+        private String projectDependencyConflictId;
+
+        ProjectArtifactExceptionFilter( ArtifactFilter passThroughFilter, Artifact projectArtifact )
+        {
+            this.passThroughFilter = passThroughFilter;
+            this.projectDependencyConflictId = projectArtifact.getDependencyConflictId();
+        }
+
+        public boolean include( Artifact artifact )
+        {
+            String depConflictId = artifact.getDependencyConflictId();
+
+            return projectDependencyConflictId.equals( depConflictId ) || passThroughFilter.include( artifact );
+        }

MOV26 INS26 INS26 INS26 INS26 INS40 INS40 INS40 INS40 INS23 INS83 INS43 INS59 INS42 INS42 INS60 INS21 INS43 INS59 INS32 INS42 INS42 INS14 INS21 INS42 INS42 INS14 INS43 INS32 INS32 INS43 INS42 INS42 INS32 INS42 INS42 INS42 INS32 INS42 INS42 INS42 INS42 INS42 INS42