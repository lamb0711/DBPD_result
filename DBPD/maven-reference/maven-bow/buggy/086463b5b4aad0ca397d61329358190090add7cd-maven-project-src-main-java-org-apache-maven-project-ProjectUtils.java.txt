PR: MNG-456
allow separate snapshot and release repositories
deprecate existing snapshotPolicy and checksumPolicy in favour of updatePolicy and checksumPolicy within the <releases> and <snapshots> elements in the <repository> element.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@224707 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.repository.ArtifactRepositoryPolicy;
+import org.apache.maven.model.RepositoryBase;
+import org.apache.maven.model.RepositoryPolicy;
+    public static ArtifactRepository buildArtifactRepositoryBase( RepositoryBase repo,
+                                                                  ArtifactRepositoryFactory artifactRepositoryFactory,
+                                                                  PlexusContainer container )
+        throws ProjectBuildingException
+    {
+        if ( repo != null )
+        {
+            String id = repo.getId();
+            String url = repo.getUrl();
+
+            // TODO: make this a map inside the factory instead, so no lookup needed
+            ArtifactRepositoryLayout layout = getRepositoryLayout( repo, container );
+
+            return artifactRepositoryFactory.createArtifactRepository( id, url, layout );
+        }
+        else
+        {
+            return null;
+        }
+    }
+
-            String snapshotPolicy = repo.getSnapshotPolicy();
-            String checksumPolicy = repo.getChecksumPolicy();
-            return artifactRepositoryFactory.createArtifactRepository( id, url, layout, snapshotPolicy,
-                                                                       checksumPolicy );
+            ArtifactRepositoryPolicy snapshots = buildArtifactRepositoryPolicy( repo.getSnapshots(),
+                                                                                repo.getSnapshotPolicy(),
+                                                                                repo.getChecksumPolicy() );
+            ArtifactRepositoryPolicy releases = buildArtifactRepositoryPolicy( repo.getReleases(),
+                                                                               repo.getSnapshotPolicy(),
+                                                                               repo.getChecksumPolicy() );
+
+            return artifactRepositoryFactory.createArtifactRepository( id, url, layout, snapshots, releases );
-    private static ArtifactRepositoryLayout getRepositoryLayout( Repository mavenRepo, PlexusContainer container )
+    private static ArtifactRepositoryPolicy buildArtifactRepositoryPolicy( RepositoryPolicy policy,
+                                                                           String defaultUpdatePolicy,
+                                                                           String defaultChecksumPolicy )
+    {
+        boolean enabled = true;
+        String updatePolicy = defaultUpdatePolicy;
+        String checksumPolicy = defaultChecksumPolicy;
+
+        if ( policy != null )
+        {
+            enabled = policy.isEnabled();
+            if ( policy.getUpdatePolicy() != null )
+            {
+                updatePolicy = policy.getUpdatePolicy();
+            }
+            if ( policy.getChecksumPolicy() != null )
+            {
+                checksumPolicy = policy.getChecksumPolicy();
+            }
+        }
+
+        return new ArtifactRepositoryPolicy( enabled, updatePolicy, checksumPolicy );
+    }
+
+    private static ArtifactRepositoryLayout getRepositoryLayout( RepositoryBase mavenRepo, PlexusContainer container )
-        ArtifactRepositoryLayout repositoryLayout = null;
+        ArtifactRepositoryLayout repositoryLayout;
-            throw new ProjectBuildingException(
-                "Cannot find layout implementation corresponding to: \'" + layout +
-                    "\' for remote repository with id: \'" + mavenRepo.getId() + "\'.", e );
+            throw new ProjectBuildingException( "Cannot find layout implementation corresponding to: \'" + layout +
+                "\' for remote repository with id: \'" + mavenRepo.getId() + "\'.", e );
