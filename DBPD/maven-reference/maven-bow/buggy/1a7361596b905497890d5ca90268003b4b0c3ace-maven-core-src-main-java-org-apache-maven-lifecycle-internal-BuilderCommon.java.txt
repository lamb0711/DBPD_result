[MNG-4642] Extended MojoDescriptor with threadSafe attribute

Added support for detecting @threadSafe annotation and a nice noisy, warning message.

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@938443 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.plugin.*;
+import org.apache.maven.model.Plugin;
+import org.apache.maven.plugin.InvalidPluginDescriptorException;
+import org.apache.maven.plugin.MojoNotFoundException;
+import org.apache.maven.plugin.PluginDescriptorParsingException;
+import org.apache.maven.plugin.PluginNotFoundException;
+import org.apache.maven.plugin.PluginResolutionException;
+import org.codehaus.plexus.logging.Logger;
+    @Requirement
+    private Logger logger;
+    
+
+
-    public BuilderCommon( LifecycleDebugLogger lifecycleDebugLogger,
-                          LifecycleExecutionPlanCalculator lifeCycleExecutionPlanCalculator,
-                          LifecycleDependencyResolver lifecycleDependencyResolver )
+    public BuilderCommon(LifecycleDebugLogger lifecycleDebugLogger,
+                         LifecycleExecutionPlanCalculator lifeCycleExecutionPlanCalculator,
+                         LifecycleDependencyResolver lifecycleDependencyResolver, Logger logger)
+        this.logger = logger;
+        if ( session.getRequest().isThreadConfigurationPresent() )
+        {
+            final Set<Plugin> unsafePlugins = executionPlan.getNonThreadSafePlugins();
+            if ( !unsafePlugins.isEmpty() )
+            {
+                logger.warn( "*****************************************************************" );
+                logger.warn( "* Your build is requesting parallel execution, but project      *" );
+                logger.warn( "* contains the following plugin(s) that are not marked as       *" );
+                logger.warn( "* @threadSafe to support parallel building.                     *" );
+                logger.warn( "* While this /may/ work fine, please look for plugin updates    *" );
+                logger.warn( "* and/or request plugins be made thread-safe.                   *" );
+                logger.warn( "* If reporting an issue, report it against the plugin in        *" );
+                logger.warn( "* question, not against maven-core                              *" );
+                logger.warn( "*****************************************************************" );
+                logger.warn( "The following plugins are not marked @threadSafe in " + project.getName() + ":" );
+                for ( Plugin unsafePlugin : unsafePlugins )
+                {
+                    logger.warn( unsafePlugin.getId() );
+                }
+                logger.warn( "*****************************************************************" );
+            }
+        }
+
