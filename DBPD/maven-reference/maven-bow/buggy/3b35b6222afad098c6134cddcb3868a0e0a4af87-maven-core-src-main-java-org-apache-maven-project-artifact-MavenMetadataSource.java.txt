[MNG-4522] Maven3 doesn't fail build when a pom from transitive dependency can't be found

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@902573 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.building.ModelBuildingException;
+import org.apache.maven.model.building.ModelProblem;
+import org.apache.maven.model.resolution.UnresolvableModelException;
+                    ModelProblem missingParentPom = hasMissingParentPom( e );
+                    if ( missingParentPom != null )
+                    {
+                        throw new ArtifactMetadataRetrievalException( "Failed to process POM for "
+                            + relocatedArtifact.getId() + ": " + missingParentPom.getMessage(),
+                                                                      missingParentPom.getException(),
+                                                                      relocatedArtifact );
+                    }
+
-                    if ( e.getCause() instanceof ArtifactResolutionException )
+                    if ( isMissingPom( e ) )
-                        message = "Missing artifact metadata for " + relocatedArtifact.getId();
+                        message = "Missing POM for " + relocatedArtifact.getId();
-                            "Invalid artifact metadata for " + relocatedArtifact.getId()
+                            "Invalid POM for " + relocatedArtifact.getId()
+    private boolean isMissingPom( ProjectBuildingException e )
+    {
+        return e.getCause() instanceof ArtifactResolutionException;
+    }
+
+    private ModelProblem hasMissingParentPom( ProjectBuildingException e )
+    {
+        if ( e.getCause() instanceof ModelBuildingException )
+        {
+            ModelBuildingException mbe = (ModelBuildingException) e.getCause();
+            for ( ModelProblem problem : mbe.getProblems() )
+            {
+                if ( problem.getException() instanceof UnresolvableModelException )
+                {
+                    return problem;
+                }
+            }
+
+        }
+        return null;
+    }
+
