[MNG-1701] Validate that a plugin is not configured twice in the pom

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@928426 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.PluginManagement;
+            Build build = model.getBuild();
+            if ( build != null )
+            {
+                validateRawPlugins( problems, build.getPlugins(), false, request );
+
+                PluginManagement mngt = build.getPluginManagement();
+                if ( mngt != null )
+                {
+                    validateRawPlugins( problems, mngt.getPlugins(), true, request );
+                }
+            }
+
+    private void validateRawPlugins( ModelProblemCollector problems, List<Plugin> plugins, boolean managed,
+                                     ModelBuildingRequest request )
+    {
+        Severity errOn31 = getSeverity( request, ModelBuildingRequest.VALIDATION_LEVEL_MAVEN_3_1 );
+
+        String prefix = ( managed ? "build.pluginManagement." : "build." ) + "plugins.plugin.";
+
+        Map<String, Plugin> index = new HashMap<String, Plugin>();
+
+        for ( Plugin plugin : plugins )
+        {
+            String key = plugin.getKey();
+
+            Plugin existing = index.get( key );
+
+            if ( existing != null )
+            {
+                addViolation( problems, errOn31, prefix + "(groupId:artifactId)", null,
+                              "must be unique but found duplicate declaration of plugin " + key );
+            }
+            else
+            {
+                index.put( key, plugin );
+            }
+        }
+    }
+
