[MNG-4489] [regression] Mirror/proxy/auth does not apply to repositories discovered in POMs of build extensions

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@889460 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.repository.DefaultRepositoryRequest;
-                                                                          RepositoryRequest repositoryRequest )
+                                                                          ProjectBuildingRequest request )
+        RepositoryRequest repositoryRequest = new DefaultRepositoryRequest();
+        repositoryRequest.setCache( request.getRepositoryCache() );
+        repositoryRequest.setLocalRepository( request.getLocalRepository() );
+        repositoryRequest.setRemoteRepositories( project.getPluginArtifactRepositories() );
+        repositoryRequest.setOffline( request.isOffline() );
+        repositoryRequest.setForceUpdate( request.isForceUpdate() );
+        repositoryRequest.setTransferListener( request.getTransferListener() );
+
-                artifacts = resolveExtensionArtifacts( plugin, repositoryRequest );
+                artifacts = resolveExtensionArtifacts( plugin, repositoryRequest, request );
-    private List<Artifact> resolveExtensionArtifacts( Plugin extensionPlugin, RepositoryRequest repositoryRequest )
+    private List<Artifact> resolveExtensionArtifacts( Plugin extensionPlugin, RepositoryRequest repositoryRequest,
+                                                      ProjectBuildingRequest request )
-        ArtifactResolutionRequest request = new ArtifactResolutionRequest( repositoryRequest );
-        request.setArtifact( extensionArtifact );
-        request.setArtifactDependencies( overrideArtifacts );
-        request.setCollectionFilter( collectionFilter );
-        request.setResolutionFilter( resolutionFilter );
-        request.setResolveRoot( true );
-        request.setResolveTransitively( true );
+        ArtifactResolutionRequest artifactRequest = new ArtifactResolutionRequest( repositoryRequest );
+        artifactRequest.setArtifact( extensionArtifact );
+        artifactRequest.setArtifactDependencies( overrideArtifacts );
+        artifactRequest.setCollectionFilter( collectionFilter );
+        artifactRequest.setResolutionFilter( resolutionFilter );
+        artifactRequest.setResolveRoot( true );
+        artifactRequest.setResolveTransitively( true );
+        artifactRequest.setServers( request.getServers() );
+        artifactRequest.setMirrors( request.getMirrors() );
+        artifactRequest.setProxies( request.getProxies() );
-        ArtifactResolutionResult result = repositorySystem.resolve( request );
+        ArtifactResolutionResult result = repositorySystem.resolve( artifactRequest );
-            resolutionErrorHandler.throwErrors( request, result );
+            resolutionErrorHandler.throwErrors( artifactRequest, result );
