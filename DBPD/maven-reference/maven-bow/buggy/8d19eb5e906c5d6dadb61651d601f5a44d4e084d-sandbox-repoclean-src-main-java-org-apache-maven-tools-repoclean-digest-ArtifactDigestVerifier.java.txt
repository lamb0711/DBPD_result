o Added creation of SHA1 digests alongside MD5's
o Modified digest-file creation to be text files, not binaries.

PR: MNG-311, MNG-287


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163975 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.tools.repoclean.report.FileReporter;
+import org.apache.maven.tools.repoclean.report.ReportWriteException;
+import org.apache.maven.tools.repoclean.report.Reporter;
+    
+    public void setArtifactDigestor(ArtifactDigestor artifactDigestor)
+    {
+        this.artifactDigestor = artifactDigestor;
+    }
-    public void verifyDigest( Artifact artifact, File artifactTarget, FileReporter reporter, boolean reportOnly ) throws Exception
+    public void verifyDigest( Artifact artifact, File artifactTarget, Reporter reporter, boolean reportOnly )
+        throws ArtifactDigestException, ReportWriteException, IOException
+    {
+        verifyDigestFile( artifact, artifactTarget, reporter, reportOnly, ".md5", ArtifactDigestor.MD5 );
+        
+        verifyDigestFile( artifact, artifactTarget, reporter, reportOnly, ".sha1", ArtifactDigestor.SHA );
+    }
+
+    private void verifyDigestFile( Artifact artifact, File artifactTarget, Reporter reporter, boolean reportOnly,
+                                  String digestExt, String digestAlgorithm )
+        throws ArtifactDigestException, ReportWriteException, IOException
-        File digestSourceFile = new File( artifact.getFile() + ".md5" );
+        File digestSourceFile = new File( artifact.getFile() + digestExt );
-        File digestTargetFile = new File( artifactTarget + ".md5" );
-        
+        File digestTargetFile = new File( artifactTarget + digestExt );
+
-            verified = artifactDigestor.verifyArtifactDigest( artifactTarget, digestTargetFile,
-                                                              ArtifactDigestor.MD5 );
+            verified = artifactDigestor.verifyArtifactDigest( artifactTarget, digestTargetFile, digestAlgorithm );
-                            + "] from source to target.", e );
+                            + "] from source to target for digest algorithm: \'" + digestAlgorithm + "\'.", e );
-                reporter.warn( ".md5 for artifact[" + artifact.getId() + "] in target repository is wrong." );
+                reporter.warn( digestExt + " for artifact[" + artifact.getId() + "] in target repository is wrong." );
-            reporter.warn( ".md5 for artifact[" + artifact.getId() + "] is missing in source repository." );
+            reporter.warn( digestExt + " for artifact[" + artifact.getId() + "] is missing in source repository." );
-                artifactDigestor.createArtifactDigest( artifactTarget, digestTargetFile, ArtifactDigestor.MD5 );
+                artifactDigestor.createArtifactDigest( artifactTarget, digestTargetFile, digestAlgorithm );
