[MNG-4400] [regression] Repository order from settings.xml is not respected during artifact resolution

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@829009 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashSet;
+import java.util.Set;
+    private Set<String> repositoryIds;
+
-        if ( projectBuildingRequest.getRemoteRepositories() == null )
+        this.remoteRepositories = new ArrayList<ArtifactRepository>();
+        if ( projectBuildingRequest.getRemoteRepositories() != null )
-            throw new IllegalArgumentException( "no remote repositories specified" );
+            this.remoteRepositories.addAll( projectBuildingRequest.getRemoteRepositories() );
-        this.remoteRepositories = new ArrayList<ArtifactRepository>( projectBuildingRequest.getRemoteRepositories() );
+
+        this.repositoryIds = new HashSet<String>();
+    private RepositoryModelResolver( RepositoryModelResolver original )
+    {
+        this.repositorySystem = original.repositorySystem;
+        this.resolutionErrorHandler = original.resolutionErrorHandler;
+        this.projectBuildingRequest = original.projectBuildingRequest;
+        this.reactorModelPool = original.reactorModelPool;
+        this.remoteRepositories = new ArrayList<ArtifactRepository>( original.remoteRepositories );
+        this.repositoryIds = new HashSet<String>( original.repositoryIds );
+    }
+
-        return new RepositoryModelResolver( repositorySystem, resolutionErrorHandler, projectBuildingRequest,
-                                            reactorModelPool );
+        return new RepositoryModelResolver( this );
+        if ( !repositoryIds.add( repository.getId() ) )
+        {
+            return;
+        }
+
-            remoteRepositories.add( 0, repo );
+            remoteRepositories.add( repo );
