o Centralized class realm creation

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@799936 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.classrealm.ClassRealmManager;
-import org.codehaus.plexus.MutablePlexusContainer;
-import org.codehaus.plexus.classworlds.ClassWorld;
-import org.codehaus.plexus.classworlds.realm.DuplicateRealmException;
-import org.codehaus.plexus.classworlds.realm.NoSuchRealmException;
+    private ClassRealmManager classRealmManager;
+
+    @Requirement
-        throws PluginManagerException
-        ClassWorld world = ((MutablePlexusContainer) container).getClassWorld();
-
-        String baseRealmId = constructPluginKey( plugin );
-        String realmId = baseRealmId;
-
-        synchronized ( world )
-        {
-            for ( int i = 0; i < 100; i++ )
-            {
-                try
-                {
-                    ClassRealm pluginRealm = world.newRealm( realmId );
-                    pluginRealm.setParentRealm( container.getContainerRealm() );
-
-                    String coreRealmId = container.getContainerRealm().getId();
-                    try
-                    {
-                        pluginRealm.importFrom( coreRealmId, "org.codehaus.plexus.util.xml.Xpp3Dom" );
-                        pluginRealm.importFrom( coreRealmId, "org.codehaus.plexus.util.xml.pull.XmlPullParser" );
-                        pluginRealm.importFrom( coreRealmId, "org.codehaus.plexus.util.xml.pull.XmlPullParserException" );
-                        pluginRealm.importFrom( coreRealmId, "org.codehaus.plexus.util.xml.pull.XmlSerializer" );
-                    }
-                    catch ( NoSuchRealmException e )
-                    {
-                        throw new IllegalStateException( e );
-                    }
-
-                    return pluginRealm;
-                }
-                catch ( DuplicateRealmException e )
-                {
-                    realmId = baseRealmId + "-" + i;
-                }
-            }
-        }
-
-        throw new PluginManagerException( plugin, "Could not create ClassRealm for plugin " + baseRealmId, (Throwable) null );
+        return classRealmManager.createPluginRealm( plugin );
