o Fixed tracking of extension realms in cache

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@819596 13f79535-47bb-0310-9956-ffa450edef68

-    
-                DefaultModelBuildingListener listener = new DefaultModelBuildingListener( projectBuildingHelper, configuration );
+
+                project = new MavenProject( repositorySystem, this, configuration );
+
+                DefaultModelBuildingListener listener =
+                    new DefaultModelBuildingListener( project, projectBuildingHelper, configuration );
-                project = toProject( result, configuration, listener );
+                initProject( project, result );
-        DefaultModelBuildingListener listener = new DefaultModelBuildingListener( projectBuildingHelper, config );
+        MavenProject standaloneProject = new MavenProject( repositorySystem, this, config );
+
+        DefaultModelBuildingListener listener =
+            new DefaultModelBuildingListener( standaloneProject, projectBuildingHelper, config );
-        MavenProject standaloneProject = new MavenProject( result.getEffectiveModel(), repositorySystem, this, config );
+        standaloneProject.setModel( result.getEffectiveModel() );
+        standaloneProject.setOriginalModel( result.getRawModel() );
-        standaloneProject.setRemoteArtifactRepositories( listener.getRemoteRepositories() );
-        standaloneProject.setPluginArtifactRepositories( listener.getPluginRepositories() );
+            MavenProject project = new MavenProject( repositorySystem, this, config );
+
-            DefaultModelBuildingListener listener = new DefaultModelBuildingListener( projectBuildingHelper, config );
+            DefaultModelBuildingListener listener =
+                new DefaultModelBuildingListener( project, projectBuildingHelper, config );
-                MavenProject project = toProject( result, config, interimResult.listener );
+                MavenProject project = interimResult.listener.getProject();
+                initProject( project, result );
-    private MavenProject toProject( ModelBuildingResult result, ProjectBuildingRequest configuration,
-                                    DefaultModelBuildingListener listener )
+    private void initProject( MavenProject project, ModelBuildingResult result )
-        MavenProject project = new MavenProject( model, repositorySystem, this, configuration );
+        project.setModel( model );
+        project.setOriginalModel( result.getRawModel() );
-        project.setOriginalModel( result.getRawModel() );
-
-        project.setRemoteArtifactRepositories( listener.getRemoteRepositories() );
-        project.setPluginArtifactRepositories( listener.getPluginRepositories() );
-
-        project.setClassRealm( listener.getProjectRealm() );
-        project.setExtensionArtifactFilter( listener.getExtentionArtifactFilter() );
-
-
-        return project;
