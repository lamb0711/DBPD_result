[MNG-3018] pluginManagement configurations are not honoured when plugin is silently included

o Added UT

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@804257 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.LinkedHashSet;
-        throws PluginNotFoundException, PluginResolutionException, PluginDescriptorParsingException, CycleDetectedInPluginGraphException, MojoNotFoundException
+        throws PluginNotFoundException, PluginResolutionException, PluginDescriptorParsingException,
+        CycleDetectedInPluginGraphException, MojoNotFoundException
-        return new MavenExecutionPlan( Collections.<MojoExecution>emptyList(), null );
+        return new MavenExecutionPlan( Collections.<MojoExecution> emptyList(), null );
-        return Collections.emptySet();
+        Set<Plugin> plugins;
+
+        // NOTE: The upper-case packaging name is intentional, that's a special hinting mode used for certain tests
+        if ( "JAR".equals( packaging ) )
+        {
+            plugins = new LinkedHashSet<Plugin>();
+
+            plugins.add( newPlugin( "maven-compiler-plugin" ) );
+            plugins.add( newPlugin( "maven-resources-plugin" ) );
+            plugins.add( newPlugin( "maven-surefire-plugin" ) );
+            plugins.add( newPlugin( "maven-jar-plugin" ) );
+            plugins.add( newPlugin( "maven-install-plugin" ) );
+            plugins.add( newPlugin( "maven-deploy-plugin" ) );
+        }
+        else
+        {
+            plugins = Collections.emptySet();
+        }
+
+        return plugins;
+    }
+
+    private Plugin newPlugin( String artifactId )
+    {
+        Plugin plugin = new Plugin();
+
+        plugin.setGroupId( "org.apache.maven.plugins" );
+        plugin.setArtifactId( artifactId );
+
+        return plugin;
