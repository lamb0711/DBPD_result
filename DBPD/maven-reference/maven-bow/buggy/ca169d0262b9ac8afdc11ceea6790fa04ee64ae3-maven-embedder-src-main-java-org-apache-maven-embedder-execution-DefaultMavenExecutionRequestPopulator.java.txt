Refactor management of activated, deactivated, and default-activated profile ids, so the context tracks all of that stuff.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@612186 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.execution.DefaultMavenRealmManager;
+import org.apache.maven.realm.DefaultMavenRealmManager;
+        realmManager( request, configuration );
+
-        realmManager( request, configuration );
-
-        ProfileActivationContext activationContext = new DefaultProfileActivationContext( request.getProperties(), false );
+        ProfileActivationContext activationContext = request.getProfileActivationContext();
+        if ( activationContext == null )
+        {
+            activationContext = new DefaultProfileActivationContext( request.getRealmManager(),
+                                                                     request.getProperties(), false );
+        }
+
+        activationContext.setExplicitlyActiveProfileIds( request.getActiveProfiles() );
+        activationContext.setExplicitlyInactiveProfileIds( request.getInactiveProfiles() );
+
-        globalProfileManager.explicitlyActivate( request.getActiveProfiles() );
-
-        globalProfileManager.explicitlyDeactivate( request.getInactiveProfiles() );
-
+        request.setProfileActivationContext( activationContext );
