add a command line parser


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@344954 13f79535-47bb-0310-9956-ffa450edef68

-import org.codehaus.plexus.util.Os;
+import org.apache.maven.bootstrap.util.SimpleArgumentParser;
+import org.codehaus.plexus.util.Os;
-import java.io.FileInputStream;
-import java.util.zip.ZipInputStream;
-    public BootstrapInstaller( String[] args )
+    private final String prefix;
+
+    public BootstrapInstaller( SimpleArgumentParser parser )
-        this.bootstrapper = new Bootstrap( args );
+        this.bootstrapper = new Bootstrap( parser );
+
+        this.prefix = parser.getArgumentValue( "--prefix" );
-        BootstrapInstaller bootstrap = new BootstrapInstaller( args );
+        SimpleArgumentParser parser = Bootstrap.createDefaultParser();
+        parser.addArgument( "--prefix", "The location to install Maven", true, getDefaultPrefix() );
+
+        parser.parseCommandLineArguments( args );
+
+        BootstrapInstaller bootstrap = new BootstrapInstaller( parser );
+    private static String getDefaultPrefix()
+    {
+        String value;
+        if ( Os.isFamily( "windows" ) )
+        {
+            value = "c:\\program files";
+        }
+        else
+        {
+            value = "/usr/local";
+        }
+        return value;
+    }
+
-        // TODO: use parameters instead, and use --prefix
-        String mavenHome = System.getProperty( "maven.home" );
-        if ( mavenHome == null )
-        {
-            throw new Exception( "maven.home system property is required" );
-        }
-
-        File file = new File( mavenCoreDir, "target/maven-" + mavenCoreModel.getVersion() + "-bin.zip" );
+        String finalName = "maven-" + mavenCoreModel.getVersion();
+        File file = new File( mavenCoreDir, "target/" + finalName + "-bin.zip" );
+
+        File mavenHome = new File( prefix, finalName );
+
+        System.out.println( "Installing Maven in " + mavenHome );
-        File prefix = new File( mavenHome ).getParentFile();
-        expand.setDest( prefix );
+        expand.setDest( new File( prefix ) );
-        fixScriptPermissions( new File( prefix, "maven-" + mavenCoreModel.getVersion() + "/bin" ) );
+        if ( !mavenHome.exists() )
+        {
+            throw new Exception( "Maven was not installed in " + mavenHome );
+        }
+
+        fixScriptPermissions( new File( mavenHome, "bin" ) );
