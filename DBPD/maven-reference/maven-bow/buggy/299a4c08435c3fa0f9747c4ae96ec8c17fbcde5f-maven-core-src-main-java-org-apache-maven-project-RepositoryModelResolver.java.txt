[MNG-4052] import scope dependencies prefer to download pom rather than find it in the current project

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@798221 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.File;
- * Implements a model resolver backed by the Maven Repository API.
+ * Implements a model resolver backed by the Maven Repository API and the reactor.
+    private ReactorModelPool reactorModelPool;
+
-                                    ArtifactRepository localRepository, List<ArtifactRepository> remoteRepositories )
+                                    ArtifactRepository localRepository, List<ArtifactRepository> remoteRepositories,
+                                    ReactorModelPool reactorModelPool )
+
+        this.reactorModelPool = reactorModelPool;
-                                            remoteRepositories );
+                                            remoteRepositories, reactorModelPool );
-        Artifact artifactParent = repositorySystem.createProjectArtifact( groupId, artifactId, version );
+        File pomFile = null;
-        ArtifactResolutionRequest request = new ArtifactResolutionRequest();
-        request.setArtifact( artifactParent );
-        request.setLocalRepository( localRepository );
-        request.setRemoteRepostories( remoteRepositories );
-        // FIXME setTransferListener
-        ArtifactResolutionResult result = repositorySystem.resolve( request );
-
-        try
+        if ( reactorModelPool != null )
-            resolutionErrorHandler.throwErrors( request, result );
-        }
-        catch ( ArtifactResolutionException e )
-        {
-            throw new UnresolvableModelException( "Failed to resolve POM for " + groupId + ":" + artifactId + ":"
-                + version + " due to " + e.getMessage(), groupId, artifactId, version, e );
+            pomFile = reactorModelPool.get( groupId, artifactId, version );
-        return new FileModelSource( artifactParent.getFile() );
+        if ( pomFile == null )
+        {
+            Artifact artifactParent = repositorySystem.createProjectArtifact( groupId, artifactId, version );
+
+            ArtifactResolutionRequest request = new ArtifactResolutionRequest();
+            request.setArtifact( artifactParent );
+            request.setLocalRepository( localRepository );
+            request.setRemoteRepostories( remoteRepositories );
+            // FIXME setTransferListener
+            ArtifactResolutionResult result = repositorySystem.resolve( request );
+
+            try
+            {
+                resolutionErrorHandler.throwErrors( request, result );
+            }
+            catch ( ArtifactResolutionException e )
+            {
+                throw new UnresolvableModelException( "Failed to resolve POM for " + groupId + ":" + artifactId + ":"
+                    + version + " due to " + e.getMessage(), groupId, artifactId, version, e );
+            }
+
+            pomFile = artifactParent.getFile();
+        }
+
+        return new FileModelSource( pomFile );
