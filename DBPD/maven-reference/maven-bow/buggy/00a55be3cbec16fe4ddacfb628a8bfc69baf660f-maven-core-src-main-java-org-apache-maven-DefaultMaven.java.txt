bring back the reactor (instantiation still needs work - see comments)


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163414 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.execution.MavenProjectExecutionRequest;
-import org.codehaus.plexus.util.FileUtils;
-        MavenExecutionResponse response = new MavenExecutionResponse();
-
-        handleProject( request );
-
-        return response;
+        // TODO: not happy about this:
+        if ( request instanceof MavenReactorExecutionRequest )
+        {
+            return handleReactor( (MavenReactorExecutionRequest) request );
+        }
+        else
+        {
+            return handleProject( request );
+        }
-    public void handleProject( MavenExecutionRequest request )
+    public MavenExecutionResponse handleProject( MavenExecutionRequest request )
+        // TODO: is this perhaps more appropriate in the CLI?
+                // TODO: this should be a "FATAL" exception, reported to the developers - however currently a LOT of
+                // "user" errors fall through the cracks (like invalid POMs, as one example)
+        return response;
-    public void handleReactor( MavenExecutionRequest request, MavenExecutionResponse response )
-        throws Exception
+    public MavenExecutionResponse handleReactor( MavenReactorExecutionRequest request )
+        throws ReactorException
-            List files = FileUtils.getFiles( new File( System.getProperty( "user.dir" ) ),
-                                             ( (MavenReactorExecutionRequest) request ).getIncludes(),
-                                             ( (MavenReactorExecutionRequest) request ).getExcludes() );
+            List files = request.getProjectFiles();
-            //MavenProjectExecutionRequest projectExecutionRequest = request.createProjectExecutionRequest( project );
+            MavenProjectExecutionRequest projectExecutionRequest = request.createProjectExecutionRequest( project );
-            //handleProject( projectExecutionRequest, response );
-
-            if ( response.isExecutionFailure() )
+            try
-                break;
+                MavenExecutionResponse response = handleProject( projectExecutionRequest );
+
+                if ( response.isExecutionFailure() )
+                {
+                    return response;
+                }
+            catch ( Exception e )
+            {
+                throw new ReactorException( "Error executing project within the reactor", e );
+            }
+
+
+        // TODO: not really satisfactory
+        return null;
