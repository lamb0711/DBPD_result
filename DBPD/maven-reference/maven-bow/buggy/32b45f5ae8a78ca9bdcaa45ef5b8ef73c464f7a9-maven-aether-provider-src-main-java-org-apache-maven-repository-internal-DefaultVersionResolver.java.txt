[MNG-4891] Improve robustness of snapshot dependency resolution in case a remote repo accidently uses the id "local"

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1032964 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.IOException;
+import org.sonatype.aether.repository.LocalRepository;
+
+                /*
+                 * NOTE: Users occasionally misuse the id "local" for remote repos which screws up the metadata of the
+                 * local repository. This is especially troublesome during snapshot resolution so we try to handle that
+                 * gracefully.
+                 */
+                if ( versioning != null && repository instanceof LocalRepository )
+                {
+                    if ( !versioning.getSnapshotVersions().isEmpty()
+                        || ( versioning.getSnapshot() != null && versioning.getSnapshot().getBuildNumber() > 0 ) )
+                    {
+                        Versioning repaired = new Versioning();
+                        repaired.setLastUpdated( versioning.getLastUpdated() );
+                        Snapshot snapshot = new Snapshot();
+                        snapshot.setLocalCopy( true );
+                        repaired.setSnapshot( snapshot );
+                        versioning = repaired;
+
+                        throw new IOException( "Snapshot information corrupted with remote repository data"
+                            + ", please verify that no remote repository uses the id '" + repository.getId() + "'" );
+                    }
+                }
