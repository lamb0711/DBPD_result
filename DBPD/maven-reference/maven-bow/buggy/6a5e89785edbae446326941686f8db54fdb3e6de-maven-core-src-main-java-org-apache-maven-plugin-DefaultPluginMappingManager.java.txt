PR: MNG-639
Separate local metadata by repository to ensure it remains consistent

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@267466 13f79535-47bb-0310-9956-ffa450edef68

-        // TODO: aggregate the results of this instead
+        // TODO: can this go directly into the manager?
+        for ( Iterator i = pluginRepositories.iterator(); i.hasNext(); )
+        {
+            ArtifactRepository repository = (ArtifactRepository) i.next();
+
+            loadRepositoryPluginMappings( metadata, repository, localRepository );
+        }
+        loadRepositoryPluginMappings( metadata, localRepository, localRepository );
+    }
+
+    private void loadRepositoryPluginMappings( GroupRepositoryMetadata metadata, ArtifactRepository remoteRepository,
+                                               ArtifactRepository localRepository )
+        throws ArtifactMetadataRetrievalException
+    {
-                                      localRepository.pathOfArtifactMetadata( metadata ) );
+                                      localRepository.pathOfLocalRepositoryMetadata( metadata, remoteRepository ) );
-                    plugin.setGroupId( groupId );
+                    plugin.setGroupId( metadata.getGroupId() );
