configure phases based on configuration


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163422 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.Plugin;
+import org.apache.maven.plugin.descriptor.PluginDescriptor;
+import org.apache.maven.project.MavenProject;
-            preProcessPlugins( tasks, session );
+            processPluginConfiguration( session.getProject(), session );
+
+            processGoalChain( tasks, session );
-    private void preProcessPlugins( List tasks, MavenSession session )
+    private void processPluginConfiguration( MavenProject project, MavenSession mavenSession )
+        throws Exception
+    {
+        for ( Iterator i = project.getPlugins().iterator(); i.hasNext(); )
+        {
+            Plugin plugin = (Plugin) i.next();
+
+            if ( pluginManager.verifyPlugin( plugin.getId(), mavenSession ) )
+            {
+                PluginDescriptor pluginDescriptor = pluginManager.getPluginDescriptor( plugin.getId() );
+                for ( Iterator j = pluginDescriptor.getMojos().iterator(); j.hasNext(); )
+                {
+                    MojoDescriptor mojoDescriptor = (MojoDescriptor) j.next();
+
+                    if ( mojoDescriptor.getPhase() != null )
+                    {
+                        Phase phase = (Phase) phaseMap.get( mojoDescriptor.getPhase() );
+                        phase.getGoals().add( mojoDescriptor.getId() );
+                    }
+                }
+            }
+        }
+    }
+
+    private void processGoalChain( List tasks, MavenSession session )
-            PluginExecutionResponse pluginResponse;
-
