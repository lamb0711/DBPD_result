PR: MNG-950
use active project artifacts for extensions and plugin dependencies

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@307245 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.project.artifact.ActiveProjectArtifact;
-        // TODO: share with MMS? Not sure if it belongs here
-        if ( project.getProjectReferences() != null && !project.getProjectReferences().isEmpty() )
-        {
-            // TODO: use MavenProject getProjectReferenceId
-            String refId = plugin.getGroupId() + ":" + plugin.getArtifactId();
-            MavenProject ref = (MavenProject) project.getProjectReferences().get( refId );
-            if ( ref != null && ref.getArtifact() != null )
-            {
-                // TODO: if not matching, we should get the correct artifact from that project (attached)
-                if ( ref.getArtifact().getDependencyConflictId().equals( pluginArtifact.getDependencyConflictId() ) )
-                {
-                    // if the project artifact doesn't exist, don't use it. We haven't built that far.
-                    if ( ref.getArtifact().getFile() != null && ref.getArtifact().getFile().exists() )
-                    {
-                        pluginArtifact = new ActiveProjectArtifact( ref, pluginArtifact );
-                    }
-                    else
-                    {
-                        getLogger().warn( "Plugin found in the reactor has not been built when it's use was attempted" +
-                            " - resolving from the repository instead" );
-                    }
-                }
-            }
-        }
+        pluginArtifact = project.replaceWithActiveArtifact( pluginArtifact );
-                                                                 project.getProjectReferences() );
+                                                                 project );
+                        artifact = project.replaceWithActiveArtifact( artifact );
+
