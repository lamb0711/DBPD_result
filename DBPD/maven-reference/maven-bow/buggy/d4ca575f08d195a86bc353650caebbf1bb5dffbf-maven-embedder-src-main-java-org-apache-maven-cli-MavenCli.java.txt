o Added new settings builder that uses request/result pattern to allow for better problem reporting

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@824172 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.settings.MavenSettingsBuilder;
+import org.apache.maven.settings.building.DefaultSettingsBuildingRequest;
+import org.apache.maven.settings.building.SettingsBuilder;
+import org.apache.maven.settings.building.SettingsBuildingException;
+import org.apache.maven.settings.building.SettingsBuildingRequest;
+import org.apache.maven.settings.building.SettingsBuildingResult;
+import org.apache.maven.settings.building.SettingsProblem;
-            MavenSettingsBuilder settingsBuilder = container.lookup( MavenSettingsBuilder.class );
+            SettingsBuildingRequest settingsRequest = new DefaultSettingsBuildingRequest();
+            settingsRequest.setGlobalSettingsFile( configuration.getGlobalSettingsFile() );
+            settingsRequest.setUserSettingsFile( configuration.getUserSettingsFile() );
+            settingsRequest.setSystemProperties( request.getSystemProperties() );
+            settingsRequest.setUserProperties( request.getUserProperties() );
+
+            SettingsBuilder settingsBuilder = container.lookup( SettingsBuilder.class );
-                settings = settingsBuilder.buildSettings( request );
+                SettingsBuildingResult settingsResult = settingsBuilder.build( settingsRequest );
+
+                settings = settingsResult.getEffectiveSettings();
+
+                if ( !settingsResult.getProblems().isEmpty() && logger.isWarnEnabled() )
+                {
+                    logger.warn( "" );
+                    logger.warn( "Some problems were encountered while building the effective settings" );
+
+                    for ( SettingsProblem problem : settingsResult.getProblems() )
+                    {
+                        logger.warn( problem.getMessage() + " @ " + problem.getLocation() );
+                    }
+
+                    logger.warn( "" );
+                }
-        catch ( IOException e )
+        catch ( SettingsBuildingException e )
-        catch ( XmlPullParserException e )
-        {
-            CLIReportingUtils.showError( logger, "Failed to parse settings: ", e, showErrors );
-
-            return 1;
-        }
