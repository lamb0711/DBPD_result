PR: MNG-613
deploy snapshot information to the correct directory and fix some other minor issues

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@278930 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.repository.metadata.Snapshot;
+import org.apache.maven.artifact.repository.metadata.SnapshotArtifactRepositoryMetadata;
-        ArtifactMetadata metadata = new ArtifactRepositoryMetadata( artifact );
+        ArtifactMetadata metadata = null;
+        if ( artifact.isSnapshot() )
+        {
+            metadata = new ArtifactRepositoryMetadata( artifact );
+        }
+        else
+        {
+            metadata = new SnapshotArtifactRepositoryMetadata( artifact );
+        }
-        ArtifactRepositoryMetadata localMetadata = null;
+        ArtifactMetadata localMetadata = null;
-        ArtifactRepositoryMetadata m = loadVersioningInformation( metadata, localRepository, localRepository,
-                                                                  artifact );
+        ArtifactMetadata m = loadVersioningInformation( metadata, localRepository, localRepository, artifact );
-    protected Snapshot resolveLatestSnapshotVersion( Artifact artifact, ArtifactRepository localRepository,
-                                                     ArtifactRepository remoteRepository )
+    protected int resolveLatestSnapshotBuildNumber( Artifact artifact, ArtifactRepository localRepository,
+                                                    ArtifactRepository remoteRepository )
-        ArtifactMetadata metadata = new ArtifactRepositoryMetadata( artifact );
+        ArtifactMetadata metadata = new SnapshotArtifactRepositoryMetadata( artifact );
+        getLogger().info( "Retrieving previous build number from " + remoteRepository.getId() );
-        ArtifactRepositoryMetadata m = loadVersioningInformation( metadata, remoteRepository, localRepository,
-                                                                  artifact );
-        Snapshot snapshot;
+        ArtifactMetadata m = loadVersioningInformation( metadata, remoteRepository, localRepository, artifact );
+        int buildNumber = 0;
-            snapshot = new Snapshot();
-
-                snapshot.setTimestamp( snapshotMetadata.getTimestamp() );
-                snapshot.setBuildNumber( snapshotMetadata.getBuildNumber() );
+                buildNumber = snapshotMetadata.getBuildNumber();
-            snapshot = m.getSnapshot();
+            buildNumber = m.getBuildNumber();
-        return snapshot;
+        return buildNumber;
-    protected abstract String constructVersion( ArtifactRepositoryMetadata metadata );
+    protected abstract String constructVersion( ArtifactMetadata metadata );
-    private ArtifactRepositoryMetadata loadVersioningInformation( ArtifactMetadata repoMetadata,
-                                                                  ArtifactRepository remoteRepository,
-                                                                  ArtifactRepository localRepository,
-                                                                  Artifact artifact )
+    private ArtifactMetadata loadVersioningInformation( ArtifactMetadata repoMetadata,
+                                                        ArtifactRepository remoteRepository,
+                                                        ArtifactRepository localRepository, Artifact artifact )
-        ArtifactRepositoryMetadata newMetadata = null;
+        ArtifactMetadata newMetadata = null;
-                newMetadata = new ArtifactRepositoryMetadata( artifact, metadata.getVersioning() );
+                if ( artifact.isSnapshot() )
+                {
+                    if ( metadata.getVersioning().getSnapshot() != null )
+                    {
+                        newMetadata = new SnapshotArtifactRepositoryMetadata( artifact,
+                                                                              metadata.getVersioning().getSnapshot() );
+                    }
+                }
+                else
+                {
+                    newMetadata = new ArtifactRepositoryMetadata( artifact, metadata.getVersioning() );
+                }
