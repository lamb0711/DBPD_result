o Collected repo settings in request

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@810174 13f79535-47bb-0310-9956-ffa450edef68

-        List<org.apache.maven.settings.Profile> settingsProfiles = settings.getProfiles();
-
+        List<org.apache.maven.settings.Profile> settingsProfiles = settings.getProfiles();
+
-        Proxy proxy = settings.getActiveProxy();
+        Proxy activeProxy = settings.getActiveProxy();
-        if ( proxy != null )
+        if ( activeProxy != null )
-            if ( proxy.getHost() == null )
+            if ( activeProxy.getHost() == null )
+            String password = decrypt( activeProxy.getPassword(), "password for proxy " + activeProxy.getId() );
+
+            repositorySystem.addProxy( activeProxy.getProtocol(), activeProxy.getHost(), activeProxy.getPort(),
+                                       activeProxy.getUsername(), password, activeProxy.getNonProxyHosts() );
+        }
+
+        for ( Proxy proxy : settings.getProxies() )
+        {
+            proxy = proxy.clone();
+
-            repositorySystem.addProxy( proxy.getProtocol(), proxy.getHost(), proxy.getPort(), proxy.getUsername(),
-                                       password, proxy.getNonProxyHosts() );
+            proxy.setPassword( password );
+
+            request.addProxy( proxy );
+            server = server.clone();
+
+            server.setPassword( password );
+
+            request.addServer( server );
+
+            mirror = mirror.clone();
+
+            request.addMirror( mirror );
+
-                request.setSettings( new SettingsAdapter( request, settings ) );
+                request.setSettings( settings );
-                request.setSettings( new SettingsAdapter( request, new Settings() ) );
+                request.setSettings( new Settings() );
