o pull from trunky dunk dunk


git-svn-id: https://svn.apache.org/repos/asf/maven/components/branches/MNG-2766@767707 13f79535-47bb-0310-9956-ffa450edef68

-        setRemoteArtifactRepositories( projectBuilderConfiguration.getRemoteRepositories() );       
+        setRemoteArtifactRepositories( (projectBuilderConfiguration.getRemoteRepositories() != null) ? new ArrayList<ArtifactRepository>(projectBuilderConfiguration.getRemoteRepositories()) : new ArrayList<ArtifactRepository>());
+ 
+        for(Repository r: model.getPluginRepositories())
+		{
+			try {
+				remoteArtifactRepositories.add(repositorySystem.buildArtifactRepository( r ));
+			} catch (InvalidRepositoryException e) {
+
+			}
+		}   
+        for(Repository r: model.getPluginRepositories())
+		{
+			try {
+				remoteArtifactRepositories.add(repositorySystem.buildArtifactRepository( r ));
+			} catch (InvalidRepositoryException e) {
+
+			}
+		}        
+            /*
+             * TODO: This is suboptimal. Without a cache in the project builder, rebuilding the parent chain currently
+             * causes O(n^2) parser invocations for an inheritance hierarchy of depth n.
+             */
-        return remoteArtifactRepositories;
+        return new ArrayList<ArtifactRepository>( remoteArtifactRepositories );
-
+    
-    public void addCompileSourceRoot( String path )
+    private void addPath( List<String> paths, String path )
-            if ( path.length() != 0 )
+            if ( path.length() > 0 )
-                if ( !getCompileSourceRoots().contains( path ) )
+                File file = new File( path );
+                if ( file.isAbsolute() )
-                    getCompileSourceRoots().add( path );
+                    path = file.getAbsolutePath();
+                }
+                else
+                {
+                    path = new File( getBasedir(), path ).getAbsolutePath();
+                }
+
+                if ( !paths.contains( path ) )
+                {
+                    paths.add( path );
+    public void addCompileSourceRoot( String path )
+    {
+        addPath( getCompileSourceRoots(), path );
+    }
+
-        if ( path != null )
-        {
-            path = path.trim();
-            if ( path.length() != 0 )
-            {
-                if ( !getTestCompileSourceRoots().contains( path ) )
-                {
-                    getTestCompileSourceRoots().add( path );
-                }
-            }
-        }
+        addPath( getTestCompileSourceRoots(), path );
