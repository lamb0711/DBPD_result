deploy/install POMs as a type of metadata so they are done atomically


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163687 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.metadata.ArtifactMetadata;
+import org.apache.maven.artifact.metadata.ModelMetadata;
-        Artifact pomArtifact = new DefaultArtifact( project.getGroupId(), project.getArtifactId(),
-                                                    project.getVersion(), "pom" );
-
-        File pom = new File( project.getFile().getParentFile(), "pom.xml" );
+        Artifact artifact = new DefaultArtifact( project.getGroupId(), project.getArtifactId(), project.getVersion(),
+                                                 project.getPackaging() );
+        if ( !"pom".equals( project.getPackaging() ) )
+        {
+            File pom = new File( project.getFile().getParentFile(), "pom.xml" );
+            ArtifactMetadata metadata = new ModelMetadata( artifact, pom );
+            artifact.addMetadata( metadata );
+        }
-            deployer.deploy( pom, pomArtifact, deploymentRepository, localRepository );
-
-            //Deploy artifact
-            if ( !"pom".equals( project.getPackaging() ) )
-            {
-                Artifact artifact = new DefaultArtifact( project.getGroupId(), project.getArtifactId(),
-                                                         project.getVersion(), project.getPackaging() );
-
-                deployer.deploy( project.getBuild().getDirectory(), artifact, deploymentRepository, localRepository );
-            }
+            deployer.deploy( project.getBuild().getDirectory(), artifact, deploymentRepository, localRepository );
