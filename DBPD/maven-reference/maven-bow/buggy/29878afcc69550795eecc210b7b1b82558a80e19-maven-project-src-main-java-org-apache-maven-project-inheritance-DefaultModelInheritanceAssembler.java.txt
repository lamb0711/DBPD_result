o pom-level profiles are working now

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@189464 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.BuildBase;
+import org.apache.maven.model.ModelBase;
+import org.apache.maven.model.Profile;
+        // cannot inherit from null parent.
+        if ( parent == null )
+        {
+            return;
+        }
+        
-            
+
-        assembleBuildInheritance( child, parent );
+        assembleBuildInheritance( child, parent.getBuild() );
+        assembleModelBaseInheritance( child, parent );
+    }
+
+    public void mergeProfileWithModel( Model model, Profile profile )
+    {
+        assembleModelBaseInheritance( model, profile );
+
+        Build modelBuild = model.getBuild();
+
+        BuildBase profileBuild = profile.getBuild();
+
+        assembleBuildBaseInheritance( modelBuild, profileBuild );
+    }
+
+    private void assembleModelBaseInheritance( ModelBase child, ModelBase parent )
+    {
-        
+
-    
-    private void assembleDependencyManagementInheritance( Model child, Model parent )
+
+    private void assembleDependencyManagementInheritance( ModelBase child, ModelBase parent )
-    private void assembleBuildInheritance( Model child, Model parent )
+    private void assembleBuildInheritance( Model child, Build parentBuild )
+        // cannot inherit from null parent...
+        if ( parentBuild == null )
+        {
+            return;
+        }
+        
-        Build parentBuild = parent.getBuild();
-            if ( childBuild.getDefaultGoal() == null )
-            {
-                childBuild.setDefaultGoal( parentBuild.getDefaultGoal() );
-            }
-
-            if ( childBuild.getFinalName() == null )
-            {
-                childBuild.setFinalName( parentBuild.getFinalName() );
-            }
+            assembleBuildBaseInheritance( childBuild, parentBuild );
+        }
+    }
-            List resources = childBuild.getResources();
-            if ( resources == null || resources.isEmpty() )
-            {
-                childBuild.setResources( parentBuild.getResources() );
-            }
+    private void assembleBuildBaseInheritance( BuildBase childBuild, BuildBase parentBuild )
+    {
+        // if the parent build is null, obviously we cannot inherit from it...
+        if ( parentBuild == null )
+        {
+            return;
+        }
-            resources = childBuild.getTestResources();
-            if ( resources == null || resources.isEmpty() )
-            {
-                childBuild.setTestResources( parentBuild.getTestResources() );
-            }
+        if ( childBuild.getDefaultGoal() == null )
+        {
+            childBuild.setDefaultGoal( parentBuild.getDefaultGoal() );
+        }
-            // Plugins are aggregated if Plugin.inherit != false
-            ModelUtils.mergePluginLists( childBuild, parentBuild, true );
-            
-            // Plugin management :: aggregate
-            if( childBuild != null && parentBuild != null )
-            {
-                ModelUtils.mergePluginLists( childBuild.getPluginManagement(), parentBuild.getPluginManagement(), false );
-            }
+        if ( childBuild.getFinalName() == null )
+        {
+            childBuild.setFinalName( parentBuild.getFinalName() );
+        }
+
+        List resources = childBuild.getResources();
+        if ( resources == null || resources.isEmpty() )
+        {
+            childBuild.setResources( parentBuild.getResources() );
+        }
+
+        resources = childBuild.getTestResources();
+        if ( resources == null || resources.isEmpty() )
+        {
+            childBuild.setTestResources( parentBuild.getTestResources() );
+        }
+
+        // Plugins are aggregated if Plugin.inherit != false
+        ModelUtils.mergePluginLists( childBuild, parentBuild, true );
+
+        // Plugin management :: aggregate
+        if ( childBuild != null && parentBuild != null )
+        {
+            ModelUtils.mergePluginLists( childBuild.getPluginManagement(), parentBuild.getPluginManagement(), false );
-            if ( StringUtils.isEmpty( childScm.getDeveloperConnection() ) &&
-                !StringUtils.isEmpty( parentScm.getDeveloperConnection() ) )
+            if ( StringUtils.isEmpty( childScm.getDeveloperConnection() )
+                && !StringUtils.isEmpty( parentScm.getDeveloperConnection() ) )
-                childScm.setDeveloperConnection( appendPath( parentScm.getDeveloperConnection(), child.getArtifactId() ) );
+                childScm
+                    .setDeveloperConnection( appendPath( parentScm.getDeveloperConnection(), child.getArtifactId() ) );
