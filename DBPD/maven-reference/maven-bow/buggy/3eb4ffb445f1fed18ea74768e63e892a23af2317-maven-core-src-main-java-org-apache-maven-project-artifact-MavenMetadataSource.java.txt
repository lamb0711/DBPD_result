[MNG-4180] [regression] Dependency exclusions are applied globally

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@784296 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Arrays;
+import org.apache.maven.artifact.resolver.filter.AndArtifactFilter;
+import org.apache.maven.artifact.resolver.filter.ExcludesArtifactFilter;
+import org.apache.maven.model.Exclusion;
+            ArtifactFilter dependencyFilter = artifact.getDependencyFilter();
+
-                    dependencyArtifact.setOptional( d.isOptional() );
-
-                    if ( Artifact.SCOPE_SYSTEM.equals( effectiveScope ) )
+                    if ( dependencyFilter == null || dependencyFilter.include( dependencyArtifact ) )
-                        dependencyArtifact.setFile( new File( d.getSystemPath() ) );
-                    }                    
-                    
-                    artifacts.add( dependencyArtifact );
+                        dependencyArtifact.setOptional( d.isOptional() );
+
+                        if ( Artifact.SCOPE_SYSTEM.equals( effectiveScope ) )
+                        {
+                            dependencyArtifact.setFile( new File( d.getSystemPath() ) );
+                        }
+
+                        if ( !d.getExclusions().isEmpty() )
+                        {
+                            List<String> exclusions = new ArrayList<String>();
+
+                            for ( Exclusion e : d.getExclusions() )
+                            {
+                                exclusions.add( e.getGroupId() + ":" + e.getArtifactId() );
+                            }
+
+                            ArtifactFilter newFilter = new ExcludesArtifactFilter( exclusions );
+                            if ( dependencyFilter != null )
+                            {
+                                newFilter = new AndArtifactFilter( Arrays.asList( dependencyFilter, newFilter ) );
+                            }
+                            dependencyArtifact.setDependencyFilter( newFilter );
+                        }
+
+                        artifacts.add( dependencyArtifact );
+                    }
