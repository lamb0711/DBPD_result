[MNG-4842] [regression] Repositories discovered in dependency POMs override repositories configured for original resolution request of POM

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1002852 13f79535-47bb-0310-9956-ffa450edef68

-class ReactorModelResolver
+class ProjectModelResolver
-    private final List<RemoteRepository> defaultRepositories;
+    private final List<RemoteRepository> externalRepositories;
-    public ReactorModelResolver( RepositorySystemSession session, ArtifactResolver resolver,
+    private final ProjectBuildingRequest.RepositoryMerging repositoryMerging;
+
+    public ProjectModelResolver( RepositorySystemSession session, ArtifactResolver resolver,
-                                 ReactorModelPool modelPool )
+                                 ProjectBuildingRequest.RepositoryMerging repositoryMerging, ReactorModelPool modelPool )
-        this.defaultRepositories = repositories;
+        this.externalRepositories = repositories;
+        this.repositoryMerging = repositoryMerging;
-    private ReactorModelResolver( ReactorModelResolver original )
+    private ProjectModelResolver( ProjectModelResolver original )
-        this.defaultRepositories = original.defaultRepositories;
+        this.externalRepositories = original.externalRepositories;
+        this.repositoryMerging = original.repositoryMerging;
-        pomRepositories =
-            remoteRepositoryManager.aggregateRepositories( session, pomRepositories, newRepositories, true );
-        repositories =
-            remoteRepositoryManager.aggregateRepositories( session, pomRepositories, defaultRepositories, false );
+        if ( ProjectBuildingRequest.RepositoryMerging.REQUEST_DOMINANT.equals( repositoryMerging ) )
+        {
+            repositories = remoteRepositoryManager.aggregateRepositories( session, repositories, newRepositories, true );
+        }
+        else
+        {
+            pomRepositories =
+                remoteRepositoryManager.aggregateRepositories( session, pomRepositories, newRepositories, true );
+            repositories =
+                remoteRepositoryManager.aggregateRepositories( session, pomRepositories, externalRepositories, false );
+        }
-        return new ReactorModelResolver( this );
+        return new ProjectModelResolver( this );
