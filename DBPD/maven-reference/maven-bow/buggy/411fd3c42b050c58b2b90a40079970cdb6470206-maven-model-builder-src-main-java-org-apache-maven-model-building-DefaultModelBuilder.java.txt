o Improved handling of circular parents

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@885106 13f79535-47bb-0310-9956-ffa450edef68

-    private ModelBuildingResult build( ModelBuildingRequest request, Collection<String> imports )
+    private ModelBuildingResult build( ModelBuildingRequest request, Collection<String> importIds )
+        Collection<String> parentIds = new LinkedHashSet<String>();
+        parentIds.add( ModelProblemUtils.toId( inputModel ) );
+
+            else if ( !parentIds.add( currentData.getId() ) )
+            {
+                String message = "The parents form a cycle: ";
+                for ( String modelId : parentIds )
+                {
+                    message += modelId + " -> ";
+                }
+                message += currentData.getId();
+
+                problems.add( ModelProblem.Severity.FATAL, message, null );
+                throw new ModelBuildingException( problems.getRootModelId(), problems.getProblems() );
+            }
-                                             DefaultModelProblemCollector problems, Collection<String> imports )
+                                             DefaultModelProblemCollector problems, Collection<String> importIds )
-        imports.add( importing );
+        importIds.add( importing );
-            if ( imports.contains( imported ) )
+            if ( importIds.contains( imported ) )
-                for ( String modelId : imports )
+                for ( String modelId : importIds )
-                    importResult = build( importRequest, imports );
+                    importResult = build( importRequest, importIds );
-        imports.remove( importing );
+        importIds.remove( importing );
