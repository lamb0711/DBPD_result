PR: MNG-257
- hook up the source:jar goal to packaging, but only execute for non-SNAPSHOT builds
- allow comma-delimited list of goals in phase definitions
- only register necessary phases for the goals given


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@191111 13f79535-47bb-0310-9956-ffa450edef68

+     * @parameter expression="${project.version}"
+     * @readonly
+     * @required
+     */
+    private String version;
+
+    /**
-     * @parameter expression="${project.build.output}"
+     * @parameter expression="${project.build.outputDirectory}"
-        // TODO: use a component lookup?
-        JarArchiver archiver = new JarArchiver();
-
-        SourceBundler sourceBundler = new SourceBundler();
-
-        File outputFile = new File( outputDirectory, finalName + "-sources.jar" );
-
-        File[] sourceDirectories = new File[compileSourceRoots.size()];
-        int count = 0;
-        for ( Iterator i = compileSourceRoots.iterator(); i.hasNext(); count++ )
+        // TODO: this should be via a release profile instead
+        if ( version.indexOf( "SNAPSHOT" ) < 0 )
-            sourceDirectories[count] = new File( (String) i.next() );
+            // TODO: use a component lookup?
+            JarArchiver archiver = new JarArchiver();
+
+            SourceBundler sourceBundler = new SourceBundler();
+
+            File outputFile = new File( outputDirectory, finalName + "-sources.jar" );
+
+            File[] sourceDirectories = new File[compileSourceRoots.size()];
+            int count = 0;
+            for ( Iterator i = compileSourceRoots.iterator(); i.hasNext(); count++ )
+            {
+                sourceDirectories[count] = new File( (String) i.next() );
+            }
+
+            try
+            {
+                sourceBundler.makeSourceBundle( outputFile, sourceDirectories, archiver );
+            }
+            catch ( Exception e )
+            {
+                throw new MojoExecutionException( "Error building source JAR", e );
+            }
-
-        try
+        else
-            sourceBundler.makeSourceBundle( outputFile, sourceDirectories, archiver );
-        }
-        catch ( Exception e )
-        {
-            throw new MojoExecutionException( "Error building source JAR", e );
+            getLog().info( "Not producing source bundle for a SNAPSHOT build" );
