Refactor management of activated, deactivated, and default-activated profile ids, so the context tracks all of that stuff.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@612186 13f79535-47bb-0310-9956-ffa450edef68

-                                        List explicitlyActiveIds,
-                                        List explicitlyInactiveIds,
-                                                             explicitlyActiveIds,
-                                                             explicitlyInactiveIds,
-                                                List explicitlyActiveIds,
-                                                List explicitlyInactiveIds,
-        profileManager.explicitlyActivate( explicitlyActiveIds );
-
-        profileManager.explicitlyDeactivate( explicitlyInactiveIds );
-
-
-                for ( Iterator repoIterator = externalProfile.getRepositories().iterator(); repoIterator.hasNext(); )
+                if ( externalProfile.getRepositories() != null )
-                    Repository mavenRepo = (Repository) repoIterator.next();
-
-                    ArtifactRepository artifactRepo;
-                    try
+                    for ( Iterator repoIterator = externalProfile.getRepositories().iterator(); repoIterator.hasNext(); )
-                        artifactRepo = mavenTools.buildArtifactRepository( mavenRepo );
-                    }
-                    catch ( InvalidRepositoryException e )
-                    {
-                        throw new ProjectBuildingException( modelId, e.getMessage(), e );
-                    }
+                        Repository mavenRepo = (Repository) repoIterator.next();
-                    remoteRepositories.add( artifactRepo );
+                        ArtifactRepository artifactRepo;
+                        try
+                        {
+                            artifactRepo = mavenTools.buildArtifactRepository( mavenRepo );
+                        }
+                        catch ( InvalidRepositoryException e )
+                        {
+                            throw new ProjectBuildingException( modelId, e.getMessage(), e );
+                        }
+
+                        remoteRepositories.add( artifactRepo );
+                    }
-                                                                    List explicitlyActiveIds,
-                                                                    List explicitlyInactiveIds,
-                                                             explicitlyActiveIds,
-                                                             explicitlyInactiveIds,
-                        profileManager.explicitlyActivate( root.getActiveProfiles() );
+                        ProfileActivationContext ctx = profileManager.getProfileActivationContext();
+                        ctx.setExplicitlyActiveProfileIds( root.getActiveProfiles() );
