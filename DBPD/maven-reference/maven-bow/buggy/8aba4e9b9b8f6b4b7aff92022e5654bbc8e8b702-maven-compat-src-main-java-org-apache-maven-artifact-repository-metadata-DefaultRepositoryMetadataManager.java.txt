[MNG-4326] Maven should not check snapshot repositories for dependencies in the reactor

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@928842 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Date;
+            Date localCopyLastModified = getLocalCopyLastModified( localRepository, metadata );
+
+                boolean update;
-                if ( ( policy.isEnabled() && request.isForceUpdate() )
-                    || updateCheckManager.isUpdateRequired( metadata, repository, file ) )
+                if ( !policy.isEnabled() )
+                {
+                    update = false;
+
+                    if ( getLogger().isDebugEnabled() )
+                    {
+                        getLogger().debug(
+                                           "Skipping update check for " + metadata.getKey() + " (" + file
+                                               + ") from disabled repository " + repository.getId() + " ("
+                                               + repository.getUrl() + ")" );
+                    }
+                }
+                else if ( request.isForceUpdate() )
+                {
+                    update = true;
+                }
+                else if ( localCopyLastModified != null && !policy.checkOutOfDate( localCopyLastModified ) )
+                {
+                    update = false;
+
+                    if ( getLogger().isDebugEnabled() )
+                    {
+                        getLogger().debug(
+                                           "Skipping update check for " + metadata.getKey() + " (" + file
+                                               + ") from repository " + repository.getId() + " (" + repository.getUrl()
+                                               + ") in favor of local copy" );
+                    }
+                }
+                else if ( updateCheckManager.isUpdateRequired( metadata, repository, file ) )
+                {
+                    update = true;
+                }
+                else
+                {
+                    update = false;
+                }
+
+                if ( update )
+    private Date getLocalCopyLastModified( ArtifactRepository localRepository, RepositoryMetadata metadata )
+    {
+        String metadataPath = localRepository.pathOfLocalRepositoryMetadata( metadata, localRepository );
+        File metadataFile = new File( localRepository.getBasedir(), metadataPath );
+        return metadataFile.isFile() ? new Date( metadataFile.lastModified() ) : null;
+    }
+
