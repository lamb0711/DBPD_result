PR: MNG-613
changes versioning to use repository metadata

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@278881 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.metadata.ArtifactMetadata;
-import org.apache.maven.artifact.metadata.ArtifactMetadataRetrievalException;
-    implements ArtifactMetadata
+    extends AbstractRepositoryMetadata
-    public void storeInLocalRepository( ArtifactRepository localRepository, ArtifactRepository remoteRepository )
-        throws ArtifactMetadataRetrievalException
-    {
-        if ( !pluginMappings.isEmpty() )
-        {
-            try
-            {
-                updateRepositoryMetadata( localRepository, remoteRepository );
-            }
-            catch ( IOException e )
-            {
-                throw new ArtifactMetadataRetrievalException( "Error updating group repository metadata", e );
-            }
-        }
-    }
-
-    public String getRemoteFilename()
-    {
-        return "maven-metadata.xml";
-    }
-
-    public String getLocalFilename( ArtifactRepository repository )
-    {
-        return "maven-metadata-" + repository.getKey() + ".xml";
-    }
-
-    private void updateRepositoryMetadata( ArtifactRepository localRepository, ArtifactRepository remoteRepository )
+    protected void updateRepositoryMetadata( ArtifactRepository localRepository, ArtifactRepository remoteRepository )
+        boolean changed = false;
+
+
+            changed = true;
+
+                changed = true;
-        Writer writer = null;
-        try
+        if ( changed )
-            writer = new FileWriter( metadataFile );
+            Writer writer = null;
+            try
+            {
+                writer = new FileWriter( metadataFile );
-            MetadataXpp3Writer mappingWriter = new MetadataXpp3Writer();
+                MetadataXpp3Writer mappingWriter = new MetadataXpp3Writer();
-            mappingWriter.write( writer, pluginMap );
+                mappingWriter.write( writer, pluginMap );
+            }
+            finally
+            {
+                IOUtil.close( writer );
+            }
-        finally
+        else
-            IOUtil.close( writer );
+            metadataFile.setLastModified( System.currentTimeMillis() );
