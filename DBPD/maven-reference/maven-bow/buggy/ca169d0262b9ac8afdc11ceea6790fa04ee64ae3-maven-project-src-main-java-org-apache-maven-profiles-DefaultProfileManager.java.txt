Refactor management of activated, deactivated, and default-activated profile ids, so the context tracks all of that stuff.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@612186 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.realm.DefaultMavenRealmManager;
+import org.apache.maven.realm.MavenRealmManager;
+import org.codehaus.plexus.logging.Logger;
-    private List activatedIds = new ArrayList();
-
-    private List deactivatedIds = new ArrayList();
-
-    private List defaultIds = new ArrayList();
-
+    /**
+     * @deprecated Using this is dangerous when extensions or non-global system properties are in play.
+     */
-        profileActivationContext = new DefaultProfileActivationContext( System.getProperties(), false );
+
+        // create the necessary bits to get a skeletal profile manager running.
+        Logger logger = container.getLoggerManager().getLoggerForComponent( DefaultProfileManager.class.getName() );
+        MavenRealmManager manager = new DefaultMavenRealmManager( container, logger );
+
+        profileActivationContext = new DefaultProfileActivationContext( manager, System.getProperties(), false );
+        List activatedIds = profileActivationContext.getExplicitlyActiveProfileIds();
-            activatedIds.add( profileId );
+            profileActivationContext.setActive( profileId );
+        List deactivatedIds = profileActivationContext.getExplicitlyInactiveProfileIds();
-            deactivatedIds.add( profileId );
+            profileActivationContext.setInactive( profileId );
-            if ( activatedIds.contains( profileId ) )
+            if ( profileActivationContext.isExplicitlyActive( profileId ) )
-            else if ( !deactivatedIds.contains( profileId ) && isActive( profile, profileActivationContext ) )
+            else if ( !profileActivationContext.isExplicitlyInactive( profileId ) && isActive( profile, profileActivationContext ) )
+            List defaultIds = profileActivationContext.getActiveByDefaultProfileIds();
+
-                activeFromPom.add( profile );
+                if ( profile != null )
+                {
+                    activeFromPom.add( profile );
+                }
+        List defaultIds = profileActivationContext.getActiveByDefaultProfileIds();
+
-            defaultIds.add( profileId );
+            profileActivationContext.setActiveByDefault( profileId );
-        return activatedIds;
+        return profileActivationContext.getExplicitlyActiveProfileIds();
-        return deactivatedIds;
+        return profileActivationContext.getExplicitlyInactiveProfileIds();
-        return defaultIds;
+        return profileActivationContext.getActiveByDefaultProfileIds();
