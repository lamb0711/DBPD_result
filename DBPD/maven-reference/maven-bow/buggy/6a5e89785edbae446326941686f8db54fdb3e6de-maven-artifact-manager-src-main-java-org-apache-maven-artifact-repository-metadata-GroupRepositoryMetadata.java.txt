PR: MNG-639
Separate local metadata by repository to ensure it remains consistent

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@267466 13f79535-47bb-0310-9956-ffa450edef68

-    /**
-     * TODO: reuse.
-     */
-    protected static final String METADATA_FILE = "maven-metadata.xml";
-
-    public void storeInLocalRepository( ArtifactRepository localRepository )
+    public void storeInLocalRepository( ArtifactRepository localRepository, ArtifactRepository remoteRepository )
-                updateRepositoryMetadata( localRepository );
+                updateRepositoryMetadata( localRepository, remoteRepository );
-    public String getFilename()
+    public String getRemoteFilename()
-        return METADATA_FILE;
+        return "maven-metadata.xml";
+    }
+
+    public String getLocalFilename( ArtifactRepository repository )
+    {
+        return "maven-metadata-" + repository.getKey() + ".xml";
-    private void updateRepositoryMetadata( ArtifactRepository localRepository )
+    private void updateRepositoryMetadata( ArtifactRepository localRepository, ArtifactRepository remoteRepository )
-        File metadataFile = new File( localRepository.getBasedir(), localRepository.pathOfArtifactMetadata( this ) );
+        File metadataFile = new File( localRepository.getBasedir(),
+                                      localRepository.pathOfLocalRepositoryMetadata( this, remoteRepository ) );
