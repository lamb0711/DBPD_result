PR: MNG-680
find the file for a parent that was cached

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@280347 13f79535-47bb-0310-9956-ffa450edef68

-        modelCache.put( createCacheKey( model.getGroupId(), model.getArtifactId(), model.getVersion() ), model );
+        MavenProject p = new MavenProject( model );
+        p.setFile( projectDescriptor );
+        modelCache.put( createCacheKey( model.getGroupId(), model.getArtifactId(), model.getVersion() ), p );
-        Model model = getCachedModel( artifact.getGroupId(), artifact.getArtifactId(), artifact.getVersion() );
-        if ( model == null )
+        MavenProject project = getCachedProject( artifact.getGroupId(), artifact.getArtifactId(),
+                                                 artifact.getVersion() );
+        Model model;
+        if ( project == null )
+        else
+        {
+            model = project.getModel();
+        }
-        Model cachedModel = (Model) modelCache.get( key );
-        if ( cachedModel == null )
+        if ( !modelCache.containsKey( key ) )
-            modelCache.put( key, model );
+            // clone the model because the profile injection below will modify this instance
+            MavenProject p = new MavenProject( ModelUtils.cloneModel( model ) );
+            p.setFile( project.getFile() );
+            modelCache.put( key, project );
-            model = getCachedModel( parentModel.getGroupId(), parentModel.getArtifactId(), parentModel.getVersion() );
-
+            MavenProject p = getCachedProject( parentModel.getGroupId(), parentModel.getArtifactId(),
+                                               parentModel.getVersion() );
+            if ( p != null )
+            {
+                model = p.getModel();
+                parentDescriptor = p.getFile();
+            }
+            else
+            {
+                model = null;
+            }
+
-    private Model getCachedModel( String groupId, String artifactId, String version )
+    private MavenProject getCachedProject( String groupId, String artifactId, String version )
-        return (Model) modelCache.get( createCacheKey( groupId, artifactId, version ) );
+        return (MavenProject) modelCache.get( createCacheKey( groupId, artifactId, version ) );
