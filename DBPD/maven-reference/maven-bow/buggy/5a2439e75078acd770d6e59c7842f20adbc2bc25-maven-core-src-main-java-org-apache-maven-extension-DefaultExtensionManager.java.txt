Moving extensions back to the core classrealm, and adding a dynamic artifact filter to keep MNG-2228 from reappearing.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@497671 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.MavenArtifactFilterManager;
+import org.apache.maven.ArtifactFilterManager;
+    
-    private ArtifactFilter artifactFilter = MavenArtifactFilterManager.createStandardFilter();
+    private ArtifactFilterManager artifactFilterManager;
-    private static final String CONTAINER_NAME = "extensions";
-
-            ArtifactFilter filter = new ProjectArtifactExceptionFilter( artifactFilter, project.getArtifact() );
+            ArtifactFilter filter = new ProjectArtifactExceptionFilter( artifactFilterManager.getArtifactFilter(), project.getArtifact() );
-            // create a child container for the extension
-            // TODO: this could surely be simpler/different on trunk with the new classworlds
-            PlexusContainer extensionContainer = getExtensionContainer();
-            if ( extensionContainer == null )
-            {
-                extensionContainer =
-                    container.createChildContainer( CONTAINER_NAME, Collections.EMPTY_LIST, Collections.EMPTY_MAP );
-            }
-
-                extensionContainer.addJarResource( a.getFile() );
+                container.addJarResource( a.getFile() );
+                artifactFilterManager.excludeArtifact( a.getArtifactId() );
-        PlexusContainer extensionContainer = getExtensionContainer();
-        if ( extensionContainer != null )
+        try
-            try
-            {
-                Map wagons = extensionContainer.lookupMap( Wagon.ROLE );
-                wagonManager.registerWagons( wagons.keySet(), extensionContainer );
-            }
-            catch ( ComponentLookupException e )
-            {
-                // now wagons found in the extension
-            }
+            Map wagons = container.lookupMap( Wagon.ROLE );
+            wagonManager.registerWagons( wagons.keySet(), container );
-    }
-
-    private PlexusContainer getExtensionContainer()
-    {
-        // note: ideally extensions would live in their own realm, but this would mean that things like wagon-scm would
-        // have no way to obtain SCM extensions
-        return container.getChildContainer( CONTAINER_NAME );
+        catch ( ComponentLookupException e )
+        {
+            // now wagons found in the extension
+        }
