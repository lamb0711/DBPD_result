[MNG-4327] [regression] Forking mojos that are bound to a lifecycle phase that gets forked execute multiple times

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@808556 13f79535-47bb-0310-9956-ffa450edef68

+
+        alreadyForkedExecutions.remove( mojoDescriptor );
+        if ( alreadyForkedExecutions.contains( forkedMojoDescriptor ) )
+        {
+            return Collections.emptyList();
+        }
+
-            for ( MojoExecution forkedExecution : forkedExecutions )
+            for ( Iterator<MojoExecution> it = forkedExecutions.iterator(); it.hasNext(); )
-                extractMojoConfiguration( forkedExecution );
+                MojoExecution forkedExecution = it.next();
-                calculateForkedExecutions( forkedExecution, session, project, alreadyForkedExecutions );
+                if ( !alreadyForkedExecutions.contains( forkedExecution.getMojoDescriptor() ) )
+                {
+                    extractMojoConfiguration( forkedExecution );
-                mojoExecutions.add( forkedExecution );
+                    calculateForkedExecutions( forkedExecution, session, project, alreadyForkedExecutions );
+
+                    mojoExecutions.add( forkedExecution );
+                }
