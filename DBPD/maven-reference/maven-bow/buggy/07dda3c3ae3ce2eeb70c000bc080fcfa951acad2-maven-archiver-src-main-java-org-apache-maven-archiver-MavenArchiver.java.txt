Resolving issue: MNG-271

o Added method to MavenProject called writeModel( Writer ) 
o Added code in MavenArchiver to export the full effective POM to ${project.build.directory}/exported-pom.xml and then embed that in the archive, rather than simply embedding ${project.file}.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@191588 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.io.xpp3.MavenXpp3Writer;
+import org.codehaus.plexus.util.IOUtil;
+import java.io.FileWriter;
+        
+        
+        File exportReadyPom = writeExportReadyPom( project );
-        archiver.addFile( project.getFile(), "META-INF/maven/" + groupId + "/" + artifactId + "/pom.xml" );
+        archiver.addFile( exportReadyPom, "META-INF/maven/" + groupId + "/" + artifactId + "/pom.xml" );
+
+    private File writeExportReadyPom( MavenProject project ) throws IOException
+    {
+        String buildDirectory = project.getBuild().getDirectory();
+        
+        File fullPom = new File( buildDirectory, "exported-pom.xml" );
+        
+        FileWriter fWriter = null;
+        
+        try
+        {
+            fWriter = new FileWriter( fullPom );
+            
+            project.writeModel( fWriter );
+        }
+        finally
+        {
+            IOUtil.close( fWriter );
+        }
+        
+        return fullPom;
+    }
