o Properly reported cycles in the imported models

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@810004 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Collection;
+import java.util.LinkedHashSet;
+        return build( request, new LinkedHashSet<String>() );
+    }
+
+    private ModelBuildingResult build( ModelBuildingRequest request, Collection<String> imports )
+        throws ModelBuildingException
+    {
+        return build( request, result, new LinkedHashSet<String>() );
+    }
+
+    private ModelBuildingResult build( ModelBuildingRequest request, ModelBuildingResult result,
+                                       Collection<String> imports )
+        throws ModelBuildingException
+    {
-        importDependencyManagement( resultModel, request, problems );
+        importDependencyManagement( resultModel, request, problems, imports );
-                                             DefaultModelProblemCollector problems )
+                                             DefaultModelProblemCollector problems, Collection<String> imports )
+        String importing = model.getGroupId() + ':' + model.getArtifactId() + ':' + model.getVersion();
+
+        imports.add( importing );
+
+            String imported = groupId + ':' + artifactId + ':' + version;
+
+            if ( imports.contains( imported ) )
+            {
+                String message = "The dependencies of type=pom and with scope=import from a cycle: ";
+                for ( String modelId : imports )
+                {
+                    message += modelId + " -> ";
+                }
+                message += imported;
+                problems.addError( message );
+                continue;
+            }
+
-                    importResult = build( importRequest );
+                    importResult = build( importRequest, imports );
+        imports.remove( importing );
+
