[MNG-4452] Metadata for snapshots should include classifier

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@995057 13f79535-47bb-0310-9956-ffa450edef68

-                if ( !resolve( result, infos, SNAPSHOT + artifact.getClassifier() )
+                if ( !resolve( result, infos, SNAPSHOT + getKey( artifact.getClassifier(), artifact.getExtension() ) )
-        boolean mainSnapshot = false;
-                mainSnapshot |= sv.getClassifier().length() <= 0;
-                merge( SNAPSHOT + sv.getClassifier(), infos, sv.getUpdated(), sv.getVersion(), repository );
+                String key = getKey( sv.getClassifier(), sv.getExtension() );
+                merge( SNAPSHOT + key, infos, sv.getUpdated(), sv.getVersion(), repository );
-        if ( !mainSnapshot && snapshot != null )
+        if ( snapshot != null )
+    private String getKey( String classifier, String extension )
+    {
+        return StringUtils.clean( classifier ) + ':' + StringUtils.clean( extension );
+    }
+
+        private final String classifier;
+
+        private final String extension;
+
-            groupId = request.getArtifact().getGroupId();
-            artifactId = request.getArtifact().getArtifactId();
-            version = request.getArtifact().getVersion();
+            Artifact artifact = request.getArtifact();
+            groupId = artifact.getGroupId();
+            artifactId = artifact.getArtifactId();
+            classifier = artifact.getClassifier();
+            extension = artifact.getExtension();
+            version = artifact.getVersion();
+            hash = hash * 31 + classifier.hashCode();
+            hash = hash * 31 + extension.hashCode();
+                && classifier.equals( that.classifier ) && extension.equals( that.extension )
