clean up exception handling


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163978 13f79535-47bb-0310-9956-ffa450edef68

-        Settings settings = null;
-
-        try
-        {
-            settings = mavenSettingsBuilder.buildSettings();
-        }
-        catch ( Exception e )
-        {
-            throw new ProjectBuildingException( "Cannot read settings.", e );
-        }
+        Settings settings = readSettings();
-    public MavenProject buildFromRepository( Artifact artifact, List remoteArtifactRepositories,
-                                             ArtifactRepository localRepository )
+    /**
+     * @return
+     * @throws ProjectBuildingException
+     * @todo shouldn't be re-reading all the time - perhaps cache, but check a timestamp so you can detect and reload on
+     * changes in a long running process
+     */
+    private Settings readSettings()
+        return settings;
+    }
+
+    public MavenProject buildFromRepository( Artifact artifact, List remoteArtifactRepositories,
+                                             ArtifactRepository localRepository )
+        throws ProjectBuildingException
+    {
+        Settings settings = readSettings();
-            Settings settings;
-            try
-            {
-                settings = mavenSettingsBuilder.buildSettings();
-            }
-            catch ( Exception e )
-            {
-                throw new ProjectBuildingException( "Cannot read settings.", e );
-            }
-
-        Settings settings = null;
-
-        try
-        {
-            settings = mavenSettingsBuilder.buildSettings();
-        }
-        catch ( Exception e )
-        {
-            throw new ProjectBuildingException( "Cannot read settings.", e );
-        }
+        Settings settings = readSettings();
-            String layout = mavenRepo.getLayout();
-
-            ArtifactRepositoryLayout remoteRepoLayout = null;
-            try
-            {
-                remoteRepoLayout =
-                    (ArtifactRepositoryLayout) container.lookup( ArtifactRepositoryLayout.ROLE, layout );
-            }
-            catch ( ComponentLookupException e )
-            {
-                throw new ProjectBuildingException( "Cannot find layout implementation corresponding to: \'" + layout +
-                                                    "\' for remote repository with id: \'" + mavenRepo.getId() + "\'.",
-                                                    e );
-            }
+            ArtifactRepositoryLayout remoteRepoLayout = getRepositoryLayout( mavenRepo );
-        throws Exception
+        throws ProjectBuildingException
-        Settings settings = mavenSettingsBuilder.buildSettings();
+        Settings settings = readSettings();
-            String layout = mavenRepo.getLayout();
-
-            ArtifactRepositoryLayout repositoryLayout = null;
-            try
-            {
-                repositoryLayout =
-                    (ArtifactRepositoryLayout) container.lookup( ArtifactRepositoryLayout.ROLE, layout );
-            }
-            catch ( ComponentLookupException e )
-            {
-                throw new ProjectBuildingException( "Cannot find layout implementation corresponding to: \'" + layout +
-                                                    "\' for remote repository with id: \'" + mavenRepo.getId() + "\'.",
-                                                    e );
-            }
+            ArtifactRepositoryLayout repositoryLayout = getRepositoryLayout( mavenRepo );
+    private ArtifactRepositoryLayout getRepositoryLayout( Repository mavenRepo )
+        throws ProjectBuildingException
+    {
+        String layout = mavenRepo.getLayout();
+
+        ArtifactRepositoryLayout repositoryLayout = null;
+        try
+        {
+            repositoryLayout = (ArtifactRepositoryLayout) container.lookup( ArtifactRepositoryLayout.ROLE, layout );
+        }
+        catch ( ComponentLookupException e )
+        {
+            throw new ProjectBuildingException( "Cannot find layout implementation corresponding to: \'" + layout +
+                                                "\' for remote repository with id: \'" + mavenRepo.getId() + "\'.", e );
+        }
+        return repositoryLayout;
+    }
+
-        throws Exception
+        throws ProjectBuildingException
-        Settings settings = mavenSettingsBuilder.buildSettings();
+        Settings settings = readSettings();
-        String repoLayoutId = dmRepo.getLayout();
-
-        ArtifactRepositoryLayout repositoryLayout = (ArtifactRepositoryLayout) container.lookup(
-            ArtifactRepositoryLayout.ROLE, repoLayoutId );
+        ArtifactRepositoryLayout repositoryLayout = getRepositoryLayout( dmRepo );
