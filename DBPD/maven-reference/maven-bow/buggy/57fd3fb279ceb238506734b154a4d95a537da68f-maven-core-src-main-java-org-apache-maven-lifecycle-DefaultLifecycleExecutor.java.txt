[MNG-3779] Improve error message when trying to execute moojo with no pom.xml

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@928903 13f79535-47bb-0310-9956-ffa450edef68

+            if ( !session.isUsingPOMsFromFilesystem() && requiresProject( session ) )
+            {
+                throw new MissingProjectException( "The goal you specified requires a project to execute"
+                    + " but there is no POM in this directory (" + session.getExecutionRootDirectory() + ")."
+                    + " Please verify you invoked Maven from the correct directory." );
+            }
+
+            if ( projectBuilds.isEmpty() )
+            {
+                throw new NoGoalSpecifiedException( "No goals have been specified for this build."
+                    + " You must specify a valid lifecycle phase or a goal in the format <plugin-prefix>:<goal> or"
+                    + " <plugin-group-id>:<plugin-artifact-id>[:<plugin-version>]:<goal>."
+                    + " Available lifecycle phases are: " + getLifecyclePhaseList() + "." );
+            }
+
-                new IllegalStateException( "Goal requires a project to execute but there is no POM in this build." );
+                new MissingProjectException( "Goal requires a project to execute"
+                    + " but there is no POM in this directory (" + session.getExecutionRootDirectory() + ")."
+                    + " Please verify you invoked Maven from the correct directory." );
-            throw new LifecyclePhaseNotFoundException( lifecyclePhase );
+            throw new LifecyclePhaseNotFoundException( "Unknown lifecycle phase \"" + lifecyclePhase
+                + "\". You must specify a valid lifecycle phase" + " or a goal in the format <plugin-prefix>:<goal> or"
+                + " <plugin-group-id>:<plugin-artifact-id>[:<plugin-version>]:<goal>. Available lifecycle phases are: "
+                + getLifecyclePhaseList() + ".", lifecyclePhase );
+    private String getLifecyclePhaseList()
+    {
+        Set<String> phases = new LinkedHashSet<String>();
+
+        for ( Lifecycle lifecycle : lifecycles )
+        {
+            phases.addAll( lifecycle.getPhases() );
+        }
+
+        return StringUtils.join( phases.iterator(), ", " );
+    }
+
+    private boolean requiresProject( MavenSession session )
+    {
+        List<String> goals = session.getGoals();
+        if ( goals != null )
+        {
+            for ( String goal : goals )
+            {
+                if ( !isGoalSpecification( goal ) )
+                {
+                    return true;
+                }
+            }
+        }
+        return false;
+    }
+
