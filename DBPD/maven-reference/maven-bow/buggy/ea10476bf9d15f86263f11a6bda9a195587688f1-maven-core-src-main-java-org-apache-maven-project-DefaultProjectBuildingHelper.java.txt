o Fixed extension realm to consider project-level plugin dependencies as well

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@799831 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.LinkedHashSet;
+import java.util.Set;
+import org.apache.maven.model.Dependency;
-            populateRealm( projectRealm, artifact, localRepository, remoteRepositories );
+            populateRealm( projectRealm, artifact, null, localRepository, remoteRepositories );
-            populateRealm( projectRealm, artifact, localRepository, remoteRepositories );
+            Set<Artifact> dependencies = new LinkedHashSet<Artifact>();
+            for ( Dependency dependency : plugin.getDependencies() )
+            {
+                dependencies.add( repositorySystem.createDependencyArtifact( dependency ) );
+            }
+
+            populateRealm( projectRealm, artifact, dependencies, localRepository, remoteRepositories );
-    private void populateRealm( ClassRealm realm, Artifact artifact, ArtifactRepository localRepository,
-                                List<ArtifactRepository> remoteRepositories )
+    private void populateRealm( ClassRealm realm, Artifact artifact, Set<Artifact> dependencies,
+                                ArtifactRepository localRepository, List<ArtifactRepository> remoteRepositories )
+        request.setArtifactDependencies( dependencies );
-        
+
