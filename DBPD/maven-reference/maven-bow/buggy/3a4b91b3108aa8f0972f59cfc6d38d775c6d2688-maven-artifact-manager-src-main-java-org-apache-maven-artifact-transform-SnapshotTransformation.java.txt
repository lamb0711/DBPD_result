PR: MNG-613
push shared code into metadata manager

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@280232 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.repository.metadata.Metadata;
+import org.apache.maven.artifact.repository.metadata.RepositoryMetadata;
-            // TODO: Better way to create this - should have to construct Versioning
-            ArtifactMetadata metadata = new SnapshotArtifactRepositoryMetadata( artifact );
+            RepositoryMetadata metadata = new SnapshotArtifactRepositoryMetadata( artifact );
+            metadata.getMetadata().getVersioning().getSnapshot().setLocalCopy( true );
-            // TODO: should merge with other repository metadata sitting on the same level?
-            if ( snapshot.getTimestamp() != null && snapshot.getBuildNumber() > 0 )
+            if ( snapshot.isLocalCopy() )
+            {
+                version = baseVersion;
+            }
+            else if ( snapshot.getTimestamp() != null && snapshot.getBuildNumber() > 0 )
-        ArtifactMetadata metadata = new SnapshotArtifactRepositoryMetadata( artifact );
+        RepositoryMetadata metadata = new SnapshotArtifactRepositoryMetadata( artifact );
-        Versioning versioning = loadVersioningInformation( metadata, remoteRepository, localRepository, artifact );
-        if ( versioning == null )
+        Metadata repoMetadata = metadata.getMetadata();
+        if ( repoMetadata != null )
+        {
+            if ( repoMetadata.getVersioning() != null && repoMetadata.getVersioning().getSnapshot() != null )
+            {
+                buildNumber = repoMetadata.getVersioning().getSnapshot().getBuildNumber();
+            }
+        }
+        else
-        else if ( versioning.getSnapshot() != null )
-        {
-            buildNumber = versioning.getSnapshot().getBuildNumber();
-        }
