PR: MNG-1233
corrected handling of scope based exclusions

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@326363 13f79535-47bb-0310-9956-ffa450edef68

-                    // If it was optional, we don't add it or its children, just allow the update of the version and scope
-                    if ( !node.getArtifact().isOptional() )
+                    if ( node.filterTrail( filter ) )
-                        artifact.setDependencyTrail( node.getDependencyTrail() );
+                        // If it was optional, we don't add it or its children, just allow the update of the version and scope
+                        if ( !artifact.isOptional() )
+                        {
+                            artifact.setDependencyTrail( node.getDependencyTrail() );
-                        set.add( node );
+                            set.add( node );
+                        }
-                            if ( resetArtifact.getVersion() == null && resetArtifact.getVersionRange() != null && resetArtifact.getAvailableVersions() != null )
+                            if ( resetArtifact.getVersion() == null && resetArtifact.getVersionRange() != null &&
+                                resetArtifact.getAvailableVersions() != null )
-                                resetArtifact.selectVersion( resetArtifact.getVersionRange().matchVersion( resetArtifact.getAvailableVersions() ).toString() );
+                                resetArtifact.selectVersion( resetArtifact.getVersionRange().matchVersion(
+                                    resetArtifact.getAvailableVersions() ).toString() );
