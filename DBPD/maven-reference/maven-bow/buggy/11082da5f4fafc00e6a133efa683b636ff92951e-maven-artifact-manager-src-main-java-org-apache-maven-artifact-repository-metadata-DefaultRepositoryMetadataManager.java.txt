Fixing bootstrap.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@219807 13f79535-47bb-0310-9956-ffa450edef68

+import org.codehaus.plexus.util.IOUtil;
+import java.io.FileInputStream;
+import java.io.InputStream;
-                    File tempMetadataFile = File.createTempFile( "plugins.xml", null );
-
-                        wagonManager.getRepositoryMetadata( metadata, remote, tempMetadataFile );
-
-                        if ( !metadataFile.exists()
-                            || ( metadataFile.lastModified() <= tempMetadataFile.lastModified() ) )
-                        {
-                            if ( !tempMetadataFile.renameTo( metadataFile ) )
-                            {
-                                FileUtils.copyFile( tempMetadataFile, metadataFile );
-
-                                tempMetadataFile.delete();
-                            }
-                        }
+                        wagonManager.getRepositoryMetadata( metadata, remote, metadataFile );
-                catch ( IOException e )
-                {
-                    throw new RepositoryMetadataManagementException(
-                                                                     metadata,
-                                                                     "Error constructing temporary metadata download file.",
-                                                                     e );
-                }
-            metadata.setFile( metadataFile );
+            if ( metadataFile.exists() )
+            {
+                if ( !verifyFileNotEmpty( metadataFile ) )
+                {
+                    throw new InvalidRepositoryMetadataException( metadata, "Metadata located in file: " + metadataFile + " appears to be corrupt (file is empty). DOWNLOAD FAILED." );
+                }
+                
+                cachedMetadata.put( metadata.getRepositoryPath(), metadataFile );
+            }
+        }
+        
+        metadata.setFile( metadataFile );
+    }
+
+    private boolean verifyFileNotEmpty( File metadataFile )
+    {
+        InputStream verifyInputStream = null;
+        
+        try
+        {
+            verifyInputStream = new FileInputStream( metadataFile );
+            
+            return verifyInputStream.available() > 0;
+        }
+        catch( IOException e )
+        {
+            return false;
+        }
+        finally
+        {
+            IOUtil.close( verifyInputStream );
