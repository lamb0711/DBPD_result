Error reporting works properly now.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@604401 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.BuildFailureException;
+import org.apache.maven.errors.CoreErrorReporter;
+import org.apache.maven.errors.DefaultCoreErrorReporter;
-import org.apache.maven.project.DuplicateProjectException;
-                showError( e, request.isShowErrors(), logger );
+                showError( e, request.isShowErrors(), request.getErrorReporter(), logger );
-        showError( message, e, showErrors, new MavenEmbedderConsoleLogger() );
+        showError( message, e, showErrors, new DefaultCoreErrorReporter(), new MavenEmbedderConsoleLogger() );
+                           CoreErrorReporter reporter,
-        showError( null, e, show, logger );
+        showError( null, e, show, reporter, logger );
+                           CoreErrorReporter reporter,
-        buildErrorMessage( e, showStackTraces, writer );
+        buildErrorMessage( e, showStackTraces, reporter, writer );
+                                           CoreErrorReporter reporter,
+        if ( reporter != null )
+        {
+            Throwable reported = reporter.findReportedException( e );
+
+            if ( reported != null )
+            {
+                writer.write( reporter.getFormattedMessage( reported ) );
+
+                if ( showStackTraces )
+                {
+                    writer.write( NEWLINE );
+                    writer.write( NEWLINE );
+                    Throwable cause = reporter.getRealCause( reported );
+                    if ( cause != null )
+                    {
+                        cause.printStackTrace( new PrintWriter( writer ) );
+                    }
+                }
+
+                writer.write( NEWLINE );
+                writer.write( NEWLINE );
+
+                return;
+            }
+        }
+
-        if ( e instanceof BuildFailureException )
-        {
-            handled = handleBuildFailureException( (BuildFailureException) e,
-                                                   showStackTraces,
-                                                   writer );
-        }
-        else if ( e instanceof ProjectBuildingException )
+        if ( e instanceof ProjectBuildingException )
-        else if ( e instanceof DuplicateProjectException )
-        {
-            handled = handleDuplicateProjectException( (DuplicateProjectException) e,
-                                                       showStackTraces,
-                                                       writer );
-        }
-    private static boolean handleDuplicateProjectException( DuplicateProjectException e,
-                                                            boolean showStackTraces,
-                                                            StringWriter writer )
-    {
-        handleGenericException( e, showStackTraces, writer );
-
-        return true;
-    }
-
-    // NOTE: This method is an aspect target.
-    // NOTE: This method is an aspect target.
-    private static boolean handleBuildFailureException( BuildFailureException e,
-                                                        boolean showStackTraces,
-                                                        StringWriter writer )
-    {
-        handleGenericException( e, showStackTraces, writer );
-
-        return true;
-    }
-
