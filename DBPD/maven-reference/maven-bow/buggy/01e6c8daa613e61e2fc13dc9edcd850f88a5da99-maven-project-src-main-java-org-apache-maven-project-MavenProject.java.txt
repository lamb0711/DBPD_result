PR: MNG-257

refactor artifact creation to all go through the factory, and assign the type handler from there.
Attach EJB client to the EJB artifact so that it is installed/deployed along with it.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@191096 13f79535-47bb-0310-9956-ffa450edef68

-    
+
+    private List attachedArtifacts;
+
-        
-        if(artifacts == null || artifacts.isEmpty())
+
+        if ( artifacts == null || artifacts.isEmpty() )
-        
+
-                if ( Artifact.SCOPE_TEST.equals( a.getScope() ) || Artifact.SCOPE_COMPILE.equals( a.getScope() )
-                    || Artifact.SCOPE_RUNTIME.equals( a.getScope() ) )
+                if ( Artifact.SCOPE_TEST.equals( a.getScope() ) || Artifact.SCOPE_COMPILE.equals( a.getScope() ) ||
+                    Artifact.SCOPE_RUNTIME.equals( a.getScope() ) )
-        
-        if(artifacts == null || artifacts.isEmpty())
+
+        if ( artifacts == null || artifacts.isEmpty() )
-        
+
-            if ( Artifact.SCOPE_TEST.equals( a.getScope() ) || Artifact.SCOPE_COMPILE.equals( a.getScope() )
-                || Artifact.SCOPE_RUNTIME.equals( a.getScope() ) )
+            if ( Artifact.SCOPE_TEST.equals( a.getScope() ) || Artifact.SCOPE_COMPILE.equals( a.getScope() ) ||
+                Artifact.SCOPE_RUNTIME.equals( a.getScope() ) )
-        
-        if(artifacts == null || artifacts.isEmpty())
+
+        if ( artifacts == null || artifacts.isEmpty() )
-        
+
-        if ( "jar".equals( type ) || "ejb".equals( type ) )
+        if ( "jar".equals( type ) || "ejb".equals( type ) || "ejb-client".equals( type ) )
+
-                if ( Artifact.SCOPE_RUNTIME.equals( a.getScope() ) && Artifact.SCOPE_TEST.equals( existing.getScope() ) )
+                if ( Artifact.SCOPE_RUNTIME.equals( a.getScope() ) &&
+                    Artifact.SCOPE_TEST.equals( existing.getScope() ) )
-                if ( Artifact.SCOPE_COMPILE.equals( a.getScope() )
-                    && !Artifact.SCOPE_COMPILE.equals( existing.getScope() ) )
+                if ( Artifact.SCOPE_COMPILE.equals( a.getScope() ) &&
+                    !Artifact.SCOPE_COMPILE.equals( existing.getScope() ) )
-                    Artifact artifact = artifactFactory.createArtifact( existing.getGroupId(),
-                                                                        existing.getArtifactId(),
+                    Artifact artifact = artifactFactory.createArtifact( existing.getGroupId(), existing.getArtifactId(),
-                                                                            .getType() );
+                        .getType() );
-    
+
+    public void addAttachedArtifact( Artifact artifact )
+    {
+        getAttachedArtifacts().add( artifact );
+    }
+
+    public List getAttachedArtifacts()
+    {
+        if ( attachedArtifacts == null )
+        {
+            attachedArtifacts = new ArrayList();
+        }
+        return attachedArtifacts;
+    }
