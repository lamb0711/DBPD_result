[MNG-4413] [regression] Repositories discovered in dependency POMs are not subject to mirroring

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@831282 13f79535-47bb-0310-9956-ffa450edef68

+            request.setTransferListener( session.getRequest().getTransferListener() );
+        }
+    }
+
+    private void injectSession( ArtifactResolutionRequest request )
+    {
+        MavenSession session = legacySupport.getSession();
+
+        if ( session != null )
+        {
+            request.setOffline( session.isOffline() );
+            request.setServers( session.getRequest().getServers() );
+            request.setMirrors( session.getRequest().getMirrors() );
+            request.setProxies( session.getRequest().getProxies() );
+            request.setTransferListener( session.getRequest().getTransferListener() );
-        RepositoryRequest collectionRequest = request;
+        ArtifactResolutionRequest collectionRequest = request;
-                collectionRequest = new DefaultRepositoryRequest( request );
+                collectionRequest = new ArtifactResolutionRequest( request );
+                collectionRequest.setServers( request.getServers() );
+                collectionRequest.setMirrors( request.getMirrors() );
+                collectionRequest.setProxies( request.getProxies() );
