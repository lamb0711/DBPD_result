PR: MNG-625
allow a plugin to specify the minimum Maven version (will apply for both building and its execution - this should be separated later).

If you are running an older version then it will not prompt to update when found, and will fail if it is encountered with a hardcoded version.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@220239 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.versioning.ArtifactVersion;
+import org.apache.maven.execution.RuntimeInformation;
-import org.codehaus.plexus.util.IOUtil;
-import java.io.InputStream;
-import java.util.Properties;
-    private ArtifactVersion mavenVersion;
+    protected RuntimeInformation runtimeInformation;
+
+    private static final long MB = 1024 * 1024;
+
+    private static final int MS_PER_SEC = 1000;
+
+    private static final int SEC_PER_MIN = 60;
-        try
-        {
-            mavenVersion = getMavenVersion();
-        }
-        catch ( IOException e )
-        {
-            throw new ReactorException( "Unable to determine the executing version of Maven", e );
-        }
-
-    private DefaultArtifactVersion getMavenVersion()
-        throws IOException
-    {
-        InputStream resourceAsStream = null;
-        try
-        {
-            Properties properties = new Properties();
-            resourceAsStream = getClass().getClassLoader().getResourceAsStream(
-                "META-INF/maven/org.apache.maven/maven-core/pom.properties" );
-            properties.load( resourceAsStream );
-
-            return new DefaultArtifactVersion( properties.getProperty( "version" ) );
-        }
-        finally
-        {
-            IOUtil.close( resourceAsStream );
-        }
-    }
-
-                if ( mavenVersion.compareTo( version ) < 0 )
+                if ( runtimeInformation.getApplicationVersion().compareTo( version ) < 0 )
-        MavenExecutionResponse response = null;
+        MavenExecutionResponse response;
-        final long mb = 1024 * 1024;
-
+        //noinspection CallToSystemGC
-            "Final Memory: " + ( ( r.totalMemory() - r.freeMemory() ) / mb ) + "M/" + ( r.totalMemory() / mb ) + "M" );
+            "Final Memory: " + ( r.totalMemory() - r.freeMemory() ) / MB + "M/" + r.totalMemory() / MB + "M" );
-        long secs = ms / 1000;
+        long secs = ms / MS_PER_SEC;
-        long min = secs / 60;
+        long min = secs / SEC_PER_MIN;
-        secs = secs % 60;
+        secs = secs % SEC_PER_MIN;
