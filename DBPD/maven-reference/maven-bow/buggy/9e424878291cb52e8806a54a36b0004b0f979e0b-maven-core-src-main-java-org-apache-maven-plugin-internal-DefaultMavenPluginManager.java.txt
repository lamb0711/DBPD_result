o Extended base plugin manager to allow for caller-supplied exclusions of certain plugin dependencies

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@881793 13f79535-47bb-0310-9956-ffa450edef68

-                                               ClassLoader parent, List<String> imports )
+                                               ClassLoader parent, List<String> imports, ArtifactFilter filter )
-            pluginRealmCache.get( plugin, parent, imports, session.getLocalRepository(),
+            pluginRealmCache.get( plugin, parent, imports, filter, session.getLocalRepository(),
-            createPluginRealm( pluginDescriptor, session, parent, imports );
+            createPluginRealm( pluginDescriptor, session, parent, imports, filter );
-                pluginRealmCache.put( plugin, parent, imports, session.getLocalRepository(),
+                pluginRealmCache.put( plugin, parent, imports, filter, session.getLocalRepository(),
-                                    List<String> imports )
+                                    List<String> imports, ArtifactFilter filter )
-        List<Artifact> pluginArtifacts =
-            resolvePluginArtifacts( plugin, pluginArtifact, request, project.getExtensionArtifactFilter() );
+        ArtifactFilter dependencyFilter = project.getExtensionArtifactFilter();
+        if ( dependencyFilter == null )
+        {
+            dependencyFilter = filter;
+        }
+        else if ( filter != null )
+        {
+            dependencyFilter = new AndArtifactFilter( Arrays.asList( dependencyFilter, filter ) );
+        }
+
+        List<Artifact> pluginArtifacts = resolvePluginArtifacts( plugin, pluginArtifact, request, dependencyFilter );
-                                                     ArtifactFilter extensionArtifactFilter )
+                                                     ArtifactFilter dependencyFilter )
-        if ( extensionArtifactFilter != null )
+        if ( dependencyFilter != null )
-            resolutionFilter = new AndArtifactFilter( Arrays.asList( resolutionFilter, extensionArtifactFilter ) );
+            resolutionFilter = new AndArtifactFilter( Arrays.asList( resolutionFilter, dependencyFilter ) );
