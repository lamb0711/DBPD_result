[MNG-1803] Provide line number information when there are errors processing a pom.xml

o Merged feature branch

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@949708 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.InputSource;
+import org.apache.maven.model.io.xpp3.MavenXpp3ReaderEx;
-            return read( input, isStrict( options ) );
+            return read( input, isStrict( options ), getSource( options ) );
-            return read( ReaderFactory.newXmlReader( input ), isStrict( options ) );
+            return read( ReaderFactory.newXmlReader( input ), isStrict( options ), getSource( options ) );
-    private Model read( Reader reader, boolean strict )
+    private InputSource getSource( Map<String, ?> options )
+    {
+        Object value = ( options != null ) ? options.get( INPUT_SOURCE ) : null;
+        return (InputSource) value;
+    }
+
+    private Model read( Reader reader, boolean strict, InputSource source )
-            MavenXpp3Reader r = new MavenXpp3Reader();
-            return r.read( reader, strict );
+            if ( source != null )
+            {
+                return new MavenXpp3ReaderEx().read( reader, strict, source );
+            }
+            else
+            {
+                return new MavenXpp3Reader().read( reader, strict );
+            }
