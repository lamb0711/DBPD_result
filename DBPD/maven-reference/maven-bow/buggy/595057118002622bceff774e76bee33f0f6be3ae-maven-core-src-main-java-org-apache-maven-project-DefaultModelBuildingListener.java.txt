[MNG-4381] Allow extension plugins to contribute non-core components to be reused by other plugins

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@819540 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.resolver.filter.ArtifactFilter;
+    private ArtifactFilter extensionArtifactFilter;
+
+     * Gets the artifact filter to exclude extension artifacts from plugin realms.
+     * 
+     * @return The extension artifact filter or {@code null} if none.
+     */
+    public ArtifactFilter getExtentionArtifactFilter()
+    {
+        return extensionArtifactFilter;
+    }
+
+    /**
-            remoteRepositories =
-                projectBuildingHelper.createArtifactRepositories( model.getRepositories(), remoteRepositories,
-                                                                  projectBuildingRequest );
-        }
-        catch ( Exception e )
-        {
-            event.getProblems().addError( "Invalid artifact repository: " + e.getMessage(), e );
-        }
-
-        try
-        {
-                projectRealm = projectBuildingHelper.createProjectRealm( model, repositoryRequest );
+                ProjectRealmCache.CacheRecord record =
+                    projectBuildingHelper.createProjectRealm( model, repositoryRequest );
+
+                projectRealm = record.realm;
+                extensionArtifactFilter = record.extensionArtifactFilter;
+
+        // build the regular repos after extensions are loaded to allow for custom layouts
+        try
+        {
+            remoteRepositories =
+                projectBuildingHelper.createArtifactRepositories( model.getRepositories(), remoteRepositories,
+                                                                  projectBuildingRequest );
+        }
+        catch ( Exception e )
+        {
+            event.getProblems().addError( "Invalid artifact repository: " + e.getMessage(), e );
+        }
