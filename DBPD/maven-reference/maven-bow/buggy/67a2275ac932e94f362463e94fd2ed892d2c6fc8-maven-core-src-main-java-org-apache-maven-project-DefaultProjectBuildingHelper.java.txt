[MNG-4274] Plugins with an undeclared but transitive dependency on plexus-utils via a core artifact get wrong version of p-u

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@800087 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.resolver.filter.ArtifactFilter;
-        request.setFilter( artifactFilterManager.getCoreArtifactFilter() );
+        ArtifactFilter filter = artifactFilterManager.getCoreArtifactFilter();
+
-            if ( logger.isDebugEnabled() )
+            if ( filter.include( resultArtifact ) )
-                logger.debug( "  " + resultArtifact.getFile() );
-            }
+                if ( logger.isDebugEnabled() )
+                {
+                    logger.debug( "  Included: " + resultArtifact.getId() );
+                }
-            try
-            {
-                realm.addURL( resultArtifact.getFile().toURI().toURL() );
+                try
+                {
+                    realm.addURL( resultArtifact.getFile().toURI().toURL() );
+                }
+                catch ( MalformedURLException e )
+                {
+                    throw new IllegalStateException( "Failed to populate project realm " + realm.getId() + " with "
+                        + artifact.getFile(), e );
+                }
-            catch ( MalformedURLException e )
+            else
-                throw new IllegalStateException( "Failed to populate project realm " + realm.getId() + " with "
-                    + artifact.getFile(), e );
+                if ( logger.isDebugEnabled() )
+                {
+                    logger.debug( "  Excluded: " + resultArtifact.getId() );
+                }
