Resolving: MNG-767, MNG-768

o We should have a viable offline mode now. Plugin sensitivity updates to follow.

o See it0069 and it1014 for offline mode tests.

o Brett, building maven-plugins in offline mode with org/apache/maven/plugin/* removed will now give a nice error message. :)



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@291124 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.project.ProjectBuildingException;
-        return error instanceof ArtifactResolutionException;
+        return DiagnosisUtils.containsInCausality( error, ArtifactResolutionException.class );
-        Throwable root = DiagnosisUtils.getRootCause( error );
+        ArtifactResolutionException exception = (ArtifactResolutionException) DiagnosisUtils.getFromCausality( error, ArtifactResolutionException.class );
-        String message = null;
-
-        if ( root instanceof ProjectBuildingException )
+        StringBuffer message = new StringBuffer();
+        
+        message.append( "Failed to resolve artifact." );
+        message.append( "\n");
+        message.append( "\nGroupId: " ).append( exception.getGroupId() );
+        message.append( "\nArtifactId: " ).append( exception.getArtifactId() );
+        message.append( "\nVersion: " ).append( exception.getVersion() );
+        message.append( "\nType: " ).append( exception.getType() );
+        
+        if ( exception instanceof TransitiveArtifactResolutionException )
-            StringBuffer messageBuffer = new StringBuffer();
-
-            if ( DiagnosisUtils.containsInCausality( error, TransitiveArtifactResolutionException.class ) )
-            {
-                messageBuffer.append(
-                    "Error while transitively resolving artifacts (transitive path trace currently unavailable):\n\n" );
-            }
-            else
-            {
-                messageBuffer.append( "Error while resolving artifacts:\n\n" );
-            }
-
-            messageBuffer.append( "Root Error:\n  " ).append( root.getMessage() );
-
-            message = messageBuffer.toString();
+            message.append( exception.getArtifactPath() );
-        else
+        
+        message.append( DiagnosisUtils.getOfflineWarning() );
+
+        Throwable root = DiagnosisUtils.getRootCause( exception );
+        
+        if ( root != null )
-            StringBuffer messageBuffer = new StringBuffer();
-
-            messageBuffer.append( "Main Error:\n  " ).append( error.getMessage() );
-
-            messageBuffer.append( "\n\nRoot error:\n  " ).append( root.getMessage() );
-
-            message = messageBuffer.toString();
+            message.append( "\n\nRoot Cause: " ).append( root.getMessage() ).append( "\n" );
-
-        return message;
+        
+        return message.toString();
