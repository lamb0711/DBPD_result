PR: MNG-1550
Submitted By: Edwin Punzalan
Reviewed By: John Casey

Applied patch, with small change. This patch will save the checksums in the local repo, once they've transferred safely. The change I made was to pass in the "real" destination to the verifyChecksum method, rather than only the temp destination. This will allow the checksums to actually persist in the local repo, rather than a temporary directory.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@354631 13f79535-47bb-0310-9956-ffa450edef68

-                    verifyChecksum( sha1ChecksumObserver, temp, remotePath, ".sha1", wagon );
+                    verifyChecksum( sha1ChecksumObserver, destination, temp, remotePath, ".sha1", wagon );
-                        verifyChecksum( md5ChecksumObserver, temp, remotePath, ".md5", wagon );
+                        verifyChecksum( md5ChecksumObserver, destination, temp, remotePath, ".md5", wagon );
-    private void verifyChecksum( ChecksumObserver checksumObserver, File destination, String remotePath,
+    private void verifyChecksum( ChecksumObserver checksumObserver, File destination, File tempDestination, String remotePath,
-            File checksumFile = new File( destination + checksumFileExtension );
-            checksumFile.deleteOnExit();
-            wagon.get( remotePath + checksumFileExtension, checksumFile );
+            File tempChecksumFile = new File( tempDestination + checksumFileExtension + ".tmp" );
+            tempChecksumFile.deleteOnExit();
+            wagon.get( remotePath + checksumFileExtension, tempChecksumFile );
-            String expectedChecksum = FileUtils.fileRead( checksumFile );
+            String expectedChecksum = FileUtils.fileRead( tempChecksumFile );
-            if ( !expectedChecksum.equals( actualChecksum ) )
+            if ( expectedChecksum.equals( actualChecksum ) )
+            {
+                File checksumFile = new File( destination + checksumFileExtension );
+                if ( checksumFile.exists() ) checksumFile.delete();
+                FileUtils.copyFile( tempChecksumFile, checksumFile );
+            }
+            else
