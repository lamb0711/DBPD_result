make surefire and rest of m2 independent of repo layout


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163751 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.DefaultArtifact;
+import org.apache.maven.artifact.repository.ArtifactRepository;
+import org.apache.maven.artifact.repository.layout.ArtifactPathFormatException;
- * @parameter name="mavenRepoLocal"
- * type="String"
- * required="true"
- * validator="validator"
- * expression="#maven.repo.local"
- * description=""
+ * @parameter name="localRepository" type="ArtifactRepository" required="true" validator="" expression="#localRepository" description=""
-    private String mavenRepoLocal;
-
+    private ArtifactRepository localRepository;
+
-        System.out.println( "Setting reports dir: " + reportsDirectory );
-        System.out.flush();
+        getLog().info( "Setting reports dir: " + reportsDirectory );
-        surefireBooter.addClassPathUrl( new File( mavenRepoLocal, "junit/jars/junit-3.8.1.jar" ).getPath() );
-
-        surefireBooter.addClassPathUrl(
-            new File( mavenRepoLocal, "surefire/jars/surefire-1.2-SNAPSHOT.jar" ).getPath() );
+        // TODO: we should really just trust the plugin classloader?
+        try
+        {
+            DefaultArtifact artifact = new DefaultArtifact( "junit", "junit", "3.8.1", "jar" );
+            File file = new File( localRepository.getBasedir(), localRepository.pathOf( artifact ) );
+            surefireBooter.addClassPathUrl( file.getAbsolutePath() );
+            artifact = new DefaultArtifact( "surefire", "surefire", "1.2", "jar" );
+            file = new File( localRepository.getBasedir(), localRepository.pathOf( artifact ) );
+            surefireBooter.addClassPathUrl( file.getAbsolutePath() );
+        }
+        catch ( ArtifactPathFormatException e )
+        {
+            throw new PluginExecutionException( "Error finding surefire JAR", e );
+        }
