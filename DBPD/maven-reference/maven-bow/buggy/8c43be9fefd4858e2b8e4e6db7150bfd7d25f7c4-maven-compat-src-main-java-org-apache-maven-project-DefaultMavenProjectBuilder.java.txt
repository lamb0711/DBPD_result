o Fixed backward-compat

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@830969 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.resolver.MultipleArtifactsNotFoundException;
+import org.apache.maven.model.DistributionManagement;
+import org.apache.maven.model.Model;
+import org.apache.maven.model.building.ModelBuildingException;
-    public MavenProject buildFromRepository( Artifact artifact, List<ArtifactRepository> remoteRepositories, ArtifactRepository localRepository, boolean force )
+    public MavenProject buildFromRepository( Artifact artifact, List<ArtifactRepository> remoteRepositories,
+                                             ArtifactRepository localRepository, boolean allowStubModel )
-        return buildFromRepository( artifact, remoteRepositories, localRepository );        
-    }
-
-    public MavenProject buildFromRepository( Artifact artifact, List<ArtifactRepository> remoteRepositories, ArtifactRepository localRepository )
-        throws ProjectBuildingException
-    {
-        ProjectBuilderConfiguration configuration = new DefaultProjectBuilderConfiguration()
-            .setLocalRepository( localRepository )
-            .setRemoteRepositories( remoteRepositories );
+        ProjectBuilderConfiguration configuration = new DefaultProjectBuilderConfiguration();
+        configuration.setLocalRepository( localRepository );
+        configuration.setRemoteRepositories( remoteRepositories );
-        return buildFromRepository( artifact, configuration );
+        try
+        {
+            return buildFromRepository( artifact, configuration );
+        }
+        catch ( ProjectBuildingException e )
+        {
+            if ( e.getCause() instanceof ModelBuildingException )
+            {
+                throw new InvalidProjectModelException( e.getProjectId(), e.getMessage(), e.getPomFile() );
+            }
+            else if ( e.getCause() instanceof MultipleArtifactsNotFoundException )
+            {
+                if ( allowStubModel )
+                {
+                    MavenProject stubProject = new MavenProject( createStubModel( artifact ) );
+                    stubProject.setParent( buildStandaloneSuperProject( configuration ) );
+                    return stubProject;
+                }
+            }
+
+            throw e;
+        }
+    }
+
+    private Model createStubModel( Artifact projectArtifact )
+    {
+        Model model = new Model();
+
+        model.setModelVersion( "4.0.0" );
+
+        model.setArtifactId( projectArtifact.getArtifactId() );
+
+        model.setGroupId( projectArtifact.getGroupId() );
+
+        model.setVersion( projectArtifact.getVersion() );
+
+        // TODO: not correct in some instances
+        model.setPackaging( projectArtifact.getType() );
+
+        model.setDistributionManagement( new DistributionManagement() );
+
+        model.getDistributionManagement().setStatus( "generated" );
+
+        return model;
+    }
+
+    public MavenProject buildFromRepository( Artifact artifact, List<ArtifactRepository> remoteRepositories,
+                                             ArtifactRepository localRepository )
+        throws ProjectBuildingException
+    {
+        return buildFromRepository( artifact, remoteRepositories, localRepository, true );
