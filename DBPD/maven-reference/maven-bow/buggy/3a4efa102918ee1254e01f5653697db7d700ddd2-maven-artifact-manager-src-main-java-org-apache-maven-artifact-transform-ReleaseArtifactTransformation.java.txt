PR: MNG-613
make sure versions are aggregated

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@278961 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.repository.metadata.ArtifactRepositoryMetadata;
+import org.apache.maven.artifact.repository.metadata.Versioning;
-        // metadata is added at install time
+        Versioning versioning = new Versioning();
+        versioning.addVersion( artifact.getVersion() );
+
+        if ( artifact.isRelease() )
+        {
+            versioning.setRelease( artifact.getVersion() );
+        }
+
+        // TODO: need to create?
+        ArtifactMetadata metadata = new ArtifactRepositoryMetadata( artifact, versioning );
+
+        artifact.addMetadata( metadata );
-        // metadata is added at deploy time
+        Versioning versioning = new Versioning();
+        versioning.addVersion( artifact.getVersion() );
+
+        if ( artifact.isRelease() )
+        {
+            versioning.setRelease( artifact.getVersion() );
+        }
+
+        // TODO: need to create?
+        ArtifactMetadata metadata = new ArtifactRepositoryMetadata( artifact, versioning );
+
+        artifact.addMetadata( metadata );
+
+        // TODO: this should be in the part that actually merges instead
+        getLogger().info( "Retrieving previous metadata from " + remoteRepository.getId() );
+        repositoryMetadataManager.resolveAlways( metadata, localRepository, remoteRepository );
-    protected String constructVersion( ArtifactMetadata metadata )
+    protected String constructVersion( Versioning versioning, String bS )
-        return metadata.getReleaseVersion();
+        return versioning.getRelease();
