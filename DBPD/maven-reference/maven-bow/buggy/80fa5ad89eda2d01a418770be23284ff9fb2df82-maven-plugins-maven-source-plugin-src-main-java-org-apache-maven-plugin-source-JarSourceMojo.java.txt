- fix issues with source mojo
- attach source artifact for install/deploy


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@191113 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.Artifact;
+import org.apache.maven.artifact.factory.ArtifactFactory;
+import org.apache.maven.project.MavenProject;
-     * @parameter expression="${project.version}"
+     * @parameter expression="${project}"
-    private String version;
+    private MavenProject project;
+
+    /**
+     * @parameter expression="${component.org.apache.maven.artifact.factory.ArtifactFactory}
+     */
+    private ArtifactFactory artifactFactory;
-     * @parameter expression="${project.build.outputDirectory}"
+     * @parameter expression="${project.build.directory}"
-        if ( version.indexOf( "SNAPSHOT" ) < 0 )
+        if ( project.getVersion().indexOf( "SNAPSHOT" ) < 0 )
+
+            // TODO: these introduced dependencies on the project are going to become problematic - can we export it
+            //  through metadata instead?
+            Artifact artifact = artifactFactory.createArtifactWithClassifier( project.getGroupId(),
+                                                                              project.getArtifactId(),
+                                                                              project.getVersion(), null, "java-source",
+                                                                              "sources" );
+            project.addAttachedArtifact( artifact );
