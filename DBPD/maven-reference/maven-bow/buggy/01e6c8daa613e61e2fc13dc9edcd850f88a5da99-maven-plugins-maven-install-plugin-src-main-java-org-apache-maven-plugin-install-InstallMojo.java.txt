PR: MNG-257

refactor artifact creation to all go through the factory, and assign the type handler from there.
Attach EJB client to the EJB artifact so that it is installed/deployed along with it.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@191096 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.factory.ArtifactFactory;
+import java.util.Iterator;
+import java.util.List;
+    /**
+     * @parameter expression="${project.attachedArtifacts}
+     * @required
+     * @readonly
+     */
+    private List attachedArtifacts;
+
+    /**
+     * @parameter expression="${component.org.apache.maven.artifact.factory.ArtifactFactory}"
+     * @required
+     * @readonly
+     */
+    private ArtifactFactory artifactFactory;
+
-        Artifact artifact = new DefaultArtifact( groupId, artifactId, version, packaging );
+        // TODO: maybe not strictly correct, while we should enfore that packaging has a type handler of the same id, we don't
+        Artifact artifact = artifactFactory.createArtifact( groupId, artifactId, version, null, packaging );
+
+            for ( Iterator i = attachedArtifacts.iterator(); i.hasNext(); )
+            {
+                Artifact attached = (Artifact) i.next();
+                installer.install( attached.getFile(), attached, localRepository );
+            }
