better dep handling in mboot


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163776 13f79535-47bb-0310-9956-ffa450edef68

+    private boolean insideDependencyManagement = false;
+
-            currentDependency = new Dependency();
+            if ( !insideDependencyManagement )
+            {
+                currentDependency = new Dependency();
-            insideDependency = true;
+                insideDependency = true;
+            }
+        }
+        else if ( rawName.equals( "dependencyManagement" ) )
+        {
+            insideDependencyManagement = true;
-            addDependencies( p.getDependencies(), parentDependencies );
+            addDependencies( p.getDependencies(), parentDependencies, null );
-                    addDependencies( p.getDependencies(), transitiveDependencies );
+                    addDependencies( p.getDependencies(), transitiveDependencies, currentDependency.getScope() );
+        else if ( rawName.equals( "dependencyManagement" ) )
+        {
+            insideDependencyManagement = false;
+        }
-    private void addDependencies( Collection dependencies, Map target )
+    private void addDependencies( Collection dependencies, Map target, String inheritedScope )
+            // Do we care about runtime here?
+            if ( "test".equals( inheritedScope ) )
+            {
+                d.setScope( "test" );
+            }
+
