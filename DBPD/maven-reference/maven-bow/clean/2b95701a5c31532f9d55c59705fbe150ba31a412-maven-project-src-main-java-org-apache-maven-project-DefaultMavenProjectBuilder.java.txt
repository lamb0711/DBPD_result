Rearranging project-builder caching so it's done externally and available for use in the model-lineage builder and during artifact resolution as well.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@509692 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.manager.WagonManager;
+import org.apache.maven.project.build.ProjectBuildCache;
-    private Map processedProjectCache = new HashMap();
-    
-    private Map cachedPomFilesByModelId = new HashMap();
-
-        String cacheKey = createCacheKey( artifact.getGroupId(), artifact.getArtifactId(), artifact.getVersion() );
-
-        MavenProject project = (MavenProject) processedProjectCache.get( cacheKey );
+        ProjectBuildCache projectBuildCache = ProjectBuildCache.read( buildContextManager );
+        
+        MavenProject project = (MavenProject) projectBuildCache.getCachedProject( artifact );
-        processedProjectCache.put( createCacheKey( project.getGroupId(), project.getArtifactId(), project.getVersion() ), project );
+        ProjectBuildCache projectBuildCache = ProjectBuildCache.read( buildContextManager );
+        projectBuildCache.cacheProject( project );
+        projectBuildCache.store( buildContextManager );
-            String cacheKey = createCacheKey( rawParent.getGroupId(), rawParent.getArtifactId(), rawParent.getVersion() );
-            
-            MavenProject processedParent = (MavenProject) processedProjectCache.get( cacheKey );
+            MavenProject processedParent = (MavenProject) projectBuildCache.getCachedProject( rawParent );
-        modelLineageBuilder.resumeBuildingModelLineage( modelLineage, localRepository, externalProfileManager, cachedPomFilesByModelId );
+        modelLineageBuilder.resumeBuildingModelLineage( modelLineage, localRepository, externalProfileManager );
