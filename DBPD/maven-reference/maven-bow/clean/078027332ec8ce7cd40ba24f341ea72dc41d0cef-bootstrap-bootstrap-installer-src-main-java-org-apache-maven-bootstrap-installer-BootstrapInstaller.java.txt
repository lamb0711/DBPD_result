Add system environment variables to commandline. mvn need at least SystemRoot under windows

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@345043 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.BufferedReader;
+import java.io.InputStreamReader;
+import java.util.Arrays;
-import java.util.Arrays;
+import java.util.Properties;
+    private Properties getEnvVars()
+        throws Exception
+    {
+        // TODO : put this method in Commandline class
+        Process p = null;
+
+        Properties envVars = new Properties();
+
+        Runtime r = Runtime.getRuntime();
+
+        String OS = System.getProperty( "os.name" ).toLowerCase();
+
+        if ( OS.indexOf( "windows 9" ) > -1 )
+        {
+            p = r.exec( "command.com /c set" );
+        }
+        else if ( (OS.indexOf( "nt" ) > -1 )
+            || ( OS.indexOf( "windows 2000" ) > -1 )
+            || ( OS.indexOf( "windows xp" ) > -1) )
+        {
+            p = r.exec( "cmd.exe /c set" );
+        }
+        else
+        {
+            p = r.exec( "env" );
+        }
+
+        BufferedReader br = new BufferedReader( new InputStreamReader( p.getInputStream() ) );
+
+        String line;
+
+        while( ( line = br.readLine() ) != null )
+        {
+            int idx = line.indexOf( '=' );
+
+            String key = line.substring( 0, idx );
+
+            String value = line.substring( idx + 1 );
+
+            envVars.setProperty( key, value );
+            // System.out.println( key + " = " + value );
+        }
+
+        return envVars;
+    }
+
+        // we need to add actual environment variable, because they don't added in commandline when
+        //we add new environment variables
+        Properties envVars = getEnvVars();
+
+        for ( Iterator i = envVars.keySet().iterator(); i.hasNext(); )
+        {
+            String key = (String) i.next();
+
+            cli.addEnvironment( key, envVars.getProperty( key ) );
+        }
+
