[MNG-4892] Use of --log-file doesn't capture all output, e.g. from maven-antrun-plugin


git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1032976 13f79535-47bb-0310-9956-ffa450edef68

-    private PrintStream out;
+    static interface Provider
+    {
+        PrintStream getStream();
+    }
+
+    private Provider provider;
+    public PrintStreamLogger( Provider provider )
+    {
+        super( Logger.LEVEL_INFO, Maven.class.getName() );
+
+        if ( provider == null )
+        {
+            throw new IllegalArgumentException( "output stream provider missing" );
+        }
+        this.provider = provider;
+    }
+
-    public void setStream( PrintStream out )
+    public void setStream( final PrintStream out )
-        this.out = out;
+        this.provider = new Provider()
+        {
+            public PrintStream getStream()
+            {
+                return out;
+            }
+        };
+            PrintStream out = provider.getStream();
+
+            PrintStream out = provider.getStream();
+
+            PrintStream out = provider.getStream();
+
+            PrintStream out = provider.getStream();
+
+            PrintStream out = provider.getStream();
+
+        PrintStream out = provider.getStream();
+
