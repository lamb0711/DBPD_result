Rearranging project-builder caching so it's done externally and available for use in the model-lineage builder and during artifact resolution as well.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@509692 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashMap;
+import java.util.Map;
+
+    private static final String SYSTEM_PROPERTIES_KEY = "system-properties";
+
+    private static final String ENVIRONMENT_VARIABLES_KEY = "environment-variables";
-        SystemBuildContext systemContext = null;
+        SystemBuildContext systemContext = new SystemBuildContext();
-            systemContext = (SystemBuildContext) buildContext.get( BUILD_CONTEXT_KEY );
+            SystemBuildContext ctx = new SystemBuildContext();
+            
+            if ( buildContext.retrieve( ctx ) || create )
+            {
+                systemContext = ctx;
+            }
-        buildContext.put( this );
+        buildContext.store( this );
+
+    public Map getData()
+    {
+        Map data = new HashMap( 2 );
+        data.put( SYSTEM_PROPERTIES_KEY, systemProperties );
+        data.put( ENVIRONMENT_VARIABLES_KEY, envars );
+        
+        return data;
+    }
+
+    public void setData( Map data )
+    {
+        this.systemProperties = (Properties) data.get( SYSTEM_PROPERTIES_KEY );
+        this.envars = (Properties) data.get( ENVIRONMENT_VARIABLES_KEY );
+    }
