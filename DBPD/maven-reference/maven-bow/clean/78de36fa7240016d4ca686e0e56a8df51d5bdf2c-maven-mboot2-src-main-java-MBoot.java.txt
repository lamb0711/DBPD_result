We use now the new modello.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163160 13f79535-47bb-0310-9956-ffa450edef68

-        "modello/jars/modello-1.0-SNAPSHOT.jar",
+        "modello/jars/modello-core-1.0-SNAPSHOT.jar",
+        "modello/jars/modello-xdoc-plugin-1.0-SNAPSHOT.jar",
+        "modello/jars/modello-xml-plugin-1.0-SNAPSHOT.jar",
+        "modello/jars/modello-xpp3-plugin-1.0-SNAPSHOT.jar",
+    String[] modelloDeps = new String[]
+    {
+        "classworlds/jars/classworlds-1.1-SNAPSHOT.jar",
+        "plexus/jars/plexus-0.16.jar",
+        "maven/jars/maven-artifact-2.0-SNAPSHOT.jar",
+        "modello/jars/modello-core-1.0-SNAPSHOT.jar",
+//        "modello/jars/modello-xdoc-plugin-1.0-SNAPSHOT.jar",
+        "modello/jars/modello-xml-plugin-1.0-SNAPSHOT.jar",
+        "modello/jars/modello-xpp3-plugin-1.0-SNAPSHOT.jar",
+        "xpp3/jars/xpp3-1.1.3.3.jar",
+        "xstream/jars/xstream-1.0-SNAPSHOT.jar"
+    };
+
-            generateSources( model.getAbsolutePath(), "xpp3", generatedSources, "4.0.0", "false" );
+            generateSources( model.getAbsolutePath(), "xpp3-reader", generatedSources, "4.0.0", "false" );
-            generateSources( model.getAbsolutePath(), "xpp3", generatedSources, "3.0.0", "true" );
+            generateSources( model.getAbsolutePath(), "xpp3-reader", generatedSources, "3.0.0", "true" );
+
+            generateSources( model.getAbsolutePath(), "xpp3-writer", generatedSources, "4.0.0", "false" );
+
+            generateSources( model.getAbsolutePath(), "xpp3-writer", generatedSources, "3.0.0", "true" );
-        Class c = cl.loadClass( "org.codehaus.modello.Modello" );
+        IsolatedClassLoader modelloClassLoader = new IsolatedClassLoader();
+
+        for ( Iterator i = Arrays.asList( modelloDeps ).iterator(); i.hasNext(); )
+        {
+            String dependency = (String) i.next();
+
+            File f = new File( repoLocal, dependency );
+            if ( !f.exists() )
+            {
+                throw new FileNotFoundException( "Missing dependency: " + dependency + 
+                    ( !online ? "; run again online" : "; there was a problem downloading it earlier" ) );
+            }
+
+            modelloClassLoader.addURL( f.toURL() );
+        }
+
+        Class c = modelloClassLoader.loadClass( "org.codehaus.modello.ModelloCli" );
-        Thread.currentThread().setContextClassLoader( cl );
+        Thread.currentThread().setContextClassLoader( modelloClassLoader );
