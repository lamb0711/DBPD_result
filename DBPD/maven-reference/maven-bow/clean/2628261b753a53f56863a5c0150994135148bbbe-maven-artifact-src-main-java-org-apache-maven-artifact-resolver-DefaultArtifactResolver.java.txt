PR: MNG-207
fix scope issue in a conflict


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163587 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.DefaultArtifact;
- *       AbstractArtifactResolver that does the transitive boilerplate
+ * AbstractArtifactResolver that does the transitive boilerplate
-            logger.debug("Resolving: " + artifact.getId() + " from:\n" +
-                    "{localRepository: " + localRepository + "}\n" +
-                    "{remoteRepositories: " + remoteRepositories + "}");
-            
+            logger.debug( "Resolving: " + artifact.getId() + " from:\n" + "{localRepository: " + localRepository +
+                          "}\n" + "{remoteRepositories: " + remoteRepositories + "}" );
+
-        sb.append( "The artifact is not present locally as:" )
-          .append( LS )
-          .append( LS )
-          .append( artifact.getPath() )
-          .append( LS )
-          .append( LS )
-          .append( "or in any of the specified remote repositories:" )
-          .append( LS )
-          .append( LS );
+        sb.append( "The artifact is not present locally as:" ).append( LS ).append( LS ).append( artifact.getPath() ).append(
+            LS ).append( LS ).append( "or in any of the specified remote repositories:" ).append( LS ).append( LS );
-        ArtifactRepository localRepository, ArtifactMetadataSource source, ArtifactFilter filter )
+                                                         ArtifactRepository localRepository,
+                                                         ArtifactMetadataSource source, ArtifactFilter filter )
-        ArtifactRepository localRepository, ArtifactMetadataSource source ) throws ArtifactResolutionException
+                                                         ArtifactRepository localRepository,
+                                                         ArtifactMetadataSource source )
+        throws ArtifactResolutionException
-        ArtifactRepository localRepository, ArtifactMetadataSource source ) throws ArtifactResolutionException
+                                                         ArtifactRepository localRepository,
+                                                         ArtifactMetadataSource source )
+        throws ArtifactResolutionException
-        List remoteRepositories, ArtifactMetadataSource source, ArtifactFilter filter )
+                                              List remoteRepositories, ArtifactMetadataSource source,
+                                              ArtifactFilter filter )
+
+                    // TODO: scope handler
+                    boolean updateScope = false;
+                    if ( Artifact.SCOPE_RUNTIME.equals( newArtifact.getScope() ) &&
+                        Artifact.SCOPE_TEST.equals( knownArtifact.getScope() ) )
+                    {
+                        updateScope = true;
+                    }
+
+                    if ( Artifact.SCOPE_COMPILE.equals( newArtifact.getScope() ) &&
+                        !Artifact.SCOPE_COMPILE.equals( knownArtifact.getScope() ) )
+                    {
+                        updateScope = true;
+                    }
+
+                    if ( updateScope )
+                    {
+                        // TODO: Artifact factory?
+                        Artifact artifact = new DefaultArtifact( knownArtifact.getGroupId(),
+                                                                 knownArtifact.getArtifactId(), knownVersion,
+                                                                 newArtifact.getScope(), knownArtifact.getType(),
+                                                                 knownArtifact.getExtension() );
+                        resolvedArtifacts.put( artifact.getConflictId(), artifact );
+                    }
-                        throw new TransitiveArtifactResolutionException( "Error retrieving metadata [" + newArtifact
-                            + "] : ", e );
+                        throw new TransitiveArtifactResolutionException( "Error retrieving metadata [" + newArtifact +
+                                                                         "] : ", e );
