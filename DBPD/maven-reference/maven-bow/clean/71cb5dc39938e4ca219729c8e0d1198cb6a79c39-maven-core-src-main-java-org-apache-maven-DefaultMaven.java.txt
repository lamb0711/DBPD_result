Resolving: MNG-282



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@227259 13f79535-47bb-0310-9956-ffa450edef68

-
+            
-                topLevelProject = (MavenProject) projects.get( 0 );
+                topLevelProject = findTopLevelProject( projects, request.getPomFile() );
+                
+    private MavenProject findTopLevelProject( List projects, String customPomPath ) throws IOException
+    {
+        File topPomFile;
+        
+        if ( customPomPath != null )
+        {
+            topPomFile = new File( customPomPath ).getCanonicalFile();
+        }
+        else
+        {
+            topPomFile = new File( userDir, RELEASE_POMv4 );
+            
+            if ( !topPomFile.exists() )
+            {
+                topPomFile = new File( userDir, POMv4 );
+                
+                if ( !topPomFile.exists() )
+                {
+                    getLogger().warn( "Cannot find top-level project file in directory: " + userDir + ". Using first project in project-list." );
+                    
+                    return (MavenProject) projects.get( 0 );
+                }
+            }
+        }
+        
+        MavenProject topProject = null;
+        
+        for ( Iterator it = projects.iterator(); it.hasNext(); )
+        {
+            MavenProject project = (MavenProject) it.next();
+            
+            File projectFile = project.getFile().getCanonicalFile();
+            
+            if ( topPomFile.equals( projectFile ) )
+            {
+                topProject = project;
+                break;
+            }
+        }
+        
+        return topProject;
+    }
+
