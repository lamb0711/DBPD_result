o Completed marmalade-mojo support, tested with m2 bootstrap with empty local repo and maven-core pegged at 2/26/2005.

  Will resolve CI issues as soon as lifecycle is fixed for IT0013.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163430 13f79535-47bb-0310-9956-ffa450edef68

+import org.codehaus.marmalade.runtime.MarmaladeExecutionContext;
+import org.codehaus.marmalade.runtime.MarmaladeExecutionException;
+import java.util.Iterator;
+
-    private MarmaladeTag realRoot;
-
-    protected boolean shouldAddChild( MarmaladeTag child )
+    protected boolean alwaysProcessChildren()
-        if ( child instanceof ExecuteTag )
+        return false;
+    }
+    
+    protected void doExecute( MarmaladeExecutionContext context ) throws MarmaladeExecutionException
+    {
+        for ( Iterator it = children().iterator(); it.hasNext(); )
-            this.realRoot = child;
-
-            // we don't ever want THIS script to execute the ExecuteTag.
-            // Instead,
-            // we pull it out for later wrapping into a new script.
-            return false;
-        }
-        else
-        {
-            return true;
+            MarmaladeTag child = (MarmaladeTag) it.next();
+            if(!(child instanceof ExecuteTag))
+            {
+                child.execute(context);
+            }
-
+    
+        MarmaladeTag realRoot = null;
+        for ( Iterator it = children().iterator(); it.hasNext(); )
+        {
+            MarmaladeTag child = (MarmaladeTag) it.next();
+            if(child instanceof ExecuteTag)
+            {
+                realRoot = child;
+                break;
+            }
+        }
+        
+        if(realRoot == null)
+        {
+            throw new IllegalStateException("Mojo scripts MUST have a <execute> tag.");
+        }
+        
