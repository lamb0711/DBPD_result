include optional direct dependencies in classpath and resolve artifacts.
These are not included in project.getTestArtifacts() while they should be required if dependency is direct (seems to be a problem only with reactor projects).
Modified master test in order to manually check file content instead of comparing files (easier to explain and comment, ignore order).


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@330040 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.resolver.filter.ScopeArtifactFilter;
+        ScopeArtifactFilter scopeFilter = new ScopeArtifactFilter( Artifact.SCOPE_RUNTIME );
+
-            if ( "jar".equals( type ) || "ejb".equals( type ) || "ejb-client".equals( type )
-                && !Artifact.SCOPE_PROVIDED.equals( artifact.getScope() ) )
+            if ( ( scopeFilter.include( artifact ) || Artifact.SCOPE_SYSTEM.equals( artifact.getScope() ) )
+                && ( "jar".equals( type ) || "ejb".equals( type ) || "ejb-client".equals( type ) ) )
+
+                log.info( "Adding artifact " + artifact.getId() + " optional=" + artifact.isOptional() );
