Improve rendering.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@169385 13f79535-47bb-0310-9956-ffa450edef68

+import org.codehaus.plexus.util.StringUtils;
-    private Sink sink;
-    public PmdReportListener( Sink sink )
+    private Sink sink;
+
+    private String sourceDirectory;
+
+    private String currentFilename;
+
+    private boolean fileInitialized;
+
+    public PmdReportListener( Sink sink, String sourceDirectory )
+        this.sourceDirectory = sourceDirectory;
+        if ( ! fileInitialized )
+        {
+            sink.section2();
+            sink.sectionTitle2();
+            sink.text( currentFilename );
+            sink.sectionTitle2_();
+
+            sink.table();
+            sink.tableRow();
+            sink.tableHeaderCell();
+            sink.text( "Violation" );
+            sink.tableHeaderCell_();
+            sink.tableHeaderCell();
+            sink.text( "Line" );
+            sink.tableHeaderCell_();
+            sink.tableRow_();
+
+            fileInitialized = true;
+        }
-        sink.section2();
-        sink.sectionTitle2();
-        sink.text( file.getPath() );
-        sink.sectionTitle2_();
-
-        sink.table();
-        sink.tableRow();
-        sink.tableHeaderCell();
-        sink.text( "Violation" );
-        sink.tableHeaderCell_();
-        sink.tableHeaderCell();
-        sink.text( "Line" );
-        sink.tableHeaderCell_();
-        sink.tableRow_();
+        currentFilename = StringUtils.substring( file.getAbsolutePath(), sourceDirectory.length() + 1 );
+        currentFilename = StringUtils.replace( currentFilename, "\\", "/" );
+        fileInitialized = false;
-        sink.table_();
-        sink.section2_();
+        if ( fileInitialized )
+        {
+            sink.table_();
+            sink.section2_();
+        }
