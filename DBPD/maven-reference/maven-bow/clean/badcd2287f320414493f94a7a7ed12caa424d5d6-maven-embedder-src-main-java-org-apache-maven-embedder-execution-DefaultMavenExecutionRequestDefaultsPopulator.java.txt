o roll back to wagon beta-2 to fix the rash of problems with m2eclipse plugin


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@516654 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.manager.WagonManager;
-import org.apache.maven.wagon.manager.RepositorySettings;
-import org.apache.maven.wagon.manager.WagonManager;
-import org.codehaus.plexus.configuration.xml.XmlPlexusConfiguration;
+import org.codehaus.plexus.component.repository.exception.ComponentLifecycleException;
+import org.codehaus.plexus.component.repository.exception.ComponentLookupException;
-            wagonManager.addTransferListener( request.getTransferListener() );
+            wagonManager.setDownloadMonitor( request.getTransferListener() );
-        catch ( SettingsConfigurationException e )
+        catch ( Exception e )
-        throws SettingsConfigurationException
+        throws ComponentLookupException, ComponentLifecycleException, SettingsConfigurationException
-        Proxy proxy = settings.getActiveProxy();
+        WagonManager wagonManager = (WagonManager) container.lookup( WagonManager.ROLE );
-        if ( proxy != null )
+        try
-            if ( proxy.getHost() == null )
+            Proxy proxy = settings.getActiveProxy();
+
+            if ( proxy != null )
-                throw new SettingsConfigurationException( "Proxy in settings.xml has no host" );
+                if ( proxy.getHost() == null )
+                {
+                    throw new SettingsConfigurationException( "Proxy in settings.xml has no host" );
+                }
+
+                wagonManager.addProxy( proxy.getProtocol(), proxy.getHost(), proxy.getPort(), proxy.getUsername(),
+                                       proxy.getPassword(), proxy.getNonProxyHosts() );
-            wagonManager.addProxy( proxy.getProtocol(), proxy.getHost(), proxy.getPort(), proxy.getUsername(), proxy
-                .getPassword(), proxy.getNonProxyHosts() );
-        }
-
-        for ( Iterator i = settings.getServers().iterator(); i.hasNext(); )
-        {
-            Server server = (Server) i.next();
-
-            RepositorySettings repoSetting = wagonManager.getRepositorySettings( server.getId() );
-
-            repoSetting.setAuthentication( server.getUsername(), server.getPassword(), server.getPrivateKey(), server
-                .getPassphrase() );
-
-            repoSetting
-                .setPermissions( /* group */null, server.getFilePermissions(), server.getDirectoryPermissions() );
-
-            if ( server.getConfiguration() != null )
+            for ( Iterator i = settings.getServers().iterator(); i.hasNext(); )
-                repoSetting.setConfiguration( new XmlPlexusConfiguration( (Xpp3Dom) server.getConfiguration() ) );
+                Server server = (Server) i.next();
+
+                wagonManager.addAuthenticationInfo( server.getId(), server.getUsername(), server.getPassword(),
+                                                    server.getPrivateKey(), server.getPassphrase() );
+
+                wagonManager.addPermissionInfo( server.getId(), server.getFilePermissions(),
+                                                server.getDirectoryPermissions() );
+
+                if ( server.getConfiguration() != null )
+                {
+                    wagonManager.addConfiguration( server.getId(), (Xpp3Dom) server.getConfiguration() );
+                }
+            }
+
+            for ( Iterator i = settings.getMirrors().iterator(); i.hasNext(); )
+            {
+                Mirror mirror = (Mirror) i.next();
+
+                wagonManager.addMirror( mirror.getId(), mirror.getMirrorOf(), mirror.getUrl() );
-
-        for ( Iterator i = settings.getMirrors().iterator(); i.hasNext(); )
+        finally
-            Mirror mirror = (Mirror) i.next();
-
-            try
-            {
-                wagonManager.addRepositoryMirror( mirror.getMirrorOf(), mirror.getId(), mirror.getUrl() );
-            }
-            catch ( IllegalArgumentException e )
-            {
-                throw new SettingsConfigurationException(
-                    "Unable to configure mirror " + mirror + ": " + e.getMessage(), e );
-            }
+            container.release( wagonManager );
