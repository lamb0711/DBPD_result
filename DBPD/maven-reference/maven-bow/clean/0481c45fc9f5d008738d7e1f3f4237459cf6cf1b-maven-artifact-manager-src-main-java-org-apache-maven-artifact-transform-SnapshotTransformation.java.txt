repair snapshot build numbering (previous code makes it get stuck at 1).

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@240405 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.ArtifactUtils;
-import java.util.HashMap;
-import java.util.Map;
-    private int deploymentBuildNumber = 1;
-
-    private Map buildNumbers = new HashMap();
-
-                
-                updateDeploymentBuildNumber( artifact, metadata.getTimestamp(), metadata.getBuildNumber() );
-                getLogger().debug(
-                                   "Snapshot version metadata for: " + artifact.getId()
-                                       + " not found. Creating a new metadata instance.", e );
-                
+                getLogger().debug( "Snapshot version metadata for: " + artifact.getId() +
+                    " not found. Creating a new metadata instance.", e );
+
-            metadata.setVersion( getDeploymentTimestamp(), deploymentBuildNumber );
+            metadata.setVersion( getDeploymentTimestamp(), metadata.getBuildNumber() + 1 );
-    private void updateDeploymentBuildNumber( Artifact artifact, String timestamp, int buildNumberFromMetadata )
-    {
-        // we only have to handle bumping the build number if we're on the same timestamp, somehow...miraculously
-        if ( deploymentTimestamp.equals( timestamp ) )
-        {
-            String artifactKey = ArtifactUtils.versionlessKey( artifact );
-            
-            Integer buildNum = (Integer) buildNumbers.get( artifactKey );
-            
-            if ( buildNum == null || buildNum.intValue() <= buildNumberFromMetadata )
-            {
-                buildNum = new Integer( buildNumberFromMetadata + 1 );
-                
-                buildNumbers.put( artifactKey, buildNum );
-            }
-        }
-    }
-
-    
-    public int getDeploymentBuildNumber( Artifact artifact )
-    {
-        String artifactKey = ArtifactUtils.versionlessKey( artifact );
-        
-        Integer buildNum = (Integer) buildNumbers.get( artifactKey );
-        
-        if ( buildNum == null )
-        {
-            buildNum = new Integer( 1 );
-            buildNumbers.put( artifactKey, buildNum );
-        }
-        
-        return buildNum.intValue();
-    }
-    public String getDeploymentVersion( Artifact artifact )
-    {
-        int buildnum = getDeploymentBuildNumber( artifact );
-        
-        SnapshotArtifactMetadata metadata = (SnapshotArtifactMetadata) createMetadata( artifact );
-        
-        metadata.setVersion( getDeploymentTimestamp(), buildnum );
-        
-        return metadata.constructVersion();
-    }
-
