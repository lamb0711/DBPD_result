Put back in repository helper due to problems of building with clean repo.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@700813 13f79535-47bb-0310-9956-ffa450edef68

+    private RepositoryHelper repositoryHelper;
+
-                config.getLocalRepository(), buildArtifactRepositories(
+                config.getLocalRepository(), repositoryHelper.buildArtifactRepositories(
-        }
-        File originalArtifactFile = artifact.getFile();
-        File f;
-        if ( !"pom".equals( artifact.getType() ) )
-        {
-            Artifact a = artifactFactory.createProjectArtifact( artifact.getGroupId(), artifact.getArtifactId(),
-                                                                     artifact.getVersion(), artifact.getScope() );
-            f = new File( localRepository.getBasedir(), localRepository.pathOf( a ) );
-        } else
-        {
-            f = (artifact.getFile() != null) ? artifact.getFile() : new File( localRepository.getBasedir(), localRepository.pathOf( artifact ) );
-        }
+        }        
+        
+        File f = (artifact.getFile() != null) ? artifact.getFile() :
+                new File( localRepository.getBasedir(), localRepository.pathOf( artifact ) );;
+        repositoryHelper.findModelFromRepository( artifact, remoteArtifactRepositories, localRepository );
-        artifactRepositories.addAll( buildArtifactRepositories( getSuperProject( config, f, false ).getModel() ) );
+        artifactRepositories.addAll( repositoryHelper.buildArtifactRepositories( getSuperProject( config, artifact.getFile(), false ).getModel() ) );
-        project = readModelFromLocalPath( "unknown", f, new PomArtifactResolver( config.getLocalRepository(), artifactRepositories, artifactResolver ), config );
-        project = buildInternal( project.getModel(), config, f, project.getParentFile(), false );
+        project = readModelFromLocalPath( "unknown", artifact.getFile(), new PomArtifactResolver( config.getLocalRepository(), artifactRepositories, artifactResolver ), config );
+        project = buildInternal( project.getModel(), config, artifact.getFile(), project.getParentFile(), false );
-        artifact.setFile( originalArtifactFile );
-
+        artifact.setFile( f );
-
-    public List buildArtifactRepositories( Model model )
-        throws ProjectBuildingException
-    {
-        try
-        {
-            return mavenTools.buildArtifactRepositories( model.getRepositories() );
-        }
-        catch ( InvalidRepositoryException e )
-        {
-            String projectId = safeVersionlessKey( model.getGroupId(), model.getArtifactId() );
-
-            throw new ProjectBuildingException( projectId, e.getMessage(), e );
-        }
-    }
-
