[MNG-4106] [regression] Interpolation does not use properties from dominant settings profile if other profile defines same property

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@757584 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Iterator;
-        for ( Profile profile : projectProfiles )
+        try
-            try
+            // TODO: Review why this blows up the tests when we inject all the profiles in one go
+            for ( Iterator<Profile> it = projectProfiles.iterator(); it.hasNext(); )
-                model = inject( profile, model );
+                Profile profile = it.next();
+                PomClassicDomainModel dm =
+                    ProcessorContext.mergeProfilesIntoModel( Arrays.asList( profile ), model, false );
+                if ( !it.hasNext() )
+                {
+                    ProcessorContext.interpolateModelProperties( dm.getModelProperties(),
+                                                                 new ArrayList<InterpolatorProperty>(), dm );
+                    dm = new PomClassicDomainModel( dm.getModelProperties(), false );
+                }
+                model = dm.getModel();
-            catch ( IOException e )
-            {
+        }
+        catch ( IOException e )
+        {
-                throw new ProjectBuildingException(projectId, "", projectDescriptor, e);
-            }
+            throw new ProjectBuildingException(projectId, "", projectDescriptor, e);
-    private Model inject( Profile profile, Model model ) throws IOException
-    {
-        return ProcessorContext.mergeProfilesIntoModel( Arrays.asList(profile), model, false ).getModel();
-    }
-
