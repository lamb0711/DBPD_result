[MNG-4840] Prerequisites is not working on m3

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1055174 13f79535-47bb-0310-9956-ffa450edef68

+import org.codehaus.plexus.component.annotations.Requirement;
-import org.codehaus.plexus.util.IOUtil;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.util.Properties;
+import org.codehaus.plexus.util.StringUtils;
- *
+ * 
-    private static final String MAVEN_GROUPID = "org.apache.maven";
-    private static final String MAVEN_PROPERTIES = "META-INF/maven/" + MAVEN_GROUPID + "/maven-core/pom.properties";
+    @Requirement
+    private org.apache.maven.rtinfo.RuntimeInformation rtInfo;
-        InputStream resourceAsStream = null;
-        try
-        {
-            Properties properties = new Properties();
-            resourceAsStream = getClass().getClassLoader().getResourceAsStream( MAVEN_PROPERTIES );
+        String mavenVersion = rtInfo.getMavenVersion();
-            if ( resourceAsStream == null )
-            {
-                throw new IllegalStateException( "Unable to find Maven properties in classpath: " + MAVEN_PROPERTIES );
-            }
-            properties.load( resourceAsStream );
-
-            String property = properties.getProperty( "version" );
-            if ( property == null )
-            {
-                throw new InitializationException( "maven-core properties did not include the version" );
-            }
-
-            applicationVersion = new DefaultArtifactVersion( property );
-        }
-        catch ( IOException e )
+        if ( StringUtils.isEmpty( mavenVersion ) )
-            throw new InitializationException( "Unable to read properties file from maven-core", e );
+            throw new InitializationException( "Unable to read Maven version from maven-core" );
-        finally
-        {
-            IOUtil.close( resourceAsStream );
-        }
+
+        applicationVersion = new DefaultArtifactVersion( mavenVersion );
+
