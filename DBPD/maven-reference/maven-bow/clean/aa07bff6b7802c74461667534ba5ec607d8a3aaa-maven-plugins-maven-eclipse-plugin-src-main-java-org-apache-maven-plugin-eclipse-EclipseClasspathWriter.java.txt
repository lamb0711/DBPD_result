fix missing optional dependencies in .wtpmodules, cleanup test and introduce a test using MavenEmbedder (currently disabled due to a couple of issues, but it should replace the command line test)

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@330946 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Set;
-        // @todo direct optional artifacts are not included in the list returned by project.getTestArtifacts()
-        // .classpath should include ANY direct dependency, and optional dependencies are required to compile
-        Set depArtifacts = project.getDependencyArtifacts();
-        for ( Iterator it = depArtifacts.iterator(); it.hasNext(); )
-        {
-            Artifact artifact = (Artifact) it.next();
-            if ( artifact.isOptional() && !artifacts.contains( artifact ) )
-            {
-                try
-                {
-                    artifactResolver.resolve( artifact, remoteArtifactRepositories, localRepository );
-                }
-                catch ( ArtifactResolutionException e )
-                {
-                    log.error( "Unable to resolve optional artifact " + artifact.getId() );
-                    continue;
-                }
-                catch ( ArtifactNotFoundException e )
-                {
-                    log.error( "Unable to resolve optional artifact " + artifact.getId() );
-                    continue;
-                }
-                artifacts.add( artifact );
-            }
-        }
+        EclipseUtils.fixMissingOptionalArtifacts( artifacts, project.getDependencyArtifacts(), localRepository,
+                                                  artifactResolver, remoteArtifactRepositories, log );
