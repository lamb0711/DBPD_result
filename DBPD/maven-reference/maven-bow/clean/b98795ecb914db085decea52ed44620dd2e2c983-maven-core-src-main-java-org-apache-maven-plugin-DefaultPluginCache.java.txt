[MNG-3281] Revisit backwards compat of extensions (IT 0114)

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@815761 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.project.MavenProject;
-        
+
+        private final ClassRealm projectRealm;
+
-        public CacheKey( Plugin plugin, ArtifactRepository localRepository, List<ArtifactRepository> remoteRepositories )
+        public CacheKey( Plugin plugin, MavenProject project, ArtifactRepository localRepository,
+                         List<ArtifactRepository> remoteRepositories )
+            this.projectRealm = project.getClassRealm();
+            hash = hash * 31 + ( projectRealm != null ? projectRealm.hashCode() : 0 );
-            return pluginEquals( plugin, other.plugin ) && eq(repositories, other.repositories);
+            return projectRealm == other.projectRealm && pluginEquals( plugin, other.plugin )
+                && eq( repositories, other.repositories );
-    public CacheRecord get( Plugin plugin, ArtifactRepository localRepository,
+    public CacheRecord get( Plugin plugin, MavenProject project, ArtifactRepository localRepository,
-        return cache.get( new CacheKey( plugin, localRepository, remoteRepositories ) );
+        return cache.get( new CacheKey( plugin, project, localRepository, remoteRepositories ) );
-    public void put( Plugin plugin, ArtifactRepository localRepository, List<ArtifactRepository> remoteRepositories,
-                     ClassRealm pluginRealm, List<Artifact> pluginArtifacts )
+    public void put( Plugin plugin, MavenProject project, ArtifactRepository localRepository,
+                     List<ArtifactRepository> remoteRepositories, ClassRealm pluginRealm, List<Artifact> pluginArtifacts )
-        CacheKey key = new CacheKey( plugin, localRepository, remoteRepositories );
+        CacheKey key = new CacheKey( plugin, project, localRepository, remoteRepositories );
