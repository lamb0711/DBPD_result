Removing pluginRepository use (finally), and fixing pluginGroups usage with profiles from the settings and super-POM without an accompanying pom.xml in the project directory...I know, something of a convoluted case.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@599692 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.plugin.loader.PluginLoader;
+import org.apache.maven.model.PluginManagement;
+import java.util.HashSet;
+import java.util.Set;
-    private PluginLoader pluginLoader;
-
+            Set managedPluginsWithExtensionsFlag = new HashSet();
+
-                checkModelBuildForExtensions( model, request, inheritedRemoteRepositories );
+                grabManagedPluginsWithExtensionsFlagTurnedOn( model, managedPluginsWithExtensionsFlag );
+
+                checkModelBuildForExtensions( model, request, inheritedRemoteRepositories, managedPluginsWithExtensionsFlag );
+    private void grabManagedPluginsWithExtensionsFlagTurnedOn( Model model,
+                                                               Set managedPluginsWithExtensionsFlag )
+    {
+        Build build = model.getBuild();
+        if ( build != null )
+        {
+            PluginManagement pluginManagement = build.getPluginManagement();
+            if ( pluginManagement != null )
+            {
+                List plugins = pluginManagement.getPlugins();
+                if ( ( plugins != null ) && !plugins.isEmpty() )
+                {
+                    for ( Iterator it = plugins.iterator(); it.hasNext(); )
+                    {
+                        Plugin plugin = (Plugin) it.next();
+                        if ( plugin.isExtensions() )
+                        {
+                            managedPluginsWithExtensionsFlag.add( plugin.getKey() );
+                        }
+                    }
+                }
+            }
+        }
+    }
+
-    private void checkModelBuildForExtensions( Model model, MavenExecutionRequest request, List remoteRepositories )
+    private void checkModelBuildForExtensions( Model model,
+                                               MavenExecutionRequest request,
+                                               List remoteRepositories,
+                                               Set managedPluginsWithExtensionsFlag )
-                    if ( plugin.isExtensions() )
+                    if ( plugin.isExtensions() || managedPluginsWithExtensionsFlag.contains( plugin.getKey() ) )
