o look for the maven.repo.local system property first like maven does itself
o a hack to prevent velocity resource loading errors from triggering failures. when generating archetypes in tests
  the velocity resources loader always freaks out and cries error when it's not fatal.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@394244 13f79535-47bb-0310-9956-ffa450edef68

-                if ( line.indexOf( "[ERROR]" ) >= 0 )
+                // A hack to keep stupid velocity resource loader errors from triggering failure
+                if ( line.indexOf( "[ERROR]" ) >= 0 && line.indexOf( "VM_global_library.vm" ) == -1 )
-            boolean useMavenRepoLocal =
-                Boolean.valueOf( controlProperties.getProperty( "use.mavenRepoLocal", "true" ) ).booleanValue();
+            boolean useMavenRepoLocal = Boolean.valueOf( controlProperties.getProperty( "use.mavenRepoLocal", "true" ) ).booleanValue();
+
+            localRepo = System.getProperty( "maven.repo.local" );
+        }
+
+        if ( localRepo == null )
+        {
-            localRepo = System.getProperty( "maven.repo.local", System.getProperty( "user.home" ) + "/.m2/repository" );
+            localRepo = System.getProperty( "user.home" ) + "/.m2/repository";
