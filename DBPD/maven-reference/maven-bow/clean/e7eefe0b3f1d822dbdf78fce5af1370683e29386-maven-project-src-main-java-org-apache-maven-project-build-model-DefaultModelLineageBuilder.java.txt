Pushing project workspace usage out of ProjectCacheAspect into DefaultMavenProjectBuilder and DefaultModelLineageBuilder, to make it easier to understand how these critical pieces of logic execute relative to other pieces of the project-building process, such as managed-dependency merging.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@636023 13f79535-47bb-0310-9956-ffa450edef68

-        ModelAndFile current = new ModelAndFile( readModel( pom ), pom, validProfilesXmlLocation );
+        ModelAndFile current = projectWorkspace.getModelAndFile( pom );
+        if ( current == null )
+        {
+            current = new ModelAndFile( readModel( pom ), pom, validProfilesXmlLocation );
+            projectWorkspace.storeModelAndFile( current );
+        }
+            String key = modelParent.getGroupId() + ":" + modelParent.getArtifactId() + ":" + modelParent.getVersion();
+            getLogger().debug( "Checking cache for parent model-and-file instance: " + key );
+
+            result = projectWorkspace.getModelAndFile( modelParent.getGroupId(), modelParent.getArtifactId(), modelParent.getVersion() );
+
+            if ( result != null )
+            {
+                getLogger().debug( "Returning cached instance." );
+                return result;
+            }
+
+            getLogger().debug( "Allowing parent-model resolution to proceed for: " + key + " (child is: " + model.getId() + ")" );
+
-                        getLogger().debug( "DISREGARDING the error encountered while resolving artifact for: "
-                                                           + modelParent.getId()
-                                                           + ", building a stub model in its place.",
-                                           e );
+                        getLogger().warn( "An error was encountered while resolving artifact for: "
+                                          + modelParent.getId() + "\n\nError was: "
+                                          + e.getMessage() );
+
+                        if ( getLogger().isDebugEnabled() )
+                        {
+                            getLogger().debug( "Stack trace: ", e );
+                        }
+
-                                      + ". Using stub model instead." );
+                                      + ".\n\nMaven is using a stub model instead for this build." );
+        if ( result != null )
+        {
+            getLogger().debug( "Caching parent model-and-file: " + result );
+            projectWorkspace.storeModelAndFile( result );
+        }
+
