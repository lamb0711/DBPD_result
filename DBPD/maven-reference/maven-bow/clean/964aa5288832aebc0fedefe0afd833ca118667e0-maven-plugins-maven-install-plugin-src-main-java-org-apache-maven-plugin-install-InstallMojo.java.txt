convert install mojo to new execute().


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163660 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.Artifact;
+import org.apache.maven.artifact.DefaultArtifact;
+import org.apache.maven.artifact.installer.ArtifactInstallationException;
+import org.apache.maven.artifact.installer.ArtifactInstaller;
+import org.apache.maven.artifact.repository.ArtifactRepository;
+import org.apache.maven.plugin.AbstractPlugin;
+import org.apache.maven.plugin.PluginExecutionException;
+import org.apache.maven.project.MavenProject;
+
+import java.io.File;
+
+ * @author <a href="mailto:evenisse@apache.org">Emmanuel Venisse</a>
+ * @version $Id$
- *
- *
- *
- *
- *
-    extends AbstractInstallMojo
+    extends AbstractPlugin
+    private MavenProject project;
+
+    private ArtifactInstaller installer;
+
+    private ArtifactRepository localRepository;
+
+    public void execute()
+        throws PluginExecutionException
+    {
+        // Install the POM
+        Artifact pomArtifact = new DefaultArtifact( project.getGroupId(), project.getArtifactId(),
+                                                    project.getVersion(), "pom" );
+
+        File pom = new File( project.getFile().getParentFile(), "pom.xml" );
+
+        try
+        {
+            installer.install( pom, pomArtifact, localRepository );
+
+            //Install artifact
+            if ( !"pom".equals( project.getPackaging() ) )
+            {
+                Artifact artifact = new DefaultArtifact( project.getGroupId(), project.getArtifactId(),
+                                                         project.getVersion(), project.getPackaging() );
+
+                installer.install( project.getBuild().getDirectory(), artifact, localRepository );
+            }
+        }
+        catch ( ArtifactInstallationException e )
+        {
+            // TODO: install exception that does not give a trace
+            throw new PluginExecutionException( "Error installing artifact", e );
+        }
+    }
