[MNG-4199] [regression] Dependency resolution for compile and runtime scope misses provided&system dependencies

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@784480 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashSet;
-import org.apache.maven.artifact.Artifact;
-                    projectDependenciesResolver.resolve( currentProject, executionPlan.getRequiredResolutionScope(), session.getLocalRepository(), currentProject.getRemoteArtifactRepositories() );
+                    projectDependenciesResolver.resolve( currentProject, executionPlan.getRequiredResolutionScopes(), session.getLocalRepository(), currentProject.getRemoteArtifactRepositories() );
-        String requiredDependencyResolutionScope = null;
+        Set<String> requiredDependencyResolutionScopes = new HashSet<String>();
-            requiredDependencyResolutionScope = calculateRequiredDependencyResolutionScope( requiredDependencyResolutionScope, mojoDescriptor.isDependencyResolutionRequired() );
+            if ( StringUtils.isNotEmpty( mojoDescriptor.isDependencyResolutionRequired() ) )
+            {
+                requiredDependencyResolutionScopes.add( mojoDescriptor.isDependencyResolutionRequired() );
+            }
-        return new MavenExecutionPlan( lifecyclePlan, requiredDependencyResolutionScope );
+        return new MavenExecutionPlan( lifecyclePlan, requiredDependencyResolutionScopes );
-    // SCOPE_COMPILE
-    // SCOPE_TEST
-    // SCOPE_RUNTIME
-    //
-    String calculateRequiredDependencyResolutionScope( String currentRequiredDependencyResolutionScope, String inputScope )
-    {
-        if ( inputScope == null )
-        {
-            return currentRequiredDependencyResolutionScope;
-        }
-                
-        if ( currentRequiredDependencyResolutionScope == null && inputScope != null )
-        {
-            return inputScope;
-        }
-
-        if ( currentRequiredDependencyResolutionScope.equals( Artifact.SCOPE_COMPILE ) && ( inputScope.equals(  Artifact.SCOPE_RUNTIME ) || inputScope.equals( Artifact.SCOPE_TEST ) ) )
-        {
-            return inputScope;
-        }
-
-        if ( currentRequiredDependencyResolutionScope.equals( Artifact.SCOPE_RUNTIME ) && inputScope.equals(  Artifact.SCOPE_TEST ) )
-        {
-            return inputScope;
-        }        
-        
-        // Nothing changed we return what we were
-        //
-        return currentRequiredDependencyResolutionScope;
-    }
-    
