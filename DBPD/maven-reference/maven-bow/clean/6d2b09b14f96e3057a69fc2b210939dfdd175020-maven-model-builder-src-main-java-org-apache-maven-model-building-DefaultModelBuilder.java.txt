o Refactored code

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@797809 13f79535-47bb-0310-9956-ffa450edef68

+        resultData.setGroupId( resultModel.getGroupId() );
+        resultData.setArtifactId( resultModel.getArtifactId() );
+        resultData.setVersion( resultModel.getVersion() );
+
+        result.setProblems( problems );
+
+        result.setEffectiveModel( resultModel );
+
+        result.setActiveExternalProfiles( activeExternalProfiles );
+
+        for ( ModelData currentData : lineage )
+        {
+            String modelId = ( currentData != superData ) ? currentData.getId() : "";
+
+            result.addModelId( modelId );
+            result.setActivePomProfiles( modelId, currentData.getActiveProfiles() );
+            result.setRawModel( modelId, currentData.getRawModel() );
+        }
+
+        build( request, result );
+
+        return result;
+    }
+
+    public ModelBuildingResult build( ModelBuildingRequest request, ModelBuildingResult result )
+        throws ModelBuildingException
+    {
+        Model resultModel = result.getEffectiveModel();
+
+        List<ModelProblem> problems = result.getProblems();
+
-        resultData.setGroupId( resultModel.getGroupId() );
-        resultData.setArtifactId( resultModel.getArtifactId() );
-        resultData.setVersion( resultModel.getVersion() );
-
-        result.setProblems( problems );
-
-        result.setEffectiveModel( resultModel );
-
-        result.setActiveExternalProfiles( activeExternalProfiles );
-
-        for ( ModelData currentData : lineage )
-        {
-            String modelId = ( currentData != superData ) ? currentData.getId() : "";
-
-            result.addModelId( modelId );
-            result.setActivePomProfiles( modelId, currentData.getActiveProfiles() );
-            result.setRawModel( modelId, currentData.getRawModel() );
-        }
-
-        StringBuilder buffer = new StringBuilder( 128 );
+        StringBuilder buffer = new StringBuilder( 192 );
-        StringBuilder buffer = new StringBuilder( 64 );
-
-        if ( model.getGroupId() != null )
+        String groupId = model.getGroupId();
+        if ( groupId == null && model.getParent() != null )
-            buffer.append( model.getGroupId() );
-        }
-        else if ( model.getParent() != null && model.getParent().getGroupId() != null )
-        {
-            buffer.append( model.getParent().getGroupId() );
-        }
-        else
-        {
-            buffer.append( "[unknown-group-id]" );
+            groupId = model.getParent().getGroupId();
-        buffer.append( ':' );
+        String artifactId = model.getArtifactId();
-        if ( model.getArtifactId() != null )
+        String version = model.getVersion();
+        if ( version == null && model.getParent() != null )
-            buffer.append( model.getArtifactId() );
-        }
-        else
-        {
-            buffer.append( "[unknown-artifact-id]" );
+            version = model.getParent().getVersion();
-        buffer.append( ':' );
-
-        if ( model.getVersion() != null )
-        {
-            buffer.append( model.getVersion() );
-        }
-        else if ( model.getParent() != null && model.getParent().getVersion() != null )
-        {
-            buffer.append( model.getParent().getVersion() );
-        }
-        else
-        {
-            buffer.append( "[unknown-version]" );
-        }
-
-        return buffer.toString();
+        return toId( groupId, artifactId, version );
-        StringBuilder buffer = new StringBuilder( 64 );
-
-        buffer.append( parent.getGroupId() );
-        buffer.append( ':' );
-        buffer.append( parent.getArtifactId() );
-        buffer.append( ':' );
-        buffer.append( parent.getVersion() );
-
-        return buffer.toString();
+        return toId( parent.getGroupId(), parent.getArtifactId(), parent.getVersion() );
-        StringBuilder buffer = new StringBuilder( 64 );
+        return toId( dependency.getGroupId(), dependency.getArtifactId(), dependency.getVersion() );
+    }
-        buffer.append( dependency.getGroupId() );
+    private String toId( String groupId, String artifactId, String version )
+    {
+        StringBuilder buffer = new StringBuilder( 96 );
+
+        buffer.append( ( groupId != null ) ? groupId : "[unknown-group-id]" );
-        buffer.append( dependency.getArtifactId() );
+        buffer.append( ( artifactId != null ) ? artifactId : "[unknown-artifact-id]" );
-        buffer.append( dependency.getVersion() );
+        buffer.append( ( version != null ) ? version : "[unknown-version]" );
