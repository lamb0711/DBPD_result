[MNG-4048] Allow to resolve dependencies using version range from reactor

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@816180 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.Collection;
-        return retrieveAvailableVersionsFromMetadata( metadata.getMetadata() );
+        List<String> availableVersions = request.getLocalRepository().findVersions( request.getArtifact() );
+
+        return retrieveAvailableVersionsFromMetadata( metadata.getMetadata(), availableVersions );
+
-        return retrieveAvailableVersionsFromMetadata( metadata.getMetadata() );
+        List<String> availableVersions = localRepository.findVersions( artifact );
+
+        return retrieveAvailableVersionsFromMetadata( metadata.getMetadata(), availableVersions );
-    private List<ArtifactVersion> retrieveAvailableVersionsFromMetadata( Metadata repoMetadata )
+    private List<ArtifactVersion> retrieveAvailableVersionsFromMetadata( Metadata repoMetadata, List<String> availableVersions )
-        List<ArtifactVersion> versions;
+        Collection<String> versions = new LinkedHashSet<String>();
-            List<String> metadataVersions = repoMetadata.getVersioning().getVersions();
-
-            versions = new ArrayList<ArtifactVersion>( metadataVersions.size() );
-
-            for ( String version : metadataVersions )
-            {
-                versions.add( new DefaultArtifactVersion( version ) );
-            }
+            versions.addAll( repoMetadata.getVersioning().getVersions() );
-        else
+
+        versions.addAll( availableVersions );
+
+        List<ArtifactVersion> artifactVersions = new ArrayList<ArtifactVersion>( versions.size() );
+
+        for ( String version : versions )
-            versions = Collections.<ArtifactVersion> emptyList();
+            artifactVersions.add( new DefaultArtifactVersion( version ) );
-        return versions;
+        return artifactVersions;
