o Fixed repo logging to go consistently through listener

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@998715 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.File;
-import org.sonatype.aether.repository.LocalRepositoryManager;
+
+        metadataRequests.add( new MetadataRequest( metadata, null, request.getRequestContext() ) );
+
+
-        LocalRepositoryManager lrm = session.getLocalRepositoryManager();
-        File localMetadataFile = new File( lrm.getRepository().getBasedir(), lrm.getPathForLocalMetadata( metadata ) );
-        if ( localMetadataFile.isFile() )
-        {
-            metadata = metadata.setFile( localMetadataFile );
-            Versioning versioning = readVersions( session, metadata, result );
-            for ( String version : versioning.getVersions() )
-            {
-                if ( !versionIndex.containsKey( version ) )
-                {
-                    versionIndex.put( version, lrm.getRepository() );
-                }
-            }
-        }
-
-            Versioning versioning = readVersions( session, metadataResult.getMetadata(), result );
+
+            ArtifactRepository repository = metadataResult.getRequest().getRepository();
+            if ( repository == null )
+            {
+                repository = session.getLocalRepository();
+            }
+
+            Versioning versioning = readVersions( session, metadataResult.getMetadata(), repository, result );
-                    versionIndex.put( version, metadataResult.getRequest().getRepository() );
+                    versionIndex.put( version, repository );
-    private Versioning readVersions( RepositorySystemSession session, Metadata metadata, VersionRangeResult result )
+    private Versioning readVersions( RepositorySystemSession session, Metadata metadata, ArtifactRepository repository,
+                                     VersionRangeResult result )
-            invalidMetadata( session, metadata, e );
+            invalidMetadata( session, metadata, repository, e );
-    private void invalidMetadata( RepositorySystemSession session, Metadata metadata, Exception exception )
+    private void invalidMetadata( RepositorySystemSession session, Metadata metadata, ArtifactRepository repository,
+                                  Exception exception )
+            event.setRepository( repository );
