attempt to fix CI by forcing the use of mboot built snapshots


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163725 13f79535-47bb-0310-9956-ffa450edef68

+import util.IOUtil;
+import java.io.FileWriter;
+import java.io.StringReader;
-                                         "maven-plugins/maven-ejb-plugin", "maven-plugins/maven-install-plugin",
-                                         "maven-plugins/maven-jar-plugin", "maven-plugins/maven-plugin-plugin",
-                                         "maven-plugins/maven-resources-plugin", "maven-plugins/maven-surefire-plugin",
-                                         "maven-plugins/maven-war-plugin"};
+                                         "maven-plugins/maven-ejb-plugin", /*"maven-plugins/maven-idea-plugin",*/
+                                         "maven-plugins/maven-install-plugin", "maven-plugins/maven-jar-plugin",
+                                         "maven-plugins/maven-plugin-plugin", "maven-plugins/maven-resources-plugin",
+                                         "maven-plugins/maven-surefire-plugin", "maven-plugins/maven-war-plugin"};
-            installPlugin( basedir, repoLocal, reader );
+            install( basedir, repoLocal, reader, "maven-plugin" );
-            installJar( basedir, repoLocal, reader );
+            install( basedir, repoLocal, reader, "jar" );
-    private void installJar( String basedir, String repoLocal, ModelReader reader )
+    private void install( String basedir, String repoLocal, ModelReader reader, String type )
-        File jar = new File( repoLocal, "/" + groupId + "/jars/" + artifactId + "-" + version + ".jar" );
+        String finalName = artifactId + "-" + version;
-        System.out.println( "Installing JAR: " + jar );
+        File file = new File( repoLocal, "/" + groupId + "/" + type + "s/" + finalName + ".jar" );
-        FileUtils.copyFile( new File( basedir, BUILD_DIR + "/" + artifactId + "-" + version + ".jar" ), jar );
-    }
+        System.out.println( "Installing: " + file );
-    private void installPlugin( String basedir, String repoLocal, ModelReader reader )
-        throws Exception
-    {
-        String artifactId = reader.artifactId;
+        FileUtils.copyFile( new File( basedir, BUILD_DIR + "/" + finalName + ".jar" ), file );
-        String version = reader.version;
-
-        String groupId = reader.groupId;
-
-        if ( groupId == null )
+        if ( version.indexOf( "SNAPSHOT" ) >= 0 )
-            groupId = reader.parentGroupId;
+            File metadata = new File( repoLocal, "/" + groupId + "/poms/" + finalName + ".version.txt" );
+
+            IOUtil.copy( new StringReader( version ), new FileWriter( metadata ) );
-
-        if ( version == null )
-        {
-            version = reader.parentVersion;
-        }
-
-        File jar = new File( repoLocal, "/" + groupId + "/maven-plugins/" + artifactId + "-" + version + ".jar" );
-
-        System.out.println( "Installing Plugin: " + jar );
-
-        FileUtils.copyFile( new File( basedir, BUILD_DIR + "/" + artifactId + "-" + version + ".jar" ), jar );
