o Committing changes submitted by Trygve Laugst��l to accomodate the new form
of specifying a parent model to use which is of the form:

<parent>
  <groupId/>
  <artifactId/>
  <version/>
</parent>

This allows us to work consistently from the local repository or the unified
source root where missing models are downloaded now that we have the required
information within the <parent/> element.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@162656 13f79535-47bb-0310-9956-ffa450edef68

-import org.xml.sax.Attributes;
-import org.xml.sax.InputSource;
-import org.xml.sax.SAXParseException;
-import org.xml.sax.helpers.DefaultHandler;
-
-import javax.xml.parsers.SAXParser;
-import javax.xml.parsers.SAXParserFactory;
+import javax.xml.parsers.SAXParser;
+import javax.xml.parsers.SAXParserFactory;
+
+import org.xml.sax.Attributes;
+import org.xml.sax.InputSource;
+import org.xml.sax.SAXParseException;
+import org.xml.sax.SAXException;
+import org.xml.sax.helpers.DefaultHandler;
+
+    private int pomVersion;
+
-        bootstrapPomParser.parse( new File( "project.xml" ) );
+        if( ! bootstrapPomParser.parse( new File( "project.xml" ) ) )
+        {
+            System.err.println( "Could not parse project.xml" );
+            System.exit( 1 );
+        }
+        private String parentGroupId;
+
+        private String parentArtifactId;
+
+        private String parentVersion;
+
+        private boolean insideParent = false;
+
-        public void parse( File file )
+        public boolean parse( File file )
+
+                return true;
+
+                return false;
-            if ( rawName.equals( "unitTest" ) )
+            if ( rawName.equals( "parent" ) )
+            {
+                insideParent = true;
+            }
+            else if ( rawName.equals( "unitTest" ) )
+            throws SAXException
-            if ( rawName.equals( "extend" ) )
+            if ( rawName.equals( "parent" ) )
-                String extend = interpolate( getBodyText(), properties );
+                File f;
-                File f = new File( file.getParentFile(), extend );
+                // support both v3 <extend> and v4 <parent>
+                if( getBodyText() == null )
+                {
+                    String extend = interpolate( getBodyText(), properties );
+
+                    f = new File( file.getParentFile(), extend );
+                }
+                else
+                {
+                    if ( parentArtifactId == null || parentArtifactId.trim().length() == 0 )
+                        throw new SAXException( "Missing required element in <parent>: artifactId." );
+
+                    if ( parentGroupId == null || parentGroupId.trim().length() == 0 )
+                        throw new SAXException( "Missing required element in <parent>: groupId." );
+
+                    if ( parentVersion == null || parentVersion.trim().length() == 0 )
+                        throw new SAXException( "Missing required element in <parent>: version." );
+
+                    f = new File( downloader.getMavenRepoLocal(), parentGroupId + "/poms/" + parentArtifactId + "-" + parentVersion + ".pom" );
+                }
-                p.parse( f );
+                if ( ! p.parse( f ) )
+                    throw new SAXException( "Could not parse parent project.xml" );
+
+                insideParent = false;
+            else if ( insideParent )
+            {
+                if ( rawName.equals( "groupId" ) )
+                {
+                    parentGroupId = getBodyText();
+                }
+                else if ( rawName.equals( "artifactId" ) )
+                {
+                    parentArtifactId = getBodyText();
+                }
+                else if ( rawName.equals( "version" ) )
+                {
+                    parentVersion = getBodyText();
+                }
+            }
