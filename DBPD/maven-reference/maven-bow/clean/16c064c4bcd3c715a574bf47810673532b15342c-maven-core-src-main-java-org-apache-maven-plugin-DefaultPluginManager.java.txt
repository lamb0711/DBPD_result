Cleaning up extension and plugin realms for a project once the build completes.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@588029 13f79535-47bb-0310-9956-ffa450edef68

-        ClassRealm pluginRealm = pluginDescriptor.getClassRealm();
+        MavenProjectSession projectSession;
+        try
+        {
+            projectSession = session.getProjectSession( project );
+        }
+        catch ( PlexusContainerException e )
+        {
+            throw new PluginManagerException( mojoDescriptor, "Failed to create project-specific session for project: " + project.getId()
+                                                + ".", project, e );
+        }
+
+        ClassRealm pluginRealm;
+        try
+        {
+            pluginRealm = projectSession.getPluginRealm( pluginDescriptor );
+        }
+        catch ( NoSuchRealmException e )
+        {
+            getLogger().debug( "Plugin realm: " + pluginDescriptor.getId() + " not found in project session for: " + project.getId() + ". Using project realm instead." );
+            pluginRealm = projectSession.getProjectRealm();
+        }
+
+            pluginDescriptor.setClassRealm( null );
+        pluginDescriptor.setClassRealm( realm );
