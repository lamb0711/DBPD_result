fix for MNG-1324 "System" dependencies path non correctly added to eclipse buildpath
path is fixed by overwriting artifact file with the path returned by dependency.getSystemPath()

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@329851 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.File;
+import java.io.FileWriter;
+import java.io.IOException;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Set;
+
-import java.io.File;
-import java.io.FileWriter;
-import java.io.IOException;
-import java.util.Iterator;
-import java.util.List;
-
-                          EclipseSourceDir[] sourceDirs, ArtifactRepository localRepository )
+                         EclipseSourceDir[] sourceDirs, ArtifactRepository localRepository )
-            throw new MojoExecutionException( Messages.getString( "EclipsePlugin.erroropeningfile" ),
-                                              ex ); //$NON-NLS-1$
+            throw new MojoExecutionException( Messages.getString( "EclipsePlugin.erroropeningfile" ), ex ); //$NON-NLS-1$
-                                            List referencedReactorArtifacts, ArtifactRepository localRepository )
+                                           List referencedReactorArtifacts, ArtifactRepository localRepository )
+        Set artifacts = project.getArtifacts();
+        EclipseUtils.fixSystemScopeArtifacts( artifacts, project.getDependencies() );
+
-        for ( Iterator it = project.getArtifacts().iterator(); it.hasNext(); )
+        for ( Iterator it = artifacts.iterator(); it.hasNext(); )
-            addDependency( writer, artifact, referencedReactorArtifacts, localRepository );
+            String type = artifact.getType();
+
+            if ( "jar".equals( type ) || "ejb".equals( type ) || "ejb-client".equals( type ) )
+            {
+                addDependency( writer, artifact, referencedReactorArtifacts, localRepository );
+            }
-                                ArtifactRepository localRepository )
+                               ArtifactRepository localRepository )
-            handle = "module:/resource/" + artifact.getArtifactId() + "/" +
-                artifact.getArtifactId(); //$NON-NLS-1$ //$NON-NLS-2$
+            handle = "module:/resource/" + artifact.getArtifactId() + "/" + artifact.getArtifactId(); //$NON-NLS-1$ //$NON-NLS-2$
-            File localRepositoryFile = new File( localRepository.getBasedir() );
-            handle = "module:/classpath/var/M2_REPO/" //$NON-NLS-1$
-                + EclipseUtils.toRelativeAndFixSeparator( localRepositoryFile, fullPath, false );
+            if ( Artifact.SCOPE_SYSTEM.equals( artifact.getScope() ) )
+            {
+                handle = "module:/classpath/lib/" //$NON-NLS-1$
+                    + StringUtils.replace( fullPath, "\\", "/" );
+            }
+            else
+            {
+                File localRepositoryFile = new File( localRepository.getBasedir() );
+
+                handle = "module:/classpath/var/M2_REPO/" //$NON-NLS-1$
+                    + EclipseUtils.toRelativeAndFixSeparator( localRepositoryFile, fullPath, false );
+            }
