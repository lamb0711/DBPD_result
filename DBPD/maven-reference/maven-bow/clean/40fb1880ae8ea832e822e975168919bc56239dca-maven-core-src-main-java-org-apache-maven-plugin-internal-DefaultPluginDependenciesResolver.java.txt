[MNG-4840] Prerequisites is not working on m3

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1055174 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.LinkedHashMap;
+import java.util.Map;
+import org.sonatype.aether.resolution.ArtifactDescriptorException;
+import org.sonatype.aether.resolution.ArtifactDescriptorRequest;
+import org.sonatype.aether.resolution.ArtifactDescriptorResult;
+import org.sonatype.aether.util.FilterRepositorySystemSession;
+            RepositorySystemSession pluginSession = new FilterRepositorySystemSession( session )
+            {
+                @Override
+                public boolean isIgnoreMissingArtifactDescriptor()
+                {
+                    return false;
+                }
+            };
+
+            ArtifactDescriptorRequest request =
+                new ArtifactDescriptorRequest( pluginArtifact, repositories, REPOSITORY_CONTEXT );
+            ArtifactDescriptorResult result = repoSystem.readArtifactDescriptor( pluginSession, request );
+
+            pluginArtifact = result.getArtifact();
+
+            String requiredMavenVersion = (String) result.getProperties().get( "prerequisites.maven" );
+            if ( requiredMavenVersion != null )
+            {
+                Map<String, String> props = new LinkedHashMap<String, String>( pluginArtifact.getProperties() );
+                props.put( "requiredMavenVersion", requiredMavenVersion );
+                pluginArtifact = pluginArtifact.setProperties( props );
+            }
+        }
+        catch ( ArtifactDescriptorException e )
+        {
+            throw new PluginResolutionException( plugin, e );
+        }
+
+        try
+        {
