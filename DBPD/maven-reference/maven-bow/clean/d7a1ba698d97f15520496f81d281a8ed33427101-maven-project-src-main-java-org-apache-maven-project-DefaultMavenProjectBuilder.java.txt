MNG-2364 make sure the system properties are passed from the execution/embed requests, to make the on-property profile activation work in embedded environment

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@415000 13f79535-47bb-0310-9956-ffa450edef68

+        //TODO mkleint - use the (Container, Properties) constructor to make system properties embeddable
+        ProfileManager profileManager = new DefaultProfileManager( container );
+        return buildStandaloneSuperProject( localRepository, profileManager );
+    }
+    
+    public MavenProject buildStandaloneSuperProject( ArtifactRepository localRepository, ProfileManager profileManager ) 
+        throws ProjectBuildingException
+    {
-        ProfileManager profileManager = new DefaultProfileManager( container );
-        ProfileManager superProjectProfileManager = new DefaultProfileManager( container );
+        //TODO mkleint - use the (Container, Properties) constructor to make system properties embeddable
+        // shall the ProfileManager intefrace expose the properties?
+        
+        ProfileManager superProjectProfileManager;
+        if (externalProfileManager instanceof DefaultProfileManager) {
+            superProjectProfileManager = new DefaultProfileManager( container, ((DefaultProfileManager) externalProfileManager).getSystemProperties() );
+        } else {
+            superProjectProfileManager = new DefaultProfileManager( container );
+        }
-        ProfileManager profileManager = new DefaultProfileManager( container );
+        //TODO mkleint - use the (Container, Properties constructor to make system properties embeddable
+        ProfileManager profileManager;
+        if (externalProfileManager != null && externalProfileManager instanceof DefaultProfileManager ) {
+            profileManager = new DefaultProfileManager( container, ((DefaultProfileManager)externalProfileManager).getSystemProperties() );
+        } else {
+            profileManager = new DefaultProfileManager( container );
+        }
