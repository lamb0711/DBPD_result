snapshot resolution. commented out due to issues surrounding pom/artifact pairing


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163692 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.metadata.ArtifactMetadata;
+import org.apache.maven.wagon.ResourceDoesNotExistException;
-            artifact = transform.transformForResolve( artifact );
+            try
+            {
+                artifact = transform.transformForResolve( artifact, remoteRepositories, localRepository );
+            }
+            catch ( ArtifactMetadataRetrievalException e )
+            {
+                throw new ArtifactResolutionException( "Unable to transform artifact", e );
+            }
-            wagonManager.getArtifact( artifact, remoteRepositories, destination );
+            if ( artifact.getRepository() != null )
+            {
+                // the transformations discovered the artifact - so use it exclusively
+                wagonManager.getArtifact( artifact, artifact.getRepository(), destination );
+            }
+            else
+            {
+                wagonManager.getArtifact( artifact, remoteRepositories, destination );
+            }
+
+            // must be after the artifact is downloaded
+            for ( Iterator i = artifact.getMetadataList().iterator(); i.hasNext(); )
+            {
+                ArtifactMetadata metadata = (ArtifactMetadata) i.next();
+                metadata.storeInLocalRepository( localRepository );
+            }
+        }
+        catch ( ResourceDoesNotExistException e )
+        {
+            throw new ArtifactResolutionException( artifactNotFound( localPath, remoteRepositories ), e );
-            throw new ArtifactResolutionException( artifactNotFound( localPath, remoteRepositories ), e );
+            throw new ArtifactResolutionException( "Error downloading artifact " + artifact, e );
+        }
+        catch ( ArtifactMetadataRetrievalException e )
+        {
+            throw new ArtifactResolutionException( "Error downloading artifact " + artifact, e );
