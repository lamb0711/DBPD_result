Resolving: MNG-885

o Extracting basedir from the project instance when PluginParameterExpressionEvaluator is init'ed if project != null...otherwise, using ${user.dir} from sysprops.

o Extracting values for resolution from POM properties before POM instance during POM interpolation, and adding checks to guard against self-reference of POM elements.

o Added three ITs (one contra) to test these resolutions.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@291735 13f79535-47bb-0310-9956-ffa450edef68

+ * Use a regular expression search to find and resolve expressions within the POM.
+ * 
+ * @todo Consolidate this logic with the PluginParameterExpressionEvaluator, minus deprecations/bans.
-     * Added: Feb 3, 2005 by jdcasey
+     * Serialize the inbound Model instance to a StringWriter, perform the regex replacement to resolve 
+     * POM expressions, then re-parse into the resolved Model instance.
+     * <br/>
+     * <b>NOTE:</b> This will result in a different instance of Model being returned!!!
+     * 
+     * @param model The inbound Model instance, to serialize and reference for expression resolution
+     * @param context The other context map to be used during resolution
+     * @return The resolved instance of the inbound Model. This is a different instance!
-    /**
-     * Added: Feb 3, 2005 by jdcasey
-     */
+        throws ModelInterpolationException
+            if ( value == null )
+            {
+                value = model.getProperties().getProperty( realExpr );
+            }
+            
-                
-                if ( value == null )
-                {
-                    value = model.getProperties().getProperty( realExpr );
-                }
+            
+            // if the expression refers to itself, skip it.
+            if ( wholeExpr.equals( value ) )
+            {
+                throw new ModelInterpolationException( wholeExpr, model.getId() + " references itself." );
+            }
