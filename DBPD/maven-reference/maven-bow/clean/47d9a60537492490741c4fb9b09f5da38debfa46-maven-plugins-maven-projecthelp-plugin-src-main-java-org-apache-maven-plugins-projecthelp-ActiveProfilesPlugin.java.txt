Working on: MNG-786

o Changed the profile activation in it0075 to use a system property which is not always present

o Added projecthelp:active-profiles, package, and clean:clean to the goals list, in case it was only happening with the clean plugin

o Fixed the projecthelp mojos to be aggregators where appropriate

o Changed the ordering of modules in the profile injector (used to be that profile modules were prepended; now, they're appended)

NOTE: I still cannot reproduce the described behavior. Dan: Am I missing something WRT the test setup? I changed the activation trigger to be non-inherent, and I'm not using a boolean string to trigger the profile. What am I doing wrong??



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@292781 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.project.MavenProject;
+import java.io.File;
+import java.io.FileWriter;
+import java.io.IOException;
+import java.io.Writer;
+import java.util.Date;
+ * @aggregator
-     * @parameter expression="${project.activeProfiles}"
+     * This is the list of projects currently slated to be built by Maven.
+     * 
+     * @parameter expression="${reactorProjects}"
-    private List profiles;
+    private List projects;
+    
+    /**
+     * This is an optional parameter for a file destination for the output
+     * of this mojo...the listing of active profiles per project.
+     * 
+     * @parameter expression="${output}"
+     */
+    private File output;
+        for ( Iterator it = projects.iterator(); it.hasNext(); )
+        {
+            MavenProject project = (MavenProject) it.next();
+            
+            getActiveProfileStatement( project, message );
+            
+            message.append( "\n\n" );
+        }
+        
+        if ( output != null )
+        {
+            writeFile( message );
+        }
+        else
+        {
+            Log log = getLog();
+            log.info( message );
+        }
+    }
+    
+    private void writeFile( StringBuffer message ) 
+        throws MojoExecutionException
+    {
+        Writer writer = null;
+        try
+        {
+            File dir = output.getParentFile();
+            
+            if( !dir.exists() )
+            {
+                dir.mkdirs();
+            }
+            
+            writer = new FileWriter( output );
+            
+            writer.write( "Created by: " + getClass().getName() + "\n" );
+            writer.write( "Created on: " + new Date() + "\n\n" );
+            writer.write( message.toString() );
+            writer.flush();
+            
+            getLog().info( "Active profile report written to: " + output );
+        }
+        catch ( IOException e )
+        {
+            throw new MojoExecutionException( "Cannot write output to file: " + output, e );
+        }
+        finally
+        {
+            if ( writer != null )
+            {
+                try
+                {
+                    writer.close();
+                }
+                catch ( IOException e )
+                {
+                    getLog().debug( "Failed to close output file writer.", e );
+                }
+            }
+        }
+    }
+
+    private void getActiveProfileStatement( MavenProject project, StringBuffer message )
+    {
+        List profiles = project.getActiveProfiles();
+        
+        message.append( "Active Profiles for Project \'" + project.getId() + "\': \n\n" );
+        
-            message.append( "The following profiles are active:\n\n" );
+            message.append( "The following profiles are active:\n" );
-        message.append( "\n\n" );
-        
-        Log log = getLog();
-        
-        log.info( message );
-        
+        message.append( "\n" );
-    protected final List getProfiles()
+    public final void setProjects( List projects )
-        return profiles;
-    }
-
-    protected final void setProfiles( List profiles )
-    {
-        this.profiles = profiles;
+        this.projects = projects;
