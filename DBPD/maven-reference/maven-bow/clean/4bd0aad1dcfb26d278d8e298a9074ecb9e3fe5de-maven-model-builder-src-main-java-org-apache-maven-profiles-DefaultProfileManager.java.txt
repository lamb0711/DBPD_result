o Deleted old profile matches

git-svn-id: https://svn.apache.org/repos/asf/maven/components/branches/MNG-2766@777989 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.Collection;
-import java.util.Collections;
-import java.util.Properties;
-import org.apache.maven.profiles.matchers.DefaultMatcher;
-import org.apache.maven.profiles.matchers.FileMatcher;
-import org.apache.maven.profiles.matchers.JdkMatcher;
-import org.apache.maven.profiles.matchers.ProfileMatcher;
-import org.apache.maven.profiles.matchers.PropertyMatcher;
+import org.apache.maven.model.profile.activator.FileProfileActivator;
+import org.apache.maven.model.profile.activator.JdkVersionProfileActivator;
+import org.apache.maven.model.profile.activator.OperatingSystemProfileActivator;
+import org.apache.maven.model.profile.activator.ProfileActivator;
+import org.apache.maven.model.profile.activator.PropertyProfileActivator;
+@Deprecated
-    
-    private static final ProfileMatcher defaultMatcher = new DefaultMatcher();
-    private static final List<ProfileMatcher> matchers =
-        Collections.unmodifiableList( Arrays.asList( new PropertyMatcher(), new FileMatcher(), new JdkMatcher() ) );    
+    private static final List<ProfileActivator> activators =
+        Arrays.asList( new PropertyProfileActivator(), new OperatingSystemProfileActivator(),
+                       new FileProfileActivator(), new JdkVersionProfileActivator() );
- 
-    public static Collection<Profile> getActiveProfiles(List<Profile> profiles, ProfileManagerInfo profileContextInfo)
-    {
-        Properties properties = profileContextInfo.getInterpolatorProperties();
-        Collection<String> activeProfileIds = profileContextInfo.getActiveProfileIds();
-        Collection<String> inactiveProfileIds = profileContextInfo.getInactiveProfileIds();
-        
-        List<Profile> matchedProfiles = new ArrayList<Profile>();
-        List<Profile> defaultProfiles = new ArrayList<Profile>();
-        for ( Profile profile : profiles )
-        {
-            String profileId = profile.getId();
-
-            if ( !inactiveProfileIds.contains( profileId ) )
-            {
-                if ( activeProfileIds.contains( profileId ) )
-                {
-                    matchedProfiles.add( profile );
-                }
-                else if ( defaultMatcher.isMatch( profile, properties ) )
-                {
-                    defaultProfiles.add( profile );
-                }
-                else
-                {
-                    for ( ProfileMatcher matcher : matchers )
-                    {
-                        if ( matcher.isMatch( profile, properties ) )
-                        {
-                            matchedProfiles.add( profile );
-                            break;
-                        }
-                    }
-                }
-            }
-        }
-
-        if ( matchedProfiles.isEmpty() )
-        {
-            matchedProfiles = defaultProfiles;
-        }
-
-        return matchedProfiles;
-    }    
-        for(ProfileMatcher matcher : matchers)
+        for ( ProfileActivator activator : activators )
-            if(matcher.isMatch(profile, context.getExecutionProperties()))
+            try
-                return true;
+                if ( activator.isActive( profile, context ) )
+                {
+                    return true;
+                }
+            }
+            catch ( org.apache.maven.model.profile.ProfileActivationException e )
+            {
+                throw new ProfileActivationException( e.getMessage(), e.getCause() );
+
