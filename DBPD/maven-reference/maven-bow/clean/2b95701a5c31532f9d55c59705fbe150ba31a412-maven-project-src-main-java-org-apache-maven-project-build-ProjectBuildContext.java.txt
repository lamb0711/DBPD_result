Rearranging project-builder caching so it's done externally and available for use in the model-lineage builder and during artifact resolution as well.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@509692 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.HashMap;
+import java.util.Map;
+
+
+    private static final String MODEL_LINEAGE = "model-lineage";
+
+    private static final String CURRENT_PROJECT = "current-project";
-        ProjectBuildContext projectContext = null;
+        ProjectBuildContext projectContext = new ProjectBuildContext();
-            projectContext = (ProjectBuildContext) buildContext.get( BUILD_CONTEXT_KEY );
-        }
-        
-        if ( create && projectContext == null )
-        {
-            projectContext = new ProjectBuildContext();
+            if ( !buildContext.retrieve( projectContext ) && !create )
+            {
+                return null;
+            }
-        buildContext.put( this );
+        buildContext.store( this );
+
+    public Map getData()
+    {
+        Map data = new HashMap( 2 );
+        
+        data.put( MODEL_LINEAGE, modelLineage );
+        data.put( CURRENT_PROJECT, currentProject );
+        
+        return data;
+    }
+
+    public void setData( Map data )
+    {
+        this.modelLineage = (ModelLineage) data.get( MODEL_LINEAGE );
+        this.currentProject = (MavenProject) data.get( CURRENT_PROJECT );
+    }
