Collapsed methods, moved logic for active profiles from ProjectBuilder to ProfileContext.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@761121 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.project.ProjectBuilderConfiguration;
+import org.apache.maven.project.ProjectBuildingException;
+import org.apache.maven.model.Model;
+import org.codehaus.plexus.PlexusContainer;
-   // public Collection<Profile> getActiveProfilesFrom(ProfileManager manaa)
+    
+    public static List<Profile> getActiveProfilesFrom(ProjectBuilderConfiguration config, Model model, PlexusContainer container)
+    	throws ProfileActivationException
+    {
+        List<Profile> projectProfiles = new ArrayList<Profile>();
+        ProfileManager externalProfileManager = config.getGlobalProfileManager();
+        
+        ProfileActivationContext profileActivationContext = (externalProfileManager == null) ? new ProfileActivationContext( config.getExecutionProperties(), false ):
+            externalProfileManager.getProfileActivationContext();
+     
+        if(externalProfileManager != null)
+        {           
+        	projectProfiles.addAll( externalProfileManager.getActiveProfiles() );    
+        }
+
+        ProfileManager profileManager = new DefaultProfileManager( container, profileActivationContext );
+        profileManager.addProfiles( model.getProfiles() );
+        projectProfiles.addAll( profileManager.getActiveProfiles() ); 
+        return projectProfiles;
+    }
