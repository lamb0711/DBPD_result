o Prevented duplicates
o Made execution request more robust with regard to NPEs


git-svn-id: https://svn.apache.org/repos/asf/maven/components/branches/MNG-2766@777163 13f79535-47bb-0310-9956-ffa450edef68

+
-    private List<String> pluginGroups = new ArrayList<String>();
+    private List<String> pluginGroups;
-        copy.setOffline(  original.isOffline() );
+        copy.setOffline( original.isOffline() );
-        copy.setActiveProfiles( original.getActiveProfiles());
-        copy.setInactiveProfiles(  original.getInactiveProfiles());
-        copy.setTransferListener( original.getTransferListener());
-        copy.setLoggingLevel( original.getLoggingLevel());
-        copy.setGlobalChecksumPolicy( original.getGlobalChecksumPolicy());
-        copy.setUpdateSnapshots( original.isUpdateSnapshots());
+        copy.setActiveProfiles( original.getActiveProfiles() );
+        copy.setInactiveProfiles( original.getInactiveProfiles() );
+        copy.setTransferListener( original.getTransferListener() );
+        copy.setLoggingLevel( original.getLoggingLevel() );
+        copy.setGlobalChecksumPolicy( original.getGlobalChecksumPolicy() );
+        copy.setUpdateSnapshots( original.isUpdateSnapshots() );
+        if ( goals == null )
+        {
+            goals = new ArrayList<String>();
+        }
-        this.activeProfiles = activeProfiles;
+        getActiveProfiles().clear();
+        getActiveProfiles().addAll( activeProfiles );
-        this.inactiveProfiles = inactiveProfiles;
+        getInactiveProfiles().clear();
+        getInactiveProfiles().addAll( inactiveProfiles );
-        this.remoteRepositories = remoteRepositories;
+        getRemoteRepositories().clear();
+        getRemoteRepositories().addAll( remoteRepositories );
-        this.goals = goals;
+        getGoals().clear();
+        getGoals().addAll( goals );
-        if ( this.properties == null )
-        {
-            this.properties = properties;
-        }
-        else
-        {
-            this.properties.putAll( properties );
-        }
+        getProperties().clear();
+        getProperties().putAll( properties );
-        if ( properties == null )
-        {
-            properties = new Properties();
-        }
-
-        properties.setProperty( key, value );
+        getProperties().setProperty( key, value );
-        getActiveProfiles().add( profile );
+        if ( !getActiveProfiles().contains( profile ) )
+        {
+            getActiveProfiles().add( profile );
+        }
-        getInactiveProfiles().add( profile );
+        if ( !getInactiveProfiles().contains( profile ) )
+        {
+            getInactiveProfiles().add( profile );
+        }
-        getActiveProfiles().addAll( profiles );
+        for ( String profile : profiles )
+        {
+            addActiveProfile( profile );
+        }
-        getInactiveProfiles().addAll( profiles );
+        for ( String profile : profiles )
+        {
+            addInactiveProfile( profile );
+        }
+        if ( proxies == null )
+        {
+            proxies = new ArrayList();
+        }
-        this.proxies = proxies;
+        getProxies().clear();
+        getProxies().addAll( proxies );
+        if ( servers == null )
+        {
+            servers = new ArrayList();
+        }
-        this.servers = servers;
+        getServers().clear();
+        getServers().addAll( servers );
+        if ( mirrors == null )
+        {
+            mirrors = new ArrayList();
+        }
-        this.mirrors = mirrors;
+        getMirrors().clear();
+        getMirrors().addAll( mirrors );
+        if ( profiles == null )
+        {
+            profiles = new ArrayList<Profile>();
+        }
-        this.profiles = profiles;
+        getProfiles().clear();
+        getProfiles().addAll( profiles );
+        if ( pluginGroups == null )
+        {
+            pluginGroups = new ArrayList<String>();
+        }
+
-        this.pluginGroups = pluginGroups;
+        getPluginGroups().clear();
+        getPluginGroups().addAll( pluginGroups );
+
+        return this;
+    }
+
+    public MavenExecutionRequest addPluginGroup( String pluginGroup )
+    {
+        if ( !getPluginGroups().contains( pluginGroup ) )
+        {
+            getPluginGroups().add( pluginGroup );
+        }
-        if ( remoteRepositories == null )
+        for ( ArtifactRepository repo : getRemoteRepositories() )
-            remoteRepositories = new ArrayList<ArtifactRepository>();
+            if ( repo.getId() != null && repo.getId().equals( repository.getId() ) )
+            {
+                return this;
+            }
-        remoteRepositories.add( repository );
+        getRemoteRepositories().add( repository );
+        if ( remoteRepositories == null )
+        {
+            remoteRepositories = new ArrayList<ArtifactRepository>();
+        }
-        if ( profiles == null )
+        for ( Profile p : getProfiles() )
-            profiles = new ArrayList<Profile>();
+            if ( p.getId() != null && p.getId().equals( profile.getId() ) )
+            {
+                return this;
+            }
-        profiles.add( profile );
+        getProfiles().add( profile );
