

git-svn-id: https://svn.apache.org/repos/asf/maven/components/branches/MNG-2766@757141 13f79535-47bb-0310-9956-ffa450edef68

-                
+                        
-            String pluginVersion = plugin.getVersion();
-
-            logger.debug( "Resolving plugin: " + plugin.getKey() + " with version: " + pluginVersion );
-            
-            if ( ( pluginVersion == null ) || Artifact.LATEST_VERSION.equals( pluginVersion ) || Artifact.RELEASE_VERSION.equals( pluginVersion ) )
-            {
-                logger.debug( "Resolving version for plugin: " + plugin.getKey() );
-                
-                pluginVersion = resolvePluginVersion( plugin.getGroupId(), plugin.getArtifactId(), project, session );
-                
-                plugin.setVersion( pluginVersion );
-
-                logger.debug( "Resolved to version: " + pluginVersion );
-            }
-                         
+            resolvePluginVersion( plugin, project, session );
+                                     
-            // This does not appear to be caching anything really.
+           
+            System.out.println( "AAA loading plugin " + pluginDescriptor.getArtifactId() + ":" + pluginDescriptor.getVersion() );        
+            System.out.println( "BBB realm: " + pluginDescriptor.getClassRealm() );
+        System.out.println( "XXX Looking for class realm " + pluginDescriptor.getArtifactId() + ":" + pluginDescriptor.getVersion() );
-    public String resolvePluginVersion( String groupId, String artifactId, MavenProject project, MavenSession session )
+    public void resolvePluginVersion( Plugin plugin, MavenProject project, MavenSession session )
-    {
-        String version = null;
+    {        
+        String version = plugin.getVersion();
+        if ( version != null && !Artifact.RELEASE_VERSION.equals( version ) )
+        {
+            return;
+        }
+        
+        String groupId = plugin.getGroupId();
+        
+        String artifactId = plugin.getArtifactId();        
+                
-                Plugin plugin = (Plugin) it.next();
+                Plugin p = (Plugin) it.next();
-                if ( groupId.equals( plugin.getGroupId() ) && artifactId.equals( plugin.getArtifactId() ) )
+                if ( groupId.equals( p.getGroupId() ) && artifactId.equals( p.getArtifactId() ) )
-                    version = plugin.getVersion();
+                    version = p.getVersion();
-        return version;        
+        plugin.setVersion( version );
+        // We need the POM for the actually plugin project so we can look at the prerequisite element.
-    }    
+    }
