partially fixing problem with plugin-dependency loading...now, we're including maven-plugin-api in the plugin realm somehow, which means the standard artifact filter isn't working.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@497696 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.ArtifactUtils;
+import java.util.LinkedHashSet;
+        getLogger().debug( "Realm for plugin: " + plugin.getKey() + ":\n" + componentRealm );
+        
-        Set resolved = result.getArtifacts();
-
+        List resolved = new ArrayList( result.getArtifacts() );
+        
+        getLogger().info( "Main plugin artifacts: " + resolved );
+        
-
+        
+        getLogger().info( "After adding project-level plugin dependencies: " + resolved );
+        
-        List allResolved = new ArrayList( resolved.size() + unresolved.size() );
+        Set allResolved = new LinkedHashSet( resolved.size() + unresolved.size() );
+        
+        Set seenVersionlessKeys = new HashSet();
+        
+        for ( Iterator it = resolved.iterator(); it.hasNext(); )
+        {
+            Artifact resolvedArtifact = (Artifact) it.next();
+            
+            String versionlessKey = ArtifactUtils.versionlessKey( resolvedArtifact );
+            if ( !seenVersionlessKeys.contains( versionlessKey ) )
+            {
+                allResolved.add( resolvedArtifact );
+                seenVersionlessKeys.add( versionlessKey );
+            }
+            else
+            {
+                getLogger().info( "NOT including: " + resolvedArtifact.getId() + " in plugin dependencies." );
+            }
+        }
+        
+        for ( Iterator it = unresolved.iterator(); it.hasNext(); )
+        {
+            Artifact unresolvedArtifact = (Artifact) it.next();
+            
+            String versionlessKey = ArtifactUtils.versionlessKey( unresolvedArtifact );
+            if ( !seenVersionlessKeys.contains( versionlessKey ) )
+            {
+                allResolved.add( unresolvedArtifact );
+                seenVersionlessKeys.add( versionlessKey );
+            }
+            else
+            {
+                getLogger().info( "NOT including: " + unresolvedArtifact.getId() + " in plugin dependencies." );
+            }
+        }
+        
+        getLogger().info( "Using the following artifacts for classpath of: " + pluginArtifact.getId() + ":\n\n" + allResolved.toString().replace( ',', '\n' ) );
-        allResolved.addAll( resolved );
-
-        allResolved.addAll( unresolved );
-
-        return resolved;
+        return allResolved;
-            plugin = (Mojo) container.lookup( Mojo.ROLE, mojoDescriptor.getRoleHint() );
+            plugin = (Mojo) container.lookup( Mojo.ROLE, mojoDescriptor.getRoleHint(), realm );
