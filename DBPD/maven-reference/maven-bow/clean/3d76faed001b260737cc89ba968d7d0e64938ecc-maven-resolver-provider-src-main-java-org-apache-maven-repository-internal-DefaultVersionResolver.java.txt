Merge branch 'MNG-6672'

-import org.eclipse.aether.internal.impl.CacheUtils;
-                    CacheUtils.getRepository( session, request.getRepositories(), record.repoClass, record.repoId ) );
+                    getRepository( session, request.getRepositories(), record.repoClass, record.repoId ) );
+    private ArtifactRepository getRepository( RepositorySystemSession session,
+                                              List<RemoteRepository> repositories, Class<?> repoClass,
+                                              String repoId )
+    {
+        if ( repoClass != null )
+        {
+            if ( WorkspaceRepository.class.isAssignableFrom( repoClass ) )
+            {
+                return session.getWorkspaceReader().getRepository();
+            }
+            else if ( LocalRepository.class.isAssignableFrom( repoClass ) )
+            {
+                return session.getLocalRepository();
+            }
+            else
+            {
+                for ( RemoteRepository repository : repositories )
+                {
+                    if ( repoId.equals( repository.getId() ) )
+                    {
+                        return repository;
+                    }
+                }
+            }
+        }
+        return null;
+    }
+
-            workspace = CacheUtils.getWorkspace( session );
+            WorkspaceReader reader = session.getWorkspaceReader();
+            workspace = ( reader != null ) ? reader.getRepository() : null;
-            hash = hash * 31 + CacheUtils.repositoriesHashCode( repositories );
+            hash = hash * 31 + repositories.hashCode();
-                && CacheUtils.eq( workspace, that.workspace )
-                && CacheUtils.repositoriesEquals( repositories, that.repositories );
+                && Objects.equals( workspace, that.workspace ) && repositories.equals( that.repositories );
-}
+}
