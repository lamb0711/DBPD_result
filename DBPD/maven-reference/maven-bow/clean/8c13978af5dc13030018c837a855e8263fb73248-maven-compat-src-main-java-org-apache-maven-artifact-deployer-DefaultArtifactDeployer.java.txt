o Fixed duplicate processig of g:a-level metadata

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@990769 13f79535-47bb-0310-9956-ffa450edef68

-    private Map<Object, MergeableMetadata> snapshots = new ConcurrentHashMap<Object, MergeableMetadata>();
+    private Map<Object, MergeableMetadata> relatedMetadata = new ConcurrentHashMap<Object, MergeableMetadata>();
+        String versionKey = artifact.getGroupId() + ':' + artifact.getArtifactId();
-            snapshotKey = artifact.getGroupId() + ':' + artifact.getArtifactId() + ':' + artifact.getBaseVersion();
-            request.addMetadata( snapshots.get( snapshotKey ) );
+            snapshotKey = versionKey + ':' + artifact.getBaseVersion();
+            request.addMetadata( relatedMetadata.get( snapshotKey ) );
+        request.addMetadata( relatedMetadata.get( versionKey ) );
-        if ( snapshotKey != null )
+        for ( Object metadata : result.getMetadata() )
-            for ( Object metadata : result.getMetadata() )
+            if ( metadata.getClass().getName().endsWith( ".internal.VersionsMetadata" ) )
-                if ( metadata.getClass().getName().endsWith( ".internal.RemoteSnapshotMetadata" ) )
-                {
-                    snapshots.put( snapshotKey, (MergeableMetadata) metadata );
-                }
+                relatedMetadata.put( versionKey, (MergeableMetadata) metadata );
+            }
+            if ( snapshotKey != null && metadata.getClass().getName().endsWith( ".internal.RemoteSnapshotMetadata" ) )
+            {
+                relatedMetadata.put( snapshotKey, (MergeableMetadata) metadata );
