[MNG-3470] Build does not fail on corrupted POM even with checksumPolicy=fail

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@929985 13f79535-47bb-0310-9956-ffa450edef68

+
+                    updateCheckManager.touch( artifact, repository, null );
-                finally
+                catch ( ResourceDoesNotExistException e )
-                    updateCheckManager.touch( artifact, repository );
+                    updateCheckManager.touch( artifact, repository, null );
+                    throw e;
+                }
+                catch ( TransferFailedException e )
+                {
+                    String error = ( e.getMessage() != null ) ? e.getMessage() : e.getClass().getSimpleName();
+                    updateCheckManager.touch( artifact, repository, error );
+                    throw e;
-                throw new ResourceDoesNotExistException( "Failure to resolve " + remotePath + " from "
-                    + repository.getUrl() + " was cached in the local repository. "
-                    + "Resolution will not be reattempted until the update interval of " + repository.getId()
-                    + " has elapsed or updates are forced." );
+                String error = updateCheckManager.getError( artifact, repository );
+                if ( error != null )
+                {
+                    throw new TransferFailedException( "Failure to resolve " + remotePath + " from "
+                        + repository.getUrl() + " was cached in the local repository. "
+                        + "Resolution will not be reattempted until the update interval of " + repository.getId()
+                        + " has elapsed or updates are forced. Original error: " + error );
+                }
+                else
+                {
+                    throw new ResourceDoesNotExistException( "Failure to resolve " + remotePath + " from "
+                        + repository.getUrl() + " was cached in the local repository. "
+                        + "Resolution will not be reattempted until the update interval of " + repository.getId()
+                        + " has elapsed or updates are forced." );
+                }
