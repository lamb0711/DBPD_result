updated to match deploy plugin, until it can be removed


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163566 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.repository.ArtifactRepositoryFactory;
+import org.apache.maven.model.user.UserModel;
- *            required="true" validator="" expression="#project" description=""
+ * required="true" validator="" expression="#project" description=""
- *            type="org.apache.maven.artifact.deployer.ArtifactDeployer"
- *            required="true" validator=""
- *            expression="#component.org.apache.maven.artifact.deployer.ArtifactDeployer"
- *            description=""
+ * type="org.apache.maven.artifact.deployer.ArtifactDeployer"
+ * required="true" validator=""
+ * expression="#component.org.apache.maven.artifact.deployer.ArtifactDeployer"
+ * description=""
+ * @parameter name="artifactRepositoryFactory"
+ * type="org.apache.maven.artifact.repository.ArtifactRepositoryFactory"
+ * required="true"
+ * validator=""
+ * expression="#component.org.apache.maven.artifact.repository.ArtifactRepositoryFactory"
+ * description=""
+ * @parameter name="userModel"
+ * type="org.apache.maven.model.user.UserModel"
+ * required="true"
+ * validator=""
+ * expression="#userModel"
+ * description=""
+        ArtifactRepositoryFactory artifactRepositoryFactory = (ArtifactRepositoryFactory) request.getParameter(
+            "artifactRepositoryFactory" );
+
+        UserModel userModel = (UserModel) request.getParameter( "userModel" );
+
-        Repository repo = project.getDistributionManagement().getRepository();
-        ArtifactRepository deploymentRepository = new ArtifactRepository( repo.getId(), repo.getUrl() );
+        Repository repository = project.getDistributionManagement().getRepository();
+        ArtifactRepository deploymentRepository = artifactRepositoryFactory.createArtifactRepository( repository,
+                                                                                                      userModel );
-        Artifact artifact = new DefaultArtifact( project.getGroupId(),
-                                                 project.getArtifactId(),
-                                                 project.getVersion(),
+        if ( deploymentRepository.getAuthenticationInfo() == null )
+        {
+            request.getLog().warn(
+                "Deployment repository {id: \'" + repository.getId() + "\'} has no associated authentication info!" );
+        }
+
+        Artifact artifact = new DefaultArtifact( project.getGroupId(), project.getArtifactId(), project.getVersion(),
