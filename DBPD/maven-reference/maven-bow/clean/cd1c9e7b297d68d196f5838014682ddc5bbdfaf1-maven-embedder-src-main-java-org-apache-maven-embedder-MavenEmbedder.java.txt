MNG-2721: Determine a standard way to pass proxy information into the embedder 
http://jira.codehaus.org/browse/MNG-2721

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@491499 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.manager.WagonManager;
-import org.apache.maven.settings.Mirror;
-import org.apache.maven.settings.Proxy;
-import org.apache.maven.settings.Server;
-import org.codehaus.plexus.classworlds.realm.DuplicateRealmException;
-import org.codehaus.plexus.util.xml.Xpp3Dom;
-import java.util.Iterator;
-    private WagonManager wagonManager;
-
-            wagonManager = (WagonManager) container.lookup( WagonManager.ROLE );
-
+            // These three things can be cached for a single session of the embedder
-            resolveParameters( settings );
-
-    /**
-     * MKLEINT: copied from DefaultMaven. the wagonManager was not injected with proxy info
-     * when called in non-execute mode..
-     *
-     * @todo [BP] this might not be required if there is a better way to pass
-     * them in. It doesn't feel quite right.
-     * @todo [JC] we should at least provide a mapping of protocol-to-proxy for
-     * the wagons, shouldn't we?
-     */
-    private void resolveParameters( Settings settings )
-        throws SettingsConfigurationException
-    {
-        Proxy proxy = settings.getActiveProxy();
-
-        if ( proxy != null )
-        {
-            if ( proxy.getHost() == null )
-            {
-                throw new SettingsConfigurationException( "Proxy in settings.xml has no host" );
-            }
-            wagonManager.addProxy( proxy.getProtocol(), proxy.getHost(), proxy.getPort(), proxy.getUsername(),
-                                   proxy.getPassword(), proxy.getNonProxyHosts() );
-        }
-
-        for ( Iterator i = settings.getServers().iterator(); i.hasNext(); )
-        {
-            Server server = (Server) i.next();
-
-            wagonManager.addAuthenticationInfo( server.getId(), server.getUsername(), server.getPassword(),
-                                                server.getPrivateKey(), server.getPassphrase() );
-
-            wagonManager.addPermissionInfo( server.getId(), server.getFilePermissions(),
-                                            server.getDirectoryPermissions() );
-
-            if ( server.getConfiguration() != null )
-            {
-                wagonManager.addConfiguration( server.getId(), (Xpp3Dom) server.getConfiguration() );
-            }
-        }
-
-        for ( Iterator i = settings.getMirrors().iterator(); i.hasNext(); )
-        {
-            Mirror mirror = (Mirror) i.next();
-
-            wagonManager.addMirror( mirror.getId(), mirror.getMirrorOf(), mirror.getUrl() );
-        }
-    }
-
