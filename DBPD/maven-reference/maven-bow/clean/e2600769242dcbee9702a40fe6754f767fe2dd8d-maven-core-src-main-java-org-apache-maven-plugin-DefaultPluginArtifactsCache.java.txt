MNG-4916 cache extension plugin resolution errors


git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1038917 13f79535-47bb-0310-9956-ffa450edef68

+        throws PluginResolutionException
-        return cache.get( key );
+        CacheRecord cacheRecord = cache.get( key );
+
+        if ( cacheRecord != null && cacheRecord.exception != null )
+        {
+            throw cacheRecord.exception;
+        }
+
+        return cacheRecord;
+        assertUniqueKey( key );
+
+        CacheRecord record =
+            new CacheRecord( Collections.unmodifiableList( new ArrayList<Artifact>( pluginArtifacts ) ) );
+
+        cache.put( key, record );
+
+        return record;
+    }
+
+    protected void assertUniqueKey( Key key )
+    {
+    }
-        CacheRecord record =
-            new CacheRecord( Collections.unmodifiableList( new ArrayList<Artifact>( pluginArtifacts ) ) );
+    public CacheRecord put( Key key, PluginResolutionException exception )
+    {
+        if ( exception == null )
+        {
+            throw new NullPointerException();
+        }
+
+        assertUniqueKey( key );
+
+        CacheRecord record = new CacheRecord( exception );
