o Fixed resolution of transitive dependencies

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@813805 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.LinkedHashMap;
+        List<ArtifactRepository> pomRepositories = null;
+
+
+                pomRepositories = rel.project.getRemoteArtifactRepositories();
+        List<ArtifactRepository> aggregatedRepositories =
+            aggregateRepositories( request.getRemoteRepositories(), pomRepositories );
+
-            new ResolutionGroup( pomArtifact, relocatedArtifact, artifacts, managedVersions, request.getRemoteRepositories() );
+            new ResolutionGroup( pomArtifact, relocatedArtifact, artifacts, managedVersions, aggregatedRepositories );
+    private List<ArtifactRepository> aggregateRepositories( List<ArtifactRepository> requestRepositories,
+                                                            List<ArtifactRepository> pomRepositories )
+    {
+        List<ArtifactRepository> repositories = requestRepositories;
+
+        if ( pomRepositories != null && !pomRepositories.isEmpty() )
+        {
+            Map<String, ArtifactRepository> repos = new LinkedHashMap<String, ArtifactRepository>();
+
+            for ( ArtifactRepository repo : requestRepositories )
+            {
+                if ( !repos.containsKey( repo.getId() ) )
+                {
+                    repos.put( repo.getId(), repo );
+                }
+            }
+
+            for ( ArtifactRepository repo : pomRepositories )
+            {
+                if ( !repos.containsKey( repo.getId() ) )
+                {
+                    repos.put( repo.getId(), repo );
+                }
+            }
+
+            repositories = new ArrayList<ArtifactRepository>( repos.values() );
+        }
+
+        return repositories;
+    }
+
