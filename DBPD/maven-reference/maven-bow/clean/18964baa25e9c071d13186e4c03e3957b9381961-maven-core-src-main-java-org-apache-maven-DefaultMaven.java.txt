Make sure participants and session scope exit are called

Even in case of failing build.

Signed-off-by: Jason van Zyl <jason@tesla.io>

-        if ( result.hasExceptions() )
+        try
-            try 
+            if ( result.hasExceptions() )
+            {
+                return result;
+            }
+
+            session.setProjects( projectDependencyGraph.getSortedProjects() );
+
+            session.setProjectDependencyGraph( projectDependencyGraph );
+
+            result.setTopologicallySortedProjects( session.getProjects() );
+
+            result.setProject( session.getTopLevelProject() );
+
+            lifecycleStarter.execute( session );
+
+            validateActivatedProfiles( session.getProjects(), request.getActiveProfiles() );
+
+            if ( session.getResult().hasExceptions() )
+            {
+                return addExceptionToResult( result, session.getResult().getExceptions().get( 0 ) );
+            }
+        }
+        finally
+        {
+            try
-            } 
+            }
-
-            return result;
+            finally
+            {
+                sessionScope.exit();
+            }
-        
-        session.setProjects( projectDependencyGraph.getSortedProjects() );
-
-        session.setProjectDependencyGraph( projectDependencyGraph );
-
-        result.setTopologicallySortedProjects( session.getProjects() );
-
-        result.setProject( session.getTopLevelProject() );
-
-        lifecycleStarter.execute( session );
-
-        validateActivatedProfiles( session.getProjects(), request.getActiveProfiles() );
-
-        if ( session.getResult().hasExceptions() )
-        {
-            return addExceptionToResult( result, session.getResult().getExceptions().get( 0 ) );
-        }
-
-        try 
-        {
-            afterSessionEnd( projects, session );
-        } 
-        catch ( MavenExecutionException e )
-        {
-            return addExceptionToResult( result, e );
-        }
-
-        sessionScope.exit();
