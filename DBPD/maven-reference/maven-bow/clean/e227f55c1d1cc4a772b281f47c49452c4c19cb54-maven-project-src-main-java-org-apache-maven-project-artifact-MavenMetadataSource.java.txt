[MARTIFACT-25] cache failed POM downloads in the local repository, obeying the <releases> policy for checking for updates on them


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@674333 13f79535-47bb-0310-9956-ffa450edef68

-                    if ( strictlyEnforceThePresenceOfAValidMavenPOM )
-                    {
-                        throw new ArtifactMetadataRetrievalException( "Invalid POM file for artifact: '" +
-                            artifact.getDependencyConflictId() + "' Reason: " + e.getMessage(), e, artifact );
-                    }
-
-                    getLogger().warn( "POM for \'" + pomArtifact +
-                        "\' is invalid. It will be ignored for artifact resolution. Reason: " + e.getMessage() );
+                    handleInvalidOrMissingMavenPOM( artifact, e );
-                    if ( strictlyEnforceThePresenceOfAValidMavenPOM )
-                    {
-                        throw new ArtifactMetadataRetrievalException( "Unable to read the metadata file for artifact '" +
-                            artifact.getDependencyConflictId() + "': " + e.getMessage(), e, artifact );
-                    }
+                    handleInvalidOrMissingMavenPOM( artifact, e );
+    private void handleInvalidOrMissingMavenPOM( Artifact artifact, ProjectBuildingException e )
+        throws ArtifactMetadataRetrievalException
+    {
+        if ( strictlyEnforceThePresenceOfAValidMavenPOM )
+        {
+            throw new ArtifactMetadataRetrievalException( "Invalid POM file for artifact: '" +
+                artifact.getDependencyConflictId() + "': " + e.getMessage(), e, artifact );
+        }
+        else
+        {
+            getLogger().warn(
+                              "\n\tDEPRECATION: The POM for the artifact '"
+                                  + artifact.getDependencyConflictId()
+                                  + "' was invalid or not found on any repositories.\n"
+                                  + "\tThis may not be supported by future versions of Maven and should be corrected as soon as possible.\n"
+                                  + "\tError given: " + e.getMessage() + "\n" );
+        }
+    }
+
