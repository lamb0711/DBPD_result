Fixing CI. Had to move the addPlugin(..) call back to its original spot, and expose a new method in MavenProject to inject PluginManagement info to a Plugin instance that's passed in as a parameter.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@344294 13f79535-47bb-0310-9956-ffa450edef68

-            buildOverlay = new BuildOverlay( model.getBuild() );
+            buildOverlay = new BuildOverlay( getModelBuild() );
-
-    public void addPlugin( Plugin plugin )
+    
+    private Build getModelBuild()
+        
+        return build;
+    }
+
+    public void addPlugin( Plugin plugin )
+    {
+        Build build = getModelBuild();
-            PluginManagement pm = build.getPluginManagement();
-
-            if ( pm != null )
-            {
-                Map pmByKey = pm.getPluginsAsMap();
-
-                String pluginKey = plugin.getKey();
-
-                if ( pmByKey != null && pmByKey.containsKey( pluginKey ) )
-                {
-                    Plugin pmPlugin = (Plugin) pmByKey.get( pluginKey );
-
-                    ModelUtils.mergePluginDefinitions( plugin, pmPlugin, false );
-                }
-
-            }
+            injectPluginManagementInfo( plugin );
+    
+    public void injectPluginManagementInfo( Plugin plugin )
+    {
+        PluginManagement pm = getModelBuild().getPluginManagement();
+
+        if ( pm != null )
+        {
+            Map pmByKey = pm.getPluginsAsMap();
+
+            String pluginKey = plugin.getKey();
+
+            if ( pmByKey != null && pmByKey.containsKey( pluginKey ) )
+            {
+                Plugin pmPlugin = (Plugin) pmByKey.get( pluginKey );
+
+                ModelUtils.mergePluginDefinitions( plugin, pmPlugin, false );
+            }
+        }
+    }
