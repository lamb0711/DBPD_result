Fixing unit test problems from it0103 fix, and fixing it0042...just 4 more failing ITs before this is back on its feet.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@645015 13f79535-47bb-0310-9956-ffa450edef68

+    private Set unbindableMojos;
+
-                      final LifecycleBindings defaults, final List tasks )
+                      final LifecycleBindings defaults, final Set unbindableMojos, final List tasks )
-        this( LifecycleUtils.mergeBindings( packaging, projectBindings, defaults, true, false ), tasks );
+        this( LifecycleUtils.mergeBindings( packaging, projectBindings, defaults, true, false ), unbindableMojos, tasks );
-    public BuildPlan( final LifecycleBindings bindings, final List tasks )
+    public BuildPlan( final LifecycleBindings bindings, final Set unbindableMojos, final List tasks )
+        this.unbindableMojos = unbindableMojos == null ? null : new HashSet( unbindableMojos );
-                       final Map directInvocationBindings, final Set fullyResolvedMojoBindings, final List tasks,
-                       boolean includingReports )
+                       final Map directInvocationBindings, final Set fullyResolvedMojoBindings, final Set unbindableMojos,
+                       final List tasks, boolean includingReports )
+        this.unbindableMojos = unbindableMojos == null ? null : new HashSet( unbindableMojos );
+    public boolean hasUnbindableMojos()
+    {
+        return unbindableMojos != null && !unbindableMojos.isEmpty();
+    }
+
+    public Set getUnbindableMojos()
+    {
+        return unbindableMojos;
+    }
+
+    public void clearUnbindableMojos()
+    {
+        unbindableMojos = null;
+    }
+
+    public void addUnbindableMojo( MojoBinding binding )
+    {
+        unbindableMojos.add( binding );
+    }
+
-        return new BuildPlan( bindings, forkedDirectInvocations, forkedPhases, directInvocationBindings, fullyResolvedBindings, newTasks, includingReports );
+        return new BuildPlan( bindings, forkedDirectInvocations, forkedPhases, directInvocationBindings, fullyResolvedBindings, unbindableMojos, newTasks, includingReports );
-                        addResolverIfLateBound( mojoBinding, plan );
-                    addResolverIfLateBound( mojoBinding, plan );
-    private void addResolverIfLateBound( final MojoBinding mojoBinding, final List plan )
-    {
-        if ( mojoBinding.isLateBound() )
-        {
-            MojoBinding resolveBinding = StateManagementUtils.createResolveLateBoundMojoBinding( mojoBinding );
-            plan.add( resolveBinding );
-        }
-    }
-
-                    addResolverIfLateBound( invocation, forkedBindings );
