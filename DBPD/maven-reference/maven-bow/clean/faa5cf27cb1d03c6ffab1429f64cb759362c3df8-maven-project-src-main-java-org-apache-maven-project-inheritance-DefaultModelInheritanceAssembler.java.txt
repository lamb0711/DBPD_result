[MNG-1856] fix inheritance of the distribution management section and add tests

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@379324 13f79535-47bb-0310-9956-ffa450edef68

-        // ----------------------------------------------------------------------
-        // Distribution
-        // ----------------------------------------------------------------------
-
-        assembleDistributionManagementInheritance( child, parent );
-
-    private void assembleDistributionManagementInheritance( Model child, Model parent )
-    {
-        DistributionManagement cDistMgmt = child.getDistributionManagement();
-        DistributionManagement pDistMgmt = parent.getDistributionManagement();
-
-        if ( cDistMgmt == null )
-        {
-            child.setDistributionManagement( pDistMgmt );
-        }
-        else if ( pDistMgmt != null )
-        {
-            if ( cDistMgmt.getRepository() == null )
-            {
-                cDistMgmt.setRepository( pDistMgmt.getRepository() );
-            }
-
-            if ( cDistMgmt.getSnapshotRepository() == null )
-            {
-                cDistMgmt.setSnapshotRepository( pDistMgmt.getSnapshotRepository() );
-            }
-
-            if ( StringUtils.isEmpty( cDistMgmt.getDownloadUrl() ) )
-            {
-                cDistMgmt.setDownloadUrl( pDistMgmt.getDownloadUrl() );
-            }
-
-            if ( cDistMgmt.getRelocation() == null )
-            {
-                cDistMgmt.setRelocation( pDistMgmt.getRelocation() );
-            }
-
-            if ( cDistMgmt.getSite() == null )
-            {
-                cDistMgmt.setSite( pDistMgmt.getSite() );
-            }
-
-            // NOTE: We SHOULD NOT be inheriting status, since this is an assessment of the POM quality.
-        }
-    }
-
-                    DeploymentRepository repository = new DeploymentRepository();
-
+                    DeploymentRepository repository = copyDistributionRepository( parentDistMgmt.getRepository() );
-
-                    repository.setId( parentDistMgmt.getRepository().getId() );
-
-                    repository.setName( parentDistMgmt.getRepository().getName() );
-
-                    repository.setUrl( parentDistMgmt.getRepository().getUrl() );
-
-                    repository.setUniqueVersion( parentDistMgmt.getRepository().isUniqueVersion() );
-                    DeploymentRepository repository = new DeploymentRepository();
-
+                    DeploymentRepository repository =
+                        copyDistributionRepository( parentDistMgmt.getSnapshotRepository() );
-
-                    repository.setId( parentDistMgmt.getSnapshotRepository().getId() );
-
-                    repository.setName( parentDistMgmt.getSnapshotRepository().getName() );
-
-                    repository.setUrl( parentDistMgmt.getSnapshotRepository().getUrl() );
-
-                    repository.setUniqueVersion( parentDistMgmt.getSnapshotRepository().isUniqueVersion() );
+
+            if ( StringUtils.isEmpty( childDistMgmt.getDownloadUrl() ) )
+            {
+                childDistMgmt.setDownloadUrl( parentDistMgmt.getDownloadUrl() );
+            }
+
+            // NOTE: We SHOULD NOT be inheriting status, since this is an assessment of the POM quality.
+            // NOTE: We SHOULD NOT be inheriting relocation, since this relates to a single POM
+    private static DeploymentRepository copyDistributionRepository( DeploymentRepository parentRepository )
+    {
+        DeploymentRepository repository = new DeploymentRepository();
+
+        repository.setId( parentRepository.getId() );
+
+        repository.setName( parentRepository.getName() );
+
+        repository.setUrl( parentRepository.getUrl() );
+
+        repository.setLayout( parentRepository.getLayout() );
+
+        repository.setUniqueVersion( parentRepository.isUniqueVersion() );
+
+        return repository;
+    }
+
