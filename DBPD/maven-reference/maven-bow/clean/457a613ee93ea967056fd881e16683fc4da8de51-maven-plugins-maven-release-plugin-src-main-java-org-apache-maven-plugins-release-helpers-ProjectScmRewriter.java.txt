various release plugin fixes

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@279256 13f79535-47bb-0310-9956-ffa450edef68

-import java.util.HashMap;
-import java.util.Map;
-
+    private ReleaseProgressTracker releaseProgress;
-    private Map originalScmInformation = new HashMap();
+    public ProjectScmRewriter( ReleaseProgressTracker releaseProgress )
+    {
+        this.releaseProgress = releaseProgress;
+    }
-        if ( originalScmInformation.containsKey( projectId ) )
-        {
-            throw new IllegalArgumentException( "Project: " + projectId +
-                " already has it's original SCM info cached. Each project should only be resolved once." );
-        }
-
-            String tag = scm.getTag();
-
-            String connection = scm.getConnection();
-
-            String developerConnection = scm.getDeveloperConnection();
-
-            String url = scm.getUrl();
-
-            ScmInfo info = new ScmInfo( tag, connection, developerConnection, url );
-
-            originalScmInformation.put( projectId, info );
+            releaseProgress.addOriginalScmInfo( projectId, scm );
-        String projectId = ArtifactUtils.versionlessKey( project.getGroupId(), project.getArtifactId() );
-
-        ScmInfo original = (ScmInfo) originalScmInformation.get( projectId );
-
-        if ( original == null )
+        Scm scm = project.getOriginalModel().getScm();
+        if ( scm != null )
-            throw new IllegalArgumentException(
-                "Project \'" + projectId + "\' has not had its SCM info cached. Cannot restore uncached SCM info." );
-        }
+            String projectId = ArtifactUtils.versionlessKey( project.getGroupId(), project.getArtifactId() );
-        original.modify( project );
+            releaseProgress.restoreScmInfo( projectId, scm );
+        }
-
-    private static class ScmInfo
-    {
-        private String tag;
-
-        private String connection;
-
-        private String developerConnection;
-
-        private String url;
-
-        ScmInfo( String tag, String connection, String developerConnection, String url )
-        {
-            this.tag = tag;
-            this.connection = connection;
-            this.developerConnection = developerConnection;
-            this.url = url;
-        }
-
-        void modify( MavenProject project )
-        {
-            Model model = project.getOriginalModel();
-
-            Scm scm = model.getScm();
-            if ( scm != null )
-            {
-                scm.setTag( tag );
-
-                scm.setConnection( connection );
-
-                scm.setDeveloperConnection( developerConnection );
-
-                scm.setUrl( url );
-            }
-        }
-    }
-
