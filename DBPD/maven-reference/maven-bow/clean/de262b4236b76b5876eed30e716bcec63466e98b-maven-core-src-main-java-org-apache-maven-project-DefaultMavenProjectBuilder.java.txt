o refactor usage of build methods
o do not do path resolution for repository POMs
o source poms override repository poms in the cache


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163577 13f79535-47bb-0310-9956-ffa450edef68

-    public MavenProject build( File projectDescriptor, ArtifactRepository localRepository )
+    public MavenProject buildWithDependencies( File project, ArtifactRepository localRepository )
-        return build( projectDescriptor, localRepository, false );
+        return build( project, localRepository, true, true );
-    public MavenProject build( File projectDescriptor, ArtifactRepository localRepository, boolean resolveDependencies )
+    public MavenProject build( File project, ArtifactRepository localRepository )
+        throws ProjectBuildingException
+    {
+        return build( project, localRepository, false, true );
+    }
+
+    public MavenProject buildFromRepository( Artifact artifact, ArtifactRepository localRepository )
+        throws ProjectBuildingException
+    {
+        return build( artifact.getFile(), localRepository, false, false );
+    }
+
+    private MavenProject build( File projectDescriptor, ArtifactRepository localRepository,
+                                boolean resolveDependencies, boolean sourceProject )
-            project = processProjectLogic( project, localRepository, resolveDependencies );
+            project = processProjectLogic( project, localRepository, resolveDependencies, sourceProject );
-                                              boolean resolveDependencies )
+                                              boolean resolveDependencies, boolean sourceProject )
-        pathTranslator.alignToBaseDirectory( model, projectDescriptor );
+        if ( sourceProject )
+        {
+            pathTranslator.alignToBaseDirectory( model, projectDescriptor );
+        }
-        projectCache.put( createCacheKey( project.getGroupId(), project.getArtifactId(), project.getVersion() ),
-                          project );
+        String key = createCacheKey( project.getGroupId(), project.getArtifactId(), project.getVersion() );
+        MavenProject cachedProject = (MavenProject) projectCache.get( key );
+        if ( cachedProject == null || sourceProject )
+        {
+            projectCache.put( key, project );
+        }
-            project = processProjectLogic( project, localRepository, false );
+            project = processProjectLogic( project, localRepository, false, false );
