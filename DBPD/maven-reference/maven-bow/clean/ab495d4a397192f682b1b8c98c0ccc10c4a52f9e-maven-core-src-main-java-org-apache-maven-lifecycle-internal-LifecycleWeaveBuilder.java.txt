[MNG-4633] Changed to use nice clean countdownlatch instead of synchronized booleans

Also updated phase locking to only lock when project being built changes phase

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@939220 13f79535-47bb-0310-9956-ffa450edef68

-                        if ( nextPlanItem != null )
+                        if ( nextPlanItem != null && phaseRecorder.isDifferentPhase( nextPlanItem.getMojoExecution() ) )
-                            if ( phaseRecorder.isDifferentPhase( nextPlanItem.getMojoExecution() ) )
+                            for ( ArtifactLink dependencyLink : dependencyLinks )
-                                for ( ArtifactLink dependencyLink : dependencyLinks )
-                                {
-                                    dependencyLink.resolveFromUpstream();
-                                }
+                                dependencyLink.resolveFromUpstream();
-            final ExecutionPlanItem inSchedule = upstreamPlan.findLastInPhase( nextPhase );
+            final ExecutionPlanItem upstream = upstreamPlan.findLastInPhase( nextPhase );
-            if ( inSchedule != null )
+            if ( upstream != null )
-                inSchedule.waitUntilDone();
-                builtLogItem.addWait( upstreamProject, inSchedule, startWait );
+                upstream.waitUntilDone();
+                builtLogItem.addWait( upstreamProject, upstream, startWait );
