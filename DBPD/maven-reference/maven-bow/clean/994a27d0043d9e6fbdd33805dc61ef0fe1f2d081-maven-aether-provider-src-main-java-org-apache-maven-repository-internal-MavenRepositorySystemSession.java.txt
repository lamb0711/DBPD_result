removed code duplication: maven-core can use base MavenRepositorySystemSession provided by maven-aether-provider as a basis before adding environment configuration

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1407851 13f79535-47bb-0310-9956-ffa450edef68

- * A simplistic repository system session that mimics Maven's behavior to help third-party developers that want to embed
- * Maven's dependency resolution into their own applications.
+ * The base Maven repository system session, without environment configuration (authentication, mirror,
+ * proxy, ...).
- * <code><a href="/ref/current/maven-core/apidocs/org/apache/maven/DefaultMaven.html">DefaultMaven.newRepositorySession(MavenExecutionRequest request)</a></code>.</p>
+ * <a href="/ref/current/maven-core/apidocs/org/apache/maven/DefaultMaven.html">
+ * <code>DefaultMaven.newRepositorySession(MavenExecutionRequest request)</code></a>.</p>
-     * Creates a new Maven-like repository system session by initializing the session with values typical for
+     * Creates a new Maven repository system session by initializing the session with values typical for
+     * 
+     * @param standalone is this instance expected to be used inside Maven, with Plexus and Maven core components, or
+     *   standalone? If standalone, System properties are used and classical Maven artifact handlers are pre-configured
+     *   to mimic complete Maven repository system session.
-    public MavenRepositorySystemSession()
+    public MavenRepositorySystemSession( boolean standalone )
-        setMirrorSelector( new DefaultMirrorSelector() );
-        setAuthenticationSelector( new DefaultAuthenticationSelector() );
-        setProxySelector( new DefaultProxySelector() );
-
-        DefaultArtifactTypeRegistry stereotypes = new DefaultArtifactTypeRegistry();
-        stereotypes.add( new DefaultArtifactType( "pom" ) );
-        stereotypes.add( new DefaultArtifactType( "maven-plugin", "jar", "", "java" ) );
-        stereotypes.add( new DefaultArtifactType( "jar", "jar", "", "java" ) );
-        stereotypes.add( new DefaultArtifactType( "ejb", "jar", "", "java" ) );
-        stereotypes.add( new DefaultArtifactType( "ejb-client", "jar", "client", "java" ) );
-        stereotypes.add( new DefaultArtifactType( "test-jar", "jar", "tests", "java" ) );
-        stereotypes.add( new DefaultArtifactType( "javadoc", "jar", "javadoc", "java" ) );
-        stereotypes.add( new DefaultArtifactType( "java-source", "jar", "sources", "java", false, false ) );
-        stereotypes.add( new DefaultArtifactType( "war", "war", "", "java", false, true ) );
-        stereotypes.add( new DefaultArtifactType( "ear", "ear", "", "java", false, true ) );
-        stereotypes.add( new DefaultArtifactType( "rar", "rar", "", "java", false, true ) );
-        stereotypes.add( new DefaultArtifactType( "par", "par", "", "java", false, true ) );
-        setArtifactTypeRegistry( stereotypes );
-
-        setSystemProps( System.getProperties() );
-        setConfigProps( System.getProperties() );
+        if ( standalone )
+        {
+            setMirrorSelector( new DefaultMirrorSelector() );
+            setAuthenticationSelector( new DefaultAuthenticationSelector() );
+            setProxySelector( new DefaultProxySelector() );
+
+            DefaultArtifactTypeRegistry stereotypes = new DefaultArtifactTypeRegistry();
+            stereotypes.add( new DefaultArtifactType( "pom" ) );
+            stereotypes.add( new DefaultArtifactType( "maven-plugin", "jar", "", "java" ) );
+            stereotypes.add( new DefaultArtifactType( "jar", "jar", "", "java" ) );
+            stereotypes.add( new DefaultArtifactType( "ejb", "jar", "", "java" ) );
+            stereotypes.add( new DefaultArtifactType( "ejb-client", "jar", "client", "java" ) );
+            stereotypes.add( new DefaultArtifactType( "test-jar", "jar", "tests", "java" ) );
+            stereotypes.add( new DefaultArtifactType( "javadoc", "jar", "javadoc", "java" ) );
+            stereotypes.add( new DefaultArtifactType( "java-source", "jar", "sources", "java", false, false ) );
+            stereotypes.add( new DefaultArtifactType( "war", "war", "", "java", false, true ) );
+            stereotypes.add( new DefaultArtifactType( "ear", "ear", "", "java", false, true ) );
+            stereotypes.add( new DefaultArtifactType( "rar", "rar", "", "java", false, true ) );
+            stereotypes.add( new DefaultArtifactType( "par", "par", "", "java", false, true ) );
+            setArtifactTypeRegistry( stereotypes );
+    
+            setSystemProps( System.getProperties() );
+            setConfigProps( System.getProperties() );
+        }
