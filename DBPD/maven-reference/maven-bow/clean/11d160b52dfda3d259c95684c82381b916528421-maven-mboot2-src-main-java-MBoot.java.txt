use surefire pom for surefire dependencies


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163749 13f79535-47bb-0310-9956-ffa450edef68

-    private static final String[] EMPTY_STRING_ARRAY = new String[0];
-
+        reader.parse( new File( basedir, "maven-plugins/maven-surefire-plugin/pom.xml" ) );
+        List surefireDependencies = reader.getDependencies();
+
+        reader = new ModelReader( downloader );
-            reader = buildProject( directory, builds[i], bootstrapClassLoader );
+            reader = buildProject( directory, builds[i], bootstrapClassLoader, surefireDependencies );
-            reader = buildProject( directory, pluginBuilds[i], cl );
+            reader = buildProject( directory, pluginBuilds[i], cl, surefireDependencies );
-    public ModelReader buildProject( String basedir, String projectId, ClassLoader classLoader )
+    public ModelReader buildProject( String basedir, String projectId, ClassLoader classLoader,
+                                     List surefireDependencies )
-        runTests( basedir, classes, testClasses, reader );
+        runTests( basedir, classes, testClasses, reader, surefireDependencies );
-    private void runTests( String basedir, String classes, String testClasses, ModelReader reader )
+    private void runTests( String basedir, String classes, String testClasses, ModelReader reader,
+                           List surefireDependencies )
-        String[] cp = (String[]) classpath( reader.getDependencies(), null, SCOPE_TEST ).toArray( EMPTY_STRING_ARRAY );
-        boolean success = testRunner.execute( repoLocal, basedir, classes, testClasses, includes, excludes, cp,
-                                              reportsDir );
+        List depList = new ArrayList( reader.getDependencies() );
+        depList.addAll( surefireDependencies );
+
+        List classpath = classpath( depList, null, SCOPE_TEST );
+        classpath.add( classes );
+        classpath.add( testClasses );
+        boolean success = testRunner.execute( basedir, includes, excludes, classpath, reportsDir );
