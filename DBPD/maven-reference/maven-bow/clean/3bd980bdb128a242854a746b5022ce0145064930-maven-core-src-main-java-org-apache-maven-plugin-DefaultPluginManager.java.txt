hack in a dom so we can use plexus configuration. more to do...


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163635 13f79535-47bb-0310-9956-ffa450edef68

+import org.codehaus.plexus.component.configurator.BasicComponentConfigurator;
+import org.codehaus.plexus.component.configurator.ComponentConfigurationException;
+import org.codehaus.plexus.component.configurator.ComponentConfigurator;
+import org.codehaus.plexus.configuration.xml.XmlPlexusConfiguration;
+import org.codehaus.plexus.util.xml.Xpp3Dom;
+        Xpp3Dom dom = new Xpp3Dom( mojoDescriptor.getId() );
+
-            Class clazz = plugin.getClass();
-            try
+            // TODO:Still not complete robust - need to merge in the processing in createParameters
+            if ( value instanceof String )
-                Field f = clazz.getDeclaredField( name );
-                boolean accessible = f.isAccessible();
-                if ( !accessible )
+                Xpp3Dom d = new Xpp3Dom( name );
+                d.setValue( (String) value );
+                dom.addChild( d );
+            }
+            else
+            {
+                Class clazz = plugin.getClass();
+                try
-                    f.setAccessible( true );
+                    Field f = clazz.getDeclaredField( name );
+                    boolean accessible = f.isAccessible();
+                    if ( !accessible )
+                    {
+                        f.setAccessible( true );
+                    }
+
+                    f.set( plugin, value );
+
+                    if ( !accessible )
+                    {
+                        f.setAccessible( false );
+                    }
-
-                f.set( plugin, value );
-
-                if ( !accessible )
+                catch ( NoSuchFieldException e )
-                    f.setAccessible( false );
+                    throw new PluginConfigurationException( "Unable to set field '" + name + "' on '" + clazz + "'" );
+                }
+                catch ( IllegalAccessException e )
+                {
+                    throw new PluginConfigurationException( "Unable to set field '" + name + "' on '" + clazz + "'" );
-            catch ( NoSuchFieldException e )
-            {
-                throw new PluginConfigurationException( "Unable to set field '" + name + "' on '" + clazz + "'" );
-            }
-            catch ( IllegalAccessException e )
-            {
-                throw new PluginConfigurationException( "Unable to set field '" + name + "' on '" + clazz + "'" );
-            }
+        }
+
+        // TODO: should be a component
+        ComponentConfigurator configurator = new BasicComponentConfigurator();
+        try
+        {
+            configurator.configureComponent( plugin, new XmlPlexusConfiguration( dom ) );
+        }
+        catch ( ComponentConfigurationException e )
+        {
+            throw new PluginConfigurationException( "Unable to parse the created DOM for plugin configuration", e );
