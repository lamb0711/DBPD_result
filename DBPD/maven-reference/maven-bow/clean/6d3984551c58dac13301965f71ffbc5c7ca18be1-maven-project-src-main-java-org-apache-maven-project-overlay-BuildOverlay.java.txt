OPEN - issue MNG-2671: Parent/modules relative file path compression 
http://jira.codehaus.org/browse/MNG-2671

Applied, with small changes so it will not swallow exceptions. If this causes a problem with broken symlinks, we can address that later.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@543682 13f79535-47bb-0310-9956-ffa450edef68

+import java.io.File;
+import java.io.IOException;
-    
+
-    
+
+
-            
-            this.resources = new ArrayList();
-            
-            this.testResources = new ArrayList();
+
+            resources = new ArrayList();
+
+            testResources = new ArrayList();
-            
-            this.resources = new ArrayList( build.getResources() );
-            
-            this.testResources = new ArrayList( build.getTestResources() );
+
+            resources = new ArrayList( build.getResources() );
+
+            testResources = new ArrayList( build.getTestResources() );
-        return build.getDirectory();
+        String path = build.getDirectory();
+        File file = new File( build.getDirectory() );
+        try
+        {
+            path = file.getCanonicalPath();
+        }
+        catch ( IOException e )
+        {
+            handleCanonicalException( path, e );
+        }
+        return path;
-        return build.getOutputDirectory();
+        String path = build.getDirectory();
+        File file = new File( build.getOutputDirectory() );
+        try
+        {
+            path = file.getCanonicalPath();
+        }
+        catch ( IOException e )
+        {
+            handleCanonicalException( path, e );
+        }
+        return path;
-        return build.getScriptSourceDirectory();
+        String path = build.getDirectory();
+        File file = new File( build.getScriptSourceDirectory() );
+        try
+        {
+            path = file.getCanonicalPath();
+        }
+        catch ( IOException e )
+        {
+            handleCanonicalException( path, e );
+        }
+        return path;
+    }
+
+    private void handleCanonicalException( String path, IOException e )
+    {
+        IllegalStateException error = new IllegalStateException( "Cannot compute canonical path for: " + path
+                                                                 + ". Reason: " + e.getMessage() );
+        error.initCause( e );
+
+        throw error;
-        return build.getTestSourceDirectory();
+        String path = build.getDirectory();
+        File file = new File( build.getTestSourceDirectory() );
+        try
+        {
+            path = file.getCanonicalPath();
+        }
+        catch ( IOException e )
+        {
+            handleCanonicalException( path, e );
+        }
+        return path;
-        build.addFilter( string );   
+        build.addFilter( string );
