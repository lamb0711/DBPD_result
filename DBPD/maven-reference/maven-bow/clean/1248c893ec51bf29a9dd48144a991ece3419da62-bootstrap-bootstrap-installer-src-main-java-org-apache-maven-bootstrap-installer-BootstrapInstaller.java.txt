build assembly


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@344874 13f79535-47bb-0310-9956-ffa450edef68

+import org.codehaus.plexus.util.cli.CommandLineUtils;
+import org.codehaus.plexus.util.cli.StreamConsumer;
+import org.codehaus.plexus.util.cli.WriterStreamConsumer;
+import java.io.PrintWriter;
-        createInstallation( new File( basedir, "target/installation" ) );
+        File installation = new File( basedir, "bootstrap/target/installation" );
+        createInstallation( installation );
+
+        // TODO: should just need assembly from basedir
+        runMaven( installation, new File( basedir ), new String[]{"clean", "install"} );
+
+        runMaven( installation, new File( basedir, "maven-core" ), new String[]{"clean", "assembly:assembly"} );
+    private void runMaven( File installation, File basedir, String[] args )
+        throws Exception, InterruptedException
+    {
+        Commandline cli = new Commandline();
+
+        cli.setExecutable( new File( installation, "bin/mvn" ).getAbsolutePath() );
+
+        cli.setWorkingDirectory( basedir.getAbsolutePath() );
+
+        for ( int i = 0; i < args.length; i++ )
+        {
+            cli.createArgument().setValue( args[i] );
+        }
+
+        int exitCode = CommandLineUtils.executeCommandLine( cli,
+                                                            new WriterStreamConsumer( new PrintWriter( System.out ) ),
+                                                            new WriterStreamConsumer( new PrintWriter( System.err ) ) );
+
+        if ( exitCode != 0 )
+        {
+            throw new Exception( "Error executing Maven: exit code = " + exitCode );
+        }
+    }
+
