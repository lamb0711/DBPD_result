[MNG-4756] Aether integration


git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@988749 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.repository.ArtifactTransferEvent;
-import org.apache.maven.repository.ArtifactTransferResource;
+import org.sonatype.aether.transfer.TransferCancelledException;
+import org.sonatype.aether.transfer.TransferEvent;
+import org.sonatype.aether.transfer.TransferResource;
-    private Map<ArtifactTransferResource, Long> downloads = new ConcurrentHashMap<ArtifactTransferResource, Long>();
+    private Map<TransferResource, Long> downloads = new ConcurrentHashMap<TransferResource, Long>();
-    protected void doProgress( ArtifactTransferEvent transferEvent )
+    public void transferProgressed( TransferEvent event )
+        throws TransferCancelledException
-        ArtifactTransferResource resource = transferEvent.getResource();
-        downloads.put( resource, Long.valueOf( transferEvent.getTransferredBytes() ) );
+        TransferResource resource = event.getResource();
+        downloads.put( resource, Long.valueOf( event.getTransferredBytes() ) );
-        for ( Map.Entry<ArtifactTransferResource, Long> entry : downloads.entrySet() )
+        for ( Map.Entry<TransferResource, Long> entry : downloads.entrySet() )
-    public void transferCompleted( ArtifactTransferEvent transferEvent )
+    public void transferSucceeded( TransferEvent event )
-        downloads.remove( transferEvent.getResource() );
+        transferCompleted( event );
+
+        super.transferSucceeded( event );
+    }
+
+    @Override
+    public void transferFailed( TransferEvent event )
+    {
+        transferCompleted( event );
+
+        super.transferFailed( event );
+    }
+
+    private void transferCompleted( TransferEvent event )
+    {
+        downloads.remove( event.getResource() );
-
-        super.transferCompleted( transferEvent );
