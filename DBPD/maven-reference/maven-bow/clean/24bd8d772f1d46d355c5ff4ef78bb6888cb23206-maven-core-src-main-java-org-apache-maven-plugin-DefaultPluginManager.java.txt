o Introduced RepositoryRequest to hold the bare minimum of items required for repo accesses
o Added cache for metadata.xml

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@803059 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.repository.DefaultRepositoryRequest;
+import org.apache.maven.artifact.repository.RepositoryRequest;
-     * @param localRepository
-     * @param remoteRepositories
+     * @param repositoryRequest
-    public synchronized PluginDescriptor loadPlugin( Plugin plugin, ArtifactRepository localRepository, List<ArtifactRepository> remoteRepositories )
+    public synchronized PluginDescriptor loadPlugin( Plugin plugin, RepositoryRequest repositoryRequest )
-        PluginDescriptor pluginDescriptor = pluginCache.getPluginDescriptor( plugin, localRepository, remoteRepositories );
+        PluginDescriptor pluginDescriptor =
+            pluginCache.getPluginDescriptor( plugin, repositoryRequest.getLocalRepository(),
+                                             repositoryRequest.getRemoteRepositories() );
-        ArtifactResolutionRequest request = new ArtifactResolutionRequest()
+        ArtifactResolutionRequest request = new ArtifactResolutionRequest( repositoryRequest )
-            .setLocalRepository( localRepository )
-            .setRemoteRepositories( remoteRepositories )
-            pluginCache.putPluginDescriptor( plugin, localRepository, remoteRepositories, pluginDescriptor );
+            pluginCache.putPluginDescriptor( plugin, repositoryRequest.getLocalRepository(),
+                                             repositoryRequest.getRemoteRepositories(), pluginDescriptor );
-    List<Artifact> getPluginArtifacts( Artifact pluginArtifact, Plugin pluginAsSpecifiedInPom, ArtifactRepository localRepository, List<ArtifactRepository> remoteRepositories )
+    List<Artifact> getPluginArtifacts( Artifact pluginArtifact, Plugin pluginAsSpecifiedInPom, RepositoryRequest repositoryRequest )
-        ArtifactResolutionRequest request = new ArtifactResolutionRequest()
+        ArtifactResolutionRequest request = new ArtifactResolutionRequest( repositoryRequest )
-            .setLocalRepository( localRepository )
-            .setRemoteRepositories( remoteRepositories )
+        
-            pluginArtifacts = getPluginArtifacts( pluginArtifact, plugin, localRepository, remoteRepositories );
+            RepositoryRequest request = new DefaultRepositoryRequest();
+            request.setLocalRepository( localRepository );
+            request.setRemoteRepositories( remoteRepositories );
+            request.setCache( session.getRepositoryCache() );
+            pluginArtifacts = getPluginArtifacts( pluginArtifact, plugin, request );
-    public MojoDescriptor getMojoDescriptor( String groupId, String artifactId, String version, String goal, ArtifactRepository localRepository, List<ArtifactRepository> remoteRepositories )
+    public MojoDescriptor getMojoDescriptor( String groupId, String artifactId, String version, String goal, RepositoryRequest repositoryRequest )
-        return getMojoDescriptor( plugin, goal, localRepository, remoteRepositories );
+        return getMojoDescriptor( plugin, goal, repositoryRequest );
-    public MojoDescriptor getMojoDescriptor( Plugin plugin, String goal, ArtifactRepository localRepository, List<ArtifactRepository> remoteRepositories )
+    public MojoDescriptor getMojoDescriptor( Plugin plugin, String goal, RepositoryRequest repositoryRequest )
-        PluginDescriptor pluginDescriptor = loadPlugin( plugin, localRepository, remoteRepositories );
+        PluginDescriptor pluginDescriptor = loadPlugin( plugin, repositoryRequest );
