intermediate commit to revert lagacy repo system to default status

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@763103 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.mercury.artifact.Artifact;
-@Component( role = RepositorySystem.class, hint = "default" )
+@Component( role = RepositorySystem.class, hint = "mercury" )
+System.out.println("mercury: request for "+request.getArtifact()
++"("+request.getArtifactDependencies()+") repos="+request.getRemoteRepostories().size()
++" repos, map=" + request.getManagedVersionMap() 
+);
+
-            MercuryAdaptor.toMercuryRepos( request.getLocalRepository()
+            MercuryAdaptor.toMercuryRepos(   request.getLocalRepository()
+long start = System.currentTimeMillis();
+            org.apache.maven.artifact.Artifact mavenPluginArtifact = mavenRootArtifact;
+            boolean isPlugin = "maven-plugin".equals( mavenRootArtifact.getType() ); 
+            
+            ArtifactScopeEnum scope = MercuryAdaptor.extractScope( mavenRootArtifact, isPlugin, request.getFilter() );
+            
+            if( isPlugin  )
+                mavenRootArtifact = createArtifact( mavenRootArtifact.getGroupId()
+                                                    , mavenRootArtifact.getArtifactId()
+                                                    , mavenRootArtifact.getVersion()
+                                                    , mavenRootArtifact.getScope()
+                                                    , "jar"
+                                                  );
+
-            List<ArtifactMetadata> mercuryMetadataList = _mercury.resolve( repos, null,  rootMd );
+            List<ArtifactMetadata> mercuryMetadataList = _mercury.resolve( repos, scope,  rootMd );
+long diff = System.currentTimeMillis() - start;
+
+            org.apache.maven.artifact.Artifact root = null;
+            
-                    result.addArtifact( MercuryAdaptor.toMavenArtifact( _artifactFactory, a ) );
-                
-                // maven likes the original artifact instance - fill it in
-                Artifact mercuryRootArtifact = mercuryArtifactList.get( 0 );
-                
-                mavenRootArtifact.setFile( mercuryRootArtifact.getFile() );
+                {
+                    if( a.getGroupId().equals( rootMd.getGroupId() ) && a.getArtifactId().equals( rootMd.getArtifactId() ) )
+                    { // root artifact processing
+                        root = isPlugin ? mavenPluginArtifact : mavenRootArtifact;
+                        
+                        root.setFile( a.getFile() );
+                        root.setResolved( true );
+                        root.setResolvedVersion( a.getVersion() );
+
+                        result.addArtifact( root );
+                    }
+                    else
+                    {
+                        result.addArtifact( MercuryAdaptor.toMavenArtifact( _artifactFactory, a ) );
+                    }
+                }
+
+System.out.println("mercury: resolved("+diff+") "+root+"("+scope+") as file "+root.getFile() );
+            else
+            {
+                result.addMissingArtifact( mavenRootArtifact );
+System.out.println("mercury: missing artifact("+diff+") "+mavenRootArtifact+"("+scope+")" );
+            }
+            
