Fixed usage of repositories from active profiles in settings.xml for model-lineage building, which is fundamental to the build.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@583248 13f79535-47bb-0310-9956-ffa450edef68

-    public LinkedHashSet getArtifactRepositoriesFromActiveProfiles( Model model, File projectDir,
-                                                                    List explicitlyActiveIds, List explicitlyInactiveIds )
+    public LinkedHashSet getArtifactRepositoriesFromActiveProfiles( ProfileManager profileManager,
+                                                                    String modelId )
-        ProfileManager profileManager = buildProfileManager( model, projectDir, explicitlyActiveIds, explicitlyInactiveIds );
+
+        if ( profileManager == null )
+        {
+            return new LinkedHashSet();
+        }
-                throw new ProjectBuildingException( model.getId(),
+                throw new ProjectBuildingException( modelId,
-                        throw new ProjectBuildingException( model.getId(), e.getMessage(), e );
+                        throw new ProjectBuildingException( modelId, e.getMessage(), e );
+    public LinkedHashSet getArtifactRepositoriesFromActiveProfiles( Model model, File projectDir,
+                                                                    List explicitlyActiveIds, List explicitlyInactiveIds )
+        throws ProjectBuildingException
+    {
+        ProfileManager profileManager = buildProfileManager( model, projectDir, explicitlyActiveIds, explicitlyInactiveIds );
+
+        return getArtifactRepositoriesFromActiveProfiles( profileManager, model.getId() );
+    }
+
-                    if ( active != null && !active.isEmpty() )
+                    if ( ( active != null ) && !active.isEmpty() )
-        this.container = (PlexusContainer) context.get( PlexusConstants.PLEXUS_KEY );
+        container = (PlexusContainer) context.get( PlexusConstants.PLEXUS_KEY );
