[MNG-4072] [regression] Repositories from inactive profiles are used for artifact resolution

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@751548 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.ArrayList;
+import org.apache.maven.model.Model;
+import org.apache.maven.profiles.ProfileActivationException;
+            }
-                // We need to convert profile repositories to artifact repositories
-
-                for ( Repository r : profile.getRepositories() )
+            // We need to convert profile repositories to artifact repositories
+            try
+            {
+                for ( Profile profile : profileManager.getActiveProfiles( new Model() ) )
-                    try
+                    for ( Repository r : profile.getRepositories() )
-                        request.addRemoteRepository( repositorySystem.buildArtifactRepository( r ) );
-                    }
-                    catch ( InvalidRepositoryException e )
-                    {
-                        throw new MavenEmbedderException( "Cannot create remote repository " + r.getId(), e );
+                        try
+                        {
+                            request.addRemoteRepository( repositorySystem.buildArtifactRepository( r ) );
+                        }
+                        catch ( InvalidRepositoryException e )
+                        {
+                            throw new MavenEmbedderException( "Cannot create remote repository " + r.getId(), e );
+                        }
+            catch ( ProfileActivationException e )
+            {
+                throw new MavenEmbedderException( "Cannot determine active profiles", e );
+            }
