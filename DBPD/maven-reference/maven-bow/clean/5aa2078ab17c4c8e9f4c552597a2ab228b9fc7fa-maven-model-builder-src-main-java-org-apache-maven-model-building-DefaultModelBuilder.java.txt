o Improved model validation to ignore super POM for plugin version check

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@930720 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.Build;
+import org.apache.maven.model.Plugin;
+import org.apache.maven.model.PluginManagement;
+        problems.setSource( inputModel );
+        checkPluginVersions( lineage, request, problems );
+        
+    private void checkPluginVersions( List<ModelData> lineage, ModelBuildingRequest request,
+                                      ModelProblemCollector problems )
+    {
+        if ( request.getValidationLevel() < ModelBuildingRequest.VALIDATION_LEVEL_MAVEN_2_0 )
+        {
+            return;
+        }
+
+        Map<String, String> versions = new HashMap<String, String>();
+        Map<String, String> managedVersions = new HashMap<String, String>();
+
+        for ( int i = 0, n = lineage.size() - 1; i < n; i++ )
+        {
+            Model model = lineage.get( i ).getModel();
+            Build build = model.getBuild();
+            if ( build != null )
+            {
+                for ( Plugin plugin : build.getPlugins() )
+                {
+                    String key = plugin.getKey();
+                    if ( versions.get( key ) == null )
+                    {
+                        versions.put( key, plugin.getVersion() );
+                    }
+                }
+                PluginManagement mngt = build.getPluginManagement();
+                if ( mngt != null )
+                {
+                    for ( Plugin plugin : mngt.getPlugins() )
+                    {
+                        String key = plugin.getKey();
+                        if ( managedVersions.get( key ) == null )
+                        {
+                            managedVersions.put( key, plugin.getVersion() );
+                        }
+                    }
+                }
+            }
+        }
+
+        for ( String key : versions.keySet() )
+        {
+            if ( versions.get( key ) == null && managedVersions.get( key ) == null )
+            {
+                problems.add( Severity.WARNING, "'build.plugins.plugin.version' for " + key + " is missing.", null );
+            }
+        }
+    }
+
