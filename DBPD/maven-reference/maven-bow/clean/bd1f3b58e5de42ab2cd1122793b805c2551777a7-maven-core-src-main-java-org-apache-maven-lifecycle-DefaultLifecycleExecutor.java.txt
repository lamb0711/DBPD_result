[MNG-2222] dependency to dependency without source code fails

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@928058 13f79535-47bb-0310-9956-ffa450edef68

-                for ( MojoExecution mojoExecution : executionPlan.getExecutions() )
-                {
-                    execute( session, mojoExecution, projectIndex, dependencyContext );
-                }
+                execute( session, executionPlan.getExecutions(), projectIndex, dependencyContext );
+    private void execute( MavenSession session, List<MojoExecution> mojoExecutions, ProjectIndex projectIndex,
+                          DependencyContext dependencyContext )
+        throws LifecycleExecutionException
+    {
+        MavenProject project = session.getCurrentProject();
+
+        String lastLifecyclePhase = null;
+
+        for ( MojoExecution mojoExecution : mojoExecutions )
+        {
+            execute( session, mojoExecution, projectIndex, dependencyContext );
+
+            String lifecyclePhase = mojoExecution.getLifecyclePhase();
+            if ( lifecyclePhase != null )
+            {
+                if ( lastLifecyclePhase == null )
+                {
+                    lastLifecyclePhase = lifecyclePhase;
+                }
+                else if ( !lifecyclePhase.equals( lastLifecyclePhase ) )
+                {
+                    project.addLifecyclePhase( lastLifecyclePhase );
+                    lastLifecyclePhase = lifecyclePhase;
+                }
+            }
+        }
+
+        if ( lastLifecyclePhase != null )
+        {
+            project.addLifecyclePhase( lastLifecyclePhase );
+        }
+    }
+
-                        for ( MojoExecution forkedExecution : fork.getValue() )
-                        {
-                            execute( session, forkedExecution, projectIndex, dependencyContext );
-                        }
+                        execute( session, fork.getValue(), projectIndex, dependencyContext );
