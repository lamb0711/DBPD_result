MNG-3653/MNG-3677: restored property file nabbing from the core JAR, and reworked the runtime component to be more general and used it from the CLI



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@701264 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.artifact.versioning.ArtifactVersion;
+import java.io.IOException;
+import java.io.InputStream;
+import java.util.Properties;
+
-import java.io.IOException;
-import java.io.InputStream;
-import java.util.Properties;
-
+ * @author Jason van Zyl
-{
-    private static final String MAVEN_GROUPID = "org.apache.maven";
+{    
+    private ApplicationInformation applicationInformation;
-    private static final String MAVEN_PROPERTIES = "META-INF/maven/" + MAVEN_GROUPID + "/maven-core/pom.properties";
-
-    private ArtifactVersion applicationVersion;
-
-    public ArtifactVersion getApplicationVersion()
+    public ApplicationInformation getApplicationInformation()
-        return applicationVersion;
+        return applicationInformation;
-    {        
-        applicationVersion = new DefaultArtifactVersion( "2.1-SNAPSHOT" );    
+    {
+        applicationInformation = getVersion( getClass().getClassLoader(), "org.apache.maven", "maven-core" );
+    }
+    
+    public static ApplicationInformation getVersion( ClassLoader loader, String groupId, String artifactId )
+    {
+        String MAVEN_PROPERTIES = "META-INF/maven/" + groupId + "/" + artifactId + "/pom.properties";
-        /*
+        String version = "unknown";
+        String builtOn = "unknown";
+
-            resourceAsStream = getClass().getClassLoader().getResourceAsStream( MAVEN_PROPERTIES );
+            resourceAsStream = loader.getResourceAsStream( MAVEN_PROPERTIES );
+            
-            if ( property == null )
+            
+            if ( property != null )
-                throw new InitializationException( "maven-core properties did not include the version" );
+                version = property;
-
-            applicationVersion = new DefaultArtifactVersion( property );
+            
+            property = properties.getProperty( "builtOn" );
+            
+            if ( property != null )
+            {
+                builtOn = property;
+            }
+            
+            return new ApplicationInformation( new DefaultArtifactVersion( version ), builtOn );
+            
-            throw new InitializationException( "Unable to read properties file from maven-core", e );
+            return new ApplicationInformation( new DefaultArtifactVersion( version ), builtOn );
-        }
-        */
+        }        
