PR: MNG-1183
Submitted by: Jerome Lacoste
Make core integration tests aware of user local directory thanks to settings file


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@321323 13f79535-47bb-0310-9956-ffa450edef68

-    private static String retrieveLocalRepo()
+    private static String retrieveLocalRepo( String[] args )
-                File userXml = new File( userHome, ".m2/settings.xml" );
+                String settingsXmlPath = getSettingsPath( args );
+
+                File userXml;
+
+                if ( settingsXmlPath != null )
+                {
+                     System.out.println( "Using settings from " + settingsXmlPath );
+                     userXml = new File( settingsXmlPath );
+                } else
+                {
+                     userXml = new File( userHome, ".m2/settings.xml" );
+                }
+
+    private static String getSettingsPath( String[] args )
+        throws Exception
+    {
+        for ( int i = 0; i < args.length; i++ ) {
+            if ( args[ i ].equals( "-s" ) )
+            {
+                if ( i == args.length - 1 )
+                {
+                    throw new Exception( "missing argument to -s" );
+                }
+                return args[ i + 1 ];
+            }
+        }
+        return null;
+    }
+
-        localRepo = retrieveLocalRepo();
+        localRepo = retrieveLocalRepo( args );
-        if ( args.length == 0 )
+        List argsList = new ArrayList();
+
+        // skip options
+        for ( int i = 0; i < args.length; i++ ) {
+            if ( args[ i ].equals( "-s" ) )
+            {
+                if ( i == args.length - 1 )
+                {
+                    // should have been detected before
+                    throw new IllegalStateException( "missing argument to -s" );
+                }
+                i +=1;
+                continue;
+            }
+            argsList.add( args[ i ] );
+        }
+        
+        if ( argsList.size() == 0 )
-            tests = new ArrayList( args.length );
+            tests = new ArrayList( argsList.size() );
-            for ( int i = 0; i < args.length; i++ )
+            for ( int i = 0; i < argsList.size(); i++ )
-                String test = args[i];
+                String test = (String) argsList.get( i );
