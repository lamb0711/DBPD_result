[MNG-4633] Removed isWeaveMode from ReactorArtifactRepository

This feature was incorrect, and weave mode requires no special handling here.

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@933771 13f79535-47bb-0310-9956-ffa450edef68

-    private final boolean isWeaveMode;
-
-        @SuppressWarnings({"ConstantConditions"})
-    public ReactorArtifactRepository( Map<String, MavenProject> reactorProjects, boolean isWeaveMode )
+    @SuppressWarnings({"ConstantConditions"})
+    public ReactorArtifactRepository( Map<String, MavenProject> reactorProjects )
-        this.isWeaveMode = isWeaveMode;
-        
+
-                if ( !isWeaveMode && (projectArtifact != null && projectArtifact.getFile() != null && projectArtifact.getFile().exists()) )
+                if ( hasArtifactFileFromPackagePhase( projectArtifact ) )
-                    //TODO: This is really completely wrong and should probably be based on the phase that is currently being executed.
-                    // If we are running before the packaging phase there is going to be no archive anyway, but if we are running prior to package
-                    // we shouldn't even take the archive anyway.
-                    Collection<String> lifecyclePhases = project.getLifecyclePhases();
-
-                    if ( !lifecyclePhases.contains( "package" ) )
+                    if ( !project.hasCompletedPhase( "package" ) )
-                            if ( lifecyclePhases.contains( "test-compile" ) )
+                            if ( project.hasCompletedPhase( "test-compile" ) )
-                            if ( lifecyclePhases.contains( "compile" ) )
+                            if ( project.hasCompletedPhase( "compile" ) )
+                    // The fall-through indicates that the artifact cannot be found;
+                    // for instance if package produced nothing or classifier problems.
+    private boolean hasArtifactFileFromPackagePhase( Artifact projectArtifact )
+    {
+        return projectArtifact != null && projectArtifact.getFile() != null && projectArtifact.getFile().exists();
+    }
+
