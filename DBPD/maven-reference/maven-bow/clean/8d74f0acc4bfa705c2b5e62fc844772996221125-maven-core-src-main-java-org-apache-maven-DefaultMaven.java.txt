o Added user.xml as the central point of config for local repository, both in MBoot2 and maven proper.
o Added proxy-profile support to user.xml


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163510 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.user.ProxyProfile;
+import org.apache.maven.model.user.UserModel;
+import org.apache.maven.util.UserModelUtils;
-        return new MavenSession( container,
-                                 pluginManager,
-                                 request.getUserModel(),
-                                 request.getLocalRepository(),
-                                 request.getEventDispatcher(),
-                                 request.getLog(),
-                                 request.getGoals() );
+        return new MavenSession( container, pluginManager, request.getUserModel(), request.getLocalRepository(),
+                                 request.getEventDispatcher(), request.getLog(), request.getGoals() );
-        if ( request.getParameter( "maven.proxy.http.host" ) != null )
+        UserModel userModel = request.getUserModel();
+
+        ProxyProfile proxyProfile = UserModelUtils.getActiveProxyProfile( userModel );
+
+        if ( proxyProfile != null )
-            String p = request.getParameter( "maven.proxy.http.port" );
-            int port = 8080;
-            if ( p != null )
-            {
-                try
-                {
-                    port = Integer.valueOf( p ).intValue();
-                }
-                catch ( NumberFormatException e )
-                {
-                    getLogger().warn( "maven.proxy.http.port was not valid" );
-                }
-            }
-            wagonManager.setProxy( "http",
-                                   request.getParameter( "maven.proxy.http.host" ),
-                                   port,
-                                   request.getParameter( "maven.proxy.http.username" ),
-                                   request.getParameter( "maven.proxy.http.password" ),
-                                   request.getParameter( "maven.proxy.http.nonProxyHosts" ) );
+            wagonManager.setProxy( proxyProfile.getProtocol(), proxyProfile.getHost(), proxyProfile.getPort(),
+                                   proxyProfile.getUsername(), proxyProfile.getPassword(),
+                                   proxyProfile.getNonProxyHosts() );
+
-        getLogger().info( "Final Memory: " + ((r.totalMemory() - r.freeMemory()) / mb) + "M/" + (r.totalMemory() / mb)
-            + "M" );
+        getLogger().info(
+                          "Final Memory: " + ( ( r.totalMemory() - r.freeMemory() ) / mb ) + "M/"
+                              + ( r.totalMemory() / mb ) + "M" );
