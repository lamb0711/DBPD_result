Resolving: MNG-251

o Added transformation manager
o snapshot timestamp/buildnumber is now managed from the transformation rather than the metadata
o maven-archiver now clones the MavenProject and resolves snapshot versions for introduction into manifest and exported pom.



git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@239219 13f79535-47bb-0310-9956-ffa450edef68

-
+    
+        
+        Artifact projectArtifact = project.getArtifact();
+        
+        if ( projectArtifact.isSnapshot() )
+        {
+            Manifest.Attribute buildNumberAttr = new Manifest.Attribute( "Build-Number", "" + project.getSnapshotDeploymentBuildNumber() );
+            m.addConfiguredAttribute( buildNumberAttr );
+        }
+        
+        // we have to clone the project instance so we can write out the pom with the deployment version,
+        // without impacting the main project instance...
+        MavenProject workingProject = new MavenProject( project );
+        
+        if ( workingProject.getArtifact().isSnapshot() )
+        {
+            workingProject.setVersion( workingProject.getSnapshotDeploymentVersion() );
+        }
+        
+        String groupId = workingProject.getGroupId();
-        String groupId = project.getGroupId();
+        String artifactId = workingProject.getArtifactId();
-        String artifactId = project.getArtifactId();
-
-        File exportReadyPom = writeExportReadyPom( project );
+        File exportReadyPom = writeExportReadyPom( workingProject );
-        p.setProperty( "groupId", project.getGroupId() );
+        p.setProperty( "groupId", workingProject.getGroupId() );
-        p.setProperty( "artifactId", project.getArtifactId() );
+        p.setProperty( "artifactId", workingProject.getArtifactId() );
-        p.setProperty( "version", project.getVersion() );
+        p.setProperty( "version", workingProject.getVersion() );
-        File pomPropertiesFile = new File( project.getFile().getParentFile(), "pom.properties" );
+        File pomPropertiesFile = new File( workingProject.getFile().getParentFile(), "pom.properties" );
-        Manifest manifest = getManifest( project, archiveConfiguration.getManifest() );
+        Manifest manifest = getManifest( workingProject, archiveConfiguration.getManifest() );
