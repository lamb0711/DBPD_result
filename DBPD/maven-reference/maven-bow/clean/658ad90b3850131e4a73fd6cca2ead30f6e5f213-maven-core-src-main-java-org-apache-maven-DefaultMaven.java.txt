[MNG-5760] Add `-r/--resume` to automatically resume from the last failure point

Author: Martin Kanters <mkanters93@gmail.com>

+import org.apache.maven.execution.BuildResumptionAnalyzer;
+import org.apache.maven.execution.BuildResumptionDataRepository;
+import org.apache.maven.execution.BuildResumptionPersistenceException;
+import org.apache.maven.lifecycle.LifecycleExecutionException;
+    @Inject
+    private BuildResumptionAnalyzer buildResumptionAnalyzer;
+
+    @Inject
+    private BuildResumptionDataRepository buildResumptionDataRepository;
+
-                return addExceptionToResult( result, session.getResult().getExceptions().get( 0 ) );
+                addExceptionToResult( result, session.getResult().getExceptions().get( 0 ) );
+                persistResumptionData( result, session );
+                return result;
+            }
+            else
+            {
+                session.getAllProjects().stream()
+                        .filter( MavenProject::isExecutionRoot )
+                        .findFirst()
+                        .ifPresent( buildResumptionDataRepository::removeResumptionData );
+    private void persistResumptionData( MavenExecutionResult result, MavenSession session )
+    {
+        boolean hasLifecycleExecutionExceptions = result.getExceptions().stream()
+                .anyMatch( LifecycleExecutionException.class::isInstance );
+
+        if ( hasLifecycleExecutionExceptions )
+        {
+            MavenProject rootProject = session.getAllProjects().stream()
+                    .filter( MavenProject::isExecutionRoot )
+                    .findFirst()
+                    .orElseThrow( () -> new IllegalStateException( "No project in the session is execution root" ) );
+
+            buildResumptionAnalyzer.determineBuildResumptionData( result ).ifPresent( resumption ->
+            {
+                try
+                {
+                    buildResumptionDataRepository.persistResumptionData( rootProject, resumption );
+                    result.setCanResume( true );
+                }
+                catch ( BuildResumptionPersistenceException e )
+                {
+                    logger.warn( "Could not persist build resumption data", e );
+                }
+            } );
+        }
+    }
+
