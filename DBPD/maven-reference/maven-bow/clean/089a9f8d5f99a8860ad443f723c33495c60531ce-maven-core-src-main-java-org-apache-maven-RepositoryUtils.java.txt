o Restored runtime compatibility with plugins that implement custom ArtifactRepositoryLayouts (e.g. appassembler-maven-plugin). The method getId() was added in 3.0 and as such is not implemented by those custom impls. The refactoring done in r1073990 for MNG-4991 eventually made this discrepancy show up during plugin execution.

git-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@1075309 13f79535-47bb-0310-9956-ffa450edef68

-            result = new RemoteRepository( repo.getId(), repo.getLayout().getId(), repo.getUrl() );
+            result = new RemoteRepository( repo.getId(), getLayout( repo ), repo.getUrl() );
+    public static String getLayout( ArtifactRepository repo )
+    {
+        try
+        {
+            return repo.getLayout().getId();
+        }
+        catch ( LinkageError e )
+        {
+            /*
+             * NOTE: getId() was added in 3.x and is as such not implemented by plugins compiled against 2.x APIs.
+             */
+            String className = repo.getLayout().getClass().getSimpleName();
+            if ( className.endsWith( "RepositoryLayout" ) )
+            {
+                String layout = className.substring( 0, className.length() - "RepositoryLayout".length() );
+                if ( layout.length() > 0 )
+                {
+                    layout = Character.toLowerCase( layout.charAt( 0 ) ) + layout.substring( 1 );
+                    return layout;
+                }
+            }
+            return "";
+        }
+    }
+
