Resolving: MNG-495

o Pressing [ENTER] at a plugin update prompt should result in the plugin being registered, as indicated by the prompt.
o Use CLI switch '--no-plugin-updates' to suppress usage of the plugin registry
o Use CLI switch '--update-plugins' to force updated/resolved plugin versions to be registered
o Neither of these has a short CLI option, since we're starting to run out of sensible char options for these types of things.


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@191664 13f79535-47bb-0310-9956-ffa450edef68

+        // determine the behavior WRT prompting the user and installing plugin updates.
+        Boolean pluginUpdateOverride = settings.getRuntimeInfo().getPluginUpdateOverride();
+
-            // 1. resolve existing useVersion.
+            // resolve existing useVersion.
-                boolean forceUpdate = settings.getRuntimeInfo().isPluginUpdateForced();
-
-                if ( forceUpdate || shouldCheckForUpdates( groupId, artifactId ) )
+                // Only check for plugin updates if:
+                //
+                //  a. the CLI switch to force plugin updates is set, OR BOTH OF THE FOLLOWING:
+                //  b. the CLI switch to suppress plugin updates is NOT set, AND
+                //  c. the update interval for the plugin has triggered an update check.
+                if ( Boolean.TRUE.equals( pluginUpdateOverride )
+                    || ( !Boolean.FALSE.equals( pluginUpdateOverride ) && shouldCheckForUpdates( groupId, artifactId ) ) )
-        
+
-        // 2. we're in interactive mode, or
+        // 2. the pluginUpdateOverride flag has NOT been set to Boolean.FALSE (suppression mode)
+        // 3. we're in interactive mode, or
-        boolean persistUpdate = promptToPersist && ( inInteractiveMode || autoUpdate );
+        boolean persistUpdate = promptToPersist && !Boolean.FALSE.equals( pluginUpdateOverride )
+            && ( inInteractiveMode || autoUpdate );
+        // retrieve the apply-to-all flag, if it's been set previously.
-        
-        // Incorporate interactive-mode and previous decisions on apply-to-all, if appropriate.
+
+        // Incorporate interactive-mode CLI overrides, and previous decisions on apply-to-all, if appropriate.
+        // don't prompt if the CLI pluginUpdateOverride is set (either suppression or force mode will stop prompting)
-        promptToPersist = promptToPersist && applyToAll == null && inInteractiveMode;
+        promptToPersist = promptToPersist && pluginUpdateOverride == null && applyToAll == null && inInteractiveMode;
-        
+
-        // 2. the user has previously answeres all in this session
+        // 2. the user has previously answered all in this session
-        if ( ( applyToAll == null || applyToAll.booleanValue() ) && persistUpdate )
+        if ( !Boolean.FALSE.equals( applyToAll ) && persistUpdate )
-            
+
-                
+
+                else if ( persistAnswer.startsWith( "n" ) )
+                {
+                    shouldPersist = false;
+                }
+                else
+                {
+                    // default to yes.
+                    shouldPersist = true;
+                }
-            
+
-            
+
-                
-                SimpleDateFormat format = new SimpleDateFormat( org.apache.maven.plugin.registry.Plugin.LAST_CHECKED_DATE_FORMAT );
-                
-                plugin.setLastChecked(format.format( new Date() ) );
+
+                SimpleDateFormat format = new SimpleDateFormat(
+                                                                org.apache.maven.plugin.registry.Plugin.LAST_CHECKED_DATE_FORMAT );
+
+                plugin.setLastChecked( format.format( new Date() ) );
