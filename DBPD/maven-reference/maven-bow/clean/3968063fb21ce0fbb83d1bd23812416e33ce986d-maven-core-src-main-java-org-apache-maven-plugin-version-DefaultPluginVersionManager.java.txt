look in the reactor and the current project for the appropriate version to use
(before the registry and repository, but after the build section)


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@312889 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.ArtifactUtils;
+        // if there was no explicit version, try for one in the reactor
+        if ( version == null )
+        {
+            // check self
+            if ( project.getGroupId().equals( groupId ) && project.getArtifactId().equals( artifactId ) )
+            {
+                version = project.getVersion();
+            }
+            else if ( project.getProjectReferences() != null )
+            {
+                String refId = ArtifactUtils.versionlessKey( groupId, artifactId );
+                MavenProject ref = (MavenProject) project.getProjectReferences().get( refId );
+                if ( ref != null )
+                {
+                    version = ref.getVersion();
+                }
+            }
+        }
+
-                    updatedVersion = resolveMetaVersion( groupId, artifactId, project,
-                                                         localRepository, Artifact.LATEST_VERSION );
+                    updatedVersion = resolveMetaVersion( groupId, artifactId, project, localRepository,
+                                                         Artifact.LATEST_VERSION );
-            version = resolveMetaVersion( groupId, artifactId, project, localRepository,
-                                          Artifact.LATEST_VERSION );
+            version = resolveMetaVersion( groupId, artifactId, project, localRepository, Artifact.LATEST_VERSION );
-        // TODO: Remove this...it shouldn't be needed anymore. Leaving it in for backward compat.
-            version = resolveMetaVersion( groupId, artifactId, project, localRepository,
-                                          Artifact.RELEASE_VERSION );
+            version = resolveMetaVersion( groupId, artifactId, project, localRepository, Artifact.RELEASE_VERSION );
-        
+
-                    if ( pluginProject.getPrerequisites() != null && pluginProject.getPrerequisites().getMaven() != null )
+                    if ( pluginProject.getPrerequisites() != null &&
+                        pluginProject.getPrerequisites().getMaven() != null )
