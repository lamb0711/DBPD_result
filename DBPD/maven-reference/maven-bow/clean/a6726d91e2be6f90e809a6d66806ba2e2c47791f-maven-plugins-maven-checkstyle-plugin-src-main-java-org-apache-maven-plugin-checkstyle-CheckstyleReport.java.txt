PR: MNG-1111
Submitted by: Edwin Punzalan
Reviewed by:  Brett Porter
honour use file directive (output to a string which is logged).
modifed: original patch used system.out


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@307349 13f79535-47bb-0310-9956-ffa450edef68

+import org.codehaus.plexus.util.StringOutputStream;
+    private static final File[] EMPTY_FILE_ARRAY = new File[0];
+
+    private StringOutputStream stringOutputStream;
+
-        Checker checker = null;
+        Checker checker;
-        if ( useFile != null )
-        {
-            OutputStream out = getOutputStream( useFile );
-
-            checker.addListener( new DefaultLogger( out, true ) );
-        }
+        checker.addListener( getConsoleListener() );
+        if ( stringOutputStream != null )
+        {
+            getLog().info( stringOutputStream.toString() );
+        }
+
-        return (File[]) ( files.toArray( new File[0] ) );
+        return (File[]) files.toArray( EMPTY_FILE_ARRAY );
-        if ( StringUtils.isEmpty( format ) || ( "sun".equalsIgnoreCase( format.trim() ) ) )
+        if ( StringUtils.isEmpty( format ) || "sun".equalsIgnoreCase( format.trim() ) )
+    private DefaultLogger getConsoleListener()
+        throws MavenReportException
+    {
+        DefaultLogger consoleListener;
+
+        if ( useFile == null )
+        {
+            stringOutputStream = new StringOutputStream();
+            consoleListener = new DefaultLogger( stringOutputStream, false );
+        }
+        else
+        {
+            OutputStream out = getOutputStream( useFile );
+
+            consoleListener = new DefaultLogger( out, true );
+        }
+
+        return consoleListener;
+    }
+
