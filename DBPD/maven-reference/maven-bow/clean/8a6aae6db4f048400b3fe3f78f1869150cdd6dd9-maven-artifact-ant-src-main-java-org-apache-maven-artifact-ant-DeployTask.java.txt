PR: MNG-1160
fix up some deployment repository determination logic, and avoid NPE in the process


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@312810 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.model.DistributionManagement;
-        if ( remoteRepository == null )
-        {
-            if ( pom.getDistributionManagement() == null || pom.getDistributionManagement().getRepository() == null )
-            {
-                throw new BuildException( "A distributionManagement element is required in your POM to deploy" );
-            }
+        Artifact artifact = createArtifact( pom );
-            remoteRepository = createAntRemoteRepositoryBase( pom.getDistributionManagement().getRepository() );
+        DistributionManagement distributionManagement = pom.getDistributionManagement();
+
+        if ( remoteSnapshotRepository == null && remoteRepository == null )
+        {
+            if ( distributionManagement != null )
+            {
+                if ( distributionManagement.getSnapshotRepository() != null )
+                {
+                    remoteSnapshotRepository = createAntRemoteRepositoryBase(
+                        distributionManagement.getSnapshotRepository() );
+                }
+                if ( distributionManagement.getRepository() != null )
+                {
+                    remoteRepository = createAntRemoteRepositoryBase( distributionManagement.getRepository() );
+                }
+            }
-            if ( pom.getDistributionManagement().getSnapshotRepository() != null )
-            {
-                remoteSnapshotRepository = createAntRemoteRepositoryBase(
-                    pom.getDistributionManagement().getSnapshotRepository() );
-            }
+            remoteSnapshotRepository = remoteRepository;
-        // Deploy the POM
-        Artifact artifact = createArtifact( pom );
-
-        ArtifactRepository deploymentRepository = createRemoteArtifactRepository( remoteRepository );
-
-        if ( remoteSnapshotRepository != null && artifact.isSnapshot() )
+        ArtifactRepository deploymentRepository = null;
+        if ( artifact.isSnapshot() && remoteSnapshotRepository != null )
+        else if ( remoteRepository != null )
+        {
+            deploymentRepository = createRemoteArtifactRepository( remoteRepository );
+        }
+        else
+        {
+            throw new BuildException(
+                "A distributionManagement element or remoteRepository element is required to deploy" );
+        }
+        // Deploy the POM
