[MNG-2145] Correcting several merge issues between profiles and main build, and also of duplicate plugin declarations within a single build section.

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@617325 13f79535-47bb-0310-9956-ffa450edef68

-        injectDependencies( profile, model );
+
+        model.setDependencies( injectDependencies( profile.getDependencies(), model.getDependencies() ) );
+        modelPlugin.setDependencies( injectDependencies( profilePlugin.getDependencies(), modelPlugin.getDependencies() ) );
+
-    private void injectDependencies( Profile profile, Model model )
+    private List injectDependencies( List profileDeps, List modelDeps )
-        List deps = model.getDependencies();
-
-        if ( deps != null )
+        if ( modelDeps != null )
-            for ( Iterator it = deps.iterator(); it.hasNext(); )
+            for ( Iterator it = modelDeps.iterator(); it.hasNext(); )
-        deps = profile.getDependencies();
-
-        if ( deps != null )
+        if ( profileDeps != null )
-            for ( Iterator it = deps.iterator(); it.hasNext(); )
+            for ( Iterator it = profileDeps.iterator(); it.hasNext(); )
-        model.setDependencies( new ArrayList( depsMap.values() ) );
+        return new ArrayList( depsMap.values() );
