o Fixed model builder to expand plugin management configuration, too

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@807669 13f79535-47bb-0310-9956-ffa450edef68

+import java.util.List;
+
+import org.apache.maven.model.PluginManagement;
-            for ( Plugin buildPlugin : build.getPlugins() )
-            {
-                Xpp3Dom parentDom = (Xpp3Dom) buildPlugin.getConfiguration();
+            expand( build.getPlugins() );
-                if ( parentDom != null )
-                {
-                    for ( PluginExecution execution : buildPlugin.getExecutions() )
-                    {
-                        Xpp3Dom childDom = (Xpp3Dom) execution.getConfiguration();
-                        childDom = Xpp3Dom.mergeXpp3Dom( childDom, new Xpp3Dom( parentDom ) );
-                        execution.setConfiguration( childDom );
-                    }
-                }
+            PluginManagement pluginManagement = build.getPluginManagement();
+
+            if ( pluginManagement != null )
+            {
+                expand( pluginManagement.getPlugins() );
+    private void expand( List<Plugin> plugins )
+    {
+        for ( Plugin plugin : plugins )
+        {
+            Xpp3Dom pluginConfiguration = (Xpp3Dom) plugin.getConfiguration();
+
+            if ( pluginConfiguration != null )
+            {
+                for ( PluginExecution execution : plugin.getExecutions() )
+                {
+                    Xpp3Dom executionConfiguration = (Xpp3Dom) execution.getConfiguration();
+
+                    executionConfiguration =
+                        Xpp3Dom.mergeXpp3Dom( executionConfiguration, new Xpp3Dom( pluginConfiguration ) );
+
+                    execution.setConfiguration( executionConfiguration );
+                }
+            }
+        }
+    }
+
