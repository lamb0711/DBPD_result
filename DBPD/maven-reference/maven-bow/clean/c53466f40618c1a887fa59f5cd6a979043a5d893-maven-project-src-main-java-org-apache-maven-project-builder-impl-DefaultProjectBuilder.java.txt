o Fixed regressions regarding profile de-/activation

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@745642 13f79535-47bb-0310-9956-ffa450edef68

-import org.apache.maven.profiles.activation.ProfileActivationContext;
-import org.apache.maven.mercury.builder.api.DependencyProcessorException;
-import org.apache.maven.project.builder.profile.ProfileUri;
-        return buildModel( pom, null, interpolatorProperties, null, resolver );
+        return buildModel( pom, null, interpolatorProperties, null, null, resolver );
-                                             Collection<String> activeProfileIds,
+                                             Collection<String> activeProfileIds, Collection<String> inactiveProfileIds,
+        if ( inactiveProfileIds == null )
+        {
+            inactiveProfileIds = new ArrayList<String>();
+        }
-                PomTransformer.MODEL_CONTAINER_FACTORIES), activeProfileIds, properties);
+                PomTransformer.MODEL_CONTAINER_FACTORIES), activeProfileIds, inactiveProfileIds, properties);
-                mavenParents = getDomainModelParentsFromLocalPath( domainModel, resolver, pom.getParentFile(), properties, activeProfileIds );
+                mavenParents =
+                    getDomainModelParentsFromLocalPath( domainModel, resolver, pom.getParentFile(), properties,
+                                                        activeProfileIds, inactiveProfileIds );
-                mavenParents = getDomainModelParentsFromRepository( domainModel, resolver, properties, activeProfileIds );
+                mavenParents =
+                    getDomainModelParentsFromRepository( domainModel, resolver, properties, activeProfileIds,
+                                                         inactiveProfileIds );
-       List<String> profileIds = (projectBuilderConfiguration != null &&
+       List<String> activeProfileIds = (projectBuilderConfiguration != null &&
+       List<String> inactiveProfileIds =
+           ( projectBuilderConfiguration != null && projectBuilderConfiguration.getGlobalProfileManager() != null && 
+                           projectBuilderConfiguration.getGlobalProfileManager().getProfileActivationContext() != null ) ? 
+                           projectBuilderConfiguration.getGlobalProfileManager().getProfileActivationContext().getExplicitlyInactiveProfileIds() : new ArrayList<String>();
-                                                        profileIds,
+                                                        activeProfileIds, inactiveProfileIds,
-                                                                   Collection<String> activeProfileIds)
+                                                                   Collection<String> activeProfileIds,
+                                                                   Collection<String> inactiveProfileIds )
-                PomTransformer.MODEL_CONTAINER_FACTORIES), activeProfileIds, properties);
+                PomTransformer.MODEL_CONTAINER_FACTORIES), activeProfileIds, inactiveProfileIds, properties);
-        domainModels.addAll( getDomainModelParentsFromRepository( parentDomainModel, artifactResolver, properties, activeProfileIds ) );
+        domainModels.addAll( getDomainModelParentsFromRepository( parentDomainModel, artifactResolver, properties,
+                                                                  activeProfileIds, inactiveProfileIds ) );
-                                                                  Collection<String> activeProfileIds)
+                                                                  Collection<String> activeProfileIds,
+                                                                  Collection<String> inactiveProfileIds )
-                PomTransformer.MODEL_CONTAINER_FACTORIES), activeProfileIds, properties);
+                PomTransformer.MODEL_CONTAINER_FACTORIES), activeProfileIds, inactiveProfileIds, properties);
-            List<DomainModel> parentDomainModels = getDomainModelParentsFromRepository( domainModel, artifactResolver, properties, activeProfileIds );
+            List<DomainModel> parentDomainModels =
+                getDomainModelParentsFromRepository( domainModel, artifactResolver, properties, activeProfileIds,
+                                                     inactiveProfileIds );
-                                                                         parentFile.getParentFile(), properties, activeProfileIds ) );
+                                                                         parentFile.getParentFile(), properties,
+                                                                         activeProfileIds, inactiveProfileIds ) );
-                domainModels.addAll( getDomainModelParentsFromRepository( parentDomainModel, artifactResolver, properties, activeProfileIds ) );
+                domainModels.addAll( getDomainModelParentsFromRepository( parentDomainModel, artifactResolver,
+                                                                          properties, activeProfileIds,
+                                                                          inactiveProfileIds ) );
