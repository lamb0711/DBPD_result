change archiving plugins to use a shred archive configuration


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@163716 13f79535-47bb-0310-9956-ffa450edef68

- * @todo improve the use of this now that plugin fields are used instead of a request object - add an <archive> element to configuration?
+ * @todo improve the use of this now that plugin fields are used instead of a request object - add an <archive> element to configuration?
-    public Manifest getManifest( MavenProject project, String mainClass, String packageName, boolean addClasspath,
-                                 boolean addExtensions )
+    public Manifest getManifest( MavenProject project, ManifestConfiguration config )
-        if ( packageName != null )
+        if ( config.getPackageName() != null )
-            Manifest.Attribute packageAttr = new Manifest.Attribute( "Package", packageName );
+            Manifest.Attribute packageAttr = new Manifest.Attribute( "Package", config.getPackageName() );
-        if ( addClasspath )
+        if ( config.isAddClasspath() )
+        String mainClass = config.getMainClass();
-        if ( addExtensions )
+        if ( config.isAddExtensions() )
-                    // TODO: make repo configurable
-                    name = artifact.getArtifactId() + "-Implementation-URL";
-                    String url = "http://www.ibiblio.org/maven/" + artifact.toString();
-                    Manifest.Attribute archImplUrlAttr = new Manifest.Attribute( name, url );
-                    m.addConfiguredAttribute( archImplUrlAttr );
+
+                    if ( artifact.getRepository() != null )
+                    {
+                        // TODO: is this correct
+                        name = artifact.getArtifactId() + "-Implementation-URL";
+                        String url = artifact.getRepository().getUrl() + "/" + artifact.toString();
+                        Manifest.Attribute archImplUrlAttr = new Manifest.Attribute( name, url );
+                        m.addConfiguredAttribute( archImplUrlAttr );
+                    }
-    public void createArchive( MavenProject project, String manifestFile, boolean compress, boolean index,
-                               Manifest manifest )
+    public void createArchive( MavenProject project, MavenArchiveConfiguration archiveConfiguration )
+        String manifestFile = archiveConfiguration.getManifestFile();
+        Manifest manifest = getManifest( project, archiveConfiguration.getManifest() );
+
-        archiver.setCompress( compress );
-        archiver.setIndex( index );
+        archiver.setCompress( archiveConfiguration.isCompress() );
+        archiver.setIndex( archiveConfiguration.isIndex() );
