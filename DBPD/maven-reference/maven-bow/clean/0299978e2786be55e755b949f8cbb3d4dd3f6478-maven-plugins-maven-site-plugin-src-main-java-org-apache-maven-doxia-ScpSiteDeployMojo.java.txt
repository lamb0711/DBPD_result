set the site deployment to the live environment, and use the wagon manager to get the authentication credentials

git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@169781 13f79535-47bb-0310-9956-ffa450edef68

+import org.apache.maven.artifact.manager.WagonManager;
- * @author <a href="mailto:michal@codehaus.org">Michal Maczka</a>
- * @version $Id$
- * @goal deploy
- * @description deploys website using scp protocol.
+ * Deploys website using scp protocol.
+ * @author <a href="mailto:michal@codehaus.org">Michal Maczka</a>
+ * @version $Id$
+ * @goal deploy
+    /**
+     * @parameter expression="${component.org.apache.maven.artifact.manager.WagonManager}"
+     * @required
+     * @readonly
+     */
+    private WagonManager wagonManager;
+
-        SshCommandExecutor commandExecutor = new ScpWagon();
-
+        SshCommandExecutor commandExecutor = null;
-
-                String msg = "distributionManagement element is missing in the POM: "
-                    + project.getId();
+                String msg = "distributionManagement element is missing in the POM: " + project.getId();
-
-                String msg = "distributionManagement/repository element is missing in the POM: "
-                    + project.getId();
+                String msg = "distributionManagement/site element is missing in the POM: " + project.getId();
-                String msg = "distributionManagement/site/url element is missing in the POM: "
-                    + project.getId();
+                String msg = "distributionManagement/site/url element is missing in the POM: " + project.getId();
-            //@todo dirty hack to make artifact uploading work
-            commandExecutor.connect( repository, WagonUtils.getAuthInfo() );
+            commandExecutor = (SshCommandExecutor) wagonManager.getWagon( "scp" );
+
+            commandExecutor.connect( repository, wagonManager.getAuthenticationInfo( id ) );
-        catch( Exception e )
+        catch ( Exception e )
