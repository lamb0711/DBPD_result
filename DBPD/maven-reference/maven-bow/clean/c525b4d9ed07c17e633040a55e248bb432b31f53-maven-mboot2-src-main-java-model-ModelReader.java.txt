exclude old plexus utils


git-svn-id: https://svn.apache.org/repos/asf/maven/components/trunk@314962 13f79535-47bb-0310-9956-ffa450edef68

-import java.io.IOException;
+import java.io.IOException;
+    private final String inheritedScope;
+
-        this( downloader, resolveTransitiveDependencies, Collections.EMPTY_SET, Collections.EMPTY_LIST );
+        this( downloader, null, resolveTransitiveDependencies, Collections.EMPTY_SET, Collections.EMPTY_LIST );
-    public ModelReader( ArtifactDownloader downloader, boolean resolveTransitiveDependencies, Set excluded, List chain )
+    public ModelReader( ArtifactDownloader downloader, String inheritedScope, boolean resolveTransitiveDependencies,
+                        Set excluded, List chain )
+        this.inheritedScope = inheritedScope;
+
-            ModelReader p = retrievePom( parentGroupId, parentArtifactId, parentVersion, "pom", false, excluded,
-                                         Collections.EMPTY_LIST );
+            ModelReader p = retrievePom( parentGroupId, parentArtifactId, parentVersion, "pom", inheritedScope, false,
+                                         excluded, Collections.EMPTY_LIST );
-            addDependencies( p.getDependencies(), parentDependencies, null, excluded );
+            addDependencies( p.getDependencies(), parentDependencies, inheritedScope, excluded );
-            addDependencies( p.getManagedDependencies(), managedDependencies, null, Collections.EMPTY_SET );
+            addDependencies( p.getManagedDependencies(), managedDependencies, inheritedScope, Collections.EMPTY_SET );
-                if ( dependency.getVersion() == null )
+                if ( !dependency.getScope().equals( Dependency.SCOPE_TEST ) || inheritedScope == null )
-                    Dependency managedDependency = (Dependency) managedDependencies.get( dependency.getConflictId() );
-                    if ( managedDependency == null )
+                    if ( dependency.getVersion() == null )
-                        throw new NullPointerException( "[" + groupId + ":" + artifactId + ":" + packaging + ":" +
-                            version + "] " + "Dependency " + dependency.getConflictId() +
-                            " is missing a version, and nothing is found in dependencyManagement. " );
+                        Dependency managedDependency =
+                            (Dependency) managedDependencies.get( dependency.getConflictId() );
+                        if ( managedDependency == null )
+                        {
+                            throw new NullPointerException( "[" + groupId + ":" + artifactId + ":" + packaging + ":" +
+                                version + "] " + "Dependency " + dependency.getConflictId() +
+                                " is missing a version, and nothing is found in dependencyManagement. " );
+                        }
+                        dependency.setVersion( managedDependency.getVersion() );
-                    dependency.setVersion( managedDependency.getVersion() );
-                }
-                if ( resolveTransitiveDependencies )
-                {
-                    Set excluded = new HashSet( this.excluded );
-                    excluded.addAll( dependency.getExclusions() );
+                    if ( resolveTransitiveDependencies )
+                    {
+                        Set excluded = new HashSet( this.excluded );
+                        excluded.addAll( dependency.getExclusions() );
-                    ModelReader p = retrievePom( dependency.getGroupId(), dependency.getArtifactId(),
-                                                 dependency.getVersion(), dependency.getType(),
-                                                 resolveTransitiveDependencies, excluded, dependency.getChain() );
+                        ModelReader p = retrievePom( dependency.getGroupId(), dependency.getArtifactId(),
+                                                     dependency.getVersion(), dependency.getType(),
+                                                     dependency.getScope(), resolveTransitiveDependencies, excluded,
+                                                     dependency.getChain() );
-                    addDependencies( p.getDependencies(), transitiveDependencies, dependency.getScope(), excluded );
+                        addDependencies( p.getDependencies(), transitiveDependencies, dependency.getScope(), excluded );
+                    }
-                                     boolean resolveTransitiveDependencies, Set excluded, List chain )
+                                     String inheritedScope, boolean resolveTransitiveDependencies, Set excluded,
+                                     List chain )
-        ModelReader p = new ModelReader( downloader, resolveTransitiveDependencies, excluded, chain );
+        ModelReader p = new ModelReader( downloader, inheritedScope, resolveTransitiveDependencies, excluded, chain );
